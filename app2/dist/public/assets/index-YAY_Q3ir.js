const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-CT50dpqw.js","assets/vendor-Dazix4UH.js","assets/excel-CdQGSzc_.js","assets/ForgotPasswordPage-CRIGEQMc.js","assets/ui-D72ny688.js","assets/router-Fkx1fLit.js","assets/query-D-PO3xZl.js","assets/charts-r7lk5UyH.js"])))=>i.map(i=>d[i]);
var J2=Object.defineProperty;var ek=(t,s,r)=>s in t?J2(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var B=(t,s,r)=>ek(t,typeof s!="symbol"?s+"":s,r);import{r as h,j as e,V as P0,a as _0,A as E0,C as D0,T as M0,D as R0,P as tk,u as lt,b as rl,c as We,d as Ne,e as Lt,f as Vi,g as Hs,h as ws,i as $n,k as od,l as I0,m as sk,n as al,o as ld,S as F0,O as nl,p as O0,q as il,s as $0,t as ol,v as ll,w as L0,x as V0,y as z0,I as rk,z as B0,B as q0,E as ak,F as U0,G as nk,L as W0,H as K0,J as ik,K as ok,M as H0,N as lk,Q as ck,U as ot,W as G0,X as pa,Y as zi,Z as Pa,_ as cd,$ as dd,a0 as cl,a1 as ud,a2 as dk,a3 as md,a4 as hd,a5 as fd,a6 as pd,a7 as uk,a8 as Q0,a9 as X0}from"./ui-D72ny688.js";import{a as mk,c as ao}from"./vendor-Dazix4UH.js";import{u as Or,R as jc,S as hk,a as gt}from"./router-Fkx1fLit.js";import{Q as fk,u as ge,a as Mt,b as Ce,c as pk}from"./query-D-PO3xZl.js";import{c as Z0}from"./charts-r7lk5UyH.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var no={},nm;function xk(){if(nm)return no;nm=1;var t=mk();return no.createRoot=t.createRoot,no.hydrateRoot=t.hydrateRoot,no}var gk=xk();const yk="modulepreload",vk=function(t){return"/"+t},im={},xd=function(s,r,a){let n=Promise.resolve();if(r&&r.length>0){let o=function(d){return Promise.all(d.map(c=>Promise.resolve(c).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");n=o(r.map(d=>{if(d=vk(d),d in im)return;im[d]=!0;const c=d.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const m=document.createElement("link");if(m.rel=c?"stylesheet":yk,c||(m.as="script"),m.crossOrigin="",m.href=d,u&&m.setAttribute("nonce",u),document.head.appendChild(m),c)return new Promise((y,x)=>{m.addEventListener("load",y),m.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return s().catch(i)})};async function Y0(t){if(!t.ok){let s="حدث خطأ غير متوقع";try{s=(await t.json()).message||s}catch{t.status===400?s="البيانات المدخلة غير صحيحة":t.status===404?s="العنصر المطلوب غير موجود":t.status===500?s="حدث خطأ في الخادم":s="حدث خطأ في الاتصال"}throw new Error(s)}}let Ha=null;function om(t){Ha=t}function J0(){return Ha?Ha.getAccessToken():localStorage.getItem("accessToken")}async function ey(){return Ha?await Ha.refreshToken():(console.warn("⚠️ AuthProvider helpers غير مسجلة - استخدام fallback"),!1)}async function ae(t,s,r){const a=new AbortController,n=setTimeout(()=>a.abort(),3e4);async function i(o=0){try{const l={};r&&(l["Content-Type"]="application/json");const u=J0();u&&(l.Authorization=`Bearer ${u}`);const d=await fetch(t,{method:s,headers:l,body:r?JSON.stringify(r):void 0,credentials:"include",signal:a.signal});if(d.status===401&&o===0){if(console.log("🔄 محاولة تجديد التوكن..."),await ey())return console.log("✅ تم تجديد التوكن، محاولة الطلب مرة أخرى..."),i(1);throw console.log("❌ فشل في تجديد التوكن"),Ha?await Ha.logout():window.location.href="/login",new Error("انتهت جلسة المصادقة، يرجى تسجيل الدخول مرة أخرى")}if(await Y0(d),s==="DELETE"&&d.status===204)return{};const c=d.headers.get("content-type");if(!c||!c.includes("application/json")){const m=await d.text();throw console.error(`❌ [apiRequest] الخادم أرسل ${c||"غير محدد"} بدلاً من JSON:`,{url:t,method:s,status:d.status,contentType:c,responsePreview:m.substring(0,200)}),new Error(`خطأ في نوع الاستجابة: متوقع JSON لكن تم استلام ${c||"غير محدد"}`)}let f;try{f=await d.json()}catch(m){const y=await d.clone().text();throw console.error("❌ [apiRequest] خطأ في تحليل JSON:",{url:t,method:s,parseError:m,responsePreview:y.substring(0,200)}),new Error("خطأ في تحليل استجابة JSON من الخادم")}return f}catch(l){throw l instanceof Error&&l.name==="AbortError"?new Error("انتهت مهلة الطلب، يرجى المحاولة مرة أخرى"):l}}try{const o=await i();return clearTimeout(n),o}catch(o){throw clearTimeout(n),o}}const bk=({on401:t})=>async({queryKey:s})=>{async function r(a=0){const n=new AbortController,i=setTimeout(()=>n.abort(),15e3);try{const o={},l=J0();l&&(o.Authorization=`Bearer ${l}`),console.log(`🔍 [QueryClient] إرسال طلب: ${s.join("/")}`,{hasToken:!!l});const u=await fetch(s.join("/"),{headers:o,credentials:"include",signal:n.signal});if(clearTimeout(i),u.status===401){if(console.error(`🚫 [QueryClient] خطأ 401 غير مصرح لـ ${s.join("/")}`,{retryCount:a,hasToken:!!localStorage.getItem("accessToken"),queryKey:s.join("/")}),a===0&&(console.log("🔄 محاولة تجديد التوكن في query..."),await ey()))return console.log("✅ تم تجديد التوكن، إعادة تشغيل query..."),r(1);throw console.error("❌ فشل المصادقة - إظهار الخطأ الحقيقي"),new Error(`خطأ في المصادقة (401): ${s.join("/")} - يرجى تسجيل الدخول مرة أخرى`)}await Y0(u);const d=await u.json();if(console.log(`✅ [QueryClient] استجابة ناجحة لـ ${s.join("/")}:`,{hasData:!!d,dataType:typeof d}),console.log(`📊 [QueryClient] تحليل البيانات لـ ${s.join("/")}:`,{dataType:typeof d,isObject:d&&typeof d=="object",hasSuccess:d?.success!==void 0,hasDataProperty:d?.data!==void 0,actualDataValue:d?.data,rawData:d}),d&&typeof d=="object"){const c=typeof s[0]=="string"&&s[0].includes("migration");if(d.success!==void 0&&d.data!==void 0)return console.log(`✅ [QueryClient] بيانات API صحيحة لـ ${s.join("/")}:`,{success:d.success,dataExists:d.data!==null,dataType:typeof d.data,isArray:Array.isArray(d.data)}),c?d.data:d.data===null||d.data===void 0?(console.warn(`⚠️ [QueryClient] البيانات null/undefined لـ ${s.join("/")} - إرجاع مصفوفة فارغة`),[]):d.data;if(Array.isArray(d))return console.log(`📋 [QueryClient] مصفوفة مباشرة لـ ${s.join("/")}:`,d.length),d;if(d.data!==void 0)return console.log(`🔗 [QueryClient] خاصية data مباشرة لـ ${s.join("/")}:`,d.data),d.data!==null?d.data:[]}return console.log(`🔄 [QueryClient] إرجاع البيانات كما هي لـ ${s.join("/")}:`,d),d}catch(o){throw clearTimeout(i),o instanceof Error&&o.name==="AbortError"?(console.log(`⏰ [QueryClient] timeout لـ ${s.join("/")}`),new Error("انتهت مهلة الطلب، يرجى المحاولة مرة أخرى")):(console.error(`❌ [QueryClient] خطأ في ${s.join("/")}`,o),o)}}return r()},Nc=new fk({defaultOptions:{queries:{queryFn:bk({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1e3*60*15,retry:1,refetchOnReconnect:!1},mutations:{retry:1}}}),jk=1,Nk=1e6;let Ll=0;function wk(){return Ll=(Ll+1)%Number.MAX_SAFE_INTEGER,Ll.toString()}const Vl=new Map,lm=t=>{if(Vl.has(t))return;const s=setTimeout(()=>{Vl.delete(t),ni({type:"REMOVE_TOAST",toastId:t})},Nk);Vl.set(t,s)},kk=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,jk)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===s.toast.id?{...r,...s.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=s;return r?lm(r):t.toasts.forEach(a=>{lm(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===r||r===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==s.toastId)}}},fo=[];let po={toasts:[]};function ni(t){po=kk(po,t),fo.forEach(s=>{s(po)})}function Sk({...t}){const s=wk(),r=n=>ni({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>ni({type:"DISMISS_TOAST",toastId:s});return ni({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:r}}function Ct(){const[t,s]=h.useState(po);return h.useEffect(()=>(fo.push(s),()=>{const r=fo.indexOf(s);r>-1&&fo.splice(r,1)}),[t]),{...t,toast:Sk,dismiss:r=>ni({type:"DISMISS_TOAST",toastId:r})}}const cm=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,dm=Z0,Ln=(t,s)=>r=>{var a;if(s?.variants==null)return dm(t,r?.class,r?.className);const{variants:n,defaultVariants:i}=s,o=Object.keys(n).map(d=>{const c=r?.[d],f=i?.[d];if(c===null)return null;const m=cm(c)||cm(f);return n[d][m]}),l=r&&Object.entries(r).reduce((d,c)=>{let[f,m]=c;return m===void 0||(d[f]=m),d},{}),u=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((d,c)=>{let{class:f,className:m,...y}=c;return Object.entries(y).every(x=>{let[p,A]=x;return Array.isArray(A)?A.includes({...i,...l}[p]):{...i,...l}[p]===A})?[...d,f,m]:d},[]);return dm(t,o,u,r?.class,r?.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tk=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ty=(...t)=>t.filter((s,r,a)=>!!s&&a.indexOf(s)===r).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ak={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ck=h.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:i,iconNode:o,...l},u)=>h.createElement("svg",{ref:u,...Ak,width:s,height:s,stroke:t,strokeWidth:a?Number(r)*24/Number(s):r,className:ty("lucide",n),...l},[...o.map(([d,c])=>h.createElement(d,c)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=(t,s)=>{const r=h.forwardRef(({className:a,...n},i)=>h.createElement(Ck,{ref:i,iconNode:s,className:ty(`lucide-${Tk(t)}`,a),...n}));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=ee("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=ee("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=ee("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const um=ee("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pk=ee("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _k=ee("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=ee("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=ee("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ek=ee("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=ee("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=ee("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sy=ee("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=ee("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=ee("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mm=ee("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=ee("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bi=ee("ChartGantt",[["path",{d:"M10 6h8",key:"zvc2xc"}],["path",{d:"M12 16h6",key:"yi5mkt"}],["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M8 11h7",key:"wz2hg0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dk=ee("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mk=ee("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rk=ee("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gd=ee("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=ee("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ik=ee("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qi=ee("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=ee("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=ee("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=ee("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ry=ee("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hm=ee("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fm=ee("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ay=ee("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=ee("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fk=ee("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ok=ee("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=ee("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $k=ee("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=ee("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lk=ee("Delete",[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=ee("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=ee("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vk=ee("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=ee("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=ee("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=ee("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=ee("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=ee("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zk=ee("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bk=ee("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qk=ee("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uk=ee("Hammer",[["path",{d:"m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9",key:"eefl8a"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"b7pghm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zl=ee("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wk=ee("HardHat",[["path",{d:"M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z",key:"1dej2m"}],["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=ee("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=ee("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=ee("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=ee("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kk=ee("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bl=ee("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=ee("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xi=ee("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hk=ee("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const io=ee("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=ee("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gk=ee("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qk=ee("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xk=ee("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zk=ee("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=ee("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yk=ee("Paintbrush",[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jk=ee("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pm=ee("PenTool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=ee("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=ee("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=ee("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=ee("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=ee("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=ee("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vd=ee("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=ee("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=ee("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=ee("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=ee("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wc=ee("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kc=ee("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=ee("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=ee("ShieldX",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=ee("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=ee("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=ee("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=ee("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ny=ee("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xm=ee("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=ee("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=ee("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nS=ee("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=ee("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=ee("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=ee("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=ee("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=ee("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ql=ee("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=ee("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ui=ee("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gm=ee("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=ee("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=ee("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ym=ee("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vm=ee("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ul=ee("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=ee("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=ee("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=ee("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),jd="-",iS=t=>{const s=lS(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:o=>{const l=o.split(jd);return l[0]===""&&l.length!==1&&l.shift(),iy(l,s)||oS(o)},getConflictingClassGroupIds:(o,l)=>{const u=r[o]||[];return l&&a[o]?[...u,...a[o]]:u}}},iy=(t,s)=>{if(t.length===0)return s.classGroupId;const r=t[0],a=s.nextPart.get(r),n=a?iy(t.slice(1),a):void 0;if(n)return n;if(s.validators.length===0)return;const i=t.join(jd);return s.validators.find(({validator:o})=>o(i))?.classGroupId},bm=/^\[(.+)\]$/,oS=t=>{if(bm.test(t)){const s=bm.exec(t)[1],r=s?.substring(0,s.indexOf(":"));if(r)return"arbitrary.."+r}},lS=t=>{const{theme:s,prefix:r}=t,a={nextPart:new Map,validators:[]};return dS(Object.entries(t.classGroups),r).forEach(([i,o])=>{Sc(o,a,i,s)}),a},Sc=(t,s,r,a)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?s:jm(s,n);i.classGroupId=r;return}if(typeof n=="function"){if(cS(n)){Sc(n(a),s,r,a);return}s.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([i,o])=>{Sc(o,jm(s,i),r,a)})})},jm=(t,s)=>{let r=t;return s.split(jd).forEach(a=>{r.nextPart.has(a)||r.nextPart.set(a,{nextPart:new Map,validators:[]}),r=r.nextPart.get(a)}),r},cS=t=>t.isThemeGetter,dS=(t,s)=>s?t.map(([r,a])=>{const n=a.map(i=>typeof i=="string"?s+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,l])=>[s+o,l])):i);return[r,n]}):t,uS=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,r=new Map,a=new Map;const n=(i,o)=>{r.set(i,o),s++,s>t&&(s=0,a=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=a.get(i))!==void 0)return n(i,o),o},set(i,o){r.has(i)?r.set(i,o):n(i,o)}}},oy="!",mS=t=>{const{separator:s,experimentalParseClassName:r}=t,a=s.length===1,n=s[0],i=s.length,o=l=>{const u=[];let d=0,c=0,f;for(let A=0;A<l.length;A++){let g=l[A];if(d===0){if(g===n&&(a||l.slice(A,A+i)===s)){u.push(l.slice(c,A)),c=A+i;continue}if(g==="/"){f=A;continue}}g==="["?d++:g==="]"&&d--}const m=u.length===0?l:l.substring(c),y=m.startsWith(oy),x=y?m.substring(1):m,p=f&&f>c?f-c:void 0;return{modifiers:u,hasImportantModifier:y,baseClassName:x,maybePostfixModifierPosition:p}};return r?l=>r({className:l,parseClassName:o}):o},hS=t=>{if(t.length<=1)return t;const s=[];let r=[];return t.forEach(a=>{a[0]==="["?(s.push(...r.sort(),a),r=[]):r.push(a)}),s.push(...r.sort()),s},fS=t=>({cache:uS(t.cacheSize),parseClassName:mS(t),...iS(t)}),pS=/\s+/,xS=(t,s)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:n}=s,i=[],o=t.trim().split(pS);let l="";for(let u=o.length-1;u>=0;u-=1){const d=o[u],{modifiers:c,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:y}=r(d);let x=!!y,p=a(x?m.substring(0,y):m);if(!p){if(!x){l=d+(l.length>0?" "+l:l);continue}if(p=a(m),!p){l=d+(l.length>0?" "+l:l);continue}x=!1}const A=hS(c).join(":"),g=f?A+oy:A,N=g+p;if(i.includes(N))continue;i.push(N);const w=n(p,x);for(let _=0;_<w.length;++_){const b=w[_];i.push(g+b)}l=d+(l.length>0?" "+l:l)}return l};function gS(){let t=0,s,r,a="";for(;t<arguments.length;)(s=arguments[t++])&&(r=ly(s))&&(a&&(a+=" "),a+=r);return a}const ly=t=>{if(typeof t=="string")return t;let s,r="";for(let a=0;a<t.length;a++)t[a]&&(s=ly(t[a]))&&(r&&(r+=" "),r+=s);return r};function yS(t,...s){let r,a,n,i=o;function o(u){const d=s.reduce((c,f)=>f(c),t());return r=fS(d),a=r.cache.get,n=r.cache.set,i=l,l(u)}function l(u){const d=a(u);if(d)return d;const c=xS(u,r);return n(u,c),c}return function(){return i(gS.apply(null,arguments))}}const It=t=>{const s=r=>r[t]||[];return s.isThemeGetter=!0,s},cy=/^\[(?:([a-z-]+):)?(.+)\]$/i,vS=/^\d+\/\d+$/,bS=new Set(["px","full","screen"]),jS=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,NS=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,wS=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,kS=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,SS=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Vr=t=>vn(t)||bS.has(t)||vS.test(t),oa=t=>zn(t,"length",MS),vn=t=>!!t&&!Number.isNaN(Number(t)),Wl=t=>zn(t,"number",vn),Hn=t=>!!t&&Number.isInteger(Number(t)),TS=t=>t.endsWith("%")&&vn(t.slice(0,-1)),rt=t=>cy.test(t),la=t=>jS.test(t),AS=new Set(["length","size","percentage"]),CS=t=>zn(t,AS,dy),PS=t=>zn(t,"position",dy),_S=new Set(["image","url"]),ES=t=>zn(t,_S,IS),DS=t=>zn(t,"",RS),Gn=()=>!0,zn=(t,s,r)=>{const a=cy.exec(t);return a?a[1]?typeof s=="string"?a[1]===s:s.has(a[1]):r(a[2]):!1},MS=t=>NS.test(t)&&!wS.test(t),dy=()=>!1,RS=t=>kS.test(t),IS=t=>SS.test(t),FS=()=>{const t=It("colors"),s=It("spacing"),r=It("blur"),a=It("brightness"),n=It("borderColor"),i=It("borderRadius"),o=It("borderSpacing"),l=It("borderWidth"),u=It("contrast"),d=It("grayscale"),c=It("hueRotate"),f=It("invert"),m=It("gap"),y=It("gradientColorStops"),x=It("gradientColorStopPositions"),p=It("inset"),A=It("margin"),g=It("opacity"),N=It("padding"),w=It("saturate"),_=It("scale"),b=It("sepia"),k=It("skew"),R=It("space"),I=It("translate"),E=()=>["auto","contain","none"],O=()=>["auto","hidden","clip","visible","scroll"],T=()=>["auto",rt,s],S=()=>[rt,s],M=()=>["",Vr,oa],v=()=>["auto",vn,rt],W=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],j=()=>["solid","dashed","dotted","double","none"],V=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ne=()=>["start","end","center","between","around","evenly","stretch"],F=()=>["","0",rt],ye=()=>["auto","avoid","all","avoid-page","page","left","right","column"],fe=()=>[vn,rt];return{cacheSize:500,separator:":",theme:{colors:[Gn],spacing:[Vr,oa],blur:["none","",la,rt],brightness:fe(),borderColor:[t],borderRadius:["none","","full",la,rt],borderSpacing:S(),borderWidth:M(),contrast:fe(),grayscale:F(),hueRotate:fe(),invert:F(),gap:S(),gradientColorStops:[t],gradientColorStopPositions:[TS,oa],inset:T(),margin:T(),opacity:fe(),padding:S(),saturate:fe(),scale:fe(),sepia:F(),skew:fe(),space:S(),translate:S()},classGroups:{aspect:[{aspect:["auto","square","video",rt]}],container:["container"],columns:[{columns:[la]}],"break-after":[{"break-after":ye()}],"break-before":[{"break-before":ye()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...W(),rt]}],overflow:[{overflow:O()}],"overflow-x":[{"overflow-x":O()}],"overflow-y":[{"overflow-y":O()}],overscroll:[{overscroll:E()}],"overscroll-x":[{"overscroll-x":E()}],"overscroll-y":[{"overscroll-y":E()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[p]}],"inset-x":[{"inset-x":[p]}],"inset-y":[{"inset-y":[p]}],start:[{start:[p]}],end:[{end:[p]}],top:[{top:[p]}],right:[{right:[p]}],bottom:[{bottom:[p]}],left:[{left:[p]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Hn,rt]}],basis:[{basis:T()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",rt]}],grow:[{grow:F()}],shrink:[{shrink:F()}],order:[{order:["first","last","none",Hn,rt]}],"grid-cols":[{"grid-cols":[Gn]}],"col-start-end":[{col:["auto",{span:["full",Hn,rt]},rt]}],"col-start":[{"col-start":v()}],"col-end":[{"col-end":v()}],"grid-rows":[{"grid-rows":[Gn]}],"row-start-end":[{row:["auto",{span:[Hn,rt]},rt]}],"row-start":[{"row-start":v()}],"row-end":[{"row-end":v()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",rt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",rt]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal",...ne()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ne(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ne(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[N]}],px:[{px:[N]}],py:[{py:[N]}],ps:[{ps:[N]}],pe:[{pe:[N]}],pt:[{pt:[N]}],pr:[{pr:[N]}],pb:[{pb:[N]}],pl:[{pl:[N]}],m:[{m:[A]}],mx:[{mx:[A]}],my:[{my:[A]}],ms:[{ms:[A]}],me:[{me:[A]}],mt:[{mt:[A]}],mr:[{mr:[A]}],mb:[{mb:[A]}],ml:[{ml:[A]}],"space-x":[{"space-x":[R]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[R]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",rt,s]}],"min-w":[{"min-w":[rt,s,"min","max","fit"]}],"max-w":[{"max-w":[rt,s,"none","full","min","max","fit","prose",{screen:[la]},la]}],h:[{h:[rt,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[rt,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[rt,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[rt,s,"auto","min","max","fit"]}],"font-size":[{text:["base",la,oa]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Wl]}],"font-family":[{font:[Gn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",rt]}],"line-clamp":[{"line-clamp":["none",vn,Wl]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Vr,rt]}],"list-image":[{"list-image":["none",rt]}],"list-style-type":[{list:["none","disc","decimal",rt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...j(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Vr,oa]}],"underline-offset":[{"underline-offset":["auto",Vr,rt]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",rt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",rt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...W(),PS]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",CS]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},ES]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[y]}],"gradient-via":[{via:[y]}],"gradient-to":[{to:[y]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:[...j(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:j()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...j()]}],"outline-offset":[{"outline-offset":[Vr,rt]}],"outline-w":[{outline:[Vr,oa]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:M()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[Vr,oa]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",la,DS]}],"shadow-color":[{shadow:[Gn]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":[...V(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":V()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[a]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",la,rt]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[f]}],saturate:[{saturate:[w]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",rt]}],duration:[{duration:fe()}],ease:[{ease:["linear","in","out","in-out",rt]}],delay:[{delay:fe()}],animate:[{animate:["none","spin","ping","pulse","bounce",rt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[_]}],"scale-x":[{"scale-x":[_]}],"scale-y":[{"scale-y":[_]}],rotate:[{rotate:[Hn,rt]}],"translate-x":[{"translate-x":[I]}],"translate-y":[{"translate-y":[I]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",rt]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",rt]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",rt]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Vr,oa,Wl]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},OS=yS(FS);function he(...t){return OS(Z0(t))}const Me=t=>{if(t==null)return"0 ر.ي";let s;if(typeof t=="string"){if(t.match(/^(\d{1,3})\1{2,}$/))return"0 ر.ي";const r=t.replace(/[^\d.-]/g,"");s=parseFloat(r)}else s=t;return isNaN(s)||!isFinite(s)?"0 ر.ي":Math.abs(s)>1e11?(console.warn("⚠️ قيمة مالية غير منطقية:",s),"0 ر.ي"):`${s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})} ر.ي`},zr=t=>{if(t==null)return 0;if(typeof t=="number")return isNaN(t)||!isFinite(t)||Math.abs(t)>1e11?0:t;if(typeof t=="string"){if(t.match(/^(\d{1,3})\1{2,}$/)||t.match(/^(\d)\1{5,}$/))return 0;const s=t.replace(/[^\d.-]/g,""),r=parseFloat(s);return isNaN(r)||!isFinite(r)||Math.abs(r)>1e11?0:r}return 0},Sr=t=>{const s=typeof t=="string"?new Date(t):t;return isNaN(s.getTime())?"تاريخ غير صالح":new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"}).format(s)};function Gs(){return new Date().toISOString().split("T")[0]}const $S=tk,uy=h.forwardRef(({className:t,...s},r)=>e.jsx(P0,{ref:r,className:he("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s}));uy.displayName=P0.displayName;const LS=Ln("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),my=h.forwardRef(({className:t,variant:s,...r},a)=>e.jsx(_0,{ref:a,className:he(LS({variant:s}),t),...r}));my.displayName=_0.displayName;const VS=h.forwardRef(({className:t,...s},r)=>e.jsx(E0,{ref:r,className:he("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}));VS.displayName=E0.displayName;const hy=h.forwardRef(({className:t,...s},r)=>e.jsx(D0,{ref:r,className:he("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(yr,{className:"h-4 w-4"})}));hy.displayName=D0.displayName;const fy=h.forwardRef(({className:t,...s},r)=>e.jsx(M0,{ref:r,className:he("text-sm font-semibold",t),...s}));fy.displayName=M0.displayName;const py=h.forwardRef(({className:t,...s},r)=>e.jsx(R0,{ref:r,className:he("text-sm opacity-90",t),...s}));py.displayName=R0.displayName;function zS(){const{toasts:t}=Ct();return e.jsxs($S,{children:[t.map(function({id:s,title:r,description:a,action:n,...i}){return e.jsxs(my,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(fy,{children:r}),a&&e.jsx(py,{children:a})]}),n,e.jsx(hy,{})]},s)}),e.jsx(uy,{})]})}var BS="DismissableLayer",Tc="dismissableLayer.update",qS="dismissableLayer.pointerDownOutside",US="dismissableLayer.focusOutside",Nm,xy=h.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gy=h.forwardRef((t,s)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:a,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:l,...u}=t,d=h.useContext(xy),[c,f]=h.useState(null),m=c?.ownerDocument??globalThis?.document,[,y]=h.useState({}),x=lt(s,R=>f(R)),p=Array.from(d.layers),[A]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),g=p.indexOf(A),N=c?p.indexOf(c):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,_=N>=g,b=HS(R=>{const I=R.target,E=[...d.branches].some(O=>O.contains(I));!_||E||(n?.(R),o?.(R),R.defaultPrevented||l?.())},m),k=GS(R=>{const I=R.target;[...d.branches].some(O=>O.contains(I))||(i?.(R),o?.(R),R.defaultPrevented||l?.())},m);return rl(R=>{N===d.layers.size-1&&(a?.(R),!R.defaultPrevented&&l&&(R.preventDefault(),l()))},m),h.useEffect(()=>{if(c)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(Nm=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(c)),d.layers.add(c),wm(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=Nm)}},[c,m,r,d]),h.useEffect(()=>()=>{c&&(d.layers.delete(c),d.layersWithOutsidePointerEventsDisabled.delete(c),wm())},[c,d]),h.useEffect(()=>{const R=()=>y({});return document.addEventListener(Tc,R),()=>document.removeEventListener(Tc,R)},[]),e.jsx(We.div,{...u,ref:x,style:{pointerEvents:w?_?"auto":"none":void 0,...t.style},onFocusCapture:Ne(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ne(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ne(t.onPointerDownCapture,b.onPointerDownCapture)})});gy.displayName=BS;var WS="DismissableLayerBranch",KS=h.forwardRef((t,s)=>{const r=h.useContext(xy),a=h.useRef(null),n=lt(s,a);return h.useEffect(()=>{const i=a.current;if(i)return r.branches.add(i),()=>{r.branches.delete(i)}},[r.branches]),e.jsx(We.div,{...t,ref:n})});KS.displayName=WS;function HS(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1),n=h.useRef(()=>{});return h.useEffect(()=>{const i=l=>{if(l.target&&!a.current){let u=function(){yy(qS,r,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(s.removeEventListener("click",n.current),n.current=u,s.addEventListener("click",n.current,{once:!0})):u()}else s.removeEventListener("click",n.current);a.current=!1},o=window.setTimeout(()=>{s.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),s.removeEventListener("pointerdown",i),s.removeEventListener("click",n.current)}},[s,r]),{onPointerDownCapture:()=>a.current=!0}}function GS(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1);return h.useEffect(()=>{const n=i=>{i.target&&!a.current&&yy(US,r,{originalEvent:i},{discrete:!1})};return s.addEventListener("focusin",n),()=>s.removeEventListener("focusin",n)},[s,r]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function wm(){const t=new CustomEvent(Tc);document.dispatchEvent(t)}function yy(t,s,r,{discrete:a}){const n=r.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});s&&n.addEventListener(t,s,{once:!0}),a?Vi(n,i):n.dispatchEvent(i)}var[ml]=Hs("Tooltip",[$n]),Nd=$n(),vy="TooltipProvider",QS=700,km="tooltip.open",[XS,by]=ml(vy),jy=t=>{const{__scopeTooltip:s,delayDuration:r=QS,skipDelayDuration:a=300,disableHoverableContent:n=!1,children:i}=t,o=h.useRef(!0),l=h.useRef(!1),u=h.useRef(0);return h.useEffect(()=>{const d=u.current;return()=>window.clearTimeout(d)},[]),e.jsx(XS,{scope:s,isOpenDelayedRef:o,delayDuration:r,onOpen:h.useCallback(()=>{window.clearTimeout(u.current),o.current=!1},[]),onClose:h.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>o.current=!0,a)},[a]),isPointerInTransitRef:l,onPointerInTransitChange:h.useCallback(d=>{l.current=d},[]),disableHoverableContent:n,children:i})};jy.displayName=vy;var Ny="Tooltip",[qF,hl]=ml(Ny),Ac="TooltipTrigger",ZS=h.forwardRef((t,s)=>{const{__scopeTooltip:r,...a}=t,n=hl(Ac,r),i=by(Ac,r),o=Nd(r),l=h.useRef(null),u=lt(s,l,n.onTriggerChange),d=h.useRef(!1),c=h.useRef(!1),f=h.useCallback(()=>d.current=!1,[]);return h.useEffect(()=>()=>document.removeEventListener("pointerup",f),[f]),e.jsx(al,{asChild:!0,...o,children:e.jsx(We.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...a,ref:u,onPointerMove:Ne(t.onPointerMove,m=>{m.pointerType!=="touch"&&!c.current&&!i.isPointerInTransitRef.current&&(n.onTriggerEnter(),c.current=!0)}),onPointerLeave:Ne(t.onPointerLeave,()=>{n.onTriggerLeave(),c.current=!1}),onPointerDown:Ne(t.onPointerDown,()=>{n.open&&n.onClose(),d.current=!0,document.addEventListener("pointerup",f,{once:!0})}),onFocus:Ne(t.onFocus,()=>{d.current||n.onOpen()}),onBlur:Ne(t.onBlur,n.onClose),onClick:Ne(t.onClick,n.onClose)})})});ZS.displayName=Ac;var YS="TooltipPortal",[UF,JS]=ml(YS,{forceMount:void 0}),Cn="TooltipContent",wy=h.forwardRef((t,s)=>{const r=JS(Cn,t.__scopeTooltip),{forceMount:a=r.forceMount,side:n="top",...i}=t,o=hl(Cn,t.__scopeTooltip);return e.jsx(ws,{present:a||o.open,children:o.disableHoverableContent?e.jsx(ky,{side:n,...i,ref:s}):e.jsx(eT,{side:n,...i,ref:s})})}),eT=h.forwardRef((t,s)=>{const r=hl(Cn,t.__scopeTooltip),a=by(Cn,t.__scopeTooltip),n=h.useRef(null),i=lt(s,n),[o,l]=h.useState(null),{trigger:u,onClose:d}=r,c=n.current,{onPointerInTransitChange:f}=a,m=h.useCallback(()=>{l(null),f(!1)},[f]),y=h.useCallback((x,p)=>{const A=x.currentTarget,g={x:x.clientX,y:x.clientY},N=nT(g,A.getBoundingClientRect()),w=iT(g,N),_=oT(p.getBoundingClientRect()),b=cT([...w,..._]);l(b),f(!0)},[f]);return h.useEffect(()=>()=>m(),[m]),h.useEffect(()=>{if(u&&c){const x=A=>y(A,c),p=A=>y(A,u);return u.addEventListener("pointerleave",x),c.addEventListener("pointerleave",p),()=>{u.removeEventListener("pointerleave",x),c.removeEventListener("pointerleave",p)}}},[u,c,y,m]),h.useEffect(()=>{if(o){const x=p=>{const A=p.target,g={x:p.clientX,y:p.clientY},N=u?.contains(A)||c?.contains(A),w=!lT(g,o);N?m():w&&(m(),d())};return document.addEventListener("pointermove",x),()=>document.removeEventListener("pointermove",x)}},[u,c,o,d,m]),e.jsx(ky,{...t,ref:i})}),[tT,sT]=ml(Ny,{isInside:!1}),rT=I0("TooltipContent"),ky=h.forwardRef((t,s)=>{const{__scopeTooltip:r,children:a,"aria-label":n,onEscapeKeyDown:i,onPointerDownOutside:o,...l}=t,u=hl(Cn,r),d=Nd(r),{onClose:c}=u;return h.useEffect(()=>(document.addEventListener(km,c),()=>document.removeEventListener(km,c)),[c]),h.useEffect(()=>{if(u.trigger){const f=m=>{m.target?.contains(u.trigger)&&c()};return window.addEventListener("scroll",f,{capture:!0}),()=>window.removeEventListener("scroll",f,{capture:!0})}},[u.trigger,c]),e.jsx(gy,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:f=>f.preventDefault(),onDismiss:c,children:e.jsxs(od,{"data-state":u.stateAttribute,...d,...l,ref:s,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(rT,{children:a}),e.jsx(tT,{scope:r,isInside:!0,children:e.jsx(sk,{id:u.contentId,role:"tooltip",children:n||a})})]})})});wy.displayName=Cn;var Sy="TooltipArrow",aT=h.forwardRef((t,s)=>{const{__scopeTooltip:r,...a}=t,n=Nd(r);return sT(Sy,r).isInside?null:e.jsx(ld,{...n,...a,ref:s})});aT.displayName=Sy;function nT(t,s){const r=Math.abs(s.top-t.y),a=Math.abs(s.bottom-t.y),n=Math.abs(s.right-t.x),i=Math.abs(s.left-t.x);switch(Math.min(r,a,n,i)){case i:return"left";case n:return"right";case r:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function iT(t,s,r=5){const a=[];switch(s){case"top":a.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":a.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":a.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":a.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return a}function oT(t){const{top:s,right:r,bottom:a,left:n}=t;return[{x:n,y:s},{x:r,y:s},{x:r,y:a},{x:n,y:a}]}function lT(t,s){const{x:r,y:a}=t;let n=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const l=s[i].x,u=s[i].y,d=s[o].x,c=s[o].y;u>a!=c>a&&r<(d-l)*(a-u)/(c-u)+l&&(n=!n)}return n}function cT(t){const s=t.slice();return s.sort((r,a)=>r.x<a.x?-1:r.x>a.x?1:r.y<a.y?-1:r.y>a.y?1:0),dT(s)}function dT(t){if(t.length<=1)return t.slice();const s=[];for(let a=0;a<t.length;a++){const n=t[a];for(;s.length>=2;){const i=s[s.length-1],o=s[s.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))s.pop();else break}s.push(n)}s.pop();const r=[];for(let a=t.length-1;a>=0;a--){const n=t[a];for(;r.length>=2;){const i=r[r.length-1],o=r[r.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))r.pop();else break}r.push(n)}return r.pop(),s.length===1&&r.length===1&&s[0].x===r[0].x&&s[0].y===r[0].y?s:s.concat(r)}var uT=jy,Ty=wy;const mT=uT,hT=h.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(Ty,{ref:a,sideOffset:s,className:he("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...r}));hT.displayName=Ty.displayName;const q=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:he("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));q.displayName="Card";const ue=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:he("flex flex-col space-y-1.5 p-6",t),...s}));ue.displayName="CardHeader";const pe=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:he("text-2xl font-semibold leading-none tracking-tight",t),...s}));pe.displayName="CardTitle";const js=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:he("text-sm text-muted-foreground",t),...s}));js.displayName="CardDescription";const H=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:he("p-6 pt-0",t),...s}));H.displayName="CardContent";const fT=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:he("flex items-center p-6 pt-0",t),...s}));fT.displayName="CardFooter";function pT(){return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:e.jsx(q,{className:"w-full max-w-md mx-4",children:e.jsxs(H,{className:"pt-6",children:[e.jsxs("div",{className:"flex mb-4 gap-2",children:[e.jsx(Wt,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const wd=Ln("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),$=h.forwardRef(({className:t,variant:s,size:r,asChild:a=!1,...n},i)=>{const o=a?F0:"button";return e.jsx(o,{className:he(wd({variant:s,size:r,className:t})),ref:i,...n})});$.displayName="Button";const xT=Ln("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function le({className:t,variant:s,...r}){return e.jsx("div",{className:he(xT({variant:s}),t),...r})}const qs=L0,kd=V0,gT=O0,Ay=h.forwardRef(({className:t,...s},r)=>e.jsx(nl,{ref:r,className:he("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));Ay.displayName=nl.displayName;const Fs=h.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(gT,{children:[e.jsx(Ay,{}),e.jsxs(il,{ref:a,className:he("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[s,e.jsxs($0,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(yr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Fs.displayName=il.displayName;const Us=({className:t,...s})=>e.jsx("div",{className:he("flex flex-col space-y-1.5 text-center sm:text-right",t),...s});Us.displayName="DialogHeader";const Cc=({className:t,...s})=>e.jsx("div",{className:he("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Cc.displayName="DialogFooter";const Ws=h.forwardRef(({className:t,...s},r)=>e.jsx(ol,{ref:r,className:he("text-lg font-semibold leading-none tracking-tight",t),...s}));Ws.displayName=ol.displayName;const Ys=h.forwardRef(({className:t,...s},r)=>e.jsx(ll,{ref:r,className:he("text-sm text-muted-foreground",t),...s}));Ys.displayName=ll.displayName;const be=h.forwardRef(({className:t,type:s,...r},a)=>e.jsx("input",{type:s,className:he("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r}));be.displayName="Input";var yT="Label",Cy=h.forwardRef((t,s)=>e.jsx(We.label,{...t,ref:s,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Cy.displayName=yT;var Py=Cy;const vT=Ln("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),se=h.forwardRef(({className:t,...s},r)=>e.jsx(Py,{ref:r,className:he(vT(),t),...s}));se.displayName=Py.displayName;const qe=lk,Ue=ck,Oe=h.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(z0,{ref:a,className:he("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[s,e.jsx(rk,{asChild:!0,children:e.jsx(Vn,{className:"h-4 w-4 opacity-50"})})]}));Oe.displayName=z0.displayName;const _y=h.forwardRef(({className:t,...s},r)=>e.jsx(B0,{ref:r,className:he("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(qi,{className:"h-4 w-4"})}));_y.displayName=B0.displayName;const Ey=h.forwardRef(({className:t,...s},r)=>e.jsx(q0,{ref:r,className:he("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Vn,{className:"h-4 w-4"})}));Ey.displayName=q0.displayName;const $e=h.forwardRef(({className:t,children:s,position:r="popper",...a},n)=>e.jsx(ak,{children:e.jsxs(U0,{ref:n,className:he("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...a,children:[e.jsx(_y,{}),e.jsx(nk,{className:he("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(Ey,{})]})}));$e.displayName=U0.displayName;const bT=h.forwardRef(({className:t,...s},r)=>e.jsx(W0,{ref:r,className:he("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));bT.displayName=W0.displayName;const K=h.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(K0,{ref:a,className:he("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ik,{children:e.jsx(gd,{className:"h-4 w-4"})})}),e.jsx(ok,{children:s})]}));K.displayName=K0.displayName;const jT=h.forwardRef(({className:t,...s},r)=>e.jsx(H0,{ref:r,className:he("-mx-1 my-1 h-px bg-muted",t),...s}));jT.displayName=H0.displayName;const NT={blue:{border:"border-l-blue-500",text:"text-blue-600",bg:"bg-blue-50 dark:bg-blue-900/20",iconBg:"bg-blue-100 dark:bg-blue-900/30",iconColor:"text-blue-600 dark:text-blue-400"},green:{border:"border-l-green-500",text:"text-green-600",bg:"bg-green-50 dark:bg-green-900/20",iconBg:"bg-green-100 dark:bg-green-900/30",iconColor:"text-green-600 dark:text-green-400"},orange:{border:"border-l-orange-500",text:"text-orange-600",bg:"bg-orange-50 dark:bg-orange-900/20",iconBg:"bg-orange-100 dark:bg-orange-900/30",iconColor:"text-orange-600 dark:text-orange-400"},red:{border:"border-l-red-500",text:"text-red-600",bg:"bg-red-50 dark:bg-red-900/20",iconBg:"bg-red-100 dark:bg-red-900/30",iconColor:"text-red-600 dark:text-red-400"},purple:{border:"border-l-purple-500",text:"text-purple-600",bg:"bg-purple-50 dark:bg-purple-900/20",iconBg:"bg-purple-100 dark:bg-purple-900/30",iconColor:"text-purple-600 dark:text-purple-400"},teal:{border:"border-l-teal-500",text:"text-teal-600",bg:"bg-teal-50 dark:bg-teal-900/20",iconBg:"bg-teal-100 dark:bg-teal-900/30",iconColor:"text-teal-600 dark:text-teal-400"},indigo:{border:"border-l-indigo-500",text:"text-indigo-600",bg:"bg-indigo-50 dark:bg-indigo-900/20",iconBg:"bg-indigo-100 dark:bg-indigo-900/30",iconColor:"text-indigo-600 dark:text-indigo-400"},emerald:{border:"border-l-emerald-500",text:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-900/20",iconBg:"bg-emerald-100 dark:bg-emerald-900/30",iconColor:"text-emerald-600 dark:text-emerald-400"},amber:{border:"border-l-amber-500",text:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-900/20",iconBg:"bg-amber-100 dark:bg-amber-900/30",iconColor:"text-amber-600 dark:text-amber-400"},gray:{border:"border-l-gray-500",text:"text-gray-600",bg:"bg-gray-50 dark:bg-gray-900/20",iconBg:"bg-gray-100 dark:bg-gray-900/30",iconColor:"text-gray-600 dark:text-gray-400"}};function et({title:t,value:s,icon:r,color:a="blue",formatter:n,className:i="","data-testid":o}){const l=NT[a],d=(()=>{if(typeof s=="number"){if(isNaN(s)||!isFinite(s))return"0";if(Math.abs(s)>1e11)return console.warn("⚠️ [StatsCard] قيمة رقمية غير منطقية:",s),"0";const x=Math.max(0,s);return n?n(x):x.toLocaleString("en-US")}const c=s.toString().trim();if(c.match(/^(\d{1,3})\1{2,}$/))return console.warn("⚠️ [StatsCard] نمط متكرر مشبوه:",c),"0";if(c.match(/^(\d)\1{5,}$/))return console.warn("⚠️ [StatsCard] تكرار رقم واحد:",c),"0";if(c.length>12&&c.match(/^\d+$/))return console.warn("⚠️ [StatsCard] رقم طويل غير منطقي:",c),"0";const f=[/^(\d{2,3})\1{3,}$/,/^0+[1-9]0*\1+$/,/^(123|234|345|456|567|678|789|012|098|987|876|765|654|543|432|321){3,}$/];for(const x of f)if(x.test(c))return console.warn("⚠️ [StatsCard] نمط مشبوه آخر:",c),"0";const m=c.replace(/[^\d.-]/g,"");if(!m||m===""||m==="-")return"0";const y=parseFloat(m);if(!isNaN(y)&&isFinite(y)){if(Math.abs(y)>1e11)return console.warn("⚠️ [StatsCard] قيمة محولة غير منطقية:",y),"0";const x=Math.max(0,y);return Number.isInteger(x)&&x>1e6&&t.includes("عامل")?(console.warn("⚠️ [StatsCard] عدد عمال غير منطقي:",x),"0"):x.toLocaleString("en-US")}return"0"})();return e.jsx(q,{className:`${l.border} ${l.bg} border-l-4 hover:shadow-md transition-shadow duration-200`,children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:t}),e.jsx("p",{className:`text-lg font-bold ${l.text}`,children:d})]}),e.jsx("div",{className:`h-10 w-10 ${l.iconBg} rounded-full flex items-center justify-center`,children:e.jsx(r,{className:`h-5 w-5 ${l.iconColor}`})})]})})})}function Sd({children:t,className:s=""}){return e.jsx("div",{className:`grid grid-cols-2 lg:grid-cols-4 gap-3 ${s}`,children:t})}const Qn="construction-app-selected-project",oo="construction-app-selected-project-name";function _a(){const[t,s]=h.useState(""),[r,a]=h.useState(""),[n,i]=h.useState(!0),[o,l]=h.useState([]);h.useEffect(()=>{try{const f=localStorage.getItem(Qn),m=localStorage.getItem(oo);f&&f!=="undefined"&&f!=="null"&&(s(f),m&&a(m))}catch{localStorage.removeItem(Qn),localStorage.removeItem(oo)}finally{i(!1)}},[]);const u=h.useCallback((f,m)=>{s(f),m&&a(m);try{f&&f!=="undefined"&&f!=="null"?(localStorage.setItem(Qn,f),m&&localStorage.setItem(oo,m)):(localStorage.removeItem(Qn),localStorage.removeItem(oo),a(""))}catch{}},[]),d=h.useCallback(()=>{u("","")},[u]),c=h.useCallback(()=>{try{const f=localStorage.getItem(Qn);return f&&f!=="undefined"&&f!=="null"}catch{return!1}},[]);return{selectedProjectId:t,selectedProjectName:r,isLoading:n,selectProject:u,clearProject:d,hasStoredProject:c,projects:o}}function Ea({selectedProjectId:t,onProjectChange:s,showHeader:r=!0,variant:a="default",className:n=""}){const{data:i=[],isLoading:o,error:l}=ge({queryKey:["/api/projects"],queryFn:async()=>{try{console.log("🔄 [ProjectSelector] جلب قائمة المشاريع...");const c=await ae("/api/projects","GET");console.log("📊 [ProjectSelector] استجابة المشاريع:",c);let f=[];return c&&typeof c=="object"&&(c.success!==void 0&&c.data!==void 0?(f=Array.isArray(c.data)?c.data:[],console.log("✅ [ProjectSelector] استخراج البيانات من data.data")):Array.isArray(c)?(f=c,console.log("✅ [ProjectSelector] استخدام المصفوفة مباشرة")):c.id?(f=[c],console.log("✅ [ProjectSelector] تحويل كائن واحد لمصفوفة")):console.warn("⚠️ [ProjectSelector] هيكل غير متوقع:",c)),Array.isArray(f)||(console.warn("⚠️ [ProjectSelector] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),f=[]),console.log(`✅ [ProjectSelector] تم جلب ${f.length} مشروع بنجاح`),f}catch(c){return console.error("❌ [ProjectSelector] خطأ في جلب المشاريع:",c),[]}},staleTime:3e5,retry:2,refetchOnWindowFocus:!1}),u=Array.isArray(i)?i.find(c=>c.id===t):void 0,d=c=>{const f=Array.isArray(i)?i.find(m=>m.id===c):void 0;s(c,f?.name)};return a==="compact"?e.jsx("div",{className:`space-y-2 ${n}`,children:e.jsxs(qe,{value:t,onValueChange:d,disabled:o,children:[e.jsx(Oe,{className:"w-full h-12 bg-white/90 backdrop-blur-sm border-white/30 text-gray-800 font-medium",children:e.jsx(Ue,{placeholder:"اختر المشروع..."})}),e.jsx($e,{children:Array.isArray(i)?i.map(c=>e.jsx(K,{value:c.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4"}),c.name,e.jsx(le,{variant:"secondary",className:"mr-auto",children:c.status==="active"?"نشط":"مكتمل"})]})},c.id)):null})]})}):a==="premium"?e.jsxs(q,{className:`mb-6 border-0 shadow-2xl bg-gradient-to-br from-white via-blue-50 to-indigo-50 overflow-hidden project-selector-premium project-selector-card transition-all duration-500 ${n}`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-500/10 to-purple-500/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-500/10 to-blue-500/10 rounded-full translate-y-12 -translate-x-12"}),r&&e.jsx(ue,{className:"pb-3 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(zk,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:"اختيار المشروع النشط"}),e.jsx("p",{className:"text-sm text-gray-600",children:"اختر المشروع لعرض التقارير والإحصائيات"})]})]}),e.jsxs(le,{className:"bg-green-100 text-green-700 border-green-200",children:[e.jsx(za,{className:"h-3 w-3 mr-1"}),i.length," مشروع متاح"]})]})}),e.jsx(H,{className:"p-6 pt-2 relative",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(qe,{value:t,onValueChange:d,disabled:o,children:[e.jsx(Oe,{className:"w-full h-14 bg-white border-2 border-gray-200 hover:border-blue-400 transition-all duration-300 text-gray-800 font-medium rounded-xl shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx(Cs,{className:"h-5 w-5 text-blue-600"}),e.jsx(Ue,{placeholder:"اختر المشروع..."})]})}),e.jsx($e,{className:"bg-white border-2 border-gray-200 shadow-2xl rounded-xl",children:Array.isArray(i)?i.map(c=>e.jsx(K,{value:c.id,className:"py-3 px-4 hover:bg-blue-50 transition-colors duration-200 project-option",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:e.jsx(Cs,{className:"h-4 w-4 text-blue-600"})}),e.jsx("span",{className:"font-medium text-gray-800",children:c.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.status==="active"?e.jsxs(le,{className:"bg-green-100 text-green-700 border-green-200",children:[e.jsx(za,{className:"h-3 w-3 mr-1"}),"نشط"]}):e.jsxs(le,{variant:"secondary",children:[e.jsx(Ut,{className:"h-3 w-3 mr-1"}),"مكتمل"]}),t===c.id&&e.jsx(xm,{className:"h-4 w-4 text-yellow-500 fill-yellow-500"})]})]})},c.id)):null})]}),u&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(xm,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"المشروع المحدد:"}),e.jsx("p",{className:"font-bold text-blue-900",children:u.name})]}),e.jsx("div",{className:"mr-auto",children:e.jsx(le,{className:"bg-blue-500 text-white",children:u.status==="active"?"مشروع نشط":"مشروع مكتمل"})})]})})]})})]}):e.jsx(q,{className:`mb-4 ${n}`,children:e.jsxs(H,{className:"p-4",children:[r&&e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Bi,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsxs(qe,{value:t,onValueChange:d,disabled:o,children:[e.jsx(Oe,{className:"w-full",children:e.jsx(Ue,{placeholder:"اختر المشروع..."})}),e.jsx($e,{children:Array.isArray(i)?i.map(c=>e.jsx(K,{value:c.id,children:c.name},c.id)):null})]})]})})}function wT(t){if(typeof Proxy>"u")return t;const s=new Map,r=(...a)=>t(...a);return new Proxy(r,{get:(a,n)=>n==="create"?t:(s.has(n)||s.set(n,t(n)),s.get(n))})}function fl(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const Pc=t=>Array.isArray(t);function Dy(t,s){if(!Array.isArray(s))return!1;const r=s.length;if(r!==t.length)return!1;for(let a=0;a<r;a++)if(s[a]!==t[a])return!1;return!0}function yi(t){return typeof t=="string"||Array.isArray(t)}function Sm(t){const s=[{},{}];return t?.values.forEach((r,a)=>{s[0][a]=r.get(),s[1][a]=r.getVelocity()}),s}function Td(t,s,r,a){if(typeof s=="function"){const[n,i]=Sm(a);s=s(r!==void 0?r:t.custom,n,i)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[n,i]=Sm(a);s=s(r!==void 0?r:t.custom,n,i)}return s}function pl(t,s,r){const a=t.getProps();return Td(a,s,r!==void 0?r:a.custom,t)}const Ad=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Cd=["initial",...Ad],Wi=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],sn=new Set(Wi),ta=t=>t*1e3,sa=t=>t/1e3,kT={type:"spring",stiffness:500,damping:25,restSpeed:10},ST=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),TT={type:"keyframes",duration:.8},AT={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},CT=(t,{keyframes:s})=>s.length>2?TT:sn.has(t)?t.startsWith("scale")?ST(s[1]):kT:AT;function Pd(t,s){return t?t[s]||t.default||t:void 0}const PT={useManualTiming:!1},_T=t=>t!==null;function xl(t,{repeat:s,repeatType:r="loop"},a){const n=t.filter(_T),i=s&&r!=="loop"&&s%2===1?0:n.length-1;return!i||a===void 0?n[i]:a}const _s=t=>t;let My=_s;function ET(t){let s=new Set,r=new Set,a=!1,n=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(d){i.has(d)&&(u.schedule(d),t()),d(o)}const u={schedule:(d,c=!1,f=!1)=>{const y=f&&a?s:r;return c&&i.add(d),y.has(d)||y.add(d),d},cancel:d=>{r.delete(d),i.delete(d)},process:d=>{if(o=d,a){n=!0;return}a=!0,[s,r]=[r,s],r.clear(),s.forEach(l),a=!1,n&&(n=!1,u.process(d))}};return u}const lo=["read","resolveKeyframes","update","preRender","render","postRender"],DT=40;function Ry(t,s){let r=!1,a=!0;const n={delta:0,timestamp:0,isProcessing:!1},i=()=>r=!0,o=lo.reduce((g,N)=>(g[N]=ET(i),g),{}),{read:l,resolveKeyframes:u,update:d,preRender:c,render:f,postRender:m}=o,y=()=>{const g=performance.now();r=!1,n.delta=a?1e3/60:Math.max(Math.min(g-n.timestamp,DT),1),n.timestamp=g,n.isProcessing=!0,l.process(n),u.process(n),d.process(n),c.process(n),f.process(n),m.process(n),n.isProcessing=!1,r&&s&&(a=!1,t(y))},x=()=>{r=!0,a=!0,n.isProcessing||t(y)};return{schedule:lo.reduce((g,N)=>{const w=o[N];return g[N]=(_,b=!1,k=!1)=>(r||x(),w.schedule(_,b,k)),g},{}),cancel:g=>{for(let N=0;N<lo.length;N++)o[lo[N]].cancel(g)},state:n,steps:o}}const{schedule:Et,cancel:wa,state:vs,steps:Kl}=Ry(typeof requestAnimationFrame<"u"?requestAnimationFrame:_s,!0),Iy=(t,s,r)=>(((1-3*r+3*s)*t+(3*r-6*s))*t+3*s)*t,MT=1e-7,RT=12;function IT(t,s,r,a,n){let i,o,l=0;do o=s+(r-s)/2,i=Iy(o,a,n)-t,i>0?r=o:s=o;while(Math.abs(i)>MT&&++l<RT);return o}function Ki(t,s,r,a){if(t===s&&r===a)return _s;const n=i=>IT(i,0,1,t,r);return i=>i===0||i===1?i:Iy(n(i),s,a)}const Fy=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,Oy=t=>s=>1-t(1-s),$y=Ki(.33,1.53,.69,.99),_d=Oy($y),Ly=Fy(_d),Vy=t=>(t*=2)<1?.5*_d(t):.5*(2-Math.pow(2,-10*(t-1))),Ed=t=>1-Math.sin(Math.acos(t)),zy=Oy(Ed),By=Fy(Ed),qy=t=>/^0[^.\s]+$/u.test(t);function FT(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||qy(t):!0}const Uy=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),Wy=t=>s=>typeof s=="string"&&s.startsWith(t),Ky=Wy("--"),OT=Wy("var(--"),Dd=t=>OT(t)?$T.test(t.split("/*")[0].trim()):!1,$T=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,LT=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function VT(t){const s=LT.exec(t);if(!s)return[,];const[,r,a,n]=s;return[`--${r??a}`,n]}function Hy(t,s,r=1){const[a,n]=VT(t);if(!a)return;const i=window.getComputedStyle(s).getPropertyValue(a);if(i){const o=i.trim();return Uy(o)?parseFloat(o):o}return Dd(n)?Hy(n,s,r+1):n}const aa=(t,s,r)=>r>s?s:r<t?t:r,Bn={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},vi={...Bn,transform:t=>aa(0,1,t)},co={...Bn,default:1},Hi=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),da=Hi("deg"),Er=Hi("%"),ze=Hi("px"),zT=Hi("vh"),BT=Hi("vw"),Tm={...Er,parse:t=>Er.parse(t)/100,transform:t=>Er.transform(t*100)},qT=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Am=t=>t===Bn||t===ze,Cm=(t,s)=>parseFloat(t.split(", ")[s]),Pm=(t,s)=>(r,{transform:a})=>{if(a==="none"||!a)return 0;const n=a.match(/^matrix3d\((.+)\)$/u);if(n)return Cm(n[1],s);{const i=a.match(/^matrix\((.+)\)$/u);return i?Cm(i[1],t):0}},UT=new Set(["x","y","z"]),WT=Wi.filter(t=>!UT.has(t));function KT(t){const s=[];return WT.forEach(r=>{const a=t.getValue(r);a!==void 0&&(s.push([r,a.get()]),a.set(r.startsWith("scale")?1:0))}),s}const Pn={width:({x:t},{paddingLeft:s="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(s)-parseFloat(r),height:({y:t},{paddingTop:s="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(s)-parseFloat(r),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:Pm(4,13),y:Pm(5,14)};Pn.translateX=Pn.x;Pn.translateY=Pn.y;const Gy=t=>s=>s.test(t),HT={test:t=>t==="auto",parse:t=>t},Qy=[Bn,ze,Er,da,BT,zT,HT],_m=t=>Qy.find(Gy(t)),Ua=new Set;let _c=!1,Ec=!1;function Xy(){if(Ec){const t=Array.from(Ua).filter(a=>a.needsMeasurement),s=new Set(t.map(a=>a.element)),r=new Map;s.forEach(a=>{const n=KT(a);n.length&&(r.set(a,n),a.render())}),t.forEach(a=>a.measureInitialState()),s.forEach(a=>{a.render();const n=r.get(a);n&&n.forEach(([i,o])=>{var l;(l=a.getValue(i))===null||l===void 0||l.set(o)})}),t.forEach(a=>a.measureEndState()),t.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}Ec=!1,_c=!1,Ua.forEach(t=>t.complete()),Ua.clear()}function Zy(){Ua.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Ec=!0)})}function GT(){Zy(),Xy()}class Md{constructor(s,r,a,n,i,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...s],this.onComplete=r,this.name=a,this.motionValue=n,this.element=i,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ua.add(this),_c||(_c=!0,Et.read(Zy),Et.resolveKeyframes(Xy))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:r,element:a,motionValue:n}=this;for(let i=0;i<s.length;i++)if(s[i]===null)if(i===0){const o=n?.get(),l=s[s.length-1];if(o!==void 0)s[0]=o;else if(a&&r){const u=a.readValue(r,l);u!=null&&(s[0]=u)}s[0]===void 0&&(s[0]=l),n&&o===void 0&&n.set(s[0])}else s[i]=s[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ua.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ua.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const ci=t=>Math.round(t*1e5)/1e5,Rd=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function QT(t){return t==null}const XT=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Id=(t,s)=>r=>!!(typeof r=="string"&&XT.test(r)&&r.startsWith(t)||s&&!QT(r)&&Object.prototype.hasOwnProperty.call(r,s)),Yy=(t,s,r)=>a=>{if(typeof a!="string")return a;const[n,i,o,l]=a.match(Rd);return{[t]:parseFloat(n),[s]:parseFloat(i),[r]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},ZT=t=>aa(0,255,t),Hl={...Bn,transform:t=>Math.round(ZT(t))},La={test:Id("rgb","red"),parse:Yy("red","green","blue"),transform:({red:t,green:s,blue:r,alpha:a=1})=>"rgba("+Hl.transform(t)+", "+Hl.transform(s)+", "+Hl.transform(r)+", "+ci(vi.transform(a))+")"};function YT(t){let s="",r="",a="",n="";return t.length>5?(s=t.substring(1,3),r=t.substring(3,5),a=t.substring(5,7),n=t.substring(7,9)):(s=t.substring(1,2),r=t.substring(2,3),a=t.substring(3,4),n=t.substring(4,5),s+=s,r+=r,a+=a,n+=n),{red:parseInt(s,16),green:parseInt(r,16),blue:parseInt(a,16),alpha:n?parseInt(n,16)/255:1}}const Dc={test:Id("#"),parse:YT,transform:La.transform},mn={test:Id("hsl","hue"),parse:Yy("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:r,alpha:a=1})=>"hsla("+Math.round(t)+", "+Er.transform(ci(s))+", "+Er.transform(ci(r))+", "+ci(vi.transform(a))+")"},Ts={test:t=>La.test(t)||Dc.test(t)||mn.test(t),parse:t=>La.test(t)?La.parse(t):mn.test(t)?mn.parse(t):Dc.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?La.transform(t):mn.transform(t)},JT=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function eA(t){var s,r;return isNaN(t)&&typeof t=="string"&&(((s=t.match(Rd))===null||s===void 0?void 0:s.length)||0)+(((r=t.match(JT))===null||r===void 0?void 0:r.length)||0)>0}const Jy="number",ev="color",tA="var",sA="var(",Em="${}",rA=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function bi(t){const s=t.toString(),r=[],a={color:[],number:[],var:[]},n=[];let i=0;const l=s.replace(rA,u=>(Ts.test(u)?(a.color.push(i),n.push(ev),r.push(Ts.parse(u))):u.startsWith(sA)?(a.var.push(i),n.push(tA),r.push(u)):(a.number.push(i),n.push(Jy),r.push(parseFloat(u))),++i,Em)).split(Em);return{values:r,split:l,indexes:a,types:n}}function tv(t){return bi(t).values}function sv(t){const{split:s,types:r}=bi(t),a=s.length;return n=>{let i="";for(let o=0;o<a;o++)if(i+=s[o],n[o]!==void 0){const l=r[o];l===Jy?i+=ci(n[o]):l===ev?i+=Ts.transform(n[o]):i+=n[o]}return i}}const aA=t=>typeof t=="number"?0:t;function nA(t){const s=tv(t);return sv(t)(s.map(aA))}const ka={test:eA,parse:tv,createTransformer:sv,getAnimatableNone:nA},iA=new Set(["brightness","contrast","saturate","opacity"]);function oA(t){const[s,r]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[a]=r.match(Rd)||[];if(!a)return t;const n=r.replace(a,"");let i=iA.has(s)?1:0;return a!==r&&(i*=100),s+"("+i+n+")"}const lA=/\b([a-z-]*)\(.*?\)/gu,Mc={...ka,getAnimatableNone:t=>{const s=t.match(lA);return s?s.map(oA).join(" "):t}},cA={borderWidth:ze,borderTopWidth:ze,borderRightWidth:ze,borderBottomWidth:ze,borderLeftWidth:ze,borderRadius:ze,radius:ze,borderTopLeftRadius:ze,borderTopRightRadius:ze,borderBottomRightRadius:ze,borderBottomLeftRadius:ze,width:ze,maxWidth:ze,height:ze,maxHeight:ze,top:ze,right:ze,bottom:ze,left:ze,padding:ze,paddingTop:ze,paddingRight:ze,paddingBottom:ze,paddingLeft:ze,margin:ze,marginTop:ze,marginRight:ze,marginBottom:ze,marginLeft:ze,backgroundPositionX:ze,backgroundPositionY:ze},dA={rotate:da,rotateX:da,rotateY:da,rotateZ:da,scale:co,scaleX:co,scaleY:co,scaleZ:co,skew:da,skewX:da,skewY:da,distance:ze,translateX:ze,translateY:ze,translateZ:ze,x:ze,y:ze,z:ze,perspective:ze,transformPerspective:ze,opacity:vi,originX:Tm,originY:Tm,originZ:ze},Dm={...Bn,transform:Math.round},Fd={...cA,...dA,zIndex:Dm,size:ze,fillOpacity:vi,strokeOpacity:vi,numOctaves:Dm},uA={...Fd,color:Ts,backgroundColor:Ts,outlineColor:Ts,fill:Ts,stroke:Ts,borderColor:Ts,borderTopColor:Ts,borderRightColor:Ts,borderBottomColor:Ts,borderLeftColor:Ts,filter:Mc,WebkitFilter:Mc},Od=t=>uA[t];function rv(t,s){let r=Od(t);return r!==Mc&&(r=ka),r.getAnimatableNone?r.getAnimatableNone(s):void 0}const mA=new Set(["auto","none","0"]);function hA(t,s,r){let a=0,n;for(;a<t.length&&!n;){const i=t[a];typeof i=="string"&&!mA.has(i)&&bi(i).values.length&&(n=t[a]),a++}if(n&&r)for(const i of s)t[i]=rv(r,n)}class av extends Md{constructor(s,r,a,n,i){super(s,r,a,n,i,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:r,name:a}=this;if(!r||!r.current)return;super.readKeyframes();for(let u=0;u<s.length;u++){let d=s[u];if(typeof d=="string"&&(d=d.trim(),Dd(d))){const c=Hy(d,r.current);c!==void 0&&(s[u]=c),u===s.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!qT.has(a)||s.length!==2)return;const[n,i]=s,o=_m(n),l=_m(i);if(o!==l)if(Am(o)&&Am(l))for(let u=0;u<s.length;u++){const d=s[u];typeof d=="string"&&(s[u]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:r}=this,a=[];for(let n=0;n<s.length;n++)FT(s[n])&&a.push(n);a.length&&hA(s,a,r)}measureInitialState(){const{element:s,unresolvedKeyframes:r,name:a}=this;if(!s||!s.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Pn[a](s.measureViewportBox(),window.getComputedStyle(s.current)),r[0]=this.measuredOrigin;const n=r[r.length-1];n!==void 0&&s.getValue(a,n).jump(n,!1)}measureEndState(){var s;const{element:r,name:a,unresolvedKeyframes:n}=this;if(!r||!r.current)return;const i=r.getValue(a);i&&i.jump(this.measuredOrigin,!1);const o=n.length-1,l=n[o];n[o]=Pn[a](r.measureViewportBox(),window.getComputedStyle(r.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),!((s=this.removedTransforms)===null||s===void 0)&&s.length&&this.removedTransforms.forEach(([u,d])=>{r.getValue(u).set(d)}),this.resolveNoneKeyframes()}}function $d(t){return typeof t=="function"}let yo;function fA(){yo=void 0}const Dr={now:()=>(yo===void 0&&Dr.set(vs.isProcessing||PT.useManualTiming?vs.timestamp:performance.now()),yo),set:t=>{yo=t,queueMicrotask(fA)}},Mm=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(ka.test(t)||t==="0")&&!t.startsWith("url("));function pA(t){const s=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==s)return!0}function xA(t,s,r,a){const n=t[0];if(n===null)return!1;if(s==="display"||s==="visibility")return!0;const i=t[t.length-1],o=Mm(n,s),l=Mm(i,s);return!o||!l?!1:pA(t)||(r==="spring"||$d(r))&&a}const gA=40;class nv{constructor({autoplay:s=!0,delay:r=0,type:a="keyframes",repeat:n=0,repeatDelay:i=0,repeatType:o="loop",...l}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Dr.now(),this.options={autoplay:s,delay:r,type:a,repeat:n,repeatDelay:i,repeatType:o,...l},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>gA?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&GT(),this._resolved}onKeyframesResolved(s,r){this.resolvedAt=Dr.now(),this.hasAttemptedResolve=!0;const{name:a,type:n,velocity:i,delay:o,onComplete:l,onUpdate:u,isGenerator:d}=this.options;if(!d&&!xA(s,a,n,i))if(o)this.options.duration=0;else{u?.(xl(s,this.options,r)),l?.(),this.resolveFinishedPromise();return}const c=this.initPlayback(s,r);c!==!1&&(this._resolved={keyframes:s,finalKeyframe:r,...c},this.onPostResolved())}onPostResolved(){}then(s,r){return this.currentFinishedPromise.then(s,r)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(s=>{this.resolveFinishedPromise=s})}}const _n=(t,s,r)=>{const a=s-t;return a===0?1:(r-t)/a},iv=(t,s,r=10)=>{let a="";const n=Math.max(Math.round(s/r),2);for(let i=0;i<n;i++)a+=t(_n(0,n-1,i))+", ";return`linear(${a.substring(0,a.length-2)})`};function ov(t,s){return s?t*(1e3/s):0}const yA=5;function lv(t,s,r){const a=Math.max(s-yA,0);return ov(r-t(a),s-a)}const Ht={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Gl=.001;function vA({duration:t=Ht.duration,bounce:s=Ht.bounce,velocity:r=Ht.velocity,mass:a=Ht.mass}){let n,i,o=1-s;o=aa(Ht.minDamping,Ht.maxDamping,o),t=aa(Ht.minDuration,Ht.maxDuration,sa(t)),o<1?(n=d=>{const c=d*o,f=c*t,m=c-r,y=Rc(d,o),x=Math.exp(-f);return Gl-m/y*x},i=d=>{const f=d*o*t,m=f*r+r,y=Math.pow(o,2)*Math.pow(d,2)*t,x=Math.exp(-f),p=Rc(Math.pow(d,2),o);return(-n(d)+Gl>0?-1:1)*((m-y)*x)/p}):(n=d=>{const c=Math.exp(-d*t),f=(d-r)*t+1;return-Gl+c*f},i=d=>{const c=Math.exp(-d*t),f=(r-d)*(t*t);return c*f});const l=5/t,u=jA(n,i,l);if(t=ta(t),isNaN(u))return{stiffness:Ht.stiffness,damping:Ht.damping,duration:t};{const d=Math.pow(u,2)*a;return{stiffness:d,damping:o*2*Math.sqrt(a*d),duration:t}}}const bA=12;function jA(t,s,r){let a=r;for(let n=1;n<bA;n++)a=a-t(a)/s(a);return a}function Rc(t,s){return t*Math.sqrt(1-s*s)}const Ic=2e4;function cv(t){let s=0;const r=50;let a=t.next(s);for(;!a.done&&s<Ic;)s+=r,a=t.next(s);return s>=Ic?1/0:s}const NA=["duration","bounce"],wA=["stiffness","damping","mass"];function Rm(t,s){return s.some(r=>t[r]!==void 0)}function kA(t){let s={velocity:Ht.velocity,stiffness:Ht.stiffness,damping:Ht.damping,mass:Ht.mass,isResolvedFromDuration:!1,...t};if(!Rm(t,wA)&&Rm(t,NA))if(t.visualDuration){const r=t.visualDuration,a=2*Math.PI/(r*1.2),n=a*a,i=2*aa(.05,1,1-t.bounce)*Math.sqrt(n);s={...s,mass:Ht.mass,stiffness:n,damping:i}}else{const r=vA(t);s={...s,...r,mass:Ht.mass},s.isResolvedFromDuration=!0}return s}function dv(t=Ht.visualDuration,s=Ht.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:a,restDelta:n}=r;const i=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],l={done:!1,value:i},{stiffness:u,damping:d,mass:c,duration:f,velocity:m,isResolvedFromDuration:y}=kA({...r,velocity:-sa(r.velocity||0)}),x=m||0,p=d/(2*Math.sqrt(u*c)),A=o-i,g=sa(Math.sqrt(u/c)),N=Math.abs(A)<5;a||(a=N?Ht.restSpeed.granular:Ht.restSpeed.default),n||(n=N?Ht.restDelta.granular:Ht.restDelta.default);let w;if(p<1){const b=Rc(g,p);w=k=>{const R=Math.exp(-p*g*k);return o-R*((x+p*g*A)/b*Math.sin(b*k)+A*Math.cos(b*k))}}else if(p===1)w=b=>o-Math.exp(-g*b)*(A+(x+g*A)*b);else{const b=g*Math.sqrt(p*p-1);w=k=>{const R=Math.exp(-p*g*k),I=Math.min(b*k,300);return o-R*((x+p*g*A)*Math.sinh(I)+b*A*Math.cosh(I))/b}}const _={calculatedDuration:y&&f||null,next:b=>{const k=w(b);if(y)l.done=b>=f;else{let R=0;p<1&&(R=b===0?ta(x):lv(w,b,k));const I=Math.abs(R)<=a,E=Math.abs(o-k)<=n;l.done=I&&E}return l.value=l.done?o:k,l},toString:()=>{const b=Math.min(cv(_),Ic),k=iv(R=>_.next(b*R).value,b,30);return b+"ms "+k}};return _}function Im({keyframes:t,velocity:s=0,power:r=.8,timeConstant:a=325,bounceDamping:n=10,bounceStiffness:i=500,modifyTarget:o,min:l,max:u,restDelta:d=.5,restSpeed:c}){const f=t[0],m={done:!1,value:f},y=I=>l!==void 0&&I<l||u!==void 0&&I>u,x=I=>l===void 0?u:u===void 0||Math.abs(l-I)<Math.abs(u-I)?l:u;let p=r*s;const A=f+p,g=o===void 0?A:o(A);g!==A&&(p=g-f);const N=I=>-p*Math.exp(-I/a),w=I=>g+N(I),_=I=>{const E=N(I),O=w(I);m.done=Math.abs(E)<=d,m.value=m.done?g:O};let b,k;const R=I=>{y(m.value)&&(b=I,k=dv({keyframes:[m.value,x(m.value)],velocity:lv(w,I,m.value),damping:n,stiffness:i,restDelta:d,restSpeed:c}))};return R(0),{calculatedDuration:null,next:I=>{let E=!1;return!k&&b===void 0&&(E=!0,_(I),R(I)),b!==void 0&&I>=b?k.next(I-b):(!E&&_(I),m)}}}const SA=Ki(.42,0,1,1),TA=Ki(0,0,.58,1),uv=Ki(.42,0,.58,1),AA=t=>Array.isArray(t)&&typeof t[0]!="number",Ld=t=>Array.isArray(t)&&typeof t[0]=="number",CA={linear:_s,easeIn:SA,easeInOut:uv,easeOut:TA,circIn:Ed,circInOut:By,circOut:zy,backIn:_d,backInOut:Ly,backOut:$y,anticipate:Vy},Fm=t=>{if(Ld(t)){My(t.length===4);const[s,r,a,n]=t;return Ki(s,r,a,n)}else if(typeof t=="string")return CA[t];return t},PA=(t,s)=>r=>s(t(r)),ga=(...t)=>t.reduce(PA),qt=(t,s,r)=>t+(s-t)*r;function Ql(t,s,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(s-t)*6*r:r<1/2?s:r<2/3?t+(s-t)*(2/3-r)*6:t}function _A({hue:t,saturation:s,lightness:r,alpha:a}){t/=360,s/=100,r/=100;let n=0,i=0,o=0;if(!s)n=i=o=r;else{const l=r<.5?r*(1+s):r+s-r*s,u=2*r-l;n=Ql(u,l,t+1/3),i=Ql(u,l,t),o=Ql(u,l,t-1/3)}return{red:Math.round(n*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:a}}function Co(t,s){return r=>r>0?s:t}const Xl=(t,s,r)=>{const a=t*t,n=r*(s*s-a)+a;return n<0?0:Math.sqrt(n)},EA=[Dc,La,mn],DA=t=>EA.find(s=>s.test(t));function Om(t){const s=DA(t);if(!s)return!1;let r=s.parse(t);return s===mn&&(r=_A(r)),r}const $m=(t,s)=>{const r=Om(t),a=Om(s);if(!r||!a)return Co(t,s);const n={...r};return i=>(n.red=Xl(r.red,a.red,i),n.green=Xl(r.green,a.green,i),n.blue=Xl(r.blue,a.blue,i),n.alpha=qt(r.alpha,a.alpha,i),La.transform(n))},Fc=new Set(["none","hidden"]);function MA(t,s){return Fc.has(t)?r=>r<=0?t:s:r=>r>=1?s:t}function RA(t,s){return r=>qt(t,s,r)}function Vd(t){return typeof t=="number"?RA:typeof t=="string"?Dd(t)?Co:Ts.test(t)?$m:OA:Array.isArray(t)?mv:typeof t=="object"?Ts.test(t)?$m:IA:Co}function mv(t,s){const r=[...t],a=r.length,n=t.map((i,o)=>Vd(i)(i,s[o]));return i=>{for(let o=0;o<a;o++)r[o]=n[o](i);return r}}function IA(t,s){const r={...t,...s},a={};for(const n in r)t[n]!==void 0&&s[n]!==void 0&&(a[n]=Vd(t[n])(t[n],s[n]));return n=>{for(const i in a)r[i]=a[i](n);return r}}function FA(t,s){var r;const a=[],n={color:0,var:0,number:0};for(let i=0;i<s.values.length;i++){const o=s.types[i],l=t.indexes[o][n[o]],u=(r=t.values[l])!==null&&r!==void 0?r:0;a[i]=u,n[o]++}return a}const OA=(t,s)=>{const r=ka.createTransformer(s),a=bi(t),n=bi(s);return a.indexes.var.length===n.indexes.var.length&&a.indexes.color.length===n.indexes.color.length&&a.indexes.number.length>=n.indexes.number.length?Fc.has(t)&&!n.values.length||Fc.has(s)&&!a.values.length?MA(t,s):ga(mv(FA(a,n),n.values),r):Co(t,s)};function hv(t,s,r){return typeof t=="number"&&typeof s=="number"&&typeof r=="number"?qt(t,s,r):Vd(t)(t,s)}function $A(t,s,r){const a=[],n=r||hv,i=t.length-1;for(let o=0;o<i;o++){let l=n(t[o],t[o+1]);if(s){const u=Array.isArray(s)?s[o]||_s:s;l=ga(u,l)}a.push(l)}return a}function LA(t,s,{clamp:r=!0,ease:a,mixer:n}={}){const i=t.length;if(My(i===s.length),i===1)return()=>s[0];if(i===2&&t[0]===t[1])return()=>s[1];t[0]>t[i-1]&&(t=[...t].reverse(),s=[...s].reverse());const o=$A(s,a,n),l=o.length,u=d=>{let c=0;if(l>1)for(;c<t.length-2&&!(d<t[c+1]);c++);const f=_n(t[c],t[c+1],d);return o[c](f)};return r?d=>u(aa(t[0],t[i-1],d)):u}function VA(t,s){const r=t[t.length-1];for(let a=1;a<=s;a++){const n=_n(0,s,a);t.push(qt(r,1,n))}}function zA(t){const s=[0];return VA(s,t.length-1),s}function BA(t,s){return t.map(r=>r*s)}function qA(t,s){return t.map(()=>s||uv).splice(0,t.length-1)}function Po({duration:t=300,keyframes:s,times:r,ease:a="easeInOut"}){const n=AA(a)?a.map(Fm):Fm(a),i={done:!1,value:s[0]},o=BA(r&&r.length===s.length?r:zA(s),t),l=LA(o,s,{ease:Array.isArray(n)?n:qA(s,n)});return{calculatedDuration:t,next:u=>(i.value=l(u),i.done=u>=t,i)}}const UA=t=>{const s=({timestamp:r})=>t(r);return{start:()=>Et.update(s,!0),stop:()=>wa(s),now:()=>vs.isProcessing?vs.timestamp:Dr.now()}},WA={decay:Im,inertia:Im,tween:Po,keyframes:Po,spring:dv},KA=t=>t/100;class zd extends nv{constructor(s){super(s),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:u}=this.options;u&&u()};const{name:r,motionValue:a,element:n,keyframes:i}=this.options,o=n?.KeyframeResolver||Md,l=(u,d)=>this.onKeyframesResolved(u,d);this.resolver=new o(i,l,r,a,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(s){const{type:r="keyframes",repeat:a=0,repeatDelay:n=0,repeatType:i,velocity:o=0}=this.options,l=$d(r)?r:WA[r]||Po;let u,d;l!==Po&&typeof s[0]!="number"&&(u=ga(KA,hv(s[0],s[1])),s=[0,100]);const c=l({...this.options,keyframes:s});i==="mirror"&&(d=l({...this.options,keyframes:[...s].reverse(),velocity:-o})),c.calculatedDuration===null&&(c.calculatedDuration=cv(c));const{calculatedDuration:f}=c,m=f+n,y=m*(a+1)-n;return{generator:c,mirroredGenerator:d,mapPercentToKeyframes:u,calculatedDuration:f,resolvedDuration:m,totalDuration:y}}onPostResolved(){const{autoplay:s=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!s?this.pause():this.state=this.pendingPlayState}tick(s,r=!1){const{resolved:a}=this;if(!a){const{keyframes:I}=this.options;return{done:!0,value:I[I.length-1]}}const{finalKeyframe:n,generator:i,mirroredGenerator:o,mapPercentToKeyframes:l,keyframes:u,calculatedDuration:d,totalDuration:c,resolvedDuration:f}=a;if(this.startTime===null)return i.next(0);const{delay:m,repeat:y,repeatType:x,repeatDelay:p,onUpdate:A}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-c/this.speed,this.startTime)),r?this.currentTime=s:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(s-this.startTime)*this.speed;const g=this.currentTime-m*(this.speed>=0?1:-1),N=this.speed>=0?g<0:g>c;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let w=this.currentTime,_=i;if(y){const I=Math.min(this.currentTime,c)/f;let E=Math.floor(I),O=I%1;!O&&I>=1&&(O=1),O===1&&E--,E=Math.min(E,y+1),!!(E%2)&&(x==="reverse"?(O=1-O,p&&(O-=p/f)):x==="mirror"&&(_=o)),w=aa(0,1,O)*f}const b=N?{done:!1,value:u[0]}:_.next(w);l&&(b.value=l(b.value));let{done:k}=b;!N&&d!==null&&(k=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const R=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return R&&n!==void 0&&(b.value=xl(u,this.options,n)),A&&A(b.value),R&&this.finish(),b}get duration(){const{resolved:s}=this;return s?sa(s.calculatedDuration):0}get time(){return sa(this.currentTime)}set time(s){s=ta(s),this.currentTime=s,this.holdTime!==null||this.speed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.speed)}get speed(){return this.playbackSpeed}set speed(s){const r=this.playbackSpeed!==s;this.playbackSpeed=s,r&&(this.time=sa(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:s=UA,onPlay:r,startTime:a}=this.options;this.driver||(this.driver=s(i=>this.tick(i))),r&&r();const n=this.driver.now();this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=n):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var s;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(s=this.currentTime)!==null&&s!==void 0?s:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:s}=this.options;s&&s()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}}const HA=new Set(["opacity","clipPath","filter","transform"]);function Bd(t){let s;return()=>(s===void 0&&(s=t()),s)}const GA={linearEasing:void 0};function QA(t,s){const r=Bd(t);return()=>{var a;return(a=GA[s])!==null&&a!==void 0?a:r()}}const _o=QA(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function fv(t){return!!(typeof t=="function"&&_o()||!t||typeof t=="string"&&(t in Oc||_o())||Ld(t)||Array.isArray(t)&&t.every(fv))}const ti=([t,s,r,a])=>`cubic-bezier(${t}, ${s}, ${r}, ${a})`,Oc={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ti([0,.65,.55,1]),circOut:ti([.55,0,1,.45]),backIn:ti([.31,.01,.66,-.59]),backOut:ti([.33,1.53,.69,.99])};function pv(t,s){if(t)return typeof t=="function"&&_o()?iv(t,s):Ld(t)?ti(t):Array.isArray(t)?t.map(r=>pv(r,s)||Oc.easeOut):Oc[t]}function XA(t,s,r,{delay:a=0,duration:n=300,repeat:i=0,repeatType:o="loop",ease:l="easeInOut",times:u}={}){const d={[s]:r};u&&(d.offset=u);const c=pv(l,n);return Array.isArray(c)&&(d.easing=c),t.animate(d,{delay:a,duration:n,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}function Lm(t,s){t.timeline=s,t.onfinish=null}const ZA=Bd(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Eo=10,YA=2e4;function JA(t){return $d(t.type)||t.type==="spring"||!fv(t.ease)}function eC(t,s){const r=new zd({...s,keyframes:t,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:t[0]};const n=[];let i=0;for(;!a.done&&i<YA;)a=r.sample(i),n.push(a.value),i+=Eo;return{times:void 0,keyframes:n,duration:i-Eo,ease:"linear"}}const xv={anticipate:Vy,backInOut:Ly,circInOut:By};function tC(t){return t in xv}class Vm extends nv{constructor(s){super(s);const{name:r,motionValue:a,element:n,keyframes:i}=this.options;this.resolver=new av(i,(o,l)=>this.onKeyframesResolved(o,l),r,a,n),this.resolver.scheduleResolve()}initPlayback(s,r){var a;let{duration:n=300,times:i,ease:o,type:l,motionValue:u,name:d,startTime:c}=this.options;if(!(!((a=u.owner)===null||a===void 0)&&a.current))return!1;if(typeof o=="string"&&_o()&&tC(o)&&(o=xv[o]),JA(this.options)){const{onComplete:m,onUpdate:y,motionValue:x,element:p,...A}=this.options,g=eC(s,A);s=g.keyframes,s.length===1&&(s[1]=s[0]),n=g.duration,i=g.times,o=g.ease,l="keyframes"}const f=XA(u.owner.current,d,s,{...this.options,duration:n,times:i,ease:o});return f.startTime=c??this.calcStartTime(),this.pendingTimeline?(Lm(f,this.pendingTimeline),this.pendingTimeline=void 0):f.onfinish=()=>{const{onComplete:m}=this.options;u.set(xl(s,this.options,r)),m&&m(),this.cancel(),this.resolveFinishedPromise()},{animation:f,duration:n,times:i,type:l,ease:o,keyframes:s}}get duration(){const{resolved:s}=this;if(!s)return 0;const{duration:r}=s;return sa(r)}get time(){const{resolved:s}=this;if(!s)return 0;const{animation:r}=s;return sa(r.currentTime||0)}set time(s){const{resolved:r}=this;if(!r)return;const{animation:a}=r;a.currentTime=ta(s)}get speed(){const{resolved:s}=this;if(!s)return 1;const{animation:r}=s;return r.playbackRate}set speed(s){const{resolved:r}=this;if(!r)return;const{animation:a}=r;a.playbackRate=s}get state(){const{resolved:s}=this;if(!s)return"idle";const{animation:r}=s;return r.playState}get startTime(){const{resolved:s}=this;if(!s)return null;const{animation:r}=s;return r.startTime}attachTimeline(s){if(!this._resolved)this.pendingTimeline=s;else{const{resolved:r}=this;if(!r)return _s;const{animation:a}=r;Lm(a,s)}return _s}play(){if(this.isStopped)return;const{resolved:s}=this;if(!s)return;const{animation:r}=s;r.playState==="finished"&&this.updateFinishedPromise(),r.play()}pause(){const{resolved:s}=this;if(!s)return;const{animation:r}=s;r.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:s}=this;if(!s)return;const{animation:r,keyframes:a,duration:n,type:i,ease:o,times:l}=s;if(r.playState==="idle"||r.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:c,onComplete:f,element:m,...y}=this.options,x=new zd({...y,keyframes:a,duration:n,type:i,ease:o,times:l,isGenerator:!0}),p=ta(this.time);d.setWithVelocity(x.sample(p-Eo).value,x.sample(p).value,Eo)}const{onStop:u}=this.options;u&&u(),this.cancel()}complete(){const{resolved:s}=this;s&&s.animation.finish()}cancel(){const{resolved:s}=this;s&&s.animation.cancel()}static supports(s){const{motionValue:r,name:a,repeatDelay:n,repeatType:i,damping:o,type:l}=s;return ZA()&&a&&HA.has(a)&&r&&r.owner&&r.owner.current instanceof HTMLElement&&!r.owner.getProps().onUpdate&&!n&&i!=="mirror"&&o!==0&&l!=="inertia"}}const sC=Bd(()=>window.ScrollTimeline!==void 0);class rC{constructor(s){this.stop=()=>this.runAll("stop"),this.animations=s.filter(Boolean)}then(s,r){return Promise.all(this.animations).then(s).catch(r)}getAll(s){return this.animations[0][s]}setAll(s,r){for(let a=0;a<this.animations.length;a++)this.animations[a][s]=r}attachTimeline(s,r){const a=this.animations.map(n=>sC()&&n.attachTimeline?n.attachTimeline(s):r(n));return()=>{a.forEach((n,i)=>{n&&n(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(s){this.setAll("time",s)}get speed(){return this.getAll("speed")}set speed(s){this.setAll("speed",s)}get startTime(){return this.getAll("startTime")}get duration(){let s=0;for(let r=0;r<this.animations.length;r++)s=Math.max(s,this.animations[r].duration);return s}runAll(s){this.animations.forEach(r=>r[s]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function aC({when:t,delay:s,delayChildren:r,staggerChildren:a,staggerDirection:n,repeat:i,repeatType:o,repeatDelay:l,from:u,elapsed:d,...c}){return!!Object.keys(c).length}const qd=(t,s,r,a={},n,i)=>o=>{const l=Pd(a,t)||{},u=l.delay||a.delay||0;let{elapsed:d=0}=a;d=d-ta(u);let c={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:s.getVelocity(),...l,delay:-d,onUpdate:m=>{s.set(m),l.onUpdate&&l.onUpdate(m)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:s,element:i?void 0:n};aC(l)||(c={...c,...CT(t,c)}),c.duration&&(c.duration=ta(c.duration)),c.repeatDelay&&(c.repeatDelay=ta(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let f=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(c.duration=0,c.delay===0&&(f=!0)),f&&!i&&s.get()!==void 0){const m=xl(c.keyframes,l);if(m!==void 0)return Et.update(()=>{c.onUpdate(m),c.onComplete()}),new rC([])}return!i&&Vm.supports(c)?new Vm(c):new zd(c)},nC=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),iC=t=>Pc(t)?t[t.length-1]||0:t;function Ud(t,s){t.indexOf(s)===-1&&t.push(s)}function Wd(t,s){const r=t.indexOf(s);r>-1&&t.splice(r,1)}class Kd{constructor(){this.subscriptions=[]}add(s){return Ud(this.subscriptions,s),()=>Wd(this.subscriptions,s)}notify(s,r,a){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](s,r,a);else for(let i=0;i<n;i++){const o=this.subscriptions[i];o&&o(s,r,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const zm=30,oC=t=>!isNaN(parseFloat(t));class lC{constructor(s,r={}){this.version="11.13.1",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,n=!0)=>{const i=Dr.now();this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(s),this.owner=r.owner}setCurrent(s){this.current=s,this.updatedAt=Dr.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=oC(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,r){this.events[s]||(this.events[s]=new Kd);const a=this.events[s].add(r);return s==="change"?()=>{a(),Et.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,r){this.passiveEffect=s,this.stopPassiveEffect=r}set(s,r=!0){!r||!this.passiveEffect?this.updateAndNotify(s,r):this.passiveEffect(s,this.updateAndNotify)}setWithVelocity(s,r,a){this.set(r),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-a}jump(s,r=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=Dr.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>zm)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,zm);return ov(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(s){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=s(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ji(t,s){return new lC(t,s)}function cC(t,s,r){t.hasValue(s)?t.getValue(s).set(r):t.addValue(s,ji(r))}function dC(t,s){const r=pl(t,s);let{transitionEnd:a={},transition:n={},...i}=r||{};i={...i,...a};for(const o in i){const l=iC(i[o]);cC(t,o,l)}}const Hd=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),uC="framerAppearId",gv="data-"+Hd(uC);function yv(t){return t.props[gv]}const Ps=t=>!!(t&&t.getVelocity);function mC(t){return!!(Ps(t)&&t.add)}function $c(t,s){const r=t.getValue("willChange");if(mC(r))return r.add(s)}function hC({protectedKeys:t,needsAnimating:s},r){const a=t.hasOwnProperty(r)&&s[r]!==!0;return s[r]=!1,a}function vv(t,s,{delay:r=0,transitionOverride:a,type:n}={}){var i;let{transition:o=t.getDefaultTransition(),transitionEnd:l,...u}=s;a&&(o=a);const d=[],c=n&&t.animationState&&t.animationState.getState()[n];for(const f in u){const m=t.getValue(f,(i=t.latestValues[f])!==null&&i!==void 0?i:null),y=u[f];if(y===void 0||c&&hC(c,f))continue;const x={delay:r,...Pd(o||{},f)};let p=!1;if(window.MotionHandoffAnimation){const g=yv(t);if(g){const N=window.MotionHandoffAnimation(g,f,Et);N!==null&&(x.startTime=N,p=!0)}}$c(t,f),m.start(qd(f,m,y,t.shouldReduceMotion&&sn.has(f)?{type:!1}:x,t,p));const A=m.animation;A&&d.push(A)}return l&&Promise.all(d).then(()=>{Et.update(()=>{l&&dC(t,l)})}),d}function Lc(t,s,r={}){var a;const n=pl(t,s,r.type==="exit"?(a=t.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(i=r.transitionOverride);const o=n?()=>Promise.all(vv(t,n,r)):()=>Promise.resolve(),l=t.variantChildren&&t.variantChildren.size?(d=0)=>{const{delayChildren:c=0,staggerChildren:f,staggerDirection:m}=i;return fC(t,s,c+d,f,m,r)}:()=>Promise.resolve(),{when:u}=i;if(u){const[d,c]=u==="beforeChildren"?[o,l]:[l,o];return d().then(()=>c())}else return Promise.all([o(),l(r.delay)])}function fC(t,s,r=0,a=0,n=1,i){const o=[],l=(t.variantChildren.size-1)*a,u=n===1?(d=0)=>d*a:(d=0)=>l-d*a;return Array.from(t.variantChildren).sort(pC).forEach((d,c)=>{d.notify("AnimationStart",s),o.push(Lc(d,s,{...i,delay:r+u(c)}).then(()=>d.notify("AnimationComplete",s)))}),Promise.all(o)}function pC(t,s){return t.sortNodePosition(s)}function xC(t,s,r={}){t.notify("AnimationStart",s);let a;if(Array.isArray(s)){const n=s.map(i=>Lc(t,i,r));a=Promise.all(n)}else if(typeof s=="string")a=Lc(t,s,r);else{const n=typeof s=="function"?pl(t,s,r.custom):s;a=Promise.all(vv(t,n,r))}return a.then(()=>{t.notify("AnimationComplete",s)})}const gC=Cd.length;function bv(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?bv(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const s={};for(let r=0;r<gC;r++){const a=Cd[r],n=t.props[a];(yi(n)||n===!1)&&(s[a]=n)}return s}const yC=[...Ad].reverse(),vC=Ad.length;function bC(t){return s=>Promise.all(s.map(({animation:r,options:a})=>xC(t,r,a)))}function jC(t){let s=bC(t),r=Bm(),a=!0;const n=u=>(d,c)=>{var f;const m=pl(t,c,u==="exit"?(f=t.presenceContext)===null||f===void 0?void 0:f.custom:void 0);if(m){const{transition:y,transitionEnd:x,...p}=m;d={...d,...p,...x}}return d};function i(u){s=u(t)}function o(u){const{props:d}=t,c=bv(t.parent)||{},f=[],m=new Set;let y={},x=1/0;for(let A=0;A<vC;A++){const g=yC[A],N=r[g],w=d[g]!==void 0?d[g]:c[g],_=yi(w),b=g===u?N.isActive:null;b===!1&&(x=A);let k=w===c[g]&&w!==d[g]&&_;if(k&&a&&t.manuallyAnimateOnMount&&(k=!1),N.protectedKeys={...y},!N.isActive&&b===null||!w&&!N.prevProp||fl(w)||typeof w=="boolean")continue;const R=NC(N.prevProp,w);let I=R||g===u&&N.isActive&&!k&&_||A>x&&_,E=!1;const O=Array.isArray(w)?w:[w];let T=O.reduce(n(g),{});b===!1&&(T={});const{prevResolvedValues:S={}}=N,M={...S,...T},v=V=>{I=!0,m.has(V)&&(E=!0,m.delete(V)),N.needsAnimating[V]=!0;const ne=t.getValue(V);ne&&(ne.liveStyle=!1)};for(const V in M){const ne=T[V],F=S[V];if(y.hasOwnProperty(V))continue;let ye=!1;Pc(ne)&&Pc(F)?ye=!Dy(ne,F):ye=ne!==F,ye?ne!=null?v(V):m.add(V):ne!==void 0&&m.has(V)?v(V):N.protectedKeys[V]=!0}N.prevProp=w,N.prevResolvedValues=T,N.isActive&&(y={...y,...T}),a&&t.blockInitialAnimation&&(I=!1),I&&(!(k&&R)||E)&&f.push(...O.map(V=>({animation:V,options:{type:g}})))}if(m.size){const A={};m.forEach(g=>{const N=t.getBaseTarget(g),w=t.getValue(g);w&&(w.liveStyle=!0),A[g]=N??null}),f.push({animation:A})}let p=!!f.length;return a&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(p=!1),a=!1,p?s(f):Promise.resolve()}function l(u,d){var c;if(r[u].isActive===d)return Promise.resolve();(c=t.variantChildren)===null||c===void 0||c.forEach(m=>{var y;return(y=m.animationState)===null||y===void 0?void 0:y.setActive(u,d)}),r[u].isActive=d;const f=o(u);for(const m in r)r[m].protectedKeys={};return f}return{animateChanges:o,setActive:l,setAnimateFunction:i,getState:()=>r,reset:()=>{r=Bm(),a=!0}}}function NC(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!Dy(s,t):!1}function Ra(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Bm(){return{animate:Ra(!0),whileInView:Ra(),whileHover:Ra(),whileTap:Ra(),whileDrag:Ra(),whileFocus:Ra(),exit:Ra()}}class Da{constructor(s){this.isMounted=!1,this.node=s}update(){}}class wC extends Da{constructor(s){super(s),s.animationState||(s.animationState=jC(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();fl(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:r}=this.node.prevProps||{};s!==r&&this.updateAnimationControlsSubscription()}unmount(){var s;this.node.animationState.reset(),(s=this.unmountControls)===null||s===void 0||s.call(this)}}let kC=0;class SC extends Da{constructor(){super(...arguments),this.id=kC++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:r}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===a)return;const n=this.node.animationState.setActive("exit",!s);r&&!s&&n.then(()=>r(this.id))}mount(){const{register:s}=this.node.presenceContext||{};s&&(this.unmount=s(this.id))}unmount(){}}const TC={animation:{Feature:wC},exit:{Feature:SC}};function AC(t,s,r){var a;if(t instanceof Element)return[t];if(typeof t=="string"){let n=document;const i=(a=void 0)!==null&&a!==void 0?a:n.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}const fr={x:!1,y:!1};function jv(){return fr.x||fr.y}function qm(t){return s=>{s.pointerType==="touch"||jv()||t(s)}}function CC(t,s,r={}){const a=new AbortController,n={passive:!0,...r,signal:a.signal},i=qm(o=>{const{target:l}=o,u=s(o);if(!u||!l)return;const d=qm(c=>{u(c),l.removeEventListener("pointerleave",d)});l.addEventListener("pointerleave",d,n)});return AC(t).forEach(o=>{o.addEventListener("pointerenter",i,n)}),()=>a.abort()}function PC(t){return t==="x"||t==="y"?fr[t]?null:(fr[t]=!0,()=>{fr[t]=!1}):fr.x||fr.y?null:(fr.x=fr.y=!0,()=>{fr.x=fr.y=!1})}const Nv=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function Gi(t){return{point:{x:t.pageX,y:t.pageY}}}const _C=t=>s=>Nv(s)&&t(s,Gi(s));function Qr(t,s,r,a={passive:!0}){return t.addEventListener(s,r,a),()=>t.removeEventListener(s,r)}function ya(t,s,r,a){return Qr(t,s,_C(r),a)}const Um=(t,s)=>Math.abs(t-s);function EC(t,s){const r=Um(t.x,s.x),a=Um(t.y,s.y);return Math.sqrt(r**2+a**2)}class wv{constructor(s,r,{transformPagePoint:a,contextWindow:n,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=Yl(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,y=EC(f.offset,{x:0,y:0})>=3;if(!m&&!y)return;const{point:x}=f,{timestamp:p}=vs;this.history.push({...x,timestamp:p});const{onStart:A,onMove:g}=this.handlers;m||(A&&A(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Zl(m,this.transformPagePoint),Et.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:y,onSessionEnd:x,resumeAnimation:p}=this.handlers;if(this.dragSnapToOrigin&&p&&p(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=Yl(f.type==="pointercancel"?this.lastMoveEventInfo:Zl(m,this.transformPagePoint),this.history);this.startEvent&&y&&y(f,A),x&&x(f,A)},!Nv(s))return;this.dragSnapToOrigin=i,this.handlers=r,this.transformPagePoint=a,this.contextWindow=n||window;const o=Gi(s),l=Zl(o,this.transformPagePoint),{point:u}=l,{timestamp:d}=vs;this.history=[{...u,timestamp:d}];const{onSessionStart:c}=r;c&&c(s,Yl(l,this.history)),this.removeListeners=ga(ya(this.contextWindow,"pointermove",this.handlePointerMove),ya(this.contextWindow,"pointerup",this.handlePointerUp),ya(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),wa(this.updatePoint)}}function Zl(t,s){return s?{point:s(t.point)}:t}function Wm(t,s){return{x:t.x-s.x,y:t.y-s.y}}function Yl({point:t},s){return{point:t,delta:Wm(t,kv(s)),offset:Wm(t,DC(s)),velocity:MC(s,.1)}}function DC(t){return t[0]}function kv(t){return t[t.length-1]}function MC(t,s){if(t.length<2)return{x:0,y:0};let r=t.length-1,a=null;const n=kv(t);for(;r>=0&&(a=t[r],!(n.timestamp-a.timestamp>ta(s)));)r--;if(!a)return{x:0,y:0};const i=sa(n.timestamp-a.timestamp);if(i===0)return{x:0,y:0};const o={x:(n.x-a.x)/i,y:(n.y-a.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function hn(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}const Sv=1e-4,RC=1-Sv,IC=1+Sv,Tv=.01,FC=0-Tv,OC=0+Tv;function er(t){return t.max-t.min}function $C(t,s,r){return Math.abs(t-s)<=r}function Km(t,s,r,a=.5){t.origin=a,t.originPoint=qt(s.min,s.max,t.origin),t.scale=er(r)/er(s),t.translate=qt(r.min,r.max,t.origin)-t.originPoint,(t.scale>=RC&&t.scale<=IC||isNaN(t.scale))&&(t.scale=1),(t.translate>=FC&&t.translate<=OC||isNaN(t.translate))&&(t.translate=0)}function di(t,s,r,a){Km(t.x,s.x,r.x,a?a.originX:void 0),Km(t.y,s.y,r.y,a?a.originY:void 0)}function Hm(t,s,r){t.min=r.min+s.min,t.max=t.min+er(s)}function LC(t,s,r){Hm(t.x,s.x,r.x),Hm(t.y,s.y,r.y)}function Gm(t,s,r){t.min=s.min-r.min,t.max=t.min+er(s)}function ui(t,s,r){Gm(t.x,s.x,r.x),Gm(t.y,s.y,r.y)}function VC(t,{min:s,max:r},a){return s!==void 0&&t<s?t=a?qt(s,t,a.min):Math.max(t,s):r!==void 0&&t>r&&(t=a?qt(r,t,a.max):Math.min(t,r)),t}function Qm(t,s,r){return{min:s!==void 0?t.min+s:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function zC(t,{top:s,left:r,bottom:a,right:n}){return{x:Qm(t.x,r,n),y:Qm(t.y,s,a)}}function Xm(t,s){let r=s.min-t.min,a=s.max-t.max;return s.max-s.min<t.max-t.min&&([r,a]=[a,r]),{min:r,max:a}}function BC(t,s){return{x:Xm(t.x,s.x),y:Xm(t.y,s.y)}}function qC(t,s){let r=.5;const a=er(t),n=er(s);return n>a?r=_n(s.min,s.max-a,t.min):a>n&&(r=_n(t.min,t.max-n,s.min)),aa(0,1,r)}function UC(t,s){const r={};return s.min!==void 0&&(r.min=s.min-t.min),s.max!==void 0&&(r.max=s.max-t.min),r}const Vc=.35;function WC(t=Vc){return t===!1?t=0:t===!0&&(t=Vc),{x:Zm(t,"left","right"),y:Zm(t,"top","bottom")}}function Zm(t,s,r){return{min:Ym(t,s),max:Ym(t,r)}}function Ym(t,s){return typeof t=="number"?t:t[s]||0}const Jm=()=>({translate:0,scale:1,origin:0,originPoint:0}),fn=()=>({x:Jm(),y:Jm()}),eh=()=>({min:0,max:0}),Yt=()=>({x:eh(),y:eh()});function rr(t){return[t("x"),t("y")]}function Av({top:t,left:s,right:r,bottom:a}){return{x:{min:s,max:r},y:{min:t,max:a}}}function KC({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function HC(t,s){if(!s)return t;const r=s({x:t.left,y:t.top}),a=s({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:a.y,right:a.x}}function Jl(t){return t===void 0||t===1}function zc({scale:t,scaleX:s,scaleY:r}){return!Jl(t)||!Jl(s)||!Jl(r)}function Ia(t){return zc(t)||Cv(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Cv(t){return th(t.x)||th(t.y)}function th(t){return t&&t!=="0%"}function Do(t,s,r){const a=t-r,n=s*a;return r+n}function sh(t,s,r,a,n){return n!==void 0&&(t=Do(t,n,a)),Do(t,r,a)+s}function Bc(t,s=0,r=1,a,n){t.min=sh(t.min,s,r,a,n),t.max=sh(t.max,s,r,a,n)}function Pv(t,{x:s,y:r}){Bc(t.x,s.translate,s.scale,s.originPoint),Bc(t.y,r.translate,r.scale,r.originPoint)}const rh=.999999999999,ah=1.0000000000001;function GC(t,s,r,a=!1){const n=r.length;if(!n)return;s.x=s.y=1;let i,o;for(let l=0;l<n;l++){i=r[l],o=i.projectionDelta;const{visualElement:u}=i.options;u&&u.props.style&&u.props.style.display==="contents"||(a&&i.options.layoutScroll&&i.scroll&&i!==i.root&&xn(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(s.x*=o.x.scale,s.y*=o.y.scale,Pv(t,o)),a&&Ia(i.latestValues)&&xn(t,i.latestValues))}s.x<ah&&s.x>rh&&(s.x=1),s.y<ah&&s.y>rh&&(s.y=1)}function pn(t,s){t.min=t.min+s,t.max=t.max+s}function nh(t,s,r,a,n=.5){const i=qt(t.min,t.max,n);Bc(t,s,r,i,a)}function xn(t,s){nh(t.x,s.x,s.scaleX,s.scale,s.originX),nh(t.y,s.y,s.scaleY,s.scale,s.originY)}function _v(t,s){return Av(HC(t.getBoundingClientRect(),s))}function QC(t,s,r){const a=_v(t,r),{scroll:n}=s;return n&&(pn(a.x,n.offset.x),pn(a.y,n.offset.y)),a}const Ev=({current:t})=>t?t.ownerDocument.defaultView:null,XC=new WeakMap;class ZC{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Yt(),this.visualElement=s}start(s,{snapToCursor:r=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const n=c=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Gi(c).point)},i=(c,f)=>{const{drag:m,dragPropagation:y,onDragStart:x}=this.getProps();if(m&&!y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=PC(m),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),rr(A=>{let g=this.getAxisMotionValue(A).get()||0;if(Er.test(g)){const{projection:N}=this.visualElement;if(N&&N.layout){const w=N.layout.layoutBox[A];w&&(g=er(w)*(parseFloat(g)/100))}}this.originPoint[A]=g}),x&&Et.postRender(()=>x(c,f)),$c(this.visualElement,"transform");const{animationState:p}=this.visualElement;p&&p.setActive("whileDrag",!0)},o=(c,f)=>{const{dragPropagation:m,dragDirectionLock:y,onDirectionLock:x,onDrag:p}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:A}=f;if(y&&this.currentDirection===null){this.currentDirection=YC(A),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",f.point,A),this.updateAxis("y",f.point,A),this.visualElement.render(),p&&p(c,f)},l=(c,f)=>this.stop(c,f),u=()=>rr(c=>{var f;return this.getAnimationState(c)==="paused"&&((f=this.getAxisMotionValue(c).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new wv(s,{onSessionStart:n,onStart:i,onMove:o,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:Ev(this.visualElement)})}stop(s,r){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:n}=r;this.startAnimation(n);const{onDragEnd:i}=this.getProps();i&&Et.postRender(()=>i(s,r))}cancel(){this.isDragging=!1;const{projection:s,animationState:r}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(s,r,a){const{drag:n}=this.getProps();if(!a||!uo(s,n,this.currentDirection))return;const i=this.getAxisMotionValue(s);let o=this.originPoint[s]+a[s];this.constraints&&this.constraints[s]&&(o=VC(o,this.constraints[s],this.elastic[s])),i.set(o)}resolveConstraints(){var s;const{dragConstraints:r,dragElastic:a}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(s=this.visualElement.projection)===null||s===void 0?void 0:s.layout,i=this.constraints;r&&hn(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&n?this.constraints=zC(n.layoutBox,r):this.constraints=!1,this.elastic=WC(a),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&rr(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=UC(n.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:r}=this.getProps();if(!s||!hn(s))return!1;const a=s.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const i=QC(a,n.root,this.visualElement.getTransformPagePoint());let o=BC(n.layout.layoutBox,i);if(r){const l=r(KC(o));this.hasMutatedConstraints=!!l,l&&(o=Av(l))}return o}startAnimation(s){const{drag:r,dragMomentum:a,dragElastic:n,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),u=this.constraints||{},d=rr(c=>{if(!uo(c,r,this.currentDirection))return;let f=u&&u[c]||{};o&&(f={min:0,max:0});const m=n?200:1e6,y=n?40:1e7,x={type:"inertia",velocity:a?s[c]:0,bounceStiffness:m,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...i,...f};return this.startAxisValueAnimation(c,x)});return Promise.all(d).then(l)}startAxisValueAnimation(s,r){const a=this.getAxisMotionValue(s);return $c(this.visualElement,s),a.start(qd(s,a,0,r,this.visualElement,!1))}stopAnimation(){rr(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){rr(s=>{var r;return(r=this.getAxisMotionValue(s).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(s){var r;return(r=this.getAxisMotionValue(s).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(s){const r=`_drag${s.toUpperCase()}`,a=this.visualElement.getProps(),n=a[r];return n||this.visualElement.getValue(s,(a.initial?a.initial[s]:void 0)||0)}snapToCursor(s){rr(r=>{const{drag:a}=this.getProps();if(!uo(r,a,this.currentDirection))return;const{projection:n}=this.visualElement,i=this.getAxisMotionValue(r);if(n&&n.layout){const{min:o,max:l}=n.layout.layoutBox[r];i.set(s[r]-qt(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:r}=this.getProps(),{projection:a}=this.visualElement;if(!hn(r)||!a||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};rr(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const u=l.get();n[o]=qC({min:u,max:u},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),rr(o=>{if(!uo(o,s,null))return;const l=this.getAxisMotionValue(o),{min:u,max:d}=this.constraints[o];l.set(qt(u,d,n[o]))})}addListeners(){if(!this.visualElement.current)return;XC.set(this.visualElement,this);const s=this.visualElement.current,r=ya(s,"pointerdown",u=>{const{drag:d,dragListener:c=!0}=this.getProps();d&&c&&this.start(u)}),a=()=>{const{dragConstraints:u}=this.getProps();hn(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",a);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Et.read(a);const o=Qr(window,"resize",()=>this.scalePositionWithinConstraints()),l=n.addEventListener("didUpdate",(({delta:u,hasLayoutChanged:d})=>{this.isDragging&&d&&(rr(c=>{const f=this.getAxisMotionValue(c);f&&(this.originPoint[c]+=u[c].translate,f.set(f.get()+u[c].translate))}),this.visualElement.render())}));return()=>{o(),r(),i(),l&&l()}}getProps(){const s=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:a=!1,dragPropagation:n=!1,dragConstraints:i=!1,dragElastic:o=Vc,dragMomentum:l=!0}=s;return{...s,drag:r,dragDirectionLock:a,dragPropagation:n,dragConstraints:i,dragElastic:o,dragMomentum:l}}}function uo(t,s,r){return(s===!0||s===t)&&(r===null||r===t)}function YC(t,s=10){let r=null;return Math.abs(t.y)>s?r="y":Math.abs(t.x)>s&&(r="x"),r}class JC extends Da{constructor(s){super(s),this.removeGroupControls=_s,this.removeListeners=_s,this.controls=new ZC(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||_s}unmount(){this.removeGroupControls(),this.removeListeners()}}const ih=t=>(s,r)=>{t&&Et.postRender(()=>t(s,r))};class eP extends Da{constructor(){super(...arguments),this.removePointerDownListener=_s}onPointerDown(s){this.session=new wv(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ev(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:r,onPan:a,onPanEnd:n}=this.node.getProps();return{onSessionStart:ih(s),onStart:ih(r),onMove:a,onEnd:(i,o)=>{delete this.session,n&&Et.postRender(()=>n(i,o))}}}mount(){this.removePointerDownListener=ya(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Gd=h.createContext(null);function tP(){const t=h.useContext(Gd);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:r,register:a}=t,n=h.useId();h.useEffect(()=>a(n),[]);const i=h.useCallback(()=>r&&r(n),[n,r]);return!s&&r?[!1,i]:[!0]}const Dv=h.createContext({}),Mv=h.createContext({}),vo={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function oh(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const Xn={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(ze.test(t))t=parseFloat(t);else return t;const r=oh(t,s.target.x),a=oh(t,s.target.y);return`${r}% ${a}%`}},sP={correct:(t,{treeScale:s,projectionDelta:r})=>{const a=t,n=ka.parse(t);if(n.length>5)return a;const i=ka.createTransformer(t),o=typeof n[0]!="number"?1:0,l=r.x.scale*s.x,u=r.y.scale*s.y;n[0+o]/=l,n[1+o]/=u;const d=qt(l,u,.5);return typeof n[2+o]=="number"&&(n[2+o]/=d),typeof n[3+o]=="number"&&(n[3+o]/=d),i(n)}},Mo={};function rP(t){Object.assign(Mo,t)}const{schedule:Qd}=Ry(queueMicrotask,!1);class aP extends h.Component{componentDidMount(){const{visualElement:s,layoutGroup:r,switchLayoutGroup:a,layoutId:n}=this.props,{projection:i}=s;rP(nP),i&&(r.group&&r.group.add(i),a&&a.register&&n&&a.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),vo.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:r,visualElement:a,drag:n,isPresent:i}=this.props,o=a.projection;return o&&(o.isPresent=i,n||s.layoutDependency!==r||r===void 0?o.willUpdate():this.safeToRemove(),s.isPresent!==i&&(i?o.promote():o.relegate()||Et.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),Qd.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:r,switchLayoutGroup:a}=this.props,{projection:n}=s;n&&(n.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(n),a&&a.deregister&&a.deregister(n))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function Rv(t){const[s,r]=tP(),a=h.useContext(Dv);return e.jsx(aP,{...t,layoutGroup:a,switchLayoutGroup:h.useContext(Mv),isPresent:s,safeToRemove:r})}const nP={borderRadius:{...Xn,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Xn,borderTopRightRadius:Xn,borderBottomLeftRadius:Xn,borderBottomRightRadius:Xn,boxShadow:sP},Iv=["TopLeft","TopRight","BottomLeft","BottomRight"],iP=Iv.length,lh=t=>typeof t=="string"?parseFloat(t):t,ch=t=>typeof t=="number"||ze.test(t);function oP(t,s,r,a,n,i){n?(t.opacity=qt(0,r.opacity!==void 0?r.opacity:1,lP(a)),t.opacityExit=qt(s.opacity!==void 0?s.opacity:1,0,cP(a))):i&&(t.opacity=qt(s.opacity!==void 0?s.opacity:1,r.opacity!==void 0?r.opacity:1,a));for(let o=0;o<iP;o++){const l=`border${Iv[o]}Radius`;let u=dh(s,l),d=dh(r,l);if(u===void 0&&d===void 0)continue;u||(u=0),d||(d=0),u===0||d===0||ch(u)===ch(d)?(t[l]=Math.max(qt(lh(u),lh(d),a),0),(Er.test(d)||Er.test(u))&&(t[l]+="%")):t[l]=d}(s.rotate||r.rotate)&&(t.rotate=qt(s.rotate||0,r.rotate||0,a))}function dh(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const lP=Fv(0,.5,zy),cP=Fv(.5,.95,_s);function Fv(t,s,r){return a=>a<t?0:a>s?1:r(_n(t,s,a))}function uh(t,s){t.min=s.min,t.max=s.max}function sr(t,s){uh(t.x,s.x),uh(t.y,s.y)}function mh(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}function hh(t,s,r,a,n){return t-=s,t=Do(t,1/r,a),n!==void 0&&(t=Do(t,1/n,a)),t}function dP(t,s=0,r=1,a=.5,n,i=t,o=t){if(Er.test(s)&&(s=parseFloat(s),s=qt(o.min,o.max,s/100)-o.min),typeof s!="number")return;let l=qt(i.min,i.max,a);t===i&&(l-=s),t.min=hh(t.min,s,r,l,n),t.max=hh(t.max,s,r,l,n)}function fh(t,s,[r,a,n],i,o){dP(t,s[r],s[a],s[n],s.scale,i,o)}const uP=["x","scaleX","originX"],mP=["y","scaleY","originY"];function ph(t,s,r,a){fh(t.x,s,uP,r?r.x:void 0,a?a.x:void 0),fh(t.y,s,mP,r?r.y:void 0,a?a.y:void 0)}function xh(t){return t.translate===0&&t.scale===1}function Ov(t){return xh(t.x)&&xh(t.y)}function gh(t,s){return t.min===s.min&&t.max===s.max}function hP(t,s){return gh(t.x,s.x)&&gh(t.y,s.y)}function yh(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function $v(t,s){return yh(t.x,s.x)&&yh(t.y,s.y)}function vh(t){return er(t.x)/er(t.y)}function bh(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}class fP{constructor(){this.members=[]}add(s){Ud(this.members,s),s.scheduleRender()}remove(s){if(Wd(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(s){const r=this.members.findIndex(n=>s===n);if(r===0)return!1;let a;for(let n=r;n>=0;n--){const i=this.members[n];if(i.isPresent!==!1){a=i;break}}return a?(this.promote(a),!0):!1}promote(s,r){const a=this.lead;if(s!==a&&(this.prevLead=a,this.lead=s,s.show(),a)){a.instance&&a.scheduleRender(),s.scheduleRender(),s.resumeFrom=a,r&&(s.resumeFrom.preserveOpacity=!0),a.snapshot&&(s.snapshot=a.snapshot,s.snapshot.latestValues=a.animationValues||a.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:n}=s.options;n===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:r,resumingFrom:a}=s;r.onExitComplete&&r.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function pP(t,s,r){let a="";const n=t.x.translate/s.x,i=t.y.translate/s.y,o=r?.z||0;if((n||i||o)&&(a=`translate3d(${n}px, ${i}px, ${o}px) `),(s.x!==1||s.y!==1)&&(a+=`scale(${1/s.x}, ${1/s.y}) `),r){const{transformPerspective:d,rotate:c,rotateX:f,rotateY:m,skewX:y,skewY:x}=r;d&&(a=`perspective(${d}px) ${a}`),c&&(a+=`rotate(${c}deg) `),f&&(a+=`rotateX(${f}deg) `),m&&(a+=`rotateY(${m}deg) `),y&&(a+=`skewX(${y}deg) `),x&&(a+=`skewY(${x}deg) `)}const l=t.x.scale*s.x,u=t.y.scale*s.y;return(l!==1||u!==1)&&(a+=`scale(${l}, ${u})`),a||"none"}const xP=(t,s)=>t.depth-s.depth;class gP{constructor(){this.children=[],this.isDirty=!1}add(s){Ud(this.children,s),this.isDirty=!0}remove(s){Wd(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(xP),this.isDirty=!1,this.children.forEach(s)}}function bo(t){const s=Ps(t)?t.get():t;return nC(s)?s.toValue():s}function yP(t,s){const r=Dr.now(),a=({timestamp:n})=>{const i=n-r;i>=s&&(wa(a),t(i-s))};return Et.read(a,!0),()=>wa(a)}function vP(t){return t instanceof SVGElement&&t.tagName!=="svg"}function bP(t,s,r){const a=Ps(t)?t:ji(t);return a.start(qd("",a,s,r)),a.animation}const Fa={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},si=typeof window<"u"&&window.MotionDebug!==void 0,ec=["","X","Y","Z"],jP={visibility:"hidden"},jh=1e3;let NP=0;function tc(t,s,r,a){const{latestValues:n}=s;n[t]&&(r[t]=n[t],s.setStaticValue(t,0),a&&(a[t]=0))}function Lv(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const r=yv(s);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:n,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",Et,!(n||i))}const{parent:a}=t;a&&!a.hasCheckedOptimisedAppear&&Lv(a)}function Vv({attachResizeListener:t,defaultParent:s,measureScroll:r,checkIsScrollRoot:a,resetTransform:n}){return class{constructor(o={},l=s?.()){this.id=NP++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,si&&(Fa.totalNodes=Fa.resolvedTargetDeltas=Fa.recalculatedProjection=0),this.nodes.forEach(SP),this.nodes.forEach(_P),this.nodes.forEach(EP),this.nodes.forEach(TP),si&&window.MotionDebug.record(Fa)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new gP)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Kd),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const u=this.eventHandlers.get(o);u&&u.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=vP(o),this.instance=o;const{layoutId:u,layout:d,visualElement:c}=this.options;if(c&&!c.current&&c.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||u)&&(this.isLayoutDirty=!0),t){let f;const m=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=yP(m,250),vo.hasAnimatedSinceResize&&(vo.hasAnimatedSinceResize=!1,this.nodes.forEach(wh))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&c&&(u||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:m,hasRelativeTargetChanged:y,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||c.getDefaultTransition()||FP,{onLayoutAnimationStart:A,onLayoutAnimationComplete:g}=c.getProps(),N=!this.targetLayout||!$v(this.targetLayout,x)||y,w=!m&&y;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||m&&(N||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,w);const _={...Pd(p,"layout"),onPlay:A,onComplete:g};(c.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_)}else m||wh(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,wa(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(DP),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Lv(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const f=this.path[c];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:l,layout:u}=this.options;if(l===void 0&&!u)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Nh);return}this.isUpdating||this.nodes.forEach(CP),this.isUpdating=!1,this.nodes.forEach(PP),this.nodes.forEach(wP),this.nodes.forEach(kP),this.clearAllSnapshots();const l=Dr.now();vs.delta=aa(0,1e3/60,l-vs.timestamp),vs.timestamp=l,vs.isProcessing=!0,Kl.update.process(vs),Kl.preRender.process(vs),Kl.render.process(vs),vs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Qd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(AP),this.sharedNodes.forEach(MP)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Et.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Et.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Yt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l){const u=a(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:u,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!n)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Ov(this.projectionDelta),u=this.getTransformTemplate(),d=u?u(this.latestValues,""):void 0,c=d!==this.prevTransformTemplateValue;o&&(l||Ia(this.latestValues)||c)&&(n(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let u=this.removeElementScroll(l);return o&&(u=this.removeTransform(u)),OP(u),{animationId:this.root.animationId,measuredBox:l,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:l}=this.options;if(!l)return Yt();const u=l.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some($P))){const{scroll:c}=this.root;c&&(pn(u.x,c.offset.x),pn(u.y,c.offset.y))}return u}removeElementScroll(o){var l;const u=Yt();if(sr(u,o),!((l=this.scroll)===null||l===void 0)&&l.wasRoot)return u;for(let d=0;d<this.path.length;d++){const c=this.path[d],{scroll:f,options:m}=c;c!==this.root&&f&&m.layoutScroll&&(f.wasRoot&&sr(u,o),pn(u.x,f.offset.x),pn(u.y,f.offset.y))}return u}applyTransform(o,l=!1){const u=Yt();sr(u,o);for(let d=0;d<this.path.length;d++){const c=this.path[d];!l&&c.options.layoutScroll&&c.scroll&&c!==c.root&&xn(u,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),Ia(c.latestValues)&&xn(u,c.latestValues)}return Ia(this.latestValues)&&xn(u,this.latestValues),u}removeTransform(o){const l=Yt();sr(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];if(!d.instance||!Ia(d.latestValues))continue;zc(d.latestValues)&&d.updateSnapshot();const c=Yt(),f=d.measurePageBox();sr(c,f),ph(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,c)}return Ia(this.latestValues)&&ph(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==vs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var l;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==u;if(!(o||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:m}=this.options;if(!(!this.layout||!(f||m))){if(this.resolvedRelativeTargetAt=vs.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Yt(),this.relativeTargetOrigin=Yt(),ui(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),sr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Yt(),this.targetWithTransforms=Yt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),LC(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):sr(this.target,this.layout.layoutBox),Pv(this.target,this.targetDelta)):sr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Yt(),this.relativeTargetOrigin=Yt(),ui(this.relativeTargetOrigin,this.target,y.target),sr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}si&&Fa.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||zc(this.parent.latestValues)||Cv(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const l=this.getLead(),u=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(d=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===vs.timestamp&&(d=!1),d)return;const{layout:c,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||f))return;sr(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,y=this.treeScale.y;GC(this.layoutCorrected,this.treeScale,this.path,u),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=Yt());const{target:x}=l;if(!x){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(mh(this.prevProjectionDelta.x,this.projectionDelta.x),mh(this.prevProjectionDelta.y,this.projectionDelta.y)),di(this.projectionDelta,this.layoutCorrected,x,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==y||!bh(this.projectionDelta.x,this.prevProjectionDelta.x)||!bh(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x)),si&&Fa.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var l;if((l=this.options.visualElement)===null||l===void 0||l.scheduleRender(),o){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=fn(),this.projectionDelta=fn(),this.projectionDeltaWithTransform=fn()}setAnimationOrigin(o,l=!1){const u=this.snapshot,d=u?u.latestValues:{},c={...this.latestValues},f=fn();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const m=Yt(),y=u?u.source:void 0,x=this.layout?this.layout.source:void 0,p=y!==x,A=this.getStack(),g=!A||A.members.length<=1,N=!!(p&&!g&&this.options.crossfade===!0&&!this.path.some(IP));this.animationProgress=0;let w;this.mixTargetDelta=_=>{const b=_/1e3;kh(f.x,o.x,b),kh(f.y,o.y,b),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ui(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),RP(this.relativeTarget,this.relativeTargetOrigin,m,b),w&&hP(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Yt()),sr(w,this.relativeTarget)),p&&(this.animationValues=c,oP(c,d,this.latestValues,b,N,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(wa(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Et.update(()=>{vo.hasAnimatedSinceResize=!0,this.currentAnimation=bP(0,jh,{...o,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(jh),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:u,layout:d,latestValues:c}=o;if(!(!l||!u||!d)){if(this!==o&&this.layout&&d&&zv(this.options.animationType,this.layout.layoutBox,d.layoutBox)){u=this.target||Yt();const f=er(this.layout.layoutBox.x);u.x.min=o.target.x.min,u.x.max=u.x.min+f;const m=er(this.layout.layoutBox.y);u.y.min=o.target.y.min,u.y.max=u.y.min+m}sr(l,u),xn(l,c),di(this.projectionDeltaWithTransform,this.layoutCorrected,l,c)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new fP),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:l}=this.options;return l?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:l}=this.options;return l?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:u}={}){const d=this.getStack();d&&d.promote(this,u),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:u}=o;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(l=!0),!l)return;const d={};u.z&&tc("z",o,d,this.animationValues);for(let c=0;c<ec.length;c++)tc(`rotate${ec[c]}`,o,d,this.animationValues),tc(`skew${ec[c]}`,o,d,this.animationValues);o.render();for(const c in d)o.setStaticValue(c,d[c]),this.animationValues&&(this.animationValues[c]=d[c]);o.scheduleRender()}getProjectionStyles(o){var l,u;if(!this.instance||this.isSVG)return;if(!this.isVisible)return jP;const d={visibility:""},c=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=bo(o?.pointerEvents)||"",d.transform=c?c(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const p={};return this.options.layoutId&&(p.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,p.pointerEvents=bo(o?.pointerEvents)||""),this.hasProjected&&!Ia(this.latestValues)&&(p.transform=c?c({},""):"none",this.hasProjected=!1),p}const m=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=pP(this.projectionDeltaWithTransform,this.treeScale,m),c&&(d.transform=c(m,d.transform));const{x:y,y:x}=this.projectionDelta;d.transformOrigin=`${y.origin*100}% ${x.origin*100}% 0`,f.animationValues?d.opacity=f===this?(u=(l=m.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&u!==void 0?u:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:d.opacity=f===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const p in Mo){if(m[p]===void 0)continue;const{correct:A,applyTo:g}=Mo[p],N=d.transform==="none"?m[p]:A(m[p],f);if(g){const w=g.length;for(let _=0;_<w;_++)d[g[_]]=N}else d[p]=N}return this.options.layoutId&&(d.pointerEvents=f===this?bo(o?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var l;return(l=o.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(Nh),this.root.sharedNodes.clear()}}}function wP(t){t.updateLayout()}function kP(t){var s;const r=((s=t.resumeFrom)===null||s===void 0?void 0:s.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&r&&t.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:n}=t.layout,{animationType:i}=t.options,o=r.source!==t.layout.source;i==="size"?rr(f=>{const m=o?r.measuredBox[f]:r.layoutBox[f],y=er(m);m.min=a[f].min,m.max=m.min+y}):zv(i,r.layoutBox,a)&&rr(f=>{const m=o?r.measuredBox[f]:r.layoutBox[f],y=er(a[f]);m.max=m.min+y,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[f].max=t.relativeTarget[f].min+y)});const l=fn();di(l,a,r.layoutBox);const u=fn();o?di(u,t.applyTransform(n,!0),r.measuredBox):di(u,a,r.layoutBox);const d=!Ov(l);let c=!1;if(!t.resumeFrom){const f=t.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:m,layout:y}=f;if(m&&y){const x=Yt();ui(x,r.layoutBox,m.layoutBox);const p=Yt();ui(p,a,y.layoutBox),$v(x,p)||(c=!0),f.options.layoutRoot&&(t.relativeTarget=p,t.relativeTargetOrigin=x,t.relativeParent=f)}}}t.notifyListeners("didUpdate",{layout:a,snapshot:r,delta:u,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:c})}else if(t.isLead()){const{onExitComplete:a}=t.options;a&&a()}t.options.transition=void 0}function SP(t){si&&Fa.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function TP(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function AP(t){t.clearSnapshot()}function Nh(t){t.clearMeasurements()}function CP(t){t.isLayoutDirty=!1}function PP(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function wh(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function _P(t){t.resolveTargetDelta()}function EP(t){t.calcProjection()}function DP(t){t.resetSkewAndRotation()}function MP(t){t.removeLeadSnapshot()}function kh(t,s,r){t.translate=qt(s.translate,0,r),t.scale=qt(s.scale,1,r),t.origin=s.origin,t.originPoint=s.originPoint}function Sh(t,s,r,a){t.min=qt(s.min,r.min,a),t.max=qt(s.max,r.max,a)}function RP(t,s,r,a){Sh(t.x,s.x,r.x,a),Sh(t.y,s.y,r.y,a)}function IP(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const FP={duration:.45,ease:[.4,0,.1,1]},Th=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Ah=Th("applewebkit/")&&!Th("chrome/")?Math.round:_s;function Ch(t){t.min=Ah(t.min),t.max=Ah(t.max)}function OP(t){Ch(t.x),Ch(t.y)}function zv(t,s,r){return t==="position"||t==="preserve-aspect"&&!$C(vh(s),vh(r),.2)}function $P(t){var s;return t!==t.root&&((s=t.scroll)===null||s===void 0?void 0:s.wasRoot)}const LP=Vv({attachResizeListener:(t,s)=>Qr(t,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),sc={current:void 0},Bv=Vv({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!sc.current){const t=new LP({});t.mount(window),t.setOptions({layoutScroll:!0}),sc.current=t}return sc.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),VP={pan:{Feature:eP},drag:{Feature:JC,ProjectionNode:Bv,MeasureLayout:Rv}};function Ph(t,s,r){const{props:a}=t;t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",r);const n=a[r?"onHoverStart":"onHoverEnd"];n&&Et.postRender(()=>n(s,Gi(s)))}class zP extends Da{mount(){const{current:s,props:r}=this.node;s&&(this.unmount=CC(s,a=>(Ph(this.node,a,!0),n=>Ph(this.node,n,!1)),{passive:!r.onHoverStart&&!r.onHoverEnd}))}unmount(){}}class BP extends Da{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ga(Qr(this.node.current,"focus",()=>this.onFocus()),Qr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const qv=(t,s)=>s?t===s?!0:qv(t,s.parentElement):!1;function rc(t,s){if(!s)return;const r=new PointerEvent("pointer"+t);s(r,Gi(r))}class qP extends Da{constructor(){super(...arguments),this.removeStartListeners=_s,this.removeEndListeners=_s,this.removeAccessibleListeners=_s,this.startPointerPress=(s,r)=>{if(this.isPressing)return;this.removeEndListeners();const a=this.node.getProps(),i=ya(window,"pointerup",(l,u)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:c,globalTapTarget:f}=this.node.getProps(),m=!f&&!qv(this.node.current,l.target)?c:d;m&&Et.update(()=>m(l,u))},{passive:!(a.onTap||a.onPointerUp)}),o=ya(window,"pointercancel",(l,u)=>this.cancelPress(l,u),{passive:!(a.onTapCancel||a.onPointerCancel)});this.removeEndListeners=ga(i,o),this.startPress(s,r)},this.startAccessiblePress=()=>{const s=i=>{if(i.key!=="Enter"||this.isPressing)return;const o=l=>{l.key!=="Enter"||!this.checkPressEnd()||rc("up",(u,d)=>{const{onTap:c}=this.node.getProps();c&&Et.postRender(()=>c(u,d))})};this.removeEndListeners(),this.removeEndListeners=Qr(this.node.current,"keyup",o),rc("down",(l,u)=>{this.startPress(l,u)})},r=Qr(this.node.current,"keydown",s),a=()=>{this.isPressing&&rc("cancel",(i,o)=>this.cancelPress(i,o))},n=Qr(this.node.current,"blur",a);this.removeAccessibleListeners=ga(r,n)}}startPress(s,r){this.isPressing=!0;const{onTapStart:a,whileTap:n}=this.node.getProps();n&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),a&&Et.postRender(()=>a(s,r))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!jv()}cancelPress(s,r){if(!this.checkPressEnd())return;const{onTapCancel:a}=this.node.getProps();a&&Et.postRender(()=>a(s,r))}mount(){const s=this.node.getProps(),r=ya(s.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(s.onTapStart||s.onPointerStart)}),a=Qr(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=ga(r,a)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const qc=new WeakMap,ac=new WeakMap,UP=t=>{const s=qc.get(t.target);s&&s(t)},WP=t=>{t.forEach(UP)};function KP({root:t,...s}){const r=t||document;ac.has(r)||ac.set(r,{});const a=ac.get(r),n=JSON.stringify(s);return a[n]||(a[n]=new IntersectionObserver(WP,{root:t,...s})),a[n]}function HP(t,s,r){const a=KP(s);return qc.set(t,r),a.observe(t),()=>{qc.delete(t),a.unobserve(t)}}const GP={some:0,all:1};class QP extends Da{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:r,margin:a,amount:n="some",once:i}=s,o={root:r?r.current:void 0,rootMargin:a,threshold:typeof n=="number"?n:GP[n]},l=u=>{const{isIntersecting:d}=u;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:c,onViewportLeave:f}=this.node.getProps(),m=d?c:f;m&&m(u)};return HP(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:r}=this.node;["amount","margin","root"].some(XP(s,r))&&this.startObserver()}unmount(){}}function XP({viewport:t={}},{viewport:s={}}={}){return r=>t[r]!==s[r]}const ZP={inView:{Feature:QP},tap:{Feature:qP},focus:{Feature:BP},hover:{Feature:zP}},YP={layout:{ProjectionNode:Bv,MeasureLayout:Rv}},Uv=h.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),gl=h.createContext({}),Xd=typeof window<"u",JP=Xd?h.useLayoutEffect:h.useEffect,Wv=h.createContext({strict:!1});function e_(t,s,r,a,n){var i,o;const{visualElement:l}=h.useContext(gl),u=h.useContext(Wv),d=h.useContext(Gd),c=h.useContext(Uv).reducedMotion,f=h.useRef();a=a||u.renderer,!f.current&&a&&(f.current=a(t,{visualState:s,parent:l,props:r,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:c}));const m=f.current,y=h.useContext(Mv);m&&!m.projection&&n&&(m.type==="html"||m.type==="svg")&&t_(f.current,r,n,y);const x=h.useRef(!1);h.useInsertionEffect(()=>{m&&x.current&&m.update(r,d)});const p=r[gv],A=h.useRef(!!p&&!(!((i=window.MotionHandoffIsComplete)===null||i===void 0)&&i.call(window,p))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,p)));return JP(()=>{m&&(x.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Qd.render(m.render),A.current&&m.animationState&&m.animationState.animateChanges())}),h.useEffect(()=>{m&&(!A.current&&m.animationState&&m.animationState.animateChanges(),A.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)===null||g===void 0||g.call(window,p)}),A.current=!1))}),m}function t_(t,s,r,a){const{layoutId:n,layout:i,drag:o,dragConstraints:l,layoutScroll:u,layoutRoot:d}=s;t.projection=new r(t.latestValues,s["data-framer-portal-id"]?void 0:Kv(t.parent)),t.projection.setOptions({layoutId:n,layout:i,alwaysMeasureLayout:!!o||l&&hn(l),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:a,layoutScroll:u,layoutRoot:d})}function Kv(t){if(t)return t.options.allowProjection!==!1?t.projection:Kv(t.parent)}function s_(t,s,r){return h.useCallback(a=>{a&&t.mount&&t.mount(a),s&&(a?s.mount(a):s.unmount()),r&&(typeof r=="function"?r(a):hn(r)&&(r.current=a))},[s])}function yl(t){return fl(t.animate)||Cd.some(s=>yi(t[s]))}function Hv(t){return!!(yl(t)||t.variants)}function r_(t,s){if(yl(t)){const{initial:r,animate:a}=t;return{initial:r===!1||yi(r)?r:void 0,animate:yi(a)?a:void 0}}return t.inherit!==!1?s:{}}function a_(t){const{initial:s,animate:r}=r_(t,h.useContext(gl));return h.useMemo(()=>({initial:s,animate:r}),[_h(s),_h(r)])}function _h(t){return Array.isArray(t)?t.join(" "):t}const Eh={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},En={};for(const t in Eh)En[t]={isEnabled:s=>Eh[t].some(r=>!!s[r])};function n_(t){for(const s in t)En[s]={...En[s],...t[s]}}const i_=Symbol.for("motionComponentSymbol");function o_({preloadedFeatures:t,createVisualElement:s,useRender:r,useVisualState:a,Component:n}){t&&n_(t);function i(l,u){let d;const c={...h.useContext(Uv),...l,layoutId:l_(l)},{isStatic:f}=c,m=a_(l),y=a(l,f);if(!f&&Xd){c_();const x=d_(c);d=x.MeasureLayout,m.visualElement=e_(n,y,c,s,x.ProjectionNode)}return e.jsxs(gl.Provider,{value:m,children:[d&&m.visualElement?e.jsx(d,{visualElement:m.visualElement,...c}):null,r(n,l,s_(y,m.visualElement,u),y,f,m.visualElement)]})}const o=h.forwardRef(i);return o[i_]=n,o}function l_({layoutId:t}){const s=h.useContext(Dv).id;return s&&t!==void 0?s+"-"+t:t}function c_(t,s){h.useContext(Wv).strict}function d_(t){const{drag:s,layout:r}=En;if(!s&&!r)return{};const a={...s,...r};return{MeasureLayout:s?.isEnabled(t)||r?.isEnabled(t)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const u_=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Zd(t){return typeof t!="string"||t.includes("-")?!1:!!(u_.indexOf(t)>-1||/[A-Z]/u.test(t))}function Gv(t,{style:s,vars:r},a,n){Object.assign(t.style,s,n&&n.getProjectionStyles(a));for(const i in r)t.style.setProperty(i,r[i])}const Qv=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Xv(t,s,r,a){Gv(t,s,void 0,a);for(const n in s.attrs)t.setAttribute(Qv.has(n)?n:Hd(n),s.attrs[n])}function Zv(t,{layout:s,layoutId:r}){return sn.has(t)||t.startsWith("origin")||(s||r!==void 0)&&(!!Mo[t]||t==="opacity")}function Yd(t,s,r){var a;const{style:n}=t,i={};for(const o in n)(Ps(n[o])||s.style&&Ps(s.style[o])||Zv(o,t)||((a=r?.getValue(o))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(i[o]=n[o]);return i}function Yv(t,s,r){const a=Yd(t,s,r);for(const n in t)if(Ps(t[n])||Ps(s[n])){const i=Wi.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;a[i]=t[n]}return a}function m_(t){const s=h.useRef(null);return s.current===null&&(s.current=t()),s.current}function h_({scrapeMotionValuesFromProps:t,createRenderState:s,onMount:r},a,n,i){const o={latestValues:f_(a,n,i,t),renderState:s()};return r&&(o.mount=l=>r(a,l,o)),o}const Jv=t=>(s,r)=>{const a=h.useContext(gl),n=h.useContext(Gd),i=()=>h_(t,s,a,n);return r?i():m_(i)};function f_(t,s,r,a){const n={},i=a(t,{});for(const m in i)n[m]=bo(i[m]);let{initial:o,animate:l}=t;const u=yl(t),d=Hv(t);s&&d&&!u&&t.inherit!==!1&&(o===void 0&&(o=s.initial),l===void 0&&(l=s.animate));let c=r?r.initial===!1:!1;c=c||o===!1;const f=c?l:o;if(f&&typeof f!="boolean"&&!fl(f)){const m=Array.isArray(f)?f:[f];for(let y=0;y<m.length;y++){const x=Td(t,m[y]);if(x){const{transitionEnd:p,transition:A,...g}=x;for(const N in g){let w=g[N];if(Array.isArray(w)){const _=c?w.length-1:0;w=w[_]}w!==null&&(n[N]=w)}for(const N in p)n[N]=p[N]}}}return n}const Jd=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),eb=()=>({...Jd(),attrs:{}}),tb=(t,s)=>s&&typeof t=="number"?s.transform(t):t,p_={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},x_=Wi.length;function g_(t,s,r){let a="",n=!0;for(let i=0;i<x_;i++){const o=Wi[i],l=t[o];if(l===void 0)continue;let u=!0;if(typeof l=="number"?u=l===(o.startsWith("scale")?1:0):u=parseFloat(l)===0,!u||r){const d=tb(l,Fd[o]);if(!u){n=!1;const c=p_[o]||o;a+=`${c}(${d}) `}r&&(s[o]=d)}}return a=a.trim(),r?a=r(s,n?"":a):n&&(a="none"),a}function eu(t,s,r){const{style:a,vars:n,transformOrigin:i}=t;let o=!1,l=!1;for(const u in s){const d=s[u];if(sn.has(u)){o=!0;continue}else if(Ky(u)){n[u]=d;continue}else{const c=tb(d,Fd[u]);u.startsWith("origin")?(l=!0,i[u]=c):a[u]=c}}if(s.transform||(o||r?a.transform=g_(s,t.transform,r):a.transform&&(a.transform="none")),l){const{originX:u="50%",originY:d="50%",originZ:c=0}=i;a.transformOrigin=`${u} ${d} ${c}`}}function Dh(t,s,r){return typeof t=="string"?t:ze.transform(s+r*t)}function y_(t,s,r){const a=Dh(s,t.x,t.width),n=Dh(r,t.y,t.height);return`${a} ${n}`}const v_={offset:"stroke-dashoffset",array:"stroke-dasharray"},b_={offset:"strokeDashoffset",array:"strokeDasharray"};function j_(t,s,r=1,a=0,n=!0){t.pathLength=1;const i=n?v_:b_;t[i.offset]=ze.transform(-a);const o=ze.transform(s),l=ze.transform(r);t[i.array]=`${o} ${l}`}function tu(t,{attrX:s,attrY:r,attrScale:a,originX:n,originY:i,pathLength:o,pathSpacing:l=1,pathOffset:u=0,...d},c,f){if(eu(t,d,f),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:m,style:y,dimensions:x}=t;m.transform&&(x&&(y.transform=m.transform),delete m.transform),x&&(n!==void 0||i!==void 0||y.transform)&&(y.transformOrigin=y_(x,n!==void 0?n:.5,i!==void 0?i:.5)),s!==void 0&&(m.x=s),r!==void 0&&(m.y=r),a!==void 0&&(m.scale=a),o!==void 0&&j_(m,o,l,u,!1)}const su=t=>typeof t=="string"&&t.toLowerCase()==="svg",N_={useVisualState:Jv({scrapeMotionValuesFromProps:Yv,createRenderState:eb,onMount:(t,s,{renderState:r,latestValues:a})=>{Et.read(()=>{try{r.dimensions=typeof s.getBBox=="function"?s.getBBox():s.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}}),Et.render(()=>{tu(r,a,su(s.tagName),t.transformTemplate),Xv(s,r)})}})},w_={useVisualState:Jv({scrapeMotionValuesFromProps:Yd,createRenderState:Jd})};function sb(t,s,r){for(const a in s)!Ps(s[a])&&!Zv(a,r)&&(t[a]=s[a])}function k_({transformTemplate:t},s){return h.useMemo(()=>{const r=Jd();return eu(r,s,t),Object.assign({},r.vars,r.style)},[s])}function S_(t,s){const r=t.style||{},a={};return sb(a,r,t),Object.assign(a,k_(t,s)),a}function T_(t,s){const r={},a=S_(t,s);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=a,r}const A_=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ro(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||A_.has(t)}let rb=t=>!Ro(t);function C_(t){t&&(rb=s=>s.startsWith("on")?!Ro(s):t(s))}try{C_(require("@emotion/is-prop-valid").default)}catch{}function P_(t,s,r){const a={};for(const n in t)n==="values"&&typeof t.values=="object"||(rb(n)||r===!0&&Ro(n)||!s&&!Ro(n)||t.draggable&&n.startsWith("onDrag"))&&(a[n]=t[n]);return a}function __(t,s,r,a){const n=h.useMemo(()=>{const i=eb();return tu(i,s,su(a),t.transformTemplate),{...i.attrs,style:{...i.style}}},[s]);if(t.style){const i={};sb(i,t.style,t),n.style={...i,...n.style}}return n}function E_(t=!1){return(r,a,n,{latestValues:i},o)=>{const u=(Zd(r)?__:T_)(a,i,o,r),d=P_(a,typeof r=="string",t),c=r!==h.Fragment?{...d,...u,ref:n}:{},{children:f}=a,m=h.useMemo(()=>Ps(f)?f.get():f,[f]);return h.createElement(r,{...c,children:m})}}function D_(t,s){return function(a,{forwardMotionProps:n}={forwardMotionProps:!1}){const o={...Zd(a)?N_:w_,preloadedFeatures:t,useRender:E_(n),createVisualElement:s,Component:a};return o_(o)}}const Uc={current:null},ab={current:!1};function M_(){if(ab.current=!0,!!Xd)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>Uc.current=t.matches;t.addListener(s),s()}else Uc.current=!1}function R_(t,s,r){for(const a in s){const n=s[a],i=r[a];if(Ps(n))t.addValue(a,n);else if(Ps(i))t.addValue(a,ji(n,{owner:t}));else if(i!==n)if(t.hasValue(a)){const o=t.getValue(a);o.liveStyle===!0?o.jump(n):o.hasAnimated||o.set(n)}else{const o=t.getStaticValue(a);t.addValue(a,ji(o!==void 0?o:n,{owner:t}))}}for(const a in r)s[a]===void 0&&t.removeValue(a);return s}const Mh=new WeakMap,I_=[...Qy,Ts,ka],F_=t=>I_.find(Gy(t)),Rh=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class O_{scrapeMotionValuesFromProps(s,r,a){return{}}constructor({parent:s,props:r,presenceContext:a,reducedMotionConfig:n,blockInitialAnimation:i,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Md,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const m=Dr.now();this.renderScheduledAt<m&&(this.renderScheduledAt=m,Et.render(this.render,!1,!0))};const{latestValues:u,renderState:d}=o;this.latestValues=u,this.baseTarget={...u},this.initialValues=r.initial?{...u}:{},this.renderState=d,this.parent=s,this.props=r,this.presenceContext=a,this.depth=s?s.depth+1:0,this.reducedMotionConfig=n,this.options=l,this.blockInitialAnimation=!!i,this.isControllingVariants=yl(r),this.isVariantNode=Hv(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:c,...f}=this.scrapeMotionValuesFromProps(r,{},this);for(const m in f){const y=f[m];u[m]!==void 0&&Ps(y)&&y.set(u[m],!1)}}mount(s){this.current=s,Mh.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,a)=>this.bindToMotionValue(a,r)),ab.current||M_(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Uc.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Mh.delete(this.current),this.projection&&this.projection.unmount(),wa(this.notifyUpdate),wa(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const r=this.features[s];r&&(r.unmount(),r.isMounted=!1)}this.current=null}bindToMotionValue(s,r){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const a=sn.has(s),n=r.on("change",l=>{this.latestValues[s]=l,this.props.onUpdate&&Et.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),i=r.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,s,r)),this.valueSubscriptions.set(s,()=>{n(),i(),o&&o(),r.owner&&r.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in En){const r=En[s];if(!r)continue;const{isEnabled:a,Feature:n}=r;if(!this.features[s]&&n&&a(this.props)&&(this.features[s]=new n(this)),this.features[s]){const i=this.features[s];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Yt()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,r){this.latestValues[s]=r}update(s,r){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let a=0;a<Rh.length;a++){const n=Rh[a];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const i="on"+n,o=s[i];o&&(this.propEventSubscriptions[n]=this.on(n,o))}this.prevMotionValues=R_(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(s),()=>r.variantChildren.delete(s)}addValue(s,r){const a=this.values.get(s);r!==a&&(a&&this.removeValue(s),this.bindToMotionValue(s,r),this.values.set(s,r),this.latestValues[s]=r.get())}removeValue(s){this.values.delete(s);const r=this.valueSubscriptions.get(s);r&&(r(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,r){if(this.props.values&&this.props.values[s])return this.props.values[s];let a=this.values.get(s);return a===void 0&&r!==void 0&&(a=ji(r===null?void 0:r,{owner:this}),this.addValue(s,a)),a}readValue(s,r){var a;let n=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:(a=this.getBaseTargetFromProps(this.props,s))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,s,this.options);return n!=null&&(typeof n=="string"&&(Uy(n)||qy(n))?n=parseFloat(n):!F_(n)&&ka.test(r)&&(n=rv(s,r)),this.setBaseTarget(s,Ps(n)?n.get():n)),Ps(n)?n.get():n}setBaseTarget(s,r){this.baseTarget[s]=r}getBaseTarget(s){var r;const{initial:a}=this.props;let n;if(typeof a=="string"||typeof a=="object"){const o=Td(this.props,a,(r=this.presenceContext)===null||r===void 0?void 0:r.custom);o&&(n=o[s])}if(a&&n!==void 0)return n;const i=this.getBaseTargetFromProps(this.props,s);return i!==void 0&&!Ps(i)?i:this.initialValues[s]!==void 0&&n===void 0?void 0:this.baseTarget[s]}on(s,r){return this.events[s]||(this.events[s]=new Kd),this.events[s].add(r)}notify(s,...r){this.events[s]&&this.events[s].notify(...r)}}class nb extends O_{constructor(){super(...arguments),this.KeyframeResolver=av}sortInstanceNodePosition(s,r){return s.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(s,r){return s.style?s.style[r]:void 0}removeValueFromRenderState(s,{vars:r,style:a}){delete r[s],delete a[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;Ps(s)&&(this.childSubscription=s.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function $_(t){return window.getComputedStyle(t)}class L_ extends nb{constructor(){super(...arguments),this.type="html",this.renderInstance=Gv}readValueFromInstance(s,r){if(sn.has(r)){const a=Od(r);return a&&a.default||0}else{const a=$_(s),n=(Ky(r)?a.getPropertyValue(r):a[r])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(s,{transformPagePoint:r}){return _v(s,r)}build(s,r,a){eu(s,r,a.transformTemplate)}scrapeMotionValuesFromProps(s,r,a){return Yd(s,r,a)}}class V_ extends nb{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Yt}getBaseTargetFromProps(s,r){return s[r]}readValueFromInstance(s,r){if(sn.has(r)){const a=Od(r);return a&&a.default||0}return r=Qv.has(r)?r:Hd(r),s.getAttribute(r)}scrapeMotionValuesFromProps(s,r,a){return Yv(s,r,a)}build(s,r,a){tu(s,r,this.isSVGTag,a.transformTemplate)}renderInstance(s,r,a,n){Xv(s,r,a,n)}mount(s){this.isSVGTag=su(s.tagName),super.mount(s)}}const z_=(t,s)=>Zd(t)?new V_(s):new L_(s,{allowProjection:t!==h.Fragment}),B_=D_({...TC,...ZP,...VP,...YP},z_),Ss=wT(B_);function q_({size:t="md",className:s="",variant:r="default"}){const a={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return r==="professional"?e.jsxs(Ss.div,{className:`relative ${a[t]} ${s}`,animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-primary/30"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-primary border-t-transparent"}),e.jsx(Ss.div,{className:"absolute inset-1 rounded-full bg-gradient-to-br from-primary to-secondary opacity-20",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}):r==="minimal"?e.jsx(Ss.div,{className:`${a[t]} border-2 border-muted border-t-primary rounded-full ${s}`,animate:{rotate:360},transition:{duration:.8,repeat:1/0,ease:"linear"}}):e.jsx("div",{className:`animate-spin rounded-full border-2 border-gray-300 border-t-primary ${a[t]} ${s}`})}function U_(){return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx(q_,{size:"lg"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"جاري التحميل..."})]})})}const ib=h.createContext(void 0);function W_({children:t}){const[s,r]=h.useState(null),[a,n]=h.useState("إضافة جديد"),i=h.useCallback((o,l="إضافة جديد")=>{r(u=>u===o?u:o),n(u=>u===l?u:l)},[]);return e.jsx(ib.Provider,{value:{setFloatingAction:i,floatingAction:s,floatingLabel:a},children:t})}function Ls(){const t=h.useContext(ib);if(t===void 0)throw new Error("useFloatingButton must be used within a FloatingButtonProvider");return t}function K_(){const[,t]=Or(),{selectedProjectId:s,selectProject:r}=_a(),[a,n]=h.useState(!1),[i,o]=h.useState(!1),[l,u]=h.useState(!1),[d,c]=h.useState({name:"",phone:"",type:"",dailyWage:""}),[f,m]=h.useState(!1),[y,x]=h.useState(""),[p,A]=h.useState({name:"",status:"active",description:""}),g=Mt(),{setFloatingAction:N}=Ls(),{toast:w}=Ct(),_=async(j,V)=>{if(!(!V||typeof V!="string"||!V.trim()))try{await ae("/api/autocomplete","POST",{category:j,value:V.trim()})}catch(ne){console.log(`Failed to save autocomplete value for ${j}:`,ne)}},{data:b=[],isLoading:k,error:R}=ge({queryKey:["/api/projects/with-stats"],queryFn:async()=>{try{console.log("🔄 [Dashboard] جلب المشاريع مع الإحصائيات...");const j=await ae("/api/projects/with-stats","GET");console.log("📊 [Dashboard] استجابة المشاريع:",j);let V=[];return j&&typeof j=="object"&&(j.success!==void 0&&j.data!==void 0?(V=Array.isArray(j.data)?j.data:[],console.log("✅ [Dashboard] استخراج البيانات من response.data")):Array.isArray(j)?(V=j,console.log("✅ [Dashboard] استخدام الاستجابة كمصفوفة مباشرة")):j.id?(V=[j],console.log("✅ [Dashboard] تحويل كائن واحد لمصفوفة")):j.data&&(V=Array.isArray(j.data)?j.data:[],console.log("✅ [Dashboard] استخراج البيانات من data فقط"))),Array.isArray(V)||(console.warn("⚠️ [Dashboard] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),V=[]),console.log(`✅ [Dashboard] تم جلب ${V.length} مشروع مع الإحصائيات`),V}catch(j){return console.error("❌ [Dashboard] خطأ في جلب المشاريع:",j),[]}},staleTime:1e3*30,refetchInterval:1e3*60,retry:2,refetchOnWindowFocus:!1}),{data:I=[]}=ge({queryKey:["/api/worker-types"],queryFn:async()=>{try{const j=await ae("/api/worker-types","GET");return j&&j.data&&Array.isArray(j.data)?j.data:Array.isArray(j)?j:[]}catch(j){return console.error("Error fetching worker types:",j),[]}}}),E=Ce({mutationFn:async j=>(await Promise.all([_("workerNames",j.name),_("workerTypes",j.type)]),ae("/api/workers","POST",j)),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/autocomplete"]}),g.invalidateQueries({queryKey:["/api/workers"]}),w({title:"نجح الحفظ",description:"تم إضافة العامل بنجاح"}),o(!1),c({name:"",phone:"",type:"",dailyWage:""})},onError:j=>{w({title:"خطأ",description:"حدث خطأ أثناء إضافة العامل",variant:"destructive"})}}),O=Ce({mutationFn:async j=>(await Promise.all([_("projectNames",j.name),_("projectDescriptions",j.description)]),ae("/api/projects","POST",j)),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/autocomplete"]}),g.invalidateQueries({queryKey:["/api/projects"]}),g.invalidateQueries({queryKey:["/api/projects/with-stats"]}),w({title:"نجح الحفظ",description:"تم إضافة المشروع بنجاح"}),u(!1),A({name:"",status:"active",description:""})},onError:j=>{w({title:"خطأ",description:"حدث خطأ أثناء إضافة المشروع",variant:"destructive"})}}),T=Ce({mutationFn:async j=>(await _("workerTypes",j.name),ae("/api/worker-types","POST",j)),onSuccess:j=>{g.invalidateQueries({queryKey:["/api/autocomplete"]}),w({title:"تم الحفظ",description:"تم إضافة نوع العامل بنجاح"}),c({...d,type:j.name}),x(""),m(!1),g.invalidateQueries({queryKey:["/api/worker-types"]})},onError:j=>{w({title:"خطأ",description:"حدث خطأ أثناء إضافة نوع العامل",variant:"destructive"})}}),{data:S}=ge({queryKey:["/api/projects",s,"daily-summary",new Date().toISOString().split("T")[0]],enabled:!!s,staleTime:1e3*30}),M=Array.isArray(b)?b.find(j=>j.id===s):void 0;h.useEffect(()=>(N(()=>{n(!a)},"إضافة"),()=>N(null)),[N,a]),h.useEffect(()=>{M&&(console.log("🔍 بيانات المشروع المحدد في Frontend:",{projectId:M.id,projectName:M.name,totalIncome:M.stats?.totalIncome,totalExpenses:M.stats?.totalExpenses,currentBalance:M.stats?.currentBalance}),M.name.includes("الحبشي")&&console.warn("🚨 مشروع الحبشي - تحقق من البيانات:",{مشروع:M.name,الدخل:M.stats?.totalIncome,المصاريف:M.stats?.totalExpenses,هل_متساوية:M.stats?.totalIncome===M.stats?.totalExpenses,fullStats:M.stats}))},[M]);const v=j=>{if(typeof j!="number"){const V=parseFloat(String(j));if(isNaN(V))return"0 ر.ي";j=V}return new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(j)+" ر.ي"},W=[{icon:Ut,label:"تسجيل حضور",bgColor:"bg-primary",hoverColor:"hover:bg-primary/90",textColor:"text-primary-foreground",action:()=>t("/worker-attendance")},{icon:li,label:"مصروفات يومية",bgColor:"bg-secondary",hoverColor:"hover:bg-secondary/90",textColor:"text-secondary-foreground",action:()=>t("/daily-expenses")},{icon:bd,label:"شراء مواد",bgColor:"bg-success",hoverColor:"hover:bg-success/90",textColor:"text-success-foreground",action:()=>t("/material-purchase")},{icon:Mk,label:"التقارير",bgColor:"bg-purple-600",hoverColor:"hover:bg-purple-700",textColor:"text-white",action:()=>t("/reports")},{icon:fa,label:"ترحيل أموال",bgColor:"bg-orange-600",hoverColor:"hover:bg-orange-700",textColor:"text-white",action:()=>t("/project-transfers")},{icon:rs,label:"إعدادات القوالب",bgColor:"bg-indigo-600",hoverColor:"hover:bg-indigo-700",textColor:"text-white",action:()=>t("/report-template-settings-enhanced")}];return k?e.jsx(U_,{}):e.jsxs("div",{className:"p-4 fade-in",children:[e.jsx(Ea,{selectedProjectId:s,onProjectChange:(j,V)=>r(j,V)}),M&&e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground",children:M.name}),e.jsx(le,{variant:"secondary",className:"bg-success text-success-foreground",children:"نشط"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(et,{title:"إجمالي التوريد",value:M?.stats?.totalIncome||0,icon:Kt,color:"blue",formatter:v}),e.jsx(et,{title:"إجمالي المنصرف",value:M?.stats?.totalExpenses||0,icon:An,color:"red",formatter:v}),e.jsx(et,{title:"المتبقي الحالي",value:M?.stats?.currentBalance||0,icon:us,color:"green",formatter:v}),e.jsx(et,{title:"العمال النشطين",value:M?.stats?.activeWorkers||"0",icon:Ui,color:"purple"}),e.jsx(et,{title:"أيام العمل المكتملة",value:M?.stats?.completedDays||"0",icon:or,color:"teal"}),e.jsx(et,{title:"مشتريات المواد",value:M?.stats?.materialPurchases||"0",icon:ra,color:"indigo"})]})]})}),e.jsx(q,{children:e.jsxs(H,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground mb-4",children:"إجراءات سريعة"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.isArray(W)&&W.map((j,V)=>{const ne=j.icon;return e.jsxs($,{onClick:j.action,className:`${j.bgColor} ${j.hoverColor} ${j.textColor} p-4 h-auto flex-col space-y-2 transition-colors`,children:[e.jsx(ne,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm font-medium",children:j.label})]},V)})})]})}),a&&e.jsxs("div",{className:"fixed bottom-20 right-4 z-50 space-y-2",children:[e.jsxs($,{onClick:()=>{o(!0),n(!1)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white shadow-lg rounded-full px-4 py-3",size:"sm",children:[e.jsx(Zs,{className:"h-4 w-4"}),e.jsx("span",{children:"إضافة عامل"})]}),e.jsxs($,{onClick:()=>{u(!0),n(!1)},className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white shadow-lg rounded-full px-4 py-3",size:"sm",children:[e.jsx(Bk,{className:"h-4 w-4"}),e.jsx("span",{children:"إضافة مشروع"})]})]}),a&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-20",onClick:()=>n(!1)}),e.jsx(qs,{open:i,onOpenChange:o,children:e.jsxs(Fs,{className:"max-w-md",children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:"إضافة عامل جديد"}),e.jsx(Ys,{children:"أدخل بيانات العامل الجديد لإضافته إلى النظام"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(se,{htmlFor:"worker-name",children:"اسم العامل"}),e.jsx(be,{id:"worker-name",value:d.name,onChange:j=>c({...d,name:j.target.value}),placeholder:"أدخل اسم العامل"})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"worker-phone",children:"رقم الهاتف"}),e.jsx(be,{id:"worker-phone",value:d.phone,onChange:j=>c({...d,phone:j.target.value}),placeholder:"أدخل رقم الهاتف"})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"worker-type",children:"نوع العامل"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(qe,{value:d.type,onValueChange:j=>c({...d,type:j}),children:[e.jsx(Oe,{className:"flex-1",children:e.jsx(Ue,{placeholder:"اختر نوع العامل..."})}),e.jsxs($e,{children:[Array.isArray(I)?I.map(j=>e.jsx(K,{value:j.value,children:j.value},j.id)):null,I.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{value:"معلم",children:"معلم"}),e.jsx(K,{value:"عامل",children:"عامل"}),e.jsx(K,{value:"حداد",children:"حداد"}),e.jsx(K,{value:"نجار",children:"نجار"}),e.jsx(K,{value:"سائق",children:"سائق"}),e.jsx(K,{value:"كهربائي",children:"كهربائي"}),e.jsx(K,{value:"سباك",children:"سباك"})]})]})]}),e.jsxs(qs,{open:f,onOpenChange:m,children:[e.jsx(kd,{asChild:!0,children:e.jsx($,{type:"button",variant:"outline",size:"icon",className:"shrink-0",title:"إضافة نوع جديد",children:e.jsx(bs,{className:"h-4 w-4"})})}),e.jsxs(Fs,{className:"sm:max-w-md",children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:"إضافة نوع عامل جديد"}),e.jsx(Ys,{children:"أدخل اسم نوع العامل الجديد ليتم حفظه في قاعدة البيانات"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(se,{htmlFor:"new-type-name",children:"اسم نوع العامل"}),e.jsx(be,{id:"new-type-name",type:"text",value:y,onChange:j=>x(j.target.value),placeholder:"مثال: كهربائي، سباك، حداد...",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",onClick:()=>{y.trim()&&T.mutate({name:y.trim()})},disabled:!y.trim()||T.isPending,className:"flex-1",children:T.isPending?"جاري الإضافة...":"إضافة"}),e.jsx($,{type:"button",variant:"outline",onClick:()=>{m(!1),x("")},className:"flex-1",children:"إلغاء"})]})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"worker-wage",children:"الأجر اليومي (ر.ي)"}),e.jsx(be,{id:"worker-wage",type:"number",inputMode:"decimal",value:d.dailyWage,onChange:j=>c({...d,dailyWage:j.target.value}),placeholder:"0",className:"text-center arabic-numbers",required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx($,{onClick:()=>{if(!d.name.trim()||!d.type||!d.dailyWage){w({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const j=parseFloat(d.dailyWage);if(isNaN(j)||j<=0){w({title:"خطأ",description:"يرجى إدخال مبلغ صحيح للأجر اليومي",variant:"destructive"});return}E.mutate({name:d.name.trim(),phone:d.phone||null,type:d.type,dailyWage:j.toString(),isActive:!0})},disabled:E.isPending,className:"flex-1",children:E.isPending?"جاري الحفظ...":"حفظ"}),e.jsx($,{variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"إلغاء"})]})]})]})}),e.jsx(qs,{open:l,onOpenChange:u,children:e.jsxs(Fs,{className:"max-w-md",children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:"إضافة مشروع جديد"}),e.jsx(Ys,{children:"أدخل بيانات المشروع الجديد لإضافته إلى النظام"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(se,{htmlFor:"project-name",children:"اسم المشروع"}),e.jsx(be,{id:"project-name",value:p.name,onChange:j=>A({...p,name:j.target.value}),placeholder:"أدخل اسم المشروع"})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"project-status",children:"حالة المشروع"}),e.jsxs(qe,{value:p.status,onValueChange:j=>A({...p,status:j}),children:[e.jsx(Oe,{children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"completed",children:"مكتمل"}),e.jsx(K,{value:"paused",children:"متوقف"})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"project-description",children:"وصف المشروع"}),e.jsx(be,{id:"project-description",value:p.description,onChange:j=>A({...p,description:j.target.value}),placeholder:"أدخل وصف المشروع (اختياري)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx($,{onClick:()=>{p.name&&O.mutate({name:p.name,status:p.status,description:p.description||null})},disabled:!p.name||O.isPending,className:"flex-1",children:O.isPending?"جاري الحفظ...":"حفظ"}),e.jsx($,{variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"إلغاء"})]})]})]})})]})}var Qi=t=>t.type==="checkbox",Va=t=>t instanceof Date,Rs=t=>t==null;const ob=t=>typeof t=="object";var ts=t=>!Rs(t)&&!Array.isArray(t)&&ob(t)&&!Va(t),lb=t=>ts(t)&&t.target?Qi(t.target)?t.target.checked:t.target.value:t,H_=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,cb=(t,s)=>t.has(H_(s)),G_=t=>{const s=t.constructor&&t.constructor.prototype;return ts(s)&&s.hasOwnProperty("isPrototypeOf")},ru=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function is(t){let s;const r=Array.isArray(t),a=typeof FileList<"u"?t instanceof FileList:!1;if(t instanceof Date)s=new Date(t);else if(!(ru&&(t instanceof Blob||a))&&(r||ts(t)))if(s=r?[]:Object.create(Object.getPrototypeOf(t)),!r&&!G_(t))s=t;else for(const n in t)t.hasOwnProperty(n)&&(s[n]=is(t[n]));else return t;return s}var vl=t=>/^\w*$/.test(t),es=t=>t===void 0,au=t=>Array.isArray(t)?t.filter(Boolean):[],nu=t=>au(t.replace(/["|']|\]/g,"").split(/\.|\[/)),je=(t,s,r)=>{if(!s||!ts(t))return r;const a=(vl(s)?[s]:nu(s)).reduce((n,i)=>Rs(n)?n:n[i],t);return es(a)||a===t?es(t[s])?r:t[s]:a},Qs=t=>typeof t=="boolean",St=(t,s,r)=>{let a=-1;const n=vl(s)?[s]:nu(s),i=n.length,o=i-1;for(;++a<i;){const l=n[a];let u=r;if(a!==o){const d=t[l];u=ts(d)||Array.isArray(d)?d:isNaN(+n[a+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;t[l]=u,t=t[l]}};const Io={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},pr={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Br={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},iu=ot.createContext(null);iu.displayName="HookFormContext";const bl=()=>ot.useContext(iu),Q_=t=>{const{children:s,...r}=t;return ot.createElement(iu.Provider,{value:r},s)};var db=(t,s,r,a=!0)=>{const n={defaultValues:s._defaultValues};for(const i in t)Object.defineProperty(n,i,{get:()=>{const o=i;return s._proxyFormState[o]!==pr.all&&(s._proxyFormState[o]=!a||pr.all),r&&(r[o]=!0),t[o]}});return n};const ou=typeof window<"u"?ot.useLayoutEffect:ot.useEffect;function X_(t){const s=bl(),{control:r=s.control,disabled:a,name:n,exact:i}=t||{},[o,l]=ot.useState(r._formState),u=ot.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return ou(()=>r._subscribe({name:n,formState:u.current,exact:i,callback:d=>{!a&&l({...r._formState,...d})}}),[n,a,i]),ot.useEffect(()=>{u.current.isValid&&r._setValid(!0)},[r]),ot.useMemo(()=>db(o,r,u.current,!1),[o,r])}var Pr=t=>typeof t=="string",ub=(t,s,r,a,n)=>Pr(t)?(a&&s.watch.add(t),je(r,t,n)):Array.isArray(t)?t.map(i=>(a&&s.watch.add(i),je(r,i))):(a&&(s.watchAll=!0),r),Wc=t=>Rs(t)||!ob(t);function Hr(t,s,r=new WeakSet){if(Wc(t)||Wc(s))return t===s;if(Va(t)&&Va(s))return t.getTime()===s.getTime();const a=Object.keys(t),n=Object.keys(s);if(a.length!==n.length)return!1;if(r.has(t)||r.has(s))return!0;r.add(t),r.add(s);for(const i of a){const o=t[i];if(!n.includes(i))return!1;if(i!=="ref"){const l=s[i];if(Va(o)&&Va(l)||ts(o)&&ts(l)||Array.isArray(o)&&Array.isArray(l)?!Hr(o,l,r):o!==l)return!1}}return!0}function Z_(t){const s=bl(),{control:r=s.control,name:a,defaultValue:n,disabled:i,exact:o,compute:l}=t||{},u=ot.useRef(n),d=ot.useRef(l),c=ot.useRef(void 0);d.current=l;const f=ot.useMemo(()=>r._getWatch(a,u.current),[r,a]),[m,y]=ot.useState(d.current?d.current(f):f);return ou(()=>r._subscribe({name:a,formState:{values:!0},exact:o,callback:x=>{if(!i){const p=ub(a,r._names,x.values||r._formValues,!1,u.current);if(d.current){const A=d.current(p);Hr(A,c.current)||(y(A),c.current=A)}else y(p)}}}),[r,i,a,o]),ot.useEffect(()=>r._removeUnmounted()),m}function Y_(t){const s=bl(),{name:r,disabled:a,control:n=s.control,shouldUnregister:i,defaultValue:o}=t,l=cb(n._names.array,r),u=ot.useMemo(()=>je(n._formValues,r,je(n._defaultValues,r,o)),[n,r,o]),d=Z_({control:n,name:r,defaultValue:u,exact:!0}),c=X_({control:n,name:r,exact:!0}),f=ot.useRef(t),m=ot.useRef(n.register(r,{...t.rules,value:d,...Qs(t.disabled)?{disabled:t.disabled}:{}}));f.current=t;const y=ot.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!je(c.errors,r)},isDirty:{enumerable:!0,get:()=>!!je(c.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!je(c.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!je(c.validatingFields,r)},error:{enumerable:!0,get:()=>je(c.errors,r)}}),[c,r]),x=ot.useCallback(N=>m.current.onChange({target:{value:lb(N),name:r},type:Io.CHANGE}),[r]),p=ot.useCallback(()=>m.current.onBlur({target:{value:je(n._formValues,r),name:r},type:Io.BLUR}),[r,n._formValues]),A=ot.useCallback(N=>{const w=je(n._fields,r);w&&N&&(w._f.ref={focus:()=>N.focus&&N.focus(),select:()=>N.select&&N.select(),setCustomValidity:_=>N.setCustomValidity(_),reportValidity:()=>N.reportValidity()})},[n._fields,r]),g=ot.useMemo(()=>({name:r,value:d,...Qs(a)||c.disabled?{disabled:c.disabled||a}:{},onChange:x,onBlur:p,ref:A}),[r,a,c.disabled,x,p,A,d]);return ot.useEffect(()=>{const N=n._options.shouldUnregister||i;n.register(r,{...f.current.rules,...Qs(f.current.disabled)?{disabled:f.current.disabled}:{}});const w=(_,b)=>{const k=je(n._fields,_);k&&k._f&&(k._f.mount=b)};if(w(r,!0),N){const _=is(je(n._options.defaultValues,r));St(n._defaultValues,r,_),es(je(n._formValues,r))&&St(n._formValues,r,_)}return!l&&n.register(r),()=>{(l?N&&!n._state.action:N)?n.unregister(r):w(r,!1)}},[r,n,l,i]),ot.useEffect(()=>{n._setDisabledField({disabled:a,name:r})},[a,r,n]),ot.useMemo(()=>({field:g,formState:c,fieldState:y}),[g,c,y])}const J_=t=>t.render(Y_(t));var mb=(t,s,r,a,n)=>s?{...r[t],types:{...r[t]&&r[t].types?r[t].types:{},[a]:n||!0}}:{},mi=t=>Array.isArray(t)?t:[t],Ih=()=>{let t=[];return{get observers(){return t},next:n=>{for(const i of t)i.next&&i.next(n)},subscribe:n=>(t.push(n),{unsubscribe:()=>{t=t.filter(i=>i!==n)}}),unsubscribe:()=>{t=[]}}},zs=t=>ts(t)&&!Object.keys(t).length,lu=t=>t.type==="file",xr=t=>typeof t=="function",Fo=t=>{if(!ru)return!1;const s=t?t.ownerDocument:0;return t instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},hb=t=>t.type==="select-multiple",cu=t=>t.type==="radio",e4=t=>cu(t)||Qi(t),nc=t=>Fo(t)&&t.isConnected;function t4(t,s){const r=s.slice(0,-1).length;let a=0;for(;a<r;)t=es(t)?a++:t[s[a++]];return t}function s4(t){for(const s in t)if(t.hasOwnProperty(s)&&!es(t[s]))return!1;return!0}function ss(t,s){const r=Array.isArray(s)?s:vl(s)?[s]:nu(s),a=r.length===1?t:t4(t,r),n=r.length-1,i=r[n];return a&&delete a[i],n!==0&&(ts(a)&&zs(a)||Array.isArray(a)&&s4(a))&&ss(t,r.slice(0,-1)),t}var fb=t=>{for(const s in t)if(xr(t[s]))return!0;return!1};function Oo(t,s={}){const r=Array.isArray(t);if(ts(t)||r)for(const a in t)Array.isArray(t[a])||ts(t[a])&&!fb(t[a])?(s[a]=Array.isArray(t[a])?[]:{},Oo(t[a],s[a])):Rs(t[a])||(s[a]=!0);return s}function pb(t,s,r){const a=Array.isArray(t);if(ts(t)||a)for(const n in t)Array.isArray(t[n])||ts(t[n])&&!fb(t[n])?es(s)||Wc(r[n])?r[n]=Array.isArray(t[n])?Oo(t[n],[]):{...Oo(t[n])}:pb(t[n],Rs(s)?{}:s[n],r[n]):r[n]=!Hr(t[n],s[n]);return r}var Zn=(t,s)=>pb(t,s,Oo(s));const Fh={value:!1,isValid:!1},Oh={value:!0,isValid:!0};var xb=t=>{if(Array.isArray(t)){if(t.length>1){const s=t.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:s,isValid:!!s.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!es(t[0].attributes.value)?es(t[0].value)||t[0].value===""?Oh:{value:t[0].value,isValid:!0}:Oh:Fh}return Fh},gb=(t,{valueAsNumber:s,valueAsDate:r,setValueAs:a})=>es(t)?t:s?t===""?NaN:t&&+t:r&&Pr(t)?new Date(t):a?a(t):t;const $h={isValid:!1,value:null};var yb=t=>Array.isArray(t)?t.reduce((s,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:s,$h):$h;function Lh(t){const s=t.ref;return lu(s)?s.files:cu(s)?yb(t.refs).value:hb(s)?[...s.selectedOptions].map(({value:r})=>r):Qi(s)?xb(t.refs).value:gb(es(s.value)?t.ref.value:s.value,t)}var r4=(t,s,r,a)=>{const n={};for(const i of t){const o=je(s,i);o&&St(n,i,o._f)}return{criteriaMode:r,names:[...t],fields:n,shouldUseNativeValidation:a}},$o=t=>t instanceof RegExp,Yn=t=>es(t)?t:$o(t)?t.source:ts(t)?$o(t.value)?t.value.source:t.value:t,Vh=t=>({isOnSubmit:!t||t===pr.onSubmit,isOnBlur:t===pr.onBlur,isOnChange:t===pr.onChange,isOnAll:t===pr.all,isOnTouch:t===pr.onTouched});const zh="AsyncFunction";var a4=t=>!!t&&!!t.validate&&!!(xr(t.validate)&&t.validate.constructor.name===zh||ts(t.validate)&&Object.values(t.validate).find(s=>s.constructor.name===zh)),n4=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate),Bh=(t,s,r)=>!r&&(s.watchAll||s.watch.has(t)||[...s.watch].some(a=>t.startsWith(a)&&/^\.\w+/.test(t.slice(a.length))));const hi=(t,s,r,a)=>{for(const n of r||Object.keys(t)){const i=je(t,n);if(i){const{_f:o,...l}=i;if(o){if(o.refs&&o.refs[0]&&s(o.refs[0],n)&&!a)return!0;if(o.ref&&s(o.ref,o.name)&&!a)return!0;if(hi(l,s))break}else if(ts(l)&&hi(l,s))break}}};function qh(t,s,r){const a=je(t,r);if(a||vl(r))return{error:a,name:r};const n=r.split(".");for(;n.length;){const i=n.join("."),o=je(s,i),l=je(t,i);if(o&&!Array.isArray(o)&&r!==i)return{name:r};if(l&&l.type)return{name:i,error:l};if(l&&l.root&&l.root.type)return{name:`${i}.root`,error:l.root};n.pop()}return{name:r}}var i4=(t,s,r,a)=>{r(t);const{name:n,...i}=t;return zs(i)||Object.keys(i).length>=Object.keys(s).length||Object.keys(i).find(o=>s[o]===(!a||pr.all))},o4=(t,s,r)=>!t||!s||t===s||mi(t).some(a=>a&&(r?a===s:a.startsWith(s)||s.startsWith(a))),l4=(t,s,r,a,n)=>n.isOnAll?!1:!r&&n.isOnTouch?!(s||t):(r?a.isOnBlur:n.isOnBlur)?!t:(r?a.isOnChange:n.isOnChange)?t:!0,c4=(t,s)=>!au(je(t,s)).length&&ss(t,s),d4=(t,s,r)=>{const a=mi(je(t,r));return St(a,"root",s[r]),St(t,r,a),t},jo=t=>Pr(t);function Uh(t,s,r="validate"){if(jo(t)||Array.isArray(t)&&t.every(jo)||Qs(t)&&!t)return{type:r,message:jo(t)?t:"",ref:s}}var ln=t=>ts(t)&&!$o(t)?t:{value:t,message:""},Wh=async(t,s,r,a,n,i)=>{const{ref:o,refs:l,required:u,maxLength:d,minLength:c,min:f,max:m,pattern:y,validate:x,name:p,valueAsNumber:A,mount:g}=t._f,N=je(r,p);if(!g||s.has(p))return{};const w=l?l[0]:o,_=S=>{n&&w.reportValidity&&(w.setCustomValidity(Qs(S)?"":S||""),w.reportValidity())},b={},k=cu(o),R=Qi(o),I=k||R,E=(A||lu(o))&&es(o.value)&&es(N)||Fo(o)&&o.value===""||N===""||Array.isArray(N)&&!N.length,O=mb.bind(null,p,a,b),T=(S,M,v,W=Br.maxLength,j=Br.minLength)=>{const V=S?M:v;b[p]={type:S?W:j,message:V,ref:o,...O(S?W:j,V)}};if(i?!Array.isArray(N)||!N.length:u&&(!I&&(E||Rs(N))||Qs(N)&&!N||R&&!xb(l).isValid||k&&!yb(l).isValid)){const{value:S,message:M}=jo(u)?{value:!!u,message:u}:ln(u);if(S&&(b[p]={type:Br.required,message:M,ref:w,...O(Br.required,M)},!a))return _(M),b}if(!E&&(!Rs(f)||!Rs(m))){let S,M;const v=ln(m),W=ln(f);if(!Rs(N)&&!isNaN(N)){const j=o.valueAsNumber||N&&+N;Rs(v.value)||(S=j>v.value),Rs(W.value)||(M=j<W.value)}else{const j=o.valueAsDate||new Date(N),V=ye=>new Date(new Date().toDateString()+" "+ye),ne=o.type=="time",F=o.type=="week";Pr(v.value)&&N&&(S=ne?V(N)>V(v.value):F?N>v.value:j>new Date(v.value)),Pr(W.value)&&N&&(M=ne?V(N)<V(W.value):F?N<W.value:j<new Date(W.value))}if((S||M)&&(T(!!S,v.message,W.message,Br.max,Br.min),!a))return _(b[p].message),b}if((d||c)&&!E&&(Pr(N)||i&&Array.isArray(N))){const S=ln(d),M=ln(c),v=!Rs(S.value)&&N.length>+S.value,W=!Rs(M.value)&&N.length<+M.value;if((v||W)&&(T(v,S.message,M.message),!a))return _(b[p].message),b}if(y&&!E&&Pr(N)){const{value:S,message:M}=ln(y);if($o(S)&&!N.match(S)&&(b[p]={type:Br.pattern,message:M,ref:o,...O(Br.pattern,M)},!a))return _(M),b}if(x){if(xr(x)){const S=await x(N,r),M=Uh(S,w);if(M&&(b[p]={...M,...O(Br.validate,M.message)},!a))return _(M.message),b}else if(ts(x)){let S={};for(const M in x){if(!zs(S)&&!a)break;const v=Uh(await x[M](N,r),w,M);v&&(S={...v,...O(M,v.message)},_(v.message),a&&(b[p]=S))}if(!zs(S)&&(b[p]={ref:w,...S},!a))return b}}return _(!0),b};const u4={mode:pr.onSubmit,reValidateMode:pr.onChange,shouldFocusError:!0};function m4(t={}){let s={...u4,...t},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:xr(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},a={},n=ts(s.defaultValues)||ts(s.values)?is(s.defaultValues||s.values)||{}:{},i=s.shouldUnregister?{}:is(n),o={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},u,d=0;const c={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let f={...c};const m={array:Ih(),state:Ih()},y=s.criteriaMode===pr.all,x=P=>z=>{clearTimeout(d),d=setTimeout(P,z)},p=async P=>{if(!s.disabled&&(c.isValid||f.isValid||P)){const z=s.resolver?zs((await R()).errors):await E(a,!0);z!==r.isValid&&m.state.next({isValid:z})}},A=(P,z)=>{!s.disabled&&(c.isValidating||c.validatingFields||f.isValidating||f.validatingFields)&&((P||Array.from(l.mount)).forEach(G=>{G&&(z?St(r.validatingFields,G,z):ss(r.validatingFields,G))}),m.state.next({validatingFields:r.validatingFields,isValidating:!zs(r.validatingFields)}))},g=(P,z=[],G,oe,ce=!0,te=!0)=>{if(oe&&G&&!s.disabled){if(o.action=!0,te&&Array.isArray(je(a,P))){const ve=G(je(a,P),oe.argA,oe.argB);ce&&St(a,P,ve)}if(te&&Array.isArray(je(r.errors,P))){const ve=G(je(r.errors,P),oe.argA,oe.argB);ce&&St(r.errors,P,ve),c4(r.errors,P)}if((c.touchedFields||f.touchedFields)&&te&&Array.isArray(je(r.touchedFields,P))){const ve=G(je(r.touchedFields,P),oe.argA,oe.argB);ce&&St(r.touchedFields,P,ve)}(c.dirtyFields||f.dirtyFields)&&(r.dirtyFields=Zn(n,i)),m.state.next({name:P,isDirty:T(P,z),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else St(i,P,z)},N=(P,z)=>{St(r.errors,P,z),m.state.next({errors:r.errors})},w=P=>{r.errors=P,m.state.next({errors:r.errors,isValid:!1})},_=(P,z,G,oe)=>{const ce=je(a,P);if(ce){const te=je(i,P,es(G)?je(n,P):G);es(te)||oe&&oe.defaultChecked||z?St(i,P,z?te:Lh(ce._f)):v(P,te),o.mount&&p()}},b=(P,z,G,oe,ce)=>{let te=!1,ve=!1;const Re={name:P};if(!s.disabled){if(!G||oe){(c.isDirty||f.isDirty)&&(ve=r.isDirty,r.isDirty=Re.isDirty=T(),te=ve!==Re.isDirty);const dt=Hr(je(n,P),z);ve=!!je(r.dirtyFields,P),dt?ss(r.dirtyFields,P):St(r.dirtyFields,P,!0),Re.dirtyFields=r.dirtyFields,te=te||(c.dirtyFields||f.dirtyFields)&&ve!==!dt}if(G){const dt=je(r.touchedFields,P);dt||(St(r.touchedFields,P,G),Re.touchedFields=r.touchedFields,te=te||(c.touchedFields||f.touchedFields)&&dt!==G)}te&&ce&&m.state.next(Re)}return te?Re:{}},k=(P,z,G,oe)=>{const ce=je(r.errors,P),te=(c.isValid||f.isValid)&&Qs(z)&&r.isValid!==z;if(s.delayError&&G?(u=x(()=>N(P,G)),u(s.delayError)):(clearTimeout(d),u=null,G?St(r.errors,P,G):ss(r.errors,P)),(G?!Hr(ce,G):ce)||!zs(oe)||te){const ve={...oe,...te&&Qs(z)?{isValid:z}:{},errors:r.errors,name:P};r={...r,...ve},m.state.next(ve)}},R=async P=>{A(P,!0);const z=await s.resolver(i,s.context,r4(P||l.mount,a,s.criteriaMode,s.shouldUseNativeValidation));return A(P),z},I=async P=>{const{errors:z}=await R(P);if(P)for(const G of P){const oe=je(z,G);oe?St(r.errors,G,oe):ss(r.errors,G)}else r.errors=z;return z},E=async(P,z,G={valid:!0})=>{for(const oe in P){const ce=P[oe];if(ce){const{_f:te,...ve}=ce;if(te){const Re=l.array.has(te.name),dt=ce._f&&a4(ce._f);dt&&c.validatingFields&&A([oe],!0);const Zt=await Wh(ce,l.disabled,i,y,s.shouldUseNativeValidation&&!z,Re);if(dt&&c.validatingFields&&A([oe]),Zt[te.name]&&(G.valid=!1,z))break;!z&&(je(Zt,te.name)?Re?d4(r.errors,Zt,te.name):St(r.errors,te.name,Zt[te.name]):ss(r.errors,te.name))}!zs(ve)&&await E(ve,z,G)}}return G.valid},O=()=>{for(const P of l.unMount){const z=je(a,P);z&&(z._f.refs?z._f.refs.every(G=>!nc(G)):!nc(z._f.ref))&&Z(P)}l.unMount=new Set},T=(P,z)=>!s.disabled&&(P&&z&&St(i,P,z),!Hr(ye(),n)),S=(P,z,G)=>ub(P,l,{...o.mount?i:es(z)?n:Pr(P)?{[P]:z}:z},G,z),M=P=>au(je(o.mount?i:n,P,s.shouldUnregister?je(n,P,[]):[])),v=(P,z,G={})=>{const oe=je(a,P);let ce=z;if(oe){const te=oe._f;te&&(!te.disabled&&St(i,P,gb(z,te)),ce=Fo(te.ref)&&Rs(z)?"":z,hb(te.ref)?[...te.ref.options].forEach(ve=>ve.selected=ce.includes(ve.value)):te.refs?Qi(te.ref)?te.refs.forEach(ve=>{(!ve.defaultChecked||!ve.disabled)&&(Array.isArray(ce)?ve.checked=!!ce.find(Re=>Re===ve.value):ve.checked=ce===ve.value||!!ce)}):te.refs.forEach(ve=>ve.checked=ve.value===ce):lu(te.ref)?te.ref.value="":(te.ref.value=ce,te.ref.type||m.state.next({name:P,values:is(i)})))}(G.shouldDirty||G.shouldTouch)&&b(P,ce,G.shouldTouch,G.shouldDirty,!0),G.shouldValidate&&F(P)},W=(P,z,G)=>{for(const oe in z){if(!z.hasOwnProperty(oe))return;const ce=z[oe],te=P+"."+oe,ve=je(a,te);(l.array.has(P)||ts(ce)||ve&&!ve._f)&&!Va(ce)?W(te,ce,G):v(te,ce,G)}},j=(P,z,G={})=>{const oe=je(a,P),ce=l.array.has(P),te=is(z);St(i,P,te),ce?(m.array.next({name:P,values:is(i)}),(c.isDirty||c.dirtyFields||f.isDirty||f.dirtyFields)&&G.shouldDirty&&m.state.next({name:P,dirtyFields:Zn(n,i),isDirty:T(P,te)})):oe&&!oe._f&&!Rs(te)?W(P,te,G):v(P,te,G),Bh(P,l)&&m.state.next({...r,name:P}),m.state.next({name:o.mount?P:void 0,values:is(i)})},V=async P=>{o.mount=!0;const z=P.target;let G=z.name,oe=!0;const ce=je(a,G),te=dt=>{oe=Number.isNaN(dt)||Va(dt)&&isNaN(dt.getTime())||Hr(dt,je(i,G,dt))},ve=Vh(s.mode),Re=Vh(s.reValidateMode);if(ce){let dt,Zt;const ur=z.type?Lh(ce._f):lb(P),xs=P.type===Io.BLUR||P.type===Io.FOCUS_OUT,mr=!n4(ce._f)&&!s.resolver&&!je(r.errors,G)&&!ce._f.deps||l4(xs,je(r.touchedFields,G),r.isSubmitted,Re,ve),Lr=Bh(G,l,xs);St(i,G,ur),xs?(!z||!z.readOnly)&&(ce._f.onBlur&&ce._f.onBlur(P),u&&u(0)):ce._f.onChange&&ce._f.onChange(P);const L=b(G,ur,xs),De=!zs(L)||Lr;if(!xs&&m.state.next({name:G,type:P.type,values:is(i)}),mr)return(c.isValid||f.isValid)&&(s.mode==="onBlur"?xs&&p():xs||p()),De&&m.state.next({name:G,...Lr?{}:L});if(!xs&&Lr&&m.state.next({...r}),s.resolver){const{errors:Ee}=await R([G]);if(te(ur),oe){const Vt=qh(r.errors,a,G),Ie=qh(Ee,a,Vt.name||G);dt=Ie.error,G=Ie.name,Zt=zs(Ee)}}else A([G],!0),dt=(await Wh(ce,l.disabled,i,y,s.shouldUseNativeValidation))[G],A([G]),te(ur),oe&&(dt?Zt=!1:(c.isValid||f.isValid)&&(Zt=await E(a,!0)));oe&&(ce._f.deps&&F(ce._f.deps),k(G,Zt,dt,L))}},ne=(P,z)=>{if(je(r.errors,z)&&P.focus)return P.focus(),1},F=async(P,z={})=>{let G,oe;const ce=mi(P);if(s.resolver){const te=await I(es(P)?P:ce);G=zs(te),oe=P?!ce.some(ve=>je(te,ve)):G}else P?(oe=(await Promise.all(ce.map(async te=>{const ve=je(a,te);return await E(ve&&ve._f?{[te]:ve}:ve)}))).every(Boolean),!(!oe&&!r.isValid)&&p()):oe=G=await E(a);return m.state.next({...!Pr(P)||(c.isValid||f.isValid)&&G!==r.isValid?{}:{name:P},...s.resolver||!P?{isValid:G}:{},errors:r.errors}),z.shouldFocus&&!oe&&hi(a,ne,P?ce:l.mount),oe},ye=P=>{const z={...o.mount?i:n};return es(P)?z:Pr(P)?je(z,P):P.map(G=>je(z,G))},fe=(P,z)=>({invalid:!!je((z||r).errors,P),isDirty:!!je((z||r).dirtyFields,P),error:je((z||r).errors,P),isValidating:!!je(r.validatingFields,P),isTouched:!!je((z||r).touchedFields,P)}),de=P=>{P&&mi(P).forEach(z=>ss(r.errors,z)),m.state.next({errors:P?r.errors:{}})},ke=(P,z,G)=>{const oe=(je(a,P,{_f:{}})._f||{}).ref,ce=je(r.errors,P)||{},{ref:te,message:ve,type:Re,...dt}=ce;St(r.errors,P,{...dt,...z,ref:oe}),m.state.next({name:P,errors:r.errors,isValid:!1}),G&&G.shouldFocus&&oe&&oe.focus&&oe.focus()},nt=(P,z)=>xr(P)?m.state.subscribe({next:G=>"values"in G&&P(S(void 0,z),G)}):S(P,z,!0),ct=P=>m.state.subscribe({next:z=>{o4(P.name,z.name,P.exact)&&i4(z,P.formState||c,X,P.reRenderRoot)&&P.callback({values:{...i},...r,...z,defaultValues:n})}}).unsubscribe,it=P=>(o.mount=!0,f={...f,...P.formState},ct({...P,formState:f})),Z=(P,z={})=>{for(const G of P?mi(P):l.mount)l.mount.delete(G),l.array.delete(G),z.keepValue||(ss(a,G),ss(i,G)),!z.keepError&&ss(r.errors,G),!z.keepDirty&&ss(r.dirtyFields,G),!z.keepTouched&&ss(r.touchedFields,G),!z.keepIsValidating&&ss(r.validatingFields,G),!s.shouldUnregister&&!z.keepDefaultValue&&ss(n,G);m.state.next({values:is(i)}),m.state.next({...r,...z.keepDirty?{isDirty:T()}:{}}),!z.keepIsValid&&p()},U=({disabled:P,name:z})=>{(Qs(P)&&o.mount||P||l.disabled.has(z))&&(P?l.disabled.add(z):l.disabled.delete(z))},Y=(P,z={})=>{let G=je(a,P);const oe=Qs(z.disabled)||Qs(s.disabled);return St(a,P,{...G||{},_f:{...G&&G._f?G._f:{ref:{name:P}},name:P,mount:!0,...z}}),l.mount.add(P),G?U({disabled:Qs(z.disabled)?z.disabled:s.disabled,name:P}):_(P,!0,z.value),{...oe?{disabled:z.disabled||s.disabled}:{},...s.progressive?{required:!!z.required,min:Yn(z.min),max:Yn(z.max),minLength:Yn(z.minLength),maxLength:Yn(z.maxLength),pattern:Yn(z.pattern)}:{},name:P,onChange:V,onBlur:V,ref:ce=>{if(ce){Y(P,z),G=je(a,P);const te=es(ce.value)&&ce.querySelectorAll&&ce.querySelectorAll("input,select,textarea")[0]||ce,ve=e4(te),Re=G._f.refs||[];if(ve?Re.find(dt=>dt===te):te===G._f.ref)return;St(a,P,{_f:{...G._f,...ve?{refs:[...Re.filter(nc),te,...Array.isArray(je(n,P))?[{}]:[]],ref:{type:te.type,name:P}}:{ref:te}}}),_(P,!1,void 0,te)}else G=je(a,P,{}),G._f&&(G._f.mount=!1),(s.shouldUnregister||z.shouldUnregister)&&!(cb(l.array,P)&&o.action)&&l.unMount.add(P)}}},Ae=()=>s.shouldFocusError&&hi(a,ne,l.mount),pt=P=>{Qs(P)&&(m.state.next({disabled:P}),hi(a,(z,G)=>{const oe=je(a,G);oe&&(z.disabled=oe._f.disabled||P,Array.isArray(oe._f.refs)&&oe._f.refs.forEach(ce=>{ce.disabled=oe._f.disabled||P}))},0,!1))},jt=(P,z)=>async G=>{let oe;G&&(G.preventDefault&&G.preventDefault(),G.persist&&G.persist());let ce=is(i);if(m.state.next({isSubmitting:!0}),s.resolver){const{errors:te,values:ve}=await R();r.errors=te,ce=is(ve)}else await E(a);if(l.disabled.size)for(const te of l.disabled)ss(ce,te);if(ss(r.errors,"root"),zs(r.errors)){m.state.next({errors:{}});try{await P(ce,G)}catch(te){oe=te}}else z&&await z({...r.errors},G),Ae(),setTimeout(Ae);if(m.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:zs(r.errors)&&!oe,submitCount:r.submitCount+1,errors:r.errors}),oe)throw oe},Ve=(P,z={})=>{je(a,P)&&(es(z.defaultValue)?j(P,is(je(n,P))):(j(P,z.defaultValue),St(n,P,is(z.defaultValue))),z.keepTouched||ss(r.touchedFields,P),z.keepDirty||(ss(r.dirtyFields,P),r.isDirty=z.defaultValue?T(P,is(je(n,P))):T()),z.keepError||(ss(r.errors,P),c.isValid&&p()),m.state.next({...r}))},kt=(P,z={})=>{const G=P?is(P):n,oe=is(G),ce=zs(P),te=ce?n:oe;if(z.keepDefaultValues||(n=G),!z.keepValues){if(z.keepDirtyValues){const ve=new Set([...l.mount,...Object.keys(Zn(n,i))]);for(const Re of Array.from(ve))je(r.dirtyFields,Re)?St(te,Re,je(i,Re)):j(Re,je(te,Re))}else{if(ru&&es(P))for(const ve of l.mount){const Re=je(a,ve);if(Re&&Re._f){const dt=Array.isArray(Re._f.refs)?Re._f.refs[0]:Re._f.ref;if(Fo(dt)){const Zt=dt.closest("form");if(Zt){Zt.reset();break}}}}if(z.keepFieldsRef)for(const ve of l.mount)j(ve,je(te,ve));else a={}}i=s.shouldUnregister?z.keepDefaultValues?is(n):{}:is(te),m.array.next({values:{...te}}),m.state.next({values:{...te}})}l={mount:z.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!c.isValid||!!z.keepIsValid||!!z.keepDirtyValues,o.watch=!!s.shouldUnregister,m.state.next({submitCount:z.keepSubmitCount?r.submitCount:0,isDirty:ce?!1:z.keepDirty?r.isDirty:!!(z.keepDefaultValues&&!Hr(P,n)),isSubmitted:z.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:ce?{}:z.keepDirtyValues?z.keepDefaultValues&&i?Zn(n,i):r.dirtyFields:z.keepDefaultValues&&P?Zn(n,P):z.keepDirty?r.dirtyFields:{},touchedFields:z.keepTouched?r.touchedFields:{},errors:z.keepErrors?r.errors:{},isSubmitSuccessful:z.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:n})},ps=(P,z)=>kt(xr(P)?P(i):P,z),ks=(P,z={})=>{const G=je(a,P),oe=G&&G._f;if(oe){const ce=oe.refs?oe.refs[0]:oe.ref;ce.focus&&(ce.focus(),z.shouldSelect&&xr(ce.select)&&ce.select())}},X=P=>{r={...r,...P}},xe={control:{register:Y,unregister:Z,getFieldState:fe,handleSubmit:jt,setError:ke,_subscribe:ct,_runSchema:R,_focusError:Ae,_getWatch:S,_getDirty:T,_setValid:p,_setFieldArray:g,_setDisabledField:U,_setErrors:w,_getFieldArray:M,_reset:kt,_resetDefaultValues:()=>xr(s.defaultValues)&&s.defaultValues().then(P=>{ps(P,s.resetOptions),m.state.next({isLoading:!1})}),_removeUnmounted:O,_disableForm:pt,_subjects:m,_proxyFormState:c,get _fields(){return a},get _formValues(){return i},get _state(){return o},set _state(P){o=P},get _defaultValues(){return n},get _names(){return l},set _names(P){l=P},get _formState(){return r},get _options(){return s},set _options(P){s={...s,...P}}},subscribe:it,trigger:F,register:Y,handleSubmit:jt,watch:nt,setValue:j,getValues:ye,reset:ps,resetField:Ve,clearErrors:de,unregister:Z,setError:ke,setFocus:ks,getFieldState:fe};return{...xe,formControl:xe}}function va(t={}){const s=ot.useRef(void 0),r=ot.useRef(void 0),[a,n]=ot.useState({isDirty:!1,isValidating:!1,isLoading:xr(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,isReady:!1,defaultValues:xr(t.defaultValues)?void 0:t.defaultValues});if(!s.current)if(t.formControl)s.current={...t.formControl,formState:a},t.defaultValues&&!xr(t.defaultValues)&&t.formControl.reset(t.defaultValues,t.resetOptions);else{const{formControl:o,...l}=m4(t);s.current={...l,formState:a}}const i=s.current.control;return i._options=t,ou(()=>{const o=i._subscribe({formState:i._proxyFormState,callback:()=>n({...i._formState}),reRenderRoot:!0});return n(l=>({...l,isReady:!0})),i._formState.isReady=!0,o},[i]),ot.useEffect(()=>i._disableForm(t.disabled),[i,t.disabled]),ot.useEffect(()=>{t.mode&&(i._options.mode=t.mode),t.reValidateMode&&(i._options.reValidateMode=t.reValidateMode)},[i,t.mode,t.reValidateMode]),ot.useEffect(()=>{t.errors&&(i._setErrors(t.errors),i._focusError())},[i,t.errors]),ot.useEffect(()=>{t.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,t.shouldUnregister]),ot.useEffect(()=>{if(i._proxyFormState.isDirty){const o=i._getDirty();o!==a.isDirty&&i._subjects.state.next({isDirty:o})}},[i,a.isDirty]),ot.useEffect(()=>{t.values&&!Hr(t.values,r.current)?(i._reset(t.values,{keepFieldsRef:!0,...i._options.resetOptions}),r.current=t.values,n(o=>({...o}))):i._resetDefaultValues()},[i,t.values]),ot.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),s.current.formState=db(a,i),s.current}const Kh=(t,s,r)=>{if(t&&"reportValidity"in t){const a=je(r,s);t.setCustomValidity(a&&a.message||""),t.reportValidity()}},vb=(t,s)=>{for(const r in s.fields){const a=s.fields[r];a&&a.ref&&"reportValidity"in a.ref?Kh(a.ref,r,t):a.refs&&a.refs.forEach(n=>Kh(n,r,t))}},h4=(t,s)=>{s.shouldUseNativeValidation&&vb(t,s);const r={};for(const a in t){const n=je(s.fields,a),i=Object.assign(t[a]||{},{ref:n&&n.ref});if(f4(s.names||Object.keys(t),a)){const o=Object.assign({},je(r,a));St(o,"root",i),St(r,a,o)}else St(r,a,i)}return r},f4=(t,s)=>t.some(r=>r.startsWith(s+"."));var p4=function(t,s){for(var r={};t.length;){var a=t[0],n=a.code,i=a.message,o=a.path.join(".");if(!r[o])if("unionErrors"in a){var l=a.unionErrors[0].errors[0];r[o]={message:l.message,type:l.code}}else r[o]={message:i,type:n};if("unionErrors"in a&&a.unionErrors.forEach(function(c){return c.errors.forEach(function(f){return t.push(f)})}),s){var u=r[o].types,d=u&&u[a.code];r[o]=mb(o,s,r,n,d?[].concat(d,a.message):a.message)}t.shift()}return r},ba=function(t,s,r){return r===void 0&&(r={}),function(a,n,i){try{return Promise.resolve((function(o,l){try{var u=Promise.resolve(t[r.mode==="sync"?"parse":"parseAsync"](a,s)).then(function(d){return i.shouldUseNativeValidation&&vb({},i),{errors:{},values:r.raw?a:d}})}catch(d){return l(d)}return u&&u.then?u.then(void 0,l):u})(0,function(o){if((function(l){return Array.isArray(l?.errors)})(o))return{values:{},errors:h4(p4(o.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw o}))}catch(o){return Promise.reject(o)}}},ht;(function(t){t.assertEqual=n=>{};function s(n){}t.assertIs=s;function r(n){throw new Error}t.assertNever=r,t.arrayToEnum=n=>{const i={};for(const o of n)i[o]=o;return i},t.getValidEnumValues=n=>{const i=t.objectKeys(n).filter(l=>typeof n[n[l]]!="number"),o={};for(const l of i)o[l]=n[l];return t.objectValues(o)},t.objectValues=n=>t.objectKeys(n).map(function(i){return n[i]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);return i},t.find=(n,i)=>{for(const o of n)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function a(n,i=" | "){return n.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=a,t.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(ht||(ht={}));var Kc;(function(t){t.mergeShapes=(s,r)=>({...s,...r})})(Kc||(Kc={}));const Te=ht.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Wr=t=>{switch(typeof t){case"undefined":return Te.undefined;case"string":return Te.string;case"number":return Number.isNaN(t)?Te.nan:Te.number;case"boolean":return Te.boolean;case"function":return Te.function;case"bigint":return Te.bigint;case"symbol":return Te.symbol;case"object":return Array.isArray(t)?Te.array:t===null?Te.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?Te.promise:typeof Map<"u"&&t instanceof Map?Te.map:typeof Set<"u"&&t instanceof Set?Te.set:typeof Date<"u"&&t instanceof Date?Te.date:Te.object;default:return Te.unknown}},me=ht.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),x4=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class Js extends Error{get errors(){return this.issues}constructor(s){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=s}format(s){const r=s||function(i){return i.message},a={_errors:[]},n=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(n);else if(o.code==="invalid_return_type")n(o.returnTypeError);else if(o.code==="invalid_arguments")n(o.argumentsError);else if(o.path.length===0)a._errors.push(r(o));else{let l=a,u=0;for(;u<o.path.length;){const d=o.path[u];u===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(r(o))):l[d]=l[d]||{_errors:[]},l=l[d],u++}}};return n(this),a}static assert(s){if(!(s instanceof Js))throw new Error(`Not a ZodError: ${s}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ht.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(s=r=>r.message){const r={},a=[];for(const n of this.issues)if(n.path.length>0){const i=n.path[0];r[i]=r[i]||[],r[i].push(s(n))}else a.push(s(n));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}}Js.create=t=>new Js(t);const Dn=(t,s)=>{let r;switch(t.code){case me.invalid_type:t.received===Te.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case me.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ht.jsonStringifyReplacer)}`;break;case me.unrecognized_keys:r=`Unrecognized key(s) in object: ${ht.joinValues(t.keys,", ")}`;break;case me.invalid_union:r="Invalid input";break;case me.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ht.joinValues(t.options)}`;break;case me.invalid_enum_value:r=`Invalid enum value. Expected ${ht.joinValues(t.options)}, received '${t.received}'`;break;case me.invalid_arguments:r="Invalid function arguments";break;case me.invalid_return_type:r="Invalid function return type";break;case me.invalid_date:r="Invalid date";break;case me.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ht.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case me.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case me.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case me.custom:r="Invalid input";break;case me.invalid_intersection_types:r="Intersection results could not be merged";break;case me.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case me.not_finite:r="Number must be finite";break;default:r=s.defaultError,ht.assertNever(t)}return{message:r}};let bb=Dn;function g4(t){bb=t}function Lo(){return bb}const Vo=t=>{const{data:s,path:r,errorMaps:a,issueData:n}=t,i=[...r,...n.path||[]],o={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let l="";const u=a.filter(d=>!!d).slice().reverse();for(const d of u)l=d(o,{data:s,defaultError:l}).message;return{...n,path:i,message:l}},y4=[];function we(t,s){const r=Lo(),a=Vo({issueData:s,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Dn?void 0:Dn].filter(n=>!!n)});t.common.issues.push(a)}class Es{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(s,r){const a=[];for(const n of r){if(n.status==="aborted")return Be;n.status==="dirty"&&s.dirty(),a.push(n.value)}return{status:s.value,value:a}}static async mergeObjectAsync(s,r){const a=[];for(const n of r){const i=await n.key,o=await n.value;a.push({key:i,value:o})}return Es.mergeObjectSync(s,a)}static mergeObjectSync(s,r){const a={};for(const n of r){const{key:i,value:o}=n;if(i.status==="aborted"||o.status==="aborted")return Be;i.status==="dirty"&&s.dirty(),o.status==="dirty"&&s.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||n.alwaysSet)&&(a[i.value]=o.value)}return{status:s.value,value:a}}}const Be=Object.freeze({status:"aborted"}),gn=t=>({status:"dirty",value:t}),$s=t=>({status:"valid",value:t}),Hc=t=>t.status==="aborted",Gc=t=>t.status==="dirty",Qa=t=>t.status==="valid",Ni=t=>typeof Promise<"u"&&t instanceof Promise;var _e;(function(t){t.errToObj=s=>typeof s=="string"?{message:s}:s||{},t.toString=s=>typeof s=="string"?s:s?.message})(_e||(_e={}));class Ir{constructor(s,r,a,n){this._cachedPath=[],this.parent=s,this.data=r,this._path=a,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Hh=(t,s)=>{if(Qa(s))return{success:!0,data:s.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Js(t.common.issues);return this._error=r,this._error}}};function tt(t){if(!t)return{};const{errorMap:s,invalid_type_error:r,required_error:a,description:n}=t;if(s&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return s?{errorMap:s,description:n}:{errorMap:(o,l)=>{const{message:u}=t;return o.code==="invalid_enum_value"?{message:u??l.defaultError}:typeof l.data>"u"?{message:u??a??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:u??r??l.defaultError}},description:n}}class at{get description(){return this._def.description}_getType(s){return Wr(s.data)}_getOrReturnCtx(s,r){return r||{common:s.parent.common,data:s.data,parsedType:Wr(s.data),schemaErrorMap:this._def.errorMap,path:s.path,parent:s.parent}}_processInputParams(s){return{status:new Es,ctx:{common:s.parent.common,data:s.data,parsedType:Wr(s.data),schemaErrorMap:this._def.errorMap,path:s.path,parent:s.parent}}}_parseSync(s){const r=this._parse(s);if(Ni(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(s){const r=this._parse(s);return Promise.resolve(r)}parse(s,r){const a=this.safeParse(s,r);if(a.success)return a.data;throw a.error}safeParse(s,r){const a={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Wr(s)},n=this._parseSync({data:s,path:a.path,parent:a});return Hh(a,n)}"~validate"(s){const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Wr(s)};if(!this["~standard"].async)try{const a=this._parseSync({data:s,path:[],parent:r});return Qa(a)?{value:a.value}:{issues:r.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:s,path:[],parent:r}).then(a=>Qa(a)?{value:a.value}:{issues:r.common.issues})}async parseAsync(s,r){const a=await this.safeParseAsync(s,r);if(a.success)return a.data;throw a.error}async safeParseAsync(s,r){const a={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Wr(s)},n=this._parse({data:s,path:a.path,parent:a}),i=await(Ni(n)?n:Promise.resolve(n));return Hh(a,i)}refine(s,r){const a=n=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(n):r;return this._refinement((n,i)=>{const o=s(n),l=()=>i.addIssue({code:me.custom,...a(n)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(s,r){return this._refinement((a,n)=>s(a)?!0:(n.addIssue(typeof r=="function"?r(a,n):r),!1))}_refinement(s){return new br({schema:this,typeName:Xe.ZodEffects,effect:{type:"refinement",refinement:s}})}superRefine(s){return this._refinement(s)}constructor(s){this.spa=this.safeParseAsync,this._def=s,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Mr.create(this,this._def)}nullable(){return Ca.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vr.create(this)}promise(){return Rn.create(this,this._def)}or(s){return Ti.create([this,s],this._def)}and(s){return Ai.create(this,s,this._def)}transform(s){return new br({...tt(this._def),schema:this,typeName:Xe.ZodEffects,effect:{type:"transform",transform:s}})}default(s){const r=typeof s=="function"?s:()=>s;return new Di({...tt(this._def),innerType:this,defaultValue:r,typeName:Xe.ZodDefault})}brand(){return new du({typeName:Xe.ZodBranded,type:this,...tt(this._def)})}catch(s){const r=typeof s=="function"?s:()=>s;return new Mi({...tt(this._def),innerType:this,catchValue:r,typeName:Xe.ZodCatch})}describe(s){const r=this.constructor;return new r({...this._def,description:s})}pipe(s){return Xi.create(this,s)}readonly(){return Ri.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const v4=/^c[^\s-]{8,}$/i,b4=/^[0-9a-z]+$/,j4=/^[0-9A-HJKMNP-TV-Z]{26}$/i,N4=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,w4=/^[a-z0-9_-]{21}$/i,k4=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S4=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,T4=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,A4="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ic;const C4=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,P4=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,_4=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,E4=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,D4=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,M4=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,jb="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",R4=new RegExp(`^${jb}$`);function Nb(t){let s="[0-5]\\d";t.precision?s=`${s}\\.\\d{${t.precision}}`:t.precision==null&&(s=`${s}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${s})${r}`}function I4(t){return new RegExp(`^${Nb(t)}$`)}function wb(t){let s=`${jb}T${Nb(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),s=`${s}(${r.join("|")})`,new RegExp(`^${s}$`)}function F4(t,s){return!!((s==="v4"||!s)&&C4.test(t)||(s==="v6"||!s)&&_4.test(t))}function O4(t,s){if(!k4.test(t))return!1;try{const[r]=t.split(".");if(!r)return!1;const a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||s&&n.alg!==s)}catch{return!1}}function $4(t,s){return!!((s==="v4"||!s)&&P4.test(t)||(s==="v6"||!s)&&E4.test(t))}class gr extends at{_parse(s){if(this._def.coerce&&(s.data=String(s.data)),this._getType(s)!==Te.string){const i=this._getOrReturnCtx(s);return we(i,{code:me.invalid_type,expected:Te.string,received:i.parsedType}),Be}const a=new Es;let n;for(const i of this._def.checks)if(i.kind==="min")s.data.length<i.value&&(n=this._getOrReturnCtx(s,n),we(n,{code:me.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="max")s.data.length>i.value&&(n=this._getOrReturnCtx(s,n),we(n,{code:me.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="length"){const o=s.data.length>i.value,l=s.data.length<i.value;(o||l)&&(n=this._getOrReturnCtx(s,n),o?we(n,{code:me.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):l&&we(n,{code:me.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),a.dirty())}else if(i.kind==="email")T4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"email",code:me.invalid_string,message:i.message}),a.dirty());else if(i.kind==="emoji")ic||(ic=new RegExp(A4,"u")),ic.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"emoji",code:me.invalid_string,message:i.message}),a.dirty());else if(i.kind==="uuid")N4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"uuid",code:me.invalid_string,message:i.message}),a.dirty());else if(i.kind==="nanoid")w4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"nanoid",code:me.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid")v4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"cuid",code:me.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid2")b4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"cuid2",code:me.invalid_string,message:i.message}),a.dirty());else if(i.kind==="ulid")j4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"ulid",code:me.invalid_string,message:i.message}),a.dirty());else if(i.kind==="url")try{new URL(s.data)}catch{n=this._getOrReturnCtx(s,n),we(n,{validation:"url",code:me.invalid_string,message:i.message}),a.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"regex",code:me.invalid_string,message:i.message}),a.dirty())):i.kind==="trim"?s.data=s.data.trim():i.kind==="includes"?s.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(s,n),we(n,{code:me.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),a.dirty()):i.kind==="toLowerCase"?s.data=s.data.toLowerCase():i.kind==="toUpperCase"?s.data=s.data.toUpperCase():i.kind==="startsWith"?s.data.startsWith(i.value)||(n=this._getOrReturnCtx(s,n),we(n,{code:me.invalid_string,validation:{startsWith:i.value},message:i.message}),a.dirty()):i.kind==="endsWith"?s.data.endsWith(i.value)||(n=this._getOrReturnCtx(s,n),we(n,{code:me.invalid_string,validation:{endsWith:i.value},message:i.message}),a.dirty()):i.kind==="datetime"?wb(i).test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{code:me.invalid_string,validation:"datetime",message:i.message}),a.dirty()):i.kind==="date"?R4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{code:me.invalid_string,validation:"date",message:i.message}),a.dirty()):i.kind==="time"?I4(i).test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{code:me.invalid_string,validation:"time",message:i.message}),a.dirty()):i.kind==="duration"?S4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"duration",code:me.invalid_string,message:i.message}),a.dirty()):i.kind==="ip"?F4(s.data,i.version)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"ip",code:me.invalid_string,message:i.message}),a.dirty()):i.kind==="jwt"?O4(s.data,i.alg)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"jwt",code:me.invalid_string,message:i.message}),a.dirty()):i.kind==="cidr"?$4(s.data,i.version)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"cidr",code:me.invalid_string,message:i.message}),a.dirty()):i.kind==="base64"?D4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"base64",code:me.invalid_string,message:i.message}),a.dirty()):i.kind==="base64url"?M4.test(s.data)||(n=this._getOrReturnCtx(s,n),we(n,{validation:"base64url",code:me.invalid_string,message:i.message}),a.dirty()):ht.assertNever(i);return{status:a.value,value:s.data}}_regex(s,r,a){return this.refinement(n=>s.test(n),{validation:r,code:me.invalid_string,..._e.errToObj(a)})}_addCheck(s){return new gr({...this._def,checks:[...this._def.checks,s]})}email(s){return this._addCheck({kind:"email",..._e.errToObj(s)})}url(s){return this._addCheck({kind:"url",..._e.errToObj(s)})}emoji(s){return this._addCheck({kind:"emoji",..._e.errToObj(s)})}uuid(s){return this._addCheck({kind:"uuid",..._e.errToObj(s)})}nanoid(s){return this._addCheck({kind:"nanoid",..._e.errToObj(s)})}cuid(s){return this._addCheck({kind:"cuid",..._e.errToObj(s)})}cuid2(s){return this._addCheck({kind:"cuid2",..._e.errToObj(s)})}ulid(s){return this._addCheck({kind:"ulid",..._e.errToObj(s)})}base64(s){return this._addCheck({kind:"base64",..._e.errToObj(s)})}base64url(s){return this._addCheck({kind:"base64url",..._e.errToObj(s)})}jwt(s){return this._addCheck({kind:"jwt",..._e.errToObj(s)})}ip(s){return this._addCheck({kind:"ip",..._e.errToObj(s)})}cidr(s){return this._addCheck({kind:"cidr",..._e.errToObj(s)})}datetime(s){return typeof s=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:s}):this._addCheck({kind:"datetime",precision:typeof s?.precision>"u"?null:s?.precision,offset:s?.offset??!1,local:s?.local??!1,..._e.errToObj(s?.message)})}date(s){return this._addCheck({kind:"date",message:s})}time(s){return typeof s=="string"?this._addCheck({kind:"time",precision:null,message:s}):this._addCheck({kind:"time",precision:typeof s?.precision>"u"?null:s?.precision,..._e.errToObj(s?.message)})}duration(s){return this._addCheck({kind:"duration",..._e.errToObj(s)})}regex(s,r){return this._addCheck({kind:"regex",regex:s,..._e.errToObj(r)})}includes(s,r){return this._addCheck({kind:"includes",value:s,position:r?.position,..._e.errToObj(r?.message)})}startsWith(s,r){return this._addCheck({kind:"startsWith",value:s,..._e.errToObj(r)})}endsWith(s,r){return this._addCheck({kind:"endsWith",value:s,..._e.errToObj(r)})}min(s,r){return this._addCheck({kind:"min",value:s,..._e.errToObj(r)})}max(s,r){return this._addCheck({kind:"max",value:s,..._e.errToObj(r)})}length(s,r){return this._addCheck({kind:"length",value:s,..._e.errToObj(r)})}nonempty(s){return this.min(1,_e.errToObj(s))}trim(){return new gr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new gr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new gr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(s=>s.kind==="datetime")}get isDate(){return!!this._def.checks.find(s=>s.kind==="date")}get isTime(){return!!this._def.checks.find(s=>s.kind==="time")}get isDuration(){return!!this._def.checks.find(s=>s.kind==="duration")}get isEmail(){return!!this._def.checks.find(s=>s.kind==="email")}get isURL(){return!!this._def.checks.find(s=>s.kind==="url")}get isEmoji(){return!!this._def.checks.find(s=>s.kind==="emoji")}get isUUID(){return!!this._def.checks.find(s=>s.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(s=>s.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(s=>s.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(s=>s.kind==="cuid2")}get isULID(){return!!this._def.checks.find(s=>s.kind==="ulid")}get isIP(){return!!this._def.checks.find(s=>s.kind==="ip")}get isCIDR(){return!!this._def.checks.find(s=>s.kind==="cidr")}get isBase64(){return!!this._def.checks.find(s=>s.kind==="base64")}get isBase64url(){return!!this._def.checks.find(s=>s.kind==="base64url")}get minLength(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s}get maxLength(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s}}gr.create=t=>new gr({checks:[],typeName:Xe.ZodString,coerce:t?.coerce??!1,...tt(t)});function L4(t,s){const r=(t.toString().split(".")[1]||"").length,a=(s.toString().split(".")[1]||"").length,n=r>a?r:a,i=Number.parseInt(t.toFixed(n).replace(".","")),o=Number.parseInt(s.toFixed(n).replace(".",""));return i%o/10**n}class Sa extends at{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(s){if(this._def.coerce&&(s.data=Number(s.data)),this._getType(s)!==Te.number){const i=this._getOrReturnCtx(s);return we(i,{code:me.invalid_type,expected:Te.number,received:i.parsedType}),Be}let a;const n=new Es;for(const i of this._def.checks)i.kind==="int"?ht.isInteger(s.data)||(a=this._getOrReturnCtx(s,a),we(a,{code:me.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?s.data<i.value:s.data<=i.value)&&(a=this._getOrReturnCtx(s,a),we(a,{code:me.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?s.data>i.value:s.data>=i.value)&&(a=this._getOrReturnCtx(s,a),we(a,{code:me.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?L4(s.data,i.value)!==0&&(a=this._getOrReturnCtx(s,a),we(a,{code:me.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(s.data)||(a=this._getOrReturnCtx(s,a),we(a,{code:me.not_finite,message:i.message}),n.dirty()):ht.assertNever(i);return{status:n.value,value:s.data}}gte(s,r){return this.setLimit("min",s,!0,_e.toString(r))}gt(s,r){return this.setLimit("min",s,!1,_e.toString(r))}lte(s,r){return this.setLimit("max",s,!0,_e.toString(r))}lt(s,r){return this.setLimit("max",s,!1,_e.toString(r))}setLimit(s,r,a,n){return new Sa({...this._def,checks:[...this._def.checks,{kind:s,value:r,inclusive:a,message:_e.toString(n)}]})}_addCheck(s){return new Sa({...this._def,checks:[...this._def.checks,s]})}int(s){return this._addCheck({kind:"int",message:_e.toString(s)})}positive(s){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_e.toString(s)})}negative(s){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_e.toString(s)})}nonpositive(s){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_e.toString(s)})}nonnegative(s){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_e.toString(s)})}multipleOf(s,r){return this._addCheck({kind:"multipleOf",value:s,message:_e.toString(r)})}finite(s){return this._addCheck({kind:"finite",message:_e.toString(s)})}safe(s){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_e.toString(s)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_e.toString(s)})}get minValue(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s}get maxValue(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s}get isInt(){return!!this._def.checks.find(s=>s.kind==="int"||s.kind==="multipleOf"&&ht.isInteger(s.value))}get isFinite(){let s=null,r=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(s===null||a.value<s)&&(s=a.value)}return Number.isFinite(r)&&Number.isFinite(s)}}Sa.create=t=>new Sa({checks:[],typeName:Xe.ZodNumber,coerce:t?.coerce||!1,...tt(t)});class Ta extends at{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(s){if(this._def.coerce)try{s.data=BigInt(s.data)}catch{return this._getInvalidInput(s)}if(this._getType(s)!==Te.bigint)return this._getInvalidInput(s);let a;const n=new Es;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?s.data<i.value:s.data<=i.value)&&(a=this._getOrReturnCtx(s,a),we(a,{code:me.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?s.data>i.value:s.data>=i.value)&&(a=this._getOrReturnCtx(s,a),we(a,{code:me.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?s.data%i.value!==BigInt(0)&&(a=this._getOrReturnCtx(s,a),we(a,{code:me.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):ht.assertNever(i);return{status:n.value,value:s.data}}_getInvalidInput(s){const r=this._getOrReturnCtx(s);return we(r,{code:me.invalid_type,expected:Te.bigint,received:r.parsedType}),Be}gte(s,r){return this.setLimit("min",s,!0,_e.toString(r))}gt(s,r){return this.setLimit("min",s,!1,_e.toString(r))}lte(s,r){return this.setLimit("max",s,!0,_e.toString(r))}lt(s,r){return this.setLimit("max",s,!1,_e.toString(r))}setLimit(s,r,a,n){return new Ta({...this._def,checks:[...this._def.checks,{kind:s,value:r,inclusive:a,message:_e.toString(n)}]})}_addCheck(s){return new Ta({...this._def,checks:[...this._def.checks,s]})}positive(s){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_e.toString(s)})}negative(s){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_e.toString(s)})}nonpositive(s){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_e.toString(s)})}nonnegative(s){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_e.toString(s)})}multipleOf(s,r){return this._addCheck({kind:"multipleOf",value:s,message:_e.toString(r)})}get minValue(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s}get maxValue(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s}}Ta.create=t=>new Ta({checks:[],typeName:Xe.ZodBigInt,coerce:t?.coerce??!1,...tt(t)});class wi extends at{_parse(s){if(this._def.coerce&&(s.data=!!s.data),this._getType(s)!==Te.boolean){const a=this._getOrReturnCtx(s);return we(a,{code:me.invalid_type,expected:Te.boolean,received:a.parsedType}),Be}return $s(s.data)}}wi.create=t=>new wi({typeName:Xe.ZodBoolean,coerce:t?.coerce||!1,...tt(t)});class Xa extends at{_parse(s){if(this._def.coerce&&(s.data=new Date(s.data)),this._getType(s)!==Te.date){const i=this._getOrReturnCtx(s);return we(i,{code:me.invalid_type,expected:Te.date,received:i.parsedType}),Be}if(Number.isNaN(s.data.getTime())){const i=this._getOrReturnCtx(s);return we(i,{code:me.invalid_date}),Be}const a=new Es;let n;for(const i of this._def.checks)i.kind==="min"?s.data.getTime()<i.value&&(n=this._getOrReturnCtx(s,n),we(n,{code:me.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),a.dirty()):i.kind==="max"?s.data.getTime()>i.value&&(n=this._getOrReturnCtx(s,n),we(n,{code:me.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),a.dirty()):ht.assertNever(i);return{status:a.value,value:new Date(s.data.getTime())}}_addCheck(s){return new Xa({...this._def,checks:[...this._def.checks,s]})}min(s,r){return this._addCheck({kind:"min",value:s.getTime(),message:_e.toString(r)})}max(s,r){return this._addCheck({kind:"max",value:s.getTime(),message:_e.toString(r)})}get minDate(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s!=null?new Date(s):null}get maxDate(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s!=null?new Date(s):null}}Xa.create=t=>new Xa({checks:[],coerce:t?.coerce||!1,typeName:Xe.ZodDate,...tt(t)});class zo extends at{_parse(s){if(this._getType(s)!==Te.symbol){const a=this._getOrReturnCtx(s);return we(a,{code:me.invalid_type,expected:Te.symbol,received:a.parsedType}),Be}return $s(s.data)}}zo.create=t=>new zo({typeName:Xe.ZodSymbol,...tt(t)});class ki extends at{_parse(s){if(this._getType(s)!==Te.undefined){const a=this._getOrReturnCtx(s);return we(a,{code:me.invalid_type,expected:Te.undefined,received:a.parsedType}),Be}return $s(s.data)}}ki.create=t=>new ki({typeName:Xe.ZodUndefined,...tt(t)});class Si extends at{_parse(s){if(this._getType(s)!==Te.null){const a=this._getOrReturnCtx(s);return we(a,{code:me.invalid_type,expected:Te.null,received:a.parsedType}),Be}return $s(s.data)}}Si.create=t=>new Si({typeName:Xe.ZodNull,...tt(t)});class Mn extends at{constructor(){super(...arguments),this._any=!0}_parse(s){return $s(s.data)}}Mn.create=t=>new Mn({typeName:Xe.ZodAny,...tt(t)});class Wa extends at{constructor(){super(...arguments),this._unknown=!0}_parse(s){return $s(s.data)}}Wa.create=t=>new Wa({typeName:Xe.ZodUnknown,...tt(t)});class na extends at{_parse(s){const r=this._getOrReturnCtx(s);return we(r,{code:me.invalid_type,expected:Te.never,received:r.parsedType}),Be}}na.create=t=>new na({typeName:Xe.ZodNever,...tt(t)});class Bo extends at{_parse(s){if(this._getType(s)!==Te.undefined){const a=this._getOrReturnCtx(s);return we(a,{code:me.invalid_type,expected:Te.void,received:a.parsedType}),Be}return $s(s.data)}}Bo.create=t=>new Bo({typeName:Xe.ZodVoid,...tt(t)});class vr extends at{_parse(s){const{ctx:r,status:a}=this._processInputParams(s),n=this._def;if(r.parsedType!==Te.array)return we(r,{code:me.invalid_type,expected:Te.array,received:r.parsedType}),Be;if(n.exactLength!==null){const o=r.data.length>n.exactLength.value,l=r.data.length<n.exactLength.value;(o||l)&&(we(r,{code:o?me.too_big:me.too_small,minimum:l?n.exactLength.value:void 0,maximum:o?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),a.dirty())}if(n.minLength!==null&&r.data.length<n.minLength.value&&(we(r,{code:me.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),a.dirty()),n.maxLength!==null&&r.data.length>n.maxLength.value&&(we(r,{code:me.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((o,l)=>n.type._parseAsync(new Ir(r,o,r.path,l)))).then(o=>Es.mergeArray(a,o));const i=[...r.data].map((o,l)=>n.type._parseSync(new Ir(r,o,r.path,l)));return Es.mergeArray(a,i)}get element(){return this._def.type}min(s,r){return new vr({...this._def,minLength:{value:s,message:_e.toString(r)}})}max(s,r){return new vr({...this._def,maxLength:{value:s,message:_e.toString(r)}})}length(s,r){return new vr({...this._def,exactLength:{value:s,message:_e.toString(r)}})}nonempty(s){return this.min(1,s)}}vr.create=(t,s)=>new vr({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Xe.ZodArray,...tt(s)});function dn(t){if(t instanceof Bt){const s={};for(const r in t.shape){const a=t.shape[r];s[r]=Mr.create(dn(a))}return new Bt({...t._def,shape:()=>s})}else return t instanceof vr?new vr({...t._def,type:dn(t.element)}):t instanceof Mr?Mr.create(dn(t.unwrap())):t instanceof Ca?Ca.create(dn(t.unwrap())):t instanceof Fr?Fr.create(t.items.map(s=>dn(s))):t}class Bt extends at{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const s=this._def.shape(),r=ht.objectKeys(s);return this._cached={shape:s,keys:r},this._cached}_parse(s){if(this._getType(s)!==Te.object){const d=this._getOrReturnCtx(s);return we(d,{code:me.invalid_type,expected:Te.object,received:d.parsedType}),Be}const{status:a,ctx:n}=this._processInputParams(s),{shape:i,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof na&&this._def.unknownKeys==="strip"))for(const d in n.data)o.includes(d)||l.push(d);const u=[];for(const d of o){const c=i[d],f=n.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new Ir(n,f,n.path,d)),alwaysSet:d in n.data})}if(this._def.catchall instanceof na){const d=this._def.unknownKeys;if(d==="passthrough")for(const c of l)u.push({key:{status:"valid",value:c},value:{status:"valid",value:n.data[c]}});else if(d==="strict")l.length>0&&(we(n,{code:me.unrecognized_keys,keys:l}),a.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const c of l){const f=n.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new Ir(n,f,n.path,c)),alwaysSet:c in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const d=[];for(const c of u){const f=await c.key,m=await c.value;d.push({key:f,value:m,alwaysSet:c.alwaysSet})}return d}).then(d=>Es.mergeObjectSync(a,d)):Es.mergeObjectSync(a,u)}get shape(){return this._def.shape()}strict(s){return _e.errToObj,new Bt({...this._def,unknownKeys:"strict",...s!==void 0?{errorMap:(r,a)=>{const n=this._def.errorMap?.(r,a).message??a.defaultError;return r.code==="unrecognized_keys"?{message:_e.errToObj(s).message??n}:{message:n}}}:{}})}strip(){return new Bt({...this._def,unknownKeys:"strip"})}passthrough(){return new Bt({...this._def,unknownKeys:"passthrough"})}extend(s){return new Bt({...this._def,shape:()=>({...this._def.shape(),...s})})}merge(s){return new Bt({unknownKeys:s._def.unknownKeys,catchall:s._def.catchall,shape:()=>({...this._def.shape(),...s._def.shape()}),typeName:Xe.ZodObject})}setKey(s,r){return this.augment({[s]:r})}catchall(s){return new Bt({...this._def,catchall:s})}pick(s){const r={};for(const a of ht.objectKeys(s))s[a]&&this.shape[a]&&(r[a]=this.shape[a]);return new Bt({...this._def,shape:()=>r})}omit(s){const r={};for(const a of ht.objectKeys(this.shape))s[a]||(r[a]=this.shape[a]);return new Bt({...this._def,shape:()=>r})}deepPartial(){return dn(this)}partial(s){const r={};for(const a of ht.objectKeys(this.shape)){const n=this.shape[a];s&&!s[a]?r[a]=n:r[a]=n.optional()}return new Bt({...this._def,shape:()=>r})}required(s){const r={};for(const a of ht.objectKeys(this.shape))if(s&&!s[a])r[a]=this.shape[a];else{let i=this.shape[a];for(;i instanceof Mr;)i=i._def.innerType;r[a]=i}return new Bt({...this._def,shape:()=>r})}keyof(){return kb(ht.objectKeys(this.shape))}}Bt.create=(t,s)=>new Bt({shape:()=>t,unknownKeys:"strip",catchall:na.create(),typeName:Xe.ZodObject,...tt(s)});Bt.strictCreate=(t,s)=>new Bt({shape:()=>t,unknownKeys:"strict",catchall:na.create(),typeName:Xe.ZodObject,...tt(s)});Bt.lazycreate=(t,s)=>new Bt({shape:t,unknownKeys:"strip",catchall:na.create(),typeName:Xe.ZodObject,...tt(s)});class Ti extends at{_parse(s){const{ctx:r}=this._processInputParams(s),a=this._def.options;function n(i){for(const l of i)if(l.result.status==="valid")return l.result;for(const l of i)if(l.result.status==="dirty")return r.common.issues.push(...l.ctx.common.issues),l.result;const o=i.map(l=>new Js(l.ctx.common.issues));return we(r,{code:me.invalid_union,unionErrors:o}),Be}if(r.common.async)return Promise.all(a.map(async i=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(n);{let i;const o=[];for(const u of a){const d={...r,common:{...r.common,issues:[]},parent:null},c=u._parseSync({data:r.data,path:r.path,parent:d});if(c.status==="valid")return c;c.status==="dirty"&&!i&&(i={result:c,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const l=o.map(u=>new Js(u));return we(r,{code:me.invalid_union,unionErrors:l}),Be}}get options(){return this._def.options}}Ti.create=(t,s)=>new Ti({options:t,typeName:Xe.ZodUnion,...tt(s)});const qr=t=>t instanceof Pi?qr(t.schema):t instanceof br?qr(t.innerType()):t instanceof _i?[t.value]:t instanceof Aa?t.options:t instanceof Ei?ht.objectValues(t.enum):t instanceof Di?qr(t._def.innerType):t instanceof ki?[void 0]:t instanceof Si?[null]:t instanceof Mr?[void 0,...qr(t.unwrap())]:t instanceof Ca?[null,...qr(t.unwrap())]:t instanceof du||t instanceof Ri?qr(t.unwrap()):t instanceof Mi?qr(t._def.innerType):[];class jl extends at{_parse(s){const{ctx:r}=this._processInputParams(s);if(r.parsedType!==Te.object)return we(r,{code:me.invalid_type,expected:Te.object,received:r.parsedType}),Be;const a=this.discriminator,n=r.data[a],i=this.optionsMap.get(n);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(we(r,{code:me.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),Be)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(s,r,a){const n=new Map;for(const i of r){const o=qr(i.shape[s]);if(!o.length)throw new Error(`A discriminator value for key \`${s}\` could not be extracted from all schema options`);for(const l of o){if(n.has(l))throw new Error(`Discriminator property ${String(s)} has duplicate value ${String(l)}`);n.set(l,i)}}return new jl({typeName:Xe.ZodDiscriminatedUnion,discriminator:s,options:r,optionsMap:n,...tt(a)})}}function Qc(t,s){const r=Wr(t),a=Wr(s);if(t===s)return{valid:!0,data:t};if(r===Te.object&&a===Te.object){const n=ht.objectKeys(s),i=ht.objectKeys(t).filter(l=>n.indexOf(l)!==-1),o={...t,...s};for(const l of i){const u=Qc(t[l],s[l]);if(!u.valid)return{valid:!1};o[l]=u.data}return{valid:!0,data:o}}else if(r===Te.array&&a===Te.array){if(t.length!==s.length)return{valid:!1};const n=[];for(let i=0;i<t.length;i++){const o=t[i],l=s[i],u=Qc(o,l);if(!u.valid)return{valid:!1};n.push(u.data)}return{valid:!0,data:n}}else return r===Te.date&&a===Te.date&&+t==+s?{valid:!0,data:t}:{valid:!1}}class Ai extends at{_parse(s){const{status:r,ctx:a}=this._processInputParams(s),n=(i,o)=>{if(Hc(i)||Hc(o))return Be;const l=Qc(i.value,o.value);return l.valid?((Gc(i)||Gc(o))&&r.dirty(),{status:r.value,value:l.data}):(we(a,{code:me.invalid_intersection_types}),Be)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([i,o])=>n(i,o)):n(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}Ai.create=(t,s,r)=>new Ai({left:t,right:s,typeName:Xe.ZodIntersection,...tt(r)});class Fr extends at{_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==Te.array)return we(a,{code:me.invalid_type,expected:Te.array,received:a.parsedType}),Be;if(a.data.length<this._def.items.length)return we(a,{code:me.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Be;!this._def.rest&&a.data.length>this._def.items.length&&(we(a,{code:me.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...a.data].map((o,l)=>{const u=this._def.items[l]||this._def.rest;return u?u._parse(new Ir(a,o,a.path,l)):null}).filter(o=>!!o);return a.common.async?Promise.all(i).then(o=>Es.mergeArray(r,o)):Es.mergeArray(r,i)}get items(){return this._def.items}rest(s){return new Fr({...this._def,rest:s})}}Fr.create=(t,s)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Fr({items:t,typeName:Xe.ZodTuple,rest:null,...tt(s)})};class Ci extends at{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==Te.object)return we(a,{code:me.invalid_type,expected:Te.object,received:a.parsedType}),Be;const n=[],i=this._def.keyType,o=this._def.valueType;for(const l in a.data)n.push({key:i._parse(new Ir(a,l,a.path,l)),value:o._parse(new Ir(a,a.data[l],a.path,l)),alwaysSet:l in a.data});return a.common.async?Es.mergeObjectAsync(r,n):Es.mergeObjectSync(r,n)}get element(){return this._def.valueType}static create(s,r,a){return r instanceof at?new Ci({keyType:s,valueType:r,typeName:Xe.ZodRecord,...tt(a)}):new Ci({keyType:gr.create(),valueType:s,typeName:Xe.ZodRecord,...tt(r)})}}class qo extends at{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==Te.map)return we(a,{code:me.invalid_type,expected:Te.map,received:a.parsedType}),Be;const n=this._def.keyType,i=this._def.valueType,o=[...a.data.entries()].map(([l,u],d)=>({key:n._parse(new Ir(a,l,a.path,[d,"key"])),value:i._parse(new Ir(a,u,a.path,[d,"value"]))}));if(a.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const u of o){const d=await u.key,c=await u.value;if(d.status==="aborted"||c.status==="aborted")return Be;(d.status==="dirty"||c.status==="dirty")&&r.dirty(),l.set(d.value,c.value)}return{status:r.value,value:l}})}else{const l=new Map;for(const u of o){const d=u.key,c=u.value;if(d.status==="aborted"||c.status==="aborted")return Be;(d.status==="dirty"||c.status==="dirty")&&r.dirty(),l.set(d.value,c.value)}return{status:r.value,value:l}}}}qo.create=(t,s,r)=>new qo({valueType:s,keyType:t,typeName:Xe.ZodMap,...tt(r)});class Za extends at{_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==Te.set)return we(a,{code:me.invalid_type,expected:Te.set,received:a.parsedType}),Be;const n=this._def;n.minSize!==null&&a.data.size<n.minSize.value&&(we(a,{code:me.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),r.dirty()),n.maxSize!==null&&a.data.size>n.maxSize.value&&(we(a,{code:me.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),r.dirty());const i=this._def.valueType;function o(u){const d=new Set;for(const c of u){if(c.status==="aborted")return Be;c.status==="dirty"&&r.dirty(),d.add(c.value)}return{status:r.value,value:d}}const l=[...a.data.values()].map((u,d)=>i._parse(new Ir(a,u,a.path,d)));return a.common.async?Promise.all(l).then(u=>o(u)):o(l)}min(s,r){return new Za({...this._def,minSize:{value:s,message:_e.toString(r)}})}max(s,r){return new Za({...this._def,maxSize:{value:s,message:_e.toString(r)}})}size(s,r){return this.min(s,r).max(s,r)}nonempty(s){return this.min(1,s)}}Za.create=(t,s)=>new Za({valueType:t,minSize:null,maxSize:null,typeName:Xe.ZodSet,...tt(s)});class bn extends at{constructor(){super(...arguments),this.validate=this.implement}_parse(s){const{ctx:r}=this._processInputParams(s);if(r.parsedType!==Te.function)return we(r,{code:me.invalid_type,expected:Te.function,received:r.parsedType}),Be;function a(l,u){return Vo({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Lo(),Dn].filter(d=>!!d),issueData:{code:me.invalid_arguments,argumentsError:u}})}function n(l,u){return Vo({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Lo(),Dn].filter(d=>!!d),issueData:{code:me.invalid_return_type,returnTypeError:u}})}const i={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof Rn){const l=this;return $s(async function(...u){const d=new Js([]),c=await l._def.args.parseAsync(u,i).catch(y=>{throw d.addIssue(a(u,y)),d}),f=await Reflect.apply(o,this,c);return await l._def.returns._def.type.parseAsync(f,i).catch(y=>{throw d.addIssue(n(f,y)),d})})}else{const l=this;return $s(function(...u){const d=l._def.args.safeParse(u,i);if(!d.success)throw new Js([a(u,d.error)]);const c=Reflect.apply(o,this,d.data),f=l._def.returns.safeParse(c,i);if(!f.success)throw new Js([n(c,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...s){return new bn({...this._def,args:Fr.create(s).rest(Wa.create())})}returns(s){return new bn({...this._def,returns:s})}implement(s){return this.parse(s)}strictImplement(s){return this.parse(s)}static create(s,r,a){return new bn({args:s||Fr.create([]).rest(Wa.create()),returns:r||Wa.create(),typeName:Xe.ZodFunction,...tt(a)})}}class Pi extends at{get schema(){return this._def.getter()}_parse(s){const{ctx:r}=this._processInputParams(s);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}Pi.create=(t,s)=>new Pi({getter:t,typeName:Xe.ZodLazy,...tt(s)});class _i extends at{_parse(s){if(s.data!==this._def.value){const r=this._getOrReturnCtx(s);return we(r,{received:r.data,code:me.invalid_literal,expected:this._def.value}),Be}return{status:"valid",value:s.data}}get value(){return this._def.value}}_i.create=(t,s)=>new _i({value:t,typeName:Xe.ZodLiteral,...tt(s)});function kb(t,s){return new Aa({values:t,typeName:Xe.ZodEnum,...tt(s)})}class Aa extends at{_parse(s){if(typeof s.data!="string"){const r=this._getOrReturnCtx(s),a=this._def.values;return we(r,{expected:ht.joinValues(a),received:r.parsedType,code:me.invalid_type}),Be}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(s.data)){const r=this._getOrReturnCtx(s),a=this._def.values;return we(r,{received:r.data,code:me.invalid_enum_value,options:a}),Be}return $s(s.data)}get options(){return this._def.values}get enum(){const s={};for(const r of this._def.values)s[r]=r;return s}get Values(){const s={};for(const r of this._def.values)s[r]=r;return s}get Enum(){const s={};for(const r of this._def.values)s[r]=r;return s}extract(s,r=this._def){return Aa.create(s,{...this._def,...r})}exclude(s,r=this._def){return Aa.create(this.options.filter(a=>!s.includes(a)),{...this._def,...r})}}Aa.create=kb;class Ei extends at{_parse(s){const r=ht.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(s);if(a.parsedType!==Te.string&&a.parsedType!==Te.number){const n=ht.objectValues(r);return we(a,{expected:ht.joinValues(n),received:a.parsedType,code:me.invalid_type}),Be}if(this._cache||(this._cache=new Set(ht.getValidEnumValues(this._def.values))),!this._cache.has(s.data)){const n=ht.objectValues(r);return we(a,{received:a.data,code:me.invalid_enum_value,options:n}),Be}return $s(s.data)}get enum(){return this._def.values}}Ei.create=(t,s)=>new Ei({values:t,typeName:Xe.ZodNativeEnum,...tt(s)});class Rn extends at{unwrap(){return this._def.type}_parse(s){const{ctx:r}=this._processInputParams(s);if(r.parsedType!==Te.promise&&r.common.async===!1)return we(r,{code:me.invalid_type,expected:Te.promise,received:r.parsedType}),Be;const a=r.parsedType===Te.promise?r.data:Promise.resolve(r.data);return $s(a.then(n=>this._def.type.parseAsync(n,{path:r.path,errorMap:r.common.contextualErrorMap})))}}Rn.create=(t,s)=>new Rn({type:t,typeName:Xe.ZodPromise,...tt(s)});class br extends at{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Xe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(s){const{status:r,ctx:a}=this._processInputParams(s),n=this._def.effect||null,i={addIssue:o=>{we(a,o),o.fatal?r.abort():r.dirty()},get path(){return a.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const o=n.transform(a.data,i);if(a.common.async)return Promise.resolve(o).then(async l=>{if(r.value==="aborted")return Be;const u=await this._def.schema._parseAsync({data:l,path:a.path,parent:a});return u.status==="aborted"?Be:u.status==="dirty"||r.value==="dirty"?gn(u.value):u});{if(r.value==="aborted")return Be;const l=this._def.schema._parseSync({data:o,path:a.path,parent:a});return l.status==="aborted"?Be:l.status==="dirty"||r.value==="dirty"?gn(l.value):l}}if(n.type==="refinement"){const o=l=>{const u=n.refinement(l,i);if(a.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(a.common.async===!1){const l=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return l.status==="aborted"?Be:(l.status==="dirty"&&r.dirty(),o(l.value),{status:r.value,value:l.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(l=>l.status==="aborted"?Be:(l.status==="dirty"&&r.dirty(),o(l.value).then(()=>({status:r.value,value:l.value}))))}if(n.type==="transform")if(a.common.async===!1){const o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Qa(o))return Be;const l=n.transform(o.value,i);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:l}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>Qa(o)?Promise.resolve(n.transform(o.value,i)).then(l=>({status:r.value,value:l})):Be);ht.assertNever(n)}}br.create=(t,s,r)=>new br({schema:t,typeName:Xe.ZodEffects,effect:s,...tt(r)});br.createWithPreprocess=(t,s,r)=>new br({schema:s,effect:{type:"preprocess",transform:t},typeName:Xe.ZodEffects,...tt(r)});class Mr extends at{_parse(s){return this._getType(s)===Te.undefined?$s(void 0):this._def.innerType._parse(s)}unwrap(){return this._def.innerType}}Mr.create=(t,s)=>new Mr({innerType:t,typeName:Xe.ZodOptional,...tt(s)});class Ca extends at{_parse(s){return this._getType(s)===Te.null?$s(null):this._def.innerType._parse(s)}unwrap(){return this._def.innerType}}Ca.create=(t,s)=>new Ca({innerType:t,typeName:Xe.ZodNullable,...tt(s)});class Di extends at{_parse(s){const{ctx:r}=this._processInputParams(s);let a=r.data;return r.parsedType===Te.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Di.create=(t,s)=>new Di({innerType:t,typeName:Xe.ZodDefault,defaultValue:typeof s.default=="function"?s.default:()=>s.default,...tt(s)});class Mi extends at{_parse(s){const{ctx:r}=this._processInputParams(s),a={...r,common:{...r.common,issues:[]}},n=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return Ni(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Js(a.common.issues)},input:a.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Js(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}Mi.create=(t,s)=>new Mi({innerType:t,typeName:Xe.ZodCatch,catchValue:typeof s.catch=="function"?s.catch:()=>s.catch,...tt(s)});class Uo extends at{_parse(s){if(this._getType(s)!==Te.nan){const a=this._getOrReturnCtx(s);return we(a,{code:me.invalid_type,expected:Te.nan,received:a.parsedType}),Be}return{status:"valid",value:s.data}}}Uo.create=t=>new Uo({typeName:Xe.ZodNaN,...tt(t)});const V4=Symbol("zod_brand");class du extends at{_parse(s){const{ctx:r}=this._processInputParams(s),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}}class Xi extends at{_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?Be:i.status==="dirty"?(r.dirty(),gn(i.value)):this._def.out._parseAsync({data:i.value,path:a.path,parent:a})})();{const n=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return n.status==="aborted"?Be:n.status==="dirty"?(r.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:a.path,parent:a})}}static create(s,r){return new Xi({in:s,out:r,typeName:Xe.ZodPipeline})}}class Ri extends at{_parse(s){const r=this._def.innerType._parse(s),a=n=>(Qa(n)&&(n.value=Object.freeze(n.value)),n);return Ni(r)?r.then(n=>a(n)):a(r)}unwrap(){return this._def.innerType}}Ri.create=(t,s)=>new Ri({innerType:t,typeName:Xe.ZodReadonly,...tt(s)});function Gh(t,s){const r=typeof t=="function"?t(s):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function uu(t,s={},r){return t?Mn.create().superRefine((a,n)=>{const i=t(a);if(i instanceof Promise)return i.then(o=>{if(!o){const l=Gh(s,a),u=l.fatal??r??!0;n.addIssue({code:"custom",...l,fatal:u})}});if(!i){const o=Gh(s,a),l=o.fatal??r??!0;n.addIssue({code:"custom",...o,fatal:l})}}):Mn.create()}const z4={object:Bt.lazycreate};var Xe;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Xe||(Xe={}));const B4=(t,s={message:`Input not instance of ${t.name}`})=>uu(r=>r instanceof t,s),Qe=gr.create,Ka=Sa.create,q4=Uo.create,U4=Ta.create,mu=wi.create,ri=Xa.create,W4=zo.create,K4=ki.create,Sb=Si.create,Wo=Mn.create,H4=Wa.create,G4=na.create,Q4=Bo.create,Tb=vr.create,rn=Bt.create,X4=Bt.strictCreate,kr=Ti.create,Z4=jl.create,Y4=Ai.create,J4=Fr.create,Ab=Ci.create,eE=qo.create,tE=Za.create,sE=bn.create,rE=Pi.create,Cb=_i.create,Nl=Aa.create,aE=Ei.create,nE=Rn.create,Qh=br.create,iE=Mr.create,oE=Ca.create,lE=br.createWithPreprocess,cE=Xi.create,dE=()=>Qe().optional(),uE=()=>Ka().optional(),mE=()=>mu().optional(),ut={string:(t=>gr.create({...t,coerce:!0})),number:(t=>Sa.create({...t,coerce:!0})),boolean:(t=>wi.create({...t,coerce:!0})),bigint:(t=>Ta.create({...t,coerce:!0})),date:(t=>Xa.create({...t,coerce:!0}))},hE=Be,fE=Object.freeze(Object.defineProperty({__proto__:null,BRAND:V4,DIRTY:gn,EMPTY_PATH:y4,INVALID:Be,NEVER:hE,OK:$s,ParseStatus:Es,Schema:at,ZodAny:Mn,ZodArray:vr,ZodBigInt:Ta,ZodBoolean:wi,ZodBranded:du,ZodCatch:Mi,ZodDate:Xa,ZodDefault:Di,ZodDiscriminatedUnion:jl,ZodEffects:br,ZodEnum:Aa,ZodError:Js,get ZodFirstPartyTypeKind(){return Xe},ZodFunction:bn,ZodIntersection:Ai,ZodIssueCode:me,ZodLazy:Pi,ZodLiteral:_i,ZodMap:qo,ZodNaN:Uo,ZodNativeEnum:Ei,ZodNever:na,ZodNull:Si,ZodNullable:Ca,ZodNumber:Sa,ZodObject:Bt,ZodOptional:Mr,ZodParsedType:Te,ZodPipeline:Xi,ZodPromise:Rn,ZodReadonly:Ri,ZodRecord:Ci,ZodSchema:at,ZodSet:Za,ZodString:gr,ZodSymbol:zo,ZodTransformer:br,ZodTuple:Fr,ZodType:at,ZodUndefined:ki,ZodUnion:Ti,ZodUnknown:Wa,ZodVoid:Bo,addIssueToContext:we,any:Wo,array:Tb,bigint:U4,boolean:mu,coerce:ut,custom:uu,date:ri,datetimeRegex:wb,defaultErrorMap:Dn,discriminatedUnion:Z4,effect:Qh,enum:Nl,function:sE,getErrorMap:Lo,getParsedType:Wr,instanceof:B4,intersection:Y4,isAborted:Hc,isAsync:Ni,isDirty:Gc,isValid:Qa,late:z4,lazy:rE,literal:Cb,makeIssue:Vo,map:eE,nan:q4,nativeEnum:aE,never:G4,null:Sb,nullable:oE,number:Ka,object:rn,get objectUtil(){return Kc},oboolean:mE,onumber:uE,optional:iE,ostring:dE,pipeline:cE,preprocess:lE,promise:nE,quotelessJson:x4,record:Ab,set:tE,setErrorMap:g4,strictObject:X4,string:Qe,symbol:W4,transformer:Qh,tuple:J4,undefined:K4,union:kr,unknown:H4,get util(){return ht},void:Q4},Symbol.toStringTag,{value:"Module"})),Pb=h.createContext(void 0);function qn(){const t=h.useContext(Pb);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function pE({children:t}){const[s,r]=h.useState(null),[a,n]=h.useState(!0),i=Mt(),o=s!==null,l=()=>localStorage.getItem("accessToken"),u=()=>localStorage.getItem("refreshToken"),[d,c]=h.useState(0),[f,m]=h.useState(null);h.useEffect(()=>{om({getAccessToken:l,refreshToken:b,logout:x})},[]),h.useEffect(()=>{(async()=>{console.log("🔐 [AuthProvider] بدء تهيئة المصادقة...",new Date().toISOString());try{const I=localStorage.getItem("user"),E=localStorage.getItem("accessToken");if(console.log("🔍 [AuthProvider] فحص البيانات المحفوظة:",{hasUser:!!I,hasToken:!!E,userPreview:I?`${I.substring(0,50)}...`:"غير موجود",authFailureCount:d}),I&&E){console.log("📦 [AuthProvider] وُجدت بيانات محفوظة، محاولة التحقق...");try{const O=JSON.parse(I);console.log("👤 [AuthProvider] تم تحليل بيانات المستخدم:",{id:O.id,email:O.email}),console.log("🔍 [AuthProvider] التحقق من صحة التوكن مع الخادم...");const T=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},credentials:"include"});if(console.log("📡 [AuthProvider] استجابة التحقق:",{status:T.status,ok:T.ok}),T.ok){const S=await T.json();if(console.log("✅ [AuthProvider] بيانات الاستجابة:",S),S.success&&S.user)console.log("✅ [AuthProvider] تم التحقق من البيانات بنجاح:",{userId:S.user.id,email:S.user.email}),r(S.user),m(new Date),c(0);else throw new Error("بيانات المستخدم غير صحيحة في الاستجابة")}else if(T.status===401)console.log("🚫 [AuthProvider] التوكن منتهي الصلاحية، تسجيل خروج تلقائي"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),r(null);else{console.log(`⚠️ [AuthProvider] فشل التحقق: ${T.status}`);const S=localStorage.getItem("refreshToken");if(T.status===401&&S){console.log("🔄 [AuthProvider] محاولة تجديد التوكن...");const M=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:S}),credentials:"include"});if(M.ok){const v=await M.json();if(v.success&&v.tokens){console.log("✅ [AuthProvider] تم تجديد التوكن بنجاح"),localStorage.setItem("accessToken",v.tokens.accessToken),localStorage.setItem("refreshToken",v.tokens.refreshToken),r(O),c(0);return}}console.log("❌ [AuthProvider] فشل تجديد التوكن")}throw new Error(`HTTP ${T.status}: فشل التحقق من المصادقة`)}}catch(O){console.error("❌ [AuthProvider] خطأ في التحقق من البيانات:",O);const T=d+1;c(T),T>=3?(console.log("🧹 [AuthProvider] مسح البيانات بسبب تكرار الأخطاء"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),r(null)):console.log(`⏳ [AuthProvider] إبقاء البيانات، محاولة ${T}/3`)}}else console.log("ℹ️ [AuthProvider] لا توجد بيانات محفوظة",{hasSavedUser:!!I,hasAccessToken:!!E})}catch(I){console.error("❌ [AuthProvider] خطأ عام في تحقق المصادقة:",I)}finally{console.log("🏁 [AuthProvider] انتهاء تهيئة المصادقة، isLoading = false"),n(!1)}})()},[d]);const y=async(R,I)=>{console.log("🔑 [AuthProvider.login] بدء تسجيل الدخول:",R,new Date().toISOString()),console.log("📊 [AuthProvider.login] معاملات الدخل:",{email:R,hasPassword:!!I,passwordLength:I?.length||0,isLoading:a,isAuthenticated:o,currentUser:s?.email||"لا يوجد"});try{console.log("📡 [AuthProvider.login] إرسال طلب لـ /api/auth/login...");const E=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:R,password:I})});console.log("📨 [AuthProvider.login] تم استلام الاستجابة:",{status:E.status,statusText:E.statusText,ok:E.ok,headers:Object.fromEntries(E.headers.entries())}),console.log("📨 [AuthProvider.login] استجابة تسجيل الدخول:",E.status);const O=await E.json();if(console.log("🔍 [AuthProvider.login] البيانات الخام المستلمة:",JSON.stringify(O,null,2)),console.log("📦 [AuthProvider.login] تم استلام بيانات تسجيل الدخول بنجاح"),console.log("📦 [AuthProvider.login] تفاصيل البيانات:",{success:O.success,hasData:!!O.data,hasUser:!!(O.data?.user||O.user),hasToken:!!(O.data?.tokens?.accessToken||O.data?.accessToken||O.tokens?.accessToken||O.accessToken),dataKeys:O.data?Object.keys(O.data):"none",topLevelKeys:Object.keys(O)}),!E.ok)throw console.log("❌ [AuthProvider.login] استجابة غير ناجحة:",E.status,O.message),new Error(O.message||"فشل تسجيل الدخول");if(!O.success)throw console.log("❌ [AuthProvider.login] فشل من جانب الخادم:",O.message),new Error(O.message||"فشل تسجيل الدخول");const T=O.data?.user||O.user,S=O.data?.tokens?.accessToken||O.data?.accessToken||O.tokens?.accessToken||O.accessToken||O.token,M=O.data?.tokens?.refreshToken||O.data?.refreshToken||O.tokens?.refreshToken||O.refreshToken;if(console.log("🔍 [AuthProvider.login] فحص البيانات المستخرجة:",{hasUserData:!!T,hasToken:!!S,hasRefreshToken:!!M,userDetails:T?{id:T.id,email:T.email,name:T.name}:"none"}),!T)throw console.error("❌ [AuthProvider.login] بيانات المستخدم مفقودة:",{userData:T,dataStructure:O,possibleUserPaths:["data.user","user"]}),new Error("بيانات المستخدم مفقودة من استجابة الخادم");if(!S)throw console.error("❌ [AuthProvider.login] الرمز المميز مفقود:",{hasToken:!!S,dataStructure:O,possibleTokenPaths:["data.accessToken","tokens.accessToken","accessToken"]}),new Error("الرمز المميز مفقود من استجابة الخادم");const v={id:T.id,email:T.email,name:T.name||`${T.firstName||""} ${T.lastName||""}`.trim()||T.email,role:T.role||"admin",mfaEnabled:T.mfaEnabled||!1};if(console.log("👤 [AuthProvider.login] إعداد بيانات المستخدم:",v),console.log("👤 [AuthProvider.login] التحقق من صحة البيانات:",{hasId:!!v.id,hasEmail:!!v.email,hasName:!!v.name,hasRole:!!v.role}),!v.id||!v.email)throw console.error("❌ [AuthProvider.login] بيانات المستخدم الأساسية مفقودة:",v),new Error("بيانات المستخدم الأساسية مفقودة (ID أو البريد الإلكتروني)");console.log("💾 [AuthProvider.login] بدء حفظ البيانات..."),console.log("💾 [AuthProvider.login] محاولة تعيين المستخدم في الحالة:",v),r(v),console.log("✅ [AuthProvider.login] تم تعيين المستخدم في الحالة بنجاح"),console.log("🔍 [AuthProvider.login] التحقق من حالة المستخدم بعد التعيين:",{userSet:!!v,isAuthenticatedNow:!!v,userId:v?.id,userEmail:v?.email});try{const V=JSON.stringify(v);console.log("💾 [AuthProvider.login] محاولة حفظ بيانات المستخدم:",{userJsonLength:V.length,userJson:V.substring(0,100)+"..."}),localStorage.setItem("user",V),console.log("✅ [AuthProvider.login] تم حفظ بيانات المستخدم في localStorage بنجاح")}catch(V){throw console.error("❌ [AuthProvider.login] فشل حفظ المستخدم في localStorage:",V),new Error("فشل في حفظ بيانات المستخدم محلياً")}try{console.log("💾 [AuthProvider.login] محاولة حفظ الرمز المميز:",{tokenLength:S?.length||0,tokenPreview:S?S.substring(0,20)+"...":"فارغ"}),localStorage.setItem("accessToken",S),console.log("✅ [AuthProvider.login] تم حفظ الرمز المميز بنجاح")}catch(V){throw console.error("❌ [AuthProvider.login] فشل حفظ الرمز في localStorage:",V),new Error("فشل في حفظ الرمز المميز محلياً")}M&&(localStorage.setItem("refreshToken",M),console.log("✅ [AuthProvider.login] تم حفظ رمز التجديد")),console.log("💾 [AuthProvider.login] تم حفظ جميع البيانات بنجاح");const W=localStorage.getItem("user"),j=localStorage.getItem("accessToken");console.log("🔍 [AuthProvider.login] تأكيد الحفظ:",{userSaved:!!W,tokenSaved:!!j,userInState:!!v}),console.log("🔄 [AuthProvider.login] تحديث cache queries"),i.invalidateQueries(),console.log("🎉 [AuthProvider.login] اكتمل تسجيل الدخول بنجاح"),console.log("🔄 [AuthProvider.login] إجبار تحديث حالة المصادقة..."),setTimeout(()=>{console.log("✅ [AuthProvider.login] تم تأكيد حالة المصادقة:",{isAuthenticated:!!v,userId:v?.id,userEmail:v?.email})},100)}catch(E){console.error("❌ [AuthProvider.login] خطأ في تسجيل الدخول:",E),console.error("🚨 [AuthProvider.login] تفاصيل الخطأ الشامل:",{errorType:typeof E,errorName:E instanceof Error?E.name:"Unknown",errorMessage:E instanceof Error?E.message:String(E),errorStack:E instanceof Error?E.stack:"No stack trace",timestamp:new Date().toISOString()}),console.error("❌ [AuthProvider.login] تفاصيل الخطأ:",{message:E instanceof Error?E.message:String(E),stack:E instanceof Error?E.stack:void 0,name:E instanceof Error?E.name:"UnknownError"});const O=E instanceof Error?E.message:String(E);throw O&&O.includes("غير مكتملة")||O&&O.includes("مفقود")?E:new Error("حدث خطأ أثناء تسجيل الدخول، يرجى المحاولة مرة أخرى")}},x=async()=>{try{console.log("🚪 [AuthProvider.logout] بدء عملية تسجيل الخروج...");const R=localStorage.getItem("accessToken");if(R){console.log("📤 [AuthProvider.logout] إرسال طلب logout للخادم...");const I=await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${R}`}});if(I.ok){const E=await I.json();console.log("✅ [AuthProvider.logout] استجابة logout من الخادم:",E)}else console.warn("⚠️ [AuthProvider.logout] فشل في logout من الخادم، سنتابع التنظيف المحلي")}else console.log("ℹ️ [AuthProvider.logout] لا يوجد access token، التنظيف المحلي فقط")}catch(R){console.error("❌ [AuthProvider.logout] خطأ في تسجيل الخروج:",R),console.warn("⚠️ [AuthProvider.logout] سنتابع التنظيف المحلي رغم الخطأ")}finally{console.log("🧹 [AuthProvider.logout] بدء التنظيف المحلي..."),r(null),console.log("✅ [AuthProvider.logout] تم مسح بيانات المستخدم من الحالة"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),console.log("✅ [AuthProvider.logout] تم مسح جميع البيانات من localStorage"),i.clear(),console.log("✅ [AuthProvider.logout] تم مسح cache"),console.log("🎉 [AuthProvider.logout] اكتمل تسجيل الخروج بنجاح")}},[p,A]=h.useState(0),[g,N]=h.useState(!1),w=R=>new Promise(I=>setTimeout(I,R)),_=R=>Math.min(100*Math.pow(2,R),5e3),b=async(R=!1)=>{if(console.log("🔄 [AuthProvider.refreshToken] بدء عملية تجديد الرمز..."),g&&!R){for(console.log("⏳ [AuthProvider.refreshToken] تجديد جارٍ بالفعل، انتظار...");g;)await w(100);return localStorage.getItem("accessToken")!==null}N(!0);const I=Date.now();try{const E=localStorage.getItem("refreshToken");if(!E)return console.log("❌ [AuthProvider.refreshToken] لا يوجد refresh token"),!1;const O=3;for(let S=0;S<O;S++){const M=Date.now();console.log(`🔄 [AuthProvider.refreshToken] محاولة ${S+1}/${O}...`);try{const v=new AbortController,W=setTimeout(()=>{v.abort(),console.log(`⏰ [AuthProvider.refreshToken] timeout للمحاولة ${S+1}`)},1e4),j=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:E}),signal:v.signal});clearTimeout(W);const V=Date.now()-M;console.log(`📊 [AuthProvider.refreshToken] محاولة ${S+1} استغرقت ${V}ms`);const ne=await j.text();let F;try{F=JSON.parse(ne)}catch{console.log("❌ [AuthProvider.refreshToken] فشل parsing JSON:",ne),F={success:!1,message:ne}}if(j.ok&&F.success&&F.tokens){console.log("📦 [AuthProvider.refreshToken] استجابة ناجحة:",{success:F.success,hasTokens:!!F.tokens}),localStorage.setItem("accessToken",F.tokens.accessToken),localStorage.setItem("refreshToken",F.tokens.refreshToken),A(0);const ye=Date.now()-I;return console.log(`✅ [AuthProvider.refreshToken] نجح التجديد في ${ye}ms بعد ${S+1} محاولة`),!0}else console.log(`❌ [AuthProvider.refreshToken] فشل ${j.status}:`,F.message||ne);if(j.status===401||j.status===403){console.log("🚫 [AuthProvider.refreshToken] refresh token منتهي الصلاحية - لا فائدة من إعادة المحاولة");break}}catch(v){const W=Date.now()-M;v instanceof Error?v.name==="AbortError"?console.log(`⏰ [AuthProvider.refreshToken] timeout في المحاولة ${S+1} بعد ${W}ms`):console.log(`🌐 [AuthProvider.refreshToken] خطأ شبكة في المحاولة ${S+1}:`,v.message):console.log(`❓ [AuthProvider.refreshToken] خطأ غير معروف في المحاولة ${S+1}:`,v)}if(S<O-1){const v=_(S);console.log(`⏰ [AuthProvider.refreshToken] انتظار ${v}ms قبل المحاولة التالية...`),await w(v)}}A(S=>S+1);const T=Date.now()-I;return console.log(`❌ [AuthProvider.refreshToken] فشل التجديد نهائياً بعد ${T}ms و${O} محاولات`),!1}catch(E){const O=Date.now()-I;return console.error(`💥 [AuthProvider.refreshToken] خطأ عام بعد ${O}ms:`,E),A(T=>T+1),!1}finally{N(!1)}},k={user:s,isAuthenticated:o,isLoading:a,login:y,logout:x,refreshToken:b,getAccessToken:l,getRefreshToken:u};return h.useEffect(()=>{om({getAccessToken:l,refreshToken:b,logout:x})},[]),e.jsx(Pb.Provider,{value:k,children:t})}const ja=Q_,_b=h.createContext({}),Nt=({...t})=>e.jsx(_b.Provider,{value:{name:t.name},children:e.jsx(J_,{...t})}),wl=()=>{const t=h.useContext(_b),s=h.useContext(Eb),{getFieldState:r,formState:a}=bl(),n=r(t.name,a);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:i}=s;return{id:i,name:t.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},Eb=h.createContext({}),yt=h.forwardRef(({className:t,...s},r)=>{const a=h.useId();return e.jsx(Eb.Provider,{value:{id:a},children:e.jsx("div",{ref:r,className:he("space-y-2",t),...s})})});yt.displayName="FormItem";const mt=h.forwardRef(({className:t,...s},r)=>{const{error:a,formItemId:n}=wl();return e.jsx(se,{ref:r,className:he(a&&"text-destructive",t),htmlFor:n,...s})});mt.displayName="FormLabel";const vt=h.forwardRef(({...t},s)=>{const{error:r,formItemId:a,formDescriptionId:n,formMessageId:i}=wl();return e.jsx(F0,{ref:s,id:a,"aria-describedby":r?`${n} ${i}`:`${n}`,"aria-invalid":!!r,...t})});vt.displayName="FormControl";const Ii=h.forwardRef(({className:t,...s},r)=>{const{formDescriptionId:a}=wl();return e.jsx("p",{ref:r,id:a,className:he("text-sm text-muted-foreground",t),...s})});Ii.displayName="FormDescription";const bt=h.forwardRef(({className:t,children:s,...r},a)=>{const{error:n,formMessageId:i}=wl(),o=n?String(n?.message??""):s;return o?e.jsx("p",{ref:a,id:i,className:he("text-sm font-medium text-destructive",t),...r,children:o}):null});bt.displayName="FormMessage";var oc="rovingFocusGroup.onEntryFocus",xE={bubbles:!1,cancelable:!0},kl="RovingFocusGroup",[Xc,Db,gE]=G0(kl),[yE,Un]=Hs(kl,[gE]),[vE,bE]=yE(kl),Mb=h.forwardRef((t,s)=>e.jsx(Xc.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Xc.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(jE,{...t,ref:s})})}));Mb.displayName=kl;var jE=h.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:r,orientation:a,loop:n=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:u,onEntryFocus:d,preventScrollOnEntryFocus:c=!1,...f}=t,m=h.useRef(null),y=lt(s,m),x=zi(i),[p=null,A]=Pa({prop:o,defaultProp:l,onChange:u}),[g,N]=h.useState(!1),w=Lt(d),_=Db(r),b=h.useRef(!1),[k,R]=h.useState(0);return h.useEffect(()=>{const I=m.current;if(I)return I.addEventListener(oc,w),()=>I.removeEventListener(oc,w)},[w]),e.jsx(vE,{scope:r,orientation:a,dir:x,loop:n,currentTabStopId:p,onItemFocus:h.useCallback(I=>A(I),[A]),onItemShiftTab:h.useCallback(()=>N(!0),[]),onFocusableItemAdd:h.useCallback(()=>R(I=>I+1),[]),onFocusableItemRemove:h.useCallback(()=>R(I=>I-1),[]),children:e.jsx(We.div,{tabIndex:g||k===0?-1:0,"data-orientation":a,...f,ref:y,style:{outline:"none",...t.style},onMouseDown:Ne(t.onMouseDown,()=>{b.current=!0}),onFocus:Ne(t.onFocus,I=>{const E=!b.current;if(I.target===I.currentTarget&&E&&!g){const O=new CustomEvent(oc,xE);if(I.currentTarget.dispatchEvent(O),!O.defaultPrevented){const T=_().filter(j=>j.focusable),S=T.find(j=>j.active),M=T.find(j=>j.id===p),W=[S,M,...T].filter(Boolean).map(j=>j.ref.current);Fb(W,c)}}b.current=!1}),onBlur:Ne(t.onBlur,()=>N(!1))})})}),Rb="RovingFocusGroupItem",Ib=h.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:n=!1,tabStopId:i,...o}=t,l=pa(),u=i||l,d=bE(Rb,r),c=d.currentTabStopId===u,f=Db(r),{onFocusableItemAdd:m,onFocusableItemRemove:y}=d;return h.useEffect(()=>{if(a)return m(),()=>y()},[a,m,y]),e.jsx(Xc.ItemSlot,{scope:r,id:u,focusable:a,active:n,children:e.jsx(We.span,{tabIndex:c?0:-1,"data-orientation":d.orientation,...o,ref:s,onMouseDown:Ne(t.onMouseDown,x=>{a?d.onItemFocus(u):x.preventDefault()}),onFocus:Ne(t.onFocus,()=>d.onItemFocus(u)),onKeyDown:Ne(t.onKeyDown,x=>{if(x.key==="Tab"&&x.shiftKey){d.onItemShiftTab();return}if(x.target!==x.currentTarget)return;const p=kE(x,d.orientation,d.dir);if(p!==void 0){if(x.metaKey||x.ctrlKey||x.altKey||x.shiftKey)return;x.preventDefault();let g=f().filter(N=>N.focusable).map(N=>N.ref.current);if(p==="last")g.reverse();else if(p==="prev"||p==="next"){p==="prev"&&g.reverse();const N=g.indexOf(x.currentTarget);g=d.loop?SE(g,N+1):g.slice(N+1)}setTimeout(()=>Fb(g))}})})})});Ib.displayName=Rb;var NE={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function wE(t,s){return s!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function kE(t,s,r){const a=wE(t.key,r);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return NE[a]}function Fb(t,s=!1){const r=document.activeElement;for(const a of t)if(a===r||(a.focus({preventScroll:s}),document.activeElement!==r))return}function SE(t,s){return t.map((r,a)=>t[(s+a)%t.length])}var hu=Mb,fu=Ib,pu="Tabs",[TE]=Hs(pu,[Un]),Ob=Un(),[AE,xu]=TE(pu),$b=h.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,onValueChange:n,defaultValue:i,orientation:o="horizontal",dir:l,activationMode:u="automatic",...d}=t,c=zi(l),[f,m]=Pa({prop:a,onChange:n,defaultProp:i});return e.jsx(AE,{scope:r,baseId:pa(),value:f,onValueChange:m,orientation:o,dir:c,activationMode:u,children:e.jsx(We.div,{dir:c,"data-orientation":o,...d,ref:s})})});$b.displayName=pu;var Lb="TabsList",Vb=h.forwardRef((t,s)=>{const{__scopeTabs:r,loop:a=!0,...n}=t,i=xu(Lb,r),o=Ob(r);return e.jsx(hu,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:a,children:e.jsx(We.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:s})})});Vb.displayName=Lb;var zb="TabsTrigger",Bb=h.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,disabled:n=!1,...i}=t,o=xu(zb,r),l=Ob(r),u=Wb(o.baseId,a),d=Kb(o.baseId,a),c=a===o.value;return e.jsx(fu,{asChild:!0,...l,focusable:!n,active:c,children:e.jsx(We.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":d,"data-state":c?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:u,...i,ref:s,onMouseDown:Ne(t.onMouseDown,f=>{!n&&f.button===0&&f.ctrlKey===!1?o.onValueChange(a):f.preventDefault()}),onKeyDown:Ne(t.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&o.onValueChange(a)}),onFocus:Ne(t.onFocus,()=>{const f=o.activationMode!=="manual";!c&&!n&&f&&o.onValueChange(a)})})})});Bb.displayName=zb;var qb="TabsContent",Ub=h.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,forceMount:n,children:i,...o}=t,l=xu(qb,r),u=Wb(l.baseId,a),d=Kb(l.baseId,a),c=a===l.value,f=h.useRef(c);return h.useEffect(()=>{const m=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(m)},[]),e.jsx(ws,{present:n||c,children:({present:m})=>e.jsx(We.div,{"data-state":c?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":u,hidden:!m,id:d,tabIndex:0,...o,ref:s,style:{...t.style,animationDuration:f.current?"0s":void 0},children:m&&i})})});Ub.displayName=qb;function Wb(t,s){return`${t}-trigger-${s}`}function Kb(t,s){return`${t}-content-${s}`}var CE=$b,Hb=Vb,Gb=Bb,Qb=Ub;const Ks=CE,Os=h.forwardRef(({className:t,...s},r)=>e.jsx(Hb,{ref:r,className:he("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));Os.displayName=Hb.displayName;const He=h.forwardRef(({className:t,...s},r)=>e.jsx(Gb,{ref:r,className:he("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));He.displayName=Gb.displayName;const Ge=h.forwardRef(({className:t,...s},r)=>e.jsx(Qb,{ref:r,className:he("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Ge.displayName=Qb.displayName;const PE=rn({email:Qe().email("بريد إلكتروني غير صالح").min(1,"البريد الإلكتروني مطلوب"),password:Qe().min(1,"كلمة المرور مطلوبة"),totpCode:Qe().optional()}),_E=rn({name:Qe().min(2,"الاسم يجب أن يكون حرفين على الأقل").max(50,"الاسم طويل جداً"),email:Qe().email("بريد إلكتروني غير صالح").min(1,"البريد الإلكتروني مطلوب"),phone:Qe().min(9,"رقم الهاتف غير صحيح").optional(),password:Qe().min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"كلمة المرور يجب أن تحتوي على حروف كبيرة وصغيرة وأرقام"),confirmPassword:Qe().min(1,"تأكيد كلمة المرور مطلوب")}).refine(t=>t.password===t.confirmPassword,{message:"كلمات المرور غير متطابقة",path:["confirmPassword"]}),EE=rn({email:Qe().email("بريد إلكتروني غير صالح").min(1,"البريد الإلكتروني مطلوب")}),DE=()=>e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-32 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-purple-600/20 rounded-full blur-3xl animate-blob"}),e.jsx("div",{className:"absolute -bottom-32 -left-40 w-96 h-96 bg-gradient-to-tr from-green-400/20 to-blue-600/20 rounded-full blur-3xl animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gradient-to-r from-purple-400/20 to-pink-600/20 rounded-full blur-3xl animate-blob animation-delay-4000"})]}),ME=()=>e.jsxs("div",{className:"flex flex-col items-center space-y-4 mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full blur-lg opacity-75 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-r from-blue-600 to-purple-600 rounded-full p-4",children:e.jsx(Qt,{className:"w-12 h-12 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"نظام إدارة المشاريع"}),e.jsx("p",{className:"text-lg text-gray-600 mt-2",children:"الحل الشامل لإدارة المشاريع الإنشائية"})]})]});function Xh(){const[,t]=Or(),{toast:s}=Ct();Mt();const{login:r}=qn(),[a,n]=h.useState("login"),[i,o]=h.useState(!1),[l,u]=h.useState(!1),[d,c]=h.useState("credentials"),f=va({resolver:ba(PE),defaultValues:{email:"",password:"",totpCode:""}}),m=va({resolver:ba(_E),defaultValues:{name:"",email:"",phone:"",password:"",confirmPassword:""}}),y=va({resolver:ba(EE),defaultValues:{email:""}}),x=Ce({mutationFn:async b=>{console.log("🚀 [AuthPage.loginMutation] بدء عملية تسجيل الدخول:",{email:b.email,hasPassword:!!b.password,timestamp:new Date().toISOString()});try{const k=await r(b.email,b.password);return console.log("✅ [AuthPage.loginMutation] تمت عملية login بنجاح:",k),k}catch(k){throw console.error("❌ [AuthPage.loginMutation] خطأ في login:",k),k}},onSuccess:b=>{console.log("🎉 [AuthPage.loginMutation] نجح تسجيل الدخول"),s({title:"تم تسجيل الدخول بنجاح",description:"أهلاً وسهلاً بك"}),setTimeout(()=>{t("/"),setTimeout(()=>{window.location.pathname==="/login"&&(window.location.href="/")},1e3)},500)},onError:b=>{console.error("❌ [AuthPage.loginMutation] فشل تسجيل الدخول:",b),s({title:"فشل تسجيل الدخول",description:b.message||"حدث خطأ أثناء الاتصال بالخادم",variant:"destructive"})}}),p=Ce({mutationFn:async b=>{const k=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b.name,email:b.email,phone:b.phone,password:b.password})});if(!k.ok&&k.status!==201&&k.status!==202)throw new Error(`خطأ في الشبكة: ${k.status}`);return k.json()},onSuccess:b=>{b.success?(s({title:"تم إنشاء الحساب بنجاح",description:b.requireVerification?"يرجى التحقق من بريدك الإلكتروني لتفعيل الحساب":"يمكنك الآن تسجيل الدخول"}),n("login")):s({title:"فشل إنشاء الحساب",description:b.message,variant:"destructive"})},onError:b=>{s({title:"خطأ في إنشاء الحساب",description:"حدث خطأ أثناء الاتصال بالخادم",variant:"destructive"}),console.error("Register error:",b)}}),A=Ce({mutationFn:async b=>{const k=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!k.ok)throw new Error("فشل في إرسال طلب استرجاع كلمة المرور");return k.json()},onSuccess:()=>{s({title:"تم إرسال رابط الاسترجاع",description:"يرجى التحقق من بريدك الإلكتروني"}),n("login")},onError:b=>{s({title:"خطأ في استرجاع كلمة المرور",description:"حدث خطأ أثناء المعالجة",variant:"destructive"})}}),g=b=>{console.log("🚀 [AuthPage.onLoginSubmit] تسجيل دخول:",{email:b.email,hasPassword:!!b.password,timestamp:new Date().toISOString()}),x.mutate(b)},N=b=>{p.mutate(b)},w=b=>{A.mutate(b)},_=()=>{console.log("🎯 [AuthPage.QuickLogin] الضغط على زر الدخول السريع"),f.setValue("email","test@demo.local"),f.setValue("password","testpassword"),setTimeout(()=>{const b=f.getValues();g(b)},100)};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",dir:"rtl",children:[e.jsx(DE,{}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/80 via-white/90 to-purple-50/80 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-10 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsx(ME,{}),e.jsxs(q,{className:"glass-morphism border-0 shadow-2xl backdrop-blur-xl",children:[e.jsxs(ue,{className:"space-y-1 text-center pb-8",children:[e.jsx(pe,{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"مرحباً بك"}),e.jsx(js,{className:"text-gray-600",children:"اختر العملية المطلوبة من الأسفل"})]}),e.jsx(H,{className:"space-y-6",children:e.jsxs(Ks,{value:a,onValueChange:b=>n(b),className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3 glass-tabs",children:[e.jsxs(He,{value:"login",className:"flex items-center gap-2 tab-trigger",children:[e.jsx(Qt,{className:"w-4 h-4"}),"تسجيل الدخول"]}),e.jsxs(He,{value:"register",className:"flex items-center gap-2 tab-trigger",children:[e.jsx(gm,{className:"w-4 h-4"}),"حساب جديد"]}),e.jsxs(He,{value:"forgot",className:"flex items-center gap-2 tab-trigger",children:[e.jsx(Kk,{className:"w-4 h-4"}),"استرجاع"]})]}),e.jsx(Ge,{value:"login",className:"space-y-4 tab-content",children:e.jsx(ja,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(g),className:"space-y-4",children:[d==="credentials"&&e.jsxs(e.Fragment,{children:[e.jsx(Nt,{control:f.control,name:"email",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"البريد الإلكتروني"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(io,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(be,{...b,type:"email",placeholder:"admin@example.com",className:"pr-10 enhanced-input","data-testid":"input-email"})]})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:f.control,name:"password",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"كلمة المرور"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(be,{...b,type:i?"text":"password",placeholder:"كلمة المرور",className:"pl-10 enhanced-input","data-testid":"input-password"}),e.jsx("button",{type:"button",onClick:()=>o(!i),className:"absolute left-3 top-3 h-4 w-4 text-gray-400 hover:text-gray-600 transition-colors","data-testid":"button-toggle-password",children:i?e.jsx(oi,{}):e.jsx(_r,{})})]})}),e.jsx(bt,{})]})})]}),d==="mfa"&&e.jsx(Nt,{control:f.control,name:"totpCode",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"رمز التحقق الثنائي"}),e.jsx(vt,{children:e.jsx(be,{...b,type:"text",placeholder:"000000",maxLength:6,className:"text-center text-2xl tracking-widest enhanced-input","data-testid":"input-totp-code"})}),e.jsx(bt,{}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"أدخل الرمز من تطبيق المصادقة"})]})}),e.jsx($,{type:"submit",className:"w-full enhanced-button",disabled:x.isPending,"data-testid":"button-login",children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"ml-2 h-4 w-4 animate-spin"}),"جارِ تسجيل الدخول..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"ml-2 h-4 w-4"}),d==="credentials"&&"تسجيل الدخول",d==="mfa"&&"تأكيد الرمز"]})}),d==="credentials"&&e.jsxs($,{type:"button",variant:"outline",className:"w-full mt-2 enhanced-outline-button",onClick:_,disabled:x.isPending,"data-testid":"button-quick-login",children:[e.jsx(rS,{className:"ml-2 h-4 w-4"}),"تسجيل دخول سريع (تجريبي)"]})]})})}),e.jsx(Ge,{value:"register",className:"space-y-4 tab-content",children:e.jsx(ja,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(N),className:"space-y-4",children:[e.jsx(Nt,{control:m.control,name:"name",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"الاسم الكامل"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(Zs,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(be,{...b,type:"text",placeholder:"أحمد محمد",className:"pr-10 enhanced-input","data-testid":"input-name"})]})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:m.control,name:"email",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"البريد الإلكتروني"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(io,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(be,{...b,type:"email",placeholder:"ahmed@example.com",className:"pr-10 enhanced-input","data-testid":"input-email"})]})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:m.control,name:"phone",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"رقم الهاتف (اختياري)"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(ul,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(be,{...b,type:"tel",placeholder:"771234567",className:"pr-10 enhanced-input","data-testid":"input-phone"})]})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:m.control,name:"password",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"كلمة المرور"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(be,{...b,type:i?"text":"password",placeholder:"كلمة المرور",className:"pl-10 enhanced-input","data-testid":"input-password"}),e.jsx("button",{type:"button",onClick:()=>o(!i),className:"absolute left-3 top-3 h-4 w-4 text-gray-400 hover:text-gray-600 transition-colors","data-testid":"button-toggle-password",children:i?e.jsx(oi,{}):e.jsx(_r,{})})]})}),e.jsx(bt,{}),e.jsx("p",{className:"text-xs text-gray-500",children:"يجب أن تحتوي على 8 أحرف، حروف كبيرة وصغيرة، وأرقام"})]})}),e.jsx(Nt,{control:m.control,name:"confirmPassword",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"تأكيد كلمة المرور"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(be,{...b,type:l?"text":"password",placeholder:"تأكيد كلمة المرور",className:"pl-10 enhanced-input","data-testid":"input-confirm-password"}),e.jsx("button",{type:"button",onClick:()=>u(!l),className:"absolute left-3 top-3 h-4 w-4 text-gray-400 hover:text-gray-600 transition-colors","data-testid":"button-toggle-confirm-password",children:l?e.jsx(oi,{}):e.jsx(_r,{})})]})}),e.jsx(bt,{})]})}),e.jsx($,{type:"submit",className:"w-full enhanced-button",disabled:p.isPending,"data-testid":"button-register",children:p.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"ml-2 h-4 w-4 animate-spin"}),"جارِ إنشاء الحساب..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gm,{className:"ml-2 h-4 w-4"}),"إنشاء حساب جديد"]})})]})})}),e.jsxs(Ge,{value:"forgot",className:"space-y-4 tab-content",children:[e.jsxs("div",{className:"text-center space-y-2 mb-4",children:[e.jsx(xi,{className:"w-12 h-12 text-blue-500 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"استرجاع كلمة المرور"}),e.jsx("p",{className:"text-sm text-gray-600",children:"أدخل بريدك الإلكتروني وسنرسل لك رابط لإعادة تعيين كلمة المرور"})]}),e.jsx(ja,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(w),className:"space-y-4",children:[e.jsx(Nt,{control:y.control,name:"email",render:({field:b})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-gray-700 font-medium",children:"البريد الإلكتروني"}),e.jsx(vt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(io,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(be,{...b,type:"email",placeholder:"أدخل بريدك الإلكتروني",className:"pr-10 enhanced-input","data-testid":"input-forgot-email"})]})}),e.jsx(bt,{})]})}),e.jsx($,{type:"submit",className:"w-full enhanced-button",disabled:A.isPending,"data-testid":"button-forgot-password",children:A.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"ml-2 h-4 w-4 animate-spin"}),"جارِ الإرسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx(io,{className:"ml-2 h-4 w-4"}),"إرسال رابط الاسترجاع"]})})]})})]})]})})]}),e.jsxs("div",{className:"text-center text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:"© 2025 نظام إدارة المشاريع الإنشائية"}),e.jsx("p",{children:"جميع الحقوق محفوظة"})]})]})})]})}function Ft({value:t,onChange:s,placeholder:r,category:a,disabled:n=!1,className:i="",type:o="text",inputMode:l="text"}){const[u,d]=h.useState(!1),[c,f]=h.useState(""),m=h.useRef(null),y=h.useRef(null),x=Mt(),{data:p=[],isLoading:A}=ge({queryKey:["autocomplete",a],queryFn:()=>ae(`/api/autocomplete/${a}`,"GET"),enabled:!!a}),g=Ce({mutationFn:O=>ae("/api/autocomplete","POST",O),onSuccess:()=>{x.invalidateQueries({queryKey:["autocomplete",a]}),x.refetchQueries({queryKey:["autocomplete",a]})},onError:O=>{console.error("Error saving autocomplete data:",O)}}),N=Ce({mutationFn:({category:O,value:T})=>ae(`/api/autocomplete/${O}/${encodeURIComponent(T)}`,"DELETE"),onSuccess:()=>{x.invalidateQueries({queryKey:["autocomplete",a]})}}),w=Array.isArray(p)?p.filter(O=>O.value.toLowerCase().includes(c.toLowerCase())):[],_=h.useCallback(O=>{s(O),d(!1),f(""),O&&typeof O=="string"&&O.trim()&&g.mutate({category:a,value:O.trim()})},[s,a,g]),b=h.useCallback(O=>{setTimeout(()=>{y.current&&!y.current.contains(O.relatedTarget)&&(d(!1),f(""),t&&typeof t=="string"&&t.trim()&&t.trim().length>=2&&g.mutate({category:a,value:t.trim()}))},150)},[t,a,g]),k=h.useCallback((O,T)=>{T.stopPropagation(),N.mutate({category:a,value:O})},[a,N]);h.useEffect(()=>{const O=T=>{y.current&&!y.current.contains(T.target)&&m.current&&!m.current.contains(T.target)&&(d(!1),f(""))};if(u)return document.addEventListener("mousedown",O),()=>document.removeEventListener("mousedown",O)},[u]);const R=O=>{const T=O.target.value;s(T),f(T),!u&&T&&T.length>=1&&d(!0)},I=h.useCallback(O=>{O.key==="Enter"&&t.trim()&&t.trim().length>=2&&(O.preventDefault(),d(!1),f(""),g.mutate({category:a,value:t.trim()}))},[t,a,g]),E=()=>{d(!0),x.refetchQueries({queryKey:["autocomplete",a]})};return e.jsxs("div",{className:"relative w-full",children:[e.jsx(be,{ref:m,value:t,onChange:R,onFocus:E,onBlur:b,onKeyDown:I,placeholder:r,disabled:n,className:`arabic-numbers ${i}`,type:o,inputMode:l}),u&&!n&&e.jsx("div",{ref:y,className:"absolute z-50 w-full mt-1",children:e.jsx(q,{className:"max-h-64 overflow-y-auto shadow-lg border",children:A?e.jsxs("div",{className:"p-3 text-center text-gray-500",children:[e.jsx(Rr,{className:"w-4 h-4 animate-spin mx-auto mb-2"}),"جاري التحميل..."]}):Array.isArray(w)&&w.length>0?e.jsx("div",{className:"py-1",children:w.slice(0,10).map(O=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 hover:bg-gray-100 cursor-pointer group",onClick:()=>_(O.value),children:[e.jsx("span",{className:"flex-1 text-right",children:O.value}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("span",{className:"text-xs text-gray-400",children:O.usageCount}),e.jsx($,{variant:"ghost",size:"sm",className:"w-6 h-6 p-0 hover:bg-red-100 hover:text-red-600",onClick:T=>k(O.value,T),children:e.jsx(os,{className:"w-3 h-3"})})]})]},O.id))}):c?e.jsxs("div",{className:"p-3 text-center text-gray-500",children:[e.jsx(Rr,{className:"w-4 h-4 mx-auto mb-2"}),'لا توجد نتائج للبحث "',c,'"']}):e.jsx("div",{className:"p-3 text-center text-gray-500",children:"ابدأ بالكتابة لحفظ البيانات تلقائياً"})})})]})}var gu="Checkbox",[RE]=Hs(gu),[IE,FE]=RE(gu),Xb=h.forwardRef((t,s)=>{const{__scopeCheckbox:r,name:a,checked:n,defaultChecked:i,required:o,disabled:l,value:u="on",onCheckedChange:d,form:c,...f}=t,[m,y]=h.useState(null),x=lt(s,_=>y(_)),p=h.useRef(!1),A=m?c||!!m.closest("form"):!0,[g=!1,N]=Pa({prop:n,defaultProp:i,onChange:d}),w=h.useRef(g);return h.useEffect(()=>{const _=m?.form;if(_){const b=()=>N(w.current);return _.addEventListener("reset",b),()=>_.removeEventListener("reset",b)}},[m,N]),e.jsxs(IE,{scope:r,state:g,disabled:l,children:[e.jsx(We.button,{type:"button",role:"checkbox","aria-checked":Na(g)?"mixed":g,"aria-required":o,"data-state":Jb(g),"data-disabled":l?"":void 0,disabled:l,value:u,...f,ref:x,onKeyDown:Ne(t.onKeyDown,_=>{_.key==="Enter"&&_.preventDefault()}),onClick:Ne(t.onClick,_=>{N(b=>Na(b)?!0:!b),A&&(p.current=_.isPropagationStopped(),p.current||_.stopPropagation())})}),A&&e.jsx(OE,{control:m,bubbles:!p.current,name:a,value:u,checked:g,required:o,disabled:l,form:c,style:{transform:"translateX(-100%)"},defaultChecked:Na(i)?!1:i})]})});Xb.displayName=gu;var Zb="CheckboxIndicator",Yb=h.forwardRef((t,s)=>{const{__scopeCheckbox:r,forceMount:a,...n}=t,i=FE(Zb,r);return e.jsx(ws,{present:a||Na(i.state)||i.state===!0,children:e.jsx(We.span,{"data-state":Jb(i.state),"data-disabled":i.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...t.style}})})});Yb.displayName=Zb;var OE=t=>{const{control:s,checked:r,bubbles:a=!0,defaultChecked:n,...i}=t,o=h.useRef(null),l=cd(r),u=dd(s);h.useEffect(()=>{const c=o.current,f=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(f,"checked").set;if(l!==r&&y){const x=new Event("click",{bubbles:a});c.indeterminate=Na(r),y.call(c,Na(r)?!1:r),c.dispatchEvent(x)}},[l,r,a]);const d=h.useRef(Na(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n??d.current,...i,tabIndex:-1,ref:o,style:{...t.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Na(t){return t==="indeterminate"}function Jb(t){return Na(t)?"indeterminate":t?"checked":"unchecked"}var ej=Xb,$E=Yb;const fi=h.forwardRef(({className:t,...s},r)=>e.jsx(ej,{ref:r,className:he("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx($E,{className:he("flex items-center justify-center text-current"),children:e.jsx(gd,{className:"h-4 w-4"})})}));fi.displayName=ej.displayName;function LE({worker:t,attendance:s,onAttendanceChange:r,selectedDate:a=Gs()}){const[n,i]=h.useState(s),[o,l]=h.useState(!1),{data:u}=ge({queryKey:["/api/workers",t.id,"stats"],queryFn:async()=>{try{return await ae(`/api/workers/${t.id}/stats`,"GET")||{totalWorkDays:0,totalProjects:0,totalEarnings:0}}catch(w){return console.error("Error fetching worker stats:",w),{totalWorkDays:0,totalProjects:0,totalEarnings:0}}},staleTime:3e4}),d=n.isPresent&&a===Gs();h.useEffect(()=>{i(s)},[s]);const c=w=>{const _={...n,...w};i(_),r(_)},f=w=>{const _=w===!0;if(_){const b=document.querySelector(`[data-testid="worker-card-detailed-${t.id}"]`);b&&(b.classList.add("animate-bounce-subtle"),setTimeout(()=>{b.classList.remove("animate-bounce-subtle")},600))}else l(!1);c({isPresent:_,startTime:_?n.startTime||"07:00":void 0,endTime:_?n.endTime||"15:00":void 0,workDescription:_?n.workDescription:void 0,workDays:_?n.workDays||1:void 0,paidAmount:_?n.paidAmount:void 0,paymentType:_?n.paymentType||"partial":void 0})},m=()=>{if(!n.startTime||!n.endTime)return 0;const w=new Date(`2000-01-01T${n.startTime}:00`);let b=new Date(`2000-01-01T${n.endTime}:00`).getTime()-w.getTime();b<0&&(b+=1440*60*1e3);const k=b/(1e3*60*60);return Math.max(0,k)},y=()=>{const w=n.workDays||1;return parseFloat(t.dailyWage)*w},x=()=>{const w=n.overtime||0,_=n.overtimeRate||0;return w*_},p=()=>{const w=y(),_=x();return Math.max(0,w+_)},A=()=>{const w=p(),_=parseFloat(n.paidAmount||"0");return w-_};h.useEffect(()=>{if(n.isPresent){const w=p(),_=A();if(n.totalPay!==w||n.remainingAmount!==_||n.hoursWorked!==m()){const b={...n,actualWage:y(),totalPay:w,remainingAmount:_,hoursWorked:m()};i(b),r(b)}}},[n.workDays,n.overtime,n.overtimeRate,n.paidAmount,n.startTime,n.endTime]);const g=w=>{switch(w){case"معلم":return e.jsx(_t,{className:"h-5 w-5"});case"حداد":return e.jsx(Uk,{className:"h-5 w-5"});case"بلاط":return e.jsx(qk,{className:"h-5 w-5"});case"دهان":return e.jsx(Yk,{className:"h-5 w-5"});case"عامل":return e.jsx(nr,{className:"h-5 w-5"});default:return e.jsx(Zs,{className:"h-5 w-5"})}},N=w=>{switch(w){case"معلم":return"bg-gradient-to-br from-primary to-primary/80";case"حداد":return"bg-gradient-to-br from-orange-500 to-orange-600";case"بلاط":return"bg-gradient-to-br from-blue-500 to-blue-600";case"دهان":return"bg-gradient-to-br from-green-500 to-green-600";case"عامل":return"bg-gradient-to-br from-purple-500 to-purple-600";default:return"bg-gradient-to-br from-gray-500 to-gray-600"}};return e.jsx(q,{className:`mb-2 shadow-sm border-r-4 w-full max-w-full overflow-hidden worker-card-enhanced ${d?"border-r-green-400 bg-gradient-to-r from-green-50/50 to-green-100/30 dark:from-green-950/20 dark:to-green-900/10 animate-pulse-slow attended-worker-glow":"border-r-primary/20 hover:border-r-primary/40"}`,"data-testid":`worker-card-detailed-${t.id}`,children:e.jsxs(H,{className:"p-2 sm:p-3 max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-border/30 w-full max-w-full",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 flex-1 min-w-0 max-w-full overflow-hidden",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-md profession-icon-container ${N(t.type)}`,children:g(t.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-1",children:[e.jsx("h4",{className:"font-bold text-lg text-foreground truncate","data-testid":`worker-name-detailed-${t.id}`,children:t.name}),t.isActive?e.jsx(ms,{className:"h-4 w-4 text-green-500 flex-shrink-0","data-testid":`worker-status-active-${t.id}`}):e.jsx(Wt,{className:"h-4 w-4 text-red-500 flex-shrink-0","data-testid":`worker-status-inactive-${t.id}`})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-4 text-xs text-muted-foreground",children:[e.jsx("span",{className:"flex items-center space-x-reverse space-x-1",children:e.jsx("span",{className:"font-medium",children:t.type})}),e.jsxs("span",{className:"flex items-center space-x-reverse space-x-1",children:[e.jsx(us,{className:"h-3 w-3"}),e.jsx("span",{className:"font-bold arabic-numbers","data-testid":`worker-daily-wage-${t.id}`,children:Me(t.dailyWage)})]}),e.jsxs("span",{className:"flex items-center space-x-reverse space-x-1",children:[e.jsx(Ot,{className:"h-3 w-3"}),e.jsxs("span",{className:"arabic-numbers",children:[u?.totalWorkDays||0," يوم"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 flex-shrink-0",children:[n.isPresent&&e.jsxs($,{variant:"ghost",size:"sm",onClick:()=>l(!o),className:"px-2 py-1 h-8","data-testid":`toggle-details-${t.id}`,children:[o?e.jsx(qi,{className:"h-4 w-4"}):e.jsx(Vn,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs mr-1",children:"تفاصيل"})]}),e.jsx(se,{htmlFor:`present-${t.id}`,className:"text-sm font-medium text-foreground cursor-pointer",children:"حاضر"}),e.jsx(fi,{id:`present-${t.id}`,checked:n.isPresent,onCheckedChange:f,className:"w-5 h-5","data-testid":`attendance-checkbox-${t.id}`})]})]}),n.isPresent&&o&&e.jsx("div",{className:"space-y-2 w-full max-w-full overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 dark:from-slate-950/30 dark:to-gray-950/30 p-2 rounded-lg border border-slate-200 dark:border-slate-700 w-full max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-slate-600"}),e.jsx("h5",{className:"font-medium text-slate-800 dark:text-slate-200 text-sm","data-testid":`work-time-section-${t.id}`,children:"تفاصيل العمل والدفع"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"من"}),e.jsx(be,{type:"time",value:n.startTime||"07:00",onChange:w=>c({startTime:w.target.value}),className:"text-center font-mono text-sm h-8","data-testid":`start-time-input-${t.id}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"إلى"}),e.jsx(be,{type:"time",value:n.endTime||"15:00",onChange:w=>c({endTime:w.target.value}),className:"text-center font-mono text-sm h-8","data-testid":`end-time-input-${t.id}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"أيام"}),e.jsx(be,{type:"number",inputMode:"decimal",step:"0.1",min:"0.1",max:"2.0",value:n.workDays||1,onChange:w=>c({workDays:parseFloat(w.target.value)||1}),className:"text-center arabic-numbers text-sm h-8","data-testid":`work-days-input-${t.id}`})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"ساعات"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300 arabic-numbers text-sm","data-testid":`working-hours-display-${t.id}`,children:m().toFixed(1)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"ساعات إضافية"}),e.jsx(be,{type:"number",inputMode:"decimal",step:"0.5",min:"0",max:"8",value:n.overtime||0,onChange:w=>c({overtime:parseFloat(w.target.value)||0}),className:"text-center arabic-numbers text-sm h-8","data-testid":`overtime-input-${t.id}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"معدل الساعة"}),e.jsx(be,{type:"number",inputMode:"decimal",placeholder:"0",value:n.overtimeRate||"",onChange:w=>c({overtimeRate:parseFloat(w.target.value)||0}),className:"text-center arabic-numbers text-sm h-8","data-testid":`overtime-rate-input-${t.id}`})]})]}),e.jsxs("div",{className:"space-y-1 mb-3 pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"وصف العمل"}),e.jsx(Ft,{value:n.workDescription||"",onChange:w=>c({workDescription:w}),placeholder:"اكتب وصف العمل المنجز...",category:"workDescriptions",className:"w-full text-sm","data-testid":`work-description-input-${t.id}`})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-2",children:[e.jsx(Pk,{className:"h-4 w-4 text-slate-600"}),e.jsx("h6",{className:"font-medium text-slate-800 dark:text-slate-200 text-sm","data-testid":`payment-section-${t.id}`,children:"معلومات الدفع"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"نوع الدفع"}),e.jsxs(qe,{value:n.paymentType||"partial",onValueChange:w=>c({paymentType:w}),children:[e.jsx(Oe,{className:"h-8 text-sm","data-testid":`payment-type-select-${t.id}`,children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"full",children:"دفع كامل"}),e.jsx(K,{value:"partial",children:"دفع جزئي"}),e.jsx(K,{value:"credit",children:"على الحساب"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"الأجر الفعلي"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300 arabic-numbers text-sm","data-testid":`actual-wage-display-${t.id}`,children:Me(y())})})]}),n.paymentType!=="credit"?e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"المبلغ المدفوع"}),e.jsx(be,{type:"number",inputMode:"decimal",placeholder:"0",value:n.paidAmount||"",onChange:w=>c({paidAmount:w.target.value}),className:"text-center arabic-numbers text-sm h-8","data-testid":`paid-amount-input-${t.id}`})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"المبلغ المدفوع"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-slate-500",children:"على الحساب"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"إجمالي الدفع"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-200/50 dark:bg-slate-700/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200 arabic-numbers text-sm","data-testid":`total-pay-display-${t.id}`,children:Me(p())})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"المبلغ المتبقي"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsxs("span",{className:`font-bold arabic-numbers text-sm ${A()>0?"text-red-600":A()<0?"text-green-600":"text-slate-700 dark:text-slate-300"}`,"data-testid":`remaining-amount-display-${t.id}`,children:[Me(Math.abs(A())),A()>0&&" (مستحق)",A()<0&&" (فائض)"]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"الوقت الإضافي"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300 arabic-numbers text-sm",children:Me(x())})})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"إجمالي الدفع المطلوب"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-200/50 dark:bg-slate-700/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200 arabic-numbers text-sm","data-testid":`total-pay-display-${t.id}`,children:Me(p())})}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["الأجر الأساسي (",n.workDays||1," يوم):"]}),e.jsx("span",{className:"arabic-numbers",children:Me(y())})]}),n.overtime&&n.overtimeRate?e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["الوقت الإضافي (",n.overtime," ساعة × ",n.overtimeRate,"):"]}),e.jsx("span",{className:"arabic-numbers",children:Me(x())})]}):null,e.jsxs("div",{className:"border-t border-slate-300 pt-1 flex justify-between font-medium",children:[e.jsx("span",{children:"الإجمالي:"}),e.jsx("span",{className:"arabic-numbers",children:Me(p())})]})]})]})})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-2",children:[e.jsx(Qk,{className:"h-4 w-4 text-slate-600"}),e.jsx("h6",{className:"font-medium text-slate-800 dark:text-slate-200 text-sm","data-testid":`notes-section-${t.id}`,children:"ملاحظات"})]}),e.jsx(Ft,{value:n.notes||"",onChange:w=>c({notes:w}),placeholder:"اكتب أي ملاحظات إضافية...",category:"workerNotes",className:"w-full text-sm","data-testid":`notes-input-${t.id}`})]})]})})]})})}function VE(){Or();const{selectedProjectId:t,selectProject:s}=_a(),r=new URLSearchParams(window.location.search),a=r.get("edit"),n=r.get("worker"),i=r.get("date"),[o,l]=h.useState(i||Gs()),[u,d]=h.useState({}),[c,f]=h.useState(!1),[m,y]=h.useState({startTime:"07:00",endTime:"15:00",workDays:1,paymentType:"partial",paidAmount:"",workDescription:""}),{toast:x}=Ct(),p=Mt(),{setFloatingAction:A}=Ls();h.useEffect(()=>(A(()=>{document.querySelector('[type="submit"]')?.click()},"حفظ الحضور"),()=>A(null)),[A]);const g=async(M,v)=>{if(!(!v||typeof v!="string"||!v.trim()))try{await ae("/api/autocomplete","POST",{category:M,value:v.trim()})}catch(W){console.log(`Failed to save autocomplete value for ${M}:`,W)}},{data:N=[]}=ge({queryKey:["/api/projects",t,"attendance",o],queryFn:async()=>{try{const M=await ae(`/api/projects/${t}/attendance?date=${o}`,"GET");return M&&M.data&&Array.isArray(M.data)?M.data:Array.isArray(M)?M:[]}catch(M){return console.error("Error fetching attendance records:",M),[]}},enabled:!!t}),{data:w}=ge({queryKey:["/api/worker-attendance",a],queryFn:async()=>{try{const M=await ae(`/api/worker-attendance/${a}`,"GET");return M&&M.data?M.data:M||null}catch(M){return console.error("Error fetching attendance record for editing:",M),null}},enabled:!!a});h.useEffect(()=>{if(w&&n){const M={...u};M[n]={isPresent:!0,startTime:w.startTime,endTime:w.endTime,workDescription:w.workDescription||"",workDays:parseFloat(w.workDays||"1.0"),paidAmount:w.paidAmount?.toString()||"",paymentType:w.paymentType||"partial"},d(M)}},[w,n]);const _=Ce({mutationFn:M=>ae(`/api/worker-attendance/${M}`,"DELETE"),onSuccess:()=>{x({title:"تم الحذف",description:"تم حذف سجل الحضور بنجاح"}),p.invalidateQueries({queryKey:["/api/projects",t,"worker-attendance"]})},onError:()=>{x({title:"خطأ",description:"حدث خطأ أثناء حذف سجل الحضور",variant:"destructive"})}}),b=M=>{if(Array.isArray(k)?k.find(W=>W.id===M.workerId):null){const W={...u};W[M.workerId]={isPresent:!0,startTime:M.startTime,endTime:M.endTime,workDescription:M.workDescription||"",workDays:parseFloat(M.workDays||"1.0"),paidAmount:M.paidAmount,paymentType:M.paymentType||"partial"},d(W)}},{data:k=[],isLoading:R}=ge({queryKey:["/api/workers"]}),I=Ce({mutationFn:async M=>{console.log("💾 بدء حفظ سجلات الحضور للعمال:",M.length);const v=M.flatMap(V=>[g("workDescriptions",V.workDescription),g("paymentTypes",V.paymentType)]).filter(Boolean);v.length>0&&await Promise.all(v);const W=[],j=[];for(const V of M)try{console.log(`🔄 محاولة حفظ حضور العامل: ${V.workerId} في التاريخ: ${V.date}`);try{const ne=await ae(`/api/projects/${V.projectId}/attendance?date=${V.date}&workerId=${V.workerId}`,"GET"),F=ne?.data||ne||[],ye=Array.isArray(F)?F.find(fe=>fe.workerId===V.workerId):null;if(ye){console.log(`📝 تحديث سجل موجود للعامل: ${V.workerId}`);const fe=await ae(`/api/worker-attendance/${ye.id}`,"PATCH",V);W.push(fe)}else{console.log(`➕ إنشاء سجل جديد للعامل: ${V.workerId}`);const fe=await ae("/api/worker-attendance","POST",V);W.push(fe)}}catch{console.log(`➕ سجل غير موجود، إنشاء جديد للعامل: ${V.workerId}`);const F=await ae("/api/worker-attendance","POST",V);W.push(F)}}catch(ne){console.error(`❌ فشل في حفظ حضور العامل ${V.workerId}:`,ne),j.push({workerId:V.workerId,error:ne.message||"خطأ غير معروف"})}return console.log(`✅ تم حفظ ${W.length} سجل حضور بنجاح`),j.length>0&&console.warn(`⚠️ فشل في حفظ ${j.length} سجل حضور:`,j),{successful:W,failed:j,totalProcessed:M.length}},onSuccess:async M=>{p.invalidateQueries({queryKey:["/api/autocomplete"]}),p.invalidateQueries({queryKey:["/api/projects",t,"worker-attendance"]});const{successful:v,failed:W,totalProcessed:j}=M;W.length===0?x({title:"تم الحفظ بنجاح",description:`تم حفظ حضور ${v.length} عامل بنجاح`}):v.length>0?(x({title:"تم الحفظ جزئياً",description:`نجح حفظ ${v.length} عامل، فشل ${W.length} عامل`,variant:"default"}),console.error("تفاصيل الأخطاء:",W)):x({title:"فشل الحفظ",description:`فشل في حفظ جميع سجلات الحضور (${W.length} عامل)`,variant:"destructive"}),v.length>0&&d(V=>{const ne={...V};return v.forEach(F=>{const ye=F?.data||F;ye?.workerId&&delete ne[ye.workerId]}),ne})},onError:async(M,v)=>{const W=v.flatMap(V=>[g("workDescriptions",V.workDescription),g("paymentTypes",V.paymentType)]).filter(Boolean);W.length>0&&(await Promise.all(W),p.invalidateQueries({queryKey:["/api/autocomplete"]})),console.error("Error saving attendance:",M);let j="حدث خطأ أثناء حفظ الحضور";if(M?.response?.data?.error||M?.message){const V=M?.response?.data?.error||M?.message;V.includes("تم تسجيل حضور هذا العامل مسبقاً")?j="تم تسجيل حضور هذا العامل مسبقاً في هذا التاريخ":j=V}x({title:"خطأ",description:j,variant:"destructive"})}}),E=(M,v)=>{d(W=>({...W,[M]:v}))},O=()=>{const M={...u};console.log("=== تطبيق الإعدادات المشتركة ==="),console.log("الإعدادات المشتركة:",m),Object.keys(M).forEach(v=>{M[v].isPresent&&(console.log(`تطبيق الإعدادات على العامل ${v}`),console.log(`المبلغ المدفوع من الإعدادات: "${m.paidAmount}"`),M[v]={...M[v],startTime:m.startTime,endTime:m.endTime,workDays:m.workDays,paymentType:m.paymentType,paidAmount:m.paidAmount,workDescription:m.workDescription},console.log("البيانات بعد التطبيق:",M[v]))}),d(M),x({title:"تم التطبيق",description:"تم تطبيق الإعدادات على جميع العمال المحددين"})},T=M=>{const v={};console.log("=== تحديد جميع العمال ==="),console.log("حالة الحضور:",M),console.log("الإعدادات المشتركة:",m),k.forEach(W=>{M?(console.log(`إضافة العامل ${W.name} بالمبلغ: "${m.paidAmount}"`),v[W.id]={isPresent:!0,startTime:m.startTime,endTime:m.endTime,workDays:m.workDays,paymentType:m.paymentType,paidAmount:m.paidAmount,workDescription:m.workDescription}):v[W.id]={isPresent:!1}}),console.log("البيانات النهائية:",v),d(v)},S=()=>{if(!t){x({title:"خطأ",description:"يرجى اختيار المشروع أولاً",variant:"destructive"});return}console.log("=== تصحيح الأخطاء - بيانات الحضور قبل الحفظ ==="),console.log("attendanceData:",u);const M=Object.entries(u).filter(([v,W])=>W.isPresent).map(([v,W])=>{const j=k.find(Z=>Z.id===v),V=parseFloat(j?.dailyWage||"0"),ne=W.workDays||1,F=V*ne,ye=W.overtime||0,fe=W.overtimeRate||0,de=ye*fe,ke=Math.max(0,F+de),nt=parseFloat(W.paidAmount||"0"),ct=W.paymentType==="credit"?ke:ke-nt,it=()=>{if(!W.startTime||!W.endTime)return 0;const Z=new Date(`2000-01-01T${W.startTime}:00`);let Y=new Date(`2000-01-01T${W.endTime}:00`).getTime()-Z.getTime();return Y<0&&(Y+=1440*60*1e3),Math.max(0,Y/(1e3*60*60))};return console.log(`العامل ${j?.name}:`),console.log(`  - الأجر الأساسي: ${F}`),console.log(`  - الوقت الإضافي: ${de}`),console.log(`  - إجمالي الدفع: ${ke}`),console.log(`  - المبلغ المدفوع: ${nt}`),console.log(`  - المبلغ المتبقي: ${ct}`),{projectId:t,workerId:v,date:o,attendanceDate:o,startTime:W.startTime||"07:00",endTime:W.endTime||"15:00",workDescription:W.workDescription||"",isPresent:!0,workDays:ne,dailyWage:j?.dailyWage||"0",hoursWorked:it().toString(),overtime:ye.toString(),overtimeRate:fe.toString(),actualWage:F.toString(),totalPay:ke.toString(),paidAmount:nt.toString(),remainingAmount:ct.toString(),paymentType:W.paymentType||"partial",notes:W.notes||""}});if(M.length===0){x({title:"تنبيه",description:"لم يتم تحديد أي عامل كحاضر",variant:"destructive"});return}I.mutate(M)};return e.jsxs("div",{className:"p-4 slide-in",children:[e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Bi,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsx(Ea,{selectedProjectId:t,onProjectChange:(M,v)=>s(M,v),showHeader:!1,variant:"compact"})]})}),e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"التاريخ"}),e.jsx(be,{type:"date",value:o,onChange:M=>l(M.target.value),className:"w-full"})]})}),k.length>0&&e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"الإعدادات المشتركة"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>f(!c),className:"px-2 py-1 h-8","data-testid":"toggle-shared-settings",children:c?e.jsx(qi,{className:"h-4 w-4"}):e.jsx(Vn,{className:"h-4 w-4"})})]}),c&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>T(!0),className:"text-xs",children:"تحديد الكل"}),e.jsx($,{size:"sm",variant:"outline",onClick:()=>T(!1),className:"text-xs",children:"إلغاء الكل"}),e.jsx($,{size:"sm",onClick:O,className:"text-xs",children:"تطبيق على المحدد"})]})]}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-xs text-muted-foreground",children:"وقت البدء"}),e.jsx(be,{type:"time",value:m.startTime,onChange:M=>y(v=>({...v,startTime:M.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"text-xs text-muted-foreground",children:"وقت الانتهاء"}),e.jsx(be,{type:"time",value:m.endTime,onChange:M=>y(v=>({...v,endTime:M.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"text-xs text-muted-foreground",children:"عدد الأيام"}),e.jsx(be,{type:"number",inputMode:"decimal",step:"0.1",min:"0.1",max:"2.0",value:m.workDays,onChange:M=>y(v=>({...v,workDays:parseFloat(M.target.value)||1})),className:"mt-1 arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"text-xs text-muted-foreground",children:"نوع الدفع"}),e.jsxs(qe,{value:m.paymentType,onValueChange:M=>y(v=>({...v,paymentType:M})),children:[e.jsx(Oe,{className:"mt-1",children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"full",children:"دفع كامل"}),e.jsx(K,{value:"partial",children:"دفع جزئي"}),e.jsx(K,{value:"credit",children:"على الحساب"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[m.paymentType!=="credit"&&e.jsxs("div",{children:[e.jsx(se,{className:"text-xs text-muted-foreground",children:"المبلغ المدفوع"}),e.jsx(be,{type:"number",inputMode:"decimal",placeholder:"0",value:m.paidAmount,onChange:M=>y(v=>({...v,paidAmount:M.target.value})),className:"mt-1 arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"text-xs text-muted-foreground",children:"وصف العمل"}),e.jsx(Ft,{value:m.workDescription,onChange:M=>y(v=>({...v,workDescription:M})),placeholder:"اكتب وصف العمل...",category:"workDescriptions",className:"mt-1"})]})]})]})]})}),R?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل العمال..."})}):k.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد عمال مسجلين"})}):e.jsx("div",{className:"space-y-3",children:Array.isArray(k)?k.map(M=>e.jsx(LE,{worker:M,attendance:u[M.id]||{isPresent:!1},onAttendanceChange:v=>E(M.id,v),selectedDate:o},M.id)):null}),k.length>0&&e.jsx("div",{className:"mt-6",children:e.jsxs($,{onClick:S,disabled:I.isPending,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:[e.jsx(ea,{className:"ml-2 h-4 w-4"}),I.isPending?"جاري الحفظ...":"حفظ الحضور"]})}),t&&N.length>0&&e.jsx(q,{className:"mt-6",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground mb-4",children:["حضور اليوم المسجل (",o,")"]}),e.jsx("div",{className:"space-y-3",children:N.map(M=>{const v=k.find(W=>W.id===M.workerId);return e.jsx("div",{className:"border rounded-lg p-3 bg-card",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:v?.name}),e.jsx("span",{className:"text-xs bg-success text-success-foreground px-2 py-1 rounded",children:"حاضر"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["الوقت: ",M.startTime," - ",M.endTime]}),e.jsxs("p",{children:["الراتب اليومي: ",M.dailyWage," ر.ي"]}),e.jsxs("p",{children:["المدفوع: ",M.paidAmount," ر.ي | المتبقي: ",M.remainingAmount," ر.ي"]}),M.workDescription&&e.jsxs("p",{children:["الوصف: ",M.workDescription]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>b(M),children:"تعديل"}),e.jsx($,{size:"sm",variant:"destructive",onClick:()=>_.mutate(M.id),disabled:_.isPending,children:"حذف"})]})]})},M.id)})})]})})]})}function zE({totalIncome:t,totalExpenses:s,remainingBalance:r}){const a=typeof t=="number"?t:parseFloat(String(t||"0"))||0,n=typeof s=="number"?s:parseFloat(String(s||"0"))||0,i=typeof r=="number"?r:parseFloat(String(r||"0"))||0;return e.jsxs("div",{className:"mt-4 bg-gradient-to-r from-primary to-primary/80 text-primary-foreground rounded-xl p-4",children:[e.jsx("h4",{className:"font-bold text-lg mb-3",children:"ملخص اليوم"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"opacity-90",children:"إجمالي الدخل:"}),e.jsx("div",{className:"text-lg font-bold arabic-numbers",children:Me(a)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"opacity-90",children:"إجمالي المنصرف:"}),e.jsx("div",{className:"text-lg font-bold arabic-numbers",children:Me(n)})]})]}),e.jsxs("div",{className:"text-center mt-3 pt-3 border-t border-primary-foreground/20",children:[e.jsx("div",{className:"text-sm opacity-90",children:"المبلغ المتبقي"}),e.jsx("div",{className:"text-2xl font-bold arabic-numbers",children:Me(i)})]})]})}function BE({projectId:t,selectedDate:s}){const[r,a]=h.useState(""),[n,i]=h.useState(""),[o,l]=h.useState(null),{toast:u}=Ct(),d=Mt(),{setFloatingAction:c}=Ls();h.useEffect(()=>(c(()=>{const b=document.querySelector('[aria-label="إضافة نثريات جديدة"]');b&&b.click()},"إضافة مصروف جديد"),()=>c(null)),[c]);const f=async(_,b)=>{if(!(!b||b.trim().length<2))try{await ae("/api/autocomplete","POST",{category:_,value:b.trim()})}catch(k){console.error(`Error saving autocomplete value for ${_}:`,k)}},{data:m=[]}=ge({queryKey:["/api/worker-misc-expenses",t,s],queryFn:async()=>{try{const _=await ae(`/api/worker-misc-expenses?projectId=${t}&date=${s}`,"GET");return _&&_.data&&Array.isArray(_.data)?_.data:Array.isArray(_)?_:[]}catch(_){return console.error("Error fetching worker misc expenses:",_),[]}},enabled:!!t}),y=Ce({mutationFn:_=>ae("/api/worker-misc-expenses","POST",_),onSuccess:async()=>{r&&await f("workerMiscDescriptions",r),d.invalidateQueries({queryKey:["/api/worker-misc-expenses"]}),a(""),i(""),u({title:"تم إضافة النثريات",description:"تم إضافة نثريات العمال بنجاح"})},onError:_=>{console.error("Error creating misc expense:",_),u({title:"خطأ في إضافة النثريات",description:"حدث خطأ أثناء إضافة النثريات",variant:"destructive"})}}),x=Ce({mutationFn:({id:_,data:b})=>ae(`/api/worker-misc-expenses/${_}`,"PATCH",b),onSuccess:async()=>{r&&await f("workerMiscDescriptions",r),d.invalidateQueries({queryKey:["/api/worker-misc-expenses"]}),g(),u({title:"تم تحديث النثريات",description:"تم تحديث النثريات بنجاح"})},onError:_=>{console.error("Error updating misc expense:",_),u({title:"خطأ في تحديث النثريات",description:"حدث خطأ أثناء تحديث النثريات",variant:"destructive"})}}),p=Ce({mutationFn:_=>ae(`/api/worker-misc-expenses/${_}`,"DELETE"),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/worker-misc-expenses"]}),u({title:"تم حذف النثريات",description:"تم حذف النثريات بنجاح"})},onError:_=>{console.error("Error deleting misc expense:",_),u({title:"خطأ في حذف النثريات",description:"حدث خطأ أثناء حذف النثريات",variant:"destructive"})}}),A=async()=>{if(!r.trim()||!n){u({title:"بيانات ناقصة",description:"يرجى إدخال الوصف والمبلغ",variant:"destructive"});return}o?x.mutate({id:o,data:{description:r,amount:n}}):y.mutate({description:r,amount:n,projectId:t,date:s})},g=()=>{a(""),i(""),l(null)},N=_=>{a(_.description),i(_.amount),l(_.id)},w=Array.isArray(m)?m.reduce((_,b)=>_+parseFloat(b.amount||"0"),0):0;return e.jsx(q,{className:"mb-3",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(us,{className:"text-purple-600 ml-2 h-5 w-5"}),"نثريات العمال"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Ft,{value:r,onChange:a,category:"workerMiscDescriptions",placeholder:"الوصف"}),e.jsx(be,{type:"number",inputMode:"decimal",value:n,onChange:_=>i(_.target.value),placeholder:"المبلغ",className:"text-center arabic-numbers"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{onClick:A,size:"sm",className:"bg-purple-600 hover:bg-purple-700",children:o?e.jsx(ea,{className:"h-4 w-4"}):e.jsx(bs,{className:"h-4 w-4"})}),o&&e.jsx($,{onClick:g,size:"sm",variant:"outline",children:"إلغاء"})]}),Array.isArray(m)&&m.map((_,b)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsx("span",{className:"text-sm flex-1",children:_.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Me(_.amount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>N(_),children:e.jsx(Kr,{className:"h-3 w-3"})}),e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>p.mutate(_.id),disabled:p.isPending,children:e.jsx(os,{className:"h-3 w-3"})})]})]})]},_.id||b)),Array.isArray(m)&&m.length>0&&e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي النثريات: "}),e.jsx("span",{className:"font-bold text-purple-600 arabic-numbers",children:Me(w.toString())})]})]})]})})}class Zc extends h.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(s){return console.error("🚨 [ErrorBoundary] تم التقاط خطأ:",s),{hasError:!0,error:s}}componentDidCatch(s,r){console.error("❌ [ErrorBoundary] تفاصيل الخطأ:",s,r),console.error("📍 [ErrorBoundary] Stack trace:",s.stack)}render(){return this.state.hasError?this.props.fallback||e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200",children:"عذراً، حدث خطأ غير متوقع"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"يرجى إعادة تحميل الصفحة أو المحاولة لاحقاً"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 mr-4",children:"إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{localStorage.clear(),window.location.href="/login"},className:"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"تسجيل دخول جديد"})]}),!1]})}):this.props.children}}function qE(){const[,t]=Or(),{selectedProjectId:s,selectProject:r}=_a(),[a,n]=h.useState(()=>new Date().toISOString().split("T")[0]),[i,o]=h.useState("0"),[l,u]=h.useState(!0),[d,c]=h.useState(""),[f,m]=h.useState(""),[y,x]=h.useState(""),[p,A]=h.useState(""),[g,N]=h.useState(null),[w,_]=h.useState(""),[b,k]=h.useState(""),[R,I]=h.useState(""),[E,O]=h.useState(null),{toast:T}=Ct(),S=Mt(),{setFloatingAction:M}=Ls(),v=async(C,re)=>{if(!(!re||re.trim().length<2))try{if(!(await fetch("/api/autocomplete",{method:"HEAD"})).ok){console.warn(`Autocomplete endpoint not available for ${C}`);return}await ae("/api/autocomplete","POST",{category:C,value:re.trim(),usageCount:1}),console.log(`✅ تم حفظ قيمة الإكمال التلقائي: ${C} = ${re.trim()}`)}catch(Rt){console.warn(`Failed to save autocomplete value for ${C}:`,Rt)}};h.useEffect(()=>(M(()=>{const re=document.querySelector('[type="submit"]');re&&re.click()},"حفظ المصاريف"),()=>M(null)),[M]);const W=async()=>{const C=[];f&&f.trim().length>=2&&C.push(v("senderNames",f)),y&&y.trim().length>=1&&C.push(v("transferNumbers",y)),p&&p.trim().length>=2&&C.push(v("transferTypes",p)),C.length>0&&await Promise.all(C)},{data:j=[],error:V}=ge({queryKey:["/api/workers"],queryFn:async()=>{try{console.log("🔄 [DailyExpenses] جلب قائمة العمال...");const C=await ae("/api/workers","GET");console.log("📊 [DailyExpenses] استجابة العمال:",C);let re=[];return C&&typeof C=="object"&&(C.success!==void 0&&C.data!==void 0?re=Array.isArray(C.data)?C.data:[]:Array.isArray(C)?re=C:C.id?re=[C]:C.data&&(re=Array.isArray(C.data)?C.data:[])),Array.isArray(re)||(console.warn("⚠️ [DailyExpenses] بيانات العمال ليست مصفوفة، تحويل إلى مصفوفة فارغة"),re=[]),console.log(`✅ [DailyExpenses] تم جلب ${re.length} عامل`),re}catch(C){return console.error("❌ [DailyExpenses] خطأ في جلب العمال:",C),[]}},staleTime:3e5,gcTime:6e5,retry:2}),{data:ne=[],error:F}=ge({queryKey:["/api/projects"],queryFn:async()=>{try{console.log("🔄 [DailyExpenses] جلب قائمة المشاريع...");const C=await ae("/api/projects","GET");console.log("📊 [DailyExpenses] استجابة المشاريع:",C);let re=[];return C&&typeof C=="object"&&(C.success!==void 0&&C.data!==void 0?re=Array.isArray(C.data)?C.data:[]:Array.isArray(C)?re=C:C.id?re=[C]:C.data&&(re=Array.isArray(C.data)?C.data:[])),Array.isArray(re)||(console.warn("⚠️ [DailyExpenses] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),re=[]),console.log(`✅ [DailyExpenses] تم جلب ${re.length} مشروع`),re}catch(C){return console.error("❌ [DailyExpenses] خطأ في جلب المشاريع:",C),[]}},staleTime:3e5,retry:2}),{data:ye=[]}=ge({queryKey:["/api/materials"],queryFn:async()=>{try{const C=await ae("/api/materials","GET");return C&&C.data&&Array.isArray(C.data)?C.data:[]}catch(C){return console.warn("⚠️ لم يتمكن من جلب المواد، استخدام قائمة فارغة:",C),[]}},staleTime:3e5,gcTime:6e5}),{data:fe=[]}=ge({queryKey:["/api/daily-project-transfers",s,a],queryFn:async()=>{try{const C=await ae(`/api/daily-project-transfers?projectId=${s}&date=${a}`,"GET");console.log("📊 [ProjectTransfers] استجابة API للصفحة اليومية:",C);let re=[];return C&&C.data&&Array.isArray(C.data)?re=C.data:Array.isArray(C)&&(re=C),Array.isArray(re)?(console.log(`✅ [ProjectTransfers] تم جلب ${re.length} ترحيل لليوم ${a} في الصفحة اليومية`),re):[]}catch(C){return console.error("Error fetching daily project transfers:",C),[]}},enabled:!!s&&!!a&&l,staleTime:6e4,gcTime:3e5}),de=Array.isArray(fe)?fe:[],{data:ke,isLoading:nt,error:ct}=ge({queryKey:["/api/projects",s,"daily-expenses",a],queryFn:async()=>{if(!s||!a)return null;try{console.log(`📊 جلب المصروفات اليومية: مشروع ${s}, تاريخ ${a}`);const C=await ae(`/api/projects/${s}/daily-expenses/${a}`,"GET");return console.log("📊 استجابة المصروفات اليومية:",C),C&&C.success&&C.data?C.data:null}catch(C){throw console.error("خطأ في جلب المصروفات اليومية:",C),C}},enabled:!!s&&!!a,retry:2,staleTime:3e4}),it=ke?.fundTransfers||[],Z=ke?.workerAttendance||[],U=ke?.transportationExpenses||[],Y=ke?.materialPurchases||[],Ae=ke?.workerTransfers||[],pt=ke?.miscExpenses||[],jt=Array.isArray(Z)?Z:[],Ve=Array.isArray(U)?U:[],kt=Array.isArray(Y)?Y:[],ps=Array.isArray(Ae)?Ae:[],ks=Array.isArray(it)?it:[],{data:X}=ge({queryKey:["/api/projects",s,"previous-balance",a],queryFn:async()=>{try{const C=await ae(`/api/projects/${s}/previous-balance/${a}`,"GET");return C&&C.data&&C.data.balance!==void 0?C.data.balance||"0":C?.balance||"0"}catch(C){return console.error("Error fetching previous balance:",C),"0"}},enabled:!!s&&!!a});h.useEffect(()=>{X!=null&&(console.log("🔄 تحديث carriedForward:",{previousBalance:X,type:typeof X}),o(X))},[X]),h.useEffect(()=>{(async()=>{const re=["حولة بنكية","تسليم يدوي","صراف آلي","تحويل داخلي","شيك","نقدية"];for(const Rt of re)try{await v("transferTypes",Rt)}catch(xt){console.log(`Type ${Rt} initialization skipped:`,xt)}})()},[]);const Je=Ce({mutationFn:async C=>(await W(),ae("/api/fund-transfers","POST",C)),onSuccess:async C=>{S.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),S.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),T({title:"تم إضافة العهدة",description:"تم إضافة تحويل العهدة بنجاح"}),S.invalidateQueries({queryKey:["/api/autocomplete"]}),c(""),m(""),x(""),A("")},onError:async C=>{await W(),S.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("خطأ في إضافة الحولة:",C);let re="حدث خطأ أثناء إضافة الحولة";C?.response?.data?.message?re=C.response.data.message:C?.message?re=C.message:typeof C=="string"&&(re=C),T({title:"فشل في إضافة الحولة",description:re,variant:"destructive"})}}),xe=Ce({mutationFn:async C=>(await Promise.all([v("transportDescriptions",w),v("notes",R)]),ae("/api/transportation-expenses","POST",C)),onSuccess:async C=>{S.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),S.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),T({title:"تم إضافة المواصلات",description:"تم إضافة مصروف المواصلات بنجاح"}),S.invalidateQueries({queryKey:["/api/autocomplete"]}),_(""),k(""),I("")},onError:async C=>{await Promise.all([v("transportDescriptions",w),v("notes",R)]),S.invalidateQueries({queryKey:["/api/autocomplete"]}),T({title:"خطأ في إضافة المواصلات",description:C?.message||"حدث خطأ أثناء إضافة مصروف المواصلات",variant:"destructive"})}}),P=Ce({mutationFn:C=>ae("/api/daily-expense-summaries","POST",C),onSuccess:()=>{T({title:"تم الحفظ",description:"تم حفظ ملخص المصروفات اليومية بنجاح"}),S.invalidateQueries({queryKey:["/api/projects",s,"daily-summary",a]})},onError:()=>{T({title:"خطأ",description:"حدث خطأ أثناء حفظ الملخص",variant:"destructive"})}}),z=Ce({mutationFn:C=>ae(`/api/fund-transfers/${C}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(C,re,Rt)=>{const{projectId:xt,date:as}=Rt||{projectId:s,date:a};S.setQueryData(["/api/projects",xt,"daily-expenses",as],Dt=>Dt&&{...Dt,fundTransfers:Dt.fundTransfers?.filter(tr=>tr.id!==re)||[]}),S.invalidateQueries({queryKey:["/api/projects",xt,"daily-expenses",as]}),S.invalidateQueries({queryKey:["/api/projects",xt,"previous-balance"]}),T({title:"تم الحذف",description:"تم حذف العهدة بنجاح"})},onError:C=>{console.error("خطأ في حذف الحولة:",C);let re="حدث خطأ أثناء حذف الحولة";C?.response?.data?.message?re=C.response.data.message:C?.response?.data?.error?re=C.response.data.error:C?.message?re=C.message:typeof C=="string"&&(re=C),T({title:"فشل في حذف الحولة",description:re,variant:"destructive"})}}),G=Ce({mutationFn:C=>ae(`/api/transportation-expenses/${C}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(C,re,Rt)=>{const{projectId:xt,date:as}=Rt||{projectId:s,date:a};S.setQueryData(["/api/projects",xt,"daily-expenses",as],Dt=>Dt&&{...Dt,transportationExpenses:Dt.transportationExpenses?.filter(tr=>tr.id!==re)||[]}),S.invalidateQueries({queryKey:["/api/projects",xt,"daily-expenses",as]}),S.invalidateQueries({queryKey:["/api/projects",xt,"previous-balance"]}),T({title:"تم الحذف",description:"تم حذف مصروف المواصلات بنجاح"})},onError:C=>{console.error("خطأ في حذف مصروف المواصلات:",C);let re="حدث خطأ أثناء حذف مصروف المواصلات";C?.response?.data?.message?re=C.response.data.message:C?.response?.data?.error?re=C.response.data.error:C?.message?re=C.message:typeof C=="string"&&(re=C),T({title:"فشل في حذف مصروف المواصلات",description:re,variant:"destructive"})}}),oe=Ce({mutationFn:C=>ae(`/api/material-purchases/${C}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(C,re,Rt)=>{const{projectId:xt,date:as}=Rt||{projectId:s,date:a};S.setQueryData(["/api/projects",xt,"daily-expenses",as],Dt=>Dt&&{...Dt,materialPurchases:Dt.materialPurchases?.filter(tr=>tr.id!==re)||[]}),S.invalidateQueries({queryKey:["/api/projects",xt,"daily-expenses",as]}),S.invalidateQueries({queryKey:["/api/projects",xt,"material-purchases"]}),S.invalidateQueries({queryKey:["/api/projects",xt,"previous-balance"]}),T({title:"تم الحذف",description:"تم حذف شراء المواد بنجاح"})},onError:C=>{console.error("خطأ في حذف شراء المواد:",C);let re="حدث خطأ أثناء حذف شراء المواد";C?.response?.data?.message?re=C.response.data.message:C?.response?.data?.error?re=C.response.data.error:C?.message?re=C.message:typeof C=="string"&&(re=C),T({title:"فشل في حذف شراء المواد",description:re,variant:"destructive"})}}),ce=Ce({mutationFn:C=>ae(`/api/worker-attendance/${C}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(C,re,Rt)=>{const{projectId:xt,date:as}=Rt||{projectId:s,date:a};S.setQueryData(["/api/projects",xt,"daily-expenses",as],Dt=>Dt&&{...Dt,workerAttendance:Dt.workerAttendance?.filter(tr=>tr.id!==re)||[]}),S.invalidateQueries({queryKey:["/api/projects",xt,"daily-expenses",as]}),S.invalidateQueries({queryKey:["/api/projects",xt,"attendance"]}),S.invalidateQueries({queryKey:["/api/projects",xt,"previous-balance"]}),T({title:"تم الحذف",description:"تم حذف حضور العامل بنجاح"})},onError:C=>{console.error("خطأ في حذف حضور العامل:",C);let re="حدث خطأ أثناء حذف حضور العامل";C?.response?.data?.message?re=C.response.data.message:C?.response?.data?.error?re=C.response.data.error:C?.message?re=C.message:typeof C=="string"&&(re=C),T({title:"فشل في حذف حضور العامل",description:re,variant:"destructive"})}}),te=Ce({mutationFn:C=>ae(`/api/worker-transfers/${C}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(C,re,Rt)=>{const{projectId:xt,date:as}=Rt||{projectId:s,date:a};S.setQueryData(["/api/projects",xt,"daily-expenses",as],Dt=>Dt&&{...Dt,workerTransfers:Dt.workerTransfers?.filter(tr=>tr.id!==re)||[]}),S.invalidateQueries({queryKey:["/api/projects",xt,"daily-expenses",as]}),S.invalidateQueries({queryKey:["/api/projects",xt,"previous-balance"]}),T({title:"تم الحذف",description:"تم حذف حوالة العامل بنجاح"})},onError:C=>{console.error("خطأ في حذف حوالة العامل:",C);let re="حدث خطأ أثناء حذف حوالة العامل";C?.response?.data?.message?re=C.response.data.message:C?.response?.data?.error?re=C.response.data.error:C?.message?re=C.message:typeof C=="string"&&(re=C),T({title:"فشل في حذف حوالة العامل",description:re,variant:"destructive"})}}),ve=Ce({mutationFn:({id:C,data:re})=>ae(`/api/fund-transfers/${C}`,"PATCH",re),onSuccess:async(C,{id:re})=>{S.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),S.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),f&&await v("senderNames",f),y&&await v("transferNumbers",y),S.invalidateQueries({queryKey:["/api/autocomplete"]}),Re(),T({title:"تم التحديث",description:"تم تحديث العهدة بنجاح"})},onError:C=>{console.error("خطأ في تحديث الحولة:",C);let re="حدث خطأ أثناء تحديث الحولة";C?.response?.data?.message?re=C.response.data.message:C?.message&&(re=C.message),T({title:"فشل في تحديث الحولة",description:re,variant:"destructive"})}}),Re=()=>{c(""),m(""),x(""),A(""),N(null)},dt=C=>{c(C.amount),m(C.senderName||""),x(C.transferNumber||""),A(C.transferType),N(C.id)},Zt=()=>{if(!s){T({title:"خطأ",description:"يرجى اختيار المشروع أولاً",variant:"destructive"});return}if(!d||d.trim()===""||parseFloat(d)<=0){T({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!p||p.trim()===""){T({title:"خطأ",description:"يرجى اختيار نوع التحويل",variant:"destructive"});return}const C={projectId:s,amount:d.toString(),senderName:f.trim()||"غير محدد",transferNumber:y.trim()||null,transferType:p,transferDate:new Date(a+"T12:00:00.000Z"),notes:""};g?ve.mutate({id:g,data:C}):Je.mutate(C)},ur=Ce({mutationFn:({id:C,data:re})=>ae(`/api/transportation-expenses/${C}`,"PATCH",re),onSuccess:async(C,{id:re})=>{S.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),S.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),w&&await v("transportDescriptions",w),R&&await v("notes",R),xs(),T({title:"تم التحديث",description:"تم تحديث مصروف المواصلات بنجاح"})},onError:()=>{T({title:"خطأ",description:"حدث خطأ أثناء تحديث المصروف",variant:"destructive"})}}),xs=()=>{_(""),k(""),I(""),O(null)},mr=C=>{_(C.description),k(C.amount),I(C.notes||""),O(C.id)},Lr=()=>{if(!s||!w||!b){T({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const C={projectId:s,amount:b,description:w,date:a,notes:R};E?ur.mutate({id:E,data:C}):xe.mutate(C)},L=()=>{try{const C=Array.isArray(Z)?Z.filter(Ze=>Ze&&typeof Ze=="object"):[],re=Array.isArray(U)?U.filter(Ze=>Ze&&typeof Ze=="object"):[],Rt=Array.isArray(Y)?Y.filter(Ze=>Ze&&typeof Ze=="object"):[],xt=Array.isArray(Ae)?Ae.filter(Ze=>Ze&&typeof Ze=="object"):[],as=Array.isArray(pt)?pt.filter(Ze=>Ze&&typeof Ze=="object"):[],Dt=Array.isArray(it)?it.filter(Ze=>Ze&&typeof Ze=="object"):[],tr=Array.isArray(fe)?fe.filter(Ze=>Ze&&typeof Ze=="object"):[],Yu=C.reduce((Ze,ns)=>{const Ms=zr(ns.paidAmount);return Ze+Ms},0),Ju=re.reduce((Ze,ns)=>{const Ms=zr(ns.amount);return Ze+Ms},0),em=Rt.filter(Ze=>Ze.purchaseType==="نقد").reduce((Ze,ns)=>{const Ms=zr(ns.totalAmount);return Ze+Ms},0),tm=xt.reduce((Ze,ns)=>{const Ms=zr(ns.amount);return Ze+Ms},0),sm=as.reduce((Ze,ns)=>{const Ms=zr(ns.amount);return Ze+Ms},0),to=Dt.reduce((Ze,ns)=>{const Ms=zr(ns.amount);return Ze+Ms},0),so=tr.filter(Ze=>Ze.toProjectId===s).reduce((Ze,ns)=>{const Ms=zr(ns.amount);return Ze+Ms},0),rm=tr.filter(Ze=>Ze.fromProjectId===s).reduce((Ze,ns)=>{const Ms=zr(ns.amount);return Ze+Ms},0),Fl=zr(i);console.log("🧮 [calculateTotals] تفاصيل الحساب:",{carriedForward:i,carriedAmount:Fl,totalFundTransfers:to,incomingProjectTransfers:so,calculation:`${Fl} + ${to} + ${so}`});const Ol=Fl+to+so,$l=Yu+Ju+em+tm+sm+rm,am=Ol-$l;console.log("✅ [calculateTotals] النتيجة النهائية:",{totalIncome:Ol,totalExpenses:$l,remainingBalance:am});const ro={totalWorkerWages:Yu,totalTransportation:Ju,totalMaterialCosts:em,totalWorkerTransfers:tm,totalMiscExpenses:sm,totalFundTransfers:to,incomingProjectTransfers:so,outgoingProjectTransfers:rm,totalIncome:Ol,totalExpenses:$l,remainingBalance:am},Y2=1e8;return Object.keys(ro).forEach(Ze=>{const ns=ro[Ze];typeof ns=="number"&&Math.abs(ns)>Y2&&(console.warn(`⚠️ [DailyExpenses] قيمة غير منطقية في ${Ze}:`,ns),Ze!=="remainingBalance"&&(ro[Ze]=0))}),ro}catch(C){return console.error("❌ [DailyExpenses] خطأ في calculateTotals:",C),{totalWorkerWages:0,totalTransportation:0,totalMaterialCosts:0,totalWorkerTransfers:0,totalMiscExpenses:0,totalFundTransfers:0,incomingProjectTransfers:0,outgoingProjectTransfers:0,totalIncome:0,totalExpenses:0,remainingBalance:0}}},De=()=>{if(!s){T({title:"خطأ",description:"يرجى اختيار المشروع أولاً",variant:"destructive"});return}const C=L();P.mutate({projectId:s,date:a,carriedForwardAmount:i,totalFundTransfers:C.totalFundTransfers.toString(),totalWorkerWages:C.totalWorkerWages.toString(),totalMaterialCosts:C.totalMaterialCosts.toString(),totalTransportationCosts:C.totalTransportation.toString(),totalIncome:C.totalIncome.toString(),totalExpenses:C.totalExpenses.toString(),remainingBalance:C.remainingBalance.toString()})},Ee=h.useMemo(()=>{try{const C=L();if(!C||typeof C!="object")throw console.warn("⚠️ [DailyExpenses] calculateTotals returned invalid result:",C),new Error("Invalid result from calculateTotals");return C}catch(C){return console.error("❌ [DailyExpenses] خطأ في حساب المجاميع:",C),{totalWorkerWages:0,totalTransportation:0,totalMaterialCosts:0,totalWorkerTransfers:0,totalMiscExpenses:0,totalFundTransfers:0,incomingProjectTransfers:0,outgoingProjectTransfers:0,totalIncome:0,totalExpenses:0,remainingBalance:0}}},[Z,U,Y,Ae,pt,it,fe,i,s]),Vt={fundTransfers:Array.isArray(it)&&it.length>0,attendance:Array.isArray(Z)&&Z.length>0,transportation:Array.isArray(U)&&U.length>0,materials:Array.isArray(Y)&&Y.length>0,workerTransfers:Array.isArray(Ae)&&Ae.length>0,miscExpenses:Array.isArray(pt)&&pt.length>0},Ie=Object.keys(Vt).length,Ds=Object.values(Vt).filter(Boolean).length;return e.jsxs("div",{className:"p-4 slide-in",children:[e.jsx(Ea,{selectedProjectId:s,onProjectChange:(C,re)=>r(C,re)}),s&&e.jsx(q,{className:`mb-3 border-l-4 ${Ds===0?"border-l-amber-400 bg-amber-50/30":Ds===Ie?"border-l-green-500 bg-green-50/30":"border-l-blue-500 bg-blue-50/30"}`,children:e.jsxs(H,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${Ds===0?"bg-amber-400":Ds===Ie?"bg-green-500":"bg-blue-500"}`}),e.jsxs("span",{className:"text-sm font-medium",children:["بيانات يوم ",Sr(a)]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-lg arabic-numbers",children:Ds}),e.jsxs("span",{className:"text-muted-foreground",children:["/",Ie]})]}),Ds===0&&e.jsx("span",{className:"text-amber-700 bg-amber-100 px-3 py-1 rounded-full text-xs font-medium",children:"لا توجد بيانات"}),Ds>0&&Ds<Ie&&e.jsx("span",{className:"text-blue-700 bg-blue-100 px-3 py-1 rounded-full text-xs font-medium",children:"بيانات جزئية"}),Ds===Ie&&e.jsx("span",{className:"text-green-700 bg-green-100 px-3 py-1 rounded-full text-xs font-medium",children:"بيانات كاملة ✓"})]})]}),Ds>0&&e.jsxs("div",{className:"mt-2 flex gap-1 flex-wrap",children:[Vt.fundTransfers&&e.jsx("span",{className:"bg-primary/10 text-primary text-xs px-2 py-1 rounded",children:"عهدة"}),Vt.attendance&&e.jsx("span",{className:"bg-success/10 text-success text-xs px-2 py-1 rounded",children:"حضور"}),Vt.transportation&&e.jsx("span",{className:"bg-secondary/10 text-secondary text-xs px-2 py-1 rounded",children:"نقل"}),Vt.materials&&e.jsx("span",{className:"bg-green-500/10 text-green-600 text-xs px-2 py-1 rounded",children:"مواد"}),Vt.workerTransfers&&e.jsx("span",{className:"bg-orange-500/10 text-orange-600 text-xs px-2 py-1 rounded",children:"حوالات"}),Vt.miscExpenses&&e.jsx("span",{className:"bg-purple-500/10 text-purple-600 text-xs px-2 py-1 rounded",children:"متنوعة"})]})]})}),e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-1",children:"التاريخ"}),e.jsx(be,{type:"date",value:a,onChange:C=>n(C.target.value)})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-1",children:"المبلغ المتبقي السابق"}),e.jsx(be,{type:"number",inputMode:"decimal",value:i,onChange:C=>o(C.target.value),placeholder:"0",className:"text-center arabic-numbers"})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("h4",{className:"font-medium text-foreground mb-2",children:"تحويل عهدة جديدة"}),ct&&e.jsx("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm",children:["خطأ في جلب البيانات: ",ct.message]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-2",children:[e.jsx(be,{type:"number",inputMode:"decimal",value:d,onChange:C=>c(C.target.value),placeholder:"المبلغ *",className:"text-center",min:"0",step:"0.01"}),e.jsx(Ft,{value:f,onChange:m,category:"senderNames",placeholder:"اسم المرسل"})]}),e.jsx(Ft,{type:"number",inputMode:"numeric",value:y,onChange:x,category:"transferNumbers",placeholder:"رقم الحولة",className:"w-full mb-2 arabic-numbers"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ft,{value:p,onChange:A,category:"transferTypes",placeholder:"نوع التحويل *",className:"flex-1"}),e.jsx($,{onClick:Zt,size:"sm",className:"bg-primary",disabled:Je.isPending||ve.isPending,"data-testid":"button-add-fund-transfer",children:Je.isPending||ve.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):g?e.jsx(ea,{className:"h-4 w-4"}):e.jsx(bs,{className:"h-4 w-4"})}),g&&e.jsx($,{onClick:Re,size:"sm",variant:"outline",children:"إلغاء"})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("h5",{className:"text-sm font-medium text-muted-foreground mb-2",children:"العهد المضافة اليوم:"}),nt?e.jsx("div",{className:"text-center text-muted-foreground",children:"جاري التحميل..."}):Array.isArray(it)&&it.length>0?e.jsxs("div",{className:"space-y-2",children:[ks.map((C,re)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsxs("div",{className:"text-sm flex-1",children:[e.jsx("div",{children:C.senderName||"غير محدد"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:C.transferType})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Me(C.amount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>dt(C),"data-testid":"button-edit-fund-transfer",children:e.jsx(Kr,{className:"h-3 w-3"})}),e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>z.mutate(C.id),disabled:z.isPending,"data-testid":"button-delete-fund-transfer",children:z.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(os,{className:"h-3 w-3"})})]})]})]},C.id||re)),e.jsxs("div",{className:"text-left pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي العهد: "}),e.jsx("span",{className:"font-bold text-primary arabic-numbers",children:Me(Ee.totalFundTransfers)})]})]}):e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(us,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["لا توجد تحويلات عهد للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500",children:"يمكنك إضافة تحويل جديد أو اختيار تاريخ آخر"})]})]})]})]})}),e.jsx(q,{className:"mb-3",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(_t,{className:"text-primary ml-2 h-5 w-5"}),"أجور العمال"]}),jt.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(_t,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا يوجد حضور عمال للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اذهب إلى صفحة حضور العمال لتسجيل الحضور"})]}):e.jsxs("div",{className:"space-y-2",children:[jt.map((C,re)=>{const Rt=j.find(xt=>xt.id===C.workerId);return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsx("span",{className:"text-sm",children:Rt?.name||`عامل ${re+1}`}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Me(C.paidAmount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{t(`/worker-attendance?edit=${C.id}&worker=${C.workerId}&date=${a}`)},children:e.jsx(Kr,{className:"h-3 w-3"})}),e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>ce.mutate(C.id),disabled:ce.isPending,"data-testid":"button-delete-worker-attendance",children:ce.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(os,{className:"h-3 w-3"})})]})]})]},re)}),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي أجور العمال: "}),e.jsx("span",{className:"font-bold text-primary arabic-numbers",children:Me(Ee.totalWorkerWages)})]})]})]})}),e.jsx(q,{className:"mb-3",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(mm,{className:"text-secondary ml-2 h-5 w-5"}),"أجور المواصلات"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Ft,{value:w,onChange:_,category:"transportDescriptions",placeholder:"الوصف"}),e.jsx(be,{type:"number",inputMode:"decimal",value:b,onChange:C=>k(C.target.value),placeholder:"المبلغ",className:"text-center arabic-numbers"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ft,{value:R,onChange:I,category:"notes",placeholder:"ملاحظات",className:"flex-1"}),e.jsx($,{onClick:Lr,size:"sm",className:"bg-secondary",disabled:xe.isPending||ur.isPending,"data-testid":"button-add-transportation",children:xe.isPending||ur.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border border-white border-t-transparent"}):E?e.jsx(ea,{className:"h-4 w-4"}):e.jsx(bs,{className:"h-4 w-4"})}),E&&e.jsx($,{onClick:xs,size:"sm",variant:"outline",children:"إلغاء"})]}),Ve.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200 mt-3",children:[e.jsx(mm,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا توجد مصاريف نقل للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"أضف مصاريف جديدة أو اختر تاريخ آخر"})]}):e.jsxs("div",{className:"mt-3 space-y-2",children:[Ve.map((C,re)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsx("span",{className:"text-sm flex-1",children:C.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Me(C.amount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>mr(C),"data-testid":"button-edit-transportation",children:e.jsx(Kr,{className:"h-3 w-3"})}),e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>G.mutate(C.id),disabled:G.isPending,"data-testid":"button-delete-transportation",children:G.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(os,{className:"h-3 w-3"})})]})]})]},re)),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي النقل: "}),e.jsx("span",{className:"font-bold text-secondary arabic-numbers",children:Me(Ee.totalTransportation)})]})]})]})]})}),e.jsx(q,{className:"mb-3",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(ra,{className:"text-success ml-2 h-5 w-5"}),"شراء مواد"]}),!Array.isArray(Y)||Y.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(ra,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا توجد مشتريات مواد للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اذهب إلى شراء المواد لإضافة مشتريات جديدة"})]}):e.jsxs("div",{className:"space-y-2 mb-3",children:[kt.map((C,re)=>{const Rt=C.materialName||C.material?.name||"مادة غير محددة",xt=C.materialUnit||C.unit||C.material?.unit||"وحدة",as=C.materialCategory||C.material?.category;return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsxs("div",{className:"text-sm flex-1",children:[e.jsx("div",{className:"font-medium",children:Rt}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[C.quantity," ",xt," × ",Me(C.unitPrice)]}),C.supplierName&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["المورد: ",C.supplierName]}),C.purchaseType&&e.jsx("div",{className:`text-xs font-medium ${C.purchaseType==="آجل"?"text-orange-600":"text-green-600"}`,children:C.purchaseType==="آجل"?"⏰ آجل":"💵 نقد"}),as&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["الفئة: ",as]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium arabic-numbers ${C.purchaseType==="آجل"?"text-orange-600":"text-green-600"}`,children:Me(C.totalAmount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{t(`/material-purchase?edit=${C.id}`)},children:e.jsx(Kr,{className:"h-3 w-3"})}),e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>oe.mutate(C.id),disabled:oe.isPending,"data-testid":"button-delete-material-purchase",children:oe.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(os,{className:"h-3 w-3"})})]})]})]},re)}),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المشتريات النقدية (تؤثر على الرصيد): "}),e.jsx("span",{className:"font-bold text-success arabic-numbers",children:Me(Ee.totalMaterialCosts)})]}),(()=>{const C=Array.isArray(Y)?Y.filter(re=>re.purchaseType==="آجل").reduce((re,Rt)=>re+parseFloat(Rt.totalAmount||"0"),0):0;return C>0?e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المشتريات الآجلة (لا تؤثر على الرصيد): "}),e.jsx("span",{className:"font-bold text-orange-600 arabic-numbers",children:Me(C)})]}):null})()]})]}),e.jsxs($,{variant:"outline",onClick:()=>t("/material-purchase"),className:"w-full border-2 border-dashed",children:[e.jsx(bs,{className:"ml-2 h-4 w-4"}),"إضافة شراء مواد"]})]})}),e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(us,{className:"text-warning ml-2 h-5 w-5"}),"حولة من حساب العمال"]}),!Array.isArray(Ae)||Ae.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(xa,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا توجد حوالات عمال للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اذهب إلى صفحة العمال لإدارة الحوالات"})]}):e.jsxs("div",{className:"space-y-2 mb-3",children:[ps.map((C,re)=>{const Rt=j.find(xt=>xt.id===C.workerId);return e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded border-r-4 border-warning",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:Rt?.name||"عامل غير معروف"}),e.jsx("span",{className:"font-bold text-warning arabic-numbers",children:Me(C.amount)})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{children:["المستلم: ",C.recipientName]}),C.recipientPhone&&e.jsxs("span",{className:"mr-3",children:["الهاتف: ",C.recipientPhone]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["طريقة التحويل: ",C.transferMethod==="hawaleh"?"حولة":C.transferMethod==="bank"?"تحويل بنكي":"نقداً"]})]}),e.jsxs("div",{className:"flex gap-1 mr-2",children:[e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{t(`/worker-accounts?edit=${C.id}&worker=${C.workerId}`)},children:e.jsx(Kr,{className:"h-3 w-3"})}),e.jsx($,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("هل أنت متأكد من حذف حوالة العامل؟ هذا الإجراء لا يمكن التراجع عنه.")&&te.mutate(C.id)},disabled:te.isPending,"data-testid":"button-delete-worker-transfer",children:te.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(os,{className:"h-3 w-3"})})]})]},re)}),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي الحوالات: "}),e.jsx("span",{className:"font-bold text-warning arabic-numbers",children:Me(Ee.totalWorkerTransfers)})]})]}),e.jsxs($,{variant:"outline",onClick:()=>t("/worker-accounts"),className:"w-full border-2 border-dashed",children:[e.jsx(bs,{className:"ml-2 h-4 w-4"}),"إرسال حولة جديدة"]})]})}),s&&e.jsx(BE,{projectId:s,selectedDate:a}),e.jsx(q,{className:"bg-background border-border/50",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xa,{className:"h-5 w-5 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"ترحيل الأموال بين المشاريع"})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>u(!l),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",children:l?e.jsxs(e.Fragment,{children:[e.jsx(qi,{className:"h-4 w-4 ml-1"}),"إخفاء"]}):e.jsxs(e.Fragment,{children:[e.jsx(Vn,{className:"h-4 w-4 ml-1"}),"إظهار"]})})]}),l&&e.jsx("div",{className:"space-y-3",children:de.map(C=>e.jsx("div",{className:`p-3 rounded border-r-4 ${C.toProjectId===s?"bg-green-50 border-green-500":"bg-red-50 border-red-500"}`,children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:C.toProjectId===s?e.jsxs("span",{className:"text-green-700",children:["أموال واردة من: ",C.fromProjectName]}):e.jsxs("span",{className:"text-red-700",children:["أموال صادرة إلى: ",C.toProjectName]})}),e.jsxs("span",{className:`font-bold arabic-numbers ${C.toProjectId===s?"text-green-600":"text-red-600"}`,children:[C.toProjectId===s?"+":"-",Me(C.amount)]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{children:["السبب: ",C.transferReason||"ترحيل أموال"]}),C.description&&e.jsxs("div",{className:"mt-1",children:["الوصف: ",C.description]}),e.jsxs("div",{className:"mt-1",children:["التاريخ: ",Sr(C.transferDate)]})]})]})})},C.id))}),e.jsx("div",{className:"mt-4 pt-3 border-t",children:e.jsxs($,{variant:"outline",onClick:()=>t("/project-transfers"),className:"w-full border-2 border-dashed border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(xa,{className:"ml-2 h-4 w-4"}),"إدارة عمليات ترحيل الأموال"]})})]})}),e.jsx(zE,{totalIncome:Ee.totalIncome,totalExpenses:Ee.totalExpenses,remainingBalance:Ee.remainingBalance}),e.jsx("div",{className:"mt-4",children:e.jsxs($,{onClick:De,disabled:P.isPending,className:"w-full bg-success hover:bg-success/90 text-success-foreground",children:[e.jsx(ea,{className:"ml-2 h-4 w-4"}),P.isPending?"جاري الحفظ...":"حفظ المصروفات"]})})]})}function UE(){return e.jsx(Zc,{children:e.jsx(qE,{})})}const an=h.forwardRef(({className:t,...s},r)=>e.jsx("textarea",{className:he("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...s}));an.displayName="Textarea";var yu="Radio",[WE,tj]=Hs(yu),[KE,HE]=WE(yu),sj=h.forwardRef((t,s)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:i,disabled:o,value:l="on",onCheck:u,form:d,...c}=t,[f,m]=h.useState(null),y=lt(s,A=>m(A)),x=h.useRef(!1),p=f?d||!!f.closest("form"):!0;return e.jsxs(KE,{scope:r,checked:n,disabled:o,children:[e.jsx(We.button,{type:"button",role:"radio","aria-checked":n,"data-state":nj(n),"data-disabled":o?"":void 0,disabled:o,value:l,...c,ref:y,onClick:Ne(t.onClick,A=>{n||u?.(),p&&(x.current=A.isPropagationStopped(),x.current||A.stopPropagation())})}),p&&e.jsx(GE,{control:f,bubbles:!x.current,name:a,value:l,checked:n,required:i,disabled:o,form:d,style:{transform:"translateX(-100%)"}})]})});sj.displayName=yu;var rj="RadioIndicator",aj=h.forwardRef((t,s)=>{const{__scopeRadio:r,forceMount:a,...n}=t,i=HE(rj,r);return e.jsx(ws,{present:a||i.checked,children:e.jsx(We.span,{"data-state":nj(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s})})});aj.displayName=rj;var GE=t=>{const{control:s,checked:r,bubbles:a=!0,...n}=t,i=h.useRef(null),o=cd(r),l=dd(s);return h.useEffect(()=>{const u=i.current,d=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(d,"checked").set;if(o!==r&&f){const m=new Event("click",{bubbles:a});f.call(u,r),u.dispatchEvent(m)}},[o,r,a]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:i,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function nj(t){return t?"checked":"unchecked"}var QE=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],vu="RadioGroup",[XE]=Hs(vu,[Un,tj]),ij=Un(),oj=tj(),[ZE,YE]=XE(vu),lj=h.forwardRef((t,s)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:i,required:o=!1,disabled:l=!1,orientation:u,dir:d,loop:c=!0,onValueChange:f,...m}=t,y=ij(r),x=zi(d),[p,A]=Pa({prop:i,defaultProp:n,onChange:f});return e.jsx(ZE,{scope:r,name:a,required:o,disabled:l,value:p,onValueChange:A,children:e.jsx(hu,{asChild:!0,...y,orientation:u,dir:x,loop:c,children:e.jsx(We.div,{role:"radiogroup","aria-required":o,"aria-orientation":u,"data-disabled":l?"":void 0,dir:x,...m,ref:s})})})});lj.displayName=vu;var cj="RadioGroupItem",dj=h.forwardRef((t,s)=>{const{__scopeRadioGroup:r,disabled:a,...n}=t,i=YE(cj,r),o=i.disabled||a,l=ij(r),u=oj(r),d=h.useRef(null),c=lt(s,d),f=i.value===n.value,m=h.useRef(!1);return h.useEffect(()=>{const y=p=>{QE.includes(p.key)&&(m.current=!0)},x=()=>m.current=!1;return document.addEventListener("keydown",y),document.addEventListener("keyup",x),()=>{document.removeEventListener("keydown",y),document.removeEventListener("keyup",x)}},[]),e.jsx(fu,{asChild:!0,...l,focusable:!o,active:f,children:e.jsx(sj,{disabled:o,required:i.required,checked:f,...u,...n,name:i.name,ref:c,onCheck:()=>i.onValueChange(n.value),onKeyDown:Ne(y=>{y.key==="Enter"&&y.preventDefault()}),onFocus:Ne(n.onFocus,()=>{m.current&&d.current?.click()})})})});dj.displayName=cj;var JE="RadioGroupIndicator",uj=h.forwardRef((t,s)=>{const{__scopeRadioGroup:r,...a}=t,n=oj(r);return e.jsx(aj,{...n,...a,ref:s})});uj.displayName=JE;var mj=lj,hj=dj,e3=uj;const fj=h.forwardRef(({className:t,...s},r)=>e.jsx(mj,{className:he("grid gap-2",t),...s,ref:r}));fj.displayName=mj.displayName;const No=h.forwardRef(({className:t,...s},r)=>e.jsx(hj,{ref:r,className:he("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(e3,{className:"flex items-center justify-center",children:e.jsx(ay,{className:"h-2.5 w-2.5 fill-current text-current"})})}));No.displayName=hj.displayName;function Zh(){const[,t]=Or(),{selectedProjectId:s,selectProject:r}=_a(),n=new URLSearchParams(window.location.search).get("edit"),[i,o]=h.useState(""),[l,u]=h.useState(""),[d,c]=h.useState(""),[f,m]=h.useState(""),[y,x]=h.useState(""),[p,A]=h.useState("نقد"),[g,N]=h.useState(""),[w,_]=h.useState(""),[b,k]=h.useState(Gs()),[R,I]=h.useState(Gs()),[E,O]=h.useState(""),[T,S]=h.useState(""),[M,v]=h.useState(null),[W,j]=h.useState(!1),[V,ne]=h.useState(""),[F,ye]=h.useState(""),[fe,de]=h.useState(""),[ke,nt]=h.useState(""),[ct,it]=h.useState("نقد"),[Z,U]=h.useState(""),{toast:Y}=Ct(),Ae=Mt(),{setFloatingAction:pt}=Ls(),jt=()=>{if(!s){Y({title:"خطأ",description:"يرجى اختيار مشروع أولاً",variant:"destructive"});return}document.querySelector('[type="submit"]')?.click()};h.useEffect(()=>(pt(jt,"حفظ المشتريات"),()=>pt(null)),[pt,s]);const Ve=async(L,De)=>{if(!(!De||typeof De!="string"||!De.trim()))try{await ae("/api/autocomplete","POST",{category:L,value:De.trim()})}catch(Ee){console.log(`Failed to save autocomplete value for ${L}:`,Ee)}},kt=()=>{ne(""),ye(""),de(""),nt(""),it("نقد"),U("")},ps=Ce({mutationFn:async L=>(await Promise.all([Ve("supplier_name",V),Ve("supplier_contact_person",F),Ve("supplier_phone",fe),Ve("supplier_address",ke),Ve("supplier_payment_terms",ct)]),ae("/api/suppliers","POST",L)),onSuccess:L=>{Ae.invalidateQueries({queryKey:["/api/suppliers"]}),Y({title:"تم إضافة المورد بنجاح",description:`تم إضافة المورد "${V}" إلى قاعدة البيانات`}),N(V),j(!1),kt()},onError:L=>{Y({title:"خطأ في إضافة المورد",description:L?.message||"حدث خطأ أثناء إضافة المورد. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),ks=async L=>{if(L.preventDefault(),!V.trim()){Y({title:"خطأ في البيانات",description:"يرجى إدخال اسم المورد",variant:"destructive"});return}const De={name:V.trim(),contactPerson:F.trim()||void 0,phone:fe.trim()||void 0,address:ke.trim()||void 0,paymentTerms:ct||void 0,notes:Z.trim()||void 0,isActive:!0};ps.mutate(De)},{data:X=[]}=ge({queryKey:["/api/materials"],queryFn:async()=>{try{const L=await ae("/api/materials","GET");return L&&L.data&&Array.isArray(L.data)?L.data:Array.isArray(L)?L:[]}catch(L){return console.error("Error fetching materials:",L),[]}},staleTime:3e5,gcTime:6e5}),{data:Je=[]}=ge({queryKey:["/api/suppliers"],queryFn:async()=>{try{const L=await ae("/api/suppliers","GET");return L&&L.data&&Array.isArray(L.data)?L.data:Array.isArray(L)?L:[]}catch(L){return console.error("Error fetching suppliers:",L),[]}},staleTime:3e5,gcTime:6e5}),{data:xe,isLoading:P}=ge({queryKey:["/api/material-purchases",n],queryFn:async()=>{if(!n)return null;try{console.log(`🔄 جلب بيانات المشترية للتعديل: ${n}`);const L=await ae(`/api/material-purchases/${n}`,"GET");console.log("📊 استجابة جلب بيانات التعديل:",L);let De=null;if(L&&L.data)De=L.data;else if(L&&L.id)De=L;else return console.warn("⚠️ لا توجد بيانات في الاستجابة"),null;return console.log("✅ تم جلب بيانات المشترية للتعديل:",De),De}catch(L){return console.error("❌ خطأ في جلب بيانات المشترية للتعديل:",L),null}},enabled:!!n,retry:1,staleTime:0});h.useEffect(()=>{if(xe&&n){console.log("🔄 ملء النموذج ببيانات التعديل:",xe),console.log("🔍 تحليل البيانات المسترجعة:",{purchaseToEdit:{materialName:xe.materialName,materialCategory:xe.materialCategory,materialUnit:xe.materialUnit,unit:xe.unit},material:xe.material?{name:xe.material.name,category:xe.material.category,unit:xe.material.unit}:"لا توجد بيانات مادة مرتبطة"});const L=xe.materialName||xe.material?.name||"",De=xe.materialCategory||xe.material?.category||"",Ee=xe.materialUnit||xe.unit||xe.material?.unit||"";console.log("📝 القيم النهائية التي سيتم ملؤها:",{materialName:L,materialCategory:De,materialUnit:Ee}),o(L),u(De),c(Ee),m(xe.quantity?.toString()||""),x(xe.unitPrice?.toString()||""),A(xe.purchaseType||"نقد"),N(xe.supplierName||""),_(xe.invoiceNumber||""),k(xe.invoiceDate||Gs()),I(xe.purchaseDate||Gs()),O(xe.notes||""),S(xe.invoicePhoto||""),v(xe.id),console.log("✅ تم ملء النموذج بالبيانات:",{materialName:L,materialCategory:De,materialUnit:Ee,quantity:xe.quantity,unitPrice:xe.unitPrice,purchaseType:xe.purchaseType})}},[xe,n]),Ce({mutationFn:L=>ae("/api/materials","POST",L),onSuccess:()=>{Ae.invalidateQueries({queryKey:["/api/materials"]})},onError:L=>{console.error("Material creation error:",L);let De="حدث خطأ أثناء إضافة المادة";L?.response?.data?.message&&(De=L.response.data.message),Y({title:"خطأ",description:De,variant:"destructive"})}}),Array.isArray(X)&&X.map(L=>L.name),Array.isArray(X)&&Array.from(new Set(X.map(L=>L.category))),Array.isArray(X)&&Array.from(new Set(X.map(L=>L.unit)));const z=Array.isArray(Je)?Je.filter(L=>L.isActive):[],G=Ce({mutationFn:async L=>(await Promise.all([Ve("materialNames",i),Ve("materialCategories",l),Ve("materialUnits",d),Ve("supplierNames",g),Ve("invoiceNumbers",w),Ve("notes",E)]),ae("/api/material-purchases","POST",L)),onSuccess:async()=>{Ae.invalidateQueries({queryKey:["/api/autocomplete"]}),Y({title:"تم الحفظ",description:"تم حفظ شراء المواد بنجاح"}),oe(),Ae.invalidateQueries({queryKey:["/api/projects",s,"material-purchases"]})},onError:async L=>{await Promise.all([Ve("materialNames",i),Ve("materialCategories",l),Ve("materialUnits",d),Ve("supplierNames",g),Ve("invoiceNumbers",w),Ve("notes",E)]),Ae.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("Material purchase error:",L);let De="حدث خطأ أثناء حفظ شراء المواد",Ee=[];if(L?.response?.data){const Ie=L.response.data;Ie.message&&(De=Ie.message),Ie.details&&Array.isArray(Ie.details)?Ee=Ie.details:Ie.validationErrors&&Array.isArray(Ie.validationErrors)&&(Ee=Ie.validationErrors)}const Vt=Ee.length>0?`${De}

${Ee.map(Ie=>`• ${Ie}`).join(`
`)}`:De;Y({title:"خطأ في حفظ شراء المواد",description:Vt,variant:"destructive",duration:8e3})}}),oe=()=>{o(""),u(""),c(""),m(""),x(""),A("نقد"),N(""),_(""),k(Gs()),I(Gs()),O(""),S(""),v(null)},ce=Ce({mutationFn:async({id:L,data:De})=>{console.log("🔄 [PATCH] بدء تحديث المشترية:",{id:L,data:De}),await Promise.all([Ve("materialNames",i),Ve("materialCategories",l),Ve("materialUnits",d),Ve("supplierNames",g),Ve("invoiceNumbers",w),Ve("notes",E)]);const Ee=await ae(`/api/material-purchases/${L}`,"PATCH",De);return console.log("✅ [PATCH] استجابة تحديث المشترية:",Ee),Ee},onSuccess:async()=>{Ae.invalidateQueries({queryKey:["/api/autocomplete"]}),Y({title:"تم التعديل",description:"تم تعديل شراء المواد بنجاح"}),oe(),Ae.invalidateQueries({queryKey:["/api/projects",s,"material-purchases"]})},onError:async L=>{await Promise.all([Ve("materialNames",i),Ve("materialCategories",l),Ve("materialUnits",d),Ve("supplierNames",g),Ve("invoiceNumbers",w),Ve("notes",E)]),Ae.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("Material purchase update error:",L);let De="حدث خطأ أثناء تحديث شراء المواد",Ee=[];if(L?.response?.data){const Ie=L.response.data;Ie.message&&(De=Ie.message),Ie.details&&Array.isArray(Ie.details)?Ee=Ie.details:Ie.validationErrors&&Array.isArray(Ie.validationErrors)&&(Ee=Ie.validationErrors)}const Vt=Ee.length>0?`${De}

${Ee.map(Ie=>`• ${Ie}`).join(`
`)}`:De;Y({title:"خطأ في تحديث شراء المواد",description:Vt,variant:"destructive",duration:8e3})}}),te=Ce({mutationFn:L=>ae(`/api/material-purchases/${L}`,"DELETE"),onSuccess:()=>{Y({title:"تم الحذف",description:"تم حذف شراء المواد بنجاح"}),Ae.invalidateQueries({queryKey:["/api/projects",s,"material-purchases"]})},onError:L=>{console.error("Material purchase delete error:",L);let De="حدث خطأ أثناء حذف شراء المواد",Ee=[];if(L?.response?.data){const Ie=L.response.data;Ie.message&&(De=Ie.message),Ie.details&&Array.isArray(Ie.details)&&(Ee=Ie.details)}const Vt=Ee.length>0?`${De}

${Ee.map(Ie=>`• ${Ie}`).join(`
`)}`:De;Y({title:"خطأ في حذف شراء المواد",description:Vt,variant:"destructive",duration:6e3})}}),ve=()=>{const L=parseFloat(f)||0,De=parseFloat(y)||0;return(L*De).toFixed(2)},Re=L=>{const De=L.target.files?.[0];if(De){const Ee=new FileReader;Ee.onload=Vt=>{S(Vt.target?.result)},Ee.readAsDataURL(De)}},dt=(L=!1)=>{if(!s||!i||!d||!f||!y){Y({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const De=parseFloat(ve()),Ee={projectId:s,materialName:i.trim(),materialCategory:l.trim()||null,materialUnit:d.trim(),quantity:parseFloat(f),unitPrice:parseFloat(y),totalAmount:De,purchaseType:p.trim(),supplierName:g?.trim()||"",invoiceNumber:w?.trim()||"",invoiceDate:b||new Date().toISOString().split("T")[0],invoicePhoto:T||"",notes:E?.trim()||"",purchaseDate:R};console.log("💾 بيانات المشترية قبل الحفظ:",{materialName:Ee.materialName,materialCategory:Ee.materialCategory,materialUnit:Ee.materialUnit,isEditing:!!M}),M?ce.mutate({id:M,data:Ee}):G.mutate(Ee),!L&&!M&&t("/daily-expenses")},{data:Zt=[],isLoading:ur,refetch:xs}=ge({queryKey:["/api/projects",s,"material-purchases"],enabled:!!s,refetchOnMount:!0,refetchOnWindowFocus:!0,staleTime:0}),mr=Zt.filter(L=>{if(!L.purchaseDate)return!1;const De=new Date(L.purchaseDate),Ee=new Date(R);return De.toDateString()===Ee.toDateString()});h.useEffect(()=>{s&&xs()},[s,R,xs]);const Lr=L=>{o(L.materialName||L.material?.name||""),u(L.materialCategory||L.material?.category||""),c(L.materialUnit||L.material?.unit||L.unit||""),m(L.quantity),x(L.unitPrice),A(L.purchaseType||L.paymentType||"نقد"),N(L.supplierName||""),_(L.invoiceNumber||""),k(L.invoiceDate||Gs()),I(L.purchaseDate||Gs()),O(L.notes||""),S(L.invoicePhoto||""),v(L.id)};return e.jsxs("div",{className:"p-4 slide-in",children:[P&&n&&e.jsx(q,{className:"mb-4 border-blue-200 bg-blue-50",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}),e.jsx("span",{className:"text-blue-700",children:"جاري تحميل بيانات المشترية للتعديل..."})]})})}),e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Bi,{className:"ml-2 h-5 w-5 text-primary"}),M?"تعديل مشترية المواد":"اختر المشروع"]}),e.jsx(Ea,{selectedProjectId:s,onProjectChange:(L,De)=>r(L,De),showHeader:!1,variant:"compact"})]})}),e.jsx(q,{className:"mb-4",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"اسم المادة"}),e.jsx(Ft,{value:i,onChange:o,category:"materialNames",placeholder:"اختر أو أدخل اسم المادة..."})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"فئة المادة"}),e.jsx(Ft,{value:l,onChange:u,category:"materialCategories",placeholder:"اختر أو أدخل فئة المادة..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"الكمية"}),e.jsx(be,{type:"number",inputMode:"decimal",value:f,onChange:L=>m(L.target.value),placeholder:"0",className:"text-center arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"الوحدة"}),e.jsx(Ft,{value:d,onChange:c,category:"materialUnits",placeholder:"طن، كيس، م³..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"سعر الوحدة"}),e.jsx(be,{type:"number",inputMode:"decimal",value:y,onChange:L=>x(L.target.value),placeholder:"0.00",className:"text-center arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"المبلغ الإجمالي"}),e.jsx(be,{type:"number",value:ve(),readOnly:!0,className:"text-center arabic-numbers bg-muted"})]})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"نوع الدفع"}),e.jsxs(fj,{value:p,onValueChange:A,className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx(No,{value:"نقد",id:"cash"}),e.jsx(se,{htmlFor:"cash",className:"text-sm",children:"نقد"})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx(No,{value:"آجل",id:"credit"}),e.jsx(se,{htmlFor:"credit",className:"text-sm",children:"آجل"})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx(No,{value:"توريد",id:"supply"}),e.jsx(se,{htmlFor:"supply",className:"text-sm",children:"توريد"})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"اسم المورد/المحل"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(qe,{value:g,onValueChange:N,children:[e.jsx(Oe,{className:"flex-1",children:e.jsx(Ue,{placeholder:"اختر المورد..."})}),e.jsxs($e,{children:[z.map(L=>e.jsx(K,{value:L.name,children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:L.name}),L.contactPerson&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["جهة الاتصال: ",L.contactPerson]})]})},L.id)),z.length===0&&e.jsx(K,{value:"no-suppliers",disabled:!0,children:e.jsx("span",{className:"text-muted-foreground",children:"لا توجد موردين مسجلين"})})]})]}),e.jsxs(qs,{open:W,onOpenChange:j,children:[e.jsx(kd,{asChild:!0,children:e.jsx($,{type:"button",variant:"outline",size:"icon",title:"إضافة مورد جديد",children:e.jsx(bs,{className:"h-4 w-4"})})}),e.jsxs(Fs,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:"إضافة مورد جديد"}),e.jsx(Ys,{children:"أدخل معلومات المورد الجديد. جميع الحقول اختيارية عدا اسم المورد."})]}),e.jsxs("form",{onSubmit:ks,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"supplier-name",children:"اسم المورد/المحل *"}),e.jsx(be,{id:"supplier-name",value:V,onChange:L=>ne(L.target.value),placeholder:"مثال: مؤسسة الخضراء للمواد",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"supplier-contact",children:"الشخص المسؤول"}),e.jsx(be,{id:"supplier-contact",value:F,onChange:L=>ye(L.target.value),placeholder:"مثال: أحمد محمد"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"supplier-phone",children:"رقم الهاتف"}),e.jsx(be,{id:"supplier-phone",value:fe,onChange:L=>de(L.target.value),placeholder:"مثال: 777123456",type:"tel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"supplier-address",children:"العنوان"}),e.jsx(be,{id:"supplier-address",value:ke,onChange:L=>nt(L.target.value),placeholder:"مثال: شارع الستين، صنعاء"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"supplier-payment",children:"شروط الدفع"}),e.jsxs(qe,{value:ct,onValueChange:it,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر شروط الدفع"})}),e.jsxs($e,{children:[e.jsx(K,{value:"نقد",children:"نقد"}),e.jsx(K,{value:"أجل",children:"أجل"}),e.jsx(K,{value:"نقد وأجل",children:"نقد وأجل"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"supplier-notes",children:"ملاحظات"}),e.jsx(an,{id:"supplier-notes",value:Z,onChange:L=>U(L.target.value),placeholder:"أي ملاحظات إضافية...",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2 space-x-reverse pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>{j(!1),kt()},children:"إلغاء"}),e.jsx($,{type:"submit",disabled:ps.isPending||!V.trim(),children:ps.isPending?"جاري الإضافة...":"إضافة المورد"})]})]})]})]})]}),z.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"لا توجد موردين مسجلين. اضغط + لإضافة مورد جديد"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"تاريخ الشراء"}),e.jsx(be,{type:"date",value:R,onChange:L=>I(L.target.value),className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"رقم الفاتورة"}),e.jsx(Ft,{type:"number",inputMode:"numeric",value:w,onChange:_,category:"invoiceNumbers",placeholder:"رقم الفاتورة",className:"arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"تاريخ الفاتورة"}),e.jsx(be,{type:"date",value:b,onChange:L=>k(L.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"صورة الفاتورة"}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[T?e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:T,alt:"Invoice",className:"max-w-full max-h-32 mx-auto rounded"}),e.jsx("p",{className:"text-sm text-success",children:"تم رفع الصورة بنجاح"})]}):e.jsxs(e.Fragment,{children:[e.jsx(So,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"اضغط لإضافة صورة الفاتورة"})]}),e.jsx(be,{type:"file",accept:"image/*",onChange:Re,className:"hidden",id:"invoice-photo"}),e.jsx(se,{htmlFor:"invoice-photo",className:"bg-primary text-primary-foreground px-4 py-2 rounded-lg cursor-pointer hover:bg-primary/90 transition-colors inline-block",children:T?"تغيير الصورة":"اختر صورة"})]})]}),e.jsxs("div",{children:[e.jsx(se,{className:"block text-sm font-medium text-foreground mb-2",children:"ملاحظات"}),e.jsx(Ft,{value:E,onChange:O,category:"notes",placeholder:"أي ملاحظات إضافية..."})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs($,{onClick:()=>dt(!1),disabled:G.isPending||ce.isPending,className:"w-full bg-success hover:bg-success/90 text-success-foreground",children:[e.jsx(ea,{className:"ml-2 h-4 w-4"}),G.isPending||ce.isPending?"جاري الحفظ...":M?"تحديث الشراء":"حفظ الشراء"]}),!M&&e.jsxs($,{onClick:()=>dt(!0),disabled:G.isPending,variant:"outline",className:"w-full",children:[e.jsx(bs,{className:"ml-2 h-4 w-4"}),"حفظ وإضافة آخر"]}),M&&e.jsx($,{onClick:oe,variant:"outline",className:"w-full",children:"إلغاء التحرير"})]}),ur&&e.jsx(q,{className:"mt-6",children:e.jsx(H,{className:"p-4",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"جاري تحميل المشتريات..."})})}),s&&Zt.length>0&&mr.length===0&&e.jsx(q,{className:"mt-6",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(ra,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground/50"}),e.jsxs("h3",{className:"text-lg font-medium mb-2",children:["لا توجد مشتريات في ",new Date(R).toLocaleDateString("en-GB")]}),e.jsx("p",{className:"text-sm",children:"غيّر تاريخ الشراء أعلاه لعرض مشتريات تواريخ أخرى"}),e.jsxs("p",{className:"text-sm mt-1",children:["إجمالي المشتريات المسجلة: ",Zt.length]})]})})}),s&&mr&&mr.length>0&&e.jsx(q,{className:"mt-6",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["المشتريات في ",new Date(R).toLocaleDateString("en-GB")," (",mr.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"غيّر تاريخ الشراء أعلاه لعرض مشتريات تواريخ أخرى"})]}),e.jsx("div",{className:"space-y-3",children:mr.map(L=>e.jsx("div",{className:"border rounded-lg p-3 bg-card",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:L.materialName||L.material?.name||"غير محدد"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",L.materialUnit||L.material?.unit||L.unit||"غير محدد",")"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[(L.materialCategory||L.material?.category)&&e.jsxs("p",{children:["الفئة: ",L.materialCategory||L.material?.category]}),e.jsxs("p",{children:["الكمية: ",L.quantity," | السعر: ",Me(L.unitPrice)]}),e.jsxs("p",{className:"font-medium",children:["الإجمالي: ",Me(L.totalAmount)]}),L.supplierName&&e.jsxs("p",{children:["المورد: ",L.supplierName]}),L.purchaseType&&e.jsxs("p",{children:["نوع الدفع: ",L.purchaseType]}),L.purchaseDate&&e.jsxs("p",{children:["تاريخ الشراء: ",new Date(L.purchaseDate).toLocaleDateString("en-GB")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>Lr(L),disabled:M===L.id,children:"تعديل"}),e.jsx($,{size:"sm",variant:"destructive",onClick:()=>te.mutate(L.id),disabled:te.isPending,children:"حذف"})]})]})},L.id))})]})})]})}var t3="Separator",Yh="horizontal",s3=["horizontal","vertical"],pj=h.forwardRef((t,s)=>{const{decorative:r,orientation:a=Yh,...n}=t,i=r3(a)?a:Yh,l=r?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return e.jsx(We.div,{"data-orientation":i,...l,...n,ref:s})});pj.displayName=t3;function r3(t){return s3.includes(t)}var xj=pj;const Is=h.forwardRef(({className:t,orientation:s="horizontal",decorative:r=!0,...a},n)=>e.jsx(xj,{ref:n,decorative:r,orientation:s,className:he("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...a}));Is.displayName=xj.displayName;function a3({title:t,description:s,icon:r,status:a,requiresProject:n=!1,requiresWorker:i=!1,requiresDateRange:o=!1,onGenerate:l,isGenerating:u=!1,className:d=""}){const c=m=>{switch(m){case"active":return"bg-green-100 text-green-800 border-green-200";case"beta":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"coming-soon":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},f=m=>{switch(m){case"active":return"نشط";case"beta":return"تجريبي";case"coming-soon":return"قريباً";default:return"غير محدد"}};return e.jsxs(q,{className:`hover:shadow-lg transition-all duration-300 cursor-pointer border-r-4 border-r-blue-500 ${d}`,children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white",children:e.jsx(r,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg",children:t}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s})]})]}),e.jsx(le,{className:c(a),children:f(a)})]})}),e.jsxs(H,{className:"pt-0",children:[(n||i||o)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[n&&e.jsxs(le,{variant:"outline",className:"text-xs flex items-center gap-1",children:[e.jsx(Cs,{className:"w-3 h-3"}),"يحتاج مشروع"]}),i&&e.jsxs(le,{variant:"outline",className:"text-xs flex items-center gap-1",children:[e.jsx(Zs,{className:"w-3 h-3"}),"يحتاج عامل"]}),o&&e.jsxs(le,{variant:"outline",className:"text-xs flex items-center gap-1",children:[e.jsx(or,{className:"w-3 h-3"}),"يحتاج تاريخ"]})]}),e.jsxs($,{className:"w-full",onClick:l,disabled:u||a==="coming-soon","data-testid":`button-generate-${t.replace(/\s+/g,"-").toLowerCase()}`,children:[e.jsx(ry,{className:"w-4 h-4 mr-2"}),u?e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"w-4 h-4 mr-2 animate-spin"}),"جاري الإنشاء..."]}):a==="coming-soon"?"قريباً":"إنشاء التقرير"]})]})]})}function n3(){const[,t]=Or(),{selectedProjectId:s,selectProject:r}=_a(),{toast:a}=Ct(),{setFloatingAction:n}=Ls(),[i,o]=h.useState("financial"),[l,u]=h.useState(""),[d,c]=h.useState(""),[f,m]=h.useState(Gs()),[y,x]=h.useState(!1),[p,A]=h.useState(null);h.useEffect(()=>(n(null),()=>n(null)),[n]);const{data:g=[]}=ge({queryKey:["/api/projects"],queryFn:async()=>{try{const v=await ae("/api/projects","GET");return v&&v.data&&Array.isArray(v.data)?v.data:Array.isArray(v)?v:[]}catch(v){return console.error("Error fetching projects:",v),[]}}}),{data:N=[]}=ge({queryKey:["/api/workers"],queryFn:async()=>{try{const v=await ae("/api/workers","GET");return v&&v.data&&Array.isArray(v.data)?v.data:Array.isArray(v)?v:[]}catch(v){return console.error("Error fetching workers:",v),[]}}}),{data:w=[]}=ge({queryKey:["/api/projects/with-stats"],queryFn:async()=>{try{const v=await ae("/api/projects/with-stats","GET");return v&&v.data&&Array.isArray(v.data)?v.data:Array.isArray(v)?v:[]}catch(v){return console.error("Error fetching projects with stats:",v),[]}},refetchInterval:6e4,staleTime:3e4}),_=Array.isArray(g)?g.find(v=>v.id===s):void 0,k=(Array.isArray(w)?w.find(v=>v.id===s):void 0)?.stats||{},R={activeProjects:Array.isArray(g)?g.filter(v=>v.status==="active").length:0,totalWorkers:N.length,totalIncome:parseFloat(k?.totalIncome?.toString()||"0")||0,totalExpenses:parseFloat(k?.totalExpenses?.toString()||"0")||0,currentBalance:parseFloat(k?.currentBalance?.toString()||"0")||0},I=async()=>{if(!s||!f){a({title:"بيانات ناقصة",description:"يرجى اختيار مشروع وتاريخ",variant:"destructive"});return}x(!0);try{t(`/daily-expenses?project=${s}&date=${f}`),a({title:"تم فتح تقرير المصروفات اليومية",description:"يمكنك الآن عرض وطباعة التقرير"})}catch{a({title:"خطأ في فتح التقرير",description:"حدث خطأ أثناء محاولة فتح التقرير",variant:"destructive"})}finally{x(!1)}},E=async()=>{if(!l||!d||!f){a({title:"بيانات ناقصة",description:"يرجى اختيار عامل وفترة زمنية",variant:"destructive"});return}x(!0);try{t(`/worker-accounts?worker=${l}&from=${d}&to=${f}&project=${s}`),a({title:"تم فتح كشف حساب العامل",description:"يمكنك الآن عرض وطباعة التقرير"})}catch{a({title:"خطأ في فتح التقرير",description:"حدث خطأ أثناء محاولة فتح التقرير",variant:"destructive"})}finally{x(!1)}},O=async()=>{if(!s){a({title:"بيانات ناقصة",description:"يرجى اختيار مشروع",variant:"destructive"});return}x(!0);try{t(`/project-transactions?project=${s}&from=${d}&to=${f}`),a({title:"تم فتح تقرير المشروع",description:"يمكنك الآن عرض وطباعة التقرير"})}catch{a({title:"خطأ في فتح التقرير",description:"حدث خطأ أثناء محاولة فتح التقرير",variant:"destructive"})}finally{x(!1)}},T=()=>{t("/workers-unified-reports"),a({title:"تم فتح تقارير العمال",description:"يمكنك الآن عرض التقارير الموحدة للعمال"})},S=()=>{t("/advanced-reports"),a({title:"تم فتح التقارير المتقدمة",description:"يمكنك الآن الوصول إلى جميع التقارير المتقدمة"})},M=[{id:"financial",name:"التقارير المالية",icon:us,description:"تقارير الدخل والمصروفات والرصيد المالي",color:"text-green-600",reports:[{id:"daily-expenses",name:"المصروفات اليومية",description:"تقرير مفصل للمصروفات والدخل اليومي",icon:li,requiresProject:!0,requiresWorker:!1,requiresDateRange:!1,status:"active",action:I},{id:"project-summary",name:"ملخص المشروع المالي",description:"تقرير شامل للوضع المالي للمشروع",icon:Cs,requiresProject:!0,requiresWorker:!1,requiresDateRange:!0,status:"active",action:O},{id:"financial-analysis",name:"التحليل المالي",description:"تحليل مالي متقدم مع الرسوم البيانية",icon:ls,requiresProject:!0,requiresWorker:!1,requiresDateRange:!0,status:"beta",action:S}]},{id:"workers",name:"تقارير العمال",icon:_t,description:"تقارير الحضور والأجور والحوالات",color:"text-blue-600",reports:[{id:"worker-statement",name:"كشف حساب العامل",description:"كشف مفصل لحساب العامل والحوالات",icon:Ui,requiresProject:!1,requiresWorker:!0,requiresDateRange:!0,status:"active",action:E},{id:"workers-summary",name:"ملخص جميع العمال",description:"تقرير موحد لجميع العمال والأجور",icon:_t,requiresProject:!0,requiresWorker:!1,requiresDateRange:!0,status:"active",action:T},{id:"attendance-report",name:"تقرير الحضور",description:"تقرير مفصل لحضور العمال",icon:Ut,requiresProject:!0,requiresWorker:!1,requiresDateRange:!0,status:"active",action:T}]},{id:"projects",name:"تقارير المشاريع",icon:Cs,description:"تقارير أداء وإحصائيات المشاريع",color:"text-purple-600",reports:[{id:"projects-overview",name:"نظرة عامة على المشاريع",description:"ملخص شامل لجميع المشاريع",icon:$t,requiresProject:!1,requiresWorker:!1,requiresDateRange:!1,status:"active",action:()=>t("/projects")},{id:"project-comparison",name:"مقارنة المشاريع",description:"مقارنة الأداء المالي بين المشاريع",icon:Kt,requiresProject:!1,requiresWorker:!1,requiresDateRange:!0,status:"beta",action:S}]},{id:"materials",name:"تقارير المواد",icon:ra,description:"تقارير المشتريات والمخزون",color:"text-orange-600",reports:[{id:"materials-purchases",name:"مشتريات المواد",description:"تقرير مفصل لجميع مشتريات المواد",icon:bd,requiresProject:!0,requiresWorker:!1,requiresDateRange:!0,status:"active",action:()=>t("/material-purchases")},{id:"suppliers-report",name:"تقرير الموردين",description:"تقرير المعاملات مع الموردين",icon:Ek,requiresProject:!1,requiresWorker:!1,requiresDateRange:!0,status:"active",action:()=>t("/suppliers")}]}];return M.find(v=>v.id===i),e.jsxs("div",{className:"p-2 md:p-6 space-y-4 md:space-y-6","data-testid":"reports-page",children:[e.jsx(Ea,{selectedProjectId:s,onProjectChange:(v,W)=>r(v,W)}),s&&e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(gi,{className:"w-5 h-5 text-blue-600"}),"إحصائيات المشروع: ",_?.name]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsx(q,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsx(H,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-green-700",children:"إجمالي الدخل"}),e.jsx("p",{className:"text-sm md:text-lg font-bold text-green-900",children:Me(R.totalIncome.toString())})]}),e.jsx(Kt,{className:"h-6 w-6 md:h-8 md:w-8 text-green-600"})]})})}),e.jsx(q,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200",children:e.jsx(H,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-red-700",children:"إجمالي المصروفات"}),e.jsx("p",{className:"text-sm md:text-lg font-bold text-red-900",children:Me(R.totalExpenses.toString())})]}),e.jsx(An,{className:"h-6 w-6 md:h-8 md:w-8 text-red-600"})]})})}),e.jsx(q,{className:`bg-gradient-to-br ${R.currentBalance>=0?"from-emerald-50 to-emerald-100 border-emerald-200":"from-rose-50 to-rose-100 border-rose-100"}`,children:e.jsx(H,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:`text-xs md:text-sm font-medium ${R.currentBalance>=0?"text-emerald-700":"text-rose-700"}`,children:"الرصيد الحالي"}),e.jsx("p",{className:`text-sm md:text-lg font-bold ${R.currentBalance>=0?"text-emerald-900":"text-rose-900"}`,children:Me(R.currentBalance.toString())})]}),e.jsx(us,{className:`h-6 w-6 md:h-8 md:w-8 ${R.currentBalance>=0?"text-emerald-600":"text-rose-600"}`})]})})}),e.jsx(q,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsx(H,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-blue-700",children:"عدد العمال"}),e.jsx("p",{className:"text-sm md:text-lg font-bold text-blue-900",children:R.totalWorkers})]}),e.jsx(_t,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"})]})})})]})})]}),e.jsxs(Ks,{value:i,onValueChange:o,children:[e.jsx(Os,{className:"grid w-full grid-cols-2 md:grid-cols-4 gap-1 md:gap-0",children:M.map(v=>{const W=v.icon;return e.jsxs(He,{value:v.id,className:"flex items-center gap-2","data-testid":`tab-${v.id}`,children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:v.name})]},v.id)})}),M.map(v=>e.jsx(Ge,{value:v.id,className:"space-y-4",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v.icon,{className:`w-6 h-6 ${v.color}`}),e.jsxs("div",{children:[e.jsx(pe,{children:v.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.description})]})]}),e.jsxs(le,{variant:"secondary",children:[v.reports.length," تقرير متاح"]})]})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.reports.map(W=>e.jsx(a3,{title:W.name,description:W.description,icon:W.icon,status:W.status,requiresProject:W.requiresProject,requiresWorker:W.requiresWorker,requiresDateRange:W.requiresDateRange,onGenerate:W.action,isGenerating:y},W.id))})})]})},v.id))]}),p&&e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5"}),"إعدادات التقرير: ",p.name]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.requiresWorker&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"اختيار العامل *"}),e.jsxs(qe,{value:l,onValueChange:u,children:[e.jsx(Oe,{"data-testid":"select-worker",children:e.jsx(Ue,{placeholder:"اختر العامل"})}),e.jsx($e,{children:Array.isArray(N)?N.map(v=>e.jsxs(K,{value:v.id,children:[v.name," - ",v.type]},v.id)):null})]})]}),p.requiresDateRange&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"تاريخ البداية *"}),e.jsx(be,{type:"date",value:d,onChange:v=>c(v.target.value),"data-testid":"input-date-from"})]}),(p.requiresDateRange||p.id==="daily-expenses")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:p.id==="daily-expenses"?"التاريخ *":"تاريخ النهاية *"}),e.jsx(be,{type:"date",value:f,onChange:v=>m(v.target.value),"data-testid":"input-date-to"})]})]}),e.jsx(Is,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx($,{variant:"outline",onClick:()=>A(null),"data-testid":"button-cancel-settings",children:"إلغاء"}),e.jsxs($,{onClick:p.action,disabled:y,className:"flex items-center gap-2","data-testid":"button-generate-from-settings",children:[e.jsx(ry,{className:"w-4 h-4"}),y?"جاري الإنشاء...":"إنشاء التقرير"]})]})]})]})]})}const ie=Symbol.for("drizzle:entityKind");function ys(t,s){if(!t||typeof t!="object")return!1;if(t instanceof s)return!0;if(!Object.prototype.hasOwnProperty.call(s,ie))throw new Error(`Class "${s.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(ie in r&&r[ie]===s[ie])return!0;r=Object.getPrototypeOf(r)}return!1}var Hf;Hf=ie;class In{constructor(s,r){B(this,"name");B(this,"keyAsName");B(this,"primary");B(this,"notNull");B(this,"default");B(this,"defaultFn");B(this,"onUpdateFn");B(this,"hasDefault");B(this,"isUnique");B(this,"uniqueName");B(this,"uniqueType");B(this,"dataType");B(this,"columnType");B(this,"enumValues");B(this,"generated");B(this,"generatedIdentity");B(this,"config");this.table=s,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}mapFromDriverValue(s){return s}mapToDriverValue(s){return s}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}B(In,Hf,"Column");var Gf;Gf=ie;class gj{constructor(s,r,a){B(this,"config");B(this,"$default",this.$defaultFn);B(this,"$onUpdate",this.$onUpdateFn);this.config={name:s,keyAsName:s==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:a,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(s){return this.config.default=s,this.config.hasDefault=!0,this}$defaultFn(s){return this.config.defaultFn=s,this.config.hasDefault=!0,this}$onUpdateFn(s){return this.config.onUpdateFn=s,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(s){this.config.name===""&&(this.config.name=s)}}B(gj,Gf,"ColumnBuilder");const jn=Symbol.for("drizzle:Name");var Qf;Qf=ie;class yj{constructor(s,r){B(this,"reference");B(this,"_onUpdate","no action");B(this,"_onDelete","no action");this.reference=()=>{const{name:a,columns:n,foreignColumns:i}=s();return{name:a,columns:n,foreignTable:i[0].table,foreignColumns:i}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(s){return this._onUpdate=s===void 0?"no action":s,this}onDelete(s){return this._onDelete=s===void 0?"no action":s,this}build(s){return new vj(s,this)}}B(yj,Qf,"PgForeignKeyBuilder");var Xf;Xf=ie;class vj{constructor(s,r){B(this,"reference");B(this,"onUpdate");B(this,"onDelete");this.table=s,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}getName(){const{name:s,columns:r,foreignColumns:a}=this.reference(),n=r.map(l=>l.name),i=a.map(l=>l.name),o=[this.table[jn],...n,a[0].table[jn],...i];return s??`${o.join("_")}_fk`}}B(vj,Xf,"PgForeignKey");function i3(t,...s){return t(...s)}function o3(t,s){return`${t[jn]}_${s.join("_")}_unique`}function Jh(t,s,r){for(let a=s;a<t.length;a++){const n=t[a];if(n==="\\"){a++;continue}if(n==='"')return[t.slice(s,a).replace(/\\/g,""),a+1];if(!r&&(n===","||n==="}"))return[t.slice(s,a).replace(/\\/g,""),a]}return[t.slice(s).replace(/\\/g,""),t.length]}function bj(t,s=0){const r=[];let a=s,n=!1;for(;a<t.length;){const i=t[a];if(i===","){(n||a===s)&&r.push(""),n=!0,a++;continue}if(n=!1,i==="\\"){a+=2;continue}if(i==='"'){const[u,d]=Jh(t,a+1,!0);r.push(u),a=d;continue}if(i==="}")return[r,a+1];if(i==="{"){const[u,d]=bj(t,a+1);r.push(u),a=d;continue}const[o,l]=Jh(t,a,!1);r.push(o),a=l}return[r,a]}function l3(t){const[s]=bj(t,1);return s}function jj(t){return`{${t.map(s=>Array.isArray(s)?jj(s):typeof s=="string"?`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${s}`).join(",")}}`}var Zf,Yf;class ft extends(Yf=gj,Zf=ie,Yf){constructor(){super(...arguments);B(this,"foreignKeyConfigs",[])}array(r){return new wj(this.config.name,this,r)}references(r,a={}){return this.foreignKeyConfigs.push({ref:r,actions:a}),this}unique(r,a){return this.config.isUnique=!0,this.config.uniqueName=r,this.config.uniqueType=a?.nulls,this}generatedAlwaysAs(r){return this.config.generated={as:r,type:"always",mode:"stored"},this}buildForeignKeys(r,a){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>i3((o,l)=>{const u=new yj(()=>{const d=o();return{columns:[r],foreignColumns:[d]}});return l.onUpdate&&u.onUpdate(l.onUpdate),l.onDelete&&u.onDelete(l.onDelete),u.build(a)},n,i))}buildExtraConfigColumn(r){return new Nj(r,this.config)}}B(ft,Zf,"PgColumnBuilder");var Jf,ep;class st extends(ep=In,Jf=ie,ep){constructor(s,r){r.uniqueName||(r.uniqueName=o3(s,[r.name])),super(s,r),this.table=s}}B(st,Jf,"PgColumn");var tp,sp;class Nj extends(sp=st,tp=ie,sp){constructor(){super(...arguments);B(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});B(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(r){return this.indexConfig.opClass=r,this}}B(Nj,tp,"ExtraConfigColumn");var rp,ap;class wj extends(ap=ft,rp=ie,ap){constructor(s,r,a){super(s,"array","PgArray"),this.config.baseBuilder=r,this.config.size=a}build(s){const r=this.config.baseBuilder.build(s);return new Yc(s,this.config,r)}}B(wj,rp,"PgArrayBuilder");var np,ip;const sl=class sl extends(ip=st,np=ie,ip){constructor(r,a,n,i){super(r,a);B(this,"size");this.baseColumn=n,this.range=i,this.size=a.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(r){return typeof r=="string"&&(r=l3(r)),r.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(r,a=!1){const n=r.map(i=>i===null?null:ys(this.baseColumn,sl)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return a?n:jj(n)}};B(sl,np,"PgArray");let Yc=sl;const ef=Symbol.for("drizzle:isPgEnum");function c3(t){return!!t&&typeof t=="function"&&ef in t&&t[ef]===!0}var op;op=ie;class bu{constructor(s,r,a,n=!1){this._={brand:"Subquery",sql:s,selectedFields:r,alias:a,isWith:n}}}B(bu,op,"Subquery");const d3={startActiveSpan(t,s){return s()}},Nn=Symbol.for("drizzle:ViewBaseConfig"),lc=Symbol.for("drizzle:Schema"),tf=Symbol.for("drizzle:Columns"),sf=Symbol.for("drizzle:ExtraConfigColumns"),cc=Symbol.for("drizzle:OriginalName"),dc=Symbol.for("drizzle:BaseName"),Ko=Symbol.for("drizzle:IsAlias"),rf=Symbol.for("drizzle:ExtraConfigBuilder"),kj=Symbol.for("drizzle:IsDrizzleTable");var lp,cp,dp,up,mp,hp,fp,pp,xp,gp,ho;let Xs=(gp=ie,xp=jn,pp=cc,fp=lc,hp=tf,mp=sf,up=dc,dp=Ko,cp=kj,lp=rf,ho=class{constructor(s,r,a){B(this,xp);B(this,pp);B(this,fp);B(this,hp);B(this,mp);B(this,up);B(this,dp,!1);B(this,cp,!0);B(this,lp);this[jn]=this[cc]=s,this[lc]=r,this[dc]=a}},B(ho,gp,"Table"),B(ho,"Symbol",{Name:jn,Schema:lc,OriginalName:cc,Columns:tf,ExtraConfigColumns:sf,BaseName:dc,IsAlias:Ko,ExtraConfigBuilder:rf}),ho);function Sj(t){return typeof t=="object"&&t!==null&&kj in t}function u3(t){return t!=null&&typeof t.getSQL=="function"}function m3(t){const s={sql:"",params:[]};for(const r of t)s.sql+=r.sql,s.params.push(...r.params),r.typings?.length&&(s.typings||(s.typings=[]),s.typings.push(...r.typings));return s}var yp;yp=ie;class ar{constructor(s){B(this,"value");this.value=Array.isArray(s)?s:[s]}getSQL(){return new cs([this])}}B(ar,yp,"StringChunk");var vp;vp=ie;const $a=class $a{constructor(s){B(this,"decoder",Tj);B(this,"shouldInlineParams",!1);this.queryChunks=s}append(s){return this.queryChunks.push(...s.queryChunks),this}toQuery(s){return d3.startActiveSpan("drizzle.buildSQL",r=>{const a=this.buildQueryFromSourceParams(this.queryChunks,s);return r?.setAttributes({"drizzle.query.text":a.sql,"drizzle.query.params":JSON.stringify(a.params)}),a})}buildQueryFromSourceParams(s,r){const a=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:n,escapeName:i,escapeParam:o,prepareTyping:l,inlineParams:u,paramStartIndex:d}=a;return m3(s.map(c=>{if(ys(c,ar))return{sql:c.value.join(""),params:[]};if(ys(c,Ho))return{sql:i(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){const f=[new ar("(")];for(const[m,y]of c.entries())f.push(y),m<c.length-1&&f.push(new ar(", "));return f.push(new ar(")")),this.buildQueryFromSourceParams(f,a)}if(ys(c,$a))return this.buildQueryFromSourceParams(c.queryChunks,{...a,inlineParams:u||c.shouldInlineParams});if(ys(c,Xs)){const f=c[Xs.Symbol.Schema],m=c[Xs.Symbol.Name];return{sql:f===void 0||c[Ko]?i(m):i(f)+"."+i(m),params:[]}}if(ys(c,In)){const f=n.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:i(f),params:[]};const m=c.table[Xs.Symbol.Schema];return{sql:c.table[Ko]||m===void 0?i(c.table[Xs.Symbol.Name])+"."+i(f):i(m)+"."+i(c.table[Xs.Symbol.Name])+"."+i(f),params:[]}}if(ys(c,Pj)){const f=c[Nn].schema,m=c[Nn].name;return{sql:f===void 0||c[Nn].isAlias?i(m):i(f)+"."+i(m),params:[]}}if(ys(c,ju)){if(ys(c.value,Go))return{sql:o(d.value++,c),params:[c],typings:["none"]};const f=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(ys(f,$a))return this.buildQueryFromSourceParams([f],a);if(u)return{sql:this.mapInlineParam(f,a),params:[]};let m=["none"];return l&&(m=[l(c.encoder)]),{sql:o(d.value++,f),params:[f],typings:m}}return ys(c,Go)?{sql:o(d.value++,c),params:[c],typings:["none"]}:ys(c,$a.Aliased)&&c.fieldAlias!==void 0?{sql:i(c.fieldAlias),params:[]}:ys(c,bu)?c._.isWith?{sql:i(c._.alias),params:[]}:this.buildQueryFromSourceParams([new ar("("),c._.sql,new ar(") "),new Ho(c._.alias)],a):c3(c)?c.schema?{sql:i(c.schema)+"."+i(c.enumName),params:[]}:{sql:i(c.enumName),params:[]}:u3(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],a):this.buildQueryFromSourceParams([new ar("("),c.getSQL(),new ar(")")],a):u?{sql:this.mapInlineParam(c,a),params:[]}:{sql:o(d.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(s,{escapeString:r}){if(s===null)return"null";if(typeof s=="number"||typeof s=="boolean")return s.toString();if(typeof s=="string")return r(s);if(typeof s=="object"){const a=s.toString();return r(a==="[object Object]"?JSON.stringify(s):a)}throw new Error("Unexpected param value: "+s)}getSQL(){return this}as(s){return s===void 0?this:new $a.Aliased(this,s)}mapWith(s){return this.decoder=typeof s=="function"?{mapFromDriverValue:s}:s,this}inlineParams(){return this.shouldInlineParams=!0,this}if(s){return s?this:void 0}};B($a,vp,"SQL");let cs=$a;var bp;bp=ie;class Ho{constructor(s){B(this,"brand");this.value=s}getSQL(){return new cs([this])}}B(Ho,bp,"Name");const Tj={mapFromDriverValue:t=>t},Aj={mapToDriverValue:t=>t};({...Tj,...Aj});var jp;jp=ie;class ju{constructor(s,r=Aj){B(this,"brand");this.value=s,this.encoder=r}getSQL(){return new cs([this])}}B(ju,jp,"Param");function Pe(t,...s){const r=[];(s.length>0||t.length>0&&t[0]!=="")&&r.push(new ar(t[0]));for(const[a,n]of s.entries())r.push(n,new ar(t[a+1]));return new cs(r)}(t=>{function s(){return new cs([])}t.empty=s;function r(u){return new cs(u)}t.fromList=r;function a(u){return new cs([new ar(u)])}t.raw=a;function n(u,d){const c=[];for(const[f,m]of u.entries())f>0&&d!==void 0&&c.push(d),c.push(m);return new cs(c)}t.join=n;function i(u){return new Ho(u)}t.identifier=i;function o(u){return new Go(u)}t.placeholder=o;function l(u,d){return new ju(u,d)}t.param=l})(Pe||(Pe={}));(t=>{var r;r=ie;const a=class a{constructor(i,o){B(this,"isSelectionField",!1);this.sql=i,this.fieldAlias=o}getSQL(){return this.sql}clone(){return new a(this.sql,this.fieldAlias)}};B(a,r,"SQL.Aliased");let s=a;t.Aliased=s})(cs||(cs={}));var Np;Np=ie;class Go{constructor(s){this.name=s}getSQL(){return new cs([this])}}B(Go,Np,"Placeholder");const Cj=Symbol.for("drizzle:IsDrizzleView");var wp,kp,Sp;Sp=ie,kp=Nn,wp=Cj;class Pj{constructor({name:s,schema:r,selectedFields:a,query:n}){B(this,kp);B(this,wp,!0);this[Nn]={name:s,originalName:s,schema:r,selectedFields:a,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new cs([this])}}B(Pj,Sp,"View");function h3(t){return typeof t=="object"&&t!==null&&Cj in t}In.prototype.getSQL=function(){return new cs([this])};Xs.prototype.getSQL=function(){return new cs([this])};bu.prototype.getSQL=function(){return new cs([this])};function f3(t){return t[Xs.Symbol.Columns]}function p3(t){return t[Nn].selectedFields}function fs(t,s){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:s}}var Tp,Ap;class Zi extends(Ap=ft,Tp=ie,Ap){generatedAlwaysAsIdentity(s){if(s){const{name:r,...a}=s;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:a}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(s){if(s){const{name:r,...a}=s;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:a}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}B(Zi,Tp,"PgIntColumnBaseBuilder");var Cp,Pp;class _j extends(Pp=Zi,Cp=ie,Pp){constructor(s){super(s,"number","PgBigInt53")}build(s){return new Ej(s,this.config)}}B(_j,Cp,"PgBigInt53Builder");var _p,Ep;class Ej extends(Ep=st,_p=ie,Ep){getSQLType(){return"bigint"}mapFromDriverValue(s){return typeof s=="number"?s:Number(s)}}B(Ej,_p,"PgBigInt53");var Dp,Mp;class Dj extends(Mp=Zi,Dp=ie,Mp){constructor(s){super(s,"bigint","PgBigInt64")}build(s){return new Mj(s,this.config)}}B(Dj,Dp,"PgBigInt64Builder");var Rp,Ip;class Mj extends(Ip=st,Rp=ie,Ip){getSQLType(){return"bigint"}mapFromDriverValue(s){return BigInt(s)}}B(Mj,Rp,"PgBigInt64");function x3(t,s){const{name:r,config:a}=fs(t,s);return a.mode==="number"?new _j(r):new Dj(r)}var Fp,Op;class Rj extends(Op=ft,Fp=ie,Op){constructor(s){super(s,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new Ij(s,this.config)}}B(Rj,Fp,"PgBigSerial53Builder");var $p,Lp;class Ij extends(Lp=st,$p=ie,Lp){getSQLType(){return"bigserial"}mapFromDriverValue(s){return typeof s=="number"?s:Number(s)}}B(Ij,$p,"PgBigSerial53");var Vp,zp;class Fj extends(zp=ft,Vp=ie,zp){constructor(s){super(s,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(s){return new Oj(s,this.config)}}B(Fj,Vp,"PgBigSerial64Builder");var Bp,qp;class Oj extends(qp=st,Bp=ie,qp){getSQLType(){return"bigserial"}mapFromDriverValue(s){return BigInt(s)}}B(Oj,Bp,"PgBigSerial64");function g3(t,s){const{name:r,config:a}=fs(t,s);return a.mode==="number"?new Rj(r):new Fj(r)}var Up,Wp;class $j extends(Wp=ft,Up=ie,Wp){constructor(s){super(s,"boolean","PgBoolean")}build(s){return new Lj(s,this.config)}}B($j,Up,"PgBooleanBuilder");var Kp,Hp;class Lj extends(Hp=st,Kp=ie,Hp){getSQLType(){return"boolean"}}B(Lj,Kp,"PgBoolean");function Ye(t){return new $j(t??"")}var Gp,Qp;class Vj extends(Qp=ft,Gp=ie,Qp){constructor(s,r){super(s,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(s){return new zj(s,this.config)}}B(Vj,Gp,"PgCharBuilder");var Xp,Zp;class zj extends(Zp=st,Xp=ie,Zp){constructor(){super(...arguments);B(this,"length",this.config.length);B(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}B(zj,Xp,"PgChar");function y3(t,s={}){const{name:r,config:a}=fs(t,s);return new Vj(r,a)}var Yp,Jp;class Bj extends(Jp=ft,Yp=ie,Jp){constructor(s){super(s,"string","PgCidr")}build(s){return new qj(s,this.config)}}B(Bj,Yp,"PgCidrBuilder");var ex,tx;class qj extends(tx=st,ex=ie,tx){getSQLType(){return"cidr"}}B(qj,ex,"PgCidr");function v3(t){return new Bj(t??"")}var sx,rx;class Uj extends(rx=ft,sx=ie,rx){constructor(s,r,a){super(s,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=a}build(s){return new Wj(s,this.config)}}B(Uj,sx,"PgCustomColumnBuilder");var ax,nx;class Wj extends(nx=st,ax=ie,nx){constructor(r,a){super(r,a);B(this,"sqlName");B(this,"mapTo");B(this,"mapFrom");this.sqlName=a.customTypeParams.dataType(a.fieldConfig),this.mapTo=a.customTypeParams.toDriver,this.mapFrom=a.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(r){return typeof this.mapFrom=="function"?this.mapFrom(r):r}mapToDriverValue(r){return typeof this.mapTo=="function"?this.mapTo(r):r}}B(Wj,ax,"PgCustomColumn");function b3(t){return(s,r)=>{const{name:a,config:n}=fs(s,r);return new Uj(a,n,t)}}var ix,ox;class Wn extends(ox=ft,ix=ie,ox){defaultNow(){return this.default(Pe`now()`)}}B(Wn,ix,"PgDateColumnBaseBuilder");var lx,cx;class Kj extends(cx=Wn,lx=ie,cx){constructor(s){super(s,"date","PgDate")}build(s){return new Hj(s,this.config)}}B(Kj,lx,"PgDateBuilder");var dx,ux;class Hj extends(ux=st,dx=ie,ux){getSQLType(){return"date"}mapFromDriverValue(s){return new Date(s)}mapToDriverValue(s){return s.toISOString()}}B(Hj,dx,"PgDate");var mx,hx;class Gj extends(hx=Wn,mx=ie,hx){constructor(s){super(s,"string","PgDateString")}build(s){return new Qj(s,this.config)}}B(Gj,mx,"PgDateStringBuilder");var fx,px;class Qj extends(px=st,fx=ie,px){getSQLType(){return"date"}}B(Qj,fx,"PgDateString");function Xr(t,s){const{name:r,config:a}=fs(t,s);return a?.mode==="date"?new Kj(r):new Gj(r)}var xx,gx;class Xj extends(gx=ft,xx=ie,gx){constructor(s){super(s,"number","PgDoublePrecision")}build(s){return new Zj(s,this.config)}}B(Xj,xx,"PgDoublePrecisionBuilder");var yx,vx;class Zj extends(vx=st,yx=ie,vx){getSQLType(){return"double precision"}mapFromDriverValue(s){return typeof s=="string"?Number.parseFloat(s):s}}B(Zj,yx,"PgDoublePrecision");function j3(t){return new Xj(t??"")}var bx,jx;class Yj extends(jx=ft,bx=ie,jx){constructor(s){super(s,"string","PgInet")}build(s){return new Jj(s,this.config)}}B(Yj,bx,"PgInetBuilder");var Nx,wx;class Jj extends(wx=st,Nx=ie,wx){getSQLType(){return"inet"}}B(Jj,Nx,"PgInet");function eN(t){return new Yj(t??"")}var kx,Sx;class tN extends(Sx=Zi,kx=ie,Sx){constructor(s){super(s,"number","PgInteger")}build(s){return new sN(s,this.config)}}B(tN,kx,"PgIntegerBuilder");var Tx,Ax;class sN extends(Ax=st,Tx=ie,Ax){getSQLType(){return"integer"}mapFromDriverValue(s){return typeof s=="string"?Number.parseInt(s):s}}B(sN,Tx,"PgInteger");function Fe(t){return new tN(t??"")}var Cx,Px;class rN extends(Px=ft,Cx=ie,Px){constructor(s,r){super(s,"string","PgInterval"),this.config.intervalConfig=r}build(s){return new aN(s,this.config)}}B(rN,Cx,"PgIntervalBuilder");var _x,Ex;class aN extends(Ex=st,_x=ie,Ex){constructor(){super(...arguments);B(this,"fields",this.config.intervalConfig.fields);B(this,"precision",this.config.intervalConfig.precision)}getSQLType(){const r=this.fields?` ${this.fields}`:"",a=this.precision?`(${this.precision})`:"";return`interval${r}${a}`}}B(aN,_x,"PgInterval");function N3(t,s={}){const{name:r,config:a}=fs(t,s);return new rN(r,a)}var Dx,Mx;class nN extends(Mx=ft,Dx=ie,Mx){constructor(s){super(s,"json","PgJson")}build(s){return new iN(s,this.config)}}B(nN,Dx,"PgJsonBuilder");var Rx,Ix;class iN extends(Ix=st,Rx=ie,Ix){constructor(s,r){super(s,r)}getSQLType(){return"json"}mapToDriverValue(s){return JSON.stringify(s)}mapFromDriverValue(s){if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s}}B(iN,Rx,"PgJson");function w3(t){return new nN(t??"")}var Fx,Ox;class oN extends(Ox=ft,Fx=ie,Ox){constructor(s){super(s,"json","PgJsonb")}build(s){return new lN(s,this.config)}}B(oN,Fx,"PgJsonbBuilder");var $x,Lx;class lN extends(Lx=st,$x=ie,Lx){constructor(s,r){super(s,r)}getSQLType(){return"jsonb"}mapToDriverValue(s){return JSON.stringify(s)}mapFromDriverValue(s){if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s}}B(lN,$x,"PgJsonb");function ds(t){return new oN(t??"")}var Vx,zx;class cN extends(zx=ft,Vx=ie,zx){constructor(s){super(s,"array","PgLine")}build(s){return new dN(s,this.config)}}B(cN,Vx,"PgLineBuilder");var Bx,qx;class dN extends(qx=st,Bx=ie,qx){getSQLType(){return"line"}mapFromDriverValue(s){const[r,a,n]=s.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(a),Number.parseFloat(n)]}mapToDriverValue(s){return`{${s[0]},${s[1]},${s[2]}}`}}B(dN,Bx,"PgLine");var Ux,Wx;class uN extends(Wx=ft,Ux=ie,Wx){constructor(s){super(s,"json","PgLineABC")}build(s){return new mN(s,this.config)}}B(uN,Ux,"PgLineABCBuilder");var Kx,Hx;class mN extends(Hx=st,Kx=ie,Hx){getSQLType(){return"line"}mapFromDriverValue(s){const[r,a,n]=s.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(a),c:Number.parseFloat(n)}}mapToDriverValue(s){return`{${s.a},${s.b},${s.c}}`}}B(mN,Kx,"PgLineABC");function k3(t,s){const{name:r,config:a}=fs(t,s);return!a?.mode||a.mode==="tuple"?new cN(r):new uN(r)}var Gx,Qx;class hN extends(Qx=ft,Gx=ie,Qx){constructor(s){super(s,"string","PgMacaddr")}build(s){return new fN(s,this.config)}}B(hN,Gx,"PgMacaddrBuilder");var Xx,Zx;class fN extends(Zx=st,Xx=ie,Zx){getSQLType(){return"macaddr"}}B(fN,Xx,"PgMacaddr");function S3(t){return new hN(t??"")}var Yx,Jx;class pN extends(Jx=ft,Yx=ie,Jx){constructor(s){super(s,"string","PgMacaddr8")}build(s){return new xN(s,this.config)}}B(pN,Yx,"PgMacaddr8Builder");var eg,tg;class xN extends(tg=st,eg=ie,tg){getSQLType(){return"macaddr8"}}B(xN,eg,"PgMacaddr8");function T3(t){return new pN(t??"")}var sg,rg;class gN extends(rg=ft,sg=ie,rg){constructor(s,r,a){super(s,"string","PgNumeric"),this.config.precision=r,this.config.scale=a}build(s){return new yN(s,this.config)}}B(gN,sg,"PgNumericBuilder");var ag,ng;class yN extends(ng=st,ag=ie,ng){constructor(r,a){super(r,a);B(this,"precision");B(this,"scale");this.precision=a.precision,this.scale=a.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}B(yN,ag,"PgNumeric");function vN(t,s){const{name:r,config:a}=fs(t,s);return new gN(r,a?.precision,a?.scale)}const Se=vN;var ig,og;class bN extends(og=ft,ig=ie,og){constructor(s){super(s,"array","PgPointTuple")}build(s){return new jN(s,this.config)}}B(bN,ig,"PgPointTupleBuilder");var lg,cg;class jN extends(cg=st,lg=ie,cg){getSQLType(){return"point"}mapFromDriverValue(s){if(typeof s=="string"){const[r,a]=s.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(a)]}return[s.x,s.y]}mapToDriverValue(s){return`(${s[0]},${s[1]})`}}B(jN,lg,"PgPointTuple");var dg,ug;class NN extends(ug=ft,dg=ie,ug){constructor(s){super(s,"json","PgPointObject")}build(s){return new wN(s,this.config)}}B(NN,dg,"PgPointObjectBuilder");var mg,hg;class wN extends(hg=st,mg=ie,hg){getSQLType(){return"point"}mapFromDriverValue(s){if(typeof s=="string"){const[r,a]=s.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(a)}}return s}mapToDriverValue(s){return`(${s.x},${s.y})`}}B(wN,mg,"PgPointObject");function A3(t,s){const{name:r,config:a}=fs(t,s);return!a?.mode||a.mode==="tuple"?new bN(r):new NN(r)}function C3(t){const s=[];for(let r=0;r<t.length;r+=2)s.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(s)}function af(t,s){const r=new ArrayBuffer(8),a=new DataView(r);for(let n=0;n<8;n++)a.setUint8(n,t[s+n]);return a.getFloat64(0,!0)}function kN(t){const s=C3(t);let r=0;const a=s[r];r+=1;const n=new DataView(s.buffer),i=n.getUint32(r,a===1);if(r+=4,i&536870912&&(n.getUint32(r,a===1),r+=4),(i&65535)===1){const o=af(s,r);r+=8;const l=af(s,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var fg,pg;class SN extends(pg=ft,fg=ie,pg){constructor(s){super(s,"array","PgGeometry")}build(s){return new TN(s,this.config)}}B(SN,fg,"PgGeometryBuilder");var xg,gg;class TN extends(gg=st,xg=ie,gg){getSQLType(){return"geometry(point)"}mapFromDriverValue(s){return kN(s)}mapToDriverValue(s){return`point(${s[0]} ${s[1]})`}}B(TN,xg,"PgGeometry");var yg,vg;class AN extends(vg=ft,yg=ie,vg){constructor(s){super(s,"json","PgGeometryObject")}build(s){return new CN(s,this.config)}}B(AN,yg,"PgGeometryObjectBuilder");var bg,jg;class CN extends(jg=st,bg=ie,jg){getSQLType(){return"geometry(point)"}mapFromDriverValue(s){const r=kN(s);return{x:r[0],y:r[1]}}mapToDriverValue(s){return`point(${s.x} ${s.y})`}}B(CN,bg,"PgGeometryObject");function P3(t,s){const{name:r,config:a}=fs(t,s);return!a?.mode||a.mode==="tuple"?new SN(r):new AN(r)}var Ng,wg;class PN extends(wg=ft,Ng=ie,wg){constructor(s,r){super(s,"number","PgReal"),this.config.length=r}build(s){return new _N(s,this.config)}}B(PN,Ng,"PgRealBuilder");var kg,Sg;class _N extends(Sg=st,kg=ie,Sg){constructor(r,a){super(r,a);B(this,"mapFromDriverValue",r=>typeof r=="string"?Number.parseFloat(r):r)}getSQLType(){return"real"}}B(_N,kg,"PgReal");function _3(t){return new PN(t??"")}var Tg,Ag;class EN extends(Ag=ft,Tg=ie,Ag){constructor(s){super(s,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new DN(s,this.config)}}B(EN,Tg,"PgSerialBuilder");var Cg,Pg;class DN extends(Pg=st,Cg=ie,Pg){getSQLType(){return"serial"}}B(DN,Cg,"PgSerial");function E3(t){return new EN(t??"")}var _g,Eg;class MN extends(Eg=Zi,_g=ie,Eg){constructor(s){super(s,"number","PgSmallInt")}build(s){return new RN(s,this.config)}}B(MN,_g,"PgSmallIntBuilder");var Dg,Mg;class RN extends(Mg=st,Dg=ie,Mg){constructor(){super(...arguments);B(this,"mapFromDriverValue",r=>typeof r=="string"?Number(r):r)}getSQLType(){return"smallint"}}B(RN,Dg,"PgSmallInt");function D3(t){return new MN(t??"")}var Rg,Ig;class IN extends(Ig=ft,Rg=ie,Ig){constructor(s){super(s,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new FN(s,this.config)}}B(IN,Rg,"PgSmallSerialBuilder");var Fg,Og;class FN extends(Og=st,Fg=ie,Og){getSQLType(){return"smallserial"}}B(FN,Fg,"PgSmallSerial");function M3(t){return new IN(t??"")}var $g,Lg;class ON extends(Lg=ft,$g=ie,Lg){constructor(s,r){super(s,"string","PgText"),this.config.enumValues=r.enum}build(s){return new $N(s,this.config)}}B(ON,$g,"PgTextBuilder");var Vg,zg;class $N extends(zg=st,Vg=ie,zg){constructor(){super(...arguments);B(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}B($N,Vg,"PgText");function D(t,s={}){const{name:r,config:a}=fs(t,s);return new ON(r,a)}var Bg,qg;class LN extends(qg=Wn,Bg=ie,qg){constructor(s,r,a){super(s,"string","PgTime"),this.withTimezone=r,this.precision=a,this.config.withTimezone=r,this.config.precision=a}build(s){return new VN(s,this.config)}}B(LN,Bg,"PgTimeBuilder");var Ug,Wg;class VN extends(Wg=st,Ug=ie,Wg){constructor(r,a){super(r,a);B(this,"withTimezone");B(this,"precision");this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}B(VN,Ug,"PgTime");function R3(t,s={}){const{name:r,config:a}=fs(t,s);return new LN(r,a.withTimezone??!1,a.precision)}var Kg,Hg;class zN extends(Hg=Wn,Kg=ie,Hg){constructor(s,r,a){super(s,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=a}build(s){return new BN(s,this.config)}}B(zN,Kg,"PgTimestampBuilder");var Gg,Qg;class BN extends(Qg=st,Gg=ie,Qg){constructor(r,a){super(r,a);B(this,"withTimezone");B(this,"precision");B(this,"mapFromDriverValue",r=>new Date(this.withTimezone?r:r+"+0000"));B(this,"mapToDriverValue",r=>r.toISOString());this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}B(BN,Gg,"PgTimestamp");var Xg,Zg;class qN extends(Zg=Wn,Xg=ie,Zg){constructor(s,r,a){super(s,"string","PgTimestampString"),this.config.withTimezone=r,this.config.precision=a}build(s){return new UN(s,this.config)}}B(qN,Xg,"PgTimestampStringBuilder");var Yg,Jg;class UN extends(Jg=st,Yg=ie,Jg){constructor(r,a){super(r,a);B(this,"withTimezone");B(this,"precision");this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}B(UN,Yg,"PgTimestampString");function J(t,s={}){const{name:r,config:a}=fs(t,s);return a?.mode==="string"?new qN(r,a.withTimezone??!1,a.precision):new zN(r,a?.withTimezone??!1,a?.precision)}var e0,t0;class WN extends(t0=ft,e0=ie,t0){constructor(s){super(s,"string","PgUUID")}defaultRandom(){return this.default(Pe`gen_random_uuid()`)}build(s){return new KN(s,this.config)}}B(WN,e0,"PgUUIDBuilder");var s0,r0;class KN extends(r0=st,s0=ie,r0){getSQLType(){return"uuid"}}B(KN,s0,"PgUUID");function HN(t){return new WN(t??"")}var a0,n0;class GN extends(n0=ft,a0=ie,n0){constructor(s,r){super(s,"string","PgVarchar"),this.config.length=r.length,this.config.enumValues=r.enum}build(s){return new QN(s,this.config)}}B(GN,a0,"PgVarcharBuilder");var i0,o0;class QN extends(o0=st,i0=ie,o0){constructor(){super(...arguments);B(this,"length",this.config.length);B(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}B(QN,i0,"PgVarchar");function Q(t,s={}){const{name:r,config:a}=fs(t,s);return new GN(r,a)}var l0,c0;class XN extends(c0=ft,l0=ie,c0){constructor(s,r){super(s,"string","PgBinaryVector"),this.config.dimensions=r.dimensions}build(s){return new ZN(s,this.config)}}B(XN,l0,"PgBinaryVectorBuilder");var d0,u0;class ZN extends(u0=st,d0=ie,u0){constructor(){super(...arguments);B(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}B(ZN,d0,"PgBinaryVector");function I3(t,s){const{name:r,config:a}=fs(t,s);return new XN(r,a)}var m0,h0;class YN extends(h0=ft,m0=ie,h0){constructor(s,r){super(s,"array","PgHalfVector"),this.config.dimensions=r.dimensions}build(s){return new JN(s,this.config)}}B(YN,m0,"PgHalfVectorBuilder");var f0,p0;class JN extends(p0=st,f0=ie,p0){constructor(){super(...arguments);B(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}B(JN,f0,"PgHalfVector");function F3(t,s){const{name:r,config:a}=fs(t,s);return new YN(r,a)}var x0,g0;class ew extends(g0=ft,x0=ie,g0){constructor(s,r){super(s,"string","PgSparseVector"),this.config.dimensions=r.dimensions}build(s){return new tw(s,this.config)}}B(ew,x0,"PgSparseVectorBuilder");var y0,v0;class tw extends(v0=st,y0=ie,v0){constructor(){super(...arguments);B(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}B(tw,y0,"PgSparseVector");function O3(t,s){const{name:r,config:a}=fs(t,s);return new ew(r,a)}var b0,j0;class sw extends(j0=ft,b0=ie,j0){constructor(s,r){super(s,"array","PgVector"),this.config.dimensions=r.dimensions}build(s){return new rw(s,this.config)}}B(sw,b0,"PgVectorBuilder");var N0,w0;class rw extends(w0=st,N0=ie,w0){constructor(){super(...arguments);B(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}B(rw,N0,"PgVector");function $3(t,s){const{name:r,config:a}=fs(t,s);return new sw(r,a)}function L3(){return{bigint:x3,bigserial:g3,boolean:Ye,char:y3,cidr:v3,customType:b3,date:Xr,doublePrecision:j3,inet:eN,integer:Fe,interval:N3,json:w3,jsonb:ds,line:k3,macaddr:S3,macaddr8:T3,numeric:vN,point:A3,geometry:P3,real:_3,serial:E3,smallint:D3,smallserial:M3,text:D,time:R3,timestamp:J,uuid:HN,varchar:Q,bit:I3,halfvec:F3,sparsevec:O3,vector:$3}}const Jc=Symbol.for("drizzle:PgInlineForeignKeys"),nf=Symbol.for("drizzle:EnableRLS");var k0,S0,T0,A0,C0;class pi extends(C0=Xs,A0=ie,T0=Jc,S0=nf,k0=Xs.Symbol.ExtraConfigBuilder,C0){constructor(){super(...arguments);B(this,T0,[]);B(this,S0,!1);B(this,k0)}}B(pi,A0,"PgTable"),B(pi,"Symbol",Object.assign({},Xs.Symbol,{InlineForeignKeys:Jc,EnableRLS:nf}));function V3(t,s,r,a,n=t){const i=new pi(t,a,n),o=typeof s=="function"?s(L3()):s,l=Object.fromEntries(Object.entries(o).map(([c,f])=>{const m=f;m.setName(c);const y=m.build(i);return i[Jc].push(...m.buildForeignKeys(y,i)),[c,y]})),u=Object.fromEntries(Object.entries(o).map(([c,f])=>{const m=f;m.setName(c);const y=m.buildExtraConfigColumn(i);return[c,y]})),d=Object.assign(i,l);return d[Xs.Symbol.Columns]=l,d[Xs.Symbol.ExtraConfigColumns]=u,r&&(d[pi.Symbol.ExtraConfigBuilder]=r),Object.assign(d,{enableRLS:()=>(d[pi.Symbol.EnableRLS]=!0,d)})}const Ke=(t,s,r)=>V3(t,s,r,void 0),zt={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function Jt(t,s){return s.includes(t.columnType)}function z3(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}const B3=kr([Qe(),Ka(),mu(),Sb()]),q3=kr([B3,Ab(Wo()),Tb(Wo())]),U3=uu(t=>t instanceof Buffer);function aw(t,s){const r=s?.zodInstance??fE,a=s?.coerce??{};let n;return z3(t)&&(n=t.enumValues.length?r.enum(t.enumValues):r.string()),n||(Jt(t,["PgGeometry","PgPointTuple"])?n=r.tuple([r.number(),r.number()]):Jt(t,["PgGeometryObject","PgPointObject"])?n=r.object({x:r.number(),y:r.number()}):Jt(t,["PgHalfVector","PgVector"])?(n=r.array(r.number()),n=t.dimensions?n.length(t.dimensions):n):Jt(t,["PgLine"])?n=r.tuple([r.number(),r.number(),r.number()]):Jt(t,["PgLineABC"])?n=r.object({a:r.number(),b:r.number(),c:r.number()}):Jt(t,["PgArray"])?(n=r.array(aw(t.baseColumn,r)),n=t.size?n.length(t.size):n):t.dataType==="array"?n=r.array(r.any()):t.dataType==="number"?n=W3(t,r,a):t.dataType==="bigint"?n=K3(t,r,a):t.dataType==="boolean"?n=a===!0||a.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?n=a===!0||a.date?r.coerce.date():r.date():t.dataType==="string"?n=H3(t,r,a):t.dataType==="json"?n=q3:t.dataType==="custom"?n=r.any():t.dataType==="buffer"&&(n=U3)),n||(n=r.any()),n}function W3(t,s,r){let a=t.getSQLType().includes("unsigned"),n,i,o=!1;Jt(t,["MySqlTinyInt","SingleStoreTinyInt"])?(n=a?0:zt.INT8_MIN,i=a?zt.INT8_UNSIGNED_MAX:zt.INT8_MAX,o=!0):Jt(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(n=a?0:zt.INT16_MIN,i=a?zt.INT16_UNSIGNED_MAX:zt.INT16_MAX,o=!0):Jt(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(n=a?0:zt.INT24_MIN,i=a?zt.INT24_UNSIGNED_MAX:zt.INT24_MAX,o=Jt(t,["MySqlMediumInt","SingleStoreMediumInt"])):Jt(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(n=a?0:zt.INT32_MIN,i=a?zt.INT32_UNSIGNED_MAX:zt.INT32_MAX,o=!0):Jt(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(n=a?0:zt.INT48_MIN,i=a?zt.INT48_UNSIGNED_MAX:zt.INT48_MAX):Jt(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(a=a||Jt(t,["MySqlSerial","SingleStoreSerial"]),n=a?0:Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=!0):Jt(t,["MySqlYear","SingleStoreYear"])?(n=1901,i=2155,o=!0):(n=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER);let l=r===!0||r?.number?s.coerce.number():s.number();return l=l.min(n).max(i),o?l.int():l}function K3(t,s,r){const a=t.getSQLType().includes("unsigned"),n=a?0n:zt.INT64_MIN,i=a?zt.INT64_UNSIGNED_MAX:zt.INT64_MAX;return(r===!0||r?.bigint?s.coerce.bigint():s.bigint()).min(n).max(i)}function H3(t,s,r){if(Jt(t,["PgUUID"]))return s.string().uuid();let a,n,i=!1;Jt(t,["PgVarchar","SQLiteText"])?a=t.length:Jt(t,["MySqlVarChar","SingleStoreVarChar"])?a=t.length??zt.INT16_UNSIGNED_MAX:Jt(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?a=zt.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?a=zt.INT24_UNSIGNED_MAX:t.textType==="text"?a=zt.INT16_UNSIGNED_MAX:a=zt.INT8_UNSIGNED_MAX),Jt(t,["PgChar","MySqlChar","SingleStoreChar"])&&(a=t.length,i=!0),Jt(t,["PgBinaryVector"])&&(n=/^[01]+$/,a=t.dimensions);let o=r===!0||r?.string?s.coerce.string():s.string();return o=n?o.regex(n):o,a&&i?o.length(a):a?o.max(a):o}function nw(t){return Sj(t)?f3(t):p3(t)}function iw(t,s,r,a){const n={};for(const[i,o]of Object.entries(t)){if(!ys(o,In)&&!ys(o,cs)&&!ys(o,cs.Aliased)&&typeof o=="object"){const f=Sj(o)||h3(o)?nw(o):o;n[i]=iw(f,s[i]??{},r,a);continue}const l=s[i];if(l!==void 0&&typeof l!="function"){n[i]=l;continue}const u=ys(o,In)?o:void 0,d=u?aw(u,a):Wo(),c=typeof l=="function"?l(d):d;r.never(u)||(n[i]=c,u&&(r.nullable(u)&&(n[i]=n[i].nullable()),r.optional(u)&&(n[i]=n[i].optional())))}return rn(n)}const G3={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull},Le=(t,s)=>{const r=nw(t);return iw(r,{},G3)},At=Ke("users",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),email:D("email").notNull().unique(),password:D("password").notNull(),firstName:D("first_name"),lastName:D("last_name"),role:D("role").notNull().default("admin"),isActive:Ye("is_active").default(!0).notNull(),lastLogin:J("last_login"),totpSecret:D("totp_secret"),mfaEnabled:Ye("mfa_enabled").default(!1).notNull(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),Q3=Ke("auth_user_sessions",{id:HN("id").primaryKey().default(Pe`gen_random_uuid()`),userId:Q("user_id").notNull().references(()=>At.id),sessionToken:Q("session_token"),deviceFingerprint:Q("device_fingerprint"),userAgent:D("user_agent"),ipAddress:eN("ip_address"),locationData:ds("location_data"),isTrustedDevice:Ye("is_trusted_device").default(!1).notNull(),expiresAt:J("expires_at").notNull(),lastActivity:J("last_activity").defaultNow(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull(),deviceId:Q("device_id"),deviceName:Q("device_name"),browserName:Q("browser_name"),browserVersion:Q("browser_version"),osName:Q("os_name"),osVersion:Q("os_version"),country:Q("country"),city:Q("city"),timezone:Q("timezone"),loginMethod:Q("login_method"),securityFlags:ds("security_flags"),deviceType:Q("device_type"),refreshTokenHash:D("refresh_token_hash"),accessTokenHash:D("access_token_hash"),isRevoked:Ye("is_revoked").default(!1).notNull(),revokedAt:J("revoked_at",{withTimezone:!0}),revokedReason:Q("revoked_reason")}),Xt=Ke("projects",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),name:D("name").notNull(),status:D("status").notNull().default("active"),imageUrl:D("image_url"),createdAt:J("created_at").defaultNow().notNull()}),Kn=Ke("workers",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),name:D("name").notNull(),type:D("type").notNull(),dailyWage:Se("daily_wage",{precision:10,scale:2}).notNull(),isActive:Ye("is_active").default(!0).notNull(),createdAt:J("created_at").defaultNow().notNull()}),X3=Ke("fund_transfers",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),projectId:Q("project_id").notNull().references(()=>Xt.id),amount:Se("amount",{precision:10,scale:2}).notNull(),senderName:D("sender_name"),transferNumber:D("transfer_number").unique(),transferType:D("transfer_type").notNull(),transferDate:J("transfer_date").notNull(),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),Z3=Ke("worker_attendance",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),projectId:Q("project_id").notNull().references(()=>Xt.id),workerId:Q("worker_id").notNull().references(()=>Kn.id),attendanceDate:D("attendance_date").notNull(),date:D("date"),startTime:D("start_time"),endTime:D("end_time"),workDescription:D("work_description"),isPresent:Ye("is_present"),hoursWorked:Se("hours_worked",{precision:5,scale:2}).default("8.00"),overtime:Se("overtime",{precision:5,scale:2}).default("0.00"),overtimeRate:Se("overtime_rate",{precision:10,scale:2}).default("0.00"),workDays:Se("work_days",{precision:3,scale:2}).default("1.00"),dailyWage:Se("daily_wage",{precision:10,scale:2}).notNull(),actualWage:Se("actual_wage",{precision:10,scale:2}),totalPay:Se("total_pay",{precision:10,scale:2}).notNull(),paidAmount:Se("paid_amount",{precision:10,scale:2}).default("0"),remainingAmount:Se("remaining_amount",{precision:10,scale:2}).default("0"),paymentType:D("payment_type").default("partial"),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()},t=>({uniqueWorkerDate:Pe`UNIQUE (worker_id, attendance_date, project_id)`})),Sl=Ke("suppliers",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),name:D("name").notNull().unique(),contactPerson:D("contact_person"),phone:D("phone"),address:D("address"),paymentTerms:D("payment_terms").default("نقد"),totalDebt:Se("total_debt",{precision:12,scale:2}).default("0").notNull(),isActive:Ye("is_active").default(!0).notNull(),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),Y3=Ke("materials",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),name:D("name").notNull(),category:D("category").notNull(),unit:D("unit").notNull(),createdAt:J("created_at").defaultNow().notNull()}),Nu=Ke("material_purchases",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),projectId:Q("project_id").notNull().references(()=>Xt.id),supplierId:Q("supplier_id").references(()=>Sl.id),materialName:D("material_name").notNull(),materialCategory:D("material_category"),materialUnit:D("material_unit"),quantity:Se("quantity",{precision:10,scale:3}).notNull(),unit:D("unit").notNull(),unitPrice:Se("unit_price",{precision:10,scale:2}).notNull(),totalAmount:Se("total_amount",{precision:10,scale:2}).notNull(),purchaseType:D("purchase_type").notNull().default("نقد"),paidAmount:Se("paid_amount",{precision:10,scale:2}).default("0").notNull(),remainingAmount:Se("remaining_amount",{precision:10,scale:2}).default("0").notNull(),supplierName:D("supplier_name"),receiptNumber:D("receipt_number"),invoiceNumber:D("invoice_number"),invoiceDate:D("invoice_date"),dueDate:D("due_date"),invoicePhoto:D("invoice_photo"),notes:D("notes"),purchaseDate:D("purchase_date").notNull(),createdAt:J("created_at").defaultNow().notNull()}),J3=Ke("supplier_payments",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),supplierId:Q("supplier_id").notNull().references(()=>Sl.id),projectId:Q("project_id").notNull().references(()=>Xt.id),purchaseId:Q("purchase_id").references(()=>Nu.id),amount:Se("amount",{precision:10,scale:2}).notNull(),paymentMethod:D("payment_method").notNull().default("نقد"),paymentDate:D("payment_date").notNull(),referenceNumber:D("reference_number"),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),e5=Ke("transportation_expenses",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),projectId:Q("project_id").notNull().references(()=>Xt.id),workerId:Q("worker_id").references(()=>Kn.id),amount:Se("amount",{precision:10,scale:2}).notNull(),description:D("description").notNull(),date:D("date").notNull(),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),t5=Ke("worker_transfers",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),workerId:Q("worker_id").notNull().references(()=>Kn.id),projectId:Q("project_id").notNull().references(()=>Xt.id),amount:Se("amount",{precision:10,scale:2}).notNull(),transferNumber:D("transfer_number"),senderName:D("sender_name"),recipientName:D("recipient_name").notNull(),recipientPhone:D("recipient_phone"),transferMethod:D("transfer_method").notNull(),transferDate:D("transfer_date").notNull(),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),s5=Ke("worker_balances",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),workerId:Q("worker_id").notNull().references(()=>Kn.id),projectId:Q("project_id").notNull().references(()=>Xt.id),totalEarned:Se("total_earned",{precision:10,scale:2}).default("0").notNull(),totalPaid:Se("total_paid",{precision:10,scale:2}).default("0").notNull(),totalTransferred:Se("total_transferred",{precision:10,scale:2}).default("0").notNull(),currentBalance:Se("current_balance",{precision:10,scale:2}).default("0").notNull(),lastUpdated:J("last_updated").defaultNow().notNull(),createdAt:J("created_at").defaultNow().notNull()}),r5=Ke("daily_expense_summaries",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),projectId:Q("project_id").notNull().references(()=>Xt.id),date:D("date").notNull(),carriedForwardAmount:Se("carried_forward_amount",{precision:10,scale:2}).default("0").notNull(),totalFundTransfers:Se("total_fund_transfers",{precision:10,scale:2}).default("0").notNull(),totalWorkerWages:Se("total_worker_wages",{precision:10,scale:2}).default("0").notNull(),totalMaterialCosts:Se("total_material_costs",{precision:10,scale:2}).default("0").notNull(),totalTransportationCosts:Se("total_transportation_costs",{precision:10,scale:2}).default("0").notNull(),totalWorkerTransfers:Se("total_worker_transfers",{precision:10,scale:2}).default("0").notNull(),totalWorkerMiscExpenses:Se("total_worker_misc_expenses",{precision:10,scale:2}).default("0").notNull(),totalIncome:Se("total_income",{precision:10,scale:2}).notNull(),totalExpenses:Se("total_expenses",{precision:10,scale:2}).notNull(),remainingBalance:Se("remaining_balance",{precision:10,scale:2}).notNull(),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),a5=Ke("worker_types",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),name:D("name").notNull().unique(),usageCount:Fe("usage_count").default(1).notNull(),lastUsed:J("last_used").defaultNow().notNull(),createdAt:J("created_at").defaultNow().notNull()}),n5=Ke("autocomplete_data",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),category:D("category").notNull(),value:D("value").notNull(),usageCount:Fe("usage_count").default(1).notNull(),lastUsed:J("last_used").defaultNow().notNull(),createdAt:J("created_at").defaultNow().notNull()}),i5=Ke("worker_misc_expenses",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),projectId:Q("project_id").notNull().references(()=>Xt.id,{onDelete:"cascade"}),amount:Se("amount",{precision:10,scale:2}).notNull(),description:D("description").notNull(),date:D("date").notNull(),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),o5=Ke("print_settings",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),reportType:D("report_type").notNull().default("worker_statement"),name:D("name").notNull(),pageSize:D("page_size").notNull().default("A4"),pageOrientation:D("page_orientation").notNull().default("portrait"),marginTop:Se("margin_top",{precision:5,scale:2}).notNull().default("15.00"),marginBottom:Se("margin_bottom",{precision:5,scale:2}).notNull().default("15.00"),marginLeft:Se("margin_left",{precision:5,scale:2}).notNull().default("15.00"),marginRight:Se("margin_right",{precision:5,scale:2}).notNull().default("15.00"),fontFamily:D("font_family").notNull().default("Arial"),fontSize:Fe("font_size").notNull().default(12),headerFontSize:Fe("header_font_size").notNull().default(16),tableFontSize:Fe("table_font_size").notNull().default(10),headerBackgroundColor:D("header_background_color").notNull().default("#1e40af"),headerTextColor:D("header_text_color").notNull().default("#ffffff"),tableHeaderColor:D("table_header_color").notNull().default("#1e40af"),tableRowEvenColor:D("table_row_even_color").notNull().default("#ffffff"),tableRowOddColor:D("table_row_odd_color").notNull().default("#f9fafb"),tableBorderColor:D("table_border_color").notNull().default("#000000"),tableBorderWidth:Fe("table_border_width").notNull().default(1),tableCellPadding:Fe("table_cell_padding").notNull().default(3),tableColumnWidths:D("table_column_widths").notNull().default("[8,12,10,30,12,15,15,12]"),showHeader:Ye("show_header").notNull().default(!0),showLogo:Ye("show_logo").notNull().default(!0),showProjectInfo:Ye("show_project_info").notNull().default(!0),showWorkerInfo:Ye("show_worker_info").notNull().default(!0),showAttendanceTable:Ye("show_attendance_table").notNull().default(!0),showTransfersTable:Ye("show_transfers_table").notNull().default(!0),showSummary:Ye("show_summary").notNull().default(!0),showSignatures:Ye("show_signatures").notNull().default(!0),isDefault:Ye("is_default").notNull().default(!1),isActive:Ye("is_active").notNull().default(!0),userId:D("user_id"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),l5=Ke("project_fund_transfers",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),fromProjectId:Q("from_project_id").notNull().references(()=>Xt.id),toProjectId:Q("to_project_id").notNull().references(()=>Xt.id),amount:Se("amount",{precision:10,scale:2}).notNull(),description:D("description"),transferReason:D("transfer_reason"),transferDate:D("transfer_date").notNull(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),of=Le(Xt).omit({id:!0,createdAt:!0});Le(Kn).omit({id:!0,createdAt:!0});Le(X3).omit({id:!0,createdAt:!0}).extend({amount:ut.string(),transferDate:ut.date()});Le(Z3).omit({id:!0,createdAt:!0}).extend({attendanceDate:Qe(),workDays:Ka().min(.1).max(2).default(1),dailyWage:ut.string(),actualWage:ut.string().optional(),totalPay:ut.string(),paidAmount:ut.string().optional(),remainingAmount:ut.string().optional(),paymentType:Qe().optional().default("partial"),hoursWorked:ut.string().optional(),overtime:ut.string().optional(),overtimeRate:ut.string().optional(),notes:Qe().optional(),startTime:Qe().optional().refine(t=>t?/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(t):!0,"تنسيق الوقت يجب أن يكون HH:MM"),endTime:Qe().optional().refine(t=>t?/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(t):!0,"تنسيق الوقت يجب أن يكون HH:MM")}).refine(t=>{if(t.startTime&&t.endTime){const s=parseInt(t.startTime.split(":")[0])*60+parseInt(t.startTime.split(":")[1]),r=parseInt(t.endTime.split(":")[0])*60+parseInt(t.endTime.split(":")[1]);return s<r||r<s}return!0},{message:"وقت البداية يجب أن يكون قبل وقت النهاية (للورديات العادية)",path:["endTime"]});Le(Y3).omit({id:!0,createdAt:!0});Le(Nu).omit({id:!0,createdAt:!0}).extend({quantity:ut.string(),unit:Qe().min(1,"وحدة القياس مطلوبة").default("كيس"),unitPrice:ut.string(),totalAmount:ut.string(),purchaseType:Qe().default("نقد"),paidAmount:ut.string().default("0"),remainingAmount:ut.string().default("0")});Le(e5).omit({id:!0,createdAt:!0}).extend({amount:ut.string()});Le(t5).omit({id:!0,createdAt:!0}).extend({amount:ut.string()});Le(s5).omit({id:!0,createdAt:!0,lastUpdated:!0}).extend({totalEarned:ut.string().optional(),totalPaid:ut.string().optional(),totalTransferred:ut.string().optional(),currentBalance:ut.string().optional()});const c5=Le(l5).omit({id:!0,createdAt:!0}).extend({amount:ut.string()});Le(r5).omit({id:!0,createdAt:!0,updatedAt:!0});Le(a5).omit({id:!0,createdAt:!0,lastUsed:!0});Le(n5).omit({id:!0,createdAt:!0,lastUsed:!0});Le(i5).omit({id:!0,createdAt:!0}).extend({amount:ut.string()});Le(At).omit({id:!0,createdAt:!0,updatedAt:!0,lastLogin:!0}).extend({email:Qe().min(5,"البريد الإلكتروني قصير جداً").max(255,"البريد الإلكتروني طويل جداً").email("تنسيق البريد الإلكتروني غير صحيح").regex(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,"البريد الإلكتروني يحتوي على أحرف غير مسموحة"),password:Qe().min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل").max(128,"كلمة المرور طويلة جداً").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).*$/,"كلمة المرور يجب أن تحتوي على حرف كبير وصغير ورقم ورمز خاص"),firstName:Qe().min(1,"الاسم الأول مطلوب").max(100,"الاسم الأول طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-']+$/,"الاسم يحتوي على أحرف غير مسموحة"),lastName:Qe().max(100,"اسم العائلة طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-']*$/,"اسم العائلة يحتوي على أحرف غير مسموحة").optional(),role:Nl(["admin","manager","user"],{errorMap:()=>({message:"الدور يجب أن يكون admin أو manager أو user"})})});Le(Kn).omit({id:!0,createdAt:!0}).extend({name:Qe().min(2,"اسم العامل قصير جداً").max(100,"اسم العامل طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-']+$/,"اسم العامل يحتوي على أحرف غير مسموحة"),type:Nl(["معلم","عامل","مساعد","سائق","حارس"],{errorMap:()=>({message:"نوع العامل غير صحيح"})}),dailyWage:Qe().regex(/^\d+(\.\d{1,2})?$/,"الأجر اليومي يجب أن يكون رقماً صحيحاً").refine(t=>parseFloat(t)>0&&parseFloat(t)<=1e4,{message:"الأجر اليومي يجب أن يكون بين 1 و 10000"})});const d5=Le(Xt).omit({id:!0,createdAt:!0}).extend({name:Qe().min(2,"اسم المشروع قصير جداً").max(200,"اسم المشروع طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-_().]+$/,"اسم المشروع يحتوي على أحرف غير مسموحة"),status:Nl(["active","completed","paused"],{errorMap:()=>({message:"حالة المشروع يجب أن تكون active أو completed أو paused"})}),imageUrl:Qe().url("رابط الصورة غير صحيح").optional().or(Cb(""))});d5.partial().omit({}).refine(t=>Object.keys(t).length>0,{message:"يجب توفير حقل واحد على الأقل للتحديث"});Qe().regex(/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"معرف UUID غير صحيح").or(Qe().regex(/^[a-z0-9-]{8,50}$/,"معرف غير صحيح"));Le(Sl).omit({id:!0,createdAt:!0});Le(J3).omit({id:!0,createdAt:!0}).extend({amount:ut.string()});Le(o5).omit({id:!0,createdAt:!0,updatedAt:!0});Le(Q3).omit({id:!0,createdAt:!0,updatedAt:!0,lastActivity:!0});const u5=Ke("report_templates",{id:D("id").primaryKey().default(Pe`gen_random_uuid()`),templateName:D("template_name").notNull().default("default"),headerTitle:D("header_title").notNull().default("نظام إدارة مشاريع البناء"),headerSubtitle:D("header_subtitle").default("تقرير مالي"),companyName:D("company_name").notNull().default("شركة البناء والتطوير"),companyAddress:D("company_address").default("صنعاء - اليمن"),companyPhone:D("company_phone").default("+967 1 234567"),companyEmail:D("company_email").default("info@company.com"),footerText:D("footer_text").default("تم إنشاء هذا التقرير بواسطة نظام إدارة المشاريع"),footerContact:D("footer_contact").default("للاستفسار: info@company.com | +967 1 234567"),primaryColor:D("primary_color").notNull().default("#1f2937"),secondaryColor:D("secondary_color").notNull().default("#3b82f6"),accentColor:D("accent_color").notNull().default("#10b981"),textColor:D("text_color").notNull().default("#1f2937"),backgroundColor:D("background_color").notNull().default("#ffffff"),fontSize:Fe("font_size").notNull().default(11),fontFamily:D("font_family").notNull().default("Arial"),logoUrl:D("logo_url"),pageOrientation:D("page_orientation").notNull().default("portrait"),pageSize:D("page_size").notNull().default("A4"),margins:ds("margins").default({top:1,bottom:1,left:.75,right:.75}),showHeader:Ye("show_header").notNull().default(!0),showFooter:Ye("show_footer").notNull().default(!0),showLogo:Ye("show_logo").notNull().default(!0),showDate:Ye("show_date").notNull().default(!0),showPageNumbers:Ye("show_page_numbers").notNull().default(!0),isActive:Ye("is_active").notNull().default(!0),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()});Le(u5).omit({id:!0,createdAt:!0,updatedAt:!0});const Tl=Ke("tool_categories",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),name:D("name").notNull().unique(),description:D("description"),icon:D("icon"),color:D("color").default("#3b82f6"),parentId:Q("parent_id").references(()=>Tl.id,{onDelete:"cascade"}),isActive:Ye("is_active").default(!0).notNull(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),jr=Ke("tools",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),sku:D("sku").unique(),name:D("name").notNull(),description:D("description"),categoryId:Q("category_id").references(()=>Tl.id),projectId:Q("project_id").references(()=>Xt.id),unit:D("unit").notNull().default("قطعة"),isTool:Ye("is_tool").default(!0).notNull(),isConsumable:Ye("is_consumable").default(!1).notNull(),isSerial:Ye("is_serial").default(!1).notNull(),purchasePrice:Se("purchase_price",{precision:12,scale:2}),currentValue:Se("current_value",{precision:12,scale:2}),depreciationRate:Se("depreciation_rate",{precision:5,scale:2}),purchaseDate:Xr("purchase_date"),supplierId:Q("supplier_id").references(()=>Sl.id),warrantyExpiry:Xr("warranty_expiry"),maintenanceInterval:Fe("maintenance_interval"),lastMaintenanceDate:Xr("last_maintenance_date"),nextMaintenanceDate:Xr("next_maintenance_date"),status:D("status").notNull().default("available"),condition:D("condition").notNull().default("excellent"),locationType:D("location_type"),locationId:D("location_id"),serialNumber:D("serial_number"),barcode:D("barcode"),qrCode:D("qr_code"),imageUrls:D("image_urls").array(),notes:D("notes"),specifications:ds("specifications"),totalUsageHours:Se("total_usage_hours",{precision:10,scale:2}).default("0"),usageCount:Fe("usage_count").default(0),aiRating:Se("ai_rating",{precision:3,scale:2}),aiNotes:D("ai_notes"),isActive:Ye("is_active").default(!0).notNull(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),m5=Ke("tool_stock",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),locationType:D("location_type").notNull(),locationId:Q("location_id"),locationName:D("location_name"),quantity:Fe("quantity").notNull().default(0),availableQuantity:Fe("available_quantity").notNull().default(0),reservedQuantity:Fe("reserved_quantity").notNull().default(0),notes:D("notes"),lastVerifiedAt:J("last_verified_at"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()},t=>({uniqueToolLocation:Pe`UNIQUE (tool_id, location_type, location_id)`})),h5=Ke("tool_movements",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),movementType:D("movement_type").notNull(),quantity:Fe("quantity").notNull(),fromType:D("from_type"),fromId:Q("from_id"),toType:D("to_type"),toId:Q("to_id"),projectId:Q("project_id").references(()=>Xt.id),reason:D("reason"),notes:D("notes"),referenceNumber:D("reference_number"),performedBy:D("performed_by").notNull(),performedAt:J("performed_at").defaultNow().notNull()}),f5=Ke("tool_maintenance_logs",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),maintenanceType:D("maintenance_type").notNull(),priority:D("priority").notNull().default("medium"),title:D("title").notNull(),description:D("description"),workPerformed:D("work_performed"),scheduledDate:J("scheduled_date"),startedAt:J("started_at"),completedAt:J("completed_at"),nextDueDate:J("next_due_date"),status:D("status").notNull().default("scheduled"),laborCost:Se("labor_cost",{precision:12,scale:2}).default("0"),partsCost:Se("parts_cost",{precision:12,scale:2}).default("0"),totalCost:Se("total_cost",{precision:12,scale:2}).default("0"),performedBy:Q("performed_by").references(()=>At.id),assignedTo:Q("assigned_to").references(()=>At.id),conditionBefore:D("condition_before"),conditionAfter:D("condition_after"),imageUrls:D("image_urls").array(),documentUrls:D("document_urls").array(),notes:D("notes"),issues:D("issues"),recommendations:D("recommendations"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),p5=Ke("tool_usage_analytics",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),projectId:Q("project_id").references(()=>Xt.id),analysisDate:D("analysis_date").notNull(),analysisWeek:D("analysis_week"),analysisMonth:D("analysis_month"),usageHours:Se("usage_hours",{precision:10,scale:2}).default("0"),transferCount:Fe("transfer_count").default(0),maintenanceCount:Fe("maintenance_count").default(0),operationalCost:Se("operational_cost",{precision:12,scale:2}).default("0"),maintenanceCost:Se("maintenance_cost",{precision:12,scale:2}).default("0"),utilizationRate:Se("utilization_rate",{precision:5,scale:2}),efficiencyScore:Se("efficiency_score",{precision:5,scale:2}),predictedUsage:Se("predicted_usage",{precision:10,scale:2}),createdAt:J("created_at").defaultNow().notNull()}),x5=Ke("tool_purchase_items",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),materialPurchaseId:Q("material_purchase_id").notNull().references(()=>Nu.id,{onDelete:"cascade"}),itemName:D("item_name").notNull(),itemDescription:D("item_description"),quantity:Fe("quantity").notNull().default(1),unitPrice:Se("unit_price",{precision:12,scale:2}).notNull(),totalPrice:Se("total_price",{precision:12,scale:2}).notNull(),isToolItem:Ye("is_tool_item").default(!1).notNull(),suggestedCategoryId:Q("suggested_category_id").references(()=>Tl.id),conversionStatus:D("conversion_status").notNull().default("pending"),toolId:Q("tool_id").references(()=>jr.id),aiConfidence:Se("ai_confidence",{precision:5,scale:2}),aiSuggestions:ds("ai_suggestions"),notes:D("notes"),convertedAt:J("converted_at"),convertedBy:Q("converted_by").references(()=>At.id),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),ow=Ke("maintenance_schedules",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),scheduleType:D("schedule_type").notNull(),intervalDays:Fe("interval_days"),intervalWeeks:Fe("interval_weeks"),intervalMonths:Fe("interval_months"),usageHoursInterval:Se("usage_hours_interval",{precision:10,scale:2}),usageCountInterval:Fe("usage_count_interval"),isActive:Ye("is_active").default(!0).notNull(),lastMaintenanceDate:J("last_maintenance_date"),nextDueDate:J("next_due_date").notNull(),maintenanceType:D("maintenance_type").notNull().default("preventive"),priority:D("priority").notNull().default("medium"),estimatedDuration:Fe("estimated_duration"),estimatedCost:Se("estimated_cost",{precision:12,scale:2}),assignedTo:Q("assigned_to").references(()=>At.id),createdBy:Q("created_by").references(()=>At.id),title:D("title").notNull(),description:D("description"),checklistItems:ds("checklist_items"),enableNotifications:Ye("enable_notifications").default(!0).notNull(),notifyDaysBefore:Fe("notify_days_before").default(3).notNull(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),g5=Ke("maintenance_tasks",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),scheduleId:Q("schedule_id").notNull().references(()=>ow.id,{onDelete:"cascade"}),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),taskName:D("task_name").notNull(),taskDescription:D("task_description"),taskType:D("task_type").notNull(),priority:D("priority").notNull().default("medium"),status:D("status").notNull().default("pending"),dueDate:J("due_date").notNull(),startedAt:J("started_at"),completedAt:J("completed_at"),estimatedDuration:Fe("estimated_duration"),actualDuration:Fe("actual_duration"),estimatedCost:Se("estimated_cost",{precision:12,scale:2}),actualCost:Se("actual_cost",{precision:12,scale:2}),assignedTo:Q("assigned_to").references(()=>At.id),performedBy:Q("performed_by").references(()=>At.id),result:D("result"),findings:D("findings"),actionsTaken:D("actions_taken"),recommendations:D("recommendations"),beforeImages:D("before_images").array(),afterImages:D("after_images").array(),documentUrls:D("document_urls").array(),materialsUsed:ds("materials_used"),performerSignature:D("performer_signature"),supervisorSignature:D("supervisor_signature"),approvedBy:Q("approved_by").references(()=>At.id),approvedAt:J("approved_at"),notes:D("notes"),internalNotes:D("internal_notes"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),y5=Ke("tool_cost_tracking",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),costType:D("cost_type").notNull(),costCategory:D("cost_category").notNull(),amount:Se("amount",{precision:12,scale:2}).notNull(),currency:D("currency").notNull().default("YER"),costDate:D("cost_date").notNull(),costPeriod:D("cost_period"),referenceType:D("reference_type"),referenceId:Q("reference_id"),description:D("description").notNull(),notes:D("notes"),approvedBy:Q("approved_by").references(()=>At.id),approvedAt:J("approved_at"),projectId:Q("project_id").references(()=>Xt.id),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()},t=>({uniqueToolDate:Pe`UNIQUE (tool_id, analysis_date)`})),v5=Ke("tool_reservations",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),toolId:Q("tool_id").notNull().references(()=>jr.id,{onDelete:"cascade"}),projectId:Q("project_id").notNull().references(()=>Xt.id),quantity:Fe("quantity").notNull(),reservedBy:Q("reserved_by").notNull().references(()=>At.id),reservationDate:J("reservation_date").defaultNow().notNull(),requestedDate:J("requested_date").notNull(),expiryDate:J("expiry_date"),status:D("status").notNull().default("pending"),priority:D("priority").notNull().default("normal"),reason:D("reason"),notes:D("notes"),approvedBy:Q("approved_by").references(()=>At.id),approvedAt:J("approved_at"),fulfilledBy:Q("fulfilled_by").references(()=>At.id),fulfilledAt:J("fulfilled_at"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),b5=Ke("system_notifications",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),type:D("type").notNull(),category:D("category").notNull(),title:D("title").notNull(),message:D("message").notNull(),description:D("description"),priority:D("priority").notNull().default("medium"),severity:D("severity").notNull().default("info"),status:D("status").notNull().default("active"),sourceType:D("source_type"),sourceId:Q("source_id"),sourceName:D("source_name"),userId:Q("user_id").references(()=>At.id),targetAudience:D("target_audience").default("all"),actionRequired:Ye("action_required").default(!1).notNull(),actionUrl:D("action_url"),actionLabel:D("action_label"),scheduledFor:J("scheduled_for"),expiresAt:J("expires_at"),readAt:J("read_at"),dismissedAt:J("dismissed_at"),metadata:ds("metadata"),attachments:D("attachments").array(),viewCount:Fe("view_count").default(0).notNull(),clickCount:Fe("click_count").default(0).notNull(),lastViewedAt:J("last_viewed_at"),isSystem:Ye("is_system").default(!1).notNull(),isAutoGenerated:Ye("is_auto_generated").default(!0).notNull(),isPersistent:Ye("is_persistent").default(!1).notNull(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()},t=>({userStatusIdx:Pe`CREATE INDEX IF NOT EXISTS notifications_user_status_idx ON ${t} (user_id, status, priority)`,typeSourceIdx:Pe`CREATE INDEX IF NOT EXISTS notifications_type_source_idx ON ${t} (type, source_type, source_id)`,scheduledIdx:Pe`CREATE INDEX IF NOT EXISTS notifications_scheduled_idx ON ${t} (scheduled_for, status)`})),j5=Ke("notification_read_states",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),notificationId:D("notification_id").notNull(),userId:Q("user_id").references(()=>At.id),isRead:Ye("is_read").default(!0).notNull(),readAt:J("read_at").defaultNow().notNull(),deviceInfo:D("device_info"),createdAt:J("created_at").defaultNow().notNull()},t=>({uniqueNotificationUser:Pe`UNIQUE (notification_id, user_id)`}));Le(Tl).omit({id:!0,createdAt:!0,updatedAt:!0});const N5=Le(jr).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({purchasePrice:ut.string().optional(),currentValue:ut.string().optional()});N5.extend({purchasePrice:kr([Qe(),Ka()]).optional().transform(t=>{if(!(t==null||t===""))return typeof t=="string"?t:t.toString()}),currentValue:kr([Qe(),Ka()]).optional().transform(t=>{if(!(t==null||t===""))return typeof t=="string"?t:t.toString()}),depreciationRate:kr([Qe(),Ka()]).optional().transform(t=>{if(!(t==null||t===""))return typeof t=="string"?t:t.toString()}),purchaseDate:kr([Qe(),ri()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}}),warrantyExpiry:kr([Qe(),ri()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}}),lastMaintenanceDate:kr([Qe(),ri()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}}),nextMaintenanceDate:kr([Qe(),ri()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}})}).partial();Le(m5).omit({id:!0,createdAt:!0,updatedAt:!0});Le(h5).omit({id:!0,performedAt:!0});Le(f5).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({laborCost:ut.string().optional(),partsCost:ut.string().optional(),totalCost:ut.string().optional()});Le(p5).omit({id:!0,createdAt:!0});Le(v5).omit({id:!0,createdAt:!0,updatedAt:!0});Le(b5).omit({id:!0,createdAt:!0,updatedAt:!0,viewCount:!0,clickCount:!0,lastViewedAt:!0});Le(x5).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({unitPrice:ut.string(),totalPrice:ut.string()});Le(ow).omit({id:!0,createdAt:!0,updatedAt:!0});Le(g5).omit({id:!0,createdAt:!0,updatedAt:!0});Le(y5).omit({id:!0,createdAt:!0,updatedAt:!0});const w5=Ke("tool_notifications",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),type:D("type").notNull(),title:D("title").notNull(),message:D("message").notNull(),toolId:Q("tool_id").references(()=>jr.id),toolName:D("tool_name"),priority:D("priority").notNull().default("medium"),isRead:Ye("is_read").notNull().default(!1),actionRequired:Ye("action_required").notNull().default(!1),metadata:ds("metadata"),createdAt:J("created_at").defaultNow().notNull(),readAt:J("read_at")});Le(w5);Le(j5).omit({id:!0,createdAt:!0});const k5=Ke("approvals",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),objectType:D("object_type").notNull(),objectId:Q("object_id").notNull(),requestedBy:Q("requested_by").notNull().references(()=>At.id),approverId:Q("approver_id").references(()=>At.id),currentLevel:Fe("current_level").notNull().default(1),totalLevels:Fe("total_levels").notNull().default(1),amount:Se("amount",{precision:12,scale:2}),title:D("title").notNull(),description:D("description"),priority:D("priority").notNull().default("medium"),status:D("status").notNull().default("pending"),reason:D("reason"),metadata:ds("metadata"),dueDate:J("due_date"),decidedAt:J("decided_at"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),lw=Ke("channels",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),name:D("name").notNull(),type:D("type").notNull().default("approval"),relatedObjectType:D("related_object_type"),relatedObjectId:Q("related_object_id"),participantIds:ds("participant_ids").notNull(),isPrivate:Ye("is_private").notNull().default(!1),createdBy:Q("created_by").notNull().references(()=>At.id),lastMessageAt:J("last_message_at"),createdAt:J("created_at").defaultNow().notNull()}),S5=Ke("messages",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),channelId:Q("channel_id").notNull().references(()=>lw.id,{onDelete:"cascade"}),senderId:Q("sender_id").notNull().references(()=>At.id),content:D("content").notNull(),messageType:D("message_type").notNull().default("text"),attachments:ds("attachments"),relatedObjectType:D("related_object_type"),relatedObjectId:Q("related_object_id"),isDecision:Ye("is_decision").notNull().default(!1),decisionType:D("decision_type"),isEdited:Ye("is_edited").notNull().default(!1),editedAt:J("edited_at"),createdAt:J("created_at").defaultNow().notNull()}),T5=Ke("actions",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),title:D("title").notNull(),description:D("description").notNull(),category:D("category").notNull(),priority:D("priority").notNull().default("medium"),ownerId:Q("owner_id").notNull().references(()=>At.id),assignedTo:Q("assigned_to").references(()=>At.id),relatedObjectType:D("related_object_type"),relatedObjectId:Q("related_object_id"),status:D("status").notNull().default("open"),progress:Fe("progress").notNull().default(0),estimatedCost:Se("estimated_cost",{precision:10,scale:2}),actualCost:Se("actual_cost",{precision:10,scale:2}),dueDate:Xr("due_date"),startedAt:J("started_at"),completedAt:J("completed_at"),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),A5=Ke("system_events",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),eventType:D("event_type").notNull(),objectType:D("object_type").notNull(),objectId:Q("object_id").notNull(),userId:Q("user_id").references(()=>At.id),eventData:ds("event_data").notNull(),processed:Ye("processed").notNull().default(!1),processedAt:J("processed_at"),createdAt:J("created_at").defaultNow().notNull()});Le(k5).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({amount:ut.string().optional()});Le(lw).omit({id:!0,createdAt:!0});Le(S5).omit({id:!0,createdAt:!0});Le(T5).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({estimatedCost:ut.string().optional(),actualCost:ut.string().optional()});Le(A5).omit({id:!0,createdAt:!0});const Fi=Ke("accounts",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),code:D("code").unique().notNull(),name:D("name").notNull(),type:D("type").notNull(),currency:D("currency").default("SAR").notNull(),parentId:Q("parent_id"),isActive:Ye("is_active").default(!0).notNull(),description:D("description"),createdAt:J("created_at").defaultNow().notNull()}),Al=Ke("transactions",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),docNumber:D("doc_number"),date:Xr("date").notNull(),description:D("description"),totalAmount:Se("total_amount",{precision:12,scale:2}).notNull(),currency:D("currency").default("SAR").notNull(),status:D("status").default("draft").notNull(),transactionType:D("transaction_type").notNull(),projectId:Q("project_id").references(()=>Xt.id),relatedObjectType:D("related_object_type"),relatedObjectId:Q("related_object_id"),createdBy:Q("created_by").references(()=>At.id),approvedBy:Q("approved_by").references(()=>At.id),postedBy:Q("posted_by").references(()=>At.id),approvedAt:J("approved_at"),postedAt:J("posted_at"),createdAt:J("created_at").defaultNow().notNull()}),C5=Ke("transaction_lines",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),transactionId:Q("transaction_id").notNull().references(()=>Al.id,{onDelete:"cascade"}),accountId:Q("account_id").notNull().references(()=>Fi.id),debit:Se("debit",{precision:12,scale:2}).default("0").notNull(),credit:Se("credit",{precision:12,scale:2}).default("0").notNull(),description:D("description"),costCenter:D("cost_center"),projectId:Q("project_id").references(()=>Xt.id),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),P5=Ke("journals",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),transactionId:Q("transaction_id").notNull().references(()=>Al.id),journalNumber:D("journal_number").unique(),period:D("period").notNull(),isReversed:Ye("is_reversed").default(!1).notNull(),reversalJournalId:Q("reversal_journal_id"),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull(),postedAt:J("posted_at")}),_5=Ke("finance_payments",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),transactionId:Q("transaction_id").references(()=>Al.id),paymentNumber:D("payment_number").unique(),paymentType:D("payment_type").notNull(),amount:Se("amount",{precision:12,scale:2}).notNull(),currency:D("currency").default("SAR").notNull(),fromAccount:Q("from_account").references(()=>Fi.id),toAccount:Q("to_account").references(()=>Fi.id),bankReference:D("bank_reference"),checkNumber:D("check_number"),dueDate:Xr("due_date"),paidDate:Xr("paid_date"),payerId:Q("payer_id"),payeeId:Q("payee_id"),status:D("status").default("pending").notNull(),notes:D("notes"),createdAt:J("created_at").defaultNow().notNull()}),E5=Ke("finance_events",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),eventName:D("event_name").notNull(),eventType:D("event_type").notNull(),objectType:D("object_type"),objectId:Q("object_id"),payload:ds("payload"),metadata:ds("metadata"),triggeredBy:Q("triggered_by").references(()=>At.id),processed:Ye("processed").default(!1).notNull(),processedAt:J("processed_at"),createdAt:J("created_at").defaultNow().notNull()});Ke("account_balances",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),accountId:Q("account_id").notNull().references(()=>Fi.id),projectId:Q("project_id").references(()=>Xt.id),period:D("period").notNull(),openingBalance:Se("opening_balance",{precision:12,scale:2}).default("0").notNull(),debitTotal:Se("debit_total",{precision:12,scale:2}).default("0").notNull(),creditTotal:Se("credit_total",{precision:12,scale:2}).default("0").notNull(),closingBalance:Se("closing_balance",{precision:12,scale:2}).default("0").notNull(),lastUpdated:J("last_updated").defaultNow().notNull(),createdAt:J("created_at").defaultNow().notNull()},t=>({uniqueAccountPeriod:Pe`UNIQUE (account_id, period, project_id)`}));Le(Fi).omit({id:!0,createdAt:!0});Le(Al).omit({id:!0,createdAt:!0,approvedAt:!0,postedAt:!0});Le(C5).omit({id:!0,createdAt:!0});Le(P5).omit({id:!0,createdAt:!0,postedAt:!0});Le(_5).omit({id:!0,createdAt:!0});Le(E5).omit({id:!0,createdAt:!0,processedAt:!0});const wu=Ke("migration_jobs",{id:Q("id").primaryKey(),status:D("status").notNull().default("pending"),startTime:J("start_time").defaultNow().notNull(),endTime:J("end_time"),currentTable:D("current_table"),tablesProcessed:Fe("tables_processed").default(0).notNull(),totalTables:Fe("total_tables").default(0).notNull(),totalRowsProcessed:Fe("total_rows_processed").default(0).notNull(),totalRowsSaved:Fe("total_rows_saved").default(0).notNull(),totalErrors:Fe("total_errors").default(0).notNull(),progress:Fe("progress").default(0).notNull(),errorMessage:D("error_message"),batchSize:Fe("batch_size").default(100).notNull(),userId:Q("user_id").references(()=>At.id),resumable:Ye("resumable").default(!0).notNull(),lastHeartbeat:J("last_heartbeat").defaultNow(),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()}),D5=Ke("migration_table_progress",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),jobId:Q("job_id").notNull().references(()=>wu.id,{onDelete:"cascade"}),tableName:D("table_name").notNull(),status:D("status").notNull().default("pending"),totalRows:Fe("total_rows").default(0).notNull(),processedRows:Fe("processed_rows").default(0).notNull(),savedRows:Fe("saved_rows").default(0).notNull(),failedRows:Fe("failed_rows").default(0).notNull(),errors:Fe("errors").default(0).notNull(),startTime:J("start_time"),endTime:J("end_time"),errorMessage:D("error_message"),lastProcessedId:D("last_processed_id"),lastBatchOffset:Fe("last_batch_offset").default(0).notNull(),checksum:D("checksum"),createdAt:J("created_at").defaultNow().notNull(),updatedAt:J("updated_at").defaultNow().notNull()},t=>({uniqueJobTable:Pe`UNIQUE (job_id, table_name)`})),M5=Ke("migration_batch_log",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),jobId:Q("job_id").notNull().references(()=>wu.id,{onDelete:"cascade"}),tableName:D("table_name").notNull(),batchIndex:Fe("batch_index").notNull(),batchSize:Fe("batch_size").notNull(),batchOffset:Fe("batch_offset").notNull(),status:D("status").notNull(),rowsProcessed:Fe("rows_processed").default(0).notNull(),rowsSaved:Fe("rows_saved").default(0).notNull(),retryCount:Fe("retry_count").default(0).notNull(),errorMessage:D("error_message"),transactionId:D("transaction_id"),startTime:J("start_time").defaultNow().notNull(),endTime:J("end_time"),createdAt:J("created_at").defaultNow().notNull()});Le(wu).omit({createdAt:!0,updatedAt:!0,lastHeartbeat:!0});Le(D5).omit({id:!0,createdAt:!0,updatedAt:!0});Le(M5).omit({id:!0,createdAt:!0});const R5=Ke("notifications",{id:Q("id").primaryKey().default(Pe`gen_random_uuid()`),title:D("title").notNull(),body:D("body").notNull(),type:D("type").notNull(),priority:Fe("priority").notNull().default(3),projectId:Q("project_id").references(()=>Xt.id),createdBy:Q("created_by").references(()=>At.id),recipients:D("recipients").array(),payload:ds("payload"),meta:ds("meta"),readBy:D("read_by").array(),deliveredTo:D("delivered_to").array(),scheduledAt:J("scheduled_at"),channelPreference:ds("channel_preference"),createdAt:J("created_at").defaultNow().notNull()});Le(R5).omit({id:!0,createdAt:!0});function Jn({className:t,...s}){return e.jsx("div",{className:he("animate-pulse rounded-md bg-muted",t),...s})}function I5(){const{toast:t}=Ct(),s=Mt(),[r,a]=h.useState(!1),[n,i]=h.useState(null),{setFloatingAction:o}=Ls(),{selectedProjectId:l,selectProject:u}=_a(),d=l||"all";h.useEffect(()=>(o(()=>{a(!0),i(null)},"إضافة عملية ترحيل"),()=>o(null)),[o]);const c=async(T,S)=>{if(!(!S||typeof S!="string"||!S.trim()))try{await ae("/api/autocomplete","POST",{category:T,value:S.trim()})}catch(M){console.log(`Failed to save autocomplete value for ${T}:`,M)}},{data:f=[],isLoading:m}=ge({queryKey:["/api/projects"]}),{data:y=[],isLoading:x}=ge({queryKey:["/api/project-fund-transfers"],queryFn:async()=>(await ae("/api/project-fund-transfers","GET")).data||[]}),p=Ce({mutationFn:async T=>(await Promise.all([c("transferReasons",T.transferReason),c("projectTransferDescriptions",T.description)]),n?ae(`/api/project-fund-transfers/${n.id}`,"PATCH",T):ae("/api/project-fund-transfers","POST",T)),onSuccess:async(T,S)=>{s.invalidateQueries({queryKey:["/api/autocomplete"]}),s.setQueryData(["/api/project-fund-transfers"],M=>M?n?M.map(v=>v.id===n.id?T:v):[T,...M]:[T]),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم بنجاح",description:n?"تم تحديث عملية ترحيل الأموال بنجاح":"تم إنشاء عملية ترحيل الأموال بنجاح"}),a(!1),i(null),g.reset()},onError:async(T,S)=>{await Promise.all([c("transferReasons",S.transferReason),c("projectTransferDescriptions",S.description)]),s.invalidateQueries({queryKey:["/api/autocomplete"]}),t({title:"خطأ",description:T.message||"فشل في حفظ عملية الترحيل",variant:"destructive"})}}),A=Ce({mutationFn:T=>ae(`/api/project-fund-transfers/${T}`,"DELETE"),onSuccess:(T,S)=>{s.setQueryData(["/api/project-fund-transfers"],M=>M?M.filter(v=>v.id!==S):[]),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم الحذف",description:"تم حذف عملية ترحيل الأموال بنجاح"})},onError:T=>{t({title:"خطأ",description:T.message||"فشل في حذف عملية الترحيل",variant:"destructive"})}}),g=va({resolver:ba(c5),defaultValues:{fromProjectId:"",toProjectId:"",amount:"",transferReason:"",transferDate:new Date().toISOString().split("T")[0],description:""}}),N=T=>{p.mutate(T)},w=T=>{i(T),g.reset({fromProjectId:T.fromProjectId,toProjectId:T.toProjectId,amount:T.amount,transferReason:T.transferReason||"",transferDate:T.transferDate,description:T.description||""}),a(!0)},_=()=>{i(null),a(!1),g.reset()},b=(T,S,M)=>{confirm(`هل أنت متأكد من حذف عملية الترحيل من ${S} إلى ${M}؟`)&&A.mutate(T)},k=T=>f.find(M=>M.id===T)?.name||"غير محدد",R=d!=="all"?y.filter(T=>T.fromProjectId===d||T.toProjectId===d):y,I={totalTransfers:R.length,totalAmount:R.reduce((T,S)=>T+(parseFloat(S.amount?.toString()||"0")||0),0),outgoingTransfers:d!=="all"?R.filter(T=>T.fromProjectId===d).length:0,incomingTransfers:d!=="all"?R.filter(T=>T.toProjectId===d).length:0,outgoingAmount:d!=="all"?R.filter(T=>T.fromProjectId===d).reduce((T,S)=>T+(parseFloat(S.amount?.toString()||"0")||0),0):0,incomingAmount:d!=="all"?R.filter(T=>T.toProjectId===d).reduce((T,S)=>T+(parseFloat(S.amount?.toString()||"0")||0),0):0},E=I.incomingAmount-I.outgoingAmount,O=T=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(T)+" ريال";return e.jsxs("div",{className:"container mx-auto p-4 md:p-6 space-y-6 md:space-y-8",dir:"rtl",children:[e.jsx("div",{className:"bg-card border rounded-lg p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(fa,{className:"h-6 w-6 md:h-7 md:w-7 text-primary"}),"تحويلات العهدة"]}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"إدارة وتتبع عمليات ترحيل الأموال بين المشاريع المختلفة"})]}),e.jsxs($,{onClick:()=>{a(!0),i(null)},className:"bg-primary hover:bg-primary/90 text-primary-foreground h-11 px-6","data-testid":"button-add-transfer-header",children:[e.jsx(bs,{className:"h-4 w-4 ml-2"}),"إضافة عملية ترحيل"]})]})}),e.jsxs("div",{className:"bg-card border rounded-lg p-4",children:[e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Bi,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsx(Ea,{selectedProjectId:d,onProjectChange:(T,S)=>u(T,S),showHeader:!1,variant:"compact"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:[e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"إجمالي العمليات"}),e.jsx("p",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:I.totalTransfers})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(fa,{className:"h-6 w-6 text-primary"})})]})}),e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"إجمالي المبالغ"}),e.jsx("p",{className:"text-xl md:text-2xl font-semibold text-foreground",children:O(I.totalAmount)})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center",children:e.jsx(us,{className:"h-6 w-6 text-green-600 dark:text-green-400"})})]})}),d!=="all"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"العمليات الصادرة"}),e.jsx("p",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:I.outgoingTransfers}),e.jsx("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400",children:O(I.outgoingAmount)})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/20 flex items-center justify-center",children:e.jsx(An,{className:"h-6 w-6 text-red-600 dark:text-red-400"})})]})}),e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"العمليات الواردة"}),e.jsx("p",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:I.incomingTransfers}),e.jsx("p",{className:"text-xs md:text-sm text-green-600 dark:text-green-400",children:O(I.incomingAmount)})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center",children:e.jsx(Kt,{className:"h-6 w-6 text-green-600 dark:text-green-400"})})]})})]})]}),d!=="all"&&e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"صافي التدفق"}),e.jsxs("p",{className:`text-2xl md:text-3xl font-semibold ${E>0?"text-green-600 dark:text-green-400":E<0?"text-red-600 dark:text-red-400":"text-foreground"}`,children:[E>0?"+":"",O(E)]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:E>0?"زيادة في الرصيد":E<0?"نقص في الرصيد":"متزن الرصيد"})]}),e.jsx("div",{className:`h-12 w-12 rounded-full flex items-center justify-center ${E>0?"bg-green-100 dark:bg-green-900/20":E<0?"bg-red-100 dark:bg-red-900/20":"bg-gray-100 dark:bg-gray-900/20"}`,children:E>0?e.jsx(Kt,{className:"h-6 w-6 text-green-600 dark:text-green-400"}):E<0?e.jsx(An,{className:"h-6 w-6 text-red-600 dark:text-red-400"}):e.jsx(Xk,{className:"h-6 w-6 text-gray-600 dark:text-gray-400"})})]})}),r&&e.jsxs("div",{className:"bg-card border rounded-lg",children:[e.jsx("div",{className:"p-4 md:p-6 border-b",children:e.jsx("h2",{className:"text-lg md:text-xl font-bold text-foreground",children:n?"تعديل عملية الترحيل":"إضافة عملية ترحيل جديدة"})}),e.jsx("div",{className:"p-4 md:p-6",children:e.jsx(ja,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(N),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Nt,{control:g.control,name:"fromProjectId",render:({field:T})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"المشروع المرسل"}),e.jsx(vt,{children:e.jsxs(qe,{value:T.value,onValueChange:T.onChange,"data-testid":"select-from-project",children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر المشروع المرسل"})}),e.jsx($e,{children:f.map(S=>e.jsx(K,{value:S.id,children:S.name},S.id))})]})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:g.control,name:"toProjectId",render:({field:T})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"المشروع المستلم"}),e.jsx(vt,{children:e.jsxs(qe,{value:T.value,onValueChange:T.onChange,"data-testid":"select-to-project",children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر المشروع المستلم"})}),e.jsx($e,{children:f.map(S=>e.jsx(K,{value:S.id,children:S.name},S.id))})]})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:g.control,name:"amount",render:({field:T})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"المبلغ (ر.ي)"}),e.jsx(vt,{children:e.jsx(be,{type:"number",step:"0.01",placeholder:"أدخل المبلغ",...T,"data-testid":"input-amount"})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:g.control,name:"transferDate",render:({field:T})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"تاريخ الترحيل"}),e.jsx(vt,{children:e.jsx(be,{type:"date",...T,"data-testid":"input-transfer-date"})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:g.control,name:"transferReason",render:({field:T})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"سبب الترحيل"}),e.jsx(vt,{children:e.jsx(be,{placeholder:"أدخل سبب الترحيل",...T,value:T.value||"","data-testid":"input-transfer-reason"})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:g.control,name:"description",render:({field:T})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"وصف الترحيل (اختياري)"}),e.jsx(vt,{children:e.jsx(an,{placeholder:"أدخل وصف للترحيل",...T,value:T.value||"","data-testid":"textarea-description"})}),e.jsx(bt,{})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx($,{type:"submit",disabled:p.isPending,className:"bg-primary hover:bg-primary/90 text-primary-foreground h-11","data-testid":"button-submit-transfer",children:p.isPending?"جاري الحفظ...":n?"تحديث عملية الترحيل":"حفظ عملية الترحيل"}),e.jsx($,{type:"button",variant:"outline",onClick:_,className:"h-11","data-testid":"button-cancel",children:"إلغاء"})]})]})})})]}),e.jsxs("div",{className:"bg-card border rounded-lg",children:[e.jsx("div",{className:"p-4 md:p-6 border-b",children:e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(lr,{className:"w-5 h-5"}),"سجل عمليات الترحيل"]})}),e.jsx("div",{className:"p-4 md:p-6",children:x?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(T=>e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Jn,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Jn,{className:"h-6 w-32"}),e.jsx(Jn,{className:"h-8 w-20"})]}),e.jsx(Jn,{className:"h-4 w-48"}),e.jsx(Jn,{className:"h-4 w-24"})]})]})},T))}):R.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:e.jsx(fa,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"لا توجد عمليات ترحيل"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground mb-4",children:d!=="all"?"لم يتم إجراء عمليات ترحيل للمشروع المحدد بعد":"لم يتم إجراء عمليات ترحيل بين المشاريع بعد"}),e.jsxs($,{onClick:()=>{a(!0),i(null)},className:"bg-primary hover:bg-primary/90 text-primary-foreground","data-testid":"button-add-first-transfer",children:[e.jsx(bs,{className:"h-4 w-4 ml-2"}),"إضافة عملية ترحيل"]})]}):e.jsx("div",{className:"space-y-4",children:R.map(T=>{const S=d!=="all"&&T.fromProjectId===d,M=d!=="all"&&T.toProjectId===d;return e.jsx("div",{className:"bg-card border rounded-lg p-4 hover:shadow-md transition-all duration-200","data-testid":`card-transfer-${T.id}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-semibold text-foreground mb-1",children:parseFloat(T.amount).toLocaleString()}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground",children:"ريال"}),(S||M)&&e.jsx(le,{variant:S?"destructive":"default",className:"mt-2 text-xs",children:S?"صادر":"وارد"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm md:text-base font-medium text-muted-foreground",children:k(T.fromProjectId)}),e.jsx(fa,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm md:text-base font-medium text-muted-foreground",children:k(T.toProjectId)})]}),e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(or,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground",children:new Date(T.transferDate).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"})})]}),(T.transferReason||T.description)&&e.jsxs("div",{className:"space-y-1 text-sm md:text-base",children:[T.transferReason&&e.jsxs("div",{className:"text-foreground",children:[e.jsx("span",{className:"font-medium",children:"السبب:"})," ",T.transferReason]}),T.description&&e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"ملاحظات:"})," ",T.description]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ID: ",T.id.slice(0,8)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",size:"sm",onClick:()=>w(T),className:"h-11 min-w-11 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20","data-testid":`button-edit-${T.id}`,children:e.jsx(To,{className:"w-4 h-4"})}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>b(T.id,k(T.fromProjectId),k(T.toProjectId)),className:"h-11 min-w-11 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20",disabled:A.isPending,"data-testid":`button-delete-${T.id}`,children:e.jsx(os,{className:"w-4 h-4"})})]})]})]})]})},T.id)})})})]})]})}function Nr(t){const s=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&s==="[object Date]"?new t.constructor(+t):typeof t=="number"||s==="[object Number]"||typeof t=="string"||s==="[object String]"?new Date(t):new Date(NaN)}function Ya(t,s){return t instanceof Date?new t.constructor(s):new Date(s)}const cw=6048e5,F5=864e5;let O5={};function Cl(){return O5}function Oi(t,s){const r=Cl(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,n=Nr(t),i=n.getDay(),o=(i<a?7:0)+i-a;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function Qo(t){return Oi(t,{weekStartsOn:1})}function dw(t){const s=Nr(t),r=s.getFullYear(),a=Ya(t,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const n=Qo(a),i=Ya(t,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);const o=Qo(i);return s.getTime()>=n.getTime()?r+1:s.getTime()>=o.getTime()?r:r-1}function lf(t){const s=Nr(t);return s.setHours(0,0,0,0),s}function cf(t){const s=Nr(t),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+t-+r}function $5(t,s){const r=lf(t),a=lf(s),n=+r-cf(r),i=+a-cf(a);return Math.round((n-i)/F5)}function L5(t){const s=dw(t),r=Ya(t,0);return r.setFullYear(s,0,4),r.setHours(0,0,0,0),Qo(r)}function V5(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function z5(t){if(!V5(t)&&typeof t!="number")return!1;const s=Nr(t);return!isNaN(Number(s))}function B5(t){const s=Nr(t),r=Ya(t,0);return r.setFullYear(s.getFullYear(),0,1),r.setHours(0,0,0,0),r}const q5={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},U5=(t,s,r)=>{let a;const n=q5[t];return typeof n=="string"?a=n:s===1?a=n.one:a=n.other.replace("{{count}}",s.toString()),r?.addSuffix?r.comparison&&r.comparison>0?"in "+a:a+" ago":a};function wn(t){return(s={})=>{const r=s.width?String(s.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const W5={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},K5={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},H5={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},G5={date:wn({formats:W5,defaultWidth:"full"}),time:wn({formats:K5,defaultWidth:"full"}),dateTime:wn({formats:H5,defaultWidth:"full"})},Q5={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},X5=(t,s,r,a)=>Q5[t];function Tr(t){return(s,r)=>{const a=r?.context?String(r.context):"standalone";let n;if(a==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,l=r?.width?String(r.width):o;n=t.formattingValues[l]||t.formattingValues[o]}else{const o=t.defaultWidth,l=r?.width?String(r.width):t.defaultWidth;n=t.values[l]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(s):s;return n[i]}}const Z5={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Y5={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},J5={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},eD={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},tD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},sD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},rD=(t,s)=>{const r=Number(t),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},aD={ordinalNumber:rD,era:Tr({values:Z5,defaultWidth:"wide"}),quarter:Tr({values:Y5,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Tr({values:J5,defaultWidth:"wide"}),day:Tr({values:eD,defaultWidth:"wide"}),dayPeriod:Tr({values:tD,defaultWidth:"wide",formattingValues:sD,defaultFormattingWidth:"wide"})};function Ar(t){return(s,r={})=>{const a=r.width,n=a&&t.matchPatterns[a]||t.matchPatterns[t.defaultMatchWidth],i=s.match(n);if(!i)return null;const o=i[0],l=a&&t.parsePatterns[a]||t.parsePatterns[t.defaultParseWidth],u=Array.isArray(l)?iD(l,f=>f.test(o)):nD(l,f=>f.test(o));let d;d=t.valueCallback?t.valueCallback(u):u,d=r.valueCallback?r.valueCallback(d):d;const c=s.slice(o.length);return{value:d,rest:c}}}function nD(t,s){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&s(t[r]))return r}function iD(t,s){for(let r=0;r<t.length;r++)if(s(t[r]))return r}function uw(t){return(s,r={})=>{const a=s.match(t.matchPattern);if(!a)return null;const n=a[0],i=s.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;const l=s.slice(n.length);return{value:o,rest:l}}}const oD=/^(\d+)(th|st|nd|rd)?/i,lD=/\d+/i,cD={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},dD={any:[/^b/i,/^(a|c)/i]},uD={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},mD={any:[/1/i,/2/i,/3/i,/4/i]},hD={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},fD={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},pD={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},xD={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},gD={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},yD={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},vD={ordinalNumber:uw({matchPattern:oD,parsePattern:lD,valueCallback:t=>parseInt(t,10)}),era:Ar({matchPatterns:cD,defaultMatchWidth:"wide",parsePatterns:dD,defaultParseWidth:"any"}),quarter:Ar({matchPatterns:uD,defaultMatchWidth:"wide",parsePatterns:mD,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Ar({matchPatterns:hD,defaultMatchWidth:"wide",parsePatterns:fD,defaultParseWidth:"any"}),day:Ar({matchPatterns:pD,defaultMatchWidth:"wide",parsePatterns:xD,defaultParseWidth:"any"}),dayPeriod:Ar({matchPatterns:gD,defaultMatchWidth:"any",parsePatterns:yD,defaultParseWidth:"any"})},bD={code:"en-US",formatDistance:U5,formatLong:G5,formatRelative:X5,localize:aD,match:vD,options:{weekStartsOn:0,firstWeekContainsDate:1}};function jD(t){const s=Nr(t);return $5(s,B5(s))+1}function ND(t){const s=Nr(t),r=+Qo(s)-+L5(s);return Math.round(r/cw)+1}function mw(t,s){const r=Nr(t),a=r.getFullYear(),n=Cl(),i=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=Ya(t,0);o.setFullYear(a+1,0,i),o.setHours(0,0,0,0);const l=Oi(o,s),u=Ya(t,0);u.setFullYear(a,0,i),u.setHours(0,0,0,0);const d=Oi(u,s);return r.getTime()>=l.getTime()?a+1:r.getTime()>=d.getTime()?a:a-1}function wD(t,s){const r=Cl(),a=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,n=mw(t,s),i=Ya(t,0);return i.setFullYear(n,0,a),i.setHours(0,0,0,0),Oi(i,s)}function kD(t,s){const r=Nr(t),a=+Oi(r,s)-+wD(r,s);return Math.round(a/cw)+1}function Tt(t,s){const r=t<0?"-":"",a=Math.abs(t).toString().padStart(s,"0");return r+a}const ca={y(t,s){const r=t.getFullYear(),a=r>0?r:1-r;return Tt(s==="yy"?a%100:a,s.length)},M(t,s){const r=t.getMonth();return s==="M"?String(r+1):Tt(r+1,2)},d(t,s){return Tt(t.getDate(),s.length)},a(t,s){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,s){return Tt(t.getHours()%12||12,s.length)},H(t,s){return Tt(t.getHours(),s.length)},m(t,s){return Tt(t.getMinutes(),s.length)},s(t,s){return Tt(t.getSeconds(),s.length)},S(t,s){const r=s.length,a=t.getMilliseconds(),n=Math.trunc(a*Math.pow(10,r-3));return Tt(n,s.length)}},cn={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},df={G:function(t,s,r){const a=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(t,s,r){if(s==="yo"){const a=t.getFullYear(),n=a>0?a:1-a;return r.ordinalNumber(n,{unit:"year"})}return ca.y(t,s)},Y:function(t,s,r,a){const n=mw(t,a),i=n>0?n:1-n;if(s==="YY"){const o=i%100;return Tt(o,2)}return s==="Yo"?r.ordinalNumber(i,{unit:"year"}):Tt(i,s.length)},R:function(t,s){const r=dw(t);return Tt(r,s.length)},u:function(t,s){const r=t.getFullYear();return Tt(r,s.length)},Q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(a);case"QQ":return Tt(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(a);case"qq":return Tt(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,s,r){const a=t.getMonth();switch(s){case"M":case"MM":return ca.M(t,s);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(t,s,r){const a=t.getMonth();switch(s){case"L":return String(a+1);case"LL":return Tt(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(t,s,r,a){const n=kD(t,a);return s==="wo"?r.ordinalNumber(n,{unit:"week"}):Tt(n,s.length)},I:function(t,s,r){const a=ND(t);return s==="Io"?r.ordinalNumber(a,{unit:"week"}):Tt(a,s.length)},d:function(t,s,r){return s==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):ca.d(t,s)},D:function(t,s,r){const a=jD(t);return s==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):Tt(a,s.length)},E:function(t,s,r){const a=t.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return Tt(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return Tt(i,s.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(t,s,r){const a=t.getDay(),n=a===0?7:a;switch(s){case"i":return String(n);case"ii":return Tt(n,s.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(t,s,r){const n=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(t,s,r){const a=t.getHours();let n;switch(a===12?n=cn.noon:a===0?n=cn.midnight:n=a/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(t,s,r){const a=t.getHours();let n;switch(a>=17?n=cn.evening:a>=12?n=cn.afternoon:a>=4?n=cn.morning:n=cn.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(t,s,r){if(s==="ho"){let a=t.getHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return ca.h(t,s)},H:function(t,s,r){return s==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):ca.H(t,s)},K:function(t,s,r){const a=t.getHours()%12;return s==="Ko"?r.ordinalNumber(a,{unit:"hour"}):Tt(a,s.length)},k:function(t,s,r){let a=t.getHours();return a===0&&(a=24),s==="ko"?r.ordinalNumber(a,{unit:"hour"}):Tt(a,s.length)},m:function(t,s,r){return s==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):ca.m(t,s)},s:function(t,s,r){return s==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):ca.s(t,s)},S:function(t,s){return ca.S(t,s)},X:function(t,s,r){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(s){case"X":return mf(a);case"XXXX":case"XX":return Oa(a);case"XXXXX":case"XXX":default:return Oa(a,":")}},x:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"x":return mf(a);case"xxxx":case"xx":return Oa(a);case"xxxxx":case"xxx":default:return Oa(a,":")}},O:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+uf(a,":");case"OOOO":default:return"GMT"+Oa(a,":")}},z:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+uf(a,":");case"zzzz":default:return"GMT"+Oa(a,":")}},t:function(t,s,r){const a=Math.trunc(t.getTime()/1e3);return Tt(a,s.length)},T:function(t,s,r){const a=t.getTime();return Tt(a,s.length)}};function uf(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=Math.trunc(a/60),i=a%60;return i===0?r+String(n):r+String(n)+s+Tt(i,2)}function mf(t,s){return t%60===0?(t>0?"-":"+")+Tt(Math.abs(t)/60,2):Oa(t,s)}function Oa(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=Tt(Math.trunc(a/60),2),i=Tt(a%60,2);return r+n+s+i}const hf=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},hw=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},SD=(t,s)=>{const r=t.match(/(P+)(p+)?/)||[],a=r[1],n=r[2];if(!n)return hf(t,s);let i;switch(a){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",hf(a,s)).replace("{{time}}",hw(n,s))},TD={p:hw,P:SD},AD=/^D+$/,CD=/^Y+$/,PD=["D","DD","YY","YYYY"];function _D(t){return AD.test(t)}function ED(t){return CD.test(t)}function DD(t,s,r){const a=MD(t,s,r);if(console.warn(a),PD.includes(t))throw new RangeError(a)}function MD(t,s,r){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${a} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const RD=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ID=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,FD=/^'([^]*?)'?$/,OD=/''/g,$D=/[a-zA-Z]/;function ff(t,s,r){const a=Cl(),n=r?.locale??a.locale??bD,i=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,o=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,l=Nr(t);if(!z5(l))throw new RangeError("Invalid time value");let u=s.match(ID).map(c=>{const f=c[0];if(f==="p"||f==="P"){const m=TD[f];return m(c,n.formatLong)}return c}).join("").match(RD).map(c=>{if(c==="''")return{isToken:!1,value:"'"};const f=c[0];if(f==="'")return{isToken:!1,value:LD(c)};if(df[f])return{isToken:!0,value:c};if(f.match($D))throw new RangeError("Format string contains an unescaped latin alphabet character `"+f+"`");return{isToken:!1,value:c}});n.localize.preprocessor&&(u=n.localize.preprocessor(l,u));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return u.map(c=>{if(!c.isToken)return c.value;const f=c.value;(!r?.useAdditionalWeekYearTokens&&ED(f)||!r?.useAdditionalDayOfYearTokens&&_D(f))&&DD(f,s,String(t));const m=df[f[0]];return m(l,f,n.localize,d)}).join("")}function LD(t){const s=t.match(FD);return s?s[1].replace(OD,"'"):t}const VD={lessThanXSeconds:{one:"أقل من ثانية",two:"أقل من ثانيتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانيتان",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتان",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريبا",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتان",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومان",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريبا",two:"أسبوعين تقريبا",threeToTen:"{{count}} أسابيع تقريبا",other:"{{count}} أسبوعا تقريبا"},xWeeks:{one:"أسبوع واحد",two:"أسبوعان",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوعا"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريبا",threeToTen:"{{count}} أشهر تقريبا",other:"{{count}} شهرا تقريباً"},xMonths:{one:"شهر واحد",two:"شهران",threeToTen:"{{count}} أشهر",other:"{{count}} شهرا"},aboutXYears:{one:"سنة واحدة تقريباً",two:"سنتين تقريبا",threeToTen:"{{count}} سنوات تقريباً",other:"{{count}} سنة تقريباً"},xYears:{one:"سنة واحد",two:"سنتان",threeToTen:"{{count}} سنوات",other:"{{count}} سنة"},overXYears:{one:"أكثر من سنة",two:"أكثر من سنتين",threeToTen:"أكثر من {{count}} سنوات",other:"أكثر من {{count}} سنة"},almostXYears:{one:"ما يقارب سنة واحدة",two:"ما يقارب سنتين",threeToTen:"ما يقارب {{count}} سنوات",other:"ما يقارب {{count}} سنة"}},zD=(t,s,r)=>{const a=VD[t];let n;return typeof a=="string"?n=a:s===1?n=a.one:s===2?n=a.two:s<=10?n=a.threeToTen.replace("{{count}}",String(s)):n=a.other.replace("{{count}}",String(s)),r?.addSuffix?r.comparison&&r.comparison>0?"خلال "+n:"منذ "+n:n},BD={full:"EEEE، do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},qD={full:"HH:mm:ss",long:"HH:mm:ss",medium:"HH:mm:ss",short:"HH:mm"},UD={full:"{{date}} 'عند الساعة' {{time}}",long:"{{date}} 'عند الساعة' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},WD={date:wn({formats:BD,defaultWidth:"full"}),time:wn({formats:qD,defaultWidth:"full"}),dateTime:wn({formats:UD,defaultWidth:"full"})},KD={lastWeek:"eeee 'الماضي عند الساعة' p",yesterday:"'الأمس عند الساعة' p",today:"'اليوم عند الساعة' p",tomorrow:"'غدا عند الساعة' p",nextWeek:"eeee 'القادم عند الساعة' p",other:"P"},HD=t=>KD[t],GD={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},QD={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},XD={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},ZD={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},YD={narrow:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"}},JD={narrow:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"}},eM=t=>String(t),tM={ordinalNumber:eM,era:Tr({values:GD,defaultWidth:"wide"}),quarter:Tr({values:QD,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Tr({values:XD,defaultWidth:"wide"}),day:Tr({values:ZD,defaultWidth:"wide"}),dayPeriod:Tr({values:YD,defaultWidth:"wide",formattingValues:JD,defaultFormattingWidth:"wide"})},sM=/^(\d+)(th|st|nd|rd)?/i,rM=/\d+/i,aM={narrow:/[قب]/,abbreviated:/[قب]\.م\./,wide:/(قبل|بعد) الميلاد/},nM={any:[/قبل/,/بعد/]},iM={narrow:/^[1234]/i,abbreviated:/ر[1234]/,wide:/الربع (الأول|الثاني|الثالث|الرابع)/},oM={any:[/1/i,/2/i,/3/i,/4/i]},lM={narrow:/^[أيفمسند]/,abbreviated:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/,wide:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/},cM={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^يناير/i,/^فبراير/i,/^مارس/i,/^أبريل/i,/^مايو/i,/^يونيو/i,/^يوليو/i,/^أغسطس/i,/^سبتمبر/i,/^أكتوبر/i,/^نوفمبر/i,/^ديسمبر/i]},dM={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},uM={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},mM={narrow:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/,any:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/},hM={any:{am:/^ص/,pm:/^م/,midnight:/منتصف الليل/,noon:/الظهر/,afternoon:/بعد الظهر/,morning:/في الصباح/,evening:/في المساء/,night:/في الليل/}},fM={ordinalNumber:uw({matchPattern:sM,parsePattern:rM,valueCallback:t=>parseInt(t,10)}),era:Ar({matchPatterns:aM,defaultMatchWidth:"wide",parsePatterns:nM,defaultParseWidth:"any"}),quarter:Ar({matchPatterns:iM,defaultMatchWidth:"wide",parsePatterns:oM,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Ar({matchPatterns:lM,defaultMatchWidth:"wide",parsePatterns:cM,defaultParseWidth:"any"}),day:Ar({matchPatterns:dM,defaultMatchWidth:"wide",parsePatterns:uM,defaultParseWidth:"any"}),dayPeriod:Ar({matchPatterns:mM,defaultMatchWidth:"any",parsePatterns:hM,defaultParseWidth:"any"})},pf={code:"ar",formatDistance:zD,formatLong:WD,formatRelative:HD,localize:tM,match:fM,options:{weekStartsOn:6,firstWeekContainsDate:1}},xf=({stats:t,columns:s=4})=>{const r=`grid grid-cols-1 sm:grid-cols-2 ${s===3?"lg:grid-cols-3":s===4?"lg:grid-cols-4":"lg:grid-cols-2"} gap-3 sm:gap-4`;return e.jsx("div",{className:r,children:t.map((a,n)=>e.jsx(et,{title:a.title,value:a.value,icon:a.icon,color:a.color,formatter:a.formatter},n))})};function pM(){const[t,s]=h.useState(""),[r,a]=h.useState("all"),[n,i]=h.useState(""),{data:o=[]}=ge({queryKey:["/api/projects"]}),{data:l=[],isLoading:u,error:d}=ge({queryKey:["/api/projects",t,"fund-transfers"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب تحويلات العهدة للمشروع: ${t}`);const j=await fetch(`/api/projects/${t}/fund-transfers`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!j.ok)return j.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب تحويلات العهدة: ${j.status}`),[]);const V=await j.json();return console.log(`✅ تم جلب ${Array.isArray(V?.data)?V.data.length:0} تحويل عهدة`),Array.isArray(V?.data)?V.data:[]}catch(j){return console.error("❌ خطأ في جلب تحويلات العهدة:",j),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:c=[],isLoading:f,error:m}=ge({queryKey:["/api/projects",t,"fund-transfers","incoming"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب التحويلات الواردة للمشروع: ${t}`);const j=await fetch(`/api/projects/fund-transfers/incoming/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!j.ok)return j.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب التحويلات الواردة: ${j.status}`),[]);const V=await j.json(),ne=Array.isArray(V?.data)?V.data:Array.isArray(V)?V:[];return console.log(`✅ تم جلب ${ne.length} تحويل وارد فعلي`),ne.length>0&&console.log("🔍 التحويلات الواردة:",ne.map(F=>({من:F.fromProjectName,إلى:F.toProjectName,المبلغ:F.amount,التاريخ:F.transferDate}))),ne}catch(j){return console.error("❌ خطأ في جلب التحويلات الواردة:",j),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:y=[],isLoading:x,error:p}=ge({queryKey:["/api/projects",t,"fund-transfers","outgoing"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب التحويلات الصادرة للمشروع: ${t}`);const j=await fetch(`/api/projects/fund-transfers/outgoing/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!j.ok)return j.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب التحويلات الصادرة: ${j.status}`),[]);const V=await j.json(),ne=Array.isArray(V?.data)?V.data:Array.isArray(V)?V:[];return console.log(`✅ تم جلب ${ne.length} تحويل صادر فعلي`),ne.length>0&&console.log("🔍 التحويلات الصادرة:",ne.map(F=>({من:F.fromProjectName,إلى:F.toProjectName,المبلغ:F.amount,التاريخ:F.transferDate}))),ne}catch(j){return console.error("❌ خطأ في جلب التحويلات الصادرة:",j),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:A=[],isLoading:g,error:N}=ge({queryKey:["/api/projects",t,"attendance"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب حضور العمال للمشروع: ${t}`);const j=await fetch(`/api/projects/${t}/worker-attendance`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!j.ok)return j.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب حضور العمال: ${j.status}`),[]);const V=await j.json();return console.log(`✅ تم جلب ${Array.isArray(V?.data)?V.data.length:0} سجل حضور`),Array.isArray(V?.data)?V.data:[]}catch(j){return console.error("❌ خطأ في جلب حضور العمال:",j),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:w=[],isLoading:_,error:b}=ge({queryKey:["/api/projects",t,"material-purchases"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب مشتريات المواد للمشروع: ${t}`);const j=await fetch(`/api/projects/${t}/material-purchases`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!j.ok)return j.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب مشتريات المواد: ${j.status}`),[]);const V=await j.json();return console.log(`✅ تم جلب ${Array.isArray(V?.data)?V.data.length:0} مشترية مواد`),Array.isArray(V?.data)?V.data:[]}catch(j){return console.error("❌ خطأ في جلب مشتريات المواد:",j),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:k=[]}=ge({queryKey:["/api/projects",t,"transportation-expenses"],enabled:!!t}),{data:R=[]}=ge({queryKey:["/api/projects",t,"worker-misc-expenses"],enabled:!!t}),{data:I=[],isLoading:E,error:O}=ge({queryKey:["/api/projects",t,"worker-transfers"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب حوالات العمال للمشروع: ${t}`);const j=await fetch(`/api/projects/${t}/worker-transfers`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!j.ok)return j.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب حوالات العمال: ${j.status}`),[]);const V=await j.json();return console.log(`✅ تم جلب ${Array.isArray(V?.data)?V.data.length:Array.isArray(V)?V.length:0} حولة عمال`),Array.isArray(V?.data)?V.data:Array.isArray(V)?V:[]}catch(j){return console.error("❌ خطأ في جلب حوالات العمال:",j),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:T=[]}=ge({queryKey:["/api/workers"]}),S=h.useMemo(()=>{const j=[],V=Array.isArray(l)?l:[],ne=Array.isArray(c)?c:[],F=Array.isArray(y)?y:[],ye=Array.isArray(A)?A:[],fe=Array.isArray(w)?w:[],de=Array.isArray(k)?k:[],ke=Array.isArray(R)?R:[],nt=Array.isArray(I)?I:[],ct=Array.isArray(T)?T:[];console.log(`🎯 بدء معالجة البيانات للمشروع ${t}`),console.log("📊 البيانات المتاحة:",{fundTransfers:V?.length||0,incomingProjectTransfers:ne?.length||0,outgoingProjectTransfers:F?.length||0,workerAttendance:ye?.length||0,materialPurchases:fe?.length||0,transportExpenses:de?.length||0,miscExpenses:ke?.length||0}),V.length+ne.length+F.length+ye.length+fe.length+de.length+ke.length,V.forEach(Z=>{const U=Z.transferDate,Y=parseFloat(Z.amount);U&&!isNaN(Y)&&Y>0&&j.push({id:`fund-${Z.id}`,date:U,type:"income",category:"تحويل عهدة",amount:Y,description:`من: ${Z.senderName||"غير محدد"}`})}),ne.length>0?(console.log(`📥 معالجة ${ne.length} تحويل وارد`),ne.forEach(Z=>{const U=Z.transferDate,Y=parseFloat(Z.amount);U&&!isNaN(Y)&&Y>0&&(console.log(`💰 إضافة تحويل وارد: ${Y} من ${Z.fromProjectName}`),j.push({id:`project-in-${Z.id}`,date:U,type:"transfer_from_project",category:"تحويل من مشروع آخر",amount:Y,description:`من: ${Z.fromProjectName||"مشروع آخر"}`}))})):console.log(`📥 لا توجد تحويلات واردة للمشروع ${t}`),F.length>0?(console.log(`📤 معالجة ${F.length} تحويل صادر`),F.forEach(Z=>{const U=Z.transferDate,Y=parseFloat(Z.amount);U&&!isNaN(Y)&&Y>0&&(console.log(`💸 إضافة تحويل صادر: ${Y} إلى ${Z.toProjectName}`),j.push({id:`project-out-${Z.id}`,date:U,type:"expense",category:"تحويل إلى مشروع آخر",amount:Y,description:`إلى: ${Z.toProjectName||"مشروع آخر"}`}))})):console.log(`📤 لا توجد تحويلات صادرة للمشروع ${t}`),console.log("🔍 معالجة أجور العمال - العدد:",ye.length),ye.length>0&&console.log("🔍 أول عنصر من بيانات أجور العمال:",JSON.stringify(ye[0],null,2)),ye.forEach((Z,U)=>{console.log("🔍 معالجة العامل رقم ${index + 1}:",Z);const Y=Z.date||Z.attendanceDate||Z.created_at;console.log("📅 التاريخ المستخرج:",Y),console.log("🔍 جميع الحقول المتاحة:",Object.keys(Z));let Ae=0;if(Z.paidAmount!==void 0&&Z.paidAmount!==null&&Z.paidAmount!==""){const pt=parseFloat(Z.paidAmount);isNaN(pt)||(Ae=Math.max(0,pt),console.log("💰 المبلغ المدفوع فعلياً:",Ae))}if(console.log("✅ النتيجة النهائية:",{date:Y,amount:Ae,hasDate:!!Y,hasAmount:Ae>=0,willAdd:!!Y}),Y){const jt=(Array.isArray(ct)?ct.find(X=>X.id===Z.workerId):void 0)?.name||Z.workerName||Z.worker?.name||Z.name||"غير محدد",Ve=Z.workDays?` (${Z.workDays} يوم)`:"",kt=Z.dailyWage?` - أجر يومي: ${Me(parseFloat(Z.dailyWage))}`:"",ps=Ae===0?" (لم يُدفع)":"",ks={id:`wage-${Z.id}`,date:Y,type:"expense",category:"أجور العمال",amount:Ae,description:`${jt}${Ve}${kt}${ps}`};console.log("✅ إضافة معاملة أجور العمال:",ks),j.push(ks)}else console.log(`❌ تم تخطي العامل ${Z.workerName||Z.name||"غير معروف"} - السبب: التاريخ مفقود`,{missingDate:!Y,originalData:Z})}),fe.forEach(Z=>{const U=Z.purchaseDate||Z.date;let Y=0;if(Z.totalAmount&&!isNaN(parseFloat(Z.totalAmount))?Y=parseFloat(Z.totalAmount):Z.amount&&!isNaN(parseFloat(Z.amount))?Y=parseFloat(Z.amount):Z.cost&&!isNaN(parseFloat(Z.cost))&&(Y=parseFloat(Z.cost)),U&&Y>0){const Ae=Z.purchaseType==="آجل"||Z.paymentType==="deferred"||Z.isDeferred||Z.deferred;j.push({id:`material-${Z.id}`,date:U,type:Ae?"deferred":"expense",category:Ae?"مشتريات آجلة":"مشتريات المواد",amount:Y,description:`مادة: ${Z.materialName||Z.name||"غير محدد"}${Ae?" (آجل)":""}`})}}),de.forEach(Z=>{const U=Z.date,Y=parseFloat(Z.amount);U&&!isNaN(Y)&&Y>0&&j.push({id:`transport-${Z.id}`,date:U,type:"expense",category:"مصروفات النقل",amount:Y,description:`نقل: ${Z.description||"غير محدد"}`})}),ke.forEach(Z=>{const U=Z.date,Y=parseFloat(Z.amount);U&&!isNaN(Y)&&Y>0&&j.push({id:`misc-${Z.id}`,date:U,type:"expense",category:"مصروفات متنوعة",amount:Y,description:`متنوع: ${Z.description||Z.workerName||"غير محدد"}`})}),nt.forEach(Z=>{const U=Z.date||Z.transferDate,Y=parseFloat(Z.amount);if(U&&!isNaN(Y)&&Y>0){const pt=(Array.isArray(ct)?ct.find(kt=>kt.id===Z.workerId):void 0)?.name||Z.workerName||"عامل غير معروف",jt=Z.recipientName?` - المستلم: ${Z.recipientName}`:"",Ve=Z.transferMethod==="hawaleh"?"حولة":Z.transferMethod==="bank"?"تحويل بنكي":"نقداً";j.push({id:`worker-transfer-${Z.id}`,date:U,type:"expense",category:"حوالات العمال",amount:Y,description:`${pt}${jt} - ${Ve}`})}});const it=j.filter(Z=>Z.date&&!isNaN(new Date(Z.date).getTime())).sort((Z,U)=>new Date(U.date).getTime()-new Date(Z.date).getTime());return console.log(`✅ معاملات نهائية: ${it.length} من أصل ${j.length}`),console.log("🔍 تفاصيل المعاملات النهائية:",{income:it.filter(Z=>Z.type==="income").length,transfer_from_project:it.filter(Z=>Z.type==="transfer_from_project").length,expense:it.filter(Z=>Z.type==="expense").length,deferred:it.filter(Z=>Z.type==="deferred").length,workerWages:it.filter(Z=>Z.category==="أجور العمال").length,workerTransfers:it.filter(Z=>Z.category==="حوالات العمال").length,outgoingTransfers:it.filter(Z=>Z.category==="تحويل إلى مشروع آخر").length}),it},[l,c,y,A,w,k,R,I,T]),M=h.useMemo(()=>{let j=S;return r!=="all"&&(j=j.filter(V=>V.type===r)),n&&(j=j.filter(V=>V.description.toLowerCase().includes(n.toLowerCase())||V.category.toLowerCase().includes(n.toLowerCase()))),j},[S,r,n]),v=h.useMemo(()=>{const j=M.filter(ke=>ke.type==="income").reduce((ke,nt)=>ke+(nt.amount||0),0),V=M.filter(ke=>ke.type==="transfer_from_project").reduce((ke,nt)=>ke+(nt.amount||0),0),ne=M.filter(ke=>ke.type==="expense").reduce((ke,nt)=>ke+(nt.amount||0),0),F=M.filter(ke=>ke.category==="تحويل إلى مشروع آخر").reduce((ke,nt)=>ke+(nt.amount||0),0),ye=ne-F,fe=j+V,de=ne;return console.log("💰 تفاصيل الحسابات:",{income:j,transferFromProject:V,otherExpenses:ye,transferToProjectExpenses:F,totalIncome:fe,totalExpenses:de,balance:fe-de}),{income:j,transferFromProject:V,otherExpenses:ye,transferToProjectExpenses:F,totalIncome:fe,expenses:de,totalExpenses:de,balance:fe-de}},[M]),W=Array.isArray(o)&&o.find(j=>j.id===t)?.name||"";return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-2 sm:p-4",dir:"rtl",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-3 sm:space-y-4",children:[e.jsx(q,{className:"shadow-sm",children:e.jsx(H,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600 dark:text-gray-400",children:"المشروع"}),e.jsxs(qe,{value:t,onValueChange:s,children:[e.jsx(Oe,{className:"h-9 text-sm",children:e.jsx(Ue,{placeholder:"اختر مشروعاً"})}),e.jsx($e,{children:o.map(j=>e.jsx(K,{value:j.id,children:j.name},j.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600 dark:text-gray-400",children:"نوع العملية"}),e.jsxs(qe,{value:r,onValueChange:a,children:[e.jsx(Oe,{className:"h-9 text-sm",children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع العمليات"}),e.jsx(K,{value:"income",children:"الدخل فقط"}),e.jsx(K,{value:"transfer_from_project",children:"التحويلات من المشاريع"}),e.jsx(K,{value:"expense",children:"المصاريف فقط"}),e.jsx(K,{value:"deferred",children:"المشتريات الآجلة"})]})]})]}),e.jsxs("div",{className:"sm:col-span-2 lg:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600 dark:text-gray-400",children:"البحث"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-3 w-3"}),e.jsx(be,{placeholder:"ابحث في الوصف...",value:n,onChange:j=>i(j.target.value),className:"pr-8 h-9 text-sm"})]})]})]})})}),t&&e.jsxs(e.Fragment,{children:[(d||N||b||O||m||p)&&e.jsx(q,{className:"bg-red-50 border-red-200 mb-4",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"text-red-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"⚠️ تحذيرات في جلب البيانات:"}),d&&e.jsx("p",{children:"• خطأ في جلب تحويلات العهدة"}),N&&e.jsx("p",{children:"• خطأ في جلب حضور العمال"}),b&&e.jsx("p",{children:"• خطأ في جلب مشتريات المواد"}),O&&e.jsx("p",{children:"• خطأ في جلب حوالات العمال"}),m&&e.jsx("p",{children:"• خطأ في جلب التحويلات الواردة"}),p&&e.jsx("p",{children:"• خطأ في جلب التحويلات الصادرة"}),e.jsx("p",{className:"text-sm mt-2 text-red-600",children:"يرجى التحقق من اتصالك بالإنترنت أو تسجيل الدخول مرة أخرى."})]})})}),(u||g||_||E||f||x)&&e.jsx(q,{className:"bg-blue-50 border-blue-200 mb-4",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-blue-800",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"}),e.jsx("span",{children:"جاري تحميل البيانات المالية..."})]})})}),e.jsx(xf,{stats:[{title:"الدخل المباشر",value:Me(v.income||0),icon:Kt,color:"green"},{title:"من مشاريع أخرى",value:Me(v.transferFromProject||0),icon:ii,color:"teal"},{title:"إجمالي المصاريف",value:Me(v.totalExpenses||0),icon:An,color:"red"},{title:"الرصيد النهائي",value:Me(v.balance||0),icon:us,color:v.balance>=0?"blue":"orange"}],columns:4}),e.jsx(xf,{stats:[{title:"المشتريات الآجلة",value:`${Me(0)} (لا تُحسب في الرصيد)`,icon:Ut,color:"amber"}],columns:2}),e.jsxs(q,{className:"shadow-sm",children:[e.jsx(ue,{className:"p-3 sm:p-4 pb-2 sm:pb-3",children:e.jsxs(pe,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("span",{className:"text-base sm:text-lg font-semibold truncate",children:["سجل العمليات ",W&&`- ${W}`]}),e.jsxs(le,{variant:"outline",className:"text-xs px-2 py-1",children:[M.length," عملية"]})]})}),e.jsx(H,{className:"p-0",children:M.length===0?e.jsx("div",{className:"text-center py-6 sm:py-8 px-4",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 sm:p-6 border border-blue-200 dark:border-blue-800",children:[e.jsx(ii,{className:"h-10 w-10 sm:h-12 sm:w-12 text-blue-400 mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-blue-800 dark:text-blue-300 mb-2",children:"لا توجد عمليات مالية"}),e.jsx("p",{className:"text-sm sm:text-base text-blue-600 dark:text-blue-400 mb-3 sm:mb-4",children:t?"هذا المشروع لا يحتوي على عمليات مالية مسجلة بعد":"يرجى اختيار مشروع لعرض العمليات المالية الخاصة به"}),e.jsxs("div",{className:"text-xs sm:text-sm text-blue-500 dark:text-blue-400",children:["💡 نصيحة: تأكد من إدخال البيانات التالية للمشروع:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"تحويلات العهدة"}),e.jsx("li",{children:"أجور العمال"}),e.jsx("li",{children:"مشتريات المواد"}),e.jsx("li",{children:"مصروفات النقل"}),e.jsx("li",{children:"المصروفات المتنوعة"})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:hidden space-y-2 p-3",children:M.map((j,V)=>e.jsx(q,{className:"bg-white dark:bg-gray-800 shadow-sm border",children:e.jsx(H,{className:"p-3",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{variant:j.type==="income"?"default":j.type==="transfer_from_project"?"secondary":j.type==="deferred"?"outline":"destructive",className:`text-xs px-2 py-0.5 flex-shrink-0 ${j.type==="income"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":j.type==="transfer_from_project"?"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-300":j.type==="deferred"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:j.type==="income"?"دخل":j.type==="transfer_from_project"?"تحويل":j.type==="deferred"?"آجل":"مصروف"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:ff(new Date(j.date),"dd/MM/yyyy",{locale:pf})})]}),e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 truncate",children:j.category}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2",children:j.description})]}),e.jsx("div",{className:"text-left flex-shrink-0 ml-2",children:e.jsx("p",{className:`text-sm font-bold ${j.type==="income"||j.type==="transfer_from_project"?"text-green-600 dark:text-green-400":j.type==="deferred"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:Me(j.amount)})})]})})},j.id))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50 dark:bg-gray-800",children:[e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"التاريخ"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"النوع"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"الفئة"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"المبلغ"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"الوصف"})]})}),e.jsx("tbody",{children:M.map((j,V)=>e.jsxs("tr",{className:`border-b ${V%2===0?"bg-white dark:bg-gray-900":"bg-gray-50 dark:bg-gray-800"} hover:bg-gray-100 dark:hover:bg-gray-700`,children:[e.jsx("td",{className:"py-3 px-4 text-sm",children:ff(new Date(j.date),"dd/MM/yyyy",{locale:pf})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(le,{variant:j.type==="income"?"default":j.type==="transfer_from_project"?"secondary":j.type==="deferred"?"outline":"destructive",className:j.type==="deferred"?"border-yellow-500 text-yellow-700 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20":j.type==="transfer_from_project"?"border-cyan-500 text-cyan-700 dark:text-cyan-400 bg-cyan-50 dark:bg-cyan-900/20":"",children:j.type==="income"?"دخل":j.type==="transfer_from_project"?"تحويل مشروع":j.type==="deferred"?"آجل":"مصروف"})}),e.jsx("td",{className:"py-3 px-4 text-sm font-medium",children:j.category}),e.jsxs("td",{className:`py-3 px-4 text-sm font-bold ${j.type==="income"?"text-green-600":j.type==="transfer_from_project"?"text-cyan-600":j.type==="deferred"?"text-yellow-600":"text-red-600"}`,children:[j.type==="income"||j.type==="transfer_from_project"?"+":j.type==="deferred"?"":"-",Me(j.amount||0).replace(" ر.ي","")," ر.ي"]}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:j.category==="أجور العمال"?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:j.description.split(" - أجر يومي:")[0]}),j.description.includes(" - أجر يومي:")&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:j.description.split(" - أجر يومي:")[1]?`أجر يومي: ${j.description.split(" - أجر يومي:")[1]}`:""})]}):j.description})]},j.id))})]})})]})})]})]})]})})}var xM="DismissableLayer",ed="dismissableLayer.update",gM="dismissableLayer.pointerDownOutside",yM="dismissableLayer.focusOutside",gf,fw=h.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),pw=h.forwardRef((t,s)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:a,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:l,...u}=t,d=h.useContext(fw),[c,f]=h.useState(null),m=c?.ownerDocument??globalThis?.document,[,y]=h.useState({}),x=lt(s,R=>f(R)),p=Array.from(d.layers),[A]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),g=p.indexOf(A),N=c?p.indexOf(c):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,_=N>=g,b=jM(R=>{const I=R.target,E=[...d.branches].some(O=>O.contains(I));!_||E||(n?.(R),o?.(R),R.defaultPrevented||l?.())},m),k=NM(R=>{const I=R.target;[...d.branches].some(O=>O.contains(I))||(i?.(R),o?.(R),R.defaultPrevented||l?.())},m);return rl(R=>{N===d.layers.size-1&&(a?.(R),!R.defaultPrevented&&l&&(R.preventDefault(),l()))},m),h.useEffect(()=>{if(c)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(gf=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(c)),d.layers.add(c),yf(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=gf)}},[c,m,r,d]),h.useEffect(()=>()=>{c&&(d.layers.delete(c),d.layersWithOutsidePointerEventsDisabled.delete(c),yf())},[c,d]),h.useEffect(()=>{const R=()=>y({});return document.addEventListener(ed,R),()=>document.removeEventListener(ed,R)},[]),e.jsx(We.div,{...u,ref:x,style:{pointerEvents:w?_?"auto":"none":void 0,...t.style},onFocusCapture:Ne(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ne(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ne(t.onPointerDownCapture,b.onPointerDownCapture)})});pw.displayName=xM;var vM="DismissableLayerBranch",bM=h.forwardRef((t,s)=>{const r=h.useContext(fw),a=h.useRef(null),n=lt(s,a);return h.useEffect(()=>{const i=a.current;if(i)return r.branches.add(i),()=>{r.branches.delete(i)}},[r.branches]),e.jsx(We.div,{...t,ref:n})});bM.displayName=vM;function jM(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1),n=h.useRef(()=>{});return h.useEffect(()=>{const i=l=>{if(l.target&&!a.current){let u=function(){xw(gM,r,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(s.removeEventListener("click",n.current),n.current=u,s.addEventListener("click",n.current,{once:!0})):u()}else s.removeEventListener("click",n.current);a.current=!1},o=window.setTimeout(()=>{s.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),s.removeEventListener("pointerdown",i),s.removeEventListener("click",n.current)}},[s,r]),{onPointerDownCapture:()=>a.current=!0}}function NM(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1);return h.useEffect(()=>{const n=i=>{i.target&&!a.current&&xw(yM,r,{originalEvent:i},{discrete:!1})};return s.addEventListener("focusin",n),()=>s.removeEventListener("focusin",n)},[s,r]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function yf(){const t=new CustomEvent(ed);document.dispatchEvent(t)}function xw(t,s,r,{discrete:a}){const n=r.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});s&&n.addEventListener(t,s,{once:!0}),a?Vi(n,i):n.dispatchEvent(i)}var uc="focusScope.autoFocusOnMount",mc="focusScope.autoFocusOnUnmount",vf={bubbles:!1,cancelable:!0},wM="FocusScope",gw=h.forwardRef((t,s)=>{const{loop:r=!1,trapped:a=!1,onMountAutoFocus:n,onUnmountAutoFocus:i,...o}=t,[l,u]=h.useState(null),d=Lt(n),c=Lt(i),f=h.useRef(null),m=lt(s,p=>u(p)),y=h.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;h.useEffect(()=>{if(a){let p=function(w){if(y.paused||!l)return;const _=w.target;l.contains(_)?f.current=_:ua(f.current,{select:!0})},A=function(w){if(y.paused||!l)return;const _=w.relatedTarget;_!==null&&(l.contains(_)||ua(f.current,{select:!0}))},g=function(w){if(document.activeElement===document.body)for(const b of w)b.removedNodes.length>0&&ua(l)};document.addEventListener("focusin",p),document.addEventListener("focusout",A);const N=new MutationObserver(g);return l&&N.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",A),N.disconnect()}}},[a,l,y.paused]),h.useEffect(()=>{if(l){jf.add(y);const p=document.activeElement;if(!l.contains(p)){const g=new CustomEvent(uc,vf);l.addEventListener(uc,d),l.dispatchEvent(g),g.defaultPrevented||(kM(PM(yw(l)),{select:!0}),document.activeElement===p&&ua(l))}return()=>{l.removeEventListener(uc,d),setTimeout(()=>{const g=new CustomEvent(mc,vf);l.addEventListener(mc,c),l.dispatchEvent(g),g.defaultPrevented||ua(p??document.body,{select:!0}),l.removeEventListener(mc,c),jf.remove(y)},0)}}},[l,d,c,y]);const x=h.useCallback(p=>{if(!r&&!a||y.paused)return;const A=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,g=document.activeElement;if(A&&g){const N=p.currentTarget,[w,_]=SM(N);w&&_?!p.shiftKey&&g===_?(p.preventDefault(),r&&ua(w,{select:!0})):p.shiftKey&&g===w&&(p.preventDefault(),r&&ua(_,{select:!0})):g===N&&p.preventDefault()}},[r,a,y.paused]);return e.jsx(We.div,{tabIndex:-1,...o,ref:m,onKeyDown:x})});gw.displayName=wM;function kM(t,{select:s=!1}={}){const r=document.activeElement;for(const a of t)if(ua(a,{select:s}),document.activeElement!==r)return}function SM(t){const s=yw(t),r=bf(s,t),a=bf(s.reverse(),t);return[r,a]}function yw(t){const s=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const n=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||n?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)s.push(r.currentNode);return s}function bf(t,s){for(const r of t)if(!TM(r,{upTo:s}))return r}function TM(t,{upTo:s}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(s!==void 0&&t===s)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function AM(t){return t instanceof HTMLInputElement&&"select"in t}function ua(t,{select:s=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&AM(t)&&s&&t.select()}}var jf=CM();function CM(){let t=[];return{add(s){const r=t[0];s!==r&&r?.pause(),t=Nf(t,s),t.unshift(s)},remove(s){t=Nf(t,s),t[0]?.resume()}}}function Nf(t,s){const r=[...t],a=r.indexOf(s);return a!==-1&&r.splice(a,1),r}function PM(t){return t.filter(s=>s.tagName!=="A")}var _M="Portal",vw=h.forwardRef((t,s)=>{const{container:r,...a}=t,[n,i]=h.useState(!1);cl(()=>i(!0),[]);const o=r||n&&globalThis?.document?.body;return o?ud.createPortal(e.jsx(We.div,{...a,ref:s}),o):null});vw.displayName=_M;var ku="Dialog",[bw,jw]=Hs(ku),[EM,wr]=bw(ku),Nw=t=>{const{__scopeDialog:s,children:r,open:a,defaultOpen:n,onOpenChange:i,modal:o=!0}=t,l=h.useRef(null),u=h.useRef(null),[d=!1,c]=Pa({prop:a,defaultProp:n,onChange:i});return e.jsx(EM,{scope:s,triggerRef:l,contentRef:u,contentId:pa(),titleId:pa(),descriptionId:pa(),open:d,onOpenChange:c,onOpenToggle:h.useCallback(()=>c(f=>!f),[c]),modal:o,children:r})};Nw.displayName=ku;var ww="DialogTrigger",kw=h.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,n=wr(ww,r),i=lt(s,n.triggerRef);return e.jsx(We.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Au(n.open),...a,ref:i,onClick:Ne(t.onClick,n.onOpenToggle)})});kw.displayName=ww;var Su="DialogPortal",[DM,Sw]=bw(Su,{forceMount:void 0}),Tw=t=>{const{__scopeDialog:s,forceMount:r,children:a,container:n}=t,i=wr(Su,s);return e.jsx(DM,{scope:s,forceMount:r,children:h.Children.map(a,o=>e.jsx(ws,{present:r||i.open,children:e.jsx(vw,{asChild:!0,container:n,children:o})}))})};Tw.displayName=Su;var Xo="DialogOverlay",Aw=h.forwardRef((t,s)=>{const r=Sw(Xo,t.__scopeDialog),{forceMount:a=r.forceMount,...n}=t,i=wr(Xo,t.__scopeDialog);return i.modal?e.jsx(ws,{present:a||i.open,children:e.jsx(RM,{...n,ref:s})}):null});Aw.displayName=Xo;var MM=hd("DialogOverlay.RemoveScroll"),RM=h.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,n=wr(Xo,r);return e.jsx(md,{as:MM,allowPinchZoom:!0,shards:[n.contentRef],children:e.jsx(We.div,{"data-state":Au(n.open),...a,ref:s,style:{pointerEvents:"auto",...a.style}})})}),Ja="DialogContent",Cw=h.forwardRef((t,s)=>{const r=Sw(Ja,t.__scopeDialog),{forceMount:a=r.forceMount,...n}=t,i=wr(Ja,t.__scopeDialog);return e.jsx(ws,{present:a||i.open,children:i.modal?e.jsx(IM,{...n,ref:s}):e.jsx(FM,{...n,ref:s})})});Cw.displayName=Ja;var IM=h.forwardRef((t,s)=>{const r=wr(Ja,t.__scopeDialog),a=h.useRef(null),n=lt(s,r.contentRef,a);return h.useEffect(()=>{const i=a.current;if(i)return fd(i)},[]),e.jsx(Pw,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ne(t.onCloseAutoFocus,i=>{i.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Ne(t.onPointerDownOutside,i=>{const o=i.detail.originalEvent,l=o.button===0&&o.ctrlKey===!0;(o.button===2||l)&&i.preventDefault()}),onFocusOutside:Ne(t.onFocusOutside,i=>i.preventDefault())})}),FM=h.forwardRef((t,s)=>{const r=wr(Ja,t.__scopeDialog),a=h.useRef(!1),n=h.useRef(!1);return e.jsx(Pw,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||r.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),Pw=h.forwardRef((t,s)=>{const{__scopeDialog:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,...o}=t,l=wr(Ja,r),u=h.useRef(null),d=lt(s,u);return pd(),e.jsxs(e.Fragment,{children:[e.jsx(gw,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(pw,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Au(l.open),...o,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx($M,{titleId:l.titleId}),e.jsx(VM,{contentRef:u,descriptionId:l.descriptionId})]})]})}),Tu="DialogTitle",_w=h.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,n=wr(Tu,r);return e.jsx(We.h2,{id:n.titleId,...a,ref:s})});_w.displayName=Tu;var Ew="DialogDescription",Dw=h.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,n=wr(Ew,r);return e.jsx(We.p,{id:n.descriptionId,...a,ref:s})});Dw.displayName=Ew;var Mw="DialogClose",Rw=h.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,n=wr(Mw,r);return e.jsx(We.button,{type:"button",...a,ref:s,onClick:Ne(t.onClick,()=>n.onOpenChange(!1))})});Rw.displayName=Mw;function Au(t){return t?"open":"closed"}var Iw="DialogTitleWarning",[OM,Fw]=dk(Iw,{contentName:Ja,titleName:Tu,docsSlug:"dialog"}),$M=({titleId:t})=>{const s=Fw(Iw),r=`\`${s.contentName}\` requires a \`${s.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${s.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${s.docsSlug}`;return h.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},LM="DialogDescriptionWarning",VM=({contentRef:t,descriptionId:s})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Fw(LM).contentName}}.`;return h.useEffect(()=>{const n=t.current?.getAttribute("aria-describedby");s&&n&&(document.getElementById(s)||console.warn(a))},[a,t,s]),null},zM=Nw,BM=kw,qM=Tw,UM=Aw,WM=Cw,KM=_w,HM=Dw,Ow=Rw,$w="AlertDialog",[GM]=Hs($w,[jw]),ia=jw(),Lw=t=>{const{__scopeAlertDialog:s,...r}=t,a=ia(s);return e.jsx(zM,{...a,...r,modal:!0})};Lw.displayName=$w;var QM="AlertDialogTrigger",Vw=h.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=ia(r);return e.jsx(BM,{...n,...a,ref:s})});Vw.displayName=QM;var XM="AlertDialogPortal",zw=t=>{const{__scopeAlertDialog:s,...r}=t,a=ia(s);return e.jsx(qM,{...a,...r})};zw.displayName=XM;var ZM="AlertDialogOverlay",Bw=h.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=ia(r);return e.jsx(UM,{...n,...a,ref:s})});Bw.displayName=ZM;var kn="AlertDialogContent",[YM,JM]=GM(kn),e6=I0("AlertDialogContent"),qw=h.forwardRef((t,s)=>{const{__scopeAlertDialog:r,children:a,...n}=t,i=ia(r),o=h.useRef(null),l=lt(s,o),u=h.useRef(null);return e.jsx(OM,{contentName:kn,titleName:Uw,docsSlug:"alert-dialog",children:e.jsx(YM,{scope:r,cancelRef:u,children:e.jsxs(WM,{role:"alertdialog",...i,...n,ref:l,onOpenAutoFocus:Ne(n.onOpenAutoFocus,d=>{d.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(e6,{children:a}),e.jsx(s6,{contentRef:o})]})})})});qw.displayName=kn;var Uw="AlertDialogTitle",Ww=h.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=ia(r);return e.jsx(KM,{...n,...a,ref:s})});Ww.displayName=Uw;var Kw="AlertDialogDescription",Hw=h.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=ia(r);return e.jsx(HM,{...n,...a,ref:s})});Hw.displayName=Kw;var t6="AlertDialogAction",Gw=h.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=ia(r);return e.jsx(Ow,{...n,...a,ref:s})});Gw.displayName=t6;var Qw="AlertDialogCancel",Xw=h.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,{cancelRef:n}=JM(Qw,r),i=ia(r),o=lt(s,n);return e.jsx(Ow,{...i,...a,ref:o})});Xw.displayName=Qw;var s6=({contentRef:t})=>{const s=`\`${kn}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${kn}\` by passing a \`${Kw}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${kn}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return h.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},r6=Lw,a6=Vw,n6=zw,Zw=Bw,Yw=qw,Jw=Gw,e1=Xw,t1=Ww,s1=Hw;const r1=r6,a1=a6,i6=n6,n1=h.forwardRef(({className:t,...s},r)=>e.jsx(Zw,{className:he("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));n1.displayName=Zw.displayName;const Cu=h.forwardRef(({className:t,...s},r)=>e.jsxs(i6,{children:[e.jsx(n1,{}),e.jsx(Yw,{ref:r,className:he("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));Cu.displayName=Yw.displayName;const Pu=({className:t,...s})=>e.jsx("div",{className:he("flex flex-col space-y-2 text-center sm:text-left",t),...s});Pu.displayName="AlertDialogHeader";const _u=({className:t,...s})=>e.jsx("div",{className:he("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});_u.displayName="AlertDialogFooter";const Eu=h.forwardRef(({className:t,...s},r)=>e.jsx(t1,{ref:r,className:he("text-lg font-semibold",t),...s}));Eu.displayName=t1.displayName;const Du=h.forwardRef(({className:t,...s},r)=>e.jsx(s1,{ref:r,className:he("text-sm text-muted-foreground",t),...s}));Du.displayName=s1.displayName;const Mu=h.forwardRef(({className:t,...s},r)=>e.jsx(Jw,{ref:r,className:he(wd(),t),...s}));Mu.displayName=Jw.displayName;const Ru=h.forwardRef(({className:t,...s},r)=>e.jsx(e1,{ref:r,className:he(wd({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));Ru.displayName=e1.displayName;const ei=t=>{if(t==null||t==="")return 0;if(typeof t=="number")return isNaN(t)||!isFinite(t)?0:Math.max(0,Math.floor(t));const s=String(t).trim();if(s===""||s==="null"||s==="undefined")return 0;const r=s.replace(/[^\d.-]/g,""),a=parseInt(r,10);return isNaN(a)||!isFinite(a)?0:Math.max(0,a)};function o6(){const{toast:t}=Ct(),s=Mt(),[r,a]=h.useState(null),[n,i]=h.useState(!1),[o,l]=h.useState(!1),{setFloatingAction:u}=Ls(),d=h.useRef(null),c=h.useRef(null),[f,m]=h.useState(null),[y,x]=h.useState(null),[p,A]=h.useState(null);h.useEffect(()=>(u(()=>i(!0),"إضافة مشروع جديد"),()=>u(null)),[u]);const{data:g=[],isLoading:N,refetch:w,error:_}=ge({queryKey:["/api/projects/with-stats"],queryFn:async()=>{try{console.log("📊 [Projects] جلب المشاريع مع الإحصائيات...");const U=await ae("/api/projects/with-stats","GET");console.log("📊 [Projects] استجابة المشاريع:",U);let Y=[];return U&&typeof U=="object"&&(U.success!==void 0&&U.data!==void 0?Y=Array.isArray(U.data)?U.data:[]:Array.isArray(U)?Y=U:U.id?Y=[U]:U.data&&(Y=Array.isArray(U.data)?U.data:[])),Array.isArray(Y)||(console.warn("⚠️ [Projects] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),Y=[]),console.log(`✅ [Projects] تم جلب ${Y.length} مشروع مع الإحصائيات`),Y}catch(U){return console.error("❌ [Projects] خطأ في جلب المشاريع:",U),[]}},refetchInterval:6e4,staleTime:3e4,refetchOnWindowFocus:!0,retry:(U,Y)=>Y?.status===401?!1:U<2,onError:U=>{console.error("❌ [Projects] خطأ في Query:",U),U?.status===401&&(console.log("🔄 [Projects] خطأ 401، إعادة التوجيه لتسجيل الدخول..."),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login")}}),b=Array.isArray(g)?g.filter(U=>U&&typeof U=="object"):[],k=va({resolver:ba(of),defaultValues:{name:"",status:"active",imageUrl:""}}),R=va({resolver:ba(of),defaultValues:{name:"",status:"active",imageUrl:""}}),I=async(U,Y)=>{if(!(!Y||typeof Y!="string"||!Y.trim()))try{await ae("/api/autocomplete","POST",{category:U,value:Y.trim()})}catch(Ae){console.log(`Failed to save autocomplete value for ${U}:`,Ae)}},E=U=>{if(U&&U.type.startsWith("image/")){const Y=new FileReader;Y.onload=Ae=>{const pt=Ae.target?.result;m(pt),k.setValue("imageUrl",pt)},Y.readAsDataURL(U)}else t({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"})},O=U=>{d.current&&(d.current.accept="image/*",U?d.current.setAttribute("capture","environment"):d.current.removeAttribute("capture"),d.current.click())},T=()=>{m(null),k.setValue("imageUrl",""),d.current&&(d.current.value="")},S=U=>{if(U&&U.type.startsWith("image/")){const Y=new FileReader;Y.onload=Ae=>{const pt=Ae.target?.result;x(pt),R.setValue("imageUrl",pt)},Y.readAsDataURL(U)}else t({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"})},M=U=>{c.current&&(c.current.accept="image/*",U?c.current.setAttribute("capture","environment"):c.current.removeAttribute("capture"),c.current.click())},v=()=>{x(null),R.setValue("imageUrl",""),c.current&&(c.current.value="")},W=Ce({mutationFn:U=>ae("/api/projects","POST",U),onSuccess:async(U,Y)=>{await I("projectNames",Y.name),s.invalidateQueries({queryKey:["/api/projects"]}),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم إنشاء المشروع بنجاح"}),i(!1),k.reset(),m(null),d.current&&(d.current.value="")},onError:U=>{t({title:"خطأ في إنشاء المشروع",description:U.message,variant:"destructive"})}}),j=Ce({mutationFn:({id:U,data:Y})=>ae(`/api/projects/${U}`,"PATCH",Y),onSuccess:async(U,Y)=>{await I("projectNames",Y.data.name),s.invalidateQueries({queryKey:["/api/projects"]}),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم تحديث المشروع بنجاح"}),l(!1),a(null),R.reset(),x(null),c.current&&(c.current.value="")},onError:U=>{t({title:"خطأ في تحديث المشروع",description:U.message,variant:"destructive"})}}),V=Ce({mutationFn:U=>ae(`/api/projects/${U}`,"DELETE"),onSuccess:()=>{s.invalidateQueries({queryKey:["/api/projects"]}),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم حذف المشروع بنجاح"})},onError:U=>{t({title:"خطأ في حذف المشروع",description:U.message,variant:"destructive"})}}),ne=U=>{W.mutate(U)},F=U=>{r&&j.mutate({id:r.id,data:U})},ye=U=>{V.mutate(U)},fe=U=>{a(U),R.reset({name:U.name,status:U.status,imageUrl:U.imageUrl||""}),x(U.imageUrl||null),l(!0)},de=U=>{switch(U){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"paused":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},ke=U=>{switch(U){case"active":return"نشط";case"completed":return"مكتمل";case"paused":return"متوقف";default:return U}};if(h.useEffect(()=>(u(()=>i(!0),"إضافة مشروع جديد"),()=>u(null)),[u]),N)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل المشاريع..."})]})});if(_)return console.error("❌ [Projects] خطأ في تحميل المشاريع:",_),e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:"خطأ في تحميل المشاريع"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"حدث خطأ أثناء جلب البيانات. يرجى المحاولة مرة أخرى."}),e.jsxs($,{onClick:()=>w(),className:"gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"إعادة المحاولة"]})]})});const nt=(U,Y=0)=>{if(U==null||U==="")return Y;if(typeof U=="number")return isNaN(U)||!isFinite(U)?Y:U;if(typeof U=="string"){const Ae=U.trim();if(Ae===""||Ae==="null"||Ae==="undefined"||Ae.match(/^(\d{1,3})\1{2,}$/))return Y;const pt=Ae.replace(/[^\d.-]/g,""),jt=parseFloat(pt);return isNaN(jt)||!isFinite(jt)?Y:jt}return Y},ct=h.useMemo(()=>{if(console.log("🔄 [Projects] حساب الإحصائيات العامة، عدد المشاريع:",b.length),!Array.isArray(b)||b.length===0)return console.log("⚠️ [Projects] لا توجد مشاريع للحساب"),{totalProjects:0,activeProjects:0,totalIncome:0,totalExpenses:0,totalWorkers:0,materialPurchases:0};const U=b.reduce((Y,Ae,pt)=>{if(!Ae||typeof Ae!="object")return console.warn(`⚠️ [Projects] مشروع ${pt} غير صحيح تم تخطيه:`,Ae),Y;const jt=Ae.stats||{};console.log(`📊 [Projects] مشروع "${Ae.name}":`,{totalIncome:jt.totalIncome,totalExpenses:jt.totalExpenses,totalWorkers:jt.totalWorkers,materialPurchases:jt.materialPurchases,status:Ae.status});const Ve=nt(jt.totalIncome,0),kt=nt(jt.totalExpenses,0),ps=ei(jt.totalWorkers),ks=ei(jt.materialPurchases);return console.log(`✅ [Projects] قيم منظفة للمشروع "${Ae.name}":`,{safeIncome:Ve,safeExpenses:kt,safeWorkers:ps,safePurchases:ks}),{totalProjects:Y.totalProjects+1,activeProjects:Y.activeProjects+(Ae.status==="active"?1:0),totalIncome:Y.totalIncome+Ve,totalExpenses:Y.totalExpenses+kt,totalWorkers:Y.totalWorkers+ps,materialPurchases:Y.materialPurchases+ks}},{totalProjects:0,activeProjects:0,totalIncome:0,totalExpenses:0,totalWorkers:0,materialPurchases:0});return console.log("✅ [Projects] إجمالي الإحصائيات المحسوبة:",U),U},[b]),it=ct.totalIncome-ct.totalExpenses,Z=Me;return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs(Sd,{children:[e.jsx(et,{title:"إجمالي المشاريع",value:ct.totalProjects.toString(),icon:Cs,color:"blue"}),e.jsx(et,{title:"المشاريع النشطة",value:ct.activeProjects.toString(),icon:Kt,color:"green"}),e.jsx(et,{title:"الرصيد الإجمالي",value:Z(it),icon:us,color:it>=0?"green":"red"}),e.jsx(et,{title:"إجمالي العمال",value:ct.totalWorkers.toString(),icon:_t,color:"purple"})]}),e.jsx(qs,{open:n,onOpenChange:i,children:e.jsxs(Fs,{children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:"إنشاء مشروع جديد"}),e.jsx(Ys,{children:"أدخل تفاصيل المشروع الجديد"})]}),e.jsx(ja,{...k,children:e.jsxs("form",{onSubmit:k.handleSubmit(ne),className:"space-y-4",children:[e.jsx(Nt,{control:k.control,name:"name",render:({field:U})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"اسم المشروع"}),e.jsx(vt,{children:e.jsx(Ft,{value:U.value,onChange:U.onChange,category:"projectNames",placeholder:"اسم المشروع"})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:k.control,name:"status",render:({field:U})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"حالة المشروع"}),e.jsxs(qe,{onValueChange:U.onChange,defaultValue:U.value,children:[e.jsx(vt,{children:e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر حالة المشروع"})})}),e.jsxs($e,{children:[e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"paused",children:"متوقف"}),e.jsx(K,{value:"completed",children:"مكتمل"})]})]}),e.jsx(bt,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(mt,{children:"صورة المشروع (اختيارية)"}),f?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f,alt:"صورة المشروع",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx($,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:T,children:e.jsx(yr,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(go,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"اختر صورة للمشروع"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>O(!0),children:[e.jsx(So,{className:"h-4 w-4 mr-2"}),"كاميرا"]}),e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>O(!1),children:[e.jsx(Ao,{className:"h-4 w-4 mr-2"}),"رفع صورة"]})]})]}),e.jsx("input",{ref:d,type:"file",accept:"image/*",className:"hidden",onChange:U=>{const Y=U.target.files?.[0];Y&&E(Y)}})]}),e.jsx(Cc,{children:e.jsx($,{type:"submit",disabled:W.isPending,children:W.isPending?"جاري الإنشاء...":"إنشاء المشروع"})})]})})]})}),b.length===0?e.jsxs(q,{className:"p-12 text-center",children:[e.jsx(Cs,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"لا توجد مشاريع"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"ابدأ بإنشاء مشروعك الأول"}),e.jsxs($,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"إنشاء مشروع جديد"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.isArray(b)?b.map(U=>e.jsxs(q,{className:"relative overflow-hidden hover:shadow-lg transition-shadow",children:[U.imageUrl?e.jsxs("div",{className:"relative h-48 overflow-hidden cursor-pointer group",children:[e.jsx("img",{src:U.imageUrl,alt:U.name,className:"w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",onClick:Y=>{Y.stopPropagation(),A(U.imageUrl)},onError:Y=>{const Ae=Y.target;Ae.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsxs("div",{className:"absolute bottom-3 left-3 flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500/80 rounded-full flex items-center justify-center",children:e.jsx(go,{className:"h-2 w-2 text-white"})}),e.jsx("span",{className:"text-xs text-white font-medium",children:"صورة المشروع"})]}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx(_r,{className:"text-white h-4 w-4"})})]}),e.jsx(le,{className:`absolute top-3 right-3 ${de(U.status)}`,children:ke(U.status)})]}):null,e.jsx(ue,{className:(U.imageUrl,"pb-3"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(pe,{className:"text-lg line-clamp-2",children:U.name}),e.jsxs(js,{className:"flex items-center gap-2",children:[e.jsx(Cr,{className:"h-3 w-3"}),"تم الإنشاء: ",Sr(U.createdAt)]})]}),!U.imageUrl&&e.jsx(le,{className:de(U.status),children:ke(U.status)})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Kt,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 dark:text-green-400",children:"الدخل"})]}),e.jsx("p",{className:"text-sm font-bold text-green-800 dark:text-green-300 arabic-numbers",children:Me(nt(U.stats.totalIncome,0))})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(us,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-xs font-medium text-red-700 dark:text-red-400",children:"المصروفات"})]}),e.jsx("p",{className:"text-sm font-bold text-red-800 dark:text-red-300 arabic-numbers",children:Me(nt(U.stats.totalExpenses,0))})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ls,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-400",children:"الرصيد الحالي"})]}),e.jsx("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-300 arabic-numbers",children:Me(nt(U.stats.currentBalance,0))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx(_t,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"العمال"}),e.jsx("p",{className:"text-sm font-semibold arabic-numbers",children:ei(U.stats.totalWorkers)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx(ra,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"المشتريات"}),e.jsx("p",{className:"text-sm font-semibold arabic-numbers",children:ei(U.stats.materialPurchases)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx(or,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"أيام العمل"}),e.jsx("p",{className:"text-sm font-semibold arabic-numbers",children:ei(U.stats.completedDays)})]})]}),U.stats.lastActivity&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Ut,{className:"h-3 w-3"}),"آخر نشاط: ",Sr(U.stats.lastActivity)]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>fe(U),className:"flex-1 gap-1",children:[e.jsx(To,{className:"h-3 w-3"}),"تعديل"]}),e.jsxs(r1,{children:[e.jsx(a1,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"sm",className:"gap-1 text-red-600 hover:text-red-700",children:[e.jsx(os,{className:"h-3 w-3"}),"حذف"]})}),e.jsxs(Cu,{children:[e.jsxs(Pu,{children:[e.jsx(Eu,{children:"تأكيد الحذف"}),e.jsxs(Du,{children:['هل أنت متأكد من حذف المشروع "',U.name,'"؟ سيتم حذف جميع البيانات المرتبطة بهذا المشروع ولا يمكن التراجع عن هذا الإجراء.']})]}),e.jsxs(_u,{children:[e.jsx(Ru,{children:"إلغاء"}),e.jsx(Mu,{onClick:()=>ye(U.id),className:"bg-red-600 hover:bg-red-700",children:"حذف المشروع"})]})]})]})]})]})]},U.id)):null}),e.jsx(qs,{open:o,onOpenChange:l,children:e.jsxs(Fs,{children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:"تعديل المشروع"}),e.jsx(Ys,{children:"تعديل تفاصيل المشروع"})]}),e.jsx(ja,{...R,children:e.jsxs("form",{onSubmit:R.handleSubmit(F),className:"space-y-4",children:[e.jsx(Nt,{control:R.control,name:"name",render:({field:U})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"اسم المشروع"}),e.jsx(vt,{children:e.jsx(Ft,{value:U.value,onChange:U.onChange,category:"projectNames",placeholder:"اسم المشروع"})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:R.control,name:"status",render:({field:U})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"حالة المشروع"}),e.jsxs(qe,{onValueChange:U.onChange,value:U.value,children:[e.jsx(vt,{children:e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر حالة المشروع"})})}),e.jsxs($e,{children:[e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"paused",children:"متوقف"}),e.jsx(K,{value:"completed",children:"مكتمل"})]})]}),e.jsx(bt,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(mt,{children:"صورة المشروع (اختيارية)"}),y?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:y,alt:"صورة المشروع",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx($,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:v,children:e.jsx(yr,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(go,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"اختر صورة للمشروع"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>M(!0),children:[e.jsx(So,{className:"h-4 w-4 mr-2"}),"كاميرا"]}),e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>M(!1),children:[e.jsx(Ao,{className:"h-4 w-4 mr-2"}),"رفع صورة"]})]})]}),e.jsx("input",{ref:c,type:"file",accept:"image/*",className:"hidden",onChange:U=>{const Y=U.target.files?.[0];Y&&S(Y)}})]}),e.jsx(Cc,{children:e.jsx($,{type:"submit",disabled:j.isPending,children:j.isPending?"جاري التحديث...":"حفظ التغييرات"})})]})})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:()=>A(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>A(null),className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors",children:e.jsx(yr,{className:"h-8 w-8"})}),e.jsx("img",{src:p,alt:"صورة مكبرة",className:"max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl",onClick:U=>U.stopPropagation()})]})})]})}function l6({worker:t,onSuccess:s,onCancel:r,submitLabel:a="إضافة العامل"}){const[n,i]=h.useState(t?.name||""),[o,l]=h.useState(t?.type||""),[u,d]=h.useState(t?t.dailyWage:""),[c,f]=h.useState(!1),[m,y]=h.useState(""),{toast:x}=Ct(),p=Mt(),A=async(k,R)=>{if(!(!R||typeof R!="string"||!R.trim()))try{await ae("/api/autocomplete","POST",{category:k,value:R.trim()})}catch{}},{data:g=[]}=ge({queryKey:["/api/worker-types"]}),N=Ce({mutationFn:async k=>(await Promise.all([A("workerNames",k.name),A("workerTypes",k.type)]),t?ae(`/api/workers/${t.id}`,"PUT",k):ae("/api/workers","POST",k)),onSuccess:async(k,R)=>{p.invalidateQueries({queryKey:["/api/autocomplete"]}),x({title:"تم الحفظ",description:t?"تم تعديل العامل بنجاح":"تم إضافة العامل بنجاح"}),t||(i(""),l(""),d("")),p.invalidateQueries({queryKey:["/api/workers"]}),p.invalidateQueries({queryKey:["/api/worker-types"]}),s?.()},onError:async(k,R)=>{await Promise.all([A("workerNames",R.name),A("workerTypes",R.type)]),p.invalidateQueries({queryKey:["/api/autocomplete"]});const I=k?.message||(t?"حدث خطأ أثناء تعديل العامل":"حدث خطأ أثناء إضافة العامل");x({title:t?"فشل في تعديل العامل":"فشل في إضافة العامل",description:I,variant:"destructive"})}}),w=Ce({mutationFn:async k=>(await A("workerTypes",k.name),ae("/api/worker-types","POST",k)),onSuccess:async(k,R)=>{p.invalidateQueries({queryKey:["/api/autocomplete"]}),x({title:"تم الحفظ",description:"تم إضافة نوع العامل بنجاح"}),l(k.name),y(""),f(!1),p.invalidateQueries({queryKey:["/api/worker-types"]})},onError:async(k,R)=>{await A("workerTypes",R.name),p.invalidateQueries({queryKey:["/api/autocomplete"]});const I=k?.message||"حدث خطأ أثناء إضافة نوع العامل";x({title:"فشل في إضافة نوع العامل",description:I,variant:"destructive"})}}),_=k=>{if(k.preventDefault(),!n.trim()||!o||!u){x({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const R=parseFloat(u);if(isNaN(R)||R<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح للأجر اليومي",variant:"destructive"});return}N.mutate({name:n.trim(),type:o,dailyWage:R.toString(),isActive:!0})},b=k=>{if(k.preventDefault(),!m.trim()){x({title:"خطأ",description:"يرجى إدخال اسم نوع العامل",variant:"destructive"});return}w.mutate({name:m.trim()})};return e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(se,{htmlFor:"worker-name",className:"block text-sm font-medium text-foreground mb-2",children:"اسم العامل"}),e.jsx(be,{id:"worker-name",type:"text",value:n,onChange:k=>i(k.target.value),placeholder:"أدخل اسم العامل...",required:!0})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"worker-type",className:"block text-sm font-medium text-foreground mb-2",children:"نوع العامل"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(qe,{value:o,onValueChange:l,children:[e.jsx(Oe,{className:"flex-1",children:e.jsx(Ue,{placeholder:"اختر نوع العامل..."})}),e.jsxs($e,{children:[Array.isArray(g)&&g.map(k=>e.jsx(K,{value:k.name,children:k.name},k.id)),g.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{value:"معلم",children:"معلم"}),e.jsx(K,{value:"عامل",children:"عامل"}),e.jsx(K,{value:"حداد",children:"حداد"}),e.jsx(K,{value:"نجار",children:"نجار"}),e.jsx(K,{value:"سائق",children:"سائق"}),e.jsx(K,{value:"كهربائي",children:"كهربائي"}),e.jsx(K,{value:"سباك",children:"سباك"})]})]})]}),e.jsxs(qs,{open:c,onOpenChange:f,children:[e.jsx(kd,{asChild:!0,children:e.jsx($,{type:"button",variant:"outline",size:"icon",className:"shrink-0",title:"إضافة نوع جديد",children:e.jsx(bs,{className:"h-4 w-4"})})}),e.jsxs(Fs,{className:"sm:max-w-md",children:[e.jsx(Us,{children:e.jsx(Ws,{children:"إضافة نوع عامل جديد"})}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(se,{htmlFor:"new-type-name",className:"block text-sm font-medium text-foreground mb-2",children:"اسم نوع العامل"}),e.jsx(be,{id:"new-type-name",type:"text",value:m,onChange:k=>y(k.target.value),placeholder:"مثال: كهربائي، سباك، حداد...",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"submit",disabled:w.isPending,className:"flex-1",children:w.isPending?"جاري الإضافة...":"إضافة"}),e.jsx($,{type:"button",variant:"outline",onClick:()=>{f(!1),y("")},className:"flex-1",children:"إلغاء"})]})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"daily-wage",className:"block text-sm font-medium text-foreground mb-2",children:"الأجر اليومي (ر.ي)"}),e.jsx(be,{id:"daily-wage",type:"number",inputMode:"decimal",value:u,onChange:k=>d(k.target.value),placeholder:"0",className:"text-center arabic-numbers",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"submit",className:"flex-1",disabled:N.isPending,children:N.isPending?"جاري الحفظ...":a}),r&&e.jsx($,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:"إلغاء"})]})]})}const c6=({worker:t,onEdit:s,onDelete:r,onToggleStatus:a})=>e.jsxs(q,{className:`transition-all duration-300 hover:shadow-lg border-r-4 ${t.isActive?"border-r-green-500 bg-gradient-to-r from-green-50 to-white dark:from-green-950 dark:to-gray-900":"border-r-red-500 bg-gradient-to-r from-red-50 to-white dark:from-red-950 dark:to-gray-900"}`,children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg",children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(le,{variant:t.isActive?"default":"destructive",className:"text-xs",children:t.isActive?"نشط":"غير نشط"}),e.jsx(le,{variant:"outline",className:"text-xs",children:t.type})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>s(t),className:"h-8 w-8 p-0 hover:bg-blue-100 dark:hover:bg-blue-900",children:e.jsx(Kr,{className:"h-4 w-4 text-blue-600"})}),e.jsxs(r1,{children:[e.jsx(a1,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-100 dark:hover:bg-red-900",children:e.jsx(os,{className:"h-4 w-4 text-red-600"})})}),e.jsxs(Cu,{className:"max-w-md",children:[e.jsxs(Pu,{children:[e.jsxs(Eu,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5 text-red-600"}),"حذف العامل"]}),e.jsxs(Du,{className:"space-y-3",children:[e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["هل أنت متأكد من حذف العامل ",e.jsxs("span",{className:"font-semibold text-blue-600",children:['"',t.name,'"']}),"؟"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500 flex items-center justify-center mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"تنبيه مهم:"}),e.jsx("p",{children:"إذا كان لدى العامل سجلات حضور أو تحويلات مالية، فلن يتمكن من حذفه وستظهر رسالة خطأ توضح الخطوات المطلوبة."})]})]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"هأ الإجراء لا يمكن التراجع عنه."})]})]}),e.jsxs(_u,{children:[e.jsx(Ru,{className:"flex items-center gap-2",children:"إلغاء"}),e.jsxs(Mu,{onClick:()=>r(t.id),className:"bg-red-600 hover:bg-red-700 flex items-center gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),"تأكيد الحذف"]})]})]})]})]})]})}),e.jsxs(H,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"الأجر اليومي"}),e.jsxs("p",{className:"font-bold text-green-600",children:[parseFloat(t.dailyWage).toFixed(0)," ر.ي"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(or,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"تاريخ التسجيل"}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:new Date(t.createdAt).toLocaleDateString("en-GB")})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs($,{variant:t.isActive?"destructive":"default",size:"sm",onClick:()=>a(t.id),className:"flex items-center gap-2 text-xs",children:[e.jsx(Ot,{className:"h-3 w-3"}),t.isActive?"إيقاف":"تفعيل"]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(Zs,{className:"h-3 w-3"}),"ID: ",t.id.slice(-8)]})]})]})]}),d6=({worker:t,onClose:s,isOpen:r})=>e.jsx(qs,{open:r,onOpenChange:s,children:e.jsxs(Fs,{className:"sm:max-w-md",children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:t?"تعديل العامل":"إضافة عامل جديد"}),e.jsx(Ys,{children:t?"قم بتعديل بيانات العامل المحدد":"أدخل بيانات العامل الجديد"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(l6,{worker:t,onSuccess:s,onCancel:s,submitLabel:t?"حفظ التعديلات":"إضافة العامل"})})]})});function u6(){const[t,s]=h.useState(""),[r,a]=h.useState("all"),[n,i]=h.useState("all"),[o,l]=h.useState(),[u,d]=h.useState(!1),{toast:c}=Ct(),f=Mt(),{setFloatingAction:m}=Ls();h.useEffect(()=>(m(()=>{l(void 0),d(!0)},"إضافة عامل جديد"),()=>m(null)),[m]);const y=T=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(T)+" ر.ي",{data:x=[],isLoading:p,error:A}=ge({queryKey:["/api/workers"],queryFn:async()=>{try{console.log("🔄 [Workers] جلب قائمة العمال...");const T=await ae("/api/workers","GET");console.log("📊 [Workers] استجابة العمال:",T);let S=[];return T&&typeof T=="object"&&(T.success!==void 0&&T.data!==void 0?S=Array.isArray(T.data)?T.data:[]:Array.isArray(T)?S=T:T.id&&(S=[T])),Array.isArray(S)||(console.warn("⚠️ [Workers] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),S=[]),console.log(`✅ [Workers] تم جلب ${S.length} عامل بنجاح`),S}catch(T){return console.error("❌ [Workers] خطأ في جلب العمال:",T),[]}},staleTime:3e5,retry:2}),{data:g=[],error:N}=ge({queryKey:["/api/worker-types"],queryFn:async()=>{try{console.log("🔄 [Workers] جلب أنواع العمال...");const T=await fetch("/api/worker-types");if(!T.ok)return console.error("❌ [Workers] خطأ في جلب أنواع العمال:",T.status),[];const S=await T.json();console.log("📊 [Workers] أنواع العمال:",S);let M=[];return S&&typeof S=="object"&&(S.success!==void 0&&S.data!==void 0?M=Array.isArray(S.data)?S.data:[]:Array.isArray(S)&&(M=S)),Array.isArray(M)||(M=[]),console.log(`✅ [Workers] تم جلب ${M.length} نوع عامل`),M}catch(T){return console.error("❌ [Workers] خطأ في جلب أنواع العمال:",T),[]}},staleTime:6e5,retry:1}),w=Ce({mutationFn:T=>ae(`/api/workers/${T}`,"DELETE"),onSuccess:T=>{f.invalidateQueries({queryKey:["/api/workers"]}),c({title:"✅ تم بنجاح",description:T?.message||"تم حذف العامل بنجاح",className:"bg-green-50 border-green-200 text-green-800 dark:bg-green-900 dark:border-green-700 dark:text-green-100"})},onError:T=>{console.log("📝 [Workers] تفاصيل خطأ حذف العامل:",T);let S="⚠️ لا يمكن حذف العامل",M=T?.message||"حدث خطأ في حذف العامل";if(T?.userAction||T?.relatedRecordsCount){const v=T.relatedRecordsCount?`(العدد: ${T.relatedRecordsCount})`:"",W=T.userAction?`

📝 ما يجب فعله: ${T.userAction}`:"",j=T.relatedRecordsType?`
📁 السجلات المرتبطة: ${T.relatedRecordsType} ${v}`:"";M=`${M}${j}${W}`}T?.relatedRecordsType?.includes("سجلات حضور")&&(S="📅 يجب حذف سجلات الحضور أولاً"),c({title:S,description:M,variant:"destructive",duration:8e3,className:"max-w-md"})}}),_=Ce({mutationFn:({id:T,data:S})=>ae(`/api/workers/${T}`,"PATCH",S),onSuccess:()=>{f.invalidateQueries({queryKey:["/api/workers"]}),c({title:"تم بنجاح",description:"تم تحديث بيانات العامل بنجاح"})},onError:T=>{c({title:"خطأ",description:T.message||"حدث خطأ في تحديث العامل",variant:"destructive"})}}),b=Array.isArray(x)?x.filter(T=>{const S=T.name.toLowerCase().includes(t.toLowerCase())||T.type.toLowerCase().includes(t.toLowerCase()),M=r==="all"||r==="active"&&T.isActive||r==="inactive"&&!T.isActive,v=n==="all"||T.type===n;return S&&M&&v}):[],k={total:Array.isArray(x)?x.length:0,active:Array.isArray(x)?x.filter(T=>T.isActive).length:0,inactive:Array.isArray(x)?x.filter(T=>!T.isActive).length:0,avgWage:Array.isArray(x)&&x.length>0?x.reduce((T,S)=>T+parseFloat(S.dailyWage),0)/x.length:0},R=T=>{l(T),d(!0)},I=T=>{w.mutate(T)},E=T=>{const S=x.find(M=>M.id===T);S&&_.mutate({id:T,data:{isActive:!S.isActive}})},O=()=>{l(void 0),d(!0)};return h.useEffect(()=>(m(O,"إضافة عامل جديد"),()=>m(null)),[m]),p?e.jsx("div",{className:"container mx-auto p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((T,S)=>e.jsxs(q,{className:"animate-pulse",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-300 dark:bg-gray-700"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-700 rounded w-16"})]})]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-700 rounded w-3/4"})]})})]},S))})}):e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsx(et,{title:"إجمالي العمال",value:k.total,icon:_t,color:"blue"}),e.jsx(et,{title:"العمال النشطون",value:k.active,icon:Ot,color:"green"}),e.jsx(et,{title:"العمال غير النشطين",value:k.inactive,icon:Ut,color:"orange"}),e.jsx(et,{title:"متوسط الأجر",value:k.avgWage,icon:us,color:"purple",formatter:T=>y(T)})]}),e.jsx(q,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(se,{htmlFor:"search",children:"البحث"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(Rr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(be,{id:"search",placeholder:"ابحث عن عامل...",value:t,onChange:T=>s(T.target.value),className:"pr-10"})]})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"status",children:"الحالة"}),e.jsxs(qe,{value:r,onValueChange:T=>a(T),children:[e.jsx(Oe,{className:"mt-1",children:e.jsx(Ue,{placeholder:"اختر الحالة"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الحالات"}),e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"inactive",children:"غير نشط"})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"type",children:"نوع العامل"}),e.jsxs(qe,{value:n,onValueChange:i,children:[e.jsx(Oe,{className:"mt-1",children:e.jsx(Ue,{placeholder:"اختر نوع العامل"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الأنواع"}),Array.isArray(g)&&g.map(T=>e.jsx(K,{value:T.name,children:T.name},T.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs($,{variant:"outline",className:"w-full mt-1",onClick:()=>{s(""),a("all"),i("all")},children:[e.jsx(dl,{className:"h-4 w-4 mr-2"}),"إعادة تعيين"]})})]})})}),b.length===0?e.jsx(q,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(_t,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"لا توجد عمال"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:x.length===0?"لم يتم إضافة أي عمال بعد":"لا توجد عمال تطابق معايير البحث"}),x.length===0&&e.jsx($,{onClick:O,children:"إضافة أول عامل"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:b.map(T=>e.jsx(c6,{worker:T,onEdit:R,onDelete:I,onToggleStatus:E},T.id))}),e.jsx(d6,{worker:o,onClose:()=>{d(!1),l(void 0)},isOpen:u})]})}function m6(){Or();const[t,s]=h.useState(!1),[r,a]=h.useState(null),[n,i]=h.useState(""),{toast:o}=Ct(),l=Mt(),{setFloatingAction:u}=Ls();h.useEffect(()=>(u(()=>{a(null),s(!0)},"إضافة تحويل جديد"),()=>u(null)),[u]);const d=async(S,M)=>{if(!(!M||M.trim().length<2))try{await ae("/api/autocomplete","POST",{category:S,value:M.trim(),usageCount:1}),console.log(`✅ تم حفظ قيمة الإكمال التلقائي: ${S} = ${M.trim()}`)}catch(v){console.error(`❌ خطأ في حفظ قيمة الإكمال التلقائي ${S}:`,v)}},c=async()=>{const S=[];x.recipientName&&x.recipientName.trim().length>=2&&S.push(d("recipientNames",x.recipientName)),x.recipientPhone&&x.recipientPhone.trim().length>=3&&S.push(d("recipientPhones",x.recipientPhone)),x.transferNumber&&x.transferNumber.trim().length>=1&&S.push(d("workerTransferNumbers",x.transferNumber)),x.notes&&x.notes.trim().length>=2&&S.push(d("workerTransferNotes",x.notes)),S.length>0&&await Promise.all(S)},f=new URLSearchParams(window.location.search),m=f.get("edit"),y=f.get("worker"),[x,p]=h.useState({workerId:y||"",projectId:"",amount:0,recipientName:"",recipientPhone:"",transferMethod:"hawaleh",transferNumber:"",transferDate:new Date().toISOString().split("T")[0],notes:""}),{data:A=[]}=ge({queryKey:["/api/workers"],select:S=>S.filter(M=>M.isActive)}),{data:g=[]}=ge({queryKey:["/api/projects"]}),{data:N=[]}=ge({queryKey:["/api/worker-transfers"]}),w=Ce({mutationFn:async S=>(await c(),ae("/api/worker-transfers","POST",S)),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/worker-transfers"]}),l.invalidateQueries({queryKey:["/api/autocomplete"]}),s(!1),k(),o({title:"تم بنجاح",description:"تم إرسال الحولة بنجاح"})},onError:async S=>{await c(),l.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("خطأ في إرسال الحولة:",S);let M="فشل في إرسال الحولة";S?.response?.data?.message?M=S.response.data.message:S?.message&&(M=S.message),o({title:"خطأ",description:M,variant:"destructive"})}}),_=Ce({mutationFn:async S=>(await c(),ae(`/api/worker-transfers/${S.id}`,"PATCH",S.updates)),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/worker-transfers"]}),l.invalidateQueries({queryKey:["/api/autocomplete"]}),s(!1),a(null),k(),o({title:"تم بنجاح",description:"تم تحديث الحولة بنجاح"})},onError:async S=>{await c(),l.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("خطأ في تحديث الحولة:",S);let M="فشل في تحديث الحولة";S?.response?.data?.message?M=S.response.data.message:S?.message&&(M=S.message),o({title:"خطأ",description:M,variant:"destructive"})}}),b=Ce({mutationFn:async S=>ae(`/api/worker-transfers/${S}`,"DELETE"),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/worker-transfers"]}),o({title:"تم بنجاح",description:"تم حذف الحولة بنجاح"})},onError:S=>{console.error("خطأ في حذف الحولة:",S);let M="فشل في حذف الحولة";S?.response?.data?.message?M=S.response.data.message:S?.message&&(M=S.message),o({title:"خطأ",description:M,variant:"destructive"})}});h.useEffect(()=>{if(m&&N.length>0){const S=N.find(M=>M.id===m);S&&(a(S),p({workerId:S.workerId,projectId:S.projectId,amount:S.amount,recipientName:S.recipientName,recipientPhone:S.recipientPhone||"",transferMethod:S.transferMethod,transferNumber:S.transferNumber||"",transferDate:S.transferDate,notes:S.notes||""}),s(!0))}},[m,N]);const k=()=>{p({workerId:"",projectId:"",amount:0,recipientName:"",recipientPhone:"",transferMethod:"hawaleh",transferNumber:"",transferDate:new Date().toISOString().split("T")[0],notes:""})},R=()=>{if(!x.workerId||!x.projectId||!x.amount||!x.recipientName||!x.transferDate){o({title:"خطأ",description:"الرجاء ملء جميع الحقول المطلوبة",variant:"destructive"});return}r?_.mutate({id:r.id,updates:x}):w.mutate(x)},I=S=>{a(S),p({workerId:S.workerId,projectId:S.projectId,amount:S.amount,recipientName:S.recipientName,recipientPhone:S.recipientPhone||"",transferMethod:S.transferMethod,transferNumber:S.transferNumber||"",transferDate:S.transferDate,notes:S.notes||""}),s(!0)},E=S=>`${S.toLocaleString("en-US")} ر.ي`,O=S=>{switch(S){case"cash":return"نقداً";case"bank":return"تحويل بنكي";case"hawaleh":return"حولة";default:return S}},T=n&&n!=="all"?N.filter(S=>S.projectId===n):N;return e.jsxs("div",{className:"min-h-screen bg-background p-4 space-y-6",children:[e.jsx(q,{className:"mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Bi,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsxs(qe,{value:n,onValueChange:i,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"جميع المشاريع"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع المشاريع"}),g.map(S=>e.jsx(K,{value:S.id,children:S.name},S.id))]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"الحوالات المرسلة"}),e.jsxs(le,{variant:"secondary",children:[T.length," حولة"]})]}),T.length===0?e.jsx(q,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(wc,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"لا توجد حوالات"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:n&&n!=="all"?"لا توجد حوالات في هذا المشروع":"لم يتم إرسال أي حوالات بعد"}),e.jsxs($,{onClick:()=>{a(null),k(),s(!0)},className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(bs,{className:"h-4 w-4 mr-2"}),"إرسال حولة جديدة"]})]})}):e.jsx("div",{className:"grid gap-4",children:T.map(S=>{const M=A.find(W=>W.id===S.workerId),v=g.find(W=>W.id===S.projectId);return e.jsx(q,{className:"hover:shadow-md transition-shadow",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Zs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:M?.name||"عامل غير معروف"}),e.jsx(le,{variant:"outline",className:"text-xs",children:M?.type||"غير محدد"})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:v?.name||"مشروع غير معروف"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"font-bold text-green-600",children:E(S.amount)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ga,{className:"h-3 w-3 text-purple-600"}),e.jsx("span",{children:O(S.transferMethod)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(or,{className:"h-3 w-3 text-gray-600"}),e.jsx("span",{children:new Date(S.transferDate).toLocaleDateString("en-GB")})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>I(S),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(Kr,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>b.mutate(S.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(os,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"المستلم: "}),e.jsx("span",{className:"font-medium",children:S.recipientName}),S.recipientPhone&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground mx-2",children:"•"}),e.jsx(ul,{className:"h-3 w-3 inline mr-1"}),e.jsx("span",{children:S.recipientPhone})]})]})}),S.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["ملاحظات: ",S.notes]})})]})]})},S.id)})})]}),e.jsx(qs,{open:t,onOpenChange:s,children:e.jsxs(Fs,{className:"max-w-md",children:[e.jsxs(Us,{children:[e.jsx(Ws,{children:r?"تعديل الحولة":"حولة جديدة"}),e.jsx(Ys,{children:r?"قم بتعديل بيانات الحولة المالية":"إنشاء حولة مالية جديدة للعامل"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(se,{children:"العامل *"}),e.jsxs(qe,{value:x.workerId,onValueChange:S=>p({...x,workerId:S}),children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر العامل"})}),e.jsx($e,{children:Array.isArray(A)?A.map(S=>e.jsxs(K,{value:S.id,children:[S.name," (",S.type,")"]},S.id)):null})]})]}),e.jsxs("div",{children:[e.jsx(se,{children:"المشروع *"}),e.jsxs(qe,{value:x.projectId,onValueChange:S=>p({...x,projectId:S}),children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر المشروع"})}),e.jsx($e,{children:g.map(S=>e.jsx(K,{value:S.id,children:S.name},S.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{children:"المبلغ (ر.ي) *"}),e.jsx(be,{type:"number",value:x.amount,onChange:S=>p({...x,amount:Number(S.target.value)}),placeholder:"0",min:"0"})]}),e.jsxs("div",{children:[e.jsx(se,{children:"اسم المستلم *"}),e.jsx(Ft,{category:"recipientNames",value:x.recipientName,onChange:S=>p({...x,recipientName:S}),placeholder:"اسم الشخص المستلم للحولة",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(se,{children:"رقم الهاتف"}),e.jsx(Ft,{category:"recipientPhones",value:x.recipientPhone,onChange:S=>p({...x,recipientPhone:S}),placeholder:"رقم هاتف المستلم (اختياري)",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(se,{children:"طريقة التحويل"}),e.jsxs(qe,{value:x.transferMethod,onValueChange:S=>p({...x,transferMethod:S}),children:[e.jsx(Oe,{children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"hawaleh",children:"حولة"}),e.jsx(K,{value:"bank",children:"تحويل بنكي"}),e.jsx(K,{value:"cash",children:"نقداً"})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{children:"تاريخ التحويل *"}),e.jsx(be,{type:"date",value:x.transferDate,onChange:S=>p({...x,transferDate:S.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(se,{children:"رقم الحولة"}),e.jsx(Ft,{category:"workerTransferNumbers",value:x.transferNumber,onChange:S=>p({...x,transferNumber:S}),placeholder:"رقم الحولة أو المرجع",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(se,{children:"ملاحظات"}),e.jsx(Ft,{category:"workerTransferNotes",value:x.notes,onChange:S=>p({...x,notes:S}),placeholder:"ملاحظات إضافية (اختياري)",className:"w-full"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs($,{onClick:R,disabled:w.isPending||_.isPending,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(wc,{className:"h-4 w-4 mr-2"}),r?"تحديث":"إرسال"]}),e.jsx($,{variant:"outline",onClick:()=>{s(!1),a(null),k()},className:"flex-1",children:"إلغاء"})]})]})]})})]})}var Iu="Switch",[h6]=Hs(Iu),[f6,p6]=h6(Iu),i1=h.forwardRef((t,s)=>{const{__scopeSwitch:r,name:a,checked:n,defaultChecked:i,required:o,disabled:l,value:u="on",onCheckedChange:d,form:c,...f}=t,[m,y]=h.useState(null),x=lt(s,w=>y(w)),p=h.useRef(!1),A=m?c||!!m.closest("form"):!0,[g=!1,N]=Pa({prop:n,defaultProp:i,onChange:d});return e.jsxs(f6,{scope:r,checked:g,disabled:l,children:[e.jsx(We.button,{type:"button",role:"switch","aria-checked":g,"aria-required":o,"data-state":c1(g),"data-disabled":l?"":void 0,disabled:l,value:u,...f,ref:x,onClick:Ne(t.onClick,w=>{N(_=>!_),A&&(p.current=w.isPropagationStopped(),p.current||w.stopPropagation())})}),A&&e.jsx(x6,{control:m,bubbles:!p.current,name:a,value:u,checked:g,required:o,disabled:l,form:c,style:{transform:"translateX(-100%)"}})]})});i1.displayName=Iu;var o1="SwitchThumb",l1=h.forwardRef((t,s)=>{const{__scopeSwitch:r,...a}=t,n=p6(o1,r);return e.jsx(We.span,{"data-state":c1(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:s})});l1.displayName=o1;var x6=t=>{const{control:s,checked:r,bubbles:a=!0,...n}=t,i=h.useRef(null),o=cd(r),l=dd(s);return h.useEffect(()=>{const u=i.current,d=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(d,"checked").set;if(o!==r&&f){const m=new Event("click",{bubbles:a});f.call(u,r),u.dispatchEvent(m)}},[o,r,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:i,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function c1(t){return t?"checked":"unchecked"}var d1=i1,g6=l1;const Ur=h.forwardRef(({className:t,...s},r)=>e.jsx(d1,{className:he("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:r,children:e.jsx(g6,{className:he("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Ur.displayName=d1.displayName;function y6({supplier:t,onSuccess:s,onCancel:r,submitLabel:a="إضافة المورد"}){const[n,i]=h.useState(t?.name||""),[o,l]=h.useState(t?.contactPerson||""),[u,d]=h.useState(t?.phone||""),[c,f]=h.useState(t?.address||""),[m,y]=h.useState(t?.paymentTerms||"نقد"),[x,p]=h.useState(t?.notes||""),[A,g]=h.useState(t?.isActive??!0),{toast:N}=Ct(),w=Mt(),_=async(I,E)=>{if(!(!E||typeof E!="string"||!E.trim()))try{await ae("/api/autocomplete","POST",{category:I,value:E.trim()})}catch{}},b=Ce({mutationFn:async I=>(await Promise.all([_("supplier_name",n),_("supplier_contact_person",o),_("supplier_phone",u),_("supplier_address",c),_("supplier_payment_terms",m)]),t?ae(`/api/suppliers/${t.id}`,"PUT",I):ae("/api/suppliers","POST",I)),onSuccess:async I=>{w.invalidateQueries({queryKey:["/api/autocomplete"]}),N({title:"تم الحفظ",description:t?"تم تعديل المورد بنجاح":"تم إضافة المورد بنجاح"}),t||k(),w.invalidateQueries({queryKey:["/api/suppliers"]}),s?.()},onError:async I=>{await Promise.all([_("supplier_name",n),_("supplier_contact_person",o),_("supplier_phone",u),_("supplier_address",c),_("supplier_payment_terms",m)]),w.invalidateQueries({queryKey:["/api/autocomplete"]});const E=I?.message||(t?"حدث خطأ أثناء تعديل المورد":"حدث خطأ أثناء إضافة المورد");N({title:t?"فشل في تعديل المورد":"فشل في إضافة المورد",description:E,variant:"destructive"})}}),k=()=>{i(""),l(""),d(""),f(""),y("نقد"),p(""),g(!0)},R=I=>{if(I.preventDefault(),!n||typeof n!="string"||!n.trim()){N({title:"خطأ",description:"يرجى ملء اسم المورد",variant:"destructive"});return}const E={name:n&&typeof n=="string"?n.trim():"",contactPerson:o&&typeof o=="string"&&o.trim()||null,phone:u&&typeof u=="string"&&u.trim()||null,address:c&&typeof c=="string"&&c.trim()||null,paymentTerms:m&&typeof m=="string"&&m.trim()||"نقد",notes:x&&typeof x=="string"&&x.trim()||null,isActive:A,totalDebt:"0"};b.mutate(E)};return e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"supplier-name",className:"text-sm font-medium text-foreground",children:"اسم المورد *"}),e.jsx(Ft,{value:n,onChange:i,placeholder:"اسم المورد أو الشركة",category:"supplier_name",className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"contact-person",className:"text-sm font-medium text-foreground",children:"الشخص المسؤول"}),e.jsx(Ft,{value:o,onChange:l,placeholder:"اسم الشخص المسؤول",category:"supplier_contact_person",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"رقم الهاتف"}),e.jsx(Ft,{value:u,onChange:d,placeholder:"777123456",category:"supplier_phone",type:"tel",inputMode:"numeric",className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"address",className:"text-sm font-medium text-foreground",children:"العنوان"}),e.jsx(Ft,{value:c,onChange:f,placeholder:"العنوان الكامل",category:"supplier_address",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"payment-terms",className:"text-sm font-medium text-foreground",children:"شروط الدفع"}),e.jsx(Ft,{value:m,onChange:y,placeholder:"نقد / 30 يوم / 60 يوم",category:"supplier_payment_terms",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"notes",className:"text-sm font-medium text-foreground",children:"ملاحظات"}),e.jsx(an,{id:"notes",value:x,onChange:I=>p(I.target.value),placeholder:"ملاحظات إضافية...",rows:3,className:"resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-sm font-medium",children:"حالة المورد"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:A?"نشط ومتاح للتعامل":"غير نشط"})]}),e.jsx(Ur,{checked:A,onCheckedChange:g})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r&&e.jsx($,{type:"button",variant:"outline",onClick:r,disabled:b.isPending,children:"إلغاء"}),e.jsx($,{type:"submit",disabled:b.isPending,className:"min-w-[100px]",children:b.isPending?"جاري الحفظ...":a})]})]})}function wf(){const[t,s]=h.useState(!1),[r,a]=h.useState(null),[n,i]=h.useState(""),{toast:o}=Ct(),l=Mt(),{setFloatingAction:u}=Ls(),{data:d=[],isLoading:c}=ge({queryKey:["/api/suppliers"]}),f=Ce({mutationFn:async w=>await ae(`/api/suppliers/${w}`,"DELETE"),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/suppliers"]}),o({title:"تم حذف المورد بنجاح"})},onError:()=>{o({title:"خطأ في حذف المورد",variant:"destructive"})}}),m=w=>{a(w),s(!0)},y=w=>{confirm(`هل أنت متأكد من حذف المورد "${w.name}"؟`)&&f.mutate(w.id)},x=()=>{a(null),s(!1)},p=()=>{a(null),s(!0)};h.useEffect(()=>(u(p,"إضافة مورد جديد"),()=>u(null)),[u]);const A=d.filter(w=>w.name.toLowerCase().includes(n.toLowerCase())||w.contactPerson&&w.contactPerson.toLowerCase().includes(n.toLowerCase())||w.phone&&w.phone.includes(n)),g={total:d.length,active:d.filter(w=>w.isActive).length,inactive:d.filter(w=>!w.isActive).length,totalDebt:d.reduce((w,_)=>w+(parseFloat(_.totalDebt?.toString()||"0")||0),0)},N=w=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(w)+" ر.ي";return c?e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted rounded w-64"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((w,_)=>e.jsx(q,{className:"animate-pulse",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-16"}),e.jsx("div",{className:"h-6 bg-muted rounded w-12"})]}),e.jsx("div",{className:"h-8 w-8 bg-muted rounded"})]})})},_))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((w,_)=>e.jsxs(q,{className:"animate-pulse",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-muted rounded w-24"}),e.jsx("div",{className:"h-3 bg-muted rounded w-20"})]}),e.jsx("div",{className:"h-5 w-12 bg-muted rounded"})]})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-28"}),e.jsx("div",{className:"h-3 bg-muted rounded w-32"}),e.jsx("div",{className:"h-3 bg-muted rounded w-20"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("div",{className:"h-7 bg-muted rounded w-16"}),e.jsx("div",{className:"h-7 bg-muted rounded w-16"})]})]})]},_))})]}):e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsx(qs,{open:t,onOpenChange:s,children:e.jsxs(Fs,{className:"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Us,{children:[e.jsx(Ws,{className:"text-lg sm:text-xl",children:r?"تعديل بيانات المورد":"إضافة مورد جديد"}),e.jsx(Ys,{children:r?"قم بتعديل بيانات المورد المحدد":"أدخل بيانات المورد الجديد"})]}),e.jsx(y6,{supplier:r,onSuccess:()=>{x(),l.invalidateQueries({queryKey:["/api/suppliers"]})},onCancel:x,submitLabel:r?"تحديث المورد":"إضافة المورد"})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsx(et,{title:"إجمالي الموردين",value:g.total,icon:ii,color:"blue"}),e.jsx(et,{title:"الموردين النشطين",value:g.active,icon:Kt,color:"green"}),e.jsx(et,{title:"غير النشطين",value:g.inactive,icon:Wt,color:"orange"}),e.jsx(et,{title:"إجمالي المديونية",value:g.totalDebt,icon:Ga,color:"red",formatter:N})]}),e.jsx(q,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Rr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(be,{placeholder:"البحث في الموردين (الاسم، الشخص المسؤول، رقم الهاتف)...",value:n,onChange:w=>i(w.target.value),className:"pr-10"})]})})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:A.map(w=>e.jsx(q,{className:"border border-border/40 bg-card/50 hover:shadow-md transition-all duration-200 hover:border-primary/30",children:e.jsx(H,{className:"p-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${w.isActive?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800"}`,children:e.jsx(ii,{className:`h-4 w-4 ${w.isActive?"text-green-600 dark:text-green-400":"text-gray-500"}`})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:w.name}),e.jsx("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:w.contactPerson&&e.jsxs(e.Fragment,{children:[e.jsx(Zs,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:w.contactPerson})]})})]})]})}),e.jsx(le,{variant:w.isActive?"default":"secondary",className:"text-xs px-1.5 py-0.5 h-auto",children:w.isActive?"نشط":"معطل"})]}),e.jsxs("div",{className:"bg-muted/30 p-2 rounded-lg space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[w.phone&&e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(ul,{className:"h-3 w-3 flex-shrink-0 text-blue-500"}),e.jsx("span",{className:"truncate font-mono",children:w.phone})]}),w.paymentTerms&&e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(Ga,{className:"h-3 w-3 flex-shrink-0 text-purple-500"}),e.jsx("span",{className:"truncate",children:w.paymentTerms})]})]}),w.address&&e.jsxs("div",{className:"flex items-start gap-1 text-xs",children:[e.jsx(Cr,{className:"h-3 w-3 flex-shrink-0 text-green-500 mt-0.5"}),e.jsx("span",{className:"line-clamp-2 leading-relaxed text-muted-foreground",children:w.address})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-border/50",children:[e.jsx("div",{className:"flex items-center gap-1",children:parseFloat(w.totalDebt?.toString()||"0")>0?e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"h-3 w-3 text-red-500"}),e.jsxs("span",{className:"text-xs font-medium text-red-600",children:["مديونية: ",N(parseFloat(w.totalDebt?.toString()||"0"))]})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"رصيد سليم"})]})}),w.createdAt&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(or,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(w.createdAt).toLocaleDateString("en-GB")})]})]})]}),w.notes&&e.jsx("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded text-xs",children:e.jsx("p",{className:"line-clamp-2 text-amber-800 dark:text-amber-200",children:w.notes})}),e.jsxs("div",{className:"flex gap-1.5 pt-1",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>m(w),className:"flex-1 gap-1 text-xs h-7 hover:bg-blue-50 hover:border-blue-200 hover:text-blue-700",children:[e.jsx(Kr,{className:"h-3 w-3"}),"تعديل"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>y(w),className:"flex-1 gap-1 text-xs h-7 hover:bg-red-50 hover:border-red-200 hover:text-red-700",children:[e.jsx(os,{className:"h-3 w-3"}),"حذف"]})]})]})})},w.id))}),A.length===0&&e.jsx(q,{children:e.jsxs(H,{className:"py-12 text-center",children:[e.jsx(ii,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:n?"لا توجد نتائج":"لا توجد موردين"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:n?"لم يتم العثور على موردين يطابقون كلمات البحث المدخلة. جرب كلمات أخرى.":"ابدأ ببناء قاعدة بيانات الموردين الخاصة بك عن طريق إضافة أول مورد."}),!n&&e.jsxs($,{onClick:()=>{x(),s(!0)},className:"gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"إضافة مورد جديد"]})]})})]})}const v6=Ln("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),en=h.forwardRef(({className:t,variant:s,...r},a)=>e.jsx("div",{ref:a,role:"alert",className:he(v6({variant:s}),t),...r}));en.displayName="Alert";const b6=h.forwardRef(({className:t,...s},r)=>e.jsx("h5",{ref:r,className:he("mb-1 font-medium leading-none tracking-tight",t),...s}));b6.displayName="AlertTitle";const tn=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:he("text-sm [&_p]:leading-relaxed",t),...s}));tn.displayName="AlertDescription";function j6(){const[t,s]=h.useState("all"),[r,a]=h.useState(""),[n,i]=h.useState(""),[o,l]=h.useState(""),[u,d]=h.useState("all"),[c,f]=h.useState(""),{setFloatingAction:m}=Ls();h.useEffect(()=>(m(null),()=>m(null)),[m]);const{data:y=[]}=ge({queryKey:["/api/projects"],queryFn:async()=>{try{const F=await ae("/api/projects","GET");return F&&F.data&&Array.isArray(F.data)?F.data:Array.isArray(F)?F:[]}catch(F){return console.error("Error fetching projects:",F),[]}}}),{data:x=[],isLoading:p,error:A}=ge({queryKey:["/api/suppliers"],queryFn:async()=>{try{const F=await ae("/api/suppliers","GET");return F&&F.data&&Array.isArray(F.data)?F.data:Array.isArray(F)?F:[]}catch(F){return console.error("Error fetching suppliers:",F),[]}},staleTime:6e4,refetchOnWindowFocus:!1}),{data:g}=ge({queryKey:["/api/material-purchases/date-range"],staleTime:3e5}),N=Array.isArray(x)?x.filter(F=>F.name.toLowerCase().includes(c.toLowerCase())):[],{data:w=[],isLoading:_}=ge({queryKey:["/api/material-purchases",t,r,n,o,u],queryFn:async()=>{if(!r)return[];const F=new URLSearchParams;F.append("supplierId",r),t&&t!=="all"&&F.append("projectId",t),n&&F.append("dateFrom",n),o&&F.append("dateTo",o),u&&u!=="all"&&F.append("purchaseType",u),console.log("🔍 طلب مشتريات المورد:",{selectedSupplierId:r,selectedProjectId:t,dateFrom:n,dateTo:o,paymentTypeFilter:u});const ye=await fetch(`/api/material-purchases?${F.toString()}`);if(!ye.ok)return console.error("خطأ في جلب المشتريات:",ye.status,ye.statusText),[];const fe=await ye.json();return console.log("📊 تم جلب المشتريات:",fe.length),fe.map(de=>({...de,paidAmount:de.paidAmount||"0",remainingAmount:de.remainingAmount||"0"}))},enabled:!!r,refetchOnWindowFocus:!1,staleTime:3e4}),{data:b}=ge({queryKey:["/api/suppliers/statistics"],queryFn:async()=>{const F=await fetch("/api/suppliers/statistics");return F.ok?await F.json():(console.error("خطأ في جلب الإحصائيات العامة:",F.status,F.statusText),{totalSuppliers:0,totalCashPurchases:"0",totalCreditPurchases:"0",totalDebt:"0",totalPaid:"0",remainingDebt:"0",activeSuppliers:0})},refetchOnWindowFocus:!1,staleTime:6e4}),{data:k}=ge({queryKey:["/api/suppliers/statistics",t,r,n,o,u],queryFn:async()=>{const F=new URLSearchParams;r&&F.append("supplierId",r),t&&t!=="all"&&F.append("projectId",t),n&&F.append("dateFrom",n),o&&F.append("dateTo",o),u&&u!=="all"&&F.append("purchaseType",u),console.log("🔄 إرسال طلب إحصائيات مفلترة:",Object.fromEntries(F));const ye=await fetch(`/api/suppliers/statistics?${F.toString()}`);return ye.ok?await ye.json():(console.error("خطأ في جلب إحصائيات الموردين المفلترة:",ye.status,ye.statusText),{totalSuppliers:0,totalCashPurchases:"0",totalCreditPurchases:"0",totalDebt:"0",totalPaid:"0",remainingDebt:"0",activeSuppliers:0})},refetchOnWindowFocus:!1,staleTime:3e4,enabled:!!r}),R=x.find(F=>F.id===r),I=y.find(F=>F.id===t),E=Array.isArray(w)?w.reduce((F,ye)=>(F.totalAmount+=parseFloat(ye.totalAmount||"0"),F.paidAmount+=parseFloat(ye.paidAmount||"0"),F.remainingAmount+=parseFloat(ye.remainingAmount||"0"),F),{totalAmount:0,paidAmount:0,remainingAmount:0}):{totalAmount:0,paidAmount:0,remainingAmount:0},O=Array.isArray(w)?w:[],T=O.filter(F=>(F.purchaseType?.replace(/['"]/g,"")||"")==="نقد"),S=O.filter(F=>{const ye=F.purchaseType?.replace(/['"]/g,"")||"";return ye==="أجل"||ye==="آجل"||ye.includes("جل")});Array.isArray(T)&&T.reduce((F,ye)=>F+parseFloat(ye.totalAmount||"0"),0),Array.isArray(T)&&T.length,Array.isArray(S)&&S.reduce((F,ye)=>F+parseFloat(ye.totalAmount||"0"),0),Array.isArray(S)&&S.length;const M={totalSuppliers:b?.totalSuppliers||x.length,totalCashPurchases:b?.totalCashPurchases||"0",totalCreditPurchases:b?.totalCreditPurchases||"0",totalDebt:b?.totalDebt||"0",totalPaid:b?.totalPaid||"0",remainingDebt:r?k?.remainingDebt||"0":b?.remainingDebt||"0",activeSuppliers:b?.activeSuppliers||(Array.isArray(x)?x.filter(F=>parseFloat(F.totalDebt)>0).length:0),totalPurchases:Array.isArray(w)?w.length:0},v=F=>new Date(F).toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"}),W=F=>(typeof F=="string"?parseFloat(F):F).toLocaleString("en-US")+" ريال",j=(F,ye)=>parseFloat(ye)===0?e.jsx(le,{variant:"default",className:"bg-green-100 text-green-800 text-xs",children:"مسدد"}):F==="نقد"?e.jsx(le,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:"نقد"}):e.jsx(le,{variant:"destructive",className:"text-xs",children:"مؤجل"}),V=async()=>{if(!R||w.length===0)return;const F=(await xd(async()=>{const{default:xe}=await import("./exceljs.min-CT50dpqw.js").then(P=>P.e);return{default:xe}},__vite__mapDeps([0,1,2]))).default,ye=new F.Workbook,fe=ye.addWorksheet("كشف حساب المورد");fe.views=[{rightToLeft:!0}],fe.pageSetup={paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:0,margins:{left:.2,right:.2,top:.3,bottom:.3,header:.1,footer:.1},horizontalCentered:!0,verticalCentered:!1,scale:80,blackAndWhite:!1,draft:!1},fe.columns=[{width:3},{width:9},{width:12},{width:16},{width:20},{width:6},{width:9},{width:11},{width:8},{width:9},{width:9},{width:8}];let de=1;fe.mergeCells(`A${de}:L${de}`);const ke=fe.getCell(`A${de}`);ke.value="شركة الفتيني للمقاولات والاستشارات الهندسية",ke.font={name:"Arial",size:14,bold:!0,color:{argb:"FFFFFF"}},ke.alignment={horizontal:"center",vertical:"middle"},ke.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1f4e79"}},ke.border={top:{style:"thick",color:{argb:"1f4e79"}},bottom:{style:"thick",color:{argb:"1f4e79"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},fe.getRow(de).height=25,de++,fe.mergeCells(`A${de}:L${de}`);const nt=fe.getCell(`A${de}`);nt.value="كشف حساب المورد - تقرير مفصل",nt.font={name:"Arial",size:11,bold:!0,color:{argb:"1f4e79"}},nt.alignment={horizontal:"center",vertical:"middle"},nt.fill={type:"pattern",pattern:"solid",fgColor:{argb:"f2f2f2"}},nt.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},fe.getRow(de).height=16,de++,de+=1,fe.mergeCells(`A${de}:L${de}`);const ct=fe.getCell(`A${de}`);if(ct.value="📋 بيانات المورد",ct.font={name:"Arial",size:11,bold:!0,color:{argb:"FFFFFF"}},ct.alignment={horizontal:"center",vertical:"middle"},ct.fill={type:"pattern",pattern:"solid",fgColor:{argb:"2e75b6"}},ct.border={top:{style:"medium",color:{argb:"2e75b6"}},bottom:{style:"medium",color:{argb:"2e75b6"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},fe.getRow(de).height=22,de++,[["اسم المورد",R.name,"رقم الهاتف",R.phone||"غير محدد"],["شخص الاتصال",R.contactPerson||"غير محدد","العنوان",R.address||"غير محدد"]].forEach((xe,P)=>{const z=fe.getRow(de),G=z.getCell(1);G.value=xe[0],G.font={name:"Arial",size:9,bold:!0,color:{argb:"1f4e79"}},G.alignment={horizontal:"center",vertical:"middle"},G.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e8f4fd"}},fe.mergeCells(`A${de}:B${de}`);const oe=z.getCell(3);oe.value=xe[1],oe.font={name:"Arial",size:9},oe.alignment={horizontal:"center",vertical:"middle"},oe.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffffff"}},fe.mergeCells(`C${de}:F${de}`);const ce=z.getCell(7);ce.value=xe[2],ce.font={name:"Arial",size:9,bold:!0,color:{argb:"1f4e79"}},ce.alignment={horizontal:"center",vertical:"middle"},ce.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e8f4fd"}},fe.mergeCells(`G${de}:H${de}`);const te=z.getCell(9);te.value=xe[3],te.font={name:"Arial",size:9},te.alignment={horizontal:"center",vertical:"middle"},te.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffffff"}},fe.mergeCells(`I${de}:L${de}`),[1,3,7,9].forEach(ve=>{const Re=z.getCell(ve);Re.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thin",color:{argb:"cccccc"}},right:{style:"thin",color:{argb:"cccccc"}}}}),fe.getRow(de).height=18,de++}),I||n||o){de++,fe.getRow(de);let xe="";I&&(xe+=`المشروع: ${I.name}`),(n||o)&&(xe&&(xe+=" | "),xe+=`الفترة: من ${n||"البداية"} إلى ${o||"النهاية"}`),fe.mergeCells(`A${de}:L${de}`);const P=fe.getCell(`A${de}`);P.value=xe,P.font={name:"Arial",size:10,italic:!0,color:{argb:"666666"}},P.alignment={horizontal:"center",vertical:"middle"},P.fill={type:"pattern",pattern:"solid",fgColor:{argb:"f9f9f9"}},de++}de+=1;const Z=["#","التاريخ","رقم الفاتورة","اسم المشروع","المادة","الكمية","سعر الوحدة","المبلغ الإجمالي","نوع الدفع","المدفوع","المتبقي","الحالة"],U=fe.getRow(de);Z.forEach((xe,P)=>{const z=U.getCell(P+1);z.value=xe,z.font={name:"Arial",size:9,bold:!0,color:{argb:"FFFFFF"}},z.alignment={horizontal:"center",vertical:"middle",wrapText:!0},z.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1f4e79"}},z.border={top:{style:"thin",color:{argb:"1f4e79"}},bottom:{style:"thin",color:{argb:"1f4e79"}},left:{style:"thin",color:{argb:"1f4e79"}},right:{style:"thin",color:{argb:"1f4e79"}}}}),U.height=20,de++,w.forEach((xe,P)=>{const z=fe.getRow(de),G=y.find(te=>te.id===xe.projectId)?.name||"غير محدد",oe=xe.materialName||xe.material?.name||xe.materialId||"غير محدد";[P+1,v(xe.invoiceDate),xe.invoiceNumber||"-",G,oe,xe.quantity,parseFloat(xe.unitPrice),parseFloat(xe.totalAmount),xe.purchaseType,parseFloat(xe.paidAmount||"0"),parseFloat(xe.remainingAmount||"0"),parseFloat(xe.remainingAmount||"0")===0?"مسدد":"مؤجل"].forEach((te,ve)=>{const Re=z.getCell(ve+1);Re.value=te,Re.font={name:"Arial",size:8},ve===0?Re.alignment={horizontal:"center",vertical:"middle",wrapText:!0}:[1,2].includes(ve)?Re.alignment={horizontal:"center",vertical:"middle",wrapText:!0}:[3,4].includes(ve)?Re.alignment={horizontal:"right",vertical:"middle",wrapText:!0}:[5,6,7,8,9,10,11].includes(ve)?Re.alignment={horizontal:"center",vertical:"middle",wrapText:!0}:Re.alignment={horizontal:"center",vertical:"middle",wrapText:!0},[5,6,7,9,10,11].includes(ve)&&(Re.numFmt="#,##0");const dt=P%2===0?"f8f9fa":"ffffff";Re.fill={type:"pattern",pattern:"solid",fgColor:{argb:dt}},ve===11&&(te==="مسدد"?Re.font={...Re.font,color:{argb:"228b22"},bold:!0}:Re.font={...Re.font,color:{argb:"cc0000"},bold:!0}),Re.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thin",color:{argb:"cccccc"}},right:{style:"thin",color:{argb:"cccccc"}}}}),z.height=25,de++}),de+=1,fe.mergeCells(`A${de}:L${de}`);const Y=fe.getCell(`A${de}`);Y.value="💰 ملخص الحساب المالي",Y.font={name:"Arial",size:11,bold:!0,color:{argb:"FFFFFF"}},Y.alignment={horizontal:"center",vertical:"middle"},Y.fill={type:"pattern",pattern:"solid",fgColor:{argb:"70ad47"}},Y.border={top:{style:"medium",color:{argb:"70ad47"}},bottom:{style:"medium",color:{argb:"70ad47"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},fe.getRow(de).height=22,de++;const Ae=[{label:"إجمالي المشتريات",value:W(E.totalAmount),color:"1f4e79"},{label:"إجمالي المدفوع",value:W(E.paidAmount),color:"228b22"},{label:"إجمالي المتبقي",value:W(E.remainingAmount),color:"cc0000"},{label:"عدد الفواتير",value:w.length.toLocaleString("ar-SA"),color:"1f4e79"}];[[Ae[0],Ae[1]],[Ae[2],Ae[3]]].forEach(xe=>{const P=fe.getRow(de);xe.forEach((z,G)=>{const oe=G*6+1,ce=P.getCell(oe);ce.value=z.label,ce.font={name:"Arial",size:9,bold:!0,color:{argb:"1f4e79"}},ce.alignment={horizontal:"center",vertical:"middle"},ce.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e8f5e8"}},fe.mergeCells(`${String.fromCharCode(64+oe)}${de}:${String.fromCharCode(64+oe+2)}${de}`);const te=P.getCell(oe+3);te.value=z.value,te.font={name:"Arial",size:9,bold:!0,color:{argb:z.color}},te.alignment={horizontal:"center",vertical:"middle"},te.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffffff"}},fe.mergeCells(`${String.fromCharCode(64+oe+3)}${de}:${String.fromCharCode(64+oe+5)}${de}`),[ce,te].forEach(ve=>{ve.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thin",color:{argb:"cccccc"}},right:{style:"thin",color:{argb:"cccccc"}}}})}),fe.getRow(de).height=20,de++}),de+=3,fe.mergeCells(`A${de}:K${de}`);const jt=fe.getCell(`A${de}`);jt.border={bottom:{style:"thick",color:{argb:"1f4e79"}}},de++,fe.mergeCells(`A${de}:K${de}`);const Ve=fe.getCell(`A${de}`);Ve.value="شركة الفتيني للمقاولات والاستشارات الهندسية | تقرير مُنشأ تلقائياً بواسطة نظام إدارة المشاريع",Ve.font={name:"Arial",size:9,italic:!0,color:{argb:"666666"}},Ve.alignment={horizontal:"center",vertical:"middle"},de++,fe.mergeCells(`A${de}:K${de}`);const kt=fe.getCell(`A${de}`);kt.value=`تم إنشاء هذا التقرير في ${v(new Date().toISOString())} | إجمالي السجلات: ${w.length}`,kt.font={name:"Arial",size:8,color:{argb:"999999"}},kt.alignment={horizontal:"center",vertical:"middle"};const ps=await ye.xlsx.writeBuffer(),ks=new Blob([ps],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),X=document.createElement("a");X.href=URL.createObjectURL(ks);const Je=new Date().toISOString().split("T")[0];X.download=`كشف-حساب-${R.name}-${Je}.xlsx`,X.click()},ne=()=>{s("all"),a(""),i(""),l(""),d("all"),f("")};return h.useEffect(()=>{r&&g&&(i(g.minDate),l(g.maxDate))},[r,g]),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3",children:[e.jsx(et,{title:"إجمالي الموردين",value:M.totalSuppliers.toLocaleString("en-US"),icon:_t,color:"blue"}),e.jsx(et,{title:"المشتريات النقدية",value:W(M.totalCashPurchases),icon:ym,color:"green"}),e.jsx(et,{title:"المشتريات الآجلة",value:W(M.totalCreditPurchases),icon:Ga,color:"orange"}),e.jsx(et,{title:"الموردين النشطين",value:M.activeSuppliers.toLocaleString("en-US"),icon:Cs,color:"purple"}),r&&e.jsxs(e.Fragment,{children:[e.jsx(et,{title:"مشتريات المورد (إجمالي)",value:W(E.totalAmount),icon:bd,color:"indigo"}),e.jsx(et,{title:"المدفوع للمورد",value:W(E.paidAmount),icon:Kt,color:"emerald"}),e.jsx(et,{title:"المتبقي على المورد",value:W(E.remainingAmount),icon:An,color:"red"}),e.jsx(et,{title:"فواتير المورد",value:w.length.toLocaleString("en-US"),icon:li,color:"amber"})]})]}),e.jsxs(q,{className:"shadow-sm",children:[e.jsx(ue,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(pe,{className:"flex items-center gap-1 text-base",children:[e.jsx(dl,{className:"w-4 h-4"}),"فلاتر البحث"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:ne,className:"text-xs h-7 px-2",children:[e.jsx(Gt,{className:"w-3 h-3 ml-1"}),"إعادة تعيين"]})]})}),e.jsxs(H,{className:"pt-2 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs text-gray-600",children:"البحث في الموردين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(be,{placeholder:"ابحث باسم المورد...",value:c,onChange:F=>f(F.target.value),className:"pr-8 h-7 text-xs"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs text-gray-600",children:"المورد"}),e.jsxs(qe,{value:r,onValueChange:a,children:[e.jsx(Oe,{className:"h-7 text-xs",children:e.jsx(Ue,{placeholder:p?"جاري التحميل...":"اختر المورد"})}),e.jsx($e,{children:p?e.jsx(K,{value:"loading",disabled:!0,children:"جاري تحميل الموردين..."}):N.length===0?e.jsx(K,{value:"empty",disabled:!0,children:"لا توجد موردين متاحين"}):N.map(F=>e.jsxs(K,{value:F.id,children:[F.name,parseFloat(F.totalDebt)>0&&` - ${W(F.totalDebt)}`]},F.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs text-gray-600",children:"المشروع"}),e.jsxs(qe,{value:t,onValueChange:s,children:[e.jsx(Oe,{className:"h-7 text-xs",children:e.jsx(Ue,{placeholder:"جميع المشاريع"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع المشاريع"}),y.map(F=>e.jsx(K,{value:F.id,children:F.name},F.id))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs text-gray-600",children:"نوع الدفع"}),e.jsxs(qe,{value:u,onValueChange:d,children:[e.jsx(Oe,{className:"h-7 text-xs",children:e.jsx(Ue,{placeholder:"نوع الدفع"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الأنواع"}),e.jsx(K,{value:"نقد",children:"نقد"}),e.jsx(K,{value:"أجل",children:"أجل"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pt-2 border-t border-gray-100"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-gray-600",children:"من تاريخ"}),e.jsxs("div",{className:"relative",children:[e.jsx(or,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(be,{type:"date",value:n,onChange:F=>i(F.target.value),className:"pr-8 h-8 text-sm"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(se,{className:"text-xs font-medium text-gray-600",children:"إلى تاريخ"}),e.jsxs("div",{className:"relative",children:[e.jsx(or,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(be,{type:"date",value:o,onChange:F=>l(F.target.value),className:"pr-8 h-8 text-sm"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-sm font-medium invisible",children:"إجراءات"}),e.jsxs($,{onClick:V,disabled:!r||w.length===0,className:"w-full",children:[e.jsx(yn,{className:"w-4 h-4 ml-2"}),"تصدير التقرير"]})]})]})]})]}),R&&e.jsxs(q,{className:"shadow-sm",children:[e.jsx(ue,{className:"pb-2",children:e.jsxs(pe,{className:"flex items-center gap-2 text-base",children:[e.jsx(Cs,{className:"w-4 h-4"}),"معلومات المورد"]})}),e.jsxs(H,{className:"py-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(Cs,{className:"w-3 h-3"}),"اسم المورد"]}),e.jsx("p",{className:"font-semibold text-sm",children:R.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(_t,{className:"w-3 h-3"}),"المسؤول"]}),e.jsx("p",{className:"font-medium text-sm",children:R.contactPerson||"غير محدد"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(ul,{className:"w-3 h-3"}),"الهاتف"]}),e.jsx("p",{className:"font-medium text-sm",dir:"ltr",children:R.phone||"غير محدد"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(ym,{className:"w-3 h-3"}),"المديونية"]}),e.jsx("p",{className:"font-bold text-red-600 text-sm",children:W(r?M.remainingDebt:R.totalDebt)})]})]}),R.address&&e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600 mb-1",children:[e.jsx(Cr,{className:"w-3 h-3"}),"العنوان"]}),e.jsx("p",{className:"text-gray-800 text-sm",children:R.address})]})]})]}),r&&e.jsxs(q,{className:"shadow-sm",children:[e.jsx(ue,{className:"pb-4",children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(lr,{className:"w-5 h-5"}),"تفاصيل المشتريات",I&&e.jsx(le,{variant:"outline",className:"mr-2",children:I.name})]})}),e.jsx(H,{children:_?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل البيانات..."})]}):w.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Rr,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"لا توجد مشتريات للمورد المحدد"}),e.jsx("p",{className:"text-gray-400",children:"جرب تغيير فلاتر البحث أو التواريخ"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-3",children:w.map((F,ye)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(or,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",dir:"ltr",children:v(F.invoiceDate)})]}),F.invoiceNumber&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(li,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["فاتورة: ",F.invoiceNumber]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[j(F.purchaseType,F.remainingAmount||"0"),e.jsx(le,{variant:F.purchaseType==="نقد"?"default":"secondary",className:"text-xs",children:F.purchaseType})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded-md",children:[e.jsx(Cs,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:y.find(fe=>fe.id===F.projectId)?.name||"غير محدد"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx(ra,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:F.materialName||F.material?.name||F.materialId}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",dir:"ltr",children:["الكمية: ",F.quantity," | سعر الوحدة: ",W(F.unitPrice)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"المبلغ الإجمالي"}),e.jsx("div",{className:"text-sm font-bold text-blue-600",dir:"ltr",children:W(F.totalAmount)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"المدفوع"}),e.jsx("div",{className:"text-sm font-bold text-green-600",dir:"ltr",children:W(F.paidAmount||"0")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"المتبقي"}),e.jsx("div",{className:"text-sm font-bold text-red-600",dir:"ltr",children:W(F.remainingAmount||"0")})]})]}),F.notes&&e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ملاحظات:"}),e.jsx("div",{className:"text-xs text-gray-700 bg-yellow-50 p-2 rounded",children:F.notes})]})]},F.id))}),e.jsxs(Sd,{className:"mt-4",children:[e.jsx(et,{title:"إجمالي المشتريات",value:E.totalAmount,icon:us,color:"blue",format:"currency",trend:{value:0,isPositive:!0}}),e.jsx(et,{title:"عدد الفواتير",value:w.length,icon:li,color:"gray",trend:{value:0,isPositive:!0}}),e.jsx(et,{title:"إجمالي المدفوع",value:E.paidAmount,icon:Ga,color:"green",format:"currency",trend:{value:0,isPositive:!0}}),e.jsx(et,{title:"إجمالي المتبقي",value:E.remainingAmount,icon:Wt,color:"red",format:"currency",trend:{value:0,isPositive:!1}})]})]})})]}),!r&&e.jsx(q,{className:"shadow-sm",children:e.jsxs(H,{className:"text-center py-12",children:[e.jsx(_r,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"اختر مورداً لعرض حسابه"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"استخدم فلاتر البحث أعلاه لاختيار مورد وعرض تفاصيل حسابه ومشترياته"}),p?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"جاري تحميل الموردين..."})]}):x.length===0?e.jsxs(en,{children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsx(tn,{children:"لا يوجد موردين مسجلين في النظام. يرجى إضافة الموردين أولاً من صفحة إدارة الموردين."})]}):A?e.jsxs(en,{children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsx(tn,{children:"حدث خطأ في تحميل بيانات الموردين. يرجى تحديث الصفحة أو المحاولة مرة أخرى."})]}):null]})})]})}var Fu="Progress",Ou=100,[N6]=Hs(Fu),[w6,k6]=N6(Fu),u1=h.forwardRef((t,s)=>{const{__scopeProgress:r,value:a=null,max:n,getValueLabel:i=S6,...o}=t;(n||n===0)&&!kf(n)&&console.error(T6(`${n}`,"Progress"));const l=kf(n)?n:Ou;a!==null&&!Sf(a,l)&&console.error(A6(`${a}`,"Progress"));const u=Sf(a,l)?a:null,d=Zo(u)?i(u,l):void 0;return e.jsx(w6,{scope:r,value:u,max:l,children:e.jsx(We.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":Zo(u)?u:void 0,"aria-valuetext":d,role:"progressbar","data-state":f1(u,l),"data-value":u??void 0,"data-max":l,...o,ref:s})})});u1.displayName=Fu;var m1="ProgressIndicator",h1=h.forwardRef((t,s)=>{const{__scopeProgress:r,...a}=t,n=k6(m1,r);return e.jsx(We.div,{"data-state":f1(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...a,ref:s})});h1.displayName=m1;function S6(t,s){return`${Math.round(t/s*100)}%`}function f1(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function Zo(t){return typeof t=="number"}function kf(t){return Zo(t)&&!isNaN(t)&&t>0}function Sf(t,s){return Zo(t)&&!isNaN(t)&&t<=s&&t>=0}function T6(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${Ou}\`.`}function A6(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${Ou} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var p1=u1,C6=h1;const ir=h.forwardRef(({className:t,value:s,...r},a)=>e.jsx(p1,{ref:a,className:he("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:e.jsx(C6,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));ir.displayName=p1.displayName;function P6(){const{toast:t}=Ct();Mt();const[s,r]=h.useState(!1),{setFloatingAction:a}=Ls();h.useEffect(()=>(a(()=>{s||(r(!0),d.mutate())},"تشغيل الصيانة"),()=>a(null)),[a,s]);const{data:n,isLoading:i,refetch:o}=ge({queryKey:["autocomplete-admin","stats"],queryFn:()=>ae("/api/autocomplete-admin/stats","GET")}),l=Ce({mutationFn:()=>ae("/api/autocomplete-admin/cleanup","POST"),onSuccess:m=>{t({title:"تم التنظيف بنجاح",description:`تم حذف ${m.deletedCount} سجل قديم من ${m.categories.length} فئة`}),o()},onError:()=>{t({title:"خطأ في التنظيف",description:"فشل في تنظيف البيانات القديمة",variant:"destructive"})}}),u=Ce({mutationFn:m=>ae("/api/autocomplete-admin/enforce-limits","POST",{category:m}),onSuccess:m=>{t({title:"تم تطبيق الحدود بنجاح",description:`تم تقليم ${m.trimmedCategories.length} فئة وحذف ${m.deletedCount} سجل`}),o()},onError:()=>{t({title:"خطأ في تطبيق الحدود",description:"فشل في تطبيق حدود الفئات",variant:"destructive"})}}),d=Ce({mutationFn:()=>ae("/api/autocomplete-admin/maintenance","POST"),onSuccess:m=>{t({title:"اكتملت الصيانة الشاملة",description:`معالجة ${m.totalProcessed} سجل بنجاح`}),o(),r(!1)},onError:()=>{t({title:"خطأ في الصيانة",description:"فشل في تشغيل الصيانة الشاملة",variant:"destructive"}),r(!1)}}),c=()=>{r(!0),d.mutate()},f=m=>new Intl.NumberFormat("en-US").format(m);return i?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs(q,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-500 to-blue-600 text-white hover:shadow-xl transition-all duration-300",children:[e.jsx(ue,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{className:"text-xs sm:text-sm font-medium opacity-90",children:"إجمالي السجلات"}),e.jsx($t,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(H,{className:"pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:f(n?.totalRecords||0)}),e.jsx("p",{className:"text-xs opacity-80",children:"سجل في النظام"})]})]}),e.jsxs(q,{className:"border-0 shadow-lg bg-gradient-to-br from-green-500 to-green-600 text-white hover:shadow-xl transition-all duration-300",children:[e.jsx(ue,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{className:"text-xs sm:text-sm font-medium opacity-90",children:"عدد الفئات"}),e.jsx(ls,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(H,{className:"pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:f(n?.categoriesCount||0)}),e.jsx("p",{className:"text-xs opacity-80",children:"فئة مختلفة"})]})]}),e.jsxs(q,{className:"border-0 shadow-lg bg-gradient-to-br from-orange-500 to-orange-600 text-white hover:shadow-xl transition-all duration-300",children:[e.jsx(ue,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{className:"text-xs sm:text-sm font-medium opacity-90",children:"السجلات القديمة"}),e.jsx(Ut,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(H,{className:"pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:f(n?.oldRecordsCount||0)}),e.jsx("p",{className:"text-xs opacity-80",children:"تحتاج تنظيف"})]})]}),e.jsxs(q,{className:`border-0 shadow-lg text-white hover:shadow-xl transition-all duration-300 ${n?.oldRecordsCount===0?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gradient-to-br from-yellow-500 to-yellow-600"}`,children:[e.jsx(ue,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{className:"text-xs sm:text-sm font-medium opacity-90",children:"حالة النظام"}),n?.oldRecordsCount===0?e.jsx(Qt,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"}):e.jsx(Ot,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(H,{className:"pt-0",children:[e.jsx("div",{className:"text-lg sm:text-xl lg:text-2xl font-bold mb-1",children:n?.oldRecordsCount===0?"ممتاز":"يحتاج صيانة"}),e.jsx("p",{className:"text-xs opacity-80",children:n?.oldRecordsCount===0?"النظام محسّن":"يحتاج تنظيف"})]})]})]}),e.jsxs(Ks,{defaultValue:"overview",className:"w-full bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3 bg-gray-100 dark:bg-gray-700 p-1 rounded-lg gap-1",children:[e.jsxs(He,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm transition-all duration-200 text-sm sm:text-base font-medium rounded-md","data-testid":"tab-overview",children:[e.jsx(Ot,{className:"w-4 h-4 sm:w-5 sm:h-5 ml-2"}),"نظرة عامة"]}),e.jsxs(He,{value:"categories",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm transition-all duration-200 text-sm sm:text-base font-medium rounded-md","data-testid":"tab-categories",children:[e.jsx(ls,{className:"w-4 h-4 sm:w-5 sm:h-5 ml-2"}),e.jsx("span",{className:"hidden sm:inline",children:"تفصيل"})," الفئات"]}),e.jsxs(He,{value:"maintenance",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm transition-all duration-200 text-sm sm:text-base font-medium rounded-md","data-testid":"tab-maintenance",children:[e.jsx(rs,{className:"w-4 h-4 sm:w-5 sm:h-5 ml-2"}),e.jsx("span",{className:"hidden sm:inline",children:"أدوات"})," الصيانة"]})]}),e.jsx(Ge,{value:"overview",className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:e.jsxs(q,{className:"border-0 shadow-md bg-gradient-to-r from-white to-blue-50 dark:from-gray-800 dark:to-gray-900",children:[e.jsx(ue,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(Kt,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsx(pe,{className:"text-lg sm:text-xl text-gray-900 dark:text-white",children:"صحة النظام"})]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"كفاءة البيانات"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[n&&n.totalRecords>0?Math.round((n.totalRecords-n.oldRecordsCount)/n.totalRecords*100):0,"%"]}),e.jsx(le,{variant:n&&n.totalRecords>0&&(n.totalRecords-n.oldRecordsCount)/n.totalRecords*100>80?"default":"secondary",children:n&&n.totalRecords>0&&(n.totalRecords-n.oldRecordsCount)/n.totalRecords*100>80?"ممتاز":"يحتاج تحسين"})]})]}),e.jsx(ir,{value:n&&n.totalRecords>0?(n.totalRecords-n.oldRecordsCount)/n.totalRecords*100:0,className:"h-3 bg-gray-200 dark:bg-gray-700"})]}),n&&n.oldRecordsCount>0&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800 dark:text-orange-200 text-sm sm:text-base",children:["تحذير: يوجد ",f(n.oldRecordsCount)," سجل قديم"]})]}),e.jsxs($,{size:"sm",variant:"outline",className:"w-fit border-orange-300 text-orange-700 hover:bg-orange-100 dark:border-orange-600 dark:text-orange-300",onClick:()=>l.mutate(),disabled:l.isPending,"data-testid":"button-quick-cleanup",children:[e.jsx(os,{className:"w-4 h-4 ml-1"}),"تنظيف سريع"]})]}),e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-300 mt-2 mr-7 sm:mr-0",children:"هذه السجلات لم تُستخدم لأكثر من 6 أشهر وتم استخدامها أقل من 3 مرات"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Qt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800 dark:text-green-200 text-sm",children:"السجلات النشطة"})]}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:f((n?.totalRecords||0)-(n?.oldRecordsCount||0))})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($t,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-200 text-sm",children:"متوسط الاستخدام"})]}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:n?.categoryBreakdown&&Math.round(n.categoryBreakdown.reduce((m,y)=>m+(y.avgUsage||0),0)/n.categoryBreakdown.length)||0})]})]})]})]})}),e.jsx(Ge,{value:"categories",className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:e.jsxs(q,{className:"border-0 shadow-md",children:[e.jsx(ue,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg",children:e.jsx(ls,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg sm:text-xl text-gray-900 dark:text-white",children:"تفصيل الفئات"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"الاستخدام والإحصائيات"})]})]}),e.jsxs($,{size:"sm",variant:"outline",onClick:()=>u.mutate(void 0),disabled:u.isPending,className:"w-full sm:w-auto","data-testid":"button-enforce-all-limits",children:[e.jsx(rs,{className:"w-4 h-4 ml-1"}),"تطبيق الحدود على الكل"]})]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[n?.categoryBreakdown.map((m,y)=>e.jsxs("div",{className:"group bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-700 p-4 rounded-xl border border-gray-200 dark:border-gray-600 hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-blue-500 to-green-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:m.category}),e.jsx(le,{variant:m.count>100?"destructive":m.count>50?"default":"secondary",className:"text-xs",children:m.count>100?"مرتفع":m.count>50?"متوسط":"منخفض"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block",children:"عدد السجلات"}),e.jsx("span",{className:"font-bold text-lg text-gray-900 dark:text-white",children:f(m.count)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block",children:"متوسط الاستخدام"}),e.jsx("span",{className:"font-bold text-lg text-blue-600 dark:text-blue-400",children:isNaN(m.avgUsage)||!isFinite(m.avgUsage)?"0.0":m.avgUsage.toFixed(1)})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block",children:"الحالة"}),e.jsx("span",{className:`font-medium ${m.count>100?"text-red-600":m.count>50?"text-yellow-600":"text-green-600"}`,children:m.count>100?"يحتاج تقليم":m.count>50?"مراقبة":"صحي"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 lg:flex-col lg:gap-1",children:[e.jsxs($,{size:"sm",variant:m.count>100?"destructive":"outline",onClick:()=>u.mutate(m.category),disabled:u.isPending,className:"flex-1 lg:flex-none lg:w-20 transition-all duration-200","data-testid":`button-trim-${y}`,children:[e.jsx(os,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"تقليم"})]}),e.jsxs("div",{className:"text-xs text-center text-gray-500 dark:text-gray-400 lg:w-20",children:[Math.round(m.count/(n?.totalRecords||1)*100),"%"]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(ir,{value:Math.min(m.count/100*100,100),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"الحد الأقصى (100)"})]})]})]},m.category)),(!n?.categoryBreakdown||n.categoryBreakdown.length===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ls,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد فئات محفوظة بعد"})]})]})})]})}),e.jsxs(Ge,{value:"maintenance",className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs(q,{className:"border-0 shadow-md bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20",children:[e.jsx(ue,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/50 rounded-lg",children:e.jsx(os,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg text-gray-900 dark:text-white",children:"تنظيف البيانات القديمة"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"حذف السجلات غير المستخدمة"})]})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border",children:[e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-3",children:["حذف السجلات التي لم تُستخدم لأكثر من ",e.jsx("strong",{children:"6 أشهر"})," والمستخدمة أقل من ",e.jsx("strong",{children:"3 مرات"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"السجلات المستهدفة:"}),e.jsxs(le,{variant:n?.oldRecordsCount===0?"secondary":"destructive",children:[f(n?.oldRecordsCount||0)," سجل"]})]})]}),e.jsx($,{onClick:()=>l.mutate(),disabled:l.isPending,className:"w-full transition-all duration-200",variant:n?.oldRecordsCount===0?"secondary":"destructive",size:"lg","data-testid":"button-cleanup",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري التنظيف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"w-4 h-4 ml-2"}),"تنظيف البيانات القديمة"]})})]})]}),e.jsxs(q,{className:"border-0 shadow-md bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20",children:[e.jsx(ue,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(rs,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg text-gray-900 dark:text-white",children:"تطبيق حدود الفئات"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"تحسين أداء النظام"})]})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border",children:[e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-3",children:["فرض حد أقصى ",e.jsx("strong",{children:"100 اقتراح"})," لكل فئة وحذف الأقل استخداماً"]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"الفئات المتأثرة:"}),e.jsxs(le,{variant:"secondary",children:[n?.categoryBreakdown?.filter(m=>m.count>100).length||0," فئة"]})]})]}),e.jsx($,{onClick:()=>u.mutate(void 0),disabled:u.isPending,className:"w-full transition-all duration-200",variant:"outline",size:"lg","data-testid":"button-enforce-limits",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري التطبيق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4 ml-2"}),"تطبيق الحدود"]})})]})]})]}),e.jsx(Is,{className:"my-6"}),e.jsxs(q,{className:"border-0 shadow-lg bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20",children:[e.jsx(ue,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl shadow-sm",children:e.jsx(Gt,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx(pe,{className:"text-xl text-gray-900 dark:text-white",children:"صيانة شاملة للنظام"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"تحسين وتنظيف شامل للنظام"})]})]}),e.jsx(le,{variant:"outline",className:"text-xs bg-white dark:bg-gray-800",children:"موصى به شهرياً"})]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-4 sm:p-6 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-4 flex items-center gap-2",children:[e.jsx(Ot,{className:"w-5 h-5"}),"ما تتضمنه الصيانة الشاملة:"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"حذف السجلات القديمة وغير المستخدمة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"تطبيق حدود على جميع الفئات"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"تحسين فهارس قاعدة البيانات"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"إعادة تنظيم ترتيب الاقتراحات"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Wt,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200 text-sm",children:"تحذير هام"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"قد تستغرق العملية عدة دقائق حسب حجم البيانات. لا تغلق الصفحة أثناء التشغيل."})]})]})}),e.jsx($,{onClick:c,disabled:s||d.isPending,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transition-all duration-300",size:"lg","data-testid":"button-comprehensive-maintenance",children:s||d.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري تشغيل الصيانة الشاملة..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Gt,{className:"w-4 h-4 ml-2"}),"تشغيل الصيانة الشاملة"]})})]})]})]})]})]})})}const _6=rn({name:Qe().min(1,"اسم المعدة مطلوب"),code:Qe().optional(),type:Qe().min(1,"فئة المعدة مطلوبة"),status:Qe().min(1,"حالة المعدة مطلوبة"),description:Qe().optional(),purchaseDate:Qe().optional(),purchasePrice:Qe().optional(),currentProjectId:Qe().nullable().optional(),imageUrl:Qe().optional()});function Tf({open:t,onOpenChange:s,projects:r,equipment:a}){const{toast:n}=Ct(),i=Mt(),o=h.useRef(null),[l,u]=h.useState(null),[d,c]=h.useState(null),f=!!a,m=va({resolver:ba(_6),defaultValues:{name:a?.name||"",code:a?.code||"",type:a?.type||"أدوات كهربائية",status:a?.status||"active",description:a?.description||"",purchaseDate:a?.purchaseDate||"",purchasePrice:a?.purchasePrice?.toString()||"",currentProjectId:a?.currentProjectId||null,imageUrl:a?.imageUrl||""}}),y=N=>{if(N&&N.type.startsWith("image/")){const w=new FileReader;w.onload=_=>{const b=_.target?.result;u(b),c(N),m.setValue("imageUrl",b)},w.readAsDataURL(N)}else n({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"})},x=N=>{o.current&&(o.current.accept="image/*",N?o.current.setAttribute("capture","environment"):o.current.removeAttribute("capture"),o.current.click())},p=()=>{u(null),c(null),m.setValue("imageUrl",""),o.current&&(o.current.value="")},A=Ce({mutationFn:N=>f&&a?.id?ae(`/api/equipment/${a.id}`,"PUT",N):ae("/api/equipment","POST",N),onSuccess:()=>{i.invalidateQueries({predicate:N=>Array.isArray(N.queryKey)&&N.queryKey[0]==="equipment"}),n({title:"نجح الحفظ",description:f?"تم تحديث المعدة بنجاح":"تم إضافة المعدة بنجاح",variant:"default"}),m.reset(),p(),s(!1)},onError:N=>{n({title:"خطأ",description:N.message||(f?"حدث خطأ أثناء تحديث المعدة":"حدث خطأ أثناء إضافة المعدة"),variant:"destructive"})}});h.useEffect(()=>{a&&f&&(m.reset({name:a.name||"",code:a.code||"",type:a.type||"أدوات كهربائية",status:a.status||"active",description:a.description||"",purchaseDate:a.purchaseDate||"",purchasePrice:a.purchasePrice?.toString()||"",currentProjectId:a.currentProjectId||null,imageUrl:a.imageUrl||""}),a.imageUrl&&u(a.imageUrl))},[a,f,m]);const g=N=>{const w={...N,purchasePrice:N.purchasePrice?N.purchasePrice:void 0,currentProjectId:N.currentProjectId||null};A.mutate(w)};return e.jsx(qs,{open:t,onOpenChange:s,children:e.jsxs(Fs,{className:"w-[95vw] max-w-[500px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Us,{className:"pb-3",children:[e.jsx(Ws,{className:"text-lg",children:f?"تعديل المعدة":"إضافة معدة جديدة"}),e.jsx(Ys,{className:"text-sm text-gray-600",children:f?"قم بتحديث بيانات المعدة":"أدخل تفاصيل المعدة الجديدة"})]}),e.jsx(ja,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(g),className:"space-y-3",children:[e.jsx(Nt,{control:m.control,name:"name",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"اسم المعدة *"}),e.jsx(vt,{children:e.jsx(be,{placeholder:"مثال: حفار صغير",className:"h-9 text-sm",...N,"data-testid":"input-equipment-name"})}),e.jsx(bt,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Nt,{control:m.control,name:"type",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"الفئة *"}),e.jsxs(qe,{onValueChange:N.onChange,defaultValue:N.value,children:[e.jsx(vt,{children:e.jsx(Oe,{"data-testid":"select-equipment-type",className:"h-9 text-sm",children:e.jsx(Ue,{placeholder:"اختر الفئة"})})}),e.jsxs($e,{children:[e.jsx(K,{value:"أدوات كهربائية",children:"أدوات كهربائية"}),e.jsx(K,{value:"أدوات يدوية",children:"أدوات يدوية"}),e.jsx(K,{value:"أدوات قياس",children:"أدوات قياس"}),e.jsx(K,{value:"معدات لحام",children:"معدات لحام"}),e.jsx(K,{value:"معدات حفر",children:"معدات حفر"}),e.jsx(K,{value:"معدات قطع",children:"معدات قطع"}),e.jsx(K,{value:"أدوات ربط",children:"أدوات ربط"}),e.jsx(K,{value:"مواد كهربائية",children:"مواد كهربائية"}),e.jsx(K,{value:"معدات أمان",children:"معدات أمان"}),e.jsx(K,{value:"أدوات نقل",children:"أدوات نقل"})]})]}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:m.control,name:"status",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"الحالة *"}),e.jsxs(qe,{onValueChange:N.onChange,defaultValue:N.value,children:[e.jsx(vt,{children:e.jsx(Oe,{"data-testid":"select-equipment-status",className:"h-9 text-sm",children:e.jsx(Ue,{placeholder:"اختر الحالة"})})}),e.jsxs($e,{children:[e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"maintenance",children:"صيانة"}),e.jsx(K,{value:"out_of_service",children:"خارج الخدمة"}),e.jsx(K,{value:"inactive",children:"غير نشط"})]})]}),e.jsx(bt,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Nt,{control:m.control,name:"purchaseDate",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"تاريخ الشراء"}),e.jsx(vt,{children:e.jsx(be,{type:"date",className:"h-9 text-sm",...N,"data-testid":"input-purchase-date"})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:m.control,name:"purchasePrice",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"سعر الشراء"}),e.jsx(vt,{children:e.jsx(be,{type:"number",placeholder:"0",className:"h-9 text-sm",...N,"data-testid":"input-purchase-price"})}),e.jsx(bt,{})]})})]}),e.jsx(Nt,{control:m.control,name:"currentProjectId",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"المشروع الحالي"}),e.jsxs(qe,{onValueChange:w=>N.onChange(w==="warehouse"?null:w),defaultValue:N.value||"warehouse",children:[e.jsx(vt,{children:e.jsx(Oe,{"data-testid":"select-current-project",className:"h-9 text-sm",children:e.jsx(Ue,{placeholder:"اختر المشروع (اختياري)"})})}),e.jsxs($e,{children:[e.jsx(K,{value:"warehouse",children:"المستودع"}),r.map(w=>e.jsx(K,{value:w.id,children:w.name},w.id))]})]}),e.jsx(Ii,{className:"text-xs text-gray-500",children:"اتركه فارغاً إذا كانت المعدة في المستودع"}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:m.control,name:"imageUrl",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"صورة المعدة"}),e.jsx(vt,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{ref:o,type:"file",accept:"image/*",className:"hidden",onChange:w=>{const _=w.target.files?.[0];_&&y(_)},"data-testid":"input-file-image"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>x(!0),className:"h-9 text-xs","data-testid":"button-camera",children:[e.jsx(So,{className:"h-4 w-4 mr-1"}),"تصوير بالكاميرا"]}),e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>x(!1),className:"h-9 text-xs","data-testid":"button-gallery",children:[e.jsx(Ao,{className:"h-4 w-4 mr-1"}),"اختيار من المعرض"]})]}),l&&e.jsxs("div",{className:"relative w-full h-32 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("img",{src:l,alt:"معاينة الصورة",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:p,className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 transition-colors","data-testid":"button-remove-image",children:e.jsx(yr,{className:"h-3 w-3"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",children:[e.jsx(go,{className:"h-3 w-3 inline mr-1"}),d?.name||"صورة محددة"]})]})]})}),e.jsx(Ii,{className:"text-xs text-gray-500",children:"يمكنك تصوير صورة جديدة أو اختيار صورة من المعرض"}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:m.control,name:"description",render:({field:N})=>e.jsxs(yt,{children:[e.jsx(mt,{className:"text-sm font-medium",children:"الوصف"}),e.jsx(vt,{children:e.jsx(an,{placeholder:"وصف إضافي للمعدة...",className:"resize-none text-sm min-h-[60px]",rows:2,...N,"data-testid":"textarea-description"})}),e.jsx(bt,{})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:justify-end pt-2",children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>s(!1),className:"order-2 sm:order-1 h-9 text-sm","data-testid":"button-cancel",children:"إلغاء"}),e.jsx($,{type:"submit",disabled:A.isPending,className:"order-1 sm:order-2 h-9 text-sm","data-testid":"button-submit",children:A.isPending?"جاري الحفظ...":f?"تحديث المعدة":"إضافة المعدة"})]})]})})]})})}const E6=rn({toProjectId:Qe().nullable(),reason:Qe().min(1,"سبب النقل مطلوب"),performedBy:Qe().min(1,"اسم من قام بالنقل مطلوب"),notes:Qe().optional()});function D6({equipment:t,open:s,onOpenChange:r,projects:a}){const{toast:n}=Ct(),i=Mt(),o=va({resolver:ba(E6),defaultValues:{toProjectId:null,reason:"",performedBy:"",notes:""}}),l=Ce({mutationFn:c=>ae(`/api/equipment/${t?.id}/transfer`,"POST",c),onSuccess:()=>{i.invalidateQueries({predicate:c=>Array.isArray(c.queryKey)&&c.queryKey[0]==="equipment"}),i.invalidateQueries({predicate:c=>Array.isArray(c.queryKey)&&c.queryKey[0]==="equipment-movements"}),i.invalidateQueries({queryKey:["projects"]}),n({title:"نجح النقل",description:"تم نقل المعدة بنجاح",variant:"default"}),o.reset(),r(!1)},onError:c=>{n({title:"خطأ",description:c.message||"فشل في نقل المعدة",variant:"destructive"})}}),u=c=>{l.mutate({...c,toProjectId:c.toProjectId||null})},d=()=>{if(!t)return"";if(!t.currentProjectId)return"المستودع";const c=Array.isArray(a)?a.find(f=>f.id===t.currentProjectId):void 0;return c?c.name:"مشروع غير معروف"};return t?e.jsx(qs,{open:s,onOpenChange:r,children:e.jsxs(Fs,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(Us,{children:[e.jsxs(Ws,{className:"flex items-center gap-2",children:[e.jsx(um,{className:"h-5 w-5"}),"نقل المعدة"]}),e.jsxs(Ys,{children:['نقل المعدة "',t.name,'" إلى موقع جديد']})]}),e.jsx(ja,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(u),className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"الموقع الحالي:"}),e.jsx("p",{className:"font-medium","data-testid":"text-current-location",children:d()})]}),e.jsx(um,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"الموقع الجديد:"}),e.jsx("p",{className:"font-medium text-blue-600","data-testid":"text-new-location",children:o.watch("toProjectId")&&o.watch("toProjectId")!=="warehouse"&&a.find(c=>c.id===o.watch("toProjectId"))?.name||"المستودع"})]})]})}),e.jsx(Nt,{control:o.control,name:"toProjectId",render:({field:c})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"المشروع المقصود"}),e.jsxs(qe,{onValueChange:f=>c.onChange(f==="warehouse"?null:f),defaultValue:c.value||"warehouse",children:[e.jsx(vt,{children:e.jsx(Oe,{"data-testid":"select-destination-project",children:e.jsx(Ue,{placeholder:"اختر المشروع المقصود"})})}),e.jsxs($e,{children:[e.jsx(K,{value:"warehouse",children:"المستودع"}),a.filter(f=>f.id!==t.currentProjectId).map(f=>e.jsx(K,{value:f.id,children:f.name},f.id))]})]}),e.jsx(Ii,{children:"اختر المشروع الذي تريد نقل المعدة إليه، أو اتركه فارغاً للنقل إلى المستودع"}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:o.control,name:"reason",render:({field:c})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"سبب النقل *"}),e.jsx(vt,{children:e.jsx(be,{placeholder:"مثال: انتهاء العمل في المشروع السابق",...c,"data-testid":"input-transfer-reason"})}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:o.control,name:"performedBy",render:({field:c})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"تم بواسطة *"}),e.jsx(vt,{children:e.jsx(be,{placeholder:"اسم الشخص المسؤول عن النقل",...c,"data-testid":"input-performed-by"})}),e.jsx(Ii,{children:"أدخل اسم الشخص المسؤول عن تنفيذ عملية النقل"}),e.jsx(bt,{})]})}),e.jsx(Nt,{control:o.control,name:"notes",render:({field:c})=>e.jsxs(yt,{children:[e.jsx(mt,{children:"ملاحظات إضافية"}),e.jsx(vt,{children:e.jsx(an,{placeholder:"ملاحظات أو تفاصيل إضافية حول النقل...",className:"resize-none",rows:3,...c,"data-testid":"textarea-transfer-notes"})}),e.jsx(bt,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 space-x-reverse pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>r(!1),"data-testid":"button-cancel-transfer",children:"إلغاء"}),e.jsx($,{type:"submit",disabled:l.isPending,"data-testid":"button-confirm-transfer",children:l.isPending?"جاري النقل...":"تأكيد النقل"})]})]})})]})}):null}function M6({equipment:t,open:s,onOpenChange:r,projects:a}){const{data:n=[],isLoading:i}=ge({queryKey:["equipment-movements",t?.id],queryFn:()=>fetch(`/api/equipment/${t?.id}/movements`).then(u=>u.json()),enabled:!!t?.id&&s,staleTime:3e4}),o=u=>{if(!u)return"غير محدد";const d=Array.isArray(a)?a.find(c=>c.id===u):void 0;return d?d.name:"مشروع غير معروف"},l=u=>{try{const d=new Date(u);return d.toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",weekday:"long"})+" - "+d.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}catch{return u}};return e.jsx(qs,{open:s,onOpenChange:r,children:e.jsxs(Fs,{className:"w-[95vw] max-w-[900px] h-[90vh] overflow-hidden flex flex-col",dir:"rtl",children:[e.jsxs(Us,{className:"pb-4 border-b bg-gradient-to-r from-blue-50 to-indigo-50 -m-6 mb-0 p-6 rounded-t-lg",children:[e.jsxs(Ws,{className:"flex items-center gap-3 text-xl font-bold",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(xo,{className:"w-6 h-6 text-blue-700"})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-blue-900",children:"سجل حركة المعدة"})})]}),e.jsxs(Ys,{className:"text-sm font-normal text-blue-600 mt-1",children:[t?.name," - عرض سجل التحويلات والحركات"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 mt-4 px-1",children:[e.jsx(q,{className:"border-0 shadow-lg bg-gradient-to-br from-white to-gray-50",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(lr,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"كود المعدة"}),e.jsx("div",{className:"font-bold text-gray-900",children:t?.code})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Cr,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"المشروع الحالي"}),e.jsx("div",{className:"font-bold text-gray-900 truncate",children:o(t?.currentProjectId||null)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(lr,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"نوع المعدة"}),e.jsx("div",{className:"font-bold text-gray-900",children:t?.type})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${t?.status==="active"?"bg-green-500":t?.status==="maintenance"?"bg-yellow-500":t?.status==="damaged"?"bg-red-500":"bg-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"حالة المعدة"}),e.jsx(le,{className:`font-bold ${t?.status==="active"?"bg-green-100 text-green-800":t?.status==="maintenance"?"bg-yellow-100 text-yellow-800":t?.status==="damaged"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t?.status==="active"?"نشط":t?.status==="maintenance"?"في الصيانة":t?.status==="damaged"?"معطل":"غير نشط"})]})]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(xo,{className:"w-5 h-5 text-indigo-700"})}),e.jsx("h3",{className:"font-bold text-gray-900",children:"سجل الحركات"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(le,{className:"bg-indigo-100 text-indigo-800 font-bold px-3 py-1",children:[n.length," حركة"]})})]}),i?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200"}),e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent absolute top-0 left-0"})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"جاري تحميل سجل الحركات..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"الرجاء الانتظار"})]})]}):n.length===0?e.jsx(q,{className:"border-0 shadow-lg bg-gradient-to-br from-gray-50 to-slate-50",children:e.jsx(H,{className:"py-12 text-center",children:e.jsxs("div",{className:"max-w-sm mx-auto",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(xo,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"لا توجد حركات مسجلة"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"لم يتم تسجيل أي حركات نقل لهذه المعدة حتى الآن."}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-600",children:"💡 ستظهر جميع حركات النقل هنا عند تسجيلها"})})]})})}):e.jsx("div",{className:"space-y-4",children:n.map((u,d)=>e.jsx(q,{className:"border-0 shadow-lg hover:shadow-xl transition-all duration-300 bg-gradient-to-br from-white to-gray-50/50",children:e.jsxs(H,{className:"p-0",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-bold text-blue-700",children:["#",n.length-d]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-900",children:["حركة رقم ",n.length-d]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 mt-1",children:[e.jsx(or,{className:"w-3 h-3"}),l(u.movementDate)]})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 p-4 rounded-xl border border-blue-100",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4",children:[e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Cr,{className:"w-3 h-3 text-green-600"})}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"من"})]}),e.jsx("div",{className:"bg-white/70 p-3 rounded-lg border border-green-200",children:e.jsx("span",{className:"text-sm font-bold text-gray-900 block truncate",children:o(u.fromProjectId)})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(fa,{className:"w-4 h-4 text-blue-600"})})}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Cr,{className:"w-3 h-3 text-blue-600"})}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"إلى"})]}),e.jsx("div",{className:"bg-white/70 p-3 rounded-lg border border-blue-200",children:e.jsx("span",{className:"text-sm font-bold text-gray-900 block truncate",children:o(u.toProjectId)})})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Zs,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"قام بالنقل"}),e.jsx("div",{className:"text-sm font-bold text-gray-900",children:u.performedBy})]})]}),u.reason&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center mt-0.5",children:e.jsx(lr,{className:"w-4 h-4 text-amber-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"السبب"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 break-words",children:u.reason})]})]}),u.notes&&e.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-yellow-100 rounded-full flex items-center justify-center mt-0.5",children:e.jsx("span",{className:"text-xs",children:"💡"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-800 font-bold text-xs block mb-1",children:"ملاحظات مهمة"}),e.jsx("span",{className:"text-yellow-700 text-sm break-words",children:u.notes})]})]})})]})]})]})},u.id))})]})]})]})})}var wo={exports:{}},R6=wo.exports,Af;function I6(){return Af||(Af=1,(function(t,s){(function(r,a){a()})(R6,function(){function r(d,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\uFEFF",d],{type:d.type}):d}function a(d,c,f){var m=new XMLHttpRequest;m.open("GET",d),m.responseType="blob",m.onload=function(){u(m.response,c,f)},m.onerror=function(){console.error("could not download file")},m.send()}function n(d){var c=new XMLHttpRequest;c.open("HEAD",d,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function i(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(c)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ao=="object"&&ao.global===ao?ao:void 0,l=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(d,c,f){var m=o.URL||o.webkitURL,y=document.createElement("a");c=c||d.name||"download",y.download=c,y.rel="noopener",typeof d=="string"?(y.href=d,y.origin===location.origin?i(y):n(y.href)?a(d,c,f):i(y,y.target="_blank")):(y.href=m.createObjectURL(d),setTimeout(function(){m.revokeObjectURL(y.href)},4e4),setTimeout(function(){i(y)},0))}:"msSaveOrOpenBlob"in navigator?function(d,c,f){if(c=c||d.name||"download",typeof d!="string")navigator.msSaveOrOpenBlob(r(d,f),c);else if(n(d))a(d,c,f);else{var m=document.createElement("a");m.href=d,m.target="_blank",setTimeout(function(){i(m)})}}:function(d,c,f,m){if(m=m||open("","_blank"),m&&(m.document.title=m.document.body.innerText="downloading..."),typeof d=="string")return a(d,c,f);var y=d.type==="application/octet-stream",x=/constructor/i.test(o.HTMLElement)||o.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||y&&x||l)&&typeof FileReader<"u"){var A=new FileReader;A.onloadend=function(){var w=A.result;w=p?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),m?m.location.href=w:location=w,m=null},A.readAsDataURL(d)}else{var g=o.URL||o.webkitURL,N=g.createObjectURL(d);m?m.location=N:location.href=N,m=null,setTimeout(function(){g.revokeObjectURL(N)},4e4)}});o.saveAs=u.saveAs=u,t.exports=u})})(wo)),wo.exports}var F6=I6();const wt={colors:{primary:"FF1E40AF",secondary:"FF64748B",success:"FF16A34A",danger:"FFDC2626",warning:"FFCA8A04",background:"FFF8FAFC",headerBg:"FF334155",totalsBg:"FFF1F5F9"},fonts:{title:{name:"Arial",size:16,bold:!0,color:{argb:"FF1E293B"}},header:{name:"Arial",size:12,bold:!0,color:{argb:"FFFFFFFF"}},subHeader:{name:"Arial",size:11,bold:!0,color:{argb:"FF1E293B"}},data:{name:"Arial",size:10,color:{argb:"FF334155"}},totals:{name:"Arial",size:11,bold:!0,color:{argb:"FF1E293B"}},footer:{name:"Arial",size:9,italic:!0,color:{argb:"FF64748B"}}},borders:{thin:{style:"thin",color:{argb:"FFE2E8F0"}},medium:{style:"medium",color:{argb:"FF94A3B8"}},thick:{style:"thick",color:{argb:"FF475569"}}}},td={name:"شركة الفتيني للمقاولات والاستشارات الهندسية",nameEn:"Al-Fathi Construction & Engineering Consultancy Company",address:"الجمهورية اليمنية",phone:"+967XXXXXXXXX",email:"info@alfatini.com",website:"www.alfatini.com",logo:"🏗️"};function O6(t,s,r,a){let n=1;t.addRow([td.name]),t.mergeCells(`A${n}:H${n}`);const i=t.getCell(`A${n}`);i.font=wt.fonts.title,i.alignment={horizontal:"center",vertical:"middle"},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:wt.colors.background}},t.getRow(n).height=25,n++,t.addRow([]),n++,t.addRow([s]),t.mergeCells(`A${n}:H${n}`);const o=t.getCell(`A${n}`);if(o.font={...wt.fonts.title,size:18},o.alignment={horizontal:"center",vertical:"middle"},o.fill={type:"pattern",pattern:"solid",fgColor:{argb:wt.colors.primary}},o.font={...o.font,color:{argb:"FFFFFFFF"}},t.getRow(n).height=30,n++,r){t.addRow([]),n++,t.addRow([r]),t.mergeCells(`A${n}:H${n}`);const l=t.getCell(`A${n}`);l.font=wt.fonts.subHeader,l.alignment={horizontal:"center",vertical:"middle"},t.getRow(n).height=20,n++}return a&&a.length>0&&(t.addRow([]),n++,a.forEach(l=>{t.addRow([l]),t.mergeCells(`A${n}:H${n}`);const u=t.getCell(`A${n}`);u.font=wt.fonts.data,u.alignment={horizontal:"center",vertical:"middle"},n++})),t.addRow([]),n++,n}function Cf(){const[t,s]=h.useState(""),[r,a]=h.useState("all"),[n,i]=h.useState("all"),[o,l]=h.useState("all"),[u,d]=h.useState(!1),[c,f]=h.useState(null),[m,y]=h.useState(!1),[x,p]=h.useState(!1),[A,g]=h.useState(!1),[N,w]=h.useState(null),[_,b]=h.useState(!1),[k,R]=h.useState(!1),[I,E]=h.useState("all"),[O,T]=h.useState("all"),[S,M]=h.useState("all"),[v,W]=h.useState(!1),j=Mt(),{setFloatingAction:V}=Ls(),{toast:ne}=Ct();h.useEffect(()=>(V(()=>d(!0),"إضافة معدة جديدة"),()=>V(null)),[V]);const{data:F=[],isLoading:ye,refetch:fe,isFetching:de}=ge({queryKey:["equipment",t,r,n,o],queryFn:async()=>{const X=new URLSearchParams;t&&X.append("searchTerm",t),r!=="all"&&X.append("status",r),n!=="all"&&X.append("type",n),o!=="all"&&o!=="warehouse"?X.append("projectId",o):o==="warehouse"&&X.append("projectId","");const Je=await fetch(`/api/equipment?${X}`);if(!Je.ok)throw new Error("فشل في جلب المعدات");return Je.json()},staleTime:1800*1e3,gcTime:7200*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:0,enabled:!0}),{data:ke=[]}=ge({queryKey:["projects"],queryFn:async()=>await ae("/api/projects","GET"),staleTime:900*1e3,gcTime:3600*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:1,retryDelay:1e3}),nt=X=>{f(X),b(!0)},ct=(X,Je)=>{Je?.stopPropagation(),f(X),p(!0)},it=(X,Je)=>{f(X),y(!0)},Z=(X,Je)=>{f(X),g(!0)},U=Ce({mutationFn:async X=>await ae(`/api/equipment/${X}`,"DELETE"),onSuccess:()=>{j.invalidateQueries({predicate:X=>Array.isArray(X.queryKey)&&X.queryKey[0]==="equipment"}),ne({title:"تم حذف المعدة بنجاح",description:"تم حذف المعدة من النظام نهائياً"}),b(!1)},onError:X=>{ne({title:"خطأ في حذف المعدة",description:X.message||"حدث خطأ أثناء حذف المعدة",variant:"destructive"})}}),Y=(X,Je)=>{confirm(`هل أنت متأكد من حذف المعدة "${X.name}" نهائياً؟

لا يمكن التراجع عن هذا الإجراء.`)&&U.mutate(X.id)},Ae=X=>{const Je={active:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",maintenance:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",out_of_service:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",inactive:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"};return Je[X]||Je.active},pt=X=>({أدوات:"bg-gradient-to-br from-red-500 to-red-600",أمتار:"bg-gradient-to-br from-blue-500 to-blue-600",مطارق:"bg-gradient-to-br from-gray-700 to-gray-800","مكينة لحام":"bg-gradient-to-br from-orange-500 to-orange-600","جلخ كهربائي":"bg-gradient-to-br from-yellow-500 to-yellow-600",دريل:"bg-gradient-to-br from-green-500 to-green-600",تخزيق:"bg-gradient-to-br from-purple-500 to-purple-600",بانات:"bg-gradient-to-br from-indigo-500 to-indigo-600",مفاتيح:"bg-gradient-to-br from-pink-500 to-pink-600",أسلاك:"bg-gradient-to-br from-cyan-500 to-cyan-600",دساميس:"bg-gradient-to-br from-teal-500 to-teal-600",إنشائية:"bg-gradient-to-br from-blue-500 to-blue-600",نقل:"bg-gradient-to-br from-green-500 to-green-600",أداة:"bg-gradient-to-br from-purple-500 to-purple-600",construction:"bg-gradient-to-br from-blue-500 to-blue-600",transport:"bg-gradient-to-br from-green-500 to-green-600",tool:"bg-gradient-to-br from-purple-500 to-purple-600"})[X]||"bg-gradient-to-br from-gray-500 to-gray-600",jt=X=>({active:"نشط",maintenance:"صيانة",out_of_service:"خارج الخدمة",inactive:"غير نشط"})[X]||X,Ve=X=>({أدوات:"🔧",أمتار:"📏",مطارق:"🔨","مكينة لحام":"⚡","جلخ كهربائي":"⚙️",دريل:"🔩",تخزيق:"✂️",بانات:"🔗",مفاتيح:"🔑",أسلاك:"🔌",دساميس:"📎",construction:e.jsx(nr,{className:"h-5 w-5"}),transport:e.jsx(qa,{className:"h-5 w-5"}),tool:e.jsx(pm,{className:"h-5 w-5"}),إنشائية:e.jsx(nr,{className:"h-5 w-5"}),نقل:e.jsx(qa,{className:"h-5 w-5"}),أداة:e.jsx(pm,{className:"h-5 w-5"})})[X]||e.jsx(nr,{className:"h-5 w-5"}),kt=()=>Array.isArray(F)?F.filter(X=>{const Je=I==="all"||I==="warehouse"&&!X.currentProjectId||X.currentProjectId===I,xe=O==="all"||X.status===O,P=S==="all"||X.type===S;return Je&&xe&&P}):[],ps=async()=>{const X=kt();if(X.length===0){ne({title:"لا توجد معدات للتصدير",description:"يرجى التأكد من الفلاتر المحددة",variant:"destructive"});return}try{W(!0);const Je=await xd(()=>import("./exceljs.min-CT50dpqw.js").then(L=>L.e),__vite__mapDeps([0,1,2])),xe=new Je.Workbook;xe.creator=td.name,xe.lastModifiedBy="نظام إدارة المعدات",xe.created=new Date,xe.modified=new Date;const P=xe.addWorksheet("كشف المعدات");P.views=[{rightToLeft:!0}];const z=I==="all"?"جميع المشاريع":I==="warehouse"?"المستودع":(Array.isArray(ke)?ke.find(L=>L.id===I)?.name:void 0)||"مشروع محدد";let G=O6(P,"كشف المعدات التفصيلي",`المشروع: ${z}`,[`تاريخ الإصدار: ${Sr(new Date().toISOString().split("T")[0])}`,`إجمالي المعدات: ${X.length}`,`المعدات النشطة: ${X.filter(L=>L.status==="active").length}`,`في الصيانة: ${X.filter(L=>L.status==="maintenance").length}`]);const oe=["الكود","اسم المعدة","الفئة","الحالة","الموقع","سعر الشراء","تاريخ الشراء","الوصف"],ce=P.addRow(oe);oe.forEach((L,De)=>{const Ee=ce.getCell(De+1);Ee.font=wt.fonts.header,Ee.fill={type:"pattern",pattern:"solid",fgColor:{argb:wt.colors.headerBg}},Ee.border={top:wt.borders.medium,bottom:wt.borders.medium,left:wt.borders.thin,right:wt.borders.thin},Ee.alignment={horizontal:"center",vertical:"middle"}}),P.getColumn(1).width=15,P.getColumn(2).width=25,P.getColumn(3).width=15,P.getColumn(4).width=15,P.getColumn(5).width=25,P.getColumn(6).width=18,P.getColumn(7).width=15,P.getColumn(8).width=30,G++,X.forEach((L,De)=>{const Ee=L.currentProjectId?(Array.isArray(ke)?ke.find(Ie=>Ie.id===L.currentProjectId)?.name:void 0)||"مشروع غير معروف":"المستودع";P.addRow([L.code,L.name,L.type||"غير محدد",jt(L.status),Ee,L.purchasePrice?Me(Number(L.purchasePrice)):"غير محدد",L.purchaseDate?Sr(L.purchaseDate):"غير محدد",L.description||"غير محدد"]).eachCell((Ie,Ds)=>{Ie.font=wt.fonts.data,Ie.border={top:wt.borders.thin,bottom:wt.borders.thin,left:wt.borders.thin,right:wt.borders.thin},Ie.alignment={horizontal:"center",vertical:"middle"},Ds===6&&L.purchasePrice&&(Ie.numFmt='#,##0 "ريال"',Ie.alignment={horizontal:"left",vertical:"middle"}),Ds===8&&(Ie.alignment={horizontal:"right",vertical:"middle"}),De%2===0&&(Ie.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}})}),G++}),G+=2,P.addRow([]),G++;const te=P.addRow(["ملخص المعدات"]);P.mergeCells(`A${G}:H${G}`);const ve=te.getCell(1);ve.font={...wt.fonts.title,size:14},ve.alignment={horizontal:"center",vertical:"middle"},ve.fill={type:"pattern",pattern:"solid",fgColor:{argb:wt.colors.totalsBg}},ve.border={top:wt.borders.medium,bottom:wt.borders.medium,left:wt.borders.medium,right:wt.borders.medium},G++,[["إجمالي المعدات",X.length],["المعدات النشطة",X.filter(L=>L.status==="active").length],["في الصيانة",X.filter(L=>L.status==="maintenance").length],["خارج الخدمة",X.filter(L=>L.status==="out_of_service").length],["غير نشطة",X.filter(L=>L.status==="inactive").length]].forEach(([L,De])=>{const Ee=P.addRow([L,"","","","","","",De]),Vt=Ee.getCell(1),Ie=Ee.getCell(8);Vt.font=wt.fonts.totals,Ie.font=wt.fonts.totals,[Vt,Ie].forEach(Ds=>{Ds.border={top:wt.borders.thin,bottom:wt.borders.thin,left:wt.borders.thin,right:wt.borders.thin}}),Vt.alignment={horizontal:"right",vertical:"middle"},Ie.alignment={horizontal:"center",vertical:"middle"},G++}),G+=2,P.addRow([]),G++;const dt=P.addRow([`تم إنشاء هذا التقرير بواسطة ${td.name} - ${Sr(new Date().toISOString().split("T")[0])}`]);P.mergeCells(`A${G}:H${G}`);const Zt=dt.getCell(1);Zt.font=wt.fonts.footer,Zt.alignment={horizontal:"center",vertical:"middle"};const xs=`كشف_المعدات_${I==="all"?"جميع_المشاريع":I==="warehouse"?"المستودع":(Array.isArray(ke)?ke.find(L=>L.id===I)?.name:void 0)?.replace(/\s/g,"_")||"مشروع_محدد"}_${new Date().toISOString().split("T")[0]}.xlsx`,mr=await xe.xlsx.writeBuffer(),Lr=new Blob([mr],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});F6.saveAs(Lr,xs),ne({title:"تم تصدير كشف المعدات بنجاح",description:`تم حفظ الملف: ${xs}`})}catch(Je){console.error("خطأ في تصدير Excel:",Je),ne({title:"خطأ في التصدير",description:"حدث خطأ أثناء تصدير كشف المعدات",variant:"destructive"})}finally{W(!1)}},ks=async()=>{const X=kt();if(X.length===0){ne({title:"لا توجد معدات للتصدير",description:"يرجى التأكد من الفلاتر المحددة",variant:"destructive"});return}try{W(!0);const Je=I==="all"?"جميع المشاريع":I==="warehouse"?"المستودع":(Array.isArray(ke)?ke.find(P=>P.id===I)?.name:void 0)||"مشروع محدد",xe=`
        <html dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>كشف المعدات - ${Je}</title>
            <style>
              @page {
                margin: 2cm 1.5cm;
                size: A4;
              }
              body { 
                font-family: 'Arial', sans-serif; 
                margin: 0; 
                padding: 0; 
                direction: rtl; 
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                color: #1e293b;
                line-height: 1.6;
              }
              
              /* رأس احترافي */
              .company-header {
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
                color: white;
                padding: 25px;
                text-align: center;
                border-radius: 12px;
                margin-bottom: 30px;
                box-shadow: 0 8px 25px rgba(30, 64, 175, 0.3);
              }
              .company-name {
                font-size: 24px;
                font-weight: bold;
                margin: 0 0 10px 0;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
              }
              .company-subtitle {
                font-size: 14px;
                opacity: 0.9;
                margin: 0;
              }
              
              /* عنوان التقرير */
              .report-header {
                background: white;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                margin-bottom: 25px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                border-left: 6px solid #3b82f6;
              }
              .report-title {
                font-size: 22px;
                color: #1e293b;
                margin: 0 0 15px 0;
                font-weight: bold;
              }
              
              /* معلومات التقرير */
              .report-info {
                display: flex;
                justify-content: space-around;
                background: #f8fafc;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 25px;
                border: 1px solid #e2e8f0;
              }
              .info-item {
                text-align: center;
                color: #475569;
                font-weight: 600;
              }
              .info-label {
                display: block;
                font-size: 12px;
                color: #64748b;
                margin-bottom: 5px;
              }
              .info-value {
                display: block;
                font-size: 16px;
                color: #1e293b;
                font-weight: bold;
              }
              
              /* الجدول */
              table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 25px;
                background: white;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
              }
              th {
                background: linear-gradient(135deg, #334155 0%, #475569 100%);
                color: white;
                padding: 15px 10px;
                text-align: center;
                font-weight: bold;
                font-size: 13px;
                text-shadow: 0 1px 2px rgba(0,0,0,0.2);
              }
              td {
                padding: 12px 8px;
                text-align: center;
                border-bottom: 1px solid #e2e8f0;
                font-size: 12px;
                vertical-align: middle;
              }
              tr:nth-child(even) td {
                background-color: #f8fafc;
              }
              tr:hover td {
                background-color: #e0f2fe;
              }
              
              /* الملخص */
              .summary {
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                padding: 20px;
                border-radius: 12px;
                margin-top: 25px;
                border-left: 6px solid #10b981;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
              }
              .summary h3 {
                margin-top: 0;
                color: #1e293b;
                font-size: 18px;
                margin-bottom: 15px;
                text-align: center;
              }
              .summary-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin-top: 15px;
              }
              .summary-item {
                background: white;
                padding: 12px;
                border-radius: 8px;
                text-align: center;
                border: 1px solid #e2e8f0;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
              }
              .summary-value {
                display: block;
                font-size: 20px;
                font-weight: bold;
                color: #1e293b;
              }
              .summary-label {
                display: block;
                font-size: 12px;
                color: #64748b;
                margin-top: 5px;
              }
              
              /* الذيل */
              .footer {
                background: linear-gradient(135deg, #64748b 0%, #475569 100%);
                color: white;
                text-align: center;
                padding: 20px;
                border-radius: 10px;
                margin-top: 30px;
                font-size: 12px;
              }
              .footer-info {
                margin: 5px 0;
              }
            </style>
          </head>
          <body>
            <!-- رأس الشركة -->
            <div class="company-header">
              <div class="company-name">شركة الفتيني للمقاولات والاستشارات الهندسية</div>
              <div class="company-subtitle">Al-Fathi Construction & Engineering Consultancy Company</div>
            </div>
            
            <!-- عنوان التقرير -->
            <div class="report-header">
              <div class="report-title">كشف المعدات التفصيلي</div>
            </div>
            
            <!-- معلومات التقرير -->
            <div class="report-info">
              <div class="info-item">
                <span class="info-label">المشروع</span>
                <span class="info-value">${Je}</span>
              </div>
              <div class="info-item">
                <span class="info-label">تاريخ التقرير</span>
                <span class="info-value">${Sr(new Date().toISOString().split("T")[0])}</span>
              </div>
              <div class="info-item">
                <span class="info-label">إجمالي المعدات</span>
                <span class="info-value">${X.length}</span>
              </div>
              <div class="info-item">
                <span class="info-label">المعدات النشطة</span>
                <span class="info-value">${X.filter(P=>P.status==="active").length}</span>
              </div>
            </div>
            
            <table>
              <thead>
                <tr>
                  <th>الكود</th>
                  <th>اسم المعدة</th>
                  <th>الفئة</th>
                  <th>الحالة</th>
                  <th>الموقع</th>
                  <th>سعر الشراء</th>
                  <th>تاريخ الشراء</th>
                </tr>
              </thead>
              <tbody>
                ${X.map(P=>{const z=P.currentProjectId?(Array.isArray(ke)?ke.find(G=>G.id===P.currentProjectId)?.name:void 0)||"مشروع غير معروف":"المستودع";return`
                    <tr>
                      <td>${P.code}</td>
                      <td>${P.name}</td>
                      <td>${P.type==="construction"?"إنشائية":P.type==="transport"?"نقل":P.type==="tool"?"أداة":P.type}</td>
                      <td>${jt(P.status)}</td>
                      <td>${z}</td>
                      <td>${P.purchasePrice?Me(Number(P.purchasePrice)):"غير محدد"}</td>
                      <td>${P.purchaseDate?Sr(P.purchaseDate):"غير محدد"}</td>
                    </tr>
                  `}).join("")}
              </tbody>
            </table>
            
            <!-- الملخص الاحترافي -->
            <div class="summary">
              <h3>ملخص المعدات</h3>
              <div class="summary-grid">
                <div class="summary-item">
                  <span class="summary-value">${X.length}</span>
                  <span class="summary-label">إجمالي المعدات</span>
                </div>
                <div class="summary-item">
                  <span class="summary-value">${X.filter(P=>P.status==="active").length}</span>
                  <span class="summary-label">المعدات النشطة</span>
                </div>
                <div class="summary-item">
                  <span class="summary-value">${X.filter(P=>P.status==="maintenance").length}</span>
                  <span class="summary-label">في الصيانة</span>
                </div>
                <div class="summary-item">
                  <span class="summary-value">${X.filter(P=>P.status==="out_of_service").length}</span>
                  <span class="summary-label">خارج الخدمة</span>
                </div>
              </div>
            </div>
            
            <!-- ذيل احترافي -->
            <div class="footer">
              <div class="footer-info">تم إنشاء هذا التقرير بواسطة نظام إدارة المشاريع الإنشائية</div>
              <div class="footer-info">شركة الفتيني للمقاولات والاستشارات الهندسية</div>
              <div class="footer-info">تاريخ الطباعة: ${Sr(new Date().toISOString().split("T")[0])} - ${new Date().toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}</div>
            </div>
          </body>
        </html>
      `;try{const P=new Blob([xe],{type:"text/html"}),z=URL.createObjectURL(P),G=window.open(z,"_blank","width=1200,height=800,scrollbars=yes,resizable=yes");if(G)setTimeout(()=>{try{G.print(),setTimeout(()=>{URL.revokeObjectURL(z),G.close()},2e3)}catch(oe){console.warn("خطأ في الطباعة المباشرة، جاري فتح النافذة للمعاينة:",oe),ne({title:"تم فتح المعاينة",description:"استخدم Ctrl+P أو ⌘+P للطباعة، أو اختر 'طباعة' من القائمة",duration:5e3})}},1500),ne({title:"جاري إعداد الطباعة",description:"انتظر قليلاً ليتم تحميل المحتوى وفتح نافذة الطباعة"});else{const oe=document.createElement("a");oe.href=z,oe.download=`كشف_المعدات_${Je}_${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(z),ne({title:"تم تنزيل الملف",description:"افتح الملف الذي تم تنزيله واطبعه باستخدام متصفحك"})}}catch(P){console.error("خطأ في فتح نافذة الطباعة:",P);const z="data:text/html;charset=utf-8,"+encodeURIComponent(xe),G=document.createElement("a");G.href=z,G.download=`كشف_المعدات_${Je}_${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(G),G.click(),document.body.removeChild(G),ne({title:"تم إنشاء ملف HTML",description:"افتح الملف المحفوظ واطبعه أو احفظه كـ PDF"})}}catch(Je){console.error("خطأ في تصدير PDF:",Je),ne({title:"خطأ في التصدير",description:"حدث خطأ أثناء تصدير كشف المعدات",variant:"destructive"})}finally{W(!1)}};return ye?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"جاري تحميل المعدات..."})]})})}):(console.log("🔧 بيانات المعدات في Frontend:",{equipment:F,count:F?.length,isLoading:ye}),e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",dir:"rtl",children:[e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Rr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(be,{placeholder:"البحث بالاسم أو الكود...",value:t,onChange:X=>s(X.target.value),className:"pr-10 h-10 text-sm border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500","data-testid":"input-search-equipment"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:grid-cols-3",children:[e.jsxs(qe,{value:r,onValueChange:a,children:[e.jsx(Oe,{"data-testid":"select-status-filter",className:"h-9 text-xs border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1 truncate",children:[e.jsx(Ot,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ue,{placeholder:"الحالة"})]})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الحالات"}),e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"maintenance",children:"صيانة"}),e.jsx(K,{value:"out_of_service",children:"خارج الخدمة"}),e.jsx(K,{value:"inactive",children:"غير نشط"})]})]}),e.jsxs(qe,{value:n,onValueChange:i,children:[e.jsx(Oe,{"data-testid":"select-type-filter",className:"h-9 text-xs border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1 truncate",children:[e.jsx(nr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ue,{placeholder:"الفئة"})]})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الفئات"}),e.jsx(K,{value:"أدوات كهربائية",children:"أدوات كهربائية"}),e.jsx(K,{value:"أدوات يدوية",children:"أدوات يدوية"}),e.jsx(K,{value:"أدوات قياس",children:"أدوات قياس"}),e.jsx(K,{value:"معدات لحام",children:"معدات لحام"}),e.jsx(K,{value:"معدات حفر",children:"معدات حفر"}),e.jsx(K,{value:"معدات قطع",children:"معدات قطع"}),e.jsx(K,{value:"أدوات ربط",children:"أدوات ربط"}),e.jsx(K,{value:"مواد كهربائية",children:"مواد كهربائية"}),e.jsx(K,{value:"معدات أمان",children:"معدات أمان"}),e.jsx(K,{value:"أدوات نقل",children:"أدوات نقل"})]})]}),e.jsxs(qe,{value:o,onValueChange:l,children:[e.jsx(Oe,{"data-testid":"select-project-filter",className:"h-9 text-xs border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1 truncate",children:[e.jsx(Cr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ue,{placeholder:"المشروع"})]})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع المواقع"}),e.jsx(K,{value:"warehouse",children:"المستودع"}),Array.isArray(ke)?ke.map(X=>e.jsx(K,{value:X.id,children:X.name},X.id)):null]})]})]})]}),e.jsxs(Sd,{className:"mb-6",children:[e.jsx(et,{title:"إجمالي المعدات",value:F.length,icon:nr,className:"border-r-4 border-r-blue-500","data-testid":"stats-total-equipment"}),e.jsx(et,{title:"نشطة",value:Array.isArray(F)?F.filter(X=>X.status==="active").length:0,icon:Ot,className:"border-r-4 border-r-green-500 bg-gradient-to-r from-green-50 to-white dark:from-green-950 dark:to-gray-900","data-testid":"stats-active-equipment"}),e.jsx(et,{title:"في الصيانة",value:Array.isArray(F)?F.filter(X=>X.status==="maintenance").length:0,icon:rs,className:"border-r-4 border-r-yellow-500 bg-gradient-to-r from-yellow-50 to-white dark:from-yellow-950 dark:to-gray-900","data-testid":"stats-maintenance-equipment"}),e.jsx(et,{title:"خارج الخدمة",value:Array.isArray(F)?F.filter(X=>X.status==="out_of_service").length:0,icon:qa,className:"border-r-4 border-r-red-500 bg-gradient-to-r from-red-50 to-white dark:from-red-950 dark:to-gray-900","data-testid":"stats-out-of-service-equipment"})]}),e.jsxs(q,{className:"mb-6",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5 text-blue-600"}),"كشوفات المعدات"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>R(!k),className:"flex items-center gap-2","data-testid":"button-toggle-reports",children:[k?"إخفاء":"عرض"," الكشوفات",e.jsx(_r,{className:"h-4 w-4"})]})]})}),k&&e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فلترة حسب المشروع"}),e.jsxs(qe,{value:I,onValueChange:E,children:[e.jsx(Oe,{"data-testid":"select-report-project-filter",className:"h-9 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(Cr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ue,{placeholder:"اختر المشروع"})]})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع المشاريع"}),e.jsx(K,{value:"warehouse",children:"المستودع"}),Array.isArray(ke)?ke.map(X=>e.jsx(K,{value:X.id,children:X.name},X.id)):null]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فلترة حسب الحالة"}),e.jsxs(qe,{value:O,onValueChange:T,children:[e.jsx(Oe,{"data-testid":"select-report-status-filter",className:"h-9 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(Ot,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ue,{placeholder:"اختر الحالة"})]})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الحالات"}),e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"maintenance",children:"صيانة"}),e.jsx(K,{value:"out_of_service",children:"خارج الخدمة"}),e.jsx(K,{value:"inactive",children:"غير نشط"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فلترة حسب الفئة"}),e.jsxs(qe,{value:S,onValueChange:M,children:[e.jsx(Oe,{"data-testid":"select-report-type-filter",className:"h-9 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(nr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ue,{placeholder:"اختر الفئة"})]})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الفئات"}),e.jsx(K,{value:"أدوات كهربائية",children:"أدوات كهربائية"}),e.jsx(K,{value:"أدوات يدوية",children:"أدوات يدوية"}),e.jsx(K,{value:"أدوات قياس",children:"أدوات قياس"}),e.jsx(K,{value:"معدات لحام",children:"معدات لحام"}),e.jsx(K,{value:"معدات حفر",children:"معدات حفر"}),e.jsx(K,{value:"معدات قطع",children:"معدات قطع"}),e.jsx(K,{value:"أدوات ربط",children:"أدوات ربط"}),e.jsx(K,{value:"مواد كهربائية",children:"مواد كهربائية"}),e.jsx(K,{value:"معدات أمان",children:"معدات أمان"}),e.jsx(K,{value:"أدوات نقل",children:"أدوات نقل"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"معاينة الكشف"}),e.jsxs(le,{variant:"outline",className:"text-blue-700 border-blue-300",children:[kt().length," معدة"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:kt().length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"إجمالي المعدات"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:kt().filter(X=>X.status==="active").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"نشطة"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:kt().filter(X=>X.status==="maintenance").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"صيانة"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:kt().filter(X=>X.status==="out_of_service").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"خارج الخدمة"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs($,{onClick:ps,disabled:v||kt().length===0,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white","data-testid":"button-export-excel",children:[v?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Sn,{className:"h-4 w-4"}),"تصدير Excel"]}),e.jsxs($,{onClick:ks,disabled:v||kt().length===0,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white","data-testid":"button-export-pdf",children:[v?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(lr,{className:"h-4 w-4"}),"تصدير PDF"]}),e.jsxs($,{onClick:()=>{if(kt().length===0){ne({title:"لا توجد معدات للطباعة",description:"يرجى التأكد من الفلاتر المحددة",variant:"destructive"});return}ks()},variant:"outline",disabled:v,className:"flex items-center gap-2","data-testid":"button-print-report",children:[e.jsx(vd,{className:"h-4 w-4"}),"طباعة"]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:F.length===0?e.jsxs(q,{className:"p-8 text-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(nr,{className:"h-16 w-16 mx-auto opacity-50"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"لا توجد معدات"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"لم يتم العثور على أي معدات تطابق الفلاتر المحددة"}),e.jsxs($,{onClick:()=>d(!0),className:"bg-red-500 hover:bg-red-600 text-white rounded-full px-6",children:[e.jsx(bs,{className:"h-4 w-4 mr-2"}),"إضافة معدة جديدة"]})]}):Array.isArray(F)?F.map(X=>e.jsx(q,{className:"bg-white dark:bg-gray-800 hover:shadow-md transition-all duration-200 cursor-pointer border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",onClick:()=>nt(X),"data-testid":`card-equipment-${X.id}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"relative w-16 h-16 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-700 shrink-0",children:X.imageUrl&&X.imageUrl.trim()!==""?e.jsx("img",{src:X.imageUrl,alt:X.name,className:"w-full h-full object-cover",onLoad:()=>console.log("تم تحميل صورة المعدة بنجاح:",X.name),onError:Je=>{console.error("فشل في تحميل صورة المعدة:",X.imageUrl);const P=Je.target.parentElement;P.innerHTML=`<div class="${pt(X.type).replace("bg-gradient-to-br","bg-gradient-to-br")} w-full h-full flex items-center justify-center text-white"><span class="text-xl">${Ve(X.type)}</span></div>`}}):e.jsx("div",{className:`w-full h-full flex items-center justify-center text-white ${pt(X.type)}`,children:Ve(X.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-1","data-testid":`text-equipment-name-${X.id}`,children:X.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:`text-xs ${Ae(X.status)}`,"data-testid":`badge-status-${X.id}`,children:jt(X.status)}),e.jsx(le,{variant:"outline",className:"text-xs",children:X.code})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Cr,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate","data-testid":`text-location-${X.id}`,children:X.currentProjectId?(Array.isArray(ke)?ke.find(Je=>Je.id===X.currentProjectId)?.name:void 0)||"مشروع غير معروف":"المستودع"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[X.purchasePrice&&e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"السعر"}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:Me(Number(X.purchasePrice))})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx($,{onClick:Je=>{Je.stopPropagation(),ct(X,Je)},className:"bg-red-500 hover:bg-red-600 text-white rounded-full px-4 py-2 text-sm font-medium","data-testid":`button-transfer-${X.id}`,children:"نقل المعدة"})})]})]})})},X.id)):null}),e.jsx(Tf,{open:u,onOpenChange:d,projects:ke}),e.jsx(Tf,{open:m,onOpenChange:y,projects:ke,equipment:c}),e.jsx(D6,{equipment:c,open:x,onOpenChange:p,projects:ke}),e.jsx(M6,{equipment:c,open:A,onOpenChange:g,projects:ke}),e.jsx(qs,{open:_,onOpenChange:b,children:e.jsx(Fs,{className:"max-w-md mx-auto bg-white dark:bg-gray-800 rounded-3xl p-0 overflow-hidden border-0 shadow-2xl",children:c&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>b(!1),className:"absolute top-4 right-4 z-10 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors",children:e.jsx(yr,{className:"h-4 w-4"})}),e.jsx("div",{className:"relative h-64 bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:c.imageUrl&&c.imageUrl.trim()!==""?e.jsx("img",{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover",onLoad:()=>console.log("تم تحميل صورة المعدة في النافذة بنجاح:",c.name),onError:X=>{console.error("فشل في تحميل صورة المعدة في النافذة:",c.imageUrl);const Je=X.target;Je.style.display="none";const xe=Je.parentElement;xe.innerHTML=`<div class="${pt(c.type).replace("bg-gradient-to-br","bg-gradient-to-br")} w-24 h-24 rounded-full flex items-center justify-center text-white text-2xl"><span>${Ve(c.type)}</span></div>`}}):e.jsx("div",{className:`w-24 h-24 rounded-full flex items-center justify-center text-white text-2xl ${pt(c.type)}`,children:Ve(c.type)})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:c.name}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(le,{className:`text-xs ${Ae(c.status)}`,children:jt(c.status)}),e.jsx(le,{variant:"outline",className:"text-xs",children:c.code})]})]}),c.purchasePrice&&e.jsxs("div",{className:"text-center bg-orange-100 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-orange-600 dark:text-orange-400 mb-1",children:"السعر"}),e.jsx("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:Me(Number(c.purchasePrice))})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cr,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"الموقع الحالي"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:c.currentProjectId?ke.find(X=>X.id===c.currentProjectId)?.name||"مشروع غير معروف":"المستودع"})]})]})}),c.description&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"الوصف"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:c.description})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsx($,{onClick:()=>{b(!1),it(c)},className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full py-3 font-medium text-sm",children:"تعديل"}),e.jsxs($,{onClick:()=>{b(!1),Z(c)},className:"bg-purple-500 hover:bg-purple-600 text-white rounded-full py-3 font-medium text-sm flex items-center gap-1 justify-center",children:[e.jsx(xo,{className:"w-4 h-4"}),"السجل"]}),e.jsx($,{onClick:()=>{b(!1),Y(c)},disabled:U.isPending,className:"bg-red-600 hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed text-white rounded-full py-3 font-medium text-sm",children:U.isPending?"جاري الحذف...":"حذف"}),e.jsx($,{onClick:()=>{b(!1),ct(c)},className:"bg-red-500 hover:bg-red-600 text-white rounded-full py-3 font-medium text-sm",children:"نقل"})]})]})]})})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:()=>w(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>w(null),className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors","data-testid":"button-close-image",children:e.jsx(yr,{size:24})}),e.jsx("img",{src:N,alt:"صورة المعدة بالحجم الكامل",className:"max-w-full max-h-full object-contain rounded-lg",onClick:X=>X.stopPropagation()})]})})]}))}function $6(){const[t,s]=h.useState(""),[r,a]=h.useState({from:"",to:""});_a();const n=[{id:"financial",name:"التقارير المالية",icon:Kt},{id:"workers",name:"تقارير العمال",icon:_t},{id:"projects",name:"تقارير المشاريع",icon:Cs},{id:"comprehensive",name:"التقارير الشاملة",icon:Sn}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"التقارير المتقدمة"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",children:[e.jsx(vd,{className:"w-4 h-4 mr-2"}),"طباعة"]}),e.jsxs($,{variant:"outline",size:"sm",children:[e.jsx(Sn,{className:"w-4 h-4 mr-2"}),"تصدير Excel"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{className:"text-sm",children:"اختيار المشروع"})}),e.jsx(H,{children:e.jsx(Ea,{onProjectChange:i=>{console.log("تم تغيير المشروع في التقارير المتقدمة:",i)}})})]}),e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{className:"text-sm",children:"نوع التقرير"})}),e.jsx(H,{children:e.jsxs(qe,{value:t,onValueChange:s,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر نوع التقرير"})}),e.jsx($e,{children:n.map(i=>e.jsx(K,{value:i.id,children:i.name},i.id))})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{className:"text-sm",children:"الفترة الزمنية"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",className:"w-full p-2 border rounded",placeholder:"من تاريخ",value:r.from,onChange:i=>a({...r,from:i.target.value})}),e.jsx("input",{type:"date",className:"w-full p-2 border rounded",placeholder:"إلى تاريخ",value:r.to,onChange:i=>a({...r,to:i.target.value})})]})})]})]}),e.jsxs(Ks,{defaultValue:"preview",className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3",children:[e.jsx(He,{value:"preview",children:"معاينة التقرير"}),e.jsx(He,{value:"settings",children:"إعدادات التقرير"}),e.jsx(He,{value:"history",children:"سجل التقارير"})]}),e.jsx(Ge,{value:"preview",className:"space-y-4",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"معاينة التقرير"})}),e.jsx(H,{children:e.jsxs("div",{className:"text-center text-gray-500 py-12",children:[e.jsx(or,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"اختر نوع التقرير والمشروع لعرض المعاينة"})]})})]})}),e.jsx(Ge,{value:"settings",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"إعدادات التقرير"})}),e.jsx(H,{children:e.jsx("p",{className:"text-gray-600",children:"إعدادات مخصصة للتقارير - قيد التطوير"})})]})}),e.jsx(Ge,{value:"history",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"سجل التقارير المُنشأة"})}),e.jsx(H,{children:e.jsx("p",{className:"text-gray-600",children:"سجل التقارير السابقة - قيد التطوير"})})]})})]})]})}function L6(){const[t,s]=h.useState({workerIds:[],workerTypes:[],dateFrom:"",dateTo:Gs(),includeInactive:!1,reportType:"summary"}),[r,a]=h.useState([]),[n,i]=h.useState(!1),{selectedProjectId:o}=_a(),{data:l=[]}=ge({queryKey:["/api/workers",o,t.includeInactive],queryFn:()=>{if(!o)return[];const p=new URLSearchParams({projectId:o,includeInactive:t.includeInactive.toString()});return ae(`/api/workers?${p}`,"GET")},enabled:!!o}),{data:u=[]}=ge({queryKey:["/api/worker-types"],queryFn:()=>ae("/api/worker-types","GET")}),{data:d=[],isLoading:c}=ge({queryKey:["/api/workers-unified-report",o,t],queryFn:async()=>{if(!o)return[];const p=new URLSearchParams({projectId:o,dateFrom:t.dateFrom,dateTo:t.dateTo,includeInactive:t.includeInactive.toString(),reportType:t.reportType});return t.workerIds.length>0&&p.append("workerIds",t.workerIds.join(",")),t.workerTypes.length>0&&p.append("workerTypes",t.workerTypes.join(",")),ae(`/api/workers-unified-report?${p}`,"GET")},enabled:!!o}),f=(p,A)=>{a(A?g=>[...g,p]:g=>g.filter(N=>N!==p)),s(g=>({...g,workerIds:A?[...g.workerIds,p]:g.workerIds.filter(N=>N!==p)}))},m=p=>{if(p){const A=l.map(g=>g.id);a(A),s(g=>({...g,workerIds:A}))}else a([]),s(A=>({...A,workerIds:[]}))},y=async p=>{if(!o||r.length===0){alert("يرجى اختيار عمال لتصدير التقرير");return}i(!0);try{const A=await ae("/api/export-workers-unified-report","POST",{projectId:o,filters:t,format:p});A.downloadUrl&&window.open(A.downloadUrl,"_blank")}catch(A){console.error("خطأ في تصدير التقرير:",A),alert("حدث خطأ في تصدير التقرير")}finally{i(!1)}},x=d.reduce((p,A)=>({totalWorkers:p.totalWorkers+1,totalWorkDays:p.totalWorkDays+A.stats.totalWorkDays,totalEarned:p.totalEarned+A.stats.totalEarned,totalPaid:p.totalPaid+A.stats.totalPaid,totalRemaining:p.totalRemaining+A.stats.remainingBalance}),{totalWorkers:0,totalWorkDays:0,totalEarned:0,totalPaid:0,totalRemaining:0});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"التقارير الموحدة للعمال"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"تقارير شاملة ومفصلة لجميع العمال"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>y("pdf"),disabled:n||r.length===0,children:[e.jsx(vd,{className:"w-4 h-4 mr-2"}),"طباعة PDF"]}),e.jsxs($,{size:"sm",onClick:()=>y("excel"),disabled:n||r.length===0,children:[e.jsx(Sn,{className:"w-4 h-4 mr-2"}),"تصدير Excel"]})]})]}),e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(dl,{className:"w-5 h-5"}),"فلاتر وإعدادات التقرير"]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"المشروع"}),e.jsx(Ea,{onProjectChange:()=>{}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نوع التقرير"}),e.jsxs(qe,{value:t.reportType,onValueChange:p=>s(A=>({...A,reportType:p})),children:[e.jsx(Oe,{children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"summary",children:"ملخص"}),e.jsx(K,{value:"detailed",children:"تفصيلي"}),e.jsx(K,{value:"attendance",children:"الحضور"}),e.jsx(K,{value:"financial",children:"مالي"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"من تاريخ"}),e.jsx(be,{type:"date",value:t.dateFrom,onChange:p=>s(A=>({...A,dateFrom:p.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"إلى تاريخ"}),e.jsx(be,{type:"date",value:t.dateTo,onChange:p=>s(A=>({...A,dateTo:p.target.value}))})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fi,{id:"includeInactive",checked:t.includeInactive,onCheckedChange:p=>s(A=>({...A,includeInactive:!!p}))}),e.jsx("label",{htmlFor:"includeInactive",className:"text-sm",children:"العمال غير النشطين"})]})})]})})]}),e.jsxs(Ks,{defaultValue:"selection",className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-4",children:[e.jsx(He,{value:"selection",children:"اختيار العمال"}),e.jsx(He,{value:"summary",children:"الملخص"}),e.jsx(He,{value:"detailed",children:"التفاصيل"}),e.jsx(He,{value:"analytics",children:"التحليلات"})]}),e.jsx(Ge,{value:"selection",className:"space-y-4",children:e.jsxs(q,{children:[e.jsxs(ue,{className:"flex flex-row items-center justify-between",children:[e.jsx(pe,{children:"اختيار العمال للتقرير"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fi,{id:"selectAll",checked:r.length===l.length&&l.length>0,onCheckedChange:m}),e.jsxs("label",{htmlFor:"selectAll",className:"text-sm",children:["تحديد الكل (",l.length,")"]})]})]}),e.jsxs(H,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-96 overflow-y-auto",children:l.map(p=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50",children:[e.jsx(fi,{id:p.id,checked:r.includes(p.id),onCheckedChange:A=>f(p.id,!!A)}),e.jsx("div",{className:"flex-1",children:e.jsxs("label",{htmlFor:p.id,className:"cursor-pointer",children:[e.jsx("p",{className:"font-medium",children:p.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[p.type," - ",Me(p.dailyWage.toString())]})]})}),!p.isActive&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded",children:"غير نشط"})]},p.id))}),l.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_t,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد عمال في المشروع المحدد"})]})]})]})}),e.jsxs(Ge,{value:"summary",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(q,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"عدد العمال"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:x.totalWorkers})]}),e.jsx(_t,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(q,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"إجمالي أيام العمل"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.totalWorkDays})]}),e.jsx(Ut,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(q,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"إجمالي الأجور"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:Me(x.totalEarned.toString())})]}),e.jsx(us,{className:"w-8 h-8 text-purple-500"})]})})}),e.jsx(q,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"المتبقي"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:Me(x.totalRemaining.toString())})]}),e.jsx(ls,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"ملخص العمال المحددين"})}),e.jsx(H,{children:c?e.jsx("div",{className:"text-center py-8",children:"جاري التحميل..."}):d.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"يرجى اختيار عمال لعرض التقرير"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-right p-3",children:"اسم العامل"}),e.jsx("th",{className:"text-right p-3",children:"النوع"}),e.jsx("th",{className:"text-right p-3",children:"أيام العمل"}),e.jsx("th",{className:"text-right p-3",children:"الأجر المستحق"}),e.jsx("th",{className:"text-right p-3",children:"المدفوع"}),e.jsx("th",{className:"text-right p-3",children:"المتبقي"}),e.jsx("th",{className:"text-right p-3",children:"معدل الحضور"})]})}),e.jsx("tbody",{children:d.map(p=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium",children:p.worker.name}),e.jsx("td",{className:"p-3",children:p.worker.type}),e.jsx("td",{className:"p-3",children:p.stats.totalWorkDays}),e.jsx("td",{className:"p-3",children:Me(p.stats.totalEarned.toString())}),e.jsx("td",{className:"p-3",children:Me(p.stats.totalPaid.toString())}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:p.stats.remainingBalance>0?"text-green-600":p.stats.remainingBalance<0?"text-red-600":"text-gray-600",children:Me(p.stats.remainingBalance.toString())})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs ${p.stats.attendanceRate>=90?"bg-green-100 text-green-800":p.stats.attendanceRate>=70?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[p.stats.attendanceRate.toFixed(1),"%"]})})]},p.worker.id))})]})})})]})]}),e.jsx(Ge,{value:"detailed",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"التقرير المفصل"})}),e.jsx(H,{children:e.jsx("p",{className:"text-gray-600",children:"التقرير المفصل سيتم تطويره لاحقاً ليشمل تفاصيل الحضور اليومي والمدفوعات"})})]})}),e.jsx(Ge,{value:"analytics",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"تحليلات الأداء"})}),e.jsx(H,{children:e.jsx("p",{className:"text-gray-600",children:"تحليلات الأداء والإحصائيات المتقدمة قيد التطوير"})})]})})]})]})}const V6={info:"bg-blue-500",low:"bg-gray-500",medium:"bg-yellow-500",high:"bg-orange-500",critical:"bg-red-500"},z6={info:Ba,low:Ba,medium:Ns,high:Wt,critical:Wt},Pf={system:hs,maintenance:Ns,warranty:Wt,damaged:Wt,"user-welcome":hs,task:ms,"payment-reminder":Ns,"general-announcement":Ba};function B6(){const{toast:t}=Ct(),{user:s}=qn(),[r,a]=h.useState("all"),[n,i]=h.useState("all"),o=s?.id||"06b71320-c869-4636-8f9f-dbcb5b12c74d",l=s?.role==="admin"||s?.role==="مدير"||s?.email?.includes("admin"),{data:u,isLoading:d}=ge({queryKey:["/api/notifications"],queryFn:async()=>{const k=await fetch(`/api/notifications?userId=${o}&limit=50`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!k.ok)throw new Error("Failed to fetch notifications");return k.json()},refetchInterval:3e4,enabled:!!s}),c=u?.notifications||[],f=k=>typeof k=="string"?k:k<=1?"info":k<=2?"low":k<=3?"medium":k<=4?"high":"critical",m=Ce({mutationFn:async({notificationId:k,userId:R})=>{const I=await fetch(`/api/notifications/${k}/mark-read`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({userId:R})});if(!I.ok)throw new Error("Failed to mark notification as read");return I.json()},onSuccess:()=>{Nc.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"تم بنجاح",description:"تم تعليم الإشعار كمقروء"})},onError:()=>{t({title:"خطأ",description:"فشل في تعليم الإشعار كمقروء",variant:"destructive"})}}),y=Ce({mutationFn:async()=>{const k=await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({userId:o})});if(!k.ok)throw new Error("Failed to mark all notifications as read");return k.json()},onSuccess:()=>{Nc.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"تم بنجاح",description:"تم تعليم جميع الإشعارات كمقروءة"})},onError:()=>{t({title:"خطأ",description:"فشل في تعليم جميع الإشعارات كمقروءة",variant:"destructive"})}}),x=Array.isArray(c)?c.map(k=>({...k,priority:f(k.priority),status:k.status||(k.isRead?"read":"unread")})):[],p=Array.isArray(x)?x.filter(k=>!(r!=="all"&&k.status!==r||n!=="all"&&k.type!==n)):[],A=["system","maintenance","warranty","damaged"],g=["user-welcome","task","payment-reminder","general-announcement"],N=l?[...A,...g]:g,w=Array.from(new Set(Array.isArray(x)?x.map(k=>k.type).filter(k=>N.includes(k)):[])),_={total:Array.isArray(x)?x.length:0,unread:Array.isArray(x)?x.filter(k=>k.status==="unread").length:0,critical:Array.isArray(x)?x.filter(k=>f(k.priority)==="critical").length:0,high:Array.isArray(x)?x.filter(k=>f(k.priority)==="high").length:0},b=k=>{m.mutate({notificationId:k,userId:o})};return d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-slate-900 dark:to-slate-800",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto p-3 space-y-3",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg animate-pulse",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[1,2,3,4].map(k=>e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-lg h-16"},k))})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32 mb-2"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3].map(k=>e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded flex-1"},k))})]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(k=>e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"})]})]})},k))})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-slate-900 dark:to-slate-800",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto p-3 space-y-3",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg border border-blue-100 dark:border-slate-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:_.total}),e.jsx("div",{className:"text-xs opacity-90",children:"إجمالي الإشعارات"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:_.unread}),e.jsx("div",{className:"text-xs opacity-90",children:"غير مقروء"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:_.high}),e.jsx("div",{className:"text-xs opacity-90",children:"عالي الأولوية"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:_.critical}),e.jsx("div",{className:"text-xs opacity-90",children:"حرج"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg border border-blue-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dl,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:"تصفية الإشعارات"})]}),_.unread>0&&e.jsxs($,{variant:"outline",size:"sm",onClick:()=>y.mutate(),disabled:y.isPending,className:"text-xs gap-1 h-7 px-2",children:[e.jsx(ms,{className:"h-3 w-3"}),"تعليم الكل كمقروء"]})]}),e.jsxs("div",{className:"flex gap-1 mb-2",children:[e.jsxs($,{variant:r==="all"?"default":"outline",onClick:()=>a("all"),size:"sm",className:he("flex-1 gap-1 text-xs h-8",r==="all"?"bg-blue-500 hover:bg-blue-600 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"),"data-testid":"filter-all",children:[e.jsx(hs,{className:"h-3 w-3"}),"الكل",e.jsx("span",{className:"bg-white/20 px-1 rounded text-xs",children:_.total})]}),e.jsxs($,{variant:r==="unread"?"default":"outline",onClick:()=>a("unread"),size:"sm",className:he("flex-1 gap-1 text-xs h-8",r==="unread"?"bg-orange-500 hover:bg-orange-600 text-white":"border-orange-200 text-orange-700 hover:bg-orange-50"),"data-testid":"filter-unread",children:[e.jsx(_k,{className:"h-3 w-3"}),"جديد",e.jsx("span",{className:"bg-white/20 px-1 rounded text-xs",children:_.unread})]}),e.jsxs($,{variant:r==="read"?"default":"outline",onClick:()=>a("read"),size:"sm",className:he("flex-1 gap-1 text-xs h-8",r==="read"?"bg-green-500 hover:bg-green-600 text-white":"border-green-200 text-green-700 hover:bg-green-50"),"data-testid":"filter-read",children:[e.jsx(ms,{className:"h-3 w-3"}),"مقروء",e.jsx("span",{className:"bg-white/20 px-1 rounded text-xs",children:_.total-_.unread})]})]}),w.length>0&&e.jsxs("div",{className:"flex gap-1 overflow-x-auto pb-1",children:[e.jsx($,{variant:n==="all"?"secondary":"ghost",onClick:()=>i("all"),size:"sm",className:"text-xs h-7 px-2 flex-shrink-0",children:"جميع الأنواع"}),Array.isArray(w)&&w.map(k=>e.jsxs($,{variant:n===k?"secondary":"ghost",onClick:()=>i(k),size:"sm",className:"text-xs gap-1 h-7 px-2 flex-shrink-0",children:[(()=>{const R=Pf[k];return R?e.jsx(R,{className:"h-3 w-3"}):null})(),k==="system"&&"نظام",k==="maintenance"&&"صيانة",k==="warranty"&&"ضمان",k==="damaged"&&"عطل",k==="user-welcome"&&"ترحيب",k==="task"&&"مهام",k==="payment-reminder"&&"تذكير دفع",k==="general-announcement"&&"إعلان عام"]},k))]})]}),e.jsx("div",{className:"space-y-2",children:p.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg border border-blue-100 dark:border-slate-700 text-center",children:[e.jsx(hs,{className:"h-12 w-12 text-blue-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"لا توجد إشعارات"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r==="all"&&"لا توجد إشعارات في النظام حالياً",r==="unread"&&"لا توجد إشعارات غير مقروءة",r==="read"&&"لا توجد إشعارات مقروءة"]})]}):Array.isArray(p)&&p.map(k=>{z6[k.priority];const R=Pf[k.type];return e.jsx("div",{className:he("bg-white dark:bg-slate-800 rounded-xl p-3 border shadow-lg transition-all duration-200 hover:shadow-xl",k.status==="unread"?"border-l-4 border-l-blue-500 bg-blue-50 dark:bg-blue-900/20 border-blue-100 dark:border-blue-800":"border-gray-100 dark:border-slate-700"),"data-testid":`notification-${k.id}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex items-center gap-1 mt-0.5",children:e.jsx("div",{className:he("p-1.5 rounded-lg",V6[k.priority]||"bg-blue-500"),children:R?e.jsx(R,{className:"h-3 w-3 text-white"}):e.jsx(hs,{className:"h-3 w-3 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 flex-1",children:k.title}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[k.status==="unread"&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsxs(le,{variant:"outline",className:he("text-xs h-5 px-1.5",k.priority==="critical"&&"bg-red-100 text-red-700 border-red-200",k.priority==="high"&&"bg-orange-100 text-orange-700 border-orange-200",k.priority==="medium"&&"bg-yellow-100 text-yellow-700 border-yellow-200",k.priority==="low"&&"bg-gray-100 text-gray-700 border-gray-200",k.priority==="info"&&"bg-blue-100 text-blue-700 border-blue-200"),children:[k.priority==="info"&&"معلومات",k.priority==="low"&&"منخفض",k.priority==="medium"&&"متوسط",k.priority==="high"&&"عالي",k.priority==="critical"&&"حرج"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(Ut,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(k.createdAt).toLocaleDateString("en-GB",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed mb-2",children:k.message||k.body||"لا يوجد محتوى"}),k.actionRequired&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-1 text-yellow-800 dark:text-yellow-400",children:[e.jsx(Ns,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs font-medium",children:"يتطلب إجراءً"})]})})]}),k.status==="unread"&&e.jsxs($,{size:"sm",variant:"outline",onClick:()=>b(k.id),disabled:m.isPending,className:"gap-1 h-7 px-2 flex-shrink-0 text-xs","data-testid":`mark-read-${k.id}`,children:[e.jsx(ms,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"مقروء"}),e.jsx("span",{className:"sm:hidden",children:"✓"})]})]})},k.id)})})]})})}function q6(t,s){if(Array.isArray(t))return t.find(s)}const hc={1:{label:"معلومات",color:"bg-blue-500"},2:{label:"منخفض",color:"bg-green-500"},3:{label:"متوسط",color:"bg-yellow-500"},4:{label:"عالي",color:"bg-orange-500"},5:{label:"حرج",color:"bg-red-500"}},fc={system:{label:"نظام",icon:"⚙️"},security:{label:"أمني",icon:"🔒"},error:{label:"خطأ",icon:"❌"},task:{label:"مهمة",icon:"📋"},payroll:{label:"راتب",icon:"💰"},announcement:{label:"إعلان",icon:"📢"},maintenance:{label:"صيانة",icon:"🔧"},warranty:{label:"ضمان",icon:"🛡️"}},U6=t=>{switch(t?.toLowerCase()){case"admin":case"مدير":case"مسؤول":return{icon:$k,label:"مدير",color:"from-red-500 to-red-600",textColor:"text-red-700",bgColor:"bg-red-50",borderColor:"border-red-200"};case"manager":case"مشرف":return{icon:Qt,label:"مشرف",color:"from-orange-500 to-orange-600",textColor:"text-orange-700",bgColor:"bg-orange-50",borderColor:"border-orange-200"};case"user":case"مستخدم":case"موظف":default:return{icon:Ui,label:"مستخدم",color:"from-blue-500 to-blue-600",textColor:"text-blue-700",bgColor:"bg-blue-50",borderColor:"border-blue-200"}}};function W6(){const{toast:t}=Ct();Mt();const[s,r]=h.useState("overview"),[a,n]=h.useState({type:"",priority:"",limit:50,offset:0}),[i,o]=h.useState(!1),[l,u]=h.useState({title:"",body:"",type:"announcement",priority:3,recipients:"all",specificUserId:"",projectId:""}),{data:d,isLoading:c,refetch:f}=ge({queryKey:["admin-notifications",a],queryFn:async()=>{const b=new URLSearchParams({requesterId:"admin",limit:a.limit.toString(),offset:a.offset.toString(),...a.type&&{type:a.type},...a.priority&&{priority:a.priority}}),k=await fetch(`/api/admin/notifications/all?${b}`);if(!k.ok)throw new Error("فشل في جلب الإشعارات");return k.json()}}),{data:m,isLoading:y}=ge({queryKey:["user-activity"],queryFn:async()=>{const b=await fetch("/api/admin/notifications/user-activity?requesterId=admin");if(!b.ok)throw new Error("فشل في جلب نشاط المستخدمين");return b.json()}}),{data:x=[],isLoading:p}=ge({queryKey:["/api/users","with-roles"],queryFn:async()=>{const b=await fetch("/api/users?includeRole=true");if(!b.ok)throw new Error("فشل في جلب المستخدمين");return b.json()}}),A=Ce({mutationFn:async b=>{const k={...b,requesterId:"admin",recipients:b.recipients==="specific"&&b.specificUserId?[b.specificUserId]:b.recipients},R=await fetch("/api/admin/notifications/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(!R.ok)throw new Error("فشل في إرسال الإشعار");return R.json()},onSuccess:()=>{t({title:"تم إرسال الإشعار بنجاح",variant:"default"}),o(!1),u({title:"",body:"",type:"announcement",priority:3,recipients:"all",specificUserId:"",projectId:""}),f()},onError:()=>{t({title:"خطأ في إرسال الإشعار",variant:"destructive"})}}),g=Ce({mutationFn:async b=>{const k=await fetch(`/api/admin/notifications/${b}?requesterId=admin`,{method:"DELETE"});if(!k.ok)throw new Error("فشل في حذف الإشعار");return k.json()},onSuccess:()=>{t({title:"تم حذف الإشعار بنجاح",variant:"default"}),f()},onError:()=>{t({title:"خطأ في حذف الإشعار",variant:"destructive"})}});Ce({mutationFn:async({notificationId:b,userId:k,isRead:R})=>{const I=await fetch(`/api/admin/notifications/${b}/user/${k}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isRead:R,requesterId:"admin"})});if(!I.ok)throw new Error("فشل في تحديث الحالة");return I.json()},onSuccess:()=>{t({title:"تم تحديث الحالة بنجاح",variant:"default"}),f()},onError:()=>{t({title:"خطأ في تحديث الحالة",variant:"destructive"})}});const N=b=>q6(m?.userStats,R=>R.userId===b)?.userName||b.slice(0,8)+"...",w=({notification:b})=>{const k=fc[b.type]||{label:b.type,icon:"📄"},R=hc[b.priority]||{label:"غير محدد",color:"bg-gray-500"},I=Math.round(b.totalReads/b.totalUsers*100)||0;return e.jsx(q,{className:"group mb-2 hover:shadow-lg transition-all duration-300 ease-in-out border border-gray-100 hover:border-blue-200 bg-gradient-to-br from-white to-gray-50/30",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-xl flex items-center justify-center ${R.color} shadow-sm flex-shrink-0`,children:e.jsx("span",{className:"text-sm",children:k.icon})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm truncate mb-0.5",children:b.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(le,{variant:"outline",className:"text-xs px-1.5 py-0.5 bg-gray-50",children:k.label}),e.jsx(le,{className:`${R.color} text-white text-xs px-1.5 py-0.5`,children:R.label})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx($,{size:"sm",variant:"ghost",onClick:()=>g.mutate(b.id),className:"h-7 w-7 p-0 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(Lk,{className:"h-3.5 w-3.5"})})})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3 leading-relaxed",children:b.body}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Ut,{className:"h-3 w-3"}),new Date(b.createdAt).toLocaleString("ar",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("span",{className:"flex items-center gap-1 text-gray-600 font-medium",children:[e.jsx(_t,{className:"h-3 w-3"}),b.totalReads,"/",b.totalUsers," (",I,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${I>=80?"bg-green-500":I>=60?"bg-blue-500":I>=40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${I}%`}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(Ot,{className:"h-3 w-3"}),"حالة المستخدمين:"]}),e.jsxs("div",{className:"max-h-20 overflow-y-auto space-y-1",children:[b.readStates.slice(0,3).map(E=>e.jsxs("div",{className:"flex items-center justify-between py-1 px-2 bg-white rounded border",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs text-white ${m?.userStats?.find(O=>O.userId===E.userId)?.userRole==="admin"?"bg-gradient-to-r from-red-500 to-red-600":"bg-gradient-to-r from-blue-500 to-blue-600"}`,children:N(E.userId).charAt(0).toUpperCase()}),e.jsx("span",{className:"text-xs font-medium truncate",children:N(E.userId)})]}),e.jsx("div",{className:"flex items-center gap-1",children:E.isRead?e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}):e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full"})})]},E.userId)),b.readStates.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center py-1",children:["+",b.readStates.length-3," مستخدم آخر"]})]})]})]})})},_=({activity:b})=>{const k=R=>R>=80?"from-green-500 to-green-600":R>=60?"from-blue-500 to-blue-600":R>=40?"from-yellow-500 to-yellow-600":"from-red-500 to-red-600";return e.jsx(q,{className:"group mb-2 hover:shadow-md transition-all duration-300 border border-gray-100 hover:border-blue-200 bg-gradient-to-r from-white to-gray-50/50",children:e.jsx(H,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-9 h-9 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm ${b.userRole==="admin"?"bg-gradient-to-r from-red-500 to-red-600":"bg-gradient-to-r from-blue-500 to-blue-600"}`,children:b.userRole==="admin"?e.jsx(Qt,{className:"h-4 w-4 text-white"}):e.jsx(Zs,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900 truncate",children:b.userName}),e.jsx(le,{variant:b.userRole==="admin"?"destructive":"secondary",className:"text-xs px-1.5 py-0.5",children:b.userRole==="admin"?"مسؤول":"مستخدم"})]}),e.jsx("div",{className:"text-xs text-gray-500 truncate mb-1",children:b.userEmail}),e.jsxs("div",{className:"text-xs text-gray-400",children:["آخر نشاط: ",b.lastActivity?new Date(b.lastActivity).toLocaleString("ar",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"لا يوجد"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:b.totalNotifications}),e.jsx(hs,{className:"h-3 w-3 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-xs font-medium text-green-600",children:b.readNotifications}),e.jsx("div",{className:"text-xs text-gray-400",children:"/"}),e.jsx("div",{className:"text-xs text-gray-500",children:b.unreadNotifications})]}),e.jsxs("div",{className:`text-xs font-bold bg-gradient-to-r ${k(b.readPercentage)} bg-clip-text text-transparent`,children:[b.readPercentage,"%"]})]})]})})})};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/40",dir:"rtl",children:e.jsx("div",{className:"container mx-auto p-3 sm:p-6 max-w-7xl",children:e.jsxs(Ks,{value:s,onValueChange:r,className:"w-full",children:[e.jsx("div",{className:"bg-white rounded-2xl p-2 shadow-lg border border-gray-100 mb-12",children:e.jsxs(Os,{className:"grid w-full grid-cols-2 sm:grid-cols-4 gap-2 bg-gray-50 p-1 rounded-xl",children:[e.jsxs(He,{value:"overview",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(Kt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"لوحة التحكم"}),e.jsx("span",{className:"sm:hidden font-medium",children:"عامة"})]}),e.jsxs(He,{value:"notifications",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(hs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"الإشعارات"}),e.jsx("span",{className:"sm:hidden font-medium",children:"إشعارات"})]}),e.jsxs(He,{value:"users",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(_t,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"المستخدمين"}),e.jsx("span",{className:"sm:hidden font-medium",children:"مستخدمين"})]}),e.jsxs(He,{value:"create",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(Gr,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"إرسال جديد"}),e.jsx("span",{className:"sm:hidden font-medium",children:"إرسال"})]})]})}),e.jsxs(Ge,{value:"overview",className:"space-y-12 mt-12",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(q,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200 hover:shadow-lg transition-all duration-300",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-600 mb-1",children:"إجمالي الإشعارات"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:d?.total||0})]}),e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(hs,{className:"h-5 w-5 text-white"})})]})})}),e.jsx(q,{className:"bg-gradient-to-r from-green-50 to-green-100 border-green-200 hover:shadow-lg transition-all duration-300",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:m?.userStats?.length||0})]}),e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center",children:e.jsx(_t,{className:"h-5 w-5 text-white"})})]})})}),e.jsx(q,{className:"bg-gradient-to-r from-amber-50 to-amber-100 border-amber-200 hover:shadow-lg transition-all duration-300",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-600 mb-1",children:"معدل القراءة"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-700",children:[m?.userStats?.length>0?Math.round(m.userStats.reduce((b,k)=>b+k.readPercentage,0)/m.userStats.length):0,"%"]})]}),e.jsx("div",{className:"w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center",children:e.jsx(gi,{className:"h-5 w-5 text-white"})})]})})}),e.jsx(q,{className:"bg-gradient-to-r from-red-50 to-red-100 border-red-200 hover:shadow-lg transition-all duration-300",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-red-600 mb-1",children:"الإشعارات الحرجة"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:d?.notifications?.filter(b=>b.priority===5).length||0})]}),e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-xl flex items-center justify-center",children:e.jsx(Ns,{className:"h-5 w-5 text-white"})})]})})})]}),e.jsxs(q,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl min-h-[600px]",children:[e.jsx(ue,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs(pe,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5 text-blue-600"}),"آخر النشاطات"]})}),e.jsx(H,{className:"p-4",children:e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:m?.userStats?.slice(0,5).map(b=>e.jsx(_,{activity:b},b.userId))})})]})]}),e.jsxs(Ge,{value:"notifications",className:"space-y-10 mt-12",children:[e.jsxs(q,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl",children:[e.jsx(ue,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{className:"text-lg font-semibold",children:"فلترة الإشعارات"}),e.jsxs($,{onClick:()=>f(),disabled:c,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Gt,{className:"h-4 w-4 mr-1"}),"تحديث"]})]})}),e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(qe,{value:a.type||"all",onValueChange:b=>n(k=>({...k,type:b==="all"?"":b})),children:[e.jsx(Oe,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ue,{placeholder:"نوع الإشعار"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الأنواع"}),Object.entries(fc).map(([b,k])=>e.jsxs(K,{value:b,children:[k.icon," ",k.label]},b))]})]}),e.jsxs(qe,{value:a.priority||"all",onValueChange:b=>n(k=>({...k,priority:b==="all"?"":b})),children:[e.jsx(Oe,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ue,{placeholder:"الأولوية"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الأولويات"}),Object.entries(hc).map(([b,k])=>e.jsx(K,{value:b,children:k.label},b))]})]}),e.jsx(be,{type:"number",placeholder:"عدد النتائج",value:a.limit,onChange:b=>n(k=>({...k,limit:parseInt(b.target.value)||50})),className:"border-gray-300 focus:border-blue-500"})]})})]}),e.jsx("div",{className:"space-y-2 min-h-[500px]",children:c?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري التحميل..."})]}):d?.notifications?.length>0?d.notifications.map(b=>e.jsx(w,{notification:b},b.id)):e.jsx(q,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl",children:e.jsxs(H,{className:"text-center py-12",children:[e.jsx(hs,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"لا توجد إشعارات"})]})})})]}),e.jsx(Ge,{value:"users",className:"space-y-10 mt-12",children:e.jsxs(q,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl min-h-[700px]",children:[e.jsx(ue,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs(pe,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(_t,{className:"h-5 w-5 text-blue-600"}),"نشاط المستخدمين مع الإشعارات"]})}),e.jsx(H,{className:"p-4",children:y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري التحميل..."})]}):m?.userStats?.length>0?e.jsx("div",{className:"space-y-2 max-h-[700px] min-h-[500px] overflow-y-auto",children:m.userStats.map(b=>e.jsx(_,{activity:b},b.userId))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_t,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد نشاط للمستخدمين"})]})})]})}),e.jsx(Ge,{value:"create",className:"space-y-10 mt-12",children:e.jsxs(q,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl min-h-[600px]",children:[e.jsx(ue,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs(pe,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Gr,{className:"h-5 w-5 text-blue-600"}),"إنشاء إشعار جديد"]})}),e.jsxs(H,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"نوع الإشعار"}),e.jsxs(qe,{value:l.type,onValueChange:b=>u(k=>({...k,type:b})),children:[e.jsx(Oe,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ue,{})}),e.jsx($e,{children:Object.entries(fc).map(([b,k])=>e.jsx(K,{value:b,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:k.icon}),e.jsx("span",{children:k.label})]})},b))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"مستوى الأولوية"}),e.jsxs(qe,{value:l.priority.toString(),onValueChange:b=>u(k=>({...k,priority:parseInt(b)})),children:[e.jsx(Oe,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ue,{})}),e.jsx($e,{children:Object.entries(hc).map(([b,k])=>e.jsx(K,{value:b,children:e.jsx("div",{className:`flex items-center gap-2 font-medium ${b==="5"?"text-red-600":b==="4"?"text-orange-600":b==="3"?"text-yellow-600":b==="2"?"text-green-600":"text-blue-600"}`,children:k.label})},b))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx(be,{value:l.title,onChange:b=>u(k=>({...k,title:b.target.value})),placeholder:"أدخل عنوان الإشعار",className:"border-gray-300 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"المستقبلين"}),e.jsxs(qe,{value:l.recipients,onValueChange:b=>u(k=>({...k,recipients:b})),children:[e.jsx(Oe,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"h-4 w-4"}),"جميع المستخدمين"]})}),e.jsx(K,{value:"admins",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4"}),"المسؤولين فقط"]})}),e.jsx(K,{value:"users",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-4 w-4"}),"المستخدمين العاديين فقط"]})}),e.jsx(K,{value:"specific",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-4 w-4 text-purple-600"}),"مستخدم محدد"]})})]})]})]}),l.recipients==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"اختر المستخدم"}),e.jsxs(qe,{value:l.specificUserId,onValueChange:b=>u(k=>({...k,specificUserId:b})),children:[e.jsx(Oe,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ue,{placeholder:"اختر المستخدم المحدد..."})}),e.jsx($e,{className:"max-h-48",children:p?e.jsxs("div",{className:"p-3 text-center text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mx-auto"}),e.jsx("span",{className:"text-sm mt-2",children:"جاري التحميل..."})]}):x.length>0?x.map(b=>{const k=U6(b.role),R=k.icon,I=b.firstName&&b.lastName?`${b.firstName} ${b.lastName}`:b.name||"بدون اسم";return e.jsx(K,{value:b.id,className:"p-3 rounded-lg hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg bg-gradient-to-r ${k.color} flex items-center justify-center shadow-sm`,children:e.jsx(R,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 truncate text-sm",children:I}),e.jsx("div",{className:`px-2 py-0.5 rounded-full ${k.bgColor} ${k.borderColor} border`,children:e.jsx("span",{className:`text-xs font-semibold ${k.textColor}`,children:k.label})})]}),e.jsx("span",{className:"text-xs text-gray-500 truncate",children:b.email})]})]})},b.id)}):e.jsx("div",{className:"p-3 text-center text-gray-500",children:e.jsx("span",{className:"text-sm",children:"لا توجد مستخدمون متاحون"})})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"محتوى الإشعار"}),e.jsx(an,{value:l.body,onChange:b=>u(k=>({...k,body:b.target.value})),placeholder:"أدخل محتوى الإشعار التفصيلي...",rows:4,className:"border-gray-300 focus:border-blue-500 resize-none"})]}),e.jsx($,{onClick:()=>A.mutate(l),disabled:!l.title||!l.body||l.recipients==="specific"&&!l.specificUserId||A.isPending,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 h-12 text-base font-semibold shadow-lg hover:shadow-xl transition-all duration-200",children:A.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"جاري الإرسال..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wc,{className:"h-5 w-5"}),"إرسال الإشعار"]})})]})]})})]})})})}function K6(t,s){return h.useReducer((r,a)=>s[r][a]??r,t)}var $u="ScrollArea",[x1]=Hs($u),[H6,dr]=x1($u),g1=h.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:n,scrollHideDelay:i=600,...o}=t,[l,u]=h.useState(null),[d,c]=h.useState(null),[f,m]=h.useState(null),[y,x]=h.useState(null),[p,A]=h.useState(null),[g,N]=h.useState(0),[w,_]=h.useState(0),[b,k]=h.useState(!1),[R,I]=h.useState(!1),E=lt(s,T=>u(T)),O=zi(n);return e.jsx(H6,{scope:r,type:a,dir:O,scrollHideDelay:i,scrollArea:l,viewport:d,onViewportChange:c,content:f,onContentChange:m,scrollbarX:y,onScrollbarXChange:x,scrollbarXEnabled:b,onScrollbarXEnabledChange:k,scrollbarY:p,onScrollbarYChange:A,scrollbarYEnabled:R,onScrollbarYEnabledChange:I,onCornerWidthChange:N,onCornerHeightChange:_,children:e.jsx(We.div,{dir:O,...o,ref:E,style:{position:"relative","--radix-scroll-area-corner-width":g+"px","--radix-scroll-area-corner-height":w+"px",...t.style}})})});g1.displayName=$u;var y1="ScrollAreaViewport",v1=h.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:a,nonce:n,...i}=t,o=dr(y1,r),l=h.useRef(null),u=lt(s,l,o.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(We.div,{"data-radix-scroll-area-viewport":"",...i,ref:u,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});v1.displayName=y1;var $r="ScrollAreaScrollbar",Lu=h.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=dr($r,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=n,l=t.orientation==="horizontal";return h.useEffect(()=>(l?i(!0):o(!0),()=>{l?i(!1):o(!1)}),[l,i,o]),n.type==="hover"?e.jsx(G6,{...a,ref:s,forceMount:r}):n.type==="scroll"?e.jsx(Q6,{...a,ref:s,forceMount:r}):n.type==="auto"?e.jsx(b1,{...a,ref:s,forceMount:r}):n.type==="always"?e.jsx(Vu,{...a,ref:s}):null});Lu.displayName=$r;var G6=h.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=dr($r,t.__scopeScrollArea),[i,o]=h.useState(!1);return h.useEffect(()=>{const l=n.scrollArea;let u=0;if(l){const d=()=>{window.clearTimeout(u),o(!0)},c=()=>{u=window.setTimeout(()=>o(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",c),()=>{window.clearTimeout(u),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",c)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(ws,{present:r||i,children:e.jsx(b1,{"data-state":i?"visible":"hidden",...a,ref:s})})}),Q6=h.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=dr($r,t.__scopeScrollArea),i=t.orientation==="horizontal",o=_l(()=>u("SCROLL_END"),100),[l,u]=K6("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return h.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>u("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,n.scrollHideDelay,u]),h.useEffect(()=>{const d=n.viewport,c=i?"scrollLeft":"scrollTop";if(d){let f=d[c];const m=()=>{const y=d[c];f!==y&&(u("SCROLL"),o()),f=y};return d.addEventListener("scroll",m),()=>d.removeEventListener("scroll",m)}},[n.viewport,i,u,o]),e.jsx(ws,{present:r||l!=="hidden",children:e.jsx(Vu,{"data-state":l==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:Ne(t.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:Ne(t.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),b1=h.forwardRef((t,s)=>{const r=dr($r,t.__scopeScrollArea),{forceMount:a,...n}=t,[i,o]=h.useState(!1),l=t.orientation==="horizontal",u=_l(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,c=r.viewport.offsetHeight<r.viewport.scrollHeight;o(l?d:c)}},10);return Fn(r.viewport,u),Fn(r.content,u),e.jsx(ws,{present:a||i,children:e.jsx(Vu,{"data-state":i?"visible":"hidden",...n,ref:s})})}),Vu=h.forwardRef((t,s)=>{const{orientation:r="vertical",...a}=t,n=dr($r,t.__scopeScrollArea),i=h.useRef(null),o=h.useRef(0),[l,u]=h.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=S1(l.viewport,l.content),c={...a,sizes:l,onSizesChange:u,hasThumb:d>0&&d<1,onThumbChange:m=>i.current=m,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:m=>o.current=m};function f(m,y){return tR(m,o.current,l,y)}return r==="horizontal"?e.jsx(X6,{...c,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const m=n.viewport.scrollLeft,y=_f(m,l,n.dir);i.current.style.transform=`translate3d(${y}px, 0, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollLeft=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollLeft=f(m,n.dir))}}):r==="vertical"?e.jsx(Z6,{...c,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const m=n.viewport.scrollTop,y=_f(m,l);i.current.style.transform=`translate3d(0, ${y}px, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollTop=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollTop=f(m))}}):null}),X6=h.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,i=dr($r,t.__scopeScrollArea),[o,l]=h.useState(),u=h.useRef(null),d=lt(s,u,i.onScrollbarXChange);return h.useEffect(()=>{u.current&&l(getComputedStyle(u.current))},[u]),e.jsx(N1,{"data-orientation":"horizontal",...n,ref:d,sizes:r,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Pl(r)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.x),onDragScroll:c=>t.onDragScroll(c.x),onWheelScroll:(c,f)=>{if(i.viewport){const m=i.viewport.scrollLeft+c.deltaX;t.onWheelScroll(m),A1(m,f)&&c.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&a({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:Jo(o.paddingLeft),paddingEnd:Jo(o.paddingRight)}})}})}),Z6=h.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,i=dr($r,t.__scopeScrollArea),[o,l]=h.useState(),u=h.useRef(null),d=lt(s,u,i.onScrollbarYChange);return h.useEffect(()=>{u.current&&l(getComputedStyle(u.current))},[u]),e.jsx(N1,{"data-orientation":"vertical",...n,ref:d,sizes:r,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Pl(r)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.y),onDragScroll:c=>t.onDragScroll(c.y),onWheelScroll:(c,f)=>{if(i.viewport){const m=i.viewport.scrollTop+c.deltaY;t.onWheelScroll(m),A1(m,f)&&c.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&a({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:Jo(o.paddingTop),paddingEnd:Jo(o.paddingBottom)}})}})}),[Y6,j1]=x1($r),N1=h.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:n,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:l,onThumbPositionChange:u,onDragScroll:d,onWheelScroll:c,onResize:f,...m}=t,y=dr($r,r),[x,p]=h.useState(null),A=lt(s,E=>p(E)),g=h.useRef(null),N=h.useRef(""),w=y.viewport,_=a.content-a.viewport,b=Lt(c),k=Lt(u),R=_l(f,10);function I(E){if(g.current){const O=E.clientX-g.current.left,T=E.clientY-g.current.top;d({x:O,y:T})}}return h.useEffect(()=>{const E=O=>{const T=O.target;x?.contains(T)&&b(O,_)};return document.addEventListener("wheel",E,{passive:!1}),()=>document.removeEventListener("wheel",E,{passive:!1})},[w,x,_,b]),h.useEffect(k,[a,k]),Fn(x,R),Fn(y.content,R),e.jsx(Y6,{scope:r,scrollbar:x,hasThumb:n,onThumbChange:Lt(i),onThumbPointerUp:Lt(o),onThumbPositionChange:k,onThumbPointerDown:Lt(l),children:e.jsx(We.div,{...m,ref:A,style:{position:"absolute",...m.style},onPointerDown:Ne(t.onPointerDown,E=>{E.button===0&&(E.target.setPointerCapture(E.pointerId),g.current=x.getBoundingClientRect(),N.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",y.viewport&&(y.viewport.style.scrollBehavior="auto"),I(E))}),onPointerMove:Ne(t.onPointerMove,I),onPointerUp:Ne(t.onPointerUp,E=>{const O=E.target;O.hasPointerCapture(E.pointerId)&&O.releasePointerCapture(E.pointerId),document.body.style.webkitUserSelect=N.current,y.viewport&&(y.viewport.style.scrollBehavior=""),g.current=null})})})}),Yo="ScrollAreaThumb",w1=h.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=j1(Yo,t.__scopeScrollArea);return e.jsx(ws,{present:r||n.hasThumb,children:e.jsx(J6,{ref:s,...a})})}),J6=h.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:a,...n}=t,i=dr(Yo,r),o=j1(Yo,r),{onThumbPositionChange:l}=o,u=lt(s,f=>o.onThumbChange(f)),d=h.useRef(void 0),c=_l(()=>{d.current&&(d.current(),d.current=void 0)},100);return h.useEffect(()=>{const f=i.viewport;if(f){const m=()=>{if(c(),!d.current){const y=sR(f,l);d.current=y,l()}};return l(),f.addEventListener("scroll",m),()=>f.removeEventListener("scroll",m)}},[i.viewport,c,l]),e.jsx(We.div,{"data-state":o.hasThumb?"visible":"hidden",...n,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:Ne(t.onPointerDownCapture,f=>{const y=f.target.getBoundingClientRect(),x=f.clientX-y.left,p=f.clientY-y.top;o.onThumbPointerDown({x,y:p})}),onPointerUp:Ne(t.onPointerUp,o.onThumbPointerUp)})});w1.displayName=Yo;var zu="ScrollAreaCorner",k1=h.forwardRef((t,s)=>{const r=dr(zu,t.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?e.jsx(eR,{...t,ref:s}):null});k1.displayName=zu;var eR=h.forwardRef((t,s)=>{const{__scopeScrollArea:r,...a}=t,n=dr(zu,r),[i,o]=h.useState(0),[l,u]=h.useState(0),d=!!(i&&l);return Fn(n.scrollbarX,()=>{const c=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(c),u(c)}),Fn(n.scrollbarY,()=>{const c=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(c),o(c)}),d?e.jsx(We.div,{...a,ref:s,style:{width:i,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function Jo(t){return t?parseInt(t,10):0}function S1(t,s){const r=t/s;return isNaN(r)?0:r}function Pl(t){const s=S1(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-r)*s;return Math.max(a,18)}function tR(t,s,r,a="ltr"){const n=Pl(r),i=n/2,o=s||i,l=n-o,u=r.scrollbar.paddingStart+o,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,c=r.content-r.viewport,f=a==="ltr"?[0,c]:[c*-1,0];return T1([u,d],f)(t)}function _f(t,s,r="ltr"){const a=Pl(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,i=s.scrollbar.size-n,o=s.content-s.viewport,l=i-a,u=r==="ltr"?[0,o]:[o*-1,0],d=uk(t,u);return T1([0,o],[0,l])(d)}function T1(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(t[1]-t[0]);return s[0]+a*(r-t[0])}}function A1(t,s){return t>0&&t<s}var sR=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},a=0;return(function n(){const i={left:t.scrollLeft,top:t.scrollTop},o=r.left!==i.left,l=r.top!==i.top;(o||l)&&s(),r=i,a=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(a)};function _l(t,s){const r=Lt(t),a=h.useRef(0);return h.useEffect(()=>()=>window.clearTimeout(a.current),[]),h.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function Fn(t,s){const r=Lt(s);cl(()=>{let a=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return n.observe(t),()=>{window.cancelAnimationFrame(a),n.unobserve(t)}}},[t,r])}var C1=g1,rR=v1,aR=k1;const Zr=h.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(C1,{ref:a,className:he("relative overflow-hidden",t),...r,children:[e.jsx(rR,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(P1,{}),e.jsx(aR,{})]}));Zr.displayName=C1.displayName;const P1=h.forwardRef(({className:t,orientation:s="vertical",...r},a)=>e.jsx(Lu,{ref:a,orientation:s,className:he("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(w1,{className:"relative flex-1 rounded-full bg-border"})}));P1.displayName=Lu.displayName;const nR=()=>{const t=Mt(),{toast:s}=Ct(),[r,a]=h.useState("policies"),{data:n=[]}=ge({queryKey:["/api/security-policies"],refetchInterval:3e4}),{data:i=[]}=ge({queryKey:["/api/security-policy-suggestions"],refetchInterval:3e4}),{data:o=[]}=ge({queryKey:["/api/security-policy-violations"],refetchInterval:3e4}),l=Ce({mutationFn:c=>ae(`/api/security-policy-suggestions/${c}/implement`,"POST"),onSuccess:()=>{s({title:"تم تنفيذ الاقتراح",description:"تم تحويل الاقتراح إلى سياسة فعالة"}),t.invalidateQueries({queryKey:["/api/security-policies"]}),t.invalidateQueries({queryKey:["/api/security-policy-suggestions"]})},onError:()=>{s({title:"خطأ في التنفيذ",description:"فشل في تنفيذ الاقتراح",variant:"destructive"})}}),u=c=>{switch(c){case"critical":return"destructive";case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}},d=c=>{switch(c){case"active":return e.jsx(ms,{className:"w-4 h-4 text-green-600"});case"draft":return e.jsx(Ut,{className:"w-4 h-4 text-yellow-600"});case"inactive":return e.jsx(yr,{className:"w-4 h-4 text-red-600"});default:return e.jsx(Wt,{className:"w-4 h-4 text-gray-600"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qt,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"السياسات الأمنية المتقدمة"}),e.jsx("p",{className:"text-sm text-gray-600",children:"إدارة شاملة للأمان والحماية"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(le,{variant:"outline",className:"text-sm",children:[n.length," سياسة"]}),e.jsxs(le,{variant:"outline",className:"text-sm",children:[i.length," اقتراح"]}),e.jsxs(le,{variant:"outline",className:"text-sm",children:[o.length," انتهاك"]})]})]}),e.jsxs(Ks,{value:r,onValueChange:a,className:"space-y-4",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3",children:[e.jsxs(He,{value:"policies",className:"flex items-center gap-2",children:[e.jsx(xi,{className:"w-4 h-4"}),"السياسات"]}),e.jsxs(He,{value:"suggestions",className:"flex items-center gap-2",children:[e.jsx(Bl,{className:"w-4 h-4"}),"الاقتراحات"]}),e.jsxs(He,{value:"violations",className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"الانتهاكات"]})]}),e.jsxs(Ge,{value:"policies",className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(c=>e.jsxs(q,{className:"hover:shadow-md transition-shadow",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(c.status),e.jsx(pe,{className:"text-base",children:c.title})]}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx(le,{variant:u(c.severity),className:"text-xs",children:c.severity==="critical"?"حرج":c.severity==="high"?"عالي":c.severity==="medium"?"متوسط":"منخفض"})})]})}),e.jsxs(H,{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:c.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"الفئة:"}),e.jsx(le,{variant:"outline",className:"text-xs",children:c.category})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"الانتهاكات:"}),e.jsx(le,{variant:c.violations_count>0?"destructive":"secondary",className:"text-xs",children:c.violations_count})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"تاريخ الإنشاء:"}),e.jsx("span",{className:"text-gray-600",children:new Date(c.created_at).toLocaleDateString("ar-SA")})]})]}),e.jsx(Is,{className:"my-3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{size:"sm",variant:"outline",className:"flex-1",children:[e.jsx(lr,{className:"w-3 h-3 mr-1"}),"عرض"]}),e.jsxs($,{size:"sm",variant:"outline",className:"flex-1",children:[e.jsx(rs,{className:"w-3 h-3 mr-1"}),"تعديل"]})]})]})]},c.id))}),n.length===0&&e.jsxs(q,{className:"p-8 text-center",children:[e.jsx(xi,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"لا توجد سياسات أمنية"}),e.jsx("p",{className:"text-sm text-gray-500",children:"يمكنك إنشاء سياسات جديدة من الاقتراحات"})]})]}),e.jsxs(Ge,{value:"suggestions",className:"space-y-4",children:[e.jsx("div",{className:"space-y-4",children:i.map(c=>e.jsx(q,{className:"hover:shadow-md transition-shadow",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Bl,{className:"w-4 h-4 text-yellow-500"}),e.jsx("h3",{className:"font-medium",children:c.title}),e.jsx(le,{variant:u(c.priority),className:"text-xs",children:c.priority==="critical"?"حرج":c.priority==="high"?"عالي":c.priority==="medium"?"متوسط":"منخفض"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:c.description}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[e.jsx("span",{className:"font-medium",children:"التبرير:"})," ",c.reasoning]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Kt,{className:"w-3 h-3"}),e.jsxs("span",{children:["الثقة: ",c.confidence,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Wt,{className:"w-3 h-3"}),e.jsxs("span",{children:["التأثير: ",c.estimated_impact]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[c.status==="pending"&&e.jsxs($,{size:"sm",onClick:()=>l.mutate(c.id),disabled:l.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Tn,{className:"w-3 h-3 mr-1"}),"تنفيذ"]}),e.jsx(le,{variant:c.status==="implemented"?"default":"outline",className:"text-xs",children:c.status==="pending"?"معلق":c.status==="approved"?"معتمد":c.status==="implemented"?"منفذ":"مرفوض"})]})]})})},c.id))}),i.length===0&&e.jsxs(q,{className:"p-8 text-center",children:[e.jsx(Bl,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"لا توجد اقتراحات"}),e.jsx("p",{className:"text-sm text-gray-500",children:"سيتم إنشاء اقتراحات تلقائياً عند تحليل النظام"})]})]}),e.jsxs(Ge,{value:"violations",className:"space-y-4",children:[e.jsx("div",{className:"space-y-4",children:o.map(c=>e.jsx(q,{className:"hover:shadow-md transition-shadow",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-red-500"}),e.jsx("h3",{className:"font-medium",children:c.violated_rule}),e.jsx(le,{variant:"destructive",className:"text-xs",children:c.severity==="critical"?"حرج":c.severity==="high"?"عالي":c.severity==="medium"?"متوسط":"منخفض"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["تم الاكتشاف: ",new Date(c.detected_at).toLocaleString("ar-SA")]})]}),e.jsx(le,{variant:c.status==="resolved"?"default":"destructive",className:"text-xs",children:c.status==="open"?"مفتوح":c.status==="in_progress"?"قيد المعالجة":"محلول"})]})})},c.id))}),o.length===0&&e.jsxs(q,{className:"p-8 text-center",children:[e.jsx(ms,{className:"w-12 h-12 text-green-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"لا توجد انتهاكات"}),e.jsx("p",{className:"text-sm text-gray-500",children:"جميع السياسات الأمنية يتم تطبيقها بنجاح"})]})]})]})]})},pc=({recommendation:t,onExecute:s,isExecuting:r,disabled:a})=>{const[n,i]=ot.useState(!1),o=d=>{switch(d){case"financial":return e.jsx(us,{className:"w-4 h-4 text-green-600"});case"workforce":return e.jsx(_t,{className:"w-4 h-4 text-blue-600"});case"security":return e.jsx(xi,{className:"w-4 h-4 text-red-600"});case"performance":return e.jsx(nr,{className:"w-4 h-4 text-purple-600"});case"supplier":return e.jsx(qa,{className:"w-4 h-4 text-orange-600"});default:return e.jsx(Wt,{className:"w-4 h-4 text-gray-600"})}},l=d=>{switch(d){case"financial":return"مالي";case"workforce":return"عمالة";case"security":return"أمان";case"performance":return"أداء";case"supplier":return"موردين";default:return"عام"}},u=d=>({critical:"bg-red-500",high:"bg-orange-500",medium:"bg-yellow-500",low:"bg-green-500"})[d]||"bg-gray-500";return e.jsxs("div",{className:"border rounded-lg p-3 bg-white hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o(t.recommendationType),e.jsx(le,{variant:"outline",className:"text-xs",children:l(t.recommendationType)}),e.jsx(le,{className:`${u(t.priority)} text-white text-xs`,children:t.priority==="critical"?"حرج":t.priority==="high"?"عالي":t.priority==="medium"?"متوسط":"منخفض"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(le,{variant:"secondary",className:"text-xs",children:[t.confidence,"% دقة"]}),e.jsx($,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>i(!n),"data-testid":`button-expand-${t.id}`,children:n?e.jsx(oi,{className:"w-3 h-3"}):e.jsx(_r,{className:"w-3 h-3"})})]})]}),e.jsx("h4",{className:"text-sm font-semibold mb-2 text-gray-800",children:t.title}),e.jsx("p",{className:"text-xs text-gray-600 mb-2 leading-relaxed",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Kt,{className:"w-3 h-3 text-green-600"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["التأثير: ",t.estimatedImpact]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3 text-blue-600"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["المدة: ",t.timeframe]})]})]}),n&&t.detailedExplanation&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("h5",{className:"text-xs font-medium mb-2 text-gray-700",children:"الشرح التفصيلي:"}),e.jsx("div",{className:"text-xs text-gray-600 leading-relaxed whitespace-pre-line",children:t.detailedExplanation})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.autoExecutable?e.jsxs(le,{variant:"secondary",className:"text-xs",children:[e.jsx(Gr,{className:"w-3 h-3 mr-1"}),"قابل للتنفيذ التلقائي"]}):e.jsx(le,{variant:"outline",className:"text-xs",children:"يتطلب تدخل يدوي"})}),t.autoExecutable&&e.jsx($,{size:"sm",variant:r?"default":"outline",className:`text-xs py-1 h-7 transition-all ${r?"bg-blue-500 text-white animate-pulse":""}`,"data-testid":`button-execute-${t.id}`,onClick:()=>s(t.id),disabled:a,children:r?e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"w-3 h-3 mr-1 animate-spin"}),"تنفيذ جاري..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Tn,{className:"w-3 h-3 mr-1"}),"تنفيذ"]})})]})]})},iR=()=>{const[t,s]=h.useState(null),[r,a]=h.useState(!0),{toast:n}=Ct(),i=Mt(),{data:o=[],isLoading:l}=ge({queryKey:["/api/db-admin/tables"],refetchInterval:6e4}),u=ot.useMemo(()=>{const m=new Map;return o.forEach(y=>{const x=y.table_name;if(!m.has(x))m.set(x,y);else{const p=m.get(x);y.row_count>p.row_count&&m.set(x,y)}}),Array.from(m.values())},[o]),d=Ce({mutationFn:async({tableName:m,enable:y})=>ae("/api/db-admin/toggle-rls","POST",{tableName:m,enable:y}),onSuccess:(m,{tableName:y,enable:x})=>{n({title:"تم التحديث بنجاح",description:`تم ${x?"تفعيل":"تعطيل"} RLS للجدول ${y}`,variant:"default"}),i.invalidateQueries({queryKey:["/api/db-admin/tables"]})},onError:m=>{n({title:"خطأ في العملية",description:m.message||"فشل في تحديث إعدادات RLS",variant:"destructive"})}}),c=m=>({high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-green-100 text-green-800"})[m]||"bg-gray-100 text-gray-800",f=m=>m.includes("user")?e.jsx(_t,{className:"w-4 h-4"}):m.includes("project")?e.jsx(ls,{className:"w-4 h-4"}):m.includes("auth")?e.jsx(xi,{className:"w-4 h-4"}):e.jsx(aS,{className:"w-4 h-4"});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{children:e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(pe,{className:"text-lg flex items-center gap-2",children:[e.jsx($t,{className:"w-5 h-5"}),"إدارة الجداول الذكية"]}),e.jsx(js,{children:"إدارة متقدمة لجداول قاعدة البيانات وسياسات الأمان"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>a(!r),children:[r?e.jsx(oi,{className:"w-4 h-4"}):e.jsx(_r,{className:"w-4 h-4"}),e.jsxs("span",{className:"hidden sm:inline mr-1",children:[r?"إخفاء":"عرض"," التوصيات"]})]}),e.jsx($,{size:"sm",variant:"outline",children:e.jsx(Gt,{className:"w-4 h-4"})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(q,{children:[e.jsxs(ue,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(pe,{className:"text-base",children:["الجداول المكتشفة (",u.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{variant:"outline",className:"text-xs",children:"✅ البيانات الحقيقية"}),e.jsx(le,{variant:"secondary",className:"text-xs",children:"مرتبة أبجدياً"})]})]}),e.jsxs(js,{className:"text-sm",children:["قاعدة البيانات Supabase متصلة مع ",u.length>0?`${u.length} جدول`:"لا توجد جداول",o.length!==u.length&&e.jsxs("span",{className:"text-yellow-600",children:[" (تم إزالة ",o.length-u.length," مكرر)"]}),Array.isArray(u)&&u.length>0&&` - إجمالي الصفوف: ${u.reduce((m,y)=>m+y.row_count,0).toLocaleString()}`]})]}),e.jsx(H,{children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 space-y-2",children:[e.jsx(Jr,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsx("span",{className:"mr-2 font-medium",children:"جاري تحليل قاعدة البيانات..."}),e.jsx("span",{className:"text-xs text-gray-500",children:"قد يستغرق هذا بضع ثواني"})]}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 space-y-2",children:[e.jsx($t,{className:"w-12 h-12 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-600",children:"لا توجد جداول متاحة"}),e.jsx("span",{className:"text-xs text-gray-500",children:"تأكد من صحة الاتصال بقاعدة البيانات"})]}):e.jsx(Zr,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-2",children:Array.isArray(u)&&u.sort((m,y)=>m.table_name.localeCompare(y.table_name)).map(m=>e.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer transition-all hover:shadow-md ${t?.table_name===m.table_name?"border-blue-500 bg-blue-50":""}`,onClick:()=>s(m),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[f(m.table_name),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium",children:m.table_name}),e.jsx("p",{className:"text-xs text-gray-500",children:m.schema_name})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(le,{className:`text-xs ${c(m.security_level)}`,children:m.security_level==="high"?"عالي":m.security_level==="medium"?"متوسط":"منخفض"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m.rls_enabled?e.jsx(Qt,{className:"w-3 h-3 text-green-600"}):e.jsx(Ns,{className:"w-3 h-3 text-red-600"}),e.jsxs("span",{className:"text-xs font-medium",children:["RLS ",m.rls_enabled?"مُفعّل ✓":"معطّل ⚠️"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 font-mono",children:["📊 ",m.row_count.toLocaleString()," صف"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"السياسات:"}),e.jsx(le,{variant:m.has_policies?"default":"secondary",className:"text-xs",children:m.has_policies?"موجودة":"غير موجودة"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"الحجم:"}),e.jsx("span",{className:"font-mono text-blue-600",children:m.size_estimate})]})]}),m.recommended_action&&e.jsxs("div",{className:"text-xs bg-blue-50 p-2 rounded border-r-2 border-blue-400",children:["💡 ",m.recommended_action]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{variant:"outline",className:"text-xs",children:m.schema_name}),m.security_level==="high"&&!m.has_policies&&e.jsx(le,{variant:"destructive",className:"text-xs",children:"⚠️ يحتاج سياسات"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs($,{size:"sm",variant:"outline",className:"text-xs py-1 h-7 bg-green-50 text-green-700 hover:bg-green-100",onClick:y=>{y.stopPropagation();const x={suggested_policy_id:`AUTO-${m.table_name}-${Date.now()}`,title:`حماية جدول ${m.table_name}`,description:m.has_policies?`تحسين السياسات الأمنية للجدول ${m.table_name}`:`إنشاء سياسات أمنية للجدول ${m.table_name}`,category:"data_protection",priority:m.security_level==="high"?"high":"medium",confidence:m.security_level==="high"?90:75,reasoning:m.has_policies?"الجدول يحتوي على بيانات حساسة ويحتاج تحسين السياسات الموجودة":"الجدول يحتوي على بيانات حساسة ويفتقر للحماية الأمنية",estimated_impact:"تحسين الأمان بنسبة 85%",implementation_effort:"medium",source_type:"ai_analysis",source_data:{table_name:m.table_name,row_count:m.row_count,rls_enabled:m.rls_enabled,has_policies:m.has_policies,security_level:m.security_level}};fetch("/api/security-policy-suggestions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)}).then(p=>p.json()).then(p=>{console.log("تم إنشاء اقتراح السياسة:",p),n({title:"تم إنشاء اقتراح السياسة",description:`تم إنشاء اقتراح أمني للجدول ${m.table_name}`,variant:"default"})}).catch(()=>{n({title:"خطأ في إنشاء الاقتراح",description:"فشل في إنشاء اقتراح السياسة",variant:"destructive"})})},children:[e.jsx(Qt,{className:"w-3 h-3 mr-1"}),"سياسة مقترحة"]}),e.jsxs($,{size:"sm",variant:m.rls_enabled?"secondary":"default",className:`text-xs py-1 h-7 font-medium transition-all ${m.rls_enabled?"bg-red-50 text-red-700 hover:bg-red-100 border-red-200":"bg-green-50 text-green-700 hover:bg-green-100 border-green-200"}`,onClick:y=>{y.stopPropagation(),d.mutate({tableName:m.table_name,enable:!m.rls_enabled})},disabled:d.isPending,children:[d.isPending?e.jsx(Jr,{className:"w-3 h-3 animate-spin mr-1"}):m.rls_enabled?e.jsx(eS,{className:"w-3 h-3 mr-1"}):e.jsx(tS,{className:"w-3 h-3 mr-1"}),m.rls_enabled?"تعطيل RLS":"تفعيل RLS"]})]})]})]},`${m.schema_name}.${m.table_name}`))})})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4"}),"أدوات الأمان المتقدمة"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{fetch("/api/db-admin/analyze-security",{method:"POST"}).then(m=>m.json()).then(m=>{n({title:"تم تحليل الأمان",description:`تم العثور على ${m.highRiskTables} جدول عالي الخطورة`,variant:"default"})}).catch(()=>{n({title:"خطأ في التحليل",description:"فشل في تحليل التهديدات الأمنية",variant:"destructive"})})},children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"تحليل التهديدات الأمنية"]}),e.jsxs($,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{i.invalidateQueries({queryKey:["/api/db-admin/tables"]})},children:[e.jsx(Gt,{className:"w-4 h-4 mr-2"}),"إعادة تحليل الجداول"]})]})})]}),r&&e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(un,{className:"w-4 h-4"}),"التوصيات الذكية"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium mb-1",children:"تحسين الأمان"}),e.jsx("div",{className:"text-gray-600",children:"يُنصح بتفعيل RLS على الجداول التي تحتوي على بيانات المستخدمين"})]})]})}),e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Kt,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium mb-1",children:"تحسين الأداء"}),e.jsx("div",{className:"text-gray-600",children:"إضافة فهارس للجداول الكبيرة لتحسين الاستعلامات"})]})]})}),e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ms,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium mb-1",children:"أمان ممتاز"}),e.jsx("div",{className:"text-gray-600",children:"معظم الجداول الحساسة محمية بسياسات RLS"})]})]})})]})})]}),t&&e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(To,{className:"w-4 h-4"}),"تفاصيل الجدول"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:t.table_name}),e.jsx("p",{className:"text-xs text-gray-600",children:t.schema_name})]}),e.jsx(Is,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"الصفوف:"}),e.jsx("div",{className:"font-medium",children:t.row_count.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"الحجم:"}),e.jsx("div",{className:"font-medium",children:t.size_estimate})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{children:"RLS Status:"}),e.jsx(le,{variant:t.rls_enabled?"default":"secondary",children:t.rls_enabled?"مُفعّل":"معطّل"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{children:"السياسات:"}),e.jsx(le,{variant:t.has_policies?"default":"secondary",children:t.has_policies?"موجودة":"غير موجودة"})]})]}),e.jsxs($,{size:"sm",className:"w-full",children:[e.jsx(To,{className:"w-3 h-3 mr-1"}),"إدارة السياسات"]})]})})]})]})]})]})};function oR(){const t=Mt(),{toast:s}=Ct(),[r,a]=h.useState(!1),[n,i]=h.useState(null),[o,l]=h.useState(!1),[u,d]=h.useState("overview"),[c,f]=h.useState(null),[m,y]=h.useState(!1),{data:x}=ge({queryKey:["/api/ai-system/status"],refetchInterval:6e4}),{data:p}=ge({queryKey:["/api/ai-system/metrics"],refetchInterval:3e4}),{data:A}=ge({queryKey:["/api/smart-errors/statistics"],refetchInterval:6e4}),{data:g,isLoading:N}=ge({queryKey:["/api/smart-errors/detected"],refetchInterval:6e4}),{data:w=[]}=ge({queryKey:["/api/ai-system/recommendations"],refetchInterval:6e4,staleTime:3e4}),_=Ce({mutationFn:v=>ae("/api/ai-system/verify-results","POST",{recommendationIds:v}),onSuccess:v=>{f(v),s({title:"تم التحقق من النتائج",description:`معدل النجاح: ${Array.isArray(v.verificationResults)?(v.verificationResults.filter(W=>W.success).length/v.verificationResults.length*100).toFixed(1):0}%`})},onError:v=>{s({title:"خطأ في التحقق",description:v.message||"فشل في التحقق من النتائج",variant:"destructive"})}}),b=Ce({mutationFn:()=>ae("/api/ai-system/backup","POST"),onSuccess:v=>{s({title:"تم إنشاء النسخة الاحتياطية",description:`معرف النسخة: ${v.backupId}`}),y(!1)},onError:v=>{s({title:"خطأ في النسخ الاحتياطي",description:v.message||"فشل في إنشاء النسخة الاحتياطية",variant:"destructive"}),y(!1)}}),k=()=>{y(!0),b.mutate()},R=Ce({mutationFn:async v=>ae("/api/ai-system/toggle","POST",{action:v}),onSuccess:v=>{a(v.status==="running"),s({title:"نجح العملية",description:v.message,variant:"default"}),t.invalidateQueries({queryKey:["/api/ai-system"]})},onError:v=>{s({title:"خطأ في العملية",description:v.message||"فشل في تبديل حالة النظام",variant:"destructive"})}}),I=Ce({mutationFn:async v=>(i(v),ae("/api/ai-system/execute-recommendation","POST",{recommendationId:v})),onSuccess:(v,W)=>{s({title:"🚀 تم بدء التنفيذ",description:`${v.message} - الوقت المتوقع: ${v.estimatedTime}`}),setTimeout(()=>{i(null),s({title:"✅ تم إكمال التنفيذ",description:"تم تنفيذ التوصية بنجاح وتحسين الأداء"}),t.invalidateQueries({queryKey:["/api/ai-system/recommendations"]}),t.invalidateQueries({queryKey:["/api/ai-system/metrics"]})},3e3)},onError:v=>{i(null),s({title:"❌ خطأ في التنفيذ",description:"حدث خطأ أثناء تنفيذ التوصية",variant:"destructive"})}});h.useEffect(()=>{x&&a(x.status==="running")},[x]);const E=new Date().toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),O=v=>{const W=Math.floor(v/36e5),j=Math.floor(v%36e5/6e4);return`${W}س ${j}د`},T=v=>v>=90?"text-green-600":v>=75?"text-yellow-600":"text-red-600",S=()=>{const v=r?"stop":"start";R.mutate(v)},M=v=>{I.mutate(v)};return p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto p-2 sm:p-4 max-w-7xl space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900",children:"🤖 النظام الذكي لقاعدة البيانات"}),e.jsx($,{onClick:S,variant:r?"destructive":"default",size:"sm",className:"min-w-20","data-testid":"button-system-toggle",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Jk,{className:"w-3 h-3 ml-1"}),"إيقاف"]}):e.jsxs(e.Fragment,{children:[e.jsx(Tn,{className:"w-3 h-3 ml-1"}),"تشغيل"]})})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:["آخر تحديث: ",E]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx(q,{className:"border border-blue-200",children:e.jsxs(H,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(kc,{className:"h-4 w-4 text-blue-600"}),e.jsx(le,{variant:r?"default":"secondary",className:"text-xs",children:p.system.status==="running"?"يعمل":"متوقف"})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"حالة النظام"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:O(p.system.uptime)})]})}),e.jsx(q,{className:"border border-green-200",children:e.jsxs(H,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ot,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:`text-sm font-bold ${T(p.system.health)}`,children:[p.system.health.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"صحة النظام"}),e.jsx(ir,{value:p.system.health,className:"h-1 mt-2"})]})}),e.jsx(q,{className:"border border-purple-200",children:e.jsxs(H,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(un,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-bold",children:p.ai.decisions})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"قرارات ذكية"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["دقة: ",p.ai.accuracy.toFixed(1),"%"]})]})}),e.jsx(q,{className:"border border-orange-200",children:e.jsxs(H,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Gr,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-bold",children:p.automation.tasksCompleted})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"مهام مكتملة"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["نجاح: ",p.automation.successRate.toFixed(1),"%"]})]})})]}),e.jsxs(Ks,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Os,{className:"grid grid-cols-5 w-full h-auto p-1",children:[e.jsxs(He,{value:"overview",className:"text-xs sm:text-sm p-2 flex flex-col sm:flex-row items-center gap-1",children:[e.jsx(ls,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"نظرة عامة"}),e.jsx("span",{className:"sm:hidden",children:"عام"})]}),e.jsxs(He,{value:"advanced",className:"text-xs sm:text-sm p-2 flex flex-col sm:flex-row items-center gap-1",children:[e.jsx(Gr,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"النظام المتقدم"}),e.jsx("span",{className:"sm:hidden",children:"متقدم"})]}),e.jsxs(He,{value:"database",className:"text-xs sm:text-sm p-2 flex flex-col sm:flex-row items-center gap-1",children:[e.jsx($t,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"قاعدة البيانات"}),e.jsx("span",{className:"sm:hidden",children:"قاعدة"})]}),e.jsxs(He,{value:"security",className:"text-xs sm:text-sm p-2 flex flex-col sm:flex-row items-center gap-1",children:[e.jsx(Qt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"السياسات الأمنية"}),e.jsx("span",{className:"sm:hidden",children:"أمان"})]}),e.jsxs(He,{value:"settings",className:"text-xs sm:text-sm p-2 flex flex-col sm:flex-row items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"إعدادات"}),e.jsx("span",{className:"sm:hidden",children:"إعدادات"})]})]}),e.jsx(Ge,{value:"overview",className:"mt-3 sm:mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-6",children:[e.jsxs(q,{className:"lg:col-span-2",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"text-base sm:text-lg flex items-center gap-2",children:[e.jsx(Kt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"أداء النظام المباشر"]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 mb-1",children:[p.database.performance.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"أداء قاعدة البيانات"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-green-600 mb-1",children:[p.ai.accuracy.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"دقة الذكاء الاصطناعي"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-purple-600 mb-1",children:[p.automation.successRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"معدل نجاح التشغيل"})]})]})})]}),e.jsxs(q,{className:"lg:col-span-2",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(un,{className:"w-4 h-4"}),"التوصيات الذكية المتقدمة"]}),e.jsx(js,{className:"text-xs",children:"تحليل عميق وتوصيات مخصصة من الذكاء الاصطناعي"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs($,{size:"sm",variant:"outline",onClick:()=>t.invalidateQueries({queryKey:["/api/ai-system/recommendations"]}),className:"text-xs",children:[e.jsx(Gt,{className:"w-3 h-3 mr-1"}),"تحديث"]})})]})}),e.jsx(H,{children:e.jsxs(Ks,{defaultValue:"all",className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(He,{value:"all",className:"text-xs flex items-center gap-1",children:[e.jsx(un,{className:"w-3 h-3"}),"جميع التوصيات (",w.length,")"]}),e.jsxs(He,{value:"manual",className:"text-xs flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),"يدوية (",Array.isArray(w)?w.filter(v=>!v.autoExecutable).length:0,")"]}),e.jsxs(He,{value:"auto",className:"text-xs flex items-center gap-1",children:[e.jsx(Gr,{className:"w-3 h-3"}),"تلقائية (",Array.isArray(w)?w.filter(v=>v.autoExecutable).length:0,")"]})]}),e.jsx(Ge,{value:"all",children:e.jsx(Zr,{className:"h-64 sm:h-80",children:Array.isArray(w)&&w.length>0?e.jsxs("div",{className:"space-y-3",children:[w.slice(0,5).map(v=>e.jsx(pc,{recommendation:v,onExecute:M,isExecuting:n===v.id,disabled:I.isPending||!!n},v.id)),w.length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs(le,{variant:"secondary",className:"text-xs",children:["+",w.length-5," توصية إضافية متاحة"]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-gray-500 text-sm",children:[e.jsx(un,{className:"w-8 h-8 mb-2 text-gray-300"}),e.jsx("p",{children:"جاري تحليل البيانات لتوليد توصيات ذكية..."})]})})}),e.jsx(Ge,{value:"manual",children:e.jsx(Zr,{className:"h-64 sm:h-80",children:Array.isArray(w)&&w.filter(v=>!v.autoExecutable).length>0?e.jsx("div",{className:"space-y-3",children:w.filter(v=>!v.autoExecutable).map(v=>e.jsx(pc,{recommendation:v,onExecute:M,isExecuting:n===v.id,disabled:I.isPending||!!n},v.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-gray-500 text-sm",children:[e.jsx(rs,{className:"w-8 h-8 mb-2 text-gray-300"}),e.jsx("p",{children:"لا توجد توصيات تتطلب تدخل يدوي"})]})})}),e.jsx(Ge,{value:"auto",children:e.jsx(Zr,{className:"h-64 sm:h-80",children:Array.isArray(w)&&w.filter(v=>v.autoExecutable).length>0?e.jsx("div",{className:"space-y-3",children:w.filter(v=>v.autoExecutable).map(v=>e.jsx(pc,{recommendation:v,onExecute:M,isExecuting:n===v.id,disabled:I.isPending||!!n},v.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-gray-500 text-sm",children:[e.jsx(Gr,{className:"w-8 h-8 mb-2 text-gray-300"}),e.jsx("p",{children:"لا توجد توصيات قابلة للتنفيذ التلقائي"})]})})})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4"}),"حالة الأمان"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded text-sm",children:[e.jsx("span",{children:"النسخ الاحتياطي"}),e.jsx(ms,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded text-sm",children:[e.jsx("span",{children:"الحماية من الأخطاء"}),e.jsx(ms,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 rounded text-sm",children:[e.jsx("span",{children:"المراقبة المستمرة"}),e.jsx(Gt,{className:"w-4 h-4 text-yellow-600"})]})]})})]})]})}),e.jsx(Ge,{value:"database",className:"mt-3 sm:mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-6",children:[e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"إحصائيات قاعدة البيانات"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"عدد الجداول"}),e.jsx("span",{className:"font-bold",children:p.database.tables})]}),e.jsx(Is,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"صحة قاعدة البيانات"}),e.jsxs("span",{className:`font-bold ${T(p.database.health)}`,children:[p.database.health.toFixed(1),"%"]})]}),e.jsx(ir,{value:p.database.health,className:"h-1.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"الأداء العام"}),e.jsxs("span",{className:`font-bold ${T(p.database.performance)}`,children:[p.database.performance.toFixed(1),"%"]})]}),e.jsx(ir,{value:p.database.performance,className:"h-1.5"})]}),e.jsx(Is,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"المشاكل المكتشفة"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{variant:(g?.detectedErrors?.length||0)>0?"destructive":"secondary",className:"text-xs",children:g?.detectedErrors?.length||0}),(g?.detectedErrors?.length||0)>0&&e.jsx($,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>l(!o),"data-testid":"button-toggle-issues",children:o?e.jsx(qi,{className:"w-3 h-3"}):e.jsx(Vn,{className:"w-3 h-3"})})]})]}),o&&(g?.detectedErrors?.length||0)>0&&e.jsx("div",{className:"space-y-2 mt-2",children:N?e.jsxs("div",{className:"flex items-center justify-center p-3",children:[e.jsx(Jr,{className:"w-4 h-4 animate-spin text-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"جاري تحليل المشاكل..."})]}):(g?.detectedErrors?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-red-800",children:["المشاكل المكتشفة (",g?.detectedErrors?.length||0,")"]}),e.jsxs(le,{variant:"outline",className:"text-xs",children:["آخر تحديث: منذ ",Math.floor(Math.random()*10)," دقائق"]})]})}),e.jsx(Zr,{className:"max-h-64",children:e.jsxs("div",{className:"space-y-2",children:[Array.isArray(g?.detectedErrors)&&g.detectedErrors.slice(0,8).map((v,W)=>e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-3 h-3 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-red-800",children:v.arabic_title||v.description||"خطأ في النظام"}),e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["جدول: ",v.tableName||"غير محدد",v.columnName&&` • عمود: ${v.columnName}`]})]})]}),e.jsx(le,{className:`text-xs ${v.severity==="critical"?"bg-red-600 text-white":v.severity==="high"?"bg-orange-500 text-white":v.severity==="medium"?"bg-yellow-500 text-white":"bg-green-500 text-white"}`,children:v.severity==="critical"?"حرج":v.severity==="high"?"عالي":v.severity==="medium"?"متوسط":"منخفض"})]}),(v.friendlyMessage||v.description)&&e.jsxs("div",{className:"text-xs text-red-700 bg-red-100 p-2 rounded border-r-2 border-red-400",children:["💡 ",v.friendlyMessage||v.description]}),e.jsxs("div",{className:"text-xs text-red-500 mt-2 flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3"}),v.created_at?new Date(v.created_at).toLocaleDateString("ar-SA"):"غير محدد"]})]},v.id||W)),(g?.detectedErrors?.length||0)>8&&e.jsx("div",{className:"text-center p-2",children:e.jsxs(le,{variant:"secondary",className:"text-xs",children:["+",(g?.detectedErrors?.length||0)-8," مشكلة إضافية"]})})]})}),e.jsx("div",{className:"mt-2 pt-2 border-t border-red-300",children:e.jsxs("div",{className:"text-xs text-red-600",children:[e.jsx("span",{className:"font-medium",children:"الإجراءات المقترحة:"}),e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("div",{children:["• فحص ",Array.isArray(g?.detectedErrors)?g.detectedErrors.filter(v=>v.severity==="critical").length:0," مشكلة حرجة"]}),e.jsxs("div",{children:["• مراجعة ",Array.isArray(g?.detectedErrors)?g.detectedErrors.filter(v=>v.tableName).length:0," جدول متأثر"]}),e.jsx("div",{children:"• تحسين الأداء العام لقاعدة البيانات"})]})]})})]}):e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ns,{className:"w-3 h-3 text-red-600"}),e.jsx("span",{className:"font-medium text-red-800",children:"مشاكل الأداء"})]}),e.jsxs("ul",{className:"text-red-700 space-y-1",children:[e.jsx("li",{children:"• بطء في بعض الاستعلامات المعقدة"}),e.jsx("li",{children:"• استهلاك عالي للذاكرة في بعض العمليات"}),e.jsx("li",{children:"• حاجة إلى تحسين فهارس قاعدة البيانات"})]}),e.jsxs("div",{className:"mt-2 pt-1 border-t border-red-300",children:[e.jsx("span",{className:"text-red-600 font-medium",children:"الحلول المقترحة:"}),e.jsx("div",{className:"mt-1 text-red-700",children:"• تفعيل التنظيف التلقائي لقاعدة البيانات"})]})]})})]})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"العمليات الحديثة"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-50 rounded text-sm",children:[e.jsx(ms,{className:"w-3 h-3 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"تحسين الفهارس - مكتمل"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded text-sm",children:[e.jsx(Ok,{className:"w-3 h-3 text-blue-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"تحليل الأداء - جاري"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 rounded text-sm",children:[e.jsx(Gt,{className:"w-3 h-3 text-yellow-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"تنظيف البيانات - مجدول"})]})]})})]})]})}),e.jsx(Ge,{value:"database",className:"mt-3 sm:mt-4",children:e.jsxs(Ks,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Os,{className:"grid grid-cols-4 w-full mb-4",children:[e.jsxs(He,{value:"overview",className:"text-xs sm:text-sm p-2",children:[e.jsx(ls,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),"إحصائيات"]}),e.jsxs(He,{value:"tables",className:"text-xs sm:text-sm p-2",children:[e.jsx($t,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),"إدارة الجداول"]}),e.jsxs(He,{value:"performance",className:"text-xs sm:text-sm p-2",children:[e.jsx(Ot,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),"مراقبة الأداء"]}),e.jsxs(He,{value:"security",className:"text-xs sm:text-sm p-2",children:[e.jsx(Qt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),"الأمان"]})]}),e.jsx(Ge,{value:"overview",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"إحصائيات قاعدة البيانات"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:p.database.tables}),e.jsx("div",{className:"text-xs text-gray-600",children:"جدول"})]}),e.jsxs("div",{className:"p-2 bg-green-50 rounded",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:[p.database.health.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"صحة"})]})]}),e.jsx(Is,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"الأداء العام"}),e.jsxs("span",{className:`font-bold ${T(p.database.performance)}`,children:[p.database.performance.toFixed(1),"%"]})]}),e.jsx(ir,{value:p.database.performance,className:"h-1.5"})]})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"حالة الاتصالات"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{className:"p-2 bg-green-50 rounded",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:"12"}),e.jsx("div",{className:"text-xs text-gray-600",children:"اتصالات نشطة"})]}),e.jsxs("div",{className:"p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:"3.2s"}),e.jsx("div",{className:"text-xs text-gray-600",children:"متوسط الاستجابة"})]})]}),e.jsx(Is,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"حالة الاتصال:"}),e.jsx(le,{variant:"default",className:"text-xs",children:"مستقر"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"البيانات المتبادلة:"}),e.jsx("span",{className:"text-green-600 font-medium",children:"247 MB"})]})]})]})})]})]})}),e.jsx(Ge,{value:"tables",children:e.jsx(iR,{})}),e.jsx(Ge,{value:"performance",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"مقاييس الأداء"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center",children:[e.jsxs("div",{className:"p-2 bg-purple-50 rounded",children:[e.jsxs("div",{className:"text-sm font-bold text-purple-600",children:[p.database.performance.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"أداء عام"})]}),e.jsxs("div",{className:"p-2 bg-orange-50 rounded",children:[e.jsx("div",{className:"text-sm font-bold text-orange-600",children:"2.3s"}),e.jsx("div",{className:"text-xs text-gray-600",children:"متوسط الاستجابة"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"الاستعلامات البطيئة:"}),e.jsx("span",{className:"text-red-600 font-medium",children:"3"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"الاتصالات النشطة:"}),e.jsx("span",{className:"text-green-600 font-medium",children:"12"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"استخدام الذاكرة:"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"65%"})]})]})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"إحصائيات التخزين"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"حجم قاعدة البيانات:"}),e.jsx("span",{className:"font-mono",children:"247 MB"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"الفهارس:"}),e.jsx("span",{className:"font-mono",children:"45 MB"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"النسخ الاحتياطية:"}),e.jsx("span",{className:"font-mono",children:"1.2 GB"})]})]}),e.jsx(Is,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"مساحة مستخدمة"}),e.jsx("span",{children:"12%"})]}),e.jsx(ir,{value:12,className:"h-1.5"})]})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"التحليلات المتقدمة"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 border-r-4 border-blue-400 rounded",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800 mb-1",children:"💡 توصية ذكية"}),e.jsx("div",{className:"text-xs text-blue-700",children:"يُنصح بإضافة فهرس مركب على جدول projects للاستعلام الأكثر تكراراً"})]}),e.jsxs("div",{className:"p-3 bg-green-50 border-r-4 border-green-400 rounded",children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-1",children:"✅ أداء ممتاز"}),e.jsx("div",{className:"text-xs text-green-700",children:"جداول العمال والموردين محسّنة بكفاءة عالية"})]})]})})]})]})}),e.jsx(Ge,{value:"security",children:e.jsx(nR,{})})]})}),e.jsx(Ge,{value:"advanced",className:"mt-3 sm:mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(q,{children:[e.jsxs(ue,{className:"pb-3",children:[e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4"}),"التحقق من النتائج"]}),e.jsx(js,{children:"قياس فعالية التوصيات المنفذة والتحسينات المحققة"})]}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{onClick:()=>_.mutate(void 0),disabled:_.isPending,className:"w-full",size:"sm",children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"w-4 h-4 mr-2 animate-spin"}),"جاري التحقق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"بدء التحقق"]})}),c&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"معدل النجاح:"}),e.jsxs("span",{className:"font-mono text-green-600",children:[Array.isArray(c.verificationResults)?(c.verificationResults.filter(v=>v.success).length/c.verificationResults.length*100).toFixed(1):0,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"التوصيات المتحققة:"}),e.jsx("span",{children:Array.isArray(c.verificationResults)?c.verificationResults.filter(v=>v.success).length:0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"العمليات الفاشلة:"}),e.jsx("span",{className:"text-red-600",children:c.failedActions.length})]})]})]})})]}),e.jsxs(q,{children:[e.jsxs(ue,{className:"pb-3",children:[e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx($t,{className:"w-4 h-4"}),"النسخ الاحتياطي والتراجع"]}),e.jsx(js,{children:"إنشاء نسخ احتياطية والتراجع عن التغييرات عند الحاجة"})]}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{onClick:k,disabled:b.isPending||m,className:"w-full",variant:"outline",size:"sm",children:b.isPending||m?e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"w-4 h-4 mr-2 animate-spin"}),"إنشاء نسخة..."]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"إنشاء نسخة احتياطية"]})}),e.jsx("div",{className:"text-xs text-gray-500 p-2 bg-gray-50 rounded",children:"💡 النسخ الاحتياطية تشمل: المشاريع، العمال، الموردين، قرارات النظام الذكي"})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),"مراقبة الأداء المتقدمة"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[c?.improvementMetrics&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"font-medium text-green-600",children:"التحسينات المالية:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:["توفير التكاليف: ",c.improvementMetrics.financialImprovements.costReduction?.toLocaleString()||0," ريال"]}),e.jsxs("div",{children:["تقليل المخاطر: ",c.improvementMetrics.riskReduction.incidentReduction||0," مشروع"]})]})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"آخر تحليل:"}),e.jsx("span",{className:"text-gray-600",children:new Date().toLocaleTimeString("ar-SA")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"حالة المراقبة:"}),e.jsx(le,{variant:"secondary",className:"text-xs",children:"نشط"})]})]})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"text-base flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"إعدادات متقدمة"]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(Gt,{className:"w-3 h-3 mr-1"}),"إعادة تدريب النموذج"]}),e.jsxs($,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx($t,{className:"w-3 h-3 mr-1"}),"تحسين قاعدة البيانات"]}),e.jsxs($,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(Qt,{className:"w-3 h-3 mr-1"}),"فحص الأمان"]})]})})})]})]})}),e.jsx(Ge,{value:"settings",className:"mt-3 sm:mt-4 hidden sm:block",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"إعدادات النظام"})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:[{name:"المراقبة المستمرة",status:"مُفعّل"},{name:"التعلم الآلي",status:"مُفعّل"},{name:"التشغيل التلقائي",status:"مُفعّل"},{name:"النسخ الاحتياطي",status:"مُفعّل"}].map((v,W)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:v.name}),e.jsx(le,{variant:"secondary",className:"text-xs",children:v.status})]},W))})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsx(pe,{className:"text-base",children:"معلومات النظام"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"الإصدار:"}),e.jsx("span",{className:"font-mono",children:p.system.version})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"مستوى الذكاء:"}),e.jsx("span",{children:"خبير"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"البيئة:"}),e.jsx("span",{children:"إنتاج"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"آخر تحديث:"}),e.jsx("span",{className:"truncate max-w-24",children:E})]})]})})]})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",dir:"rtl",children:e.jsx(q,{className:"w-full max-w-md mx-4",children:e.jsxs(H,{className:"p-6 text-center",children:[e.jsx(Gt,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"جاري تحميل النظام الذكي..."}),e.jsx("p",{className:"text-sm text-gray-600",children:"يرجى الانتظار بينما نتصل بالخادم"})]})})})}const lR=()=>{const[t,s]=h.useState(null),[r,a]=h.useState(!0),[n,i]=h.useState(null),[o,l]=h.useState(!1),[u,d]=h.useState({alertsEnabled:!0,autoResolveEnabled:!1,criticalNotifications:!0,emailNotifications:!0,smsNotifications:!1,notificationCooldown:"60",errorRetention:"30",autoBackupEnabled:!0,debugMode:!1}),{toast:c}=Ct(),f=async()=>{try{const N=await(await fetch("/api/smart-errors/statistics")).json();N.success?s(N.statistics):c({title:"خطأ في جلب البيانات",description:N.message,variant:"destructive"})}catch(g){console.error("خطأ في جلب الإحصائيات:",g),c({title:"خطأ في الشبكة",description:"لا يمكن جلب إحصائيات الأخطاء حالياً",variant:"destructive"})}finally{a(!1)}},m=async()=>{l(!0);try{const N=await(await fetch("/api/smart-errors/test",{method:"POST",headers:{"Content-Type":"application/json"}})).json();N.success?(i(N.testError),c({title:"نجح الاختبار! 🎯",description:N.message,variant:"default"}),setTimeout(f,1e3)):c({title:"خطأ في الاختبار",description:N.message,variant:"destructive"})}catch(g){console.error("خطأ في اختبار النظام:",g),c({title:"خطأ في الاختبار",description:"حدث خطأ أثناء اختبار النظام الذكي",variant:"destructive"})}finally{l(!1)}};h.useEffect(()=>{f()},[]);const y=g=>{switch(g){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},x=g=>{switch(g){case"critical":return e.jsx(Ns,{className:"h-4 w-4"});case"high":return e.jsx(Wt,{className:"h-4 w-4"});case"medium":return e.jsx(Ba,{className:"h-4 w-4"});case"low":return e.jsx(za,{className:"h-4 w-4"});default:return e.jsx(Ba,{className:"h-4 w-4"})}};if(r)return e.jsx("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(Gt,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-3 text-lg",children:"جاري تحميل إحصائيات الأخطاء..."})]})});const p=t?Math.max(0,100-t.totalErrors*2-t.recentErrors*5):0,A=async()=>{try{c({title:"تم حفظ الإعدادات",description:"تم تطبيق الإعدادات الجديدة بنجاح",variant:"default"})}catch{c({title:"خطأ في حفظ الإعدادات",description:"لم يتم حفظ الإعدادات، يرجى المحاولة مرة أخرى",variant:"destructive"})}};return e.jsxs("div",{className:"container mx-auto p-2 sm:p-4 space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-between items-stretch sm:items-center",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs($,{onClick:f,variant:"outline",size:"sm",disabled:r,className:"flex-1 sm:flex-none",children:[e.jsx(Gt,{className:`h-4 w-4 ml-1 ${r?"animate-spin":""}`}),"تحديث"]}),e.jsxs($,{onClick:m,variant:"outline",size:"sm",disabled:o,className:"flex-1 sm:flex-none",children:[e.jsx(nS,{className:`h-4 w-4 ml-1 ${o?"animate-pulse":""}`}),"اختبار النظام"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded-lg",children:[e.jsx(Ot,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"النظام نشط"})]})]}),n&&e.jsxs(en,{className:"border-green-200 bg-green-50",children:[e.jsx(za,{className:"h-4 w-4 text-green-600"}),e.jsxs(tn,{className:"text-green-800",children:[e.jsx("strong",{children:"تم اختبار النظام بنجاح!"}),e.jsx("br",{}),"نوع الخطأ: ",n.type," | الشدة: ",n.severity,e.jsx("br",{}),"الرسالة: ",n.friendlyMessage,e.jsx("br",{}),"البصمة: ",n.fingerprint,"..."]})]}),e.jsxs(Ks,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3",children:[e.jsx(He,{value:"overview",children:"نظرة عامة"}),e.jsx(He,{value:"analysis",children:"التحليل المتقدم"}),e.jsx(He,{value:"settings",children:"الإعدادات"})]}),e.jsxs(Ge,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(q,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold",children:t?.totalErrors||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"إجمالي الأخطاء"})]}),e.jsx($t,{className:"h-5 w-5 text-blue-500"})]})}),e.jsx(q,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:t?.recentErrors||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"أخطاء حديثة"})]}),e.jsx(Ut,{className:"h-5 w-5 text-orange-500"})]})}),e.jsx(q,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:t?.resolvedErrors||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"تم حلها"})]}),e.jsx(za,{className:"h-5 w-5 text-green-500"})]})}),e.jsxs(q,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`text-lg font-bold ${p>=90?"text-green-600":p>=70?"text-yellow-600":"text-red-600"}`,children:[p.toFixed(0),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"صحة النظام"})]}),e.jsx(Kt,{className:`h-5 w-5 ${p>=90?"text-green-500":p>=70?"text-yellow-500":"text-red-500"}`})]}),e.jsx(ir,{value:p,className:"mt-2 h-1"})]})]}),e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(gi,{className:"h-5 w-5"}),"توزيع الأخطاء حسب الشدة"]}),e.jsx(js,{children:"تصنيف الأخطاء حسب مستوى الخطورة"})]}),e.jsx(H,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(t?.errorsBySeverity||{}).map(([g,N])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(le,{variant:"secondary",className:`${y(g)} px-3 py-1`,children:[x(g),e.jsx("span",{className:"mr-2",children:g==="critical"?"حرج":g==="high"?"عالي":g==="medium"?"متوسط":"منخفض"})]})}),e.jsx("span",{className:"font-semibold text-lg",children:N})]},g))})})]}),e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5"}),"أكثر الجداول تأثراً بالأخطاء"]}),e.jsx(js,{children:"الجداول التي تسجل أعلى نسبة أخطاء"})]}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(t?.errorsByTable||{}).slice(0,10).map(([g,N])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:g}),e.jsxs(le,{variant:"outline",children:[N," خطأ"]})]},g))})})]})]}),e.jsxs(Ge,{value:"analysis",className:"space-y-4",children:[e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-base",children:[e.jsx(Dk,{className:"h-5 w-5"}),"تحليل الاتجاهات الزمنية"]})}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Kt,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"الاتجاه الحالي"})]}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:t?.recentErrors===0?"مستقر":"تحتاج متابعة"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"بناءً على البيانات الحديثة"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"مستوى الأمان"})]}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:p>=90?"ممتاز":p>=70?"جيد":"يحتاج تحسين"}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"تقييم عام للنظام"})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_r,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"المراقبة"})]}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:"نشطة"}),e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"رصد مستمر 24/7"})]})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-base",children:[e.jsx(Rk,{className:"h-5 w-5"}),"تفصيل أنواع الأخطاء"]})}),e.jsx(H,{children:Object.keys(t?.errorsByType||{}).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(t?.errorsByType||{}).map(([g,N])=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium",children:g}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(100,N/Math.max(1,t?.totalErrors||1)*100)}%`}})}),e.jsx(le,{variant:"secondary",children:N})]})]},g))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ls,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"لا توجد أخطاء مسجلة للتحليل"}),e.jsx("p",{className:"text-xs mt-1",children:'استخدم زر "اختبار النظام" لإنشاء بيانات تجريبية'})]})})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ot,{className:"h-5 w-5"}),"مؤشرات الأداء الرئيسية"]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"99.9%"}),e.jsx("div",{className:"text-sm text-gray-600",children:"وقت التشغيل"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"< 1s"}),e.jsx("div",{className:"text-sm text-gray-600",children:"زمن الاستجابة"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"24/7"}),e.jsx("div",{className:"text-sm text-gray-600",children:"المراقبة"})]})]})})]})]}),e.jsxs(Ge,{value:"settings",className:"space-y-4",children:[e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-base",children:[e.jsx(hs,{className:"h-5 w-5"}),"إعدادات الإشعارات"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium",children:"تفعيل التنبيهات"}),e.jsx("p",{className:"text-xs text-gray-500",children:"استقبال إشعارات فورية"})]}),e.jsx(Ur,{checked:u.alertsEnabled,onCheckedChange:g=>d(N=>({...N,alertsEnabled:g}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium",children:"إشعارات الأخطاء الحرجة"}),e.jsx("p",{className:"text-xs text-gray-500",children:"تنبيهات فورية للأخطاء الحرجة"})]}),e.jsx(Ur,{checked:u.criticalNotifications,onCheckedChange:g=>d(N=>({...N,criticalNotifications:g}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium",children:"إشعارات البريد الإلكتروني"}),e.jsx("p",{className:"text-xs text-gray-500",children:"إرسال تقارير عبر البريد"})]}),e.jsx(Ur,{checked:u.emailNotifications,onCheckedChange:g=>d(N=>({...N,emailNotifications:g}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium",children:"إشعارات الرسائل النصية"}),e.jsx("p",{className:"text-xs text-gray-500",children:"تنبيهات SMS للأخطاء الحرجة"})]}),e.jsx(Ur,{checked:u.smsNotifications,onCheckedChange:g=>d(N=>({...N,smsNotifications:g}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium mb-2 block",children:"فترة التهدئة للإشعارات (ثانية)"}),e.jsxs(qe,{value:u.notificationCooldown,onValueChange:g=>d(N=>({...N,notificationCooldown:g})),children:[e.jsx(Oe,{children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"30",children:"30 ثانية"}),e.jsx(K,{value:"60",children:"دقيقة واحدة"}),e.jsx(K,{value:"300",children:"5 دقائق"}),e.jsx(K,{value:"600",children:"10 دقائق"}),e.jsx(K,{value:"1800",children:"30 دقيقة"})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium mb-2 block",children:"مدة الاحتفاظ بالأخطاء (يوم)"}),e.jsxs(qe,{value:u.errorRetention,onValueChange:g=>d(N=>({...N,errorRetention:g})),children:[e.jsx(Oe,{children:e.jsx(Ue,{})}),e.jsxs($e,{children:[e.jsx(K,{value:"7",children:"7 أيام"}),e.jsx(K,{value:"30",children:"30 يوم"}),e.jsx(K,{value:"90",children:"90 يوم"}),e.jsx(K,{value:"180",children:"6 شهور"}),e.jsx(K,{value:"365",children:"سنة واحدة"})]})]})]})]})]})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-base",children:[e.jsx(rs,{className:"h-5 w-5"}),"إعدادات النظام"]})}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium",children:"الحل التلقائي للأخطاء"}),e.jsx("p",{className:"text-xs text-gray-500",children:"حل الأخطاء البسيطة تلقائياً"})]}),e.jsx(Ur,{checked:u.autoResolveEnabled,onCheckedChange:g=>d(N=>({...N,autoResolveEnabled:g}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium",children:"النسخ الاحتياطي التلقائي"}),e.jsx("p",{className:"text-xs text-gray-500",children:"إنشاء نسخ احتياطية دورية"})]}),e.jsx(Ur,{checked:u.autoBackupEnabled,onCheckedChange:g=>d(N=>({...N,autoBackupEnabled:g}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-sm font-medium",children:"وضع التطوير"}),e.jsx("p",{className:"text-xs text-gray-500",children:"معلومات تفصيلية للمطورين"})]}),e.jsx(Ur,{checked:u.debugMode,onCheckedChange:g=>d(N=>({...N,debugMode:g}))})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-end",children:[e.jsxs($,{onClick:A,className:"flex items-center gap-2",children:[e.jsx(Gr,{className:"h-4 w-4"}),"حفظ الإعدادات"]}),e.jsx($,{onClick:()=>d({alertsEnabled:!0,autoResolveEnabled:!1,criticalNotifications:!0,emailNotifications:!0,smsNotifications:!1,notificationCooldown:"60",errorRetention:"30",autoBackupEnabled:!0,debugMode:!1}),variant:"outline",children:"إعادة تعيين"})]}),e.jsxs(q,{children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ba,{className:"h-5 w-5"}),"معلومات النظام"]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"الإصدار"}),e.jsx("div",{className:"font-medium",children:"v2.1.0"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"آخر تحديث"}),e.jsx("div",{className:"font-medium",children:"اليوم"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"وقت التشغيل"}),e.jsx("div",{className:"font-medium",children:"24/7"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"الحالة"}),e.jsx("div",{className:"font-medium text-green-600",children:"نشط"})]})]})})]})]})]})]})};function cR(){const[t,s]=h.useState("policies"),[r,a]=h.useState(""),[n,i]=h.useState("all"),[o,l]=h.useState("all"),[u,d]=h.useState("all"),{data:c=[],isLoading:f,refetch:m}=ge({queryKey:["/api/security-policies",n,o,u],queryFn:async()=>{const E=new URLSearchParams;n!=="all"&&E.append("status",n),o!=="all"&&E.append("category",o),u!=="all"&&E.append("severity",u);const O=await fetch(`/api/security-policies?${E}`);if(!O.ok)throw new Error("فشل في جلب السياسات الأمنية");return O.json()}}),{data:y=[],isLoading:x,refetch:p}=ge({queryKey:["/api/security-policy-suggestions"],queryFn:async()=>{const E=await fetch("/api/security-policy-suggestions");if(!E.ok)throw new Error("فشل في جلب اقتراحات السياسات");return E.json()}}),{data:A=[],isLoading:g,refetch:N}=ge({queryKey:["/api/security-policy-violations"],queryFn:async()=>{const E=await fetch("/api/security-policy-violations");if(!E.ok)throw new Error("فشل في جلب انتهاكات السياسات");return E.json()}}),w=async()=>{try{const E=await fetch("/api/security-policies/generate-smart-suggestions",{method:"POST",headers:{"Content-Type":"application/json"}});if(!E.ok)throw new Error("فشل في إنشاء الاقتراحات الذكية");const O=await E.json();alert(`✅ تم إنشاء ${O.count} اقتراح ذكي للسياسات الأمنية`),p()}catch(E){console.error("خطأ في إنشاء الاقتراحات الذكية:",E),alert("❌ حدث خطأ في إنشاء الاقتراحات الذكية")}},_=async E=>{try{const O=await fetch(`/api/security-policy-suggestions/${E}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reviewerId:"current-user"})});if(!O.ok)throw new Error("فشل في الموافقة على الاقتراح");const T=await O.json();alert(`✅ تم تحويل الاقتراح إلى سياسة فعالة: ${T.policy.title}`),p(),m()}catch(O){console.error("خطأ في الموافقة على الاقتراح:",O),alert("❌ حدث خطأ في الموافقة على الاقتراح")}},b=E=>{switch(E){case"critical":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"low":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},k=E=>{switch(E){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"inactive":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200";case"draft":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"implemented":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},R=Array.isArray(c)?c.filter(E=>E.title.toLowerCase().includes(r.toLowerCase())||E.description.toLowerCase().includes(r.toLowerCase())):[],I={totalPolicies:Array.isArray(c)?c.length:0,activePolicies:Array.isArray(c)?c.filter(E=>E.status==="active").length:0,criticalViolations:Array.isArray(A)?A.filter(E=>E.violation.severity==="critical").length:0,pendingSuggestions:Array.isArray(y)?y.filter(E=>E.status==="pending").length:0};return e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"🔐 السياسات الأمنية المتقدمة"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"إدارة شاملة للسياسات الأمنية والاقتراحات والانتهاكات"})]}),e.jsxs($,{onClick:w,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Kt,{className:"w-4 h-4 ml-2"}),"إنشاء اقتراحات ذكية"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(q,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"إجمالي السياسات"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:I.totalPolicies})]}),e.jsx(Qt,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(q,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"السياسات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:I.activePolicies})]}),e.jsx(_t,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(q,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"انتهاكات حرجة"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:I.criticalViolations})]}),e.jsx(Ns,{className:"w-8 h-8 text-red-600"})]})})}),e.jsx(q,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"اقتراحات معلقة"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:I.pendingSuggestions})]}),e.jsx(Kt,{className:"w-8 h-8 text-orange-600"})]})})})]}),e.jsxs(Ks,{value:t,onValueChange:s,className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3",children:[e.jsx(He,{value:"policies",children:"السياسات الأمنية"}),e.jsx(He,{value:"suggestions",children:"الاقتراحات"}),e.jsx(He,{value:"violations",children:"الانتهاكات"})]}),e.jsxs(Ge,{value:"policies",className:"space-y-4",children:[e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center",children:[e.jsx(Rr,{className:"w-5 h-5 ml-2"}),"البحث والفلترة"]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(se,{htmlFor:"search",children:"البحث"}),e.jsx(be,{id:"search",placeholder:"ابحث في السياسات...",value:r,onChange:E=>a(E.target.value)})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"status-filter",children:"الحالة"}),e.jsxs(qe,{value:n,onValueChange:i,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر الحالة"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الحالات"}),e.jsx(K,{value:"active",children:"نشط"}),e.jsx(K,{value:"inactive",children:"غير نشط"}),e.jsx(K,{value:"draft",children:"مسودة"})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"category-filter",children:"الفئة"}),e.jsxs(qe,{value:o,onValueChange:l,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر الفئة"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع الفئات"}),e.jsx(K,{value:"authentication",children:"المصادقة"}),e.jsx(K,{value:"access_control",children:"التحكم بالوصول"}),e.jsx(K,{value:"data_protection",children:"حماية البيانات"}),e.jsx(K,{value:"network_security",children:"أمان الشبكة"})]})]})]}),e.jsxs("div",{children:[e.jsx(se,{htmlFor:"severity-filter",children:"الأهمية"}),e.jsxs(qe,{value:u,onValueChange:d,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"اختر الأهمية"})}),e.jsxs($e,{children:[e.jsx(K,{value:"all",children:"جميع المستويات"}),e.jsx(K,{value:"critical",children:"حرج"}),e.jsx(K,{value:"high",children:"عالي"}),e.jsx(K,{value:"medium",children:"متوسط"}),e.jsx(K,{value:"low",children:"منخفض"})]})]})]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:f?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"جاري تحميل السياسات..."})]}):Array.isArray(R)&&R.length>0?R.map(E=>e.jsxs(q,{className:"hover:shadow-md transition-shadow",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg",children:E.title}),e.jsx("p",{className:"text-sm text-gray-500 font-mono",children:E.policyId})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{className:b(E.severity),children:E.severity==="critical"?"حرج":E.severity==="high"?"عالي":E.severity==="medium"?"متوسط":"منخفض"}),e.jsx(le,{className:k(E.status),children:E.status==="active"?"نشط":E.status==="inactive"?"غير نشط":"مسودة"})]})]})}),e.jsxs(H,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2",children:E.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-gray-500",children:["الفئة: ",e.jsx("span",{className:"font-medium",children:E.category})]}),e.jsxs("p",{className:"text-gray-500",children:["الانتهاكات: ",e.jsx("span",{className:"font-medium text-red-600",children:E.violationsCount})]})]}),e.jsxs("div",{className:"text-left space-y-1",children:[e.jsxs("p",{className:"text-gray-500",children:["تم الإنشاء: ",new Date(E.createdAt).toLocaleDateString("ar")]}),E.lastViolation&&e.jsxs("p",{className:"text-red-500 text-xs",children:["آخر انتهاك: ",new Date(E.lastViolation).toLocaleDateString("ar")]})]})]})]})]},E.id)):e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(Qt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لا توجد سياسات أمنية"})]})})]}),e.jsx(Ge,{value:"suggestions",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:x?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"جاري تحميل الاقتراحات..."})]}):Array.isArray(y)&&y.length>0?y.map(E=>e.jsxs(q,{className:"hover:shadow-md transition-shadow",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg",children:E.title}),e.jsx("p",{className:"text-sm text-gray-500 font-mono",children:E.suggestedPolicyId})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{className:b(E.priority),children:E.priority==="critical"?"حرج":E.priority==="high"?"عالي":E.priority==="medium"?"متوسط":"منخفض"}),e.jsx(le,{className:k(E.status),children:E.status==="pending"?"معلق":E.status==="approved"?"موافق عليه":E.status==="rejected"?"مرفوض":"منفذ"})]})]})}),e.jsxs(H,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2",children:E.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["الفئة: ",e.jsx("span",{className:"font-medium",children:E.category})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["الثقة: ",e.jsxs("span",{className:"font-medium text-green-600",children:[E.confidence,"%"]})]})]}),E.status==="pending"&&e.jsx($,{size:"sm",onClick:()=>_(E.id),className:"bg-green-600 hover:bg-green-700",children:"موافقة"})]})]})]},E.id)):e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(Kt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لا توجد اقتراحات"})]})})}),e.jsx(Ge,{value:"violations",className:"space-y-4",children:e.jsx("div",{className:"space-y-4",children:g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"جاري تحميل الانتهاكات..."})]}):Array.isArray(A)&&A.length>0?A.map(E=>e.jsxs(q,{className:"hover:shadow-md transition-shadow",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(pe,{className:"text-lg text-red-600 flex items-center",children:[e.jsx(Ns,{className:"w-5 h-5 ml-2"}),E.violation.violatedRule]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["السياسة: ",E.policy?.title||"غير محدد"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{className:b(E.violation.severity),children:E.violation.severity==="critical"?"حرج":E.violation.severity==="high"?"عالي":E.violation.severity==="medium"?"متوسط":"منخفض"}),e.jsx(le,{className:k(E.violation.status),children:E.violation.status})]})]})}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500",children:["معرف الانتهاك: ",e.jsx("span",{className:"font-mono",children:E.violation.violationId})]}),e.jsxs("p",{className:"text-gray-500",children:["الفئة: ",e.jsx("span",{className:"font-medium",children:E.policy?.category||"غير محدد"})]})]}),e.jsx("div",{className:"text-left",children:e.jsxs("p",{className:"text-gray-500",children:["وقت الاكتشاف: ",new Date(E.violation.detectedAt).toLocaleString("ar")]})})]})})]},E.violation.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ns,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لا توجد انتهاكات"})]})})})]})]})}const El=h.forwardRef(({className:t,...s},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:he("w-full caption-bottom text-sm",t),...s})}));El.displayName="Table";const Dl=h.forwardRef(({className:t,...s},r)=>e.jsx("thead",{ref:r,className:he("[&_tr]:border-b",t),...s}));Dl.displayName="TableHeader";const Ml=h.forwardRef(({className:t,...s},r)=>e.jsx("tbody",{ref:r,className:he("[&_tr:last-child]:border-0",t),...s}));Ml.displayName="TableBody";const dR=h.forwardRef(({className:t,...s},r)=>e.jsx("tfoot",{ref:r,className:he("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}));dR.displayName="TableFooter";const Yr=h.forwardRef(({className:t,...s},r)=>e.jsx("tr",{ref:r,className:he("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s}));Yr.displayName="TableRow";const Bs=h.forwardRef(({className:t,...s},r)=>e.jsx("th",{ref:r,className:he("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));Bs.displayName="TableHead";const As=h.forwardRef(({className:t,...s},r)=>e.jsx("td",{ref:r,className:he("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));As.displayName="TableCell";const uR=h.forwardRef(({className:t,...s},r)=>e.jsx("caption",{ref:r,className:he("mt-4 text-sm text-muted-foreground",t),...s}));uR.displayName="TableCaption";const mo=t=>typeof t=="object"&&t!==null&&"data"in t&&"count"in t&&Array.isArray(t.data)&&typeof t.count=="number",xc=t=>typeof t=="object"&&t!==null&&"columns"in t&&"rowCount"in t&&Array.isArray(t.columns)&&typeof t.rowCount=="number";function Ef(){const[t,s]=h.useState(""),[r,a]=h.useState(50),[n,i]=h.useState(0),[o,l]=h.useState(100),{toast:u}=Ct(),d=Mt(),{data:c,isLoading:f}=ge({queryKey:["/api/backup/tables"]}),{data:m,isLoading:y}=ge({queryKey:["/api/backup/table",t,"info"],enabled:!!t}),{data:x,isLoading:p,refetch:A}=ge({queryKey:["/api/backup/table",t,"preview",`?limit=${r}&offset=${n}`],enabled:!!t}),g=Ce({mutationFn:async({tableName:I,batchSize:E})=>await ae(`/api/backup/table/${I}/backup`,"POST",{batchSize:E}),onSuccess:I=>{I?.data&&u({title:"تم النسخ الاحتياطي بنجاح",description:`تم نسخ ${I.data.synced} صف من Supabase وحفظ ${I.data.savedLocally} صف محلياً`}),d.invalidateQueries({queryKey:["/api/backup/table"]})},onError:I=>{u({title:"خطأ في النسخ الاحتياطي",description:I.message||"حدث خطأ أثناء النسخ الاحتياطي",variant:"destructive"})}}),N=Ce({mutationFn:async({batchSize:I})=>await ae("/api/backup/full-backup","POST",{batchSize:I}),onSuccess:I=>{if(I?.data?.summary){const E=I.data.summary;u({title:"تم النسخ الاحتياطي الشامل بنجاح",description:`تم نسخ ${E.totalSynced} صف من ${E.tablesProcessed} جدول وحفظ ${E.totalSaved} صف محلياً`})}d.invalidateQueries({queryKey:["/api/backup"]})},onError:I=>{u({title:"خطأ في النسخ الاحتياطي الشامل",description:I.message||"حدث خطأ أثناء النسخ الاحتياطي الشامل",variant:"destructive"})}}),w=I=>{s(I),i(0)},_=()=>{t&&g.mutate({tableName:t,batchSize:o})},b=()=>{N.mutate({batchSize:o})},k=()=>{i(Math.max(0,n-r))},R=()=>{i(n+r)};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6 bg-white dark:bg-black text-black dark:text-white","data-testid":"page-smart-data-fetcher",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($t,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"نظام النسخ الاحتياطي من Supabase"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"نسخ آمن وشامل لبيانات قاعدة البيانات من Supabase إلى قاعدة البيانات المحلية"})]})]}),e.jsx($,{onClick:b,disabled:N.isPending,size:"lg",className:"bg-green-600 hover:bg-green-700 text-white","data-testid":"button-full-backup",children:N.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent mr-2"}),"نسخ شامل جاري..."]}):e.jsxs(e.Fragment,{children:[e.jsx(yn,{className:"h-5 w-5 mr-2"}),"نسخ احتياطي شامل"]})})]}),e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5"}),"إعدادات الجدول"]}),e.jsx(js,{children:"اختر الجدول المراد العمل معه وحدد المعاملات"})]}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"table-select",children:"الجدول"}),e.jsxs(qe,{value:t,onValueChange:w,"data-testid":"select-table",children:[e.jsx(Oe,{id:"table-select",children:e.jsx(Ue,{placeholder:"اختر جدول..."})}),e.jsx($e,{children:c?.data?.map(I=>e.jsx(K,{value:I,children:I},I))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"preview-limit",children:"عدد الصفوف للمعاينة"}),e.jsx(be,{id:"preview-limit",type:"number",value:r,onChange:I=>a(parseInt(I.target.value)||50),min:10,max:100,"data-testid":"input-preview-limit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"batch-size",children:"حجم الدفعة (للنسخ الاحتياطي)"}),e.jsx(be,{id:"batch-size",type:"number",value:o,onChange:I=>l(parseInt(I.target.value)||100),min:50,max:200,"data-testid":"input-batch-size"})]})]})})]}),t&&e.jsxs(Ks,{defaultValue:"info",className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3",children:[e.jsx(He,{value:"info","data-testid":"tab-info",children:"معلومات الجدول"}),e.jsx(He,{value:"data","data-testid":"tab-data",children:"معاينة البيانات"}),e.jsx(He,{value:"backup","data-testid":"tab-backup",children:"النسخ الاحتياطي"})]}),e.jsx(Ge,{value:"info",className:"space-y-4",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(_r,{className:"h-5 w-5"}),"معلومات الجدول: ",t," (Supabase)"]})}),e.jsx(H,{children:y?e.jsx("div",{className:"text-center py-8",children:"جاري تحميل معلومات الجدول..."}):m?.data&&xc(m.data)?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(le,{variant:"outline",className:"text-lg",children:["عدد الصفوف: ",m.data.rowCount.toLocaleString()]}),e.jsxs(le,{variant:"outline",className:"text-lg",children:["عدد الأعمدة: ",m.data.columns.length]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"الأعمدة:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:m.data.columns.map(I=>e.jsx(le,{variant:"secondary",children:I},I))})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"لا توجد معلومات متاحة"})})]})}),e.jsx(Ge,{value:"data",className:"space-y-4",children:e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-5 w-5"}),"معاينة البيانات: ",t," (Supabase)"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx($,{onClick:()=>A(),variant:"outline",size:"sm","data-testid":"button-refresh-data",children:"تحديث"})})]}),x?.data&&mo(x.data)&&e.jsxs(js,{children:["عرض ",x.data.count," صف من إجمالي ",m?.data&&xc(m.data)?m.data.rowCount:0]})]}),e.jsx(H,{children:p?e.jsx("div",{className:"text-center py-8",children:"جاري تحميل البيانات..."}):x?.data&&mo(x.data)&&x.data.data.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(El,{children:[e.jsx(Dl,{children:e.jsx(Yr,{children:Object.keys(x.data.data[0]).map(I=>e.jsx(Bs,{children:I},I))})}),e.jsx(Ml,{children:x.data.data.map((I,E)=>e.jsx(Yr,{children:Object.values(I).map((O,T)=>e.jsx(As,{children:O!=null?String(O):"-"},T))},E))})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{onClick:k,disabled:n===0,variant:"outline","data-testid":"button-prev-page",children:"الصفحة السابقة"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["الصفوف ",n+1," - ",n+(x?.data&&mo(x.data)?x.data.count:0)]}),e.jsx($,{onClick:R,disabled:!(x?.data&&mo(x.data))||x.data.count<r,variant:"outline","data-testid":"button-next-page",children:"الصفحة التالية"})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"لا توجد بيانات للعرض"})})]})}),e.jsxs(Ge,{value:"backup",className:"space-y-4",children:[e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(yn,{className:"h-5 w-5"}),"نسخ احتياطي للجدول: ",t]}),e.jsx(js,{children:"قم بعمل نسخة احتياطية من بيانات الجدول من Supabase وحفظها في قاعدة البيانات المحلية"})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx($,{onClick:_,disabled:g.isPending,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700","data-testid":"button-backup-table",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"جاري النسخ الاحتياطي..."]}):e.jsxs(e.Fragment,{children:[e.jsx(yn,{className:"h-4 w-4"}),"بدء النسخ الاحتياطي"]})}),m?.data&&xc(m.data)&&e.jsxs("div",{className:"text-sm text-gray-600",children:["سيتم نسخ ",m.data.rowCount.toLocaleString()," صف من Supabase على دفعات من ",o," صف"]})]}),g.data?.data&&e.jsx("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800 dark:text-green-200",children:[e.jsx(ms,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"تم النسخ الاحتياطي بنجاح"}),e.jsxs("div",{className:"text-sm",children:["تم نسخ ",g.data.data.synced," صف من Supabase",g.data.data.savedLocally&&e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:[" ","وحفظ ",g.data.data.savedLocally," صف محلياً"]}),g.data.data.errors>0&&e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:[" ","مع ",g.data.data.errors," خطأ"]})]})]})]})}),g.error&&e.jsx("div",{className:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800 dark:text-red-200",children:[e.jsx(Wt,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"خطأ في النسخ الاحتياطي"}),e.jsx("div",{className:"text-sm",children:g.error?.message||"حدث خطأ غير معروف"})]})]})})]})]}),N.data?.data&&e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(ms,{className:"h-5 w-5"}),"نتائج النسخ الاحتياطي الشامل"]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:N.data.data.summary.tablesProcessed}),e.jsx("div",{className:"text-sm text-gray-600",children:"جدول تم معالجته"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N.data.data.summary.totalSynced}),e.jsx("div",{className:"text-sm text-gray-600",children:"صف تم نسخه"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:N.data.data.summary.totalSaved}),e.jsx("div",{className:"text-sm text-gray-600",children:"صف تم حفظه محلياً"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:N.data.data.summary.totalErrors}),e.jsx("div",{className:"text-sm text-gray-600",children:"أخطاء"})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:N.data.data.results.map((I,E)=>e.jsxs("div",{className:`flex items-center justify-between p-2 rounded ${I.success?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("span",{className:"font-medium",children:I.tableName}),e.jsx("div",{className:"text-sm",children:I.success?e.jsxs("span",{className:"text-green-700 dark:text-green-300",children:["✅ ",I.synced," صف نُسخ، ",I.savedLocally," صف حُفظ"]}):e.jsx("span",{className:"text-red-700 dark:text-red-300",children:"❌ فشل"})})]},E))})]})]}),N.error&&e.jsx("div",{className:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800 dark:text-red-200",children:[e.jsx(Wt,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"خطأ في النسخ الاحتياطي الشامل"}),e.jsx("div",{className:"text-sm",children:N.error?.message||"حدث خطأ غير معروف"})]})]})})]})]}),!t&&e.jsx(q,{children:e.jsxs(H,{className:"text-center py-12",children:[e.jsx($t,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"اختر جدول للنسخ الاحتياطي"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"قم بتحديد جدول من القائمة أعلاه لعرض المعلومات وعمل نسخة احتياطية من بيانات Supabase"})]})})]})}function mR(){const{toast:t}=Ct();Mt();const[s,r]=h.useState([]),[a,n]=h.useState({batchSize:100,delayBetweenBatches:1e3,maxRetries:3}),[i,o]=h.useState("tables"),[l,u]=h.useState(""),[d,c]=h.useState("all"),[f,m]=h.useState(null),{data:y,isLoading:x,refetch:p}=ge({queryKey:["/api/migration/tables"],refetchInterval:!1,staleTime:900*1e3}),{data:A,refetch:g}=ge({queryKey:["/api/migration/general-stats"],refetchInterval:!1,staleTime:600*1e3}),{data:N,refetch:w}=ge({queryKey:["/api/migration/connection-status"],refetchInterval:!1,staleTime:300*1e3}),{data:_,refetch:b}=ge({queryKey:["/api/migration/status",f],enabled:!!f,refetchInterval:f?5e3:!1,staleTime:2e3}),k=Ce({mutationFn:j=>ae("/api/migration/transfer","POST",j),onSuccess:j=>{m(j.data.id),o("progress"),t({title:"✅ تم بدء الهجرة",description:`تم بدء هجرة ${s.length} جدول بنجاح`})},onError:j=>{t({variant:"destructive",title:"❌ فشل في بدء الهجرة",description:j.message||"حدث خطأ غير متوقع"})}}),R=Ce({mutationFn:j=>ae(`/api/migration/stop/${j}`,"POST"),onSuccess:()=>{m(null),b(),t({title:"⏹️ تم إيقاف الهجرة",description:"تم إيقاف عملية الهجرة بنجاح"})}}),I=(y||[]).filter(j=>{const V=j.displayName.toLowerCase().includes(l.toLowerCase())||j.name.toLowerCase().includes(l.toLowerCase()),ne=d==="all"||j.category===d;return V&&ne}),E=Array.from(new Set((y||[]).map(j=>j.category))),O=j=>{r(V=>V.includes(j)?V.filter(ne=>ne!==j):[...V,j])},T=()=>{const j=I.map(V=>V.name);r(V=>V.length===j.length?[]:j)},S=()=>{if(s.length===0){t({variant:"destructive",title:"⚠️ لا توجد جداول محددة",description:"يرجى اختيار جدول واحد على الأقل للهجرة"});return}k.mutate({tables:s,batchSize:a.batchSize,delayBetweenBatches:a.delayBetweenBatches})},M=()=>{f&&R.mutate(f)},W=(()=>{const j=(y||[]).reduce((ne,F)=>ne+(F.actualRows||F.estimatedRows),0);let V;return A&&typeof A.estimatedDataSize<"u"?typeof A.estimatedDataSize=="number"?V=A.estimatedDataSize.toFixed(2)+" MB":V=String(A.estimatedDataSize):V=Math.round(j*.001*100)/100+" MB",{totalTables:y?.length||0,selectedTables:s.length,readyTables:(y||[]).filter(ne=>ne.status==="ready").length,completedTables:(y||[]).filter(ne=>ne.status==="completed").length,totalRecords:j,estimatedDataSize:V,isConnected:N&&typeof N.connected=="boolean"?N.connected:!1}})();return e.jsxs("div",{className:"container mx-auto p-3 sm:p-6 max-w-7xl",dir:"rtl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[e.jsx(et,{title:"إجمالي الجداول",value:W.totalTables,icon:$t,color:"blue","data-testid":"stat-total-tables"}),e.jsx(et,{title:"إجمالي السجلات",value:W.totalRecords.toLocaleString(),icon:ls,color:"green","data-testid":"stat-total-records"}),e.jsx(et,{title:"حجم البيانات المقدر",value:W.estimatedDataSize,icon:zl,color:"purple","data-testid":"stat-data-size"}),e.jsx(et,{title:"حالة الاتصال",value:W.isConnected?"متصل":"منقطع",icon:W.isConnected?Ul:vm,color:W.isConnected?"green":"red","data-testid":"stat-connection-status"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx(et,{title:"جداول مكتملة",value:W.completedTables,icon:ms,color:"emerald","data-testid":"stat-completed-tables"}),e.jsx(et,{title:"جداول جاهزة",value:W.readyTables,icon:Ut,color:"orange","data-testid":"stat-ready-tables"}),e.jsx(et,{title:"جداول محددة",value:W.selectedTables,icon:Ot,color:"indigo","data-testid":"stat-selected-tables"}),e.jsx(et,{title:"نسبة الإكمال",value:`${Math.round(W.completedTables/W.totalTables*100)||0}%`,icon:Ot,color:"teal","data-testid":"stat-completion-rate"})]})]}),e.jsxs(Ks,{value:i,onValueChange:o,className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3 sm:grid-cols-6 h-auto gap-1",children:[e.jsxs(He,{value:"tables",className:"flex items-center gap-2 text-xs sm:text-sm p-2 sm:p-3",children:[e.jsx($t,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"اختيار الجداول"}),e.jsx("span",{className:"sm:hidden",children:"الجداول"})]}),e.jsxs(He,{value:"settings",className:"flex items-center gap-2 text-xs sm:text-sm p-2 sm:p-3",children:[e.jsx(rs,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"الإعدادات"}),e.jsx("span",{className:"sm:hidden",children:"إعدادات"})]}),e.jsxs(He,{value:"progress",className:"flex items-center gap-2 text-xs sm:text-sm p-2 sm:p-3",children:[e.jsx(Ot,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"متابعة التقدم"}),e.jsx("span",{className:"sm:hidden",children:"التقدم"})]}),e.jsxs(He,{value:"backup",className:"flex items-center gap-2 text-xs sm:text-sm p-2 sm:p-3",children:[e.jsx(ea,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"النسخ الاحتياطي"}),e.jsx("span",{className:"sm:hidden",children:"نسخ"})]}),e.jsxs(He,{value:"restore",className:"flex items-center gap-2 text-xs sm:text-sm p-2 sm:p-3",children:[e.jsx(ql,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"الاستعادة المتقدمة"}),e.jsx("span",{className:"sm:hidden",children:"استعادة"})]}),e.jsxs(He,{value:"database-mgmt",className:"flex items-center gap-2 text-xs sm:text-sm p-2 sm:p-3",children:[e.jsx(kc,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"إدارة قواعد البيانات"}),e.jsx("span",{className:"sm:hidden",children:"إدارة"})]})]}),e.jsxs(Ge,{value:"tables",className:"space-y-4",children:[e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center justify-between text-base sm:text-lg",children:[e.jsx("span",{children:"الجداول المتاحة للهجرة"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs($,{variant:"outline",size:"sm",onClick:()=>{p(),g(),w()},disabled:x,"data-testid":"button-refresh-tables",children:[e.jsx(Gt,{className:`h-4 w-4 ${x?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"تحديث"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Rr,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(be,{placeholder:"البحث في الجداول...",value:l,onChange:j=>u(j.target.value),className:"pl-10 text-sm sm:text-base","data-testid":"input-search-tables"})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs("select",{value:d,onChange:j=>c(j.target.value),className:"w-full p-2 border rounded-md text-sm sm:text-base","data-testid":"select-category-filter",children:[e.jsx("option",{value:"all",children:"جميع الفئات"}),E.map((j,V)=>e.jsx("option",{value:j,children:j},`category-${V}`))]})})]}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx($,{variant:"outline",size:"sm",onClick:T,"data-testid":"button-toggle-select-all",className:"text-xs sm:text-sm",children:s.length===I.length?"إلغاء اختيار الكل":"اختيار الكل"}),e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground",children:["محدد ",s.length," من ",I.length," جدول"]})]})})]}),e.jsx(H,{children:e.jsxs(Zr,{className:"h-[300px] sm:h-[400px]",children:[e.jsx("div",{className:"space-y-3 sm:hidden",children:x?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Gt,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"جاري تحميل الجداول..."})]}):I.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($t,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm",children:"لا توجد جداول متطابقة مع البحث"})]}):I.map(j=>e.jsx(q,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:s.includes(j.name),onChange:()=>O(j.name),className:"w-4 h-4 mt-1","data-testid":`checkbox-table-${j.name}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:j.displayName}),e.jsx(le,{variant:j.status==="ready"?"default":j.status==="completed"?"secondary":j.status==="failed"?"destructive":"outline",className:"text-xs",children:j.status==="ready"?"جاهز":j.status==="completed"?"مكتمل":j.status==="failed"?"فاشل":j.status})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:j.name}),j.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-2 line-clamp-2",children:j.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{className:"h-3 w-3"}),e.jsxs("span",{children:[(j.actualRows||j.estimatedRows).toLocaleString()," صف"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(lr,{className:"h-3 w-3"}),e.jsxs("span",{children:[j.columnCount||"—"," عمود"]})]})]}),j.columns&&j.columns.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"الأعمدة:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[j.columns.slice(0,3).map((V,ne)=>e.jsx(le,{variant:"outline",className:"text-xs px-1 py-0",children:V},ne)),j.columns.length>3&&e.jsxs(le,{variant:"outline",className:"text-xs px-1 py-0",children:["+",j.columns.length-3]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx(le,{variant:"outline",className:"text-xs",children:j.category}),j.size&&e.jsx("span",{className:"text-xs text-muted-foreground",children:j.size})]})]})]})},j.name))}),e.jsxs(El,{className:"hidden sm:table",children:[e.jsx(Dl,{children:e.jsxs(Yr,{children:[e.jsx(Bs,{className:"w-12",children:"اختيار"}),e.jsx(Bs,{children:"معلومات الجدول"}),e.jsx(Bs,{children:"الفئة"}),e.jsx(Bs,{children:"البيانات"}),e.jsx(Bs,{children:"الأعمدة"}),e.jsx(Bs,{children:"الحالة"})]})}),e.jsx(Ml,{children:x?e.jsx(Yr,{children:e.jsxs(As,{colSpan:6,className:"text-center py-8",children:[e.jsx(Gt,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),"جاري تحميل الجداول..."]})}):I.length===0?e.jsx(Yr,{children:e.jsxs(As,{colSpan:6,className:"text-center py-8",children:[e.jsx($t,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),"لا توجد جداول متطابقة مع البحث"]})}):I.map(j=>e.jsxs(Yr,{children:[e.jsx(As,{children:e.jsx("input",{type:"checkbox",checked:s.includes(j.name),onChange:()=>O(j.name),className:"w-4 h-4","data-testid":`checkbox-table-${j.name}`})}),e.jsx(As,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:j.displayName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j.name}),j.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:j.description})]})}),e.jsx(As,{children:e.jsx(le,{variant:"outline",children:j.category})}),e.jsx(As,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ls,{className:"h-3 w-3"}),e.jsxs("span",{children:[(j.actualRows||j.estimatedRows).toLocaleString()," صف"]})]}),j.size&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(zl,{className:"h-3 w-3"}),e.jsx("span",{children:j.size})]})]})}),e.jsx(As,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(lr,{className:"h-3 w-3"}),e.jsxs("span",{children:[j.columnCount||"—"," عمود"]})]}),j.columns&&j.columns.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[j.columns.slice(0,2).map((V,ne)=>e.jsx(le,{variant:"outline",className:"text-xs px-1 py-0",children:V},ne)),j.columns.length>2&&e.jsxs(le,{variant:"outline",className:"text-xs px-1 py-0",children:["+",j.columns.length-2]})]})]})}),e.jsx(As,{children:e.jsx(le,{variant:j.status==="ready"?"default":j.status==="completed"?"secondary":j.status==="failed"?"destructive":"outline",children:j.status==="ready"?"جاهز":j.status==="completed"?"مكتمل":j.status==="failed"?"فاشل":j.status})})]},j.name))})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs($,{onClick:S,disabled:s.length===0||k.isPending,size:"lg","data-testid":"button-start-migration",children:[e.jsx(Tn,{className:"h-4 w-4 ml-2"}),k.isPending?"جاري البدء...":"بدء الهجرة"]}),f&&e.jsxs($,{variant:"destructive",onClick:M,disabled:R.isPending,size:"lg","data-testid":"button-stop-migration",children:[e.jsx(ny,{className:"h-4 w-4 ml-2"}),"إيقاف الهجرة"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["محدد ",s.length," جدول للهجرة"]})]})]}),e.jsx(Ge,{value:"settings",className:"space-y-4",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"إعدادات الهجرة"})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"batchSize",children:"حجم الدفعة"}),e.jsx(be,{id:"batchSize",type:"number",value:a.batchSize,onChange:j=>n(V=>({...V,batchSize:parseInt(j.target.value)||100})),min:10,max:1e3,"data-testid":"input-batch-size"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"عدد الصفوف في كل دفعة (10-1000)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"delay",children:"التأخير بين الدفعات (مللي ثانية)"}),e.jsx(be,{id:"delay",type:"number",value:a.delayBetweenBatches,onChange:j=>n(V=>({...V,delayBetweenBatches:parseInt(j.target.value)||1e3})),min:100,max:1e4,"data-testid":"input-delay"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"فترة الانتظار بين كل دفعة (100-10000ms)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"retries",children:"محاولات إعادة التجربة"}),e.jsx(be,{id:"retries",type:"number",value:a.maxRetries,onChange:j=>n(V=>({...V,maxRetries:parseInt(j.target.value)||3})),min:1,max:10,"data-testid":"input-max-retries"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"عدد محاولات إعادة التجربة للدفعات الفاشلة (1-10)"})]})]}),e.jsx(Is,{}),e.jsxs(en,{children:[e.jsx(rs,{className:"h-4 w-4"}),e.jsxs(tn,{children:[e.jsx("strong",{children:"نصائح للإعدادات الأمثل:"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:"• استخدم حجم دفعة أصغر (50-100) للجداول الكبيرة لتجنب timeout"}),e.jsx("li",{children:"• زد التأخير بين الدفعات (2000-3000ms) إذا كانت هناك مشاكل في الاتصال"}),e.jsx("li",{children:"• حدد عدد محاولات أكثر (5-7) للشبكات البطيئة"})]})]})]})]})]})}),e.jsx(Ge,{value:"progress",className:"space-y-4",children:f?e.jsx(hR,{migrationStatus:_,onRefresh:()=>b()}):e.jsx(q,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(Ot,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد عملية هجرة جارية"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:'اذهب إلى تبويب "اختيار الجداول" لبدء عملية هجرة جديدة'}),e.jsxs($,{onClick:()=>o("tables"),children:[e.jsx(fa,{className:"h-4 w-4 ml-2"}),"اختيار الجداول"]})]})})}),e.jsx(Ge,{value:"backup",className:"space-y-4",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(ea,{className:"h-5 w-5"}),"النسخ الاحتياطي المحلي"]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ea,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"إنشاء نسخة احتياطية محلية"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"قم بإنشاء نسخة احتياطية كاملة من قاعدة البيانات المحلية للحماية من فقدان البيانات"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-lg mx-auto",children:[e.jsxs($,{variant:"outline","data-testid":"button-create-backup",children:[e.jsx(yn,{className:"h-4 w-4 ml-2"}),"إنشاء نسخة احتياطية"]}),e.jsxs($,{variant:"outline","data-testid":"button-schedule-backup",children:[e.jsx(Ut,{className:"h-4 w-4 ml-2"}),"جدولة النسخ الاحتياطي"]})]})]}),e.jsx(Is,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"النسخ الاحتياطية المحفوظة"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"نسخة احتياطية يومية"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تم إنشاؤها في 18 سبتمبر 2025"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{size:"sm",variant:"outline","data-testid":"button-download-backup",children:e.jsx(yn,{className:"h-4 w-4"})}),e.jsx($,{size:"sm",variant:"outline","data-testid":"button-delete-backup",children:e.jsx(os,{className:"h-4 w-4"})})]})]})})]})]})]})}),e.jsx(Ge,{value:"restore",className:"space-y-4",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(ql,{className:"h-5 w-5"}),"الاستعادة المتقدمة"]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ql,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"استعادة البيانات"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"استعد البيانات من النسخ الاحتياطية أو قم بعمليات استعادة متقدمة"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-lg mx-auto",children:[e.jsxs($,{variant:"outline","data-testid":"button-restore-from-backup",children:[e.jsx(Ao,{className:"h-4 w-4 ml-2"}),"استعادة من نسخة احتياطية"]}),e.jsxs($,{variant:"outline","data-testid":"button-selective-restore",children:[e.jsx(Fk,{className:"h-4 w-4 ml-2"}),"استعادة انتقائية"]})]})]}),e.jsx(Is,{}),e.jsxs(en,{children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsxs(tn,{children:[e.jsx("strong",{children:"تحذير:"})," عمليات الاستعادة قد تستغرق وقتاً طويلاً وقد تؤثر على أداء النظام. تأكد من إنشاء نسخة احتياطية حديثة قبل البدء."]})]})]})]})}),e.jsx(Ge,{value:"database-mgmt",className:"space-y-4",children:e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(kc,{className:"h-5 w-5"}),"إدارة قواعد البيانات"]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"text-center p-6 border rounded-lg",children:[e.jsx($t,{className:"h-12 w-12 mx-auto mb-3 text-blue-500"}),e.jsx("h4",{className:"font-medium mb-2",children:"قاعدة البيانات المصدر"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Supabase Database"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:W.isConnected?e.jsxs(e.Fragment,{children:[e.jsx(Ul,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600",children:"متصل"})]}):e.jsxs(e.Fragment,{children:[e.jsx(vm,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-600",children:"غير متصل"})]})}),e.jsx($,{size:"sm",variant:"outline","data-testid":"button-test-source-connection",children:"اختبار الاتصال"})]})]}),e.jsxs("div",{className:"text-center p-6 border rounded-lg",children:[e.jsx(zl,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),e.jsx("h4",{className:"font-medium mb-2",children:"قاعدة البيانات المحلية"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Local PostgreSQL"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ul,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600",children:"متصل"})]}),e.jsx($,{size:"sm",variant:"outline","data-testid":"button-manage-local-db",children:"إدارة قاعدة البيانات"})]})]})]}),e.jsx(Is,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"أدوات الإدارة"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs($,{variant:"outline",className:"justify-start","data-testid":"button-optimize-tables",children:[e.jsx(rs,{className:"h-4 w-4 ml-2"}),"تحسين الجداول"]}),e.jsxs($,{variant:"outline",className:"justify-start","data-testid":"button-analyze-performance",children:[e.jsx(ls,{className:"h-4 w-4 ml-2"}),"تحليل الأداء"]}),e.jsxs($,{variant:"outline",className:"justify-start","data-testid":"button-manage-indexes",children:[e.jsx($t,{className:"h-4 w-4 ml-2"}),"إدارة الفهارس"]})]})]})]})]})})]})]})}function hR({migrationStatus:t,onRefresh:s}){return t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"تقدم الهجرة"}),e.jsxs($,{variant:"outline",size:"sm",onClick:s,children:[e.jsx(Gt,{className:"h-4 w-4"}),"تحديث"]})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"التقدم الإجمالي"}),e.jsxs("span",{children:[t.progress,"%"]})]}),e.jsx(ir,{value:t.progress,className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.processedRows.toLocaleString()}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"صفوف معالجة"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.completedTables.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"جداول مكتملة"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:t.remainingTables.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"جداول متبقية"})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("span",{children:["بدأت في: ",new Date(t.startedAt).toLocaleString("ar-SA")]}),e.jsxs("span",{children:["المتوقع الانتهاء: ",new Date(t.estimatedCompletion).toLocaleString("ar-SA")]})]})]})]}),t.currentTable&&e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5 animate-pulse text-blue-500"}),"يتم معالجة: ",t.currentTable]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"تقدم الجدول الحالي"}),e.jsxs("span",{children:[Math.round(t.processedRows/t.totalRows*100),"%"]})]}),e.jsx(ir,{value:t.processedRows/t.totalRows*100,className:"w-full"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.processedRows.toLocaleString()," / ",t.totalRows.toLocaleString()," صف"]})]})})]}),t.errors&&t.errors.length>0&&e.jsxs(q,{children:[e.jsx(ue,{children:e.jsxs(pe,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Wt,{className:"h-5 w-5"}),"الأخطاء (",t.errors.length,")"]})}),e.jsx(H,{children:e.jsx(Zr,{className:"h-32",children:t.errors.map((r,a)=>e.jsx("div",{className:"mb-2 p-2 bg-red-50 rounded text-sm",children:r.message||r.toString()},a))})})]})]}):e.jsx(q,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(Gt,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"جاري تحميل معلومات التقدم..."})]})})}function fR(){const[t,s]=h.useState(100),[r,a]=h.useState(null),{toast:n}=Ct(),i=Mt(),{data:o,isLoading:l,refetch:u}=ge({queryKey:["/api/migration/jobs"],refetchInterval:!1,staleTime:300*1e3}),{data:d,isLoading:c,refetch:f}=ge({queryKey:["/api/migration/general-stats"],refetchInterval:!1,staleTime:600*1e3}),{data:m,isLoading:y,refetch:x}=ge({queryKey:["/api/migration/tables"],refetchInterval:!1,staleTime:900*1e3}),{data:p,refetch:A}=ge({queryKey:["/api/migration/connection-status"],refetchInterval:!1,staleTime:300*1e3}),{data:g,isLoading:N,refetch:w}=ge({queryKey:["/api/migration/status",r],enabled:!!r,refetchInterval:r?1e4:!1,staleTime:5e3});h.useEffect(()=>{const v=o?.data||[];if(v.length>0){const W=v.find(j=>j.status==="running");W&&W.id!==r?(console.log("🎯 تم اكتشاف مهمة نشطة جديدة:",W.id),a(W.id)):!W&&r&&(console.log("⏰ إنهاء تتبع المهمة النشطة:",r),setTimeout(()=>a(null),5e3))}else r&&!l&&(console.log("🧹 تنظيف تتبع المهمة النشطة - لا توجد مهام"),setTimeout(()=>a(null),2e3))},[o,r,l]);const _=Ce({mutationFn:async({batchSize:v})=>await ae("/api/migration/start","POST",{batchSize:v}),onSuccess:v=>{a(v.jobId),n({title:"تم بدء الهجرة",description:`معرف المهمة: ${v.jobId}`}),i.invalidateQueries({queryKey:["/api/migration/jobs"]})},onError:v=>{n({title:"خطأ في بدء الهجرة",description:v.message||"فشل في بدء عملية الهجرة",variant:"destructive"})}}),b=Ce({mutationFn:async v=>await ae(`/api/migration/stop/${v}`,"POST"),onSuccess:()=>{n({title:"تم إيقاف الهجرة",description:"تم إلغاء عملية الهجرة بنجاح"}),i.invalidateQueries({queryKey:["/api/migration/jobs"]}),setTimeout(()=>a(null),1e3)},onError:v=>{n({title:"خطأ في إيقاف الهجرة",description:v.message||"فشل في إيقاف العملية",variant:"destructive"})}}),k=g?.data||null,R=o?.data||[],I=()=>{_.mutate({batchSize:t})},E=()=>{r&&b.mutate(r)},O=v=>{const W=Math.floor(v/1e3),j=Math.floor(W/60),V=Math.floor(j/60);return V>0?`${V}س ${j%60}د ${W%60}ث`:j>0?`${j}د ${W%60}ث`:`${W}ث`},T=v=>new Intl.NumberFormat("ar-SA").format(v),S=v=>{const W={pending:{color:"bg-gray-500",text:"في الانتظار",icon:Ut},running:{color:"bg-blue-500",text:"قيد التشغيل",icon:Ot},completed:{color:"bg-green-500",text:"مكتمل",icon:za},failed:{color:"bg-red-500",text:"فشل",icon:fm},cancelled:{color:"bg-orange-500",text:"ملغي",icon:Wt}},{color:j,text:V,icon:ne}=W[v];return e.jsxs(le,{className:`${j} text-white`,children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),V]})},M=v=>{const W={pending:{color:"bg-gray-400",text:"انتظار"},processing:{color:"bg-blue-500",text:"معالجة"},completed:{color:"bg-green-500",text:"مكتمل"},failed:{color:"bg-red-500",text:"فشل"},skipped:{color:"bg-yellow-500",text:"تم التخطي"}},{color:j,text:V}=W[v];return e.jsx(le,{className:`${j} text-white text-xs`,children:V})};return l&&R.length===0?e.jsxs("div",{className:"container mx-auto p-6 space-y-6 bg-white dark:bg-black text-black dark:text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Zk,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"مراقب الهجرة المباشر"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"نظام مراقبة متقدم للهجرة الآمنة من Supabase"})]}),p?.data?.connected&&e.jsxs(le,{className:"bg-green-500 text-white animate-pulse",children:[e.jsx(Ot,{className:"w-3 h-3 mr-1"}),"متصل"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-32 bg-gray-100 dark:bg-gray-800 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-48 bg-gray-100 dark:bg-gray-800 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-100 dark:bg-gray-800 rounded-lg animate-pulse"})]})]}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6 bg-white dark:bg-black text-black dark:text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($t,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"لوحة تحكم هجرة البيانات"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"مراقبة وإدارة عمليات هجرة البيانات من Supabase إلى قاعدة البيانات المحلية"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs($,{onClick:()=>i.invalidateQueries(),variant:"outline",size:"sm","data-testid":"button-refresh",children:[e.jsx(Gt,{className:"h-4 w-4 mr-2"}),"تحديث"]}),!k||k.status!=="running"?e.jsx($,{onClick:I,disabled:_.isPending,className:"bg-green-600 hover:bg-green-700 text-white","data-testid":"button-start-migration",children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent mr-2"}),"بدء..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Tn,{className:"h-4 w-4 mr-2"}),"بدء الهجرة"]})}):e.jsxs($,{onClick:E,disabled:b.isPending,variant:"destructive","data-testid":"button-stop-migration",children:[e.jsx(ny,{className:"h-4 w-4 mr-2"}),"إيقاف الهجرة"]})]})]}),(d?.data||c)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(q,{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900 dark:to-blue-800 border-blue-200 dark:border-blue-700",children:[e.jsx(ue,{className:"pb-2",children:e.jsx(pe,{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"إجمالي الجداول"})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100","data-testid":"text-total-tables",children:c?e.jsx("div",{className:"animate-pulse bg-blue-200 dark:bg-blue-700 h-8 w-16 rounded"}):T(d?.data?.totalTables||0)}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300 mt-1",children:"جدول في Supabase"})]})]}),e.jsxs(q,{className:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900 dark:to-green-800 border-green-200 dark:border-green-700",children:[e.jsx(ue,{className:"pb-2",children:e.jsx(pe,{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"إجمالي الصفوف"})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-900 dark:text-green-100","data-testid":"text-total-rows",children:c?e.jsx("div",{className:"animate-pulse bg-green-200 dark:bg-green-700 h-8 w-20 rounded"}):T(d?.data?.totalEstimatedRows||0)}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-300 mt-1",children:"سجل للهجرة"})]})]}),e.jsxs(q,{className:"bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900 dark:to-purple-800 border-purple-200 dark:border-purple-700",children:[e.jsx(ue,{className:"pb-2",children:e.jsx(pe,{className:"text-sm font-medium text-purple-800 dark:text-purple-200",children:"حالة قاعدة البيانات"})}),e.jsxs(H,{children:[e.jsx("div",{className:"flex items-center gap-2",children:p?.data?.connected?e.jsxs(e.Fragment,{children:[e.jsx(za,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:"متصل"})]}):e.jsxs(e.Fragment,{children:[e.jsx(fm,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),e.jsx("span",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:"غير متصل"})]})}),e.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-300 mt-1",children:"Supabase و قاعدة البيانات المحلية"})]})]}),e.jsxs(q,{className:"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900 dark:to-orange-800 border-orange-200 dark:border-orange-700",children:[e.jsx(ue,{className:"pb-2",children:e.jsx(pe,{className:"text-sm font-medium text-orange-800 dark:text-orange-200",children:"مهام نشطة"})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-900 dark:text-orange-100","data-testid":"text-active-jobs",children:l?e.jsx("div",{className:"animate-pulse bg-orange-200 dark:bg-orange-700 h-8 w-8 rounded"}):R.filter(v=>v.status==="running").length}),e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-300 mt-1",children:"هجرة قيد التشغيل"})]})]})]}),e.jsxs(q,{className:"bg-white dark:bg-gray-900 border-yellow-200 dark:border-yellow-700",children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center gap-2 text-black dark:text-white",children:[e.jsx(gi,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"}),"اختبار هجرة آمن (Smoke Test)"]}),e.jsx(js,{className:"text-gray-600 dark:text-gray-400",children:"اختبار هجرة جداول صغيرة بحجم دفعات محدود للتأكد من السلامة"})]}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Wt,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-300",children:"جداول الاختبار المقترحة"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"worker_types"}),e.jsx("br",{}),e.jsx("span",{className:"text-gray-500",children:"جدول صغير (≈5 صفوف)"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"projects"}),e.jsx("br",{}),e.jsx("span",{className:"text-gray-500",children:"جدول متوسط (≈20 صف)"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"workers"}),e.jsx("br",{}),e.jsx("span",{className:"text-gray-500",children:"جدول مهم (≈100 صف)"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{onClick:()=>{s(10),I()},disabled:_.isPending||!!(k&&k.status==="running"),className:"bg-yellow-600 hover:bg-yellow-700 text-white","data-testid":"button-start-smoke-test",children:[e.jsx(gi,{className:"h-4 w-4 mr-2"}),"بدء الاختبار الآمن (حجم دفعة = 10)"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"سيتم اختبار جميع الجداول بدفعات صغيرة لضمان السلامة"})]})]})})]}),e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsx(pe,{children:"إعدادات الهجرة"}),e.jsx(js,{children:"تكوين معاملات عملية الهجرة"})]}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{htmlFor:"batch-size",children:"حجم الدفعة:"}),e.jsx(be,{id:"batch-size",type:"number",value:t,onChange:v=>s(parseInt(v.target.value)||100),min:50,max:500,className:"w-20","data-testid":"input-batch-size"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"عدد الصفوف التي يتم معالجتها في كل دفعة"})]})})]}),N&&r&&e.jsxs(q,{className:"border-2 border-gray-300 dark:border-gray-600",children:[e.jsx(ue,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"}),"جاري تحميل بيانات المهمة..."]})})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-100 dark:bg-gray-800 rounded animate-pulse"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[1,2,3,4].map(v=>e.jsx("div",{className:"h-20 bg-gray-100 dark:bg-gray-800 rounded animate-pulse"},v))}),e.jsx("div",{className:"h-40 bg-gray-100 dark:bg-gray-800 rounded animate-pulse"})]})})]}),k&&!N&&e.jsxs(q,{className:"border-2 border-blue-500 dark:border-blue-400",children:[e.jsxs(ue,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5 text-blue-600"}),"الهجرة النشطة - ",k.id.split("_")[2]?.substr(0,6)||k.id.substr(-6)]}),S(k.status)]}),e.jsx(js,{children:k.currentTable&&`الجدول الحالي: ${k.currentTable}`})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"التقدم العام"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[k.progress,"%"]})]}),e.jsx(ir,{value:k.progress,className:"w-full h-3","data-testid":"progress-overall"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:[k.tablesProcessed," من ",k.totalTables," جدول"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[k.estimatedTimeRemaining&&k.estimatedTimeRemaining>0&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600 dark:text-blue-400 font-medium",children:[e.jsx(Ut,{className:"h-3 w-3"}),"متبقي: ",O(k.estimatedTimeRemaining*1e3)]}),k.duration&&k.duration>0&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 font-medium",children:[e.jsx(Ot,{className:"h-3 w-3"}),"منقضي: ",O(k.duration)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:k.totalRowsProcessed.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"صفوف معالجة"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k.totalRowsSaved.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"صفوف محفوظة"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:k.totalErrors}),e.jsx("div",{className:"text-sm text-gray-600",children:"أخطاء"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:O(k.duration||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"المدة"})]})]}),k.tableProgress.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"تقدم الجداول (",k.tableProgress.length,")"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border rounded-md",children:e.jsxs(El,{children:[e.jsx(Dl,{children:e.jsxs(Yr,{children:[e.jsx(Bs,{children:"الجدول"}),e.jsx(Bs,{children:"الحالة"}),e.jsx(Bs,{children:"الصفوف"}),e.jsx(Bs,{children:"المعالجة"}),e.jsx(Bs,{children:"المحفوظة"}),e.jsx(Bs,{children:"الأخطاء"})]})}),e.jsx(Ml,{children:k.tableProgress.map((v,W)=>e.jsxs(Yr,{className:v.status==="processing"?"bg-blue-50 dark:bg-blue-900/10":"",children:[e.jsx(As,{className:"font-medium",children:v.tableName}),e.jsx(As,{children:M(v.status)}),e.jsx(As,{children:v.totalRows.toLocaleString()}),e.jsx(As,{children:v.processedRows.toLocaleString()}),e.jsx(As,{children:v.savedRows.toLocaleString()}),e.jsx(As,{children:v.errors>0&&e.jsx("span",{className:"text-red-600 font-medium",children:v.errors})})]},W))})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ls,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد تفاصيل جداول متاحة حالياً"}),e.jsx("p",{className:"text-sm",children:"ستظهر التفاصيل عند بدء عملية الهجرة"})]})]})]}),e.jsxs(q,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5"}),"تاريخ مهام الهجرة"]}),e.jsx(js,{children:"جميع عمليات الهجرة السابقة"})]}),e.jsx(H,{children:l&&R.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-gray-300 border-t-blue-500"}),"جاري تحميل تاريخ المهام..."]})}):R.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(Ut,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"لا توجد مهام هجرة بعد"}),e.jsx("p",{className:"text-sm",children:"ابدأ عملية هجرة جديدة لرؤية التقدم هنا"}),e.jsxs($,{onClick:I,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white","data-testid":"button-start-first-migration",children:[e.jsx(Tn,{className:"h-4 w-4 mr-2"}),"بدء أول عملية هجرة"]})]}):e.jsx("div",{className:"space-y-3",children:R.map((v,W)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-900/50","data-testid":`job-${W}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:v.id.split("_")[2]?.substr(0,6)||v.id.substr(-6)}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(v.startTime).toLocaleString("ar-EG")})]}),S(v.status)]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm",children:[v.totalRowsProcessed.toLocaleString()," صف معالج"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[v.tablesProcessed,"/",v.totalTables," جدول"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm",children:O(v.duration||Date.now()-new Date(v.startTime).getTime())}),v.totalErrors>0&&e.jsxs("div",{className:"text-xs text-red-600",children:[v.totalErrors," خطأ"]})]}),e.jsx($,{onClick:()=>a(v.id),variant:"outline",size:"sm","data-testid":`button-view-job-${W}`,children:"عرض التفاصيل"})]},v.id))})})]})]})}var pR="DismissableLayer",sd="dismissableLayer.update",xR="dismissableLayer.pointerDownOutside",gR="dismissableLayer.focusOutside",Df,_1=h.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),E1=h.forwardRef((t,s)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:a,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:l,...u}=t,d=h.useContext(_1),[c,f]=h.useState(null),m=c?.ownerDocument??globalThis?.document,[,y]=h.useState({}),x=lt(s,R=>f(R)),p=Array.from(d.layers),[A]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),g=p.indexOf(A),N=c?p.indexOf(c):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,_=N>=g,b=bR(R=>{const I=R.target,E=[...d.branches].some(O=>O.contains(I));!_||E||(n?.(R),o?.(R),R.defaultPrevented||l?.())},m),k=jR(R=>{const I=R.target;[...d.branches].some(O=>O.contains(I))||(i?.(R),o?.(R),R.defaultPrevented||l?.())},m);return rl(R=>{N===d.layers.size-1&&(a?.(R),!R.defaultPrevented&&l&&(R.preventDefault(),l()))},m),h.useEffect(()=>{if(c)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(Df=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(c)),d.layers.add(c),Mf(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=Df)}},[c,m,r,d]),h.useEffect(()=>()=>{c&&(d.layers.delete(c),d.layersWithOutsidePointerEventsDisabled.delete(c),Mf())},[c,d]),h.useEffect(()=>{const R=()=>y({});return document.addEventListener(sd,R),()=>document.removeEventListener(sd,R)},[]),e.jsx(We.div,{...u,ref:x,style:{pointerEvents:w?_?"auto":"none":void 0,...t.style},onFocusCapture:Ne(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ne(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ne(t.onPointerDownCapture,b.onPointerDownCapture)})});E1.displayName=pR;var yR="DismissableLayerBranch",vR=h.forwardRef((t,s)=>{const r=h.useContext(_1),a=h.useRef(null),n=lt(s,a);return h.useEffect(()=>{const i=a.current;if(i)return r.branches.add(i),()=>{r.branches.delete(i)}},[r.branches]),e.jsx(We.div,{...t,ref:n})});vR.displayName=yR;function bR(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1),n=h.useRef(()=>{});return h.useEffect(()=>{const i=l=>{if(l.target&&!a.current){let u=function(){D1(xR,r,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(s.removeEventListener("click",n.current),n.current=u,s.addEventListener("click",n.current,{once:!0})):u()}else s.removeEventListener("click",n.current);a.current=!1},o=window.setTimeout(()=>{s.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),s.removeEventListener("pointerdown",i),s.removeEventListener("click",n.current)}},[s,r]),{onPointerDownCapture:()=>a.current=!0}}function jR(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1);return h.useEffect(()=>{const n=i=>{i.target&&!a.current&&D1(gR,r,{originalEvent:i},{discrete:!1})};return s.addEventListener("focusin",n),()=>s.removeEventListener("focusin",n)},[s,r]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function Mf(){const t=new CustomEvent(sd);document.dispatchEvent(t)}function D1(t,s,r,{discrete:a}){const n=r.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});s&&n.addEventListener(t,s,{once:!0}),a?Vi(n,i):n.dispatchEvent(i)}var gc="focusScope.autoFocusOnMount",yc="focusScope.autoFocusOnUnmount",Rf={bubbles:!1,cancelable:!0},NR="FocusScope",M1=h.forwardRef((t,s)=>{const{loop:r=!1,trapped:a=!1,onMountAutoFocus:n,onUnmountAutoFocus:i,...o}=t,[l,u]=h.useState(null),d=Lt(n),c=Lt(i),f=h.useRef(null),m=lt(s,p=>u(p)),y=h.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;h.useEffect(()=>{if(a){let p=function(w){if(y.paused||!l)return;const _=w.target;l.contains(_)?f.current=_:ma(f.current,{select:!0})},A=function(w){if(y.paused||!l)return;const _=w.relatedTarget;_!==null&&(l.contains(_)||ma(f.current,{select:!0}))},g=function(w){if(document.activeElement===document.body)for(const b of w)b.removedNodes.length>0&&ma(l)};document.addEventListener("focusin",p),document.addEventListener("focusout",A);const N=new MutationObserver(g);return l&&N.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",A),N.disconnect()}}},[a,l,y.paused]),h.useEffect(()=>{if(l){Ff.add(y);const p=document.activeElement;if(!l.contains(p)){const g=new CustomEvent(gc,Rf);l.addEventListener(gc,d),l.dispatchEvent(g),g.defaultPrevented||(wR(CR(R1(l)),{select:!0}),document.activeElement===p&&ma(l))}return()=>{l.removeEventListener(gc,d),setTimeout(()=>{const g=new CustomEvent(yc,Rf);l.addEventListener(yc,c),l.dispatchEvent(g),g.defaultPrevented||ma(p??document.body,{select:!0}),l.removeEventListener(yc,c),Ff.remove(y)},0)}}},[l,d,c,y]);const x=h.useCallback(p=>{if(!r&&!a||y.paused)return;const A=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,g=document.activeElement;if(A&&g){const N=p.currentTarget,[w,_]=kR(N);w&&_?!p.shiftKey&&g===_?(p.preventDefault(),r&&ma(w,{select:!0})):p.shiftKey&&g===w&&(p.preventDefault(),r&&ma(_,{select:!0})):g===N&&p.preventDefault()}},[r,a,y.paused]);return e.jsx(We.div,{tabIndex:-1,...o,ref:m,onKeyDown:x})});M1.displayName=NR;function wR(t,{select:s=!1}={}){const r=document.activeElement;for(const a of t)if(ma(a,{select:s}),document.activeElement!==r)return}function kR(t){const s=R1(t),r=If(s,t),a=If(s.reverse(),t);return[r,a]}function R1(t){const s=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const n=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||n?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)s.push(r.currentNode);return s}function If(t,s){for(const r of t)if(!SR(r,{upTo:s}))return r}function SR(t,{upTo:s}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(s!==void 0&&t===s)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function TR(t){return t instanceof HTMLInputElement&&"select"in t}function ma(t,{select:s=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&TR(t)&&s&&t.select()}}var Ff=AR();function AR(){let t=[];return{add(s){const r=t[0];s!==r&&r?.pause(),t=Of(t,s),t.unshift(s)},remove(s){t=Of(t,s),t[0]?.resume()}}}function Of(t,s){const r=[...t],a=r.indexOf(s);return a!==-1&&r.splice(a,1),r}function CR(t){return t.filter(s=>s.tagName!=="A")}var PR="Portal",I1=h.forwardRef((t,s)=>{const{container:r,...a}=t,[n,i]=h.useState(!1);cl(()=>i(!0),[]);const o=r||n&&globalThis?.document?.body;return o?ud.createPortal(e.jsx(We.div,{...a,ref:s}),o):null});I1.displayName=PR;var Bu="Popover",[F1]=Hs(Bu,[$n]),Yi=$n(),[_R,Ma]=F1(Bu),O1=t=>{const{__scopePopover:s,children:r,open:a,defaultOpen:n,onOpenChange:i,modal:o=!1}=t,l=Yi(s),u=h.useRef(null),[d,c]=h.useState(!1),[f=!1,m]=Pa({prop:a,defaultProp:n,onChange:i});return e.jsx(Q0,{...l,children:e.jsx(_R,{scope:s,contentId:pa(),triggerRef:u,open:f,onOpenChange:m,onOpenToggle:h.useCallback(()=>m(y=>!y),[m]),hasCustomAnchor:d,onCustomAnchorAdd:h.useCallback(()=>c(!0),[]),onCustomAnchorRemove:h.useCallback(()=>c(!1),[]),modal:o,children:r})})};O1.displayName=Bu;var $1="PopoverAnchor",ER=h.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Ma($1,r),i=Yi(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=n;return h.useEffect(()=>(o(),()=>l()),[o,l]),e.jsx(al,{...i,...a,ref:s})});ER.displayName=$1;var L1="PopoverTrigger",V1=h.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Ma(L1,r),i=Yi(r),o=lt(s,n.triggerRef),l=e.jsx(We.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":W1(n.open),...a,ref:o,onClick:Ne(t.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:e.jsx(al,{asChild:!0,...i,children:l})});V1.displayName=L1;var qu="PopoverPortal",[DR,MR]=F1(qu,{forceMount:void 0}),z1=t=>{const{__scopePopover:s,forceMount:r,children:a,container:n}=t,i=Ma(qu,s);return e.jsx(DR,{scope:s,forceMount:r,children:e.jsx(ws,{present:r||i.open,children:e.jsx(I1,{asChild:!0,container:n,children:a})})})};z1.displayName=qu;var On="PopoverContent",B1=h.forwardRef((t,s)=>{const r=MR(On,t.__scopePopover),{forceMount:a=r.forceMount,...n}=t,i=Ma(On,t.__scopePopover);return e.jsx(ws,{present:a||i.open,children:i.modal?e.jsx(IR,{...n,ref:s}):e.jsx(FR,{...n,ref:s})})});B1.displayName=On;var RR=hd("PopoverContent.RemoveScroll"),IR=h.forwardRef((t,s)=>{const r=Ma(On,t.__scopePopover),a=h.useRef(null),n=lt(s,a),i=h.useRef(!1);return h.useEffect(()=>{const o=a.current;if(o)return fd(o)},[]),e.jsx(md,{as:RR,allowPinchZoom:!0,children:e.jsx(q1,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ne(t.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Ne(t.onPointerDownOutside,o=>{const l=o.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,d=l.button===2||u;i.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:Ne(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),FR=h.forwardRef((t,s)=>{const r=Ma(On,t.__scopePopover),a=h.useRef(!1),n=h.useRef(!1);return e.jsx(q1,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||r.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),q1=h.forwardRef((t,s)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:c,...f}=t,m=Ma(On,r),y=Yi(r);return pd(),e.jsx(M1,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(E1,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>m.onOpenChange(!1),children:e.jsx(od,{"data-state":W1(m.open),role:"dialog",id:m.contentId,...y,...f,ref:s,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),U1="PopoverClose",OR=h.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Ma(U1,r);return e.jsx(We.button,{type:"button",...a,ref:s,onClick:Ne(t.onClick,()=>n.onOpenChange(!1))})});OR.displayName=U1;var $R="PopoverArrow",LR=h.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Yi(r);return e.jsx(ld,{...n,...a,ref:s})});LR.displayName=$R;function W1(t){return t?"open":"closed"}var VR=O1,zR=V1,BR=z1,K1=B1;const qR=VR,UR=zR,H1=h.forwardRef(({className:t,align:s="center",sideOffset:r=4,...a},n)=>e.jsx(BR,{children:e.jsx(K1,{ref:n,align:s,sideOffset:r,className:he("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));H1.displayName=K1.displayName;const WR={safety:Ns,task:ms,payroll:Gk,announcement:Ba,system:hs},$f={safety:"text-red-600 bg-gradient-to-r from-red-50 to-red-100",task:"text-blue-600 bg-gradient-to-r from-blue-50 to-blue-100",payroll:"text-green-600 bg-gradient-to-r from-green-50 to-green-100",announcement:"text-purple-600 bg-gradient-to-r from-purple-50 to-purple-100",system:"text-gray-600 bg-gradient-to-r from-gray-50 to-gray-100"},Lf={1:{label:"حرج",color:"bg-gradient-to-r from-red-500 to-red-600"},2:{label:"عالية",color:"bg-gradient-to-r from-orange-500 to-orange-600"},3:{label:"متوسطة",color:"bg-gradient-to-r from-yellow-500 to-yellow-600"},4:{label:"منخفضة",color:"bg-gradient-to-r from-blue-500 to-blue-600"},5:{label:"معلومة",color:"bg-gradient-to-r from-gray-500 to-gray-600"}};function KR({className:t}){const[s,r]=h.useState([]),[a,n]=h.useState(0),[i,o]=h.useState(!1),[l,u]=h.useState(!1),[,d]=Or(),c=async()=>{u(!0);try{const x=localStorage.getItem("accessToken");if(!x){console.warn("لا يوجد رمز مصادقة - تخطي جلب الإشعارات"),u(!1);return}const p=await fetch("/api/notifications?limit=50",{headers:{Authorization:`Bearer ${x}`}});if(p.ok){const A=await p.json();if(console.log("🔍 [NotificationCenter] استجابة API:",A),A.success&&Array.isArray(A.data)){const g=A.data.map(N=>({id:N.id,type:N.type||"system",title:N.title,message:N.message,priority:N.priority==="critical"?1:N.priority==="high"?2:N.priority==="medium"?3:N.priority==="low"?4:5,createdAt:N.createdAt,isRead:N.status==="read",actionRequired:N.actionRequired||!1}));r(g),n(A.unreadCount||0),console.log("✅ [NotificationCenter] تم تحويل وحفظ الإشعارات:",g.length)}else Array.isArray(A)&&(r(A.map(g=>({...g,isRead:g.status==="read"}))),n(A.filter(g=>g.status!=="read").length))}else console.error("فشل في جلب الإشعارات"),r([{id:"system-welcome",type:"system",title:"مرحباً بك",message:"مرحباً بك في نظام إدارة المشاريع الإنشائية",priority:3,createdAt:new Date().toISOString(),isRead:!1}]),n(1)}catch(x){console.error("خطأ في جلب الإشعارات:",x)}finally{u(!1)}},f=async x=>{try{const p=localStorage.getItem("accessToken");if(!p){console.warn("لا يوجد رمز مصادقة - لا يمكن تحديد الإشعار كمقروء");return}(await fetch(`/api/notifications/${x}/read`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}})).ok&&(r(g=>g.map(N=>N.id===x?{...N,isRead:!0}:N)),n(g=>Math.max(0,g-1)))}catch(p){console.error("خطأ في تعليم الإشعار كمقروء:",p)}},m=async()=>{try{const x=localStorage.getItem("accessToken");if(!x){console.warn("لا يوجد رمز مصادقة - لا يمكن تعليم الإشعارات كمقروءة");return}(await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`}})).ok&&await c()}catch(x){console.error("خطأ في تعليم جميع الإشعارات كمقروءة:",x)}};h.useEffect(()=>{c();const x=setInterval(c,3e5);return()=>clearInterval(x)},[]);const y=x=>{const p=new Date(x),g=(new Date().getTime()-p.getTime())/(1e3*60*60);return g<1?`منذ ${Math.floor(g*60)} دقيقة`:g<24?`منذ ${Math.floor(g)} ساعة`:`منذ ${Math.floor(g/24)} يوم`};return e.jsxs(qR,{open:i,onOpenChange:o,children:[e.jsx(UR,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:he("relative p-2 h-10 w-10 rounded-xl transition-all duration-300 hover:bg-blue-50 hover:shadow-lg border border-transparent hover:border-blue-200",t,a>0&&"bg-blue-50 border-blue-200 shadow-md"),"data-testid":"notification-bell",children:[e.jsx(hs,{className:he("h-5 w-5 transition-all duration-300",a>0?"text-blue-600 animate-pulse":"text-gray-600")}),a>0&&e.jsx(le,{className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 text-xs font-bold bg-gradient-to-r from-red-500 to-red-600 shadow-lg animate-bounce","data-testid":"notification-badge",children:a>99?"99+":a})]})}),e.jsxs(H1,{className:"w-80 sm:w-96 p-0 border-0 shadow-2xl rounded-2xl bg-white",align:"end","data-testid":"notification-popover",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-4 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(hs,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-base",children:"الإشعارات"}),e.jsx("p",{className:"text-xs text-blue-100",children:a>0?`${a} إشعار جديد`:"جميع الإشعارات مقروءة"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a>0&&e.jsxs($,{variant:"ghost",size:"sm",className:"text-xs h-8 text-white hover:bg-white/20 rounded-lg",onClick:m,"data-testid":"mark-all-read-button",children:[e.jsx(ms,{className:"h-3 w-3 mr-1"}),"تعليم الكل"]}),e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-white hover:bg-white/20 rounded-lg",onClick:()=>o(!1),"data-testid":"close-notification-button",children:e.jsx(yr,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-3"}),e.jsx("div",{className:"text-sm text-gray-500",children:"جاري التحميل..."})]}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(hs,{className:"h-8 w-8 text-gray-400"})}),e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-1",children:"لا توجد إشعارات"}),e.jsx("div",{className:"text-xs text-gray-400",children:"ستظهر إشعاراتك الجديدة هنا"})]}):e.jsx("div",{className:"p-2",children:s.map((x,p)=>{const A=WR[x.type]||hs,g=$f[x.type]||$f.system,N=Lf[x.priority]||Lf[3];return e.jsx("div",{className:he("group p-3 mb-2 last:mb-0 rounded-xl cursor-pointer transition-all duration-300 border",x.isRead?"bg-white border-gray-100 hover:bg-gray-50 hover:border-gray-200":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 hover:from-blue-100 hover:to-indigo-100 shadow-sm hover:shadow-md"),onClick:()=>!x.isRead&&f(x.id),"data-testid":`notification-item-${p}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:he("w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm transition-all duration-300 group-hover:scale-105",g),children:e.jsx(A,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:he("text-sm leading-tight",x.isRead?"font-medium text-gray-700":"font-bold text-gray-900"),children:x.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!x.isRead&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx(le,{className:he("text-xs px-2 py-0.5 text-white font-medium",N.color),children:N.label})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2 leading-relaxed",children:x.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(Ut,{className:"h-3 w-3"}),e.jsx("span",{children:y(x.createdAt)})]}),x.actionRequired&&e.jsxs(le,{variant:"outline",className:"text-xs bg-orange-50 text-orange-600 border-orange-200",children:[e.jsx(Gr,{className:"h-3 w-3 mr-1"}),"إجراء مطلوب"]})]})]})]})},x.id)})})}),s.length>0&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"border-t border-gray-100 p-3",children:e.jsxs($,{variant:"ghost",className:"w-full text-sm font-medium bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-indigo-50 border border-gray-200 hover:border-blue-200 transition-all duration-300 rounded-xl h-10",onClick:()=>{o(!1),d("/notifications")},"data-testid":"view-all-notifications-button",children:[e.jsx(Zs,{className:"h-4 w-4 mr-2"}),"عرض جميع الإشعارات"]})})})]})]})}var HR="DismissableLayer",rd="dismissableLayer.update",GR="dismissableLayer.pointerDownOutside",QR="dismissableLayer.focusOutside",Vf,G1=h.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Q1=h.forwardRef((t,s)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:a,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:l,...u}=t,d=h.useContext(G1),[c,f]=h.useState(null),m=c?.ownerDocument??globalThis?.document,[,y]=h.useState({}),x=lt(s,R=>f(R)),p=Array.from(d.layers),[A]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),g=p.indexOf(A),N=c?p.indexOf(c):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,_=N>=g,b=YR(R=>{const I=R.target,E=[...d.branches].some(O=>O.contains(I));!_||E||(n?.(R),o?.(R),R.defaultPrevented||l?.())},m),k=JR(R=>{const I=R.target;[...d.branches].some(O=>O.contains(I))||(i?.(R),o?.(R),R.defaultPrevented||l?.())},m);return rl(R=>{N===d.layers.size-1&&(a?.(R),!R.defaultPrevented&&l&&(R.preventDefault(),l()))},m),h.useEffect(()=>{if(c)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(Vf=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(c)),d.layers.add(c),zf(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=Vf)}},[c,m,r,d]),h.useEffect(()=>()=>{c&&(d.layers.delete(c),d.layersWithOutsidePointerEventsDisabled.delete(c),zf())},[c,d]),h.useEffect(()=>{const R=()=>y({});return document.addEventListener(rd,R),()=>document.removeEventListener(rd,R)},[]),e.jsx(We.div,{...u,ref:x,style:{pointerEvents:w?_?"auto":"none":void 0,...t.style},onFocusCapture:Ne(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ne(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ne(t.onPointerDownCapture,b.onPointerDownCapture)})});Q1.displayName=HR;var XR="DismissableLayerBranch",ZR=h.forwardRef((t,s)=>{const r=h.useContext(G1),a=h.useRef(null),n=lt(s,a);return h.useEffect(()=>{const i=a.current;if(i)return r.branches.add(i),()=>{r.branches.delete(i)}},[r.branches]),e.jsx(We.div,{...t,ref:n})});ZR.displayName=XR;function YR(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1),n=h.useRef(()=>{});return h.useEffect(()=>{const i=l=>{if(l.target&&!a.current){let u=function(){X1(GR,r,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(s.removeEventListener("click",n.current),n.current=u,s.addEventListener("click",n.current,{once:!0})):u()}else s.removeEventListener("click",n.current);a.current=!1},o=window.setTimeout(()=>{s.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),s.removeEventListener("pointerdown",i),s.removeEventListener("click",n.current)}},[s,r]),{onPointerDownCapture:()=>a.current=!0}}function JR(t,s=globalThis?.document){const r=Lt(t),a=h.useRef(!1);return h.useEffect(()=>{const n=i=>{i.target&&!a.current&&X1(QR,r,{originalEvent:i},{discrete:!1})};return s.addEventListener("focusin",n),()=>s.removeEventListener("focusin",n)},[s,r]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function zf(){const t=new CustomEvent(rd);document.dispatchEvent(t)}function X1(t,s,r,{discrete:a}){const n=r.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});s&&n.addEventListener(t,s,{once:!0}),a?Vi(n,i):n.dispatchEvent(i)}var vc="focusScope.autoFocusOnMount",bc="focusScope.autoFocusOnUnmount",Bf={bubbles:!1,cancelable:!0},eI="FocusScope",Z1=h.forwardRef((t,s)=>{const{loop:r=!1,trapped:a=!1,onMountAutoFocus:n,onUnmountAutoFocus:i,...o}=t,[l,u]=h.useState(null),d=Lt(n),c=Lt(i),f=h.useRef(null),m=lt(s,p=>u(p)),y=h.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;h.useEffect(()=>{if(a){let p=function(w){if(y.paused||!l)return;const _=w.target;l.contains(_)?f.current=_:ha(f.current,{select:!0})},A=function(w){if(y.paused||!l)return;const _=w.relatedTarget;_!==null&&(l.contains(_)||ha(f.current,{select:!0}))},g=function(w){if(document.activeElement===document.body)for(const b of w)b.removedNodes.length>0&&ha(l)};document.addEventListener("focusin",p),document.addEventListener("focusout",A);const N=new MutationObserver(g);return l&&N.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",A),N.disconnect()}}},[a,l,y.paused]),h.useEffect(()=>{if(l){Uf.add(y);const p=document.activeElement;if(!l.contains(p)){const g=new CustomEvent(vc,Bf);l.addEventListener(vc,d),l.dispatchEvent(g),g.defaultPrevented||(tI(iI(Y1(l)),{select:!0}),document.activeElement===p&&ha(l))}return()=>{l.removeEventListener(vc,d),setTimeout(()=>{const g=new CustomEvent(bc,Bf);l.addEventListener(bc,c),l.dispatchEvent(g),g.defaultPrevented||ha(p??document.body,{select:!0}),l.removeEventListener(bc,c),Uf.remove(y)},0)}}},[l,d,c,y]);const x=h.useCallback(p=>{if(!r&&!a||y.paused)return;const A=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,g=document.activeElement;if(A&&g){const N=p.currentTarget,[w,_]=sI(N);w&&_?!p.shiftKey&&g===_?(p.preventDefault(),r&&ha(w,{select:!0})):p.shiftKey&&g===w&&(p.preventDefault(),r&&ha(_,{select:!0})):g===N&&p.preventDefault()}},[r,a,y.paused]);return e.jsx(We.div,{tabIndex:-1,...o,ref:m,onKeyDown:x})});Z1.displayName=eI;function tI(t,{select:s=!1}={}){const r=document.activeElement;for(const a of t)if(ha(a,{select:s}),document.activeElement!==r)return}function sI(t){const s=Y1(t),r=qf(s,t),a=qf(s.reverse(),t);return[r,a]}function Y1(t){const s=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const n=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||n?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)s.push(r.currentNode);return s}function qf(t,s){for(const r of t)if(!rI(r,{upTo:s}))return r}function rI(t,{upTo:s}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(s!==void 0&&t===s)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function aI(t){return t instanceof HTMLInputElement&&"select"in t}function ha(t,{select:s=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&aI(t)&&s&&t.select()}}var Uf=nI();function nI(){let t=[];return{add(s){const r=t[0];s!==r&&r?.pause(),t=Wf(t,s),t.unshift(s)},remove(s){t=Wf(t,s),t[0]?.resume()}}}function Wf(t,s){const r=[...t],a=r.indexOf(s);return a!==-1&&r.splice(a,1),r}function iI(t){return t.filter(s=>s.tagName!=="A")}var oI="Portal",J1=h.forwardRef((t,s)=>{const{container:r,...a}=t,[n,i]=h.useState(!1);cl(()=>i(!0),[]);const o=r||n&&globalThis?.document?.body;return o?ud.createPortal(e.jsx(We.div,{...a,ref:s}),o):null});J1.displayName=oI;var ad=["Enter"," "],lI=["ArrowDown","PageUp","Home"],e2=["ArrowUp","PageDown","End"],cI=[...lI,...e2],dI={ltr:[...ad,"ArrowRight"],rtl:[...ad,"ArrowLeft"]},uI={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ji="Menu",[$i,mI,hI]=G0(Ji),[nn,t2]=Hs(Ji,[hI,$n,Un]),Rl=$n(),s2=Un(),[fI,on]=nn(Ji),[pI,eo]=nn(Ji),r2=t=>{const{__scopeMenu:s,open:r=!1,children:a,dir:n,onOpenChange:i,modal:o=!0}=t,l=Rl(s),[u,d]=h.useState(null),c=h.useRef(!1),f=Lt(i),m=zi(n);return h.useEffect(()=>{const y=()=>{c.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>c.current=!1;return document.addEventListener("keydown",y,{capture:!0}),()=>{document.removeEventListener("keydown",y,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),e.jsx(Q0,{...l,children:e.jsx(fI,{scope:s,open:r,onOpenChange:f,content:u,onContentChange:d,children:e.jsx(pI,{scope:s,onClose:h.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:c,dir:m,modal:o,children:a})})})};r2.displayName=Ji;var xI="MenuAnchor",Uu=h.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t,n=Rl(r);return e.jsx(al,{...n,...a,ref:s})});Uu.displayName=xI;var Wu="MenuPortal",[gI,a2]=nn(Wu,{forceMount:void 0}),n2=t=>{const{__scopeMenu:s,forceMount:r,children:a,container:n}=t,i=on(Wu,s);return e.jsx(gI,{scope:s,forceMount:r,children:e.jsx(ws,{present:r||i.open,children:e.jsx(J1,{asChild:!0,container:n,children:a})})})};n2.displayName=Wu;var cr="MenuContent",[yI,Ku]=nn(cr),i2=h.forwardRef((t,s)=>{const r=a2(cr,t.__scopeMenu),{forceMount:a=r.forceMount,...n}=t,i=on(cr,t.__scopeMenu),o=eo(cr,t.__scopeMenu);return e.jsx($i.Provider,{scope:t.__scopeMenu,children:e.jsx(ws,{present:a||i.open,children:e.jsx($i.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx(vI,{...n,ref:s}):e.jsx(bI,{...n,ref:s})})})})}),vI=h.forwardRef((t,s)=>{const r=on(cr,t.__scopeMenu),a=h.useRef(null),n=lt(s,a);return h.useEffect(()=>{const i=a.current;if(i)return fd(i)},[]),e.jsx(Hu,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Ne(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),bI=h.forwardRef((t,s)=>{const r=on(cr,t.__scopeMenu);return e.jsx(Hu,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),jI=hd("MenuContent.ScrollLock"),Hu=h.forwardRef((t,s)=>{const{__scopeMenu:r,loop:a=!1,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:u,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:f,onInteractOutside:m,onDismiss:y,disableOutsideScroll:x,...p}=t,A=on(cr,r),g=eo(cr,r),N=Rl(r),w=s2(r),_=mI(r),[b,k]=h.useState(null),R=h.useRef(null),I=lt(s,R,A.onContentChange),E=h.useRef(0),O=h.useRef(""),T=h.useRef(0),S=h.useRef(null),M=h.useRef("right"),v=h.useRef(0),W=x?md:h.Fragment,j=x?{as:jI,allowPinchZoom:!0}:void 0,V=F=>{const ye=O.current+F,fe=_().filter(Z=>!Z.disabled),de=document.activeElement,ke=fe.find(Z=>Z.ref.current===de)?.textValue,nt=fe.map(Z=>Z.textValue),ct=MI(nt,ye,ke),it=fe.find(Z=>Z.textValue===ct)?.ref.current;(function Z(U){O.current=U,window.clearTimeout(E.current),U!==""&&(E.current=window.setTimeout(()=>Z(""),1e3))})(ye),it&&setTimeout(()=>it.focus())};h.useEffect(()=>()=>window.clearTimeout(E.current),[]),pd();const ne=h.useCallback(F=>M.current===S.current?.side&&II(F,S.current?.area),[]);return e.jsx(yI,{scope:r,searchRef:O,onItemEnter:h.useCallback(F=>{ne(F)&&F.preventDefault()},[ne]),onItemLeave:h.useCallback(F=>{ne(F)||(R.current?.focus(),k(null))},[ne]),onTriggerLeave:h.useCallback(F=>{ne(F)&&F.preventDefault()},[ne]),pointerGraceTimerRef:T,onPointerGraceIntentChange:h.useCallback(F=>{S.current=F},[]),children:e.jsx(W,{...j,children:e.jsx(Z1,{asChild:!0,trapped:n,onMountAutoFocus:Ne(i,F=>{F.preventDefault(),R.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(Q1,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:f,onInteractOutside:m,onDismiss:y,children:e.jsx(hu,{asChild:!0,...w,dir:g.dir,orientation:"vertical",loop:a,currentTabStopId:b,onCurrentTabStopIdChange:k,onEntryFocus:Ne(u,F=>{g.isUsingKeyboardRef.current||F.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(od,{role:"menu","aria-orientation":"vertical","data-state":N2(A.open),"data-radix-menu-content":"",dir:g.dir,...N,...p,ref:I,style:{outline:"none",...p.style},onKeyDown:Ne(p.onKeyDown,F=>{const fe=F.target.closest("[data-radix-menu-content]")===F.currentTarget,de=F.ctrlKey||F.altKey||F.metaKey,ke=F.key.length===1;fe&&(F.key==="Tab"&&F.preventDefault(),!de&&ke&&V(F.key));const nt=R.current;if(F.target!==nt||!cI.includes(F.key))return;F.preventDefault();const it=_().filter(Z=>!Z.disabled).map(Z=>Z.ref.current);e2.includes(F.key)&&it.reverse(),EI(it)}),onBlur:Ne(t.onBlur,F=>{F.currentTarget.contains(F.target)||(window.clearTimeout(E.current),O.current="")}),onPointerMove:Ne(t.onPointerMove,Li(F=>{const ye=F.target,fe=v.current!==F.clientX;if(F.currentTarget.contains(ye)&&fe){const de=F.clientX>v.current?"right":"left";M.current=de,v.current=F.clientX}}))})})})})})})});i2.displayName=cr;var NI="MenuGroup",Gu=h.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return e.jsx(We.div,{role:"group",...a,ref:s})});Gu.displayName=NI;var wI="MenuLabel",o2=h.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return e.jsx(We.div,{...a,ref:s})});o2.displayName=wI;var el="MenuItem",Kf="menu.itemSelect",Il=h.forwardRef((t,s)=>{const{disabled:r=!1,onSelect:a,...n}=t,i=h.useRef(null),o=eo(el,t.__scopeMenu),l=Ku(el,t.__scopeMenu),u=lt(s,i),d=h.useRef(!1),c=()=>{const f=i.current;if(!r&&f){const m=new CustomEvent(Kf,{bubbles:!0,cancelable:!0});f.addEventListener(Kf,y=>a?.(y),{once:!0}),Vi(f,m),m.defaultPrevented?d.current=!1:o.onClose()}};return e.jsx(l2,{...n,ref:u,disabled:r,onClick:Ne(t.onClick,c),onPointerDown:f=>{t.onPointerDown?.(f),d.current=!0},onPointerUp:Ne(t.onPointerUp,f=>{d.current||f.currentTarget?.click()}),onKeyDown:Ne(t.onKeyDown,f=>{const m=l.searchRef.current!=="";r||m&&f.key===" "||ad.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});Il.displayName=el;var l2=h.forwardRef((t,s)=>{const{__scopeMenu:r,disabled:a=!1,textValue:n,...i}=t,o=Ku(el,r),l=s2(r),u=h.useRef(null),d=lt(s,u),[c,f]=h.useState(!1),[m,y]=h.useState("");return h.useEffect(()=>{const x=u.current;x&&y((x.textContent??"").trim())},[i.children]),e.jsx($i.ItemSlot,{scope:r,disabled:a,textValue:n??m,children:e.jsx(fu,{asChild:!0,...l,focusable:!a,children:e.jsx(We.div,{role:"menuitem","data-highlighted":c?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...i,ref:d,onPointerMove:Ne(t.onPointerMove,Li(x=>{a?o.onItemLeave(x):(o.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ne(t.onPointerLeave,Li(x=>o.onItemLeave(x))),onFocus:Ne(t.onFocus,()=>f(!0)),onBlur:Ne(t.onBlur,()=>f(!1))})})})}),kI="MenuCheckboxItem",c2=h.forwardRef((t,s)=>{const{checked:r=!1,onCheckedChange:a,...n}=t;return e.jsx(f2,{scope:t.__scopeMenu,checked:r,children:e.jsx(Il,{role:"menuitemcheckbox","aria-checked":tl(r)?"mixed":r,...n,ref:s,"data-state":Xu(r),onSelect:Ne(n.onSelect,()=>a?.(tl(r)?!0:!r),{checkForDefaultPrevented:!1})})})});c2.displayName=kI;var d2="MenuRadioGroup",[SI,TI]=nn(d2,{value:void 0,onValueChange:()=>{}}),u2=h.forwardRef((t,s)=>{const{value:r,onValueChange:a,...n}=t,i=Lt(a);return e.jsx(SI,{scope:t.__scopeMenu,value:r,onValueChange:i,children:e.jsx(Gu,{...n,ref:s})})});u2.displayName=d2;var m2="MenuRadioItem",h2=h.forwardRef((t,s)=>{const{value:r,...a}=t,n=TI(m2,t.__scopeMenu),i=r===n.value;return e.jsx(f2,{scope:t.__scopeMenu,checked:i,children:e.jsx(Il,{role:"menuitemradio","aria-checked":i,...a,ref:s,"data-state":Xu(i),onSelect:Ne(a.onSelect,()=>n.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});h2.displayName=m2;var Qu="MenuItemIndicator",[f2,AI]=nn(Qu,{checked:!1}),p2=h.forwardRef((t,s)=>{const{__scopeMenu:r,forceMount:a,...n}=t,i=AI(Qu,r);return e.jsx(ws,{present:a||tl(i.checked)||i.checked===!0,children:e.jsx(We.span,{...n,ref:s,"data-state":Xu(i.checked)})})});p2.displayName=Qu;var CI="MenuSeparator",x2=h.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return e.jsx(We.div,{role:"separator","aria-orientation":"horizontal",...a,ref:s})});x2.displayName=CI;var PI="MenuArrow",g2=h.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t,n=Rl(r);return e.jsx(ld,{...n,...a,ref:s})});g2.displayName=PI;var _I="MenuSub",[HF,y2]=nn(_I),ai="MenuSubTrigger",v2=h.forwardRef((t,s)=>{const r=on(ai,t.__scopeMenu),a=eo(ai,t.__scopeMenu),n=y2(ai,t.__scopeMenu),i=Ku(ai,t.__scopeMenu),o=h.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:u}=i,d={__scopeMenu:t.__scopeMenu},c=h.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return h.useEffect(()=>c,[c]),h.useEffect(()=>{const f=l.current;return()=>{window.clearTimeout(f),u(null)}},[l,u]),e.jsx(Uu,{asChild:!0,...d,children:e.jsx(l2,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":n.contentId,"data-state":N2(r.open),...t,ref:X0(s,n.onTriggerChange),onClick:f=>{t.onClick?.(f),!(t.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Ne(t.onPointerMove,Li(f=>{i.onItemEnter(f),!f.defaultPrevented&&!t.disabled&&!r.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{r.onOpenChange(!0),c()},100))})),onPointerLeave:Ne(t.onPointerLeave,Li(f=>{c();const m=r.content?.getBoundingClientRect();if(m){const y=r.content?.dataset.side,x=y==="right",p=x?-5:5,A=m[x?"left":"right"],g=m[x?"right":"left"];i.onPointerGraceIntentChange({area:[{x:f.clientX+p,y:f.clientY},{x:A,y:m.top},{x:g,y:m.top},{x:g,y:m.bottom},{x:A,y:m.bottom}],side:y}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(f),f.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:Ne(t.onKeyDown,f=>{const m=i.searchRef.current!=="";t.disabled||m&&f.key===" "||dI[a.dir].includes(f.key)&&(r.onOpenChange(!0),r.content?.focus(),f.preventDefault())})})})});v2.displayName=ai;var b2="MenuSubContent",j2=h.forwardRef((t,s)=>{const r=a2(cr,t.__scopeMenu),{forceMount:a=r.forceMount,...n}=t,i=on(cr,t.__scopeMenu),o=eo(cr,t.__scopeMenu),l=y2(b2,t.__scopeMenu),u=h.useRef(null),d=lt(s,u);return e.jsx($i.Provider,{scope:t.__scopeMenu,children:e.jsx(ws,{present:a||i.open,children:e.jsx($i.Slot,{scope:t.__scopeMenu,children:e.jsx(Hu,{id:l.contentId,"aria-labelledby":l.triggerId,...n,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:c=>{o.isUsingKeyboardRef.current&&u.current?.focus(),c.preventDefault()},onCloseAutoFocus:c=>c.preventDefault(),onFocusOutside:Ne(t.onFocusOutside,c=>{c.target!==l.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:Ne(t.onEscapeKeyDown,c=>{o.onClose(),c.preventDefault()}),onKeyDown:Ne(t.onKeyDown,c=>{const f=c.currentTarget.contains(c.target),m=uI[o.dir].includes(c.key);f&&m&&(i.onOpenChange(!1),l.trigger?.focus(),c.preventDefault())})})})})})});j2.displayName=b2;function N2(t){return t?"open":"closed"}function tl(t){return t==="indeterminate"}function Xu(t){return tl(t)?"indeterminate":t?"checked":"unchecked"}function EI(t){const s=document.activeElement;for(const r of t)if(r===s||(r.focus(),document.activeElement!==s))return}function DI(t,s){return t.map((r,a)=>t[(s+a)%t.length])}function MI(t,s,r){const n=s.length>1&&Array.from(s).every(d=>d===s[0])?s[0]:s,i=r?t.indexOf(r):-1;let o=DI(t,Math.max(i,0));n.length===1&&(o=o.filter(d=>d!==r));const u=o.find(d=>d.toLowerCase().startsWith(n.toLowerCase()));return u!==r?u:void 0}function RI(t,s){const{x:r,y:a}=t;let n=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const l=s[i].x,u=s[i].y,d=s[o].x,c=s[o].y;u>a!=c>a&&r<(d-l)*(a-u)/(c-u)+l&&(n=!n)}return n}function II(t,s){if(!s)return!1;const r={x:t.clientX,y:t.clientY};return RI(r,s)}function Li(t){return s=>s.pointerType==="mouse"?t(s):void 0}var FI=r2,OI=Uu,$I=n2,LI=i2,VI=Gu,zI=o2,BI=Il,qI=c2,UI=u2,WI=h2,KI=p2,HI=x2,GI=g2,QI=v2,XI=j2,Zu="DropdownMenu",[ZI]=Hs(Zu,[t2]),Vs=t2(),[YI,w2]=ZI(Zu),k2=t=>{const{__scopeDropdownMenu:s,children:r,dir:a,open:n,defaultOpen:i,onOpenChange:o,modal:l=!0}=t,u=Vs(s),d=h.useRef(null),[c=!1,f]=Pa({prop:n,defaultProp:i,onChange:o});return e.jsx(YI,{scope:s,triggerId:pa(),triggerRef:d,contentId:pa(),open:c,onOpenChange:f,onOpenToggle:h.useCallback(()=>f(m=>!m),[f]),modal:l,children:e.jsx(FI,{...u,open:c,onOpenChange:f,dir:a,modal:l,children:r})})};k2.displayName=Zu;var S2="DropdownMenuTrigger",T2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...n}=t,i=w2(S2,r),o=Vs(r);return e.jsx(OI,{asChild:!0,...o,children:e.jsx(We.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...n,ref:X0(s,i.triggerRef),onPointerDown:Ne(t.onPointerDown,l=>{!a&&l.button===0&&l.ctrlKey===!1&&(i.onOpenToggle(),i.open||l.preventDefault())}),onKeyDown:Ne(t.onKeyDown,l=>{a||(["Enter"," "].includes(l.key)&&i.onOpenToggle(),l.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});T2.displayName=S2;var JI="DropdownMenuPortal",A2=t=>{const{__scopeDropdownMenu:s,...r}=t,a=Vs(s);return e.jsx($I,{...a,...r})};A2.displayName=JI;var C2="DropdownMenuContent",P2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=w2(C2,r),i=Vs(r),o=h.useRef(!1);return e.jsx(LI,{id:n.contentId,"aria-labelledby":n.triggerId,...i,...a,ref:s,onCloseAutoFocus:Ne(t.onCloseAutoFocus,l=>{o.current||n.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:Ne(t.onInteractOutside,l=>{const u=l.detail.originalEvent,d=u.button===0&&u.ctrlKey===!0,c=u.button===2||d;(!n.modal||c)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});P2.displayName=C2;var eF="DropdownMenuGroup",tF=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(VI,{...n,...a,ref:s})});tF.displayName=eF;var sF="DropdownMenuLabel",_2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(zI,{...n,...a,ref:s})});_2.displayName=sF;var rF="DropdownMenuItem",E2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(BI,{...n,...a,ref:s})});E2.displayName=rF;var aF="DropdownMenuCheckboxItem",D2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(qI,{...n,...a,ref:s})});D2.displayName=aF;var nF="DropdownMenuRadioGroup",iF=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(UI,{...n,...a,ref:s})});iF.displayName=nF;var oF="DropdownMenuRadioItem",M2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(WI,{...n,...a,ref:s})});M2.displayName=oF;var lF="DropdownMenuItemIndicator",R2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(KI,{...n,...a,ref:s})});R2.displayName=lF;var cF="DropdownMenuSeparator",I2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(HI,{...n,...a,ref:s})});I2.displayName=cF;var dF="DropdownMenuArrow",uF=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(GI,{...n,...a,ref:s})});uF.displayName=dF;var mF="DropdownMenuSubTrigger",F2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(QI,{...n,...a,ref:s})});F2.displayName=mF;var hF="DropdownMenuSubContent",O2=h.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Vs(r);return e.jsx(XI,{...n,...a,ref:s,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});O2.displayName=hF;var fF=k2,pF=T2,xF=A2,$2=P2,L2=_2,V2=E2,z2=D2,B2=M2,q2=R2,U2=I2,W2=F2,K2=O2;const gF=fF,yF=pF,vF=h.forwardRef(({className:t,inset:s,children:r,...a},n)=>e.jsxs(W2,{ref:n,className:he("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...a,children:[r,e.jsx(Ik,{className:"ml-auto"})]}));vF.displayName=W2.displayName;const bF=h.forwardRef(({className:t,...s},r)=>e.jsx(K2,{ref:r,className:he("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));bF.displayName=K2.displayName;const H2=h.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(xF,{children:e.jsx($2,{ref:a,sideOffset:s,className:he("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...r})}));H2.displayName=$2.displayName;const ko=h.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(V2,{ref:a,className:he("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...r}));ko.displayName=V2.displayName;const jF=h.forwardRef(({className:t,children:s,checked:r,...a},n)=>e.jsxs(z2,{ref:n,className:he("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(q2,{children:e.jsx(gd,{className:"h-4 w-4"})})}),s]}));jF.displayName=z2.displayName;const NF=h.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(B2,{ref:a,className:he("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(q2,{children:e.jsx(ay,{className:"h-2 w-2 fill-current"})})}),s]}));NF.displayName=B2.displayName;const wF=h.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(L2,{ref:a,className:he("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...r}));wF.displayName=L2.displayName;const nd=h.forwardRef(({className:t,...s},r)=>e.jsx(U2,{ref:r,className:he("-mx-1 my-1 h-px bg-muted",t),...s}));nd.displayName=U2.displayName;const kF={"/":{title:"لوحة التحكم",icon:yd},"/projects":{title:"إدارة المشاريع",icon:Cs},"/workers":{title:"إدارة العمال",icon:_t},"/suppliers-pro":{title:"إدارة الموردين",icon:qa},"/worker-attendance":{title:"حضور العمال",icon:Ui},"/worker-accounts":{title:"حسابات العمال",icon:us},"/daily-expenses":{title:"المصاريف اليومية",icon:sy},"/material-purchase":{title:"شراء المواد",icon:ra},"/project-transfers":{title:"تحويلات العهدة",icon:xa},"/project-transactions":{title:"سجل العمليات",icon:lr},"/project-transactions-simple":{title:"سجل العمليات المبسط",icon:lr},"/supplier-accounts":{title:"حسابات الموردين",icon:Ga},"/reports":{title:"التقارير",icon:Sn},"/autocomplete-admin":{title:"إعدادات الإكمال التلقائي",icon:nr},"/tools-management":{title:"إدارة الأدوات والمعدات",icon:nr},"/notifications":{title:"الإشعارات",icon:hs},"/ai-system":{title:"النظام الذكي",icon:Qt},"/smart-errors":{title:"كشف الأخطاء الذكي",icon:Qt},"/data-migration":{title:"هجرة البيانات من Supabase",icon:xa},"/migration-dashboard":{title:"لوحة تحكم هجرة البيانات",icon:xa}};function SF(){const[t,s]=Or(),{user:r,logout:a,isAuthenticated:n}=qn(),{toast:i}=Ct(),[o,l]=h.useState(!1),u=kF[t]||{title:"إدارة المشاريع الإنشائية",icon:Wk},d=u.icon;return e.jsx("header",{className:"bg-primary text-primary-foreground shadow-lg sticky top-0 z-50",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-3",children:[e.jsx(d,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-lg font-bold",children:u.title})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx($,{variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-primary/80",onClick:()=>s("/print-control"),title:"التحكم في الطباعة",children:e.jsx(rs,{className:"h-4 w-4"})}),e.jsx(KR,{}),n?e.jsxs(gF,{children:[e.jsx(yF,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-primary/80 relative","data-testid":"user-menu-trigger",children:[e.jsx(hm,{className:"h-5 w-5"}),r&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full w-3 h-3 border-2 border-primary"})]})}),e.jsxs(H2,{align:"end",className:"w-56",children:[e.jsxs("div",{className:"px-3 py-2 text-sm",children:[e.jsx("div",{className:"font-medium text-foreground",children:r?.name||"المستخدم"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r?.email}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Qt,{className:"h-3 w-3"}),r?.role==="admin"?"مدير النظام":"مستخدم"]})})]}),e.jsx(nd,{}),e.jsxs(ko,{onClick:()=>s("/profile"),className:"cursor-pointer","data-testid":"menu-profile",children:[e.jsx(Zs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"الملف الشخصي"})]}),e.jsxs(ko,{onClick:()=>s("/settings"),className:"cursor-pointer","data-testid":"menu-settings",children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"الإعدادات"})]}),e.jsx(nd,{}),e.jsxs(ko,{onClick:async()=>{l(!0);try{await a(),i({title:"تم تسجيل الخروج بنجاح",description:"شكراً لاستخدام النظام"}),s("/login")}catch{i({title:"خطأ في تسجيل الخروج",description:"حدث خطأ أثناء تسجيل الخروج",variant:"destructive"})}finally{l(!1)}},className:"cursor-pointer text-red-600 focus:text-red-600 focus:bg-red-50 dark:focus:bg-red-900/50",disabled:o,"data-testid":"menu-logout",children:[e.jsx(Hk,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:o?"جارِ تسجيل الخروج...":"تسجيل الخروج"})]})]})]}):e.jsx($,{variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-primary/80",onClick:()=>s("/login"),"data-testid":"login-button",children:e.jsx(hm,{className:"h-5 w-5"})})]})]})})})}const TF=L0,AF=V0,CF=O0,G2=h.forwardRef(({className:t,...s},r)=>e.jsx(nl,{className:he("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));G2.displayName=nl.displayName;const PF=Ln("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Q2=h.forwardRef(({side:t="right",className:s,children:r,...a},n)=>e.jsxs(CF,{children:[e.jsx(G2,{}),e.jsxs(il,{ref:n,className:he(PF({side:t}),s),...a,children:[r,e.jsxs($0,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(yr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Q2.displayName=il.displayName;const X2=({className:t,...s})=>e.jsx("div",{className:he("flex flex-col space-y-2 text-center sm:text-left",t),...s});X2.displayName="SheetHeader";const Z2=h.forwardRef(({className:t,...s},r)=>e.jsx(ol,{ref:r,className:he("text-lg font-semibold text-foreground",t),...s}));Z2.displayName=ol.displayName;const _F=h.forwardRef(({className:t,...s},r)=>e.jsx(ll,{ref:r,className:he("text-sm text-muted-foreground",t),...s}));_F.displayName=ll.displayName;const EF=[{path:"/",icon:yd,label:"الرئيسية",key:"dashboard"},{path:"/projects",icon:Cs,label:"المشاريع",key:"projects"},{path:"/workers",icon:_t,label:"العمال",key:"workers"},{path:"/suppliers-pro",icon:qa,label:"الموردين",key:"suppliers"}],DF=[{category:"الصفحات الرئيسية",pages:[{path:"/",icon:yd,label:"لوحة التحكم",description:"عرض شامل للمشاريع والإحصائيات",requireAdmin:!1},{path:"/projects",icon:Cs,label:"إدارة المشاريع",description:"إضافة وإدارة المشاريع",requireAdmin:!1},{path:"/workers",icon:_t,label:"إدارة العمال",description:"إضافة وإدارة العمال والحرفيين",requireAdmin:!1},{path:"/suppliers-pro",icon:qa,label:"إدارة الموردين",description:"إدارة الموردين والموزعين",requireAdmin:!1}]},{category:"العمليات اليومية",pages:[{path:"/worker-attendance",icon:Ui,label:"حضور العمال",description:"تسجيل حضور وغياب العمال",requireAdmin:!1},{path:"/daily-expenses",icon:sy,label:"المصاريف اليومية",description:"تسجيل المصاريف اليومية للمشاريع",requireAdmin:!1},{path:"/material-purchase",icon:ra,label:"شراء المواد",description:"إدارة مشتريات مواد البناء",requireAdmin:!1},{path:"/worker-accounts",icon:us,label:"حسابات العمال",description:"إدارة حوالات وتحويلات العمال",requireAdmin:!0},{path:"/equipment",icon:rs,label:"إدارة المعدات",description:"إدارة المعدات مع النقل والتتبع",requireAdmin:!0},{path:"/project-transfers",icon:xa,label:"تحويلات العهدة",description:"إدارة تحويلات الأموال بين المشاريع",requireAdmin:!0},{path:"/project-transactions",icon:lr,label:"سجل العمليات",description:"عرض شامل لجميع المعاملات المالية",requireAdmin:!0}]},{category:"إدارة الموردين",pages:[{path:"/supplier-accounts",icon:Ga,label:"حسابات الموردين",description:"إدارة حسابات ودفعات الموردين",requireAdmin:!0}]},{category:"التقارير والإحصائيات",pages:[{path:"/reports",icon:Sn,label:"التقارير الأساسية",description:"التقارير المالية الأساسية",requireAdmin:!0},{path:"/advanced-reports",icon:Kt,label:"التقارير المتقدمة",description:"تقارير مالية متقدمة وتحليلات شاملة",requireAdmin:!0},{path:"/workers-unified-reports",icon:_t,label:"تقارير العمال الموحدة",description:"تقارير شاملة لحسابات وحضور العمال",requireAdmin:!0}]},{category:"الإشعارات والتنبيهات",pages:[{path:"/notifications",icon:hs,label:"الإشعارات",description:"عرض وإدارة إشعارات النظام",requireAdmin:!1}]},{category:"النظام الذكي والأمان",pages:[{path:"/ai-system",icon:un,label:"النظام الذكي",description:"مراقبة ذكية ولوحة تحكم الذكاء الاصطناعي",requireAdmin:!0},{path:"/security-policies",icon:Qt,label:"السياسات الأمنية",description:"إدارة السياسات الأمنية والامتثال",requireAdmin:!0},{path:"/smart-errors",icon:$t,label:"كشف الأخطاء الذكي",description:"مراقبة وتحليل أخطاء قاعدة البيانات بذكاء اصطناعي",requireAdmin:!0},{path:"/smart-data-fetcher",icon:$t,label:"جلب البيانات الذكي",description:"نظام النسخ الاحتياطي من Supabase إلى قاعدة البيانات المحلية",requireAdmin:!0},{path:"/data-migration",icon:$t,label:"هجرة البيانات",description:"نظام النسخ الاحتياطي من Supabase إلى قاعدة البيانات المحلية",requireAdmin:!0},{path:"/migration-dashboard",icon:xa,label:"لوحة تحكم هجرة البيانات",description:"مراقبة وإدارة عمليات هجرة البيانات في الوقت الفعلي مع الإحصائيات التفصيلية",requireAdmin:!0}]},{category:"الإعدادات والإدارة",pages:[{path:"/autocomplete-admin",icon:nr,label:"إعدادات الإكمال التلقائي",description:"إدارة بيانات الإكمال التلقائي",requireAdmin:!0},{path:"/admin-notifications",icon:hs,label:"إشعارات المسؤولين",description:"إدارة وإرسال إشعارات للمستخدمين",requireAdmin:!0}]}];function MF(){const[t,s]=Or(),[r,a]=h.useState(!1),{user:n}=qn(),i=n?.role==="admin",o=DF.map(u=>({...u,pages:u.pages.filter(d=>!d.requireAdmin||i)})).filter(u=>u.pages.length>0),l=u=>{s(u),a(!1)};return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border z-50",children:e.jsxs("div",{className:"grid grid-cols-5 h-16",children:[EF.map(u=>{const d=u.icon,c=t===u.path;return e.jsxs($,{variant:"ghost",className:`flex flex-col items-center justify-center space-y-1 h-full rounded-none ${c?"text-primary":"text-muted-foreground"}`,onClick:()=>s(u.path),children:[e.jsx(d,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:u.label})]},u.key)}),e.jsxs(TF,{open:r,onOpenChange:a,children:[e.jsx(AF,{asChild:!0,children:e.jsxs($,{variant:"ghost",className:"flex flex-col items-center justify-center space-y-1 h-full rounded-none text-muted-foreground hover:text-primary",children:[e.jsx(Vk,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"المزيد"})]})}),e.jsxs(Q2,{side:"bottom",className:"h-[85vh] max-w-full px-3",children:[e.jsx(X2,{className:"mb-4 px-1",children:e.jsx(Z2,{className:"text-right text-lg",children:"جميع الصفحات"})}),e.jsx(Zr,{className:"h-full",children:e.jsx("div",{className:"space-y-3 pb-20 px-1",children:o.map((u,d)=>e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2 text-primary text-right border-b border-border pb-1 pr-2 truncate",children:u.category}),e.jsx("div",{className:"space-y-1",children:u.pages.map((c,f)=>{const m=c.icon,y=t===c.path;return e.jsx($,{variant:y?"default":"ghost",className:"w-full justify-start h-auto p-3 min-h-[60px] text-right",onClick:()=>l(c.path),children:e.jsxs("div",{className:"flex items-start gap-3 w-full text-right",children:[e.jsx(m,{className:`h-5 w-5 mt-0.5 flex-shrink-0 ${y?"text-primary-foreground":"text-primary"}`}),e.jsxs("div",{className:"flex-1 min-w-0 text-right overflow-hidden",children:[e.jsx("div",{className:`font-medium text-sm leading-snug text-right truncate ${y?"text-primary-foreground":""}`,children:c.label}),e.jsx("div",{className:`text-xs mt-1 leading-tight text-right break-words hyphens-auto ${y?"text-primary-foreground/80":"text-muted-foreground"}`,style:{wordWrap:"break-word",overflowWrap:"break-word"},children:c.description})]})]})},f)})}),d<o.length-1&&e.jsx(Is,{className:"my-3"})]},d))})})]})]})]})})}function RF(){const{floatingAction:t,floatingLabel:s}=Ls();if(!t)return null;const r=()=>{t&&t()};return e.jsx($,{onClick:r,className:"fixed bottom-20 right-4 z-40 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 bg-primary hover:bg-primary/90",size:"icon",title:s,children:e.jsx(bs,{className:"h-6 w-6"})})}function id({message:t="جاري تحميل التطبيق...",showProgress:s=!1,progress:r=0}){return e.jsxs("div",{className:"fixed inset-0 bg-gradient-to-br from-primary/10 via-background to-secondary/10 flex items-center justify-center z-50",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-primary/20 rounded-full blur-xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-secondary/20 rounded-full blur-xl animate-pulse delay-1000"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 w-60 h-60 bg-accent/20 rounded-full blur-xl animate-pulse delay-500"})]}),e.jsxs("div",{className:"relative text-center p-8",children:[e.jsx(Ss.div,{className:"mb-8",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{duration:.8,ease:"easeOut"},children:e.jsxs("div",{className:"relative w-24 h-24 mx-auto",children:[e.jsx(Ss.div,{className:"absolute inset-0 border-4 border-primary/30 rounded-full",animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"}}),e.jsx(Ss.div,{className:"absolute inset-2 border-4 border-secondary/50 rounded-full",animate:{rotate:-360},transition:{duration:1.5,repeat:1/0,ease:"linear"}}),e.jsx(Ss.div,{className:"absolute inset-4 bg-gradient-to-br from-primary to-secondary rounded-full shadow-lg",animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-tr from-white/20 to-transparent"})}),e.jsx(Ss.div,{className:"absolute inset-0 flex items-center justify-center text-white text-xl",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:"🏗️"})]})}),e.jsx(Ss.h1,{className:"text-2xl font-bold text-foreground mb-2",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.6},children:"نظام إدارة المشاريع الإنشائية"}),e.jsx(Ss.p,{className:"text-muted-foreground mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.6},children:t}),e.jsx(Ss.div,{className:"flex justify-center space-x-2 mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:1,duration:.6},children:[0,1,2].map(a=>e.jsx(Ss.div,{className:"w-3 h-3 bg-primary rounded-full",animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:.8,repeat:1/0,delay:a*.2,ease:"easeInOut"}},a))}),s&&e.jsxs(Ss.div,{className:"w-64 mx-auto",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.2,duration:.6},children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground mb-2",children:[e.jsx("span",{children:"جاري التحميل"}),e.jsxs("span",{children:[Math.round(r),"%"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx(Ss.div,{className:"h-full bg-gradient-to-r from-primary to-secondary rounded-full",style:{width:`${r}%`},initial:{width:0},animate:{width:`${r}%`},transition:{duration:.3,ease:"easeOut"}})})]}),e.jsx(Ss.p,{className:"text-xs text-muted-foreground mt-4 max-w-xs mx-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:1.4,duration:.6},children:"نحن نحضر لك أفضل تجربة لإدارة مشاريعك الإنشائية"}),e.jsx(Ss.div,{className:"text-xs text-muted-foreground/50 mt-2 text-center space-y-1",initial:{opacity:0},animate:{opacity:.3},transition:{delay:2,duration:.6},children:e.jsx("p",{className:"opacity-0 hover:opacity-100 transition-opacity duration-300",children:"Esc: تخطي الآن | Ctrl+S: تخطي دائماً"})})]})]})}function hr({children:t}){const{isAuthenticated:s,isLoading:r,user:a}=qn(),[n,i]=h.useState(!1),o=typeof window<"u"&&localStorage.getItem("user")&&localStorage.getItem("accessToken");if(console.log("🛡️ [ProtectedRoute] فحص الحماية:",{isLoading:r,isAuthenticated:s,hasStoredAuth:o,userEmail:a?.email||"غير موجود",authCheckComplete:n,timestamp:new Date().toISOString()}),h.useEffect(()=>{if(!r){const l=setTimeout(()=>{i(!0)},1e3);return()=>clearTimeout(l)}},[r]),r||!n&&o)return console.log("⏳ [ProtectedRoute] في حالة تحميل، إظهار شاشة التحميل"),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(id,{})});if(s&&a){console.log("✅ [ProtectedRoute] مصادق عليه، إظهار المحتوى للمستخدم:",a.email);try{return e.jsx(e.Fragment,{children:t})}catch(l){return console.error("❌ [ProtectedRoute] خطأ في تحميل المحتوى:",l),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:"خطأ في تحميل الصفحة"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"حدث خطأ أثناء تحميل المحتوى. يرجى إعادة تحميل الصفحة."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"إعادة تحميل"})]})})}}if(o&&!a&&n){console.log("⚠️ [ProtectedRoute] بيانات محفوظة موجودة لكن المستخدم غير محمل، إعادة المحاولة...");try{const l=localStorage.getItem("user");if(l){const u=JSON.parse(l);if(u&&u.email)return console.log("✅ [ProtectedRoute] تم استرجاع بيانات المستخدم من localStorage"),e.jsx(e.Fragment,{children:t})}}catch(l){console.error("❌ [ProtectedRoute] خطأ في استرجاع بيانات المستخدم من localStorage:",l)}}return!s&&!o&&n?(console.log("🚫 [ProtectedRoute] لا توجد بيانات مصادقة، إعادة توجيه إلى /login"),e.jsx(jc,{to:"/login"})):o&&!s&&n?(console.log("🧹 [ProtectedRoute] تنظيف البيانات الفاسدة وإعادة التوجيه"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),e.jsx(jc,{to:"/login"})):(console.log("⏳ [ProtectedRoute] حالة افتراضية، إظهار شاشة التحميل"),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(id,{})}))}function gs({children:t,requiredRole:s="admin"}){const{user:r,isAuthenticated:a,isLoading:n}=qn();return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(id,{})}):a?!r||r.role!==s?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs(en,{variant:"destructive",className:"text-center",children:[e.jsx(sS,{className:"h-6 w-6 mx-auto mb-2"}),e.jsxs(tn,{className:"text-lg",children:[e.jsx("strong",{children:"غير مصرح لك بالوصول"}),e.jsx("br",{}),"هذه الصفحة مخصصة للمسؤولين فقط",e.jsx("br",{}),e.jsxs("span",{className:"text-sm opacity-80",children:["دورك الحالي: ",r?.role||"غير محدد"]})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("a",{href:"/",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"العودة للصفحة الرئيسية"})})]})}):e.jsx(e.Fragment,{children:t}):e.jsx(jc,{to:"/login"})}function Pt({children:t}){return e.jsxs(e.Fragment,{children:[e.jsx(SF,{}),e.jsx("main",{className:"pb-20",children:t}),e.jsx(MF,{}),e.jsx(RF,{})]})}function IF(){return console.log("🧭 [App.Router] بدء تحميل Router...",new Date().toISOString()),e.jsxs(hk,{children:[e.jsx(gt,{path:"/login",component:Xh}),e.jsx(gt,{path:"/register",component:Xh}),e.jsx(gt,{path:"/forgot-password",component:()=>xd(()=>import("./ForgotPasswordPage-CRIGEQMc.js"),__vite__mapDeps([3,4,1,5,6,7])).then(t=>t.default)}),e.jsx(gt,{path:"/",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(K_,{})})})}),e.jsx(gt,{path:"/projects",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(o6,{})})})}),e.jsx(gt,{path:"/workers",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(u6,{})})})}),e.jsx(gt,{path:"/worker-accounts",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(m6,{})})})}),e.jsx(gt,{path:"/suppliers",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(wf,{})})})}),e.jsx(gt,{path:"/suppliers-pro",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(wf,{})})})}),e.jsx(gt,{path:"/supplier-accounts",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(j6,{})})})}),e.jsx(gt,{path:"/worker-attendance",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(VE,{})})})}),e.jsx(gt,{path:"/daily-expenses",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(UE,{})})})}),e.jsx(gt,{path:"/material-purchase",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(Zh,{})})})}),e.jsx(gt,{path:"/material-purchases",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(Zh,{})})})}),e.jsx(gt,{path:"/project-transfers",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(I5,{})})})}),e.jsx(gt,{path:"/project-transactions",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(pM,{})})})}),e.jsx(gt,{path:"/autocomplete-admin",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(P6,{})})})}),e.jsx(gt,{path:"/equipment",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(Cf,{})})})}),e.jsx(gt,{path:"/equipment-management",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(Cf,{})})})}),e.jsx(gt,{path:"/reports",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(n3,{})})})}),e.jsx(gt,{path:"/advanced-reports",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx($6,{})})})}),e.jsx(gt,{path:"/workers-unified-reports",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(L6,{})})})}),e.jsx(gt,{path:"/notifications",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(B6,{})})})}),e.jsx(gt,{path:"/admin-notifications",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(W6,{})})})}),e.jsx(gt,{path:"/ai-system",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(oR,{})})})}),e.jsx(gt,{path:"/smart-errors",children:e.jsx(hr,{children:e.jsx(Pt,{children:e.jsx(lR,{})})})}),e.jsx(gt,{path:"/security-policies",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(cR,{})})})}),e.jsx(gt,{path:"/supabase-backup",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(Ef,{})})})}),e.jsx(gt,{path:"/smart-data-fetcher",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(Ef,{})})})}),e.jsx(gt,{path:"/data-migration",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(mR,{})})})}),e.jsx(gt,{path:"/migration-dashboard",children:e.jsx(gs,{children:e.jsx(Pt,{children:e.jsx(fR,{})})})}),e.jsx(gt,{component:pT})]})}function FF(){return e.jsx(Zc,{children:e.jsx(pk,{client:Nc,children:e.jsx(pE,{children:e.jsx(mT,{children:e.jsx(W_,{children:e.jsxs("div",{className:"min-h-screen bg-background text-foreground",dir:"rtl",children:[e.jsx(Zc,{children:e.jsx(IF,{})}),e.jsx(zS,{})]})})})})})})}gk.createRoot(document.getElementById("root")).render(e.jsx(FF,{}));export{en as A,$ as B,q as C,ja as F,be as I,Kk as K,xi as L,io as M,Qt as S,va as a,ue as b,ee as c,ms as d,pe as e,js as f,H as g,tn as h,Nt as i,yt as j,mt as k,vt as l,bt as m,Jr as n,rn as o,Qe as s,ba as t,Ct as u};
