import{ak as Q,a as q,r as n,j as e,aa as G,l as d,a1 as i,a9 as o,m as x,I as Z,B as $,ai as z,bR as J,bS as K,bP as U,Z as D,V as W,bk as X}from"./index-CtrRstG1.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=Q("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);function ee(){const{toast:v}=q(),[r,E]=n.useState([]),[f,S]=n.useState(!0),[B,I]=n.useState(0),[M,F]=n.useState(0),[b,H]=n.useState(null),[w,P]=n.useState(""),[N,V]=n.useState("all"),C=async()=>{S(!0);try{const s=await W("/api/sync/compare","GET"),{stats:l,tableDetails:g,tables:T}=s.data,A=await X(),u={};for(const t of T||Object.keys(l||{}))try{const a=await A.getAll(t);u[t]=a.length}catch{u[t]=0}const h=[];let p=0,y=0;for(const t of T||Object.keys(l||{})){const a=l?.[t]||0,c=u[t]||0,O=g?.[t]?.columns||[];p+=a,y+=c;let j="synced";a===0&&c===0?j="synced":c===0?j="missing":a!==c&&(j="partial"),h.push({tableName:t,serverCount:a,localCount:c,difference:Math.abs(a-c),isSynced:a===c,columns:O,status:j})}h.sort((t,a)=>t.isSynced!==a.isSynced?t.isSynced?1:-1:a.difference-t.difference),E(h),I(p),F(y),v({title:"تم المقارنة بنجاح",description:`${h.length} جدول | الخادم: ${p} | المحلي: ${y}`})}catch(s){v({title:"خطأ في المقارنة",description:s.message,variant:"destructive"})}finally{S(!1)}};n.useEffect(()=>{C()},[]);const k=r.filter(s=>{const l=s.tableName.toLowerCase().includes(w.toLowerCase()),g=N==="all"||(N==="synced"?s.isSynced:!s.isSynced);return l&&g}),m=r.filter(s=>!s.isSynced).length,L=r.reduce((s,l)=>s+l.difference,0),R=r.length>0?((r.length-m)/r.length*100).toFixed(1):0;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6","data-testid":"sync-comparison-page",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(G,{className:"w-8 h-8"}),"مقارنة شاملة للمزامنة"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-2",children:"مقارنة 66 جدول بين قاعدة البيانات المحلية والخادم"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(d,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"الجداول الكلية"})}),e.jsx(x,{children:e.jsx("div",{className:"text-3xl font-bold",children:r.length})})]}),e.jsxs(d,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"سجلات الخادم"})}),e.jsx(x,{children:e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:B.toLocaleString()})})]}),e.jsxs(d,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"السجلات المحلية"})}),e.jsx(x,{children:e.jsx("div",{className:"text-3xl font-bold text-green-600",children:M.toLocaleString()})})]}),e.jsxs(d,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"نسبة التزامن"})}),e.jsx(x,{children:e.jsxs("div",{className:`text-3xl font-bold ${R==="100"?"text-green-600":"text-yellow-600"}`,children:[R,"%"]})})]}),e.jsxs(d,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"غير متزامن"})}),e.jsx(x,{children:e.jsx("div",{className:`text-3xl font-bold ${m===0?"text-green-600":"text-red-600"}`,children:m})})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx(Z,{placeholder:"ابحث عن جدول...",value:w,onChange:s=>P(s.target.value),className:"flex-1","data-testid":"input-search-table"}),e.jsx("div",{className:"flex gap-2",children:["all","synced","unsynced"].map(s=>e.jsx($,{variant:N===s?"default":"outline",onClick:()=>V(s),"data-testid":`button-filter-${s}`,children:s==="all"?"الكل":s==="synced"?"متزامن":"غير متزامن"},s))}),e.jsxs($,{onClick:C,disabled:f,"data-testid":"button-refresh-comparison",children:[e.jsx(z,{className:`w-4 h-4 mr-2 ${f?"animate-spin":""}`}),f?"جاري...":"تحديث"]})]}),e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"تفاصيل الجداول (",k.length,")"]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-2","data-testid":"sync-comparison-table",children:k.map(s=>e.jsxs("div",{className:`border rounded-lg p-4 cursor-pointer transition ${s.isSynced?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,"data-testid":`table-row-${s.tableName}`,onClick:()=>H(b===s.tableName?null:s.tableName),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[b===s.tableName?e.jsx(J,{className:"w-5 h-5"}):e.jsx(K,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.tableName}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:[s.columns.length," عمود"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["خادم: ",s.serverCount]}),e.jsxs("div",{className:"text-sm",children:["محلي: ",s.localCount]})]}),s.isSynced?e.jsx(U,{className:"w-6 h-6 text-green-600"}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(D,{className:"w-6 h-6 text-red-600"}),e.jsxs("span",{className:"text-xs font-bold text-red-600",children:["-",s.difference]})]})]})]}),b===s.tableName&&e.jsx("div",{className:"mt-4 pt-4 border-t space-y-2",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2",children:["الأعمدة (",s.columns.length,"):"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:s.columns.map(l=>e.jsx("div",{className:"text-xs bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded",children:l},l))})]})})]},s.tableName))})})]}),L>0&&e.jsxs(d,{className:"border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsx(i,{children:e.jsxs(o,{className:"text-yellow-800 dark:text-yellow-200 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"ملخص الاختلافات"]})}),e.jsxs(x,{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"إجمالي السجلات المختلفة:"}),e.jsx("span",{className:"float-right text-lg font-bold text-red-600",children:L})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"الجداول المتأثرة:"}),e.jsx("span",{className:"float-right text-lg font-bold",children:m})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 pt-2",children:"اضغط على أي جدول لعرض تفاصيل الأعمدة والبيانات الكاملة."})]})]})]})}export{ee as default};
