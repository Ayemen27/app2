# خطة العمل الشاملة لتوحيد أنظمة المشروع (Master Unification Plan)

## 1. الرؤية والأهداف
بناء نظام موحد، ذكي، وشامل يزيل التكرار في الأكواد والوظائف، مع ضمان استمرارية العمل وصفر فقدان للبيانات.

## 2. مراحل التنفيذ (Missions)

### المرحلة الأولى: حماية البيانات والأنظمة (Shield Phase)
- **الإجراء:** أخذ نسخة احتياطية كاملة للملفات المستهدفة وقاعدة البيانات.
- **القيد:** لا يتم أي تعديل إلا بعد التأكد من وجود نسخة مطابقة في `system_unification_workspace/backups`.

### المرحلة الثانية: توحيد النواة (Core Unification)
- **المهمة:** دمج أنظمة البيئة (`env`) في `server/utils/unified-env.ts`.
- **المهمة:** توحيد استدعاءات قاعدة البيانات في موديول `CoreModule`.

### المرحلة الثالثة: توحيد الهوية والأمان (Identity Unification)
- **المهمة:** إنشاء `IdentityModule` يجمع (Auth, Security, Permissions).
- **الإجراء:** نقل الوظائف من المسارات المشتتة إلى الخدمة المركزية.

### المرحلة الرابعة: دمج العمليات والذكاء (Intelligence & Operations)
- **المهمة:** ربط نظام الآبار والمصاريف المالية بنظام الذكاء الاصطناعي.
- **الهدف:** توليد تقارير تلقائية وتحليلية بناءً على البيانات المالية والميدانية.

## 3. القيود الصارمة (Strict Constraints)
1. **ممنوع الحذف المباشر:** أي ملف سيتم استبداله، ينقل أولاً إلى مجلد "الأنظمة القديمة" مع الحفاظ على بصمته البرمجية.
2. **التحقق الثنائي:** بعد كل عملية دمج، يجب فحص مسارات الـ API للتأكد من أنها لا تزال تعمل بنفس النتائج السابقة.
3. **التوثيق اللحظي:** كل تغيير يسجل في ملف `logs/change_log.json` مع توضيح السبب والنتيجة.
4. **عدم فقدان البيانات:** جداول قاعدة البيانات (Schema) يجب تعديلها عبر Migrations آمنة فقط، مع منع استخدام `DROP COLUMN` بدون نسخ البيانات أولاً.

## 4. نظام المقارنة والتحقق (Validation System)
- **قبل التنفيذ:** تسجيل قائمة بجميع المسارات (Endpoints) الحالية ونتائجها المتوقعة.
- **بعد التنفيذ:** إجراء مقارنة (Diff Analysis) بين الأكواد القديمة والجديدة لضمان عدم سقوط أي منطق استثنائي (Edge Cases).

## 5. حالة المشروع الحالية
- [x] المرحلة الأولى: حماية البيانات (مكتملة)
- [x] المرحلة الثانية: توحيد النواة (تم دمج أنظمة البيئة)
- [ ] المرحلة الثالثة: توحيد الهوية
- [ ] المرحلة الرابعة: التكامل الذكي
