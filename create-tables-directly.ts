
import { db } from './server/db';
import { sql } from 'drizzle-orm';

async function createTablesDirectly() {
  console.log('๐ ุฅูุดุงุก ุงูุฌุฏุงูู ูุจุงุดุฑุฉ...');
  
  try {
    // ุฅูุดุงุก ุฌุฏูู ุงููุณุชุฎุฏููู
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS users (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        email TEXT UNIQUE NOT NULL,
        password TEXT NOT NULL,
        first_name TEXT NOT NULL,
        last_name TEXT NOT NULL,
        role TEXT DEFAULT 'user',
        is_active BOOLEAN DEFAULT true,
        created_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุงููุณุชุฎุฏููู');

    // ุฅูุดุงุก ุฌุฏูู ุงููุดุงุฑูุน
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS projects (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        name TEXT NOT NULL,
        description TEXT,
        status TEXT DEFAULT 'active',
        start_date TEXT,
        end_date TEXT,
        budget DECIMAL(12,2),
        location TEXT,
        client_name TEXT,
        client_phone TEXT,
        notes TEXT,
        created_at TIMESTAMP DEFAULT now() NOT NULL,
        updated_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุงููุดุงุฑูุน');

    // ุฅูุดุงุก ุฌุฏูู ุงูุนูุงู
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS workers (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        name TEXT NOT NULL,
        phone TEXT,
        type TEXT NOT NULL,
        daily_wage DECIMAL(10,2) NOT NULL,
        status TEXT DEFAULT 'active',
        hired_date TEXT,
        notes TEXT,
        created_at TIMESTAMP DEFAULT now() NOT NULL,
        updated_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุงูุนูุงู');

    // ุฅูุดุงุก ุฌุฏูู ุญุถูุฑ ุงูุนูุงู
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS worker_attendance (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        worker_id VARCHAR NOT NULL REFERENCES workers(id),
        project_id VARCHAR NOT NULL REFERENCES projects(id),
        attendance_date TEXT NOT NULL,
        hours_worked DECIMAL(4,2) DEFAULT 8.00,
        overtime DECIMAL(4,2) DEFAULT 0.00,
        daily_wage DECIMAL(10,2) NOT NULL,
        overtime_rate DECIMAL(10,2) DEFAULT 0.00,
        total_pay DECIMAL(10,2) NOT NULL,
        notes TEXT,
        created_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุญุถูุฑ ุงูุนูุงู');

    // ุฅูุดุงุก ุฌุฏูู ุงููุตุฑููุงุช ุงูููููุฉ
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS daily_expenses (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        project_id VARCHAR NOT NULL REFERENCES projects(id),
        expense_date TEXT NOT NULL,
        category TEXT NOT NULL,
        description TEXT NOT NULL,
        amount DECIMAL(10,2) NOT NULL,
        receipt_number TEXT,
        supplier_name TEXT,
        notes TEXT,
        created_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุงููุตุฑููุงุช ุงูููููุฉ');

    // ุฅูุดุงุก ุฌุฏูู ุดุฑุงุก ุงูููุงุฏ
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS material_purchases (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        project_id VARCHAR NOT NULL REFERENCES projects(id),
        purchase_date TEXT NOT NULL,
        material_name TEXT NOT NULL,
        quantity DECIMAL(10,3) NOT NULL,
        unit TEXT NOT NULL,
        unit_price DECIMAL(10,2) NOT NULL,
        total_amount DECIMAL(10,2) NOT NULL,
        supplier_name TEXT,
        receipt_number TEXT,
        notes TEXT,
        created_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุดุฑุงุก ุงูููุงุฏ');

    // ุฅูุดุงุก ุฌุฏูู ุงููุนุฏุงุช
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS equipment (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        name TEXT NOT NULL,
        serial_number TEXT,
        category TEXT NOT NULL,
        purchase_date TEXT,
        purchase_price DECIMAL(10,2),
        current_value DECIMAL(10,2),
        status TEXT DEFAULT 'available',
        location TEXT,
        notes TEXT,
        created_at TIMESTAMP DEFAULT now() NOT NULL,
        updated_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุงููุนุฏุงุช');

    // ุฅูุดุงุก ุฌุฏูู ุงูุฅููุงู ุงูุชููุงุฆู
    await db.execute(sql`
      CREATE TABLE IF NOT EXISTS autocomplete_data (
        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
        category TEXT NOT NULL,
        value TEXT NOT NULL,
        usage_count INTEGER DEFAULT 1,
        last_used TIMESTAMP DEFAULT now(),
        created_at TIMESTAMP DEFAULT now() NOT NULL
      )
    `);
    console.log('โ ุชู ุฅูุดุงุก ุฌุฏูู ุงูุฅููุงู ุงูุชููุงุฆู');

    // ุฅูุดุงุก ุงููุณุชุฎุฏู ุงูุชุฌุฑูุจู
    const password = 'admin123';
    const crypto = await import('crypto');
    const hashedPassword = crypto.createHash('sha256').update(password).digest('hex');
    
    await db.execute(sql`
      INSERT INTO users (email, password, first_name, last_name, role, is_active)
      VALUES ('admin@test.com', ${hashedPassword}, 'ูุฏูุฑ', 'ุงููุธุงู', 'admin', true)
      ON CONFLICT (email) DO NOTHING
    `);
    console.log('โ ุชู ุฅูุดุงุก ุงููุณุชุฎุฏู ุงูุชุฌุฑูุจู');

    console.log('๐ ุชู ุฅูุดุงุก ุฌููุน ุงูุฌุฏุงูู ูุงูุจูุงูุงุช ุจูุฌุงุญ!');
    console.log('');
    console.log('๐ง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: admin@test.com');
    console.log('๐ ูููุฉ ุงููุฑูุฑ: admin123');
    
  } catch (error: any) {
    console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฌุฏุงูู:', error.message);
  }
  
  process.exit(0);
}

createTablesDirectly();
