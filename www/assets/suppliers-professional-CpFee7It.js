import{r as s,a as I,b as B,g as O,j as e,L as v,J as j,Y as U,B as K,Q as N,X as L,c as Y,f as z,Z as q,T as H,$ as J,C as M,l as Q,m as V,w as X,x as Z,y as W,z as ee,A as te,i as se,P as ae,n as ne,o as le,p as re,q as oe,v as ie,s as ce,a0 as de}from"./index-CxoPRNzl.js";import{S as me}from"./switch-DYlPBxRM.js";function ue({supplier:l,onSuccess:p,onCancel:x,submitLabel:C="إضافة المورد"}){const[a,w]=s.useState(l?.name||""),[o,S]=s.useState(l?.contactPerson||""),[h,D]=s.useState(l?.phone||""),[r,F]=s.useState(l?.address||""),[u,k]=s.useState(l?.paymentTerms||"نقد"),[f,P]=s.useState(l?.notes||""),[c,T]=s.useState(l?.isActive??!0),{toast:y}=I(),_=B(),d=async(m,i)=>{if(!(!i||typeof i!="string"||!i.trim()))try{await L("/api/autocomplete","POST",{category:m,value:i.trim()})}catch{}},b=O({mutationFn:async m=>(await Promise.all([d("supplier_name",a),d("supplier_contact_person",o),d("supplier_phone",h),d("supplier_address",r),d("supplier_payment_terms",u)]),l?L(`/api/suppliers/${l.id}`,"PUT",m):L("/api/suppliers","POST",m)),onSuccess:async m=>{await _.invalidateQueries({queryKey:N.suppliers}),await _.invalidateQueries({queryKey:N.autocomplete}),y({title:"تم الحفظ",description:l?"تم تعديل المورد بنجاح":"تم إضافة المورد بنجاح"}),l||E(),p?.()},onError:async m=>{await Promise.all([d("supplier_name",a),d("supplier_contact_person",o),d("supplier_phone",h),d("supplier_address",r),d("supplier_payment_terms",u)]),await _.invalidateQueries({queryKey:N.autocomplete});const i=m?.message||(l?"حدث خطأ أثناء تعديل المورد":"حدث خطأ أثناء إضافة المورد");y({title:l?"فشل في تعديل المورد":"فشل في إضافة المورد",description:i,variant:"destructive"})}}),E=()=>{w(""),S(""),D(""),F(""),k("نقد"),P(""),T(!0)},A=m=>{if(m.preventDefault(),!a||typeof a!="string"||!a.trim()){y({title:"خطأ",description:"يرجى ملء اسم المورد",variant:"destructive"});return}const i={name:a&&typeof a=="string"?a.trim():"",contactPerson:o&&typeof o=="string"&&o.trim()||null,phone:h&&typeof h=="string"&&h.trim()||null,address:r&&typeof r=="string"&&r.trim()||null,paymentTerms:u&&typeof u=="string"&&u.trim()||"نقد",notes:f&&typeof f=="string"&&f.trim()||null,isActive:c,totalDebt:"0"};b.mutate(i)};return e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"supplier-name",className:"text-sm font-medium text-foreground",children:"اسم المورد *"}),e.jsx(j,{value:a,onChange:w,placeholder:"اسم المورد أو الشركة",category:"supplier_name",className:"w-full"})]}),e.jsxs(U,{columns:2,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"contact-person",className:"text-sm font-medium text-foreground",children:"الشخص المسؤول"}),e.jsx(j,{value:o,onChange:S,placeholder:"اسم الشخص المسؤول",category:"supplier_contact_person",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"رقم الهاتف"}),e.jsx(j,{value:h,onChange:D,placeholder:"777123456",category:"supplier_phone",type:"tel",inputMode:"numeric",className:"w-full"})]})]}),e.jsxs(U,{columns:2,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"address",className:"text-sm font-medium text-foreground",children:"العنوان"}),e.jsx(j,{value:r,onChange:F,placeholder:"العنوان الكامل",category:"supplier_address",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"payment-terms",className:"text-sm font-medium text-foreground",children:"شروط الدفع"}),e.jsx(j,{value:u,onChange:k,placeholder:"نقد / 30 يوم / 60 يوم",category:"supplier_payment_terms",className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"notes",className:"text-sm font-medium text-foreground",children:"ملاحظات"}),e.jsx(j,{value:f,onChange:P,placeholder:"ملاحظات إضافية...",category:"notes",className:"w-full"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{className:"text-sm font-medium",children:"حالة المورد"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"نشط ومتاح للتعامل":"غير نشط"})]}),e.jsx(me,{checked:c,onCheckedChange:T})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t",children:[x&&e.jsx(K,{type:"button",variant:"outline",onClick:x,disabled:b.isPending,children:"إلغاء"}),e.jsx(K,{type:"submit",disabled:b.isPending,className:"min-w-[100px]",children:b.isPending?"جاري الحفظ...":C})]})]})}function xe(){const[l,p]=s.useState(!1),[x,C]=s.useState(null),[a,w]=s.useState(""),[o,S]=s.useState({status:"all"}),[h,D]=s.useState(!1),{toast:r}=I(),F=B(),{setFloatingAction:u}=Y(),k=s.useCallback((t,n)=>{S(R=>({...R,[t]:n}))},[]),f=s.useCallback(()=>{w(""),S({status:"all"}),r({title:"تم إعادة التعيين",description:"تم مسح جميع الفلاتر"})},[r]),P=t=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)+" ر.ي",{data:c=[],isLoading:T,refetch:y}=z({queryKey:N.suppliers}),_=s.useCallback(async()=>{D(!0);try{await y(),r({title:"تم التحديث",description:"تم تحديث البيانات بنجاح"})}catch{r({title:"خطأ",description:"فشل تحديث البيانات",variant:"destructive"})}finally{D(!1)}},[y,r]),d=O({mutationFn:async t=>await L(`/api/suppliers/${t}`,"DELETE"),onSuccess:()=>{F.refetchQueries({queryKey:N.suppliers}),r({title:"تم حذف المورد بنجاح"})},onError:()=>{r({title:"خطأ في حذف المورد",variant:"destructive"})}}),b=t=>{C(t),p(!0)},E=t=>{confirm(`هل أنت متأكد من حذف المورد "${t.name}"؟`)&&d.mutate(t.id)},A=()=>{C(null),p(!1)},m=()=>{C(null),p(!0)};s.useEffect(()=>(u(m,"إضافة مورد جديد"),()=>u(null)),[u]);const i=s.useMemo(()=>c.filter(t=>{const n=t.name.toLowerCase().includes(a.toLowerCase())||t.contactPerson&&t.contactPerson.toLowerCase().includes(a.toLowerCase())||t.phone&&t.phone.includes(a),R=o.status==="all"||o.status==="active"&&t.isActive||o.status==="inactive"&&!t.isActive;return n&&R}),[c,a,o]),g=s.useMemo(()=>({total:c.length,active:c.filter(t=>t.isActive).length,inactive:c.filter(t=>!t.isActive).length,totalDebt:c.reduce((t,n)=>t+(parseFloat(n.totalDebt?.toString()||"0")||0),0)}),[c]),$=s.useMemo(()=>[{columns:2,gap:"sm",items:[{key:"total",label:"إجمالي الموردين",value:g.total,icon:q,color:"blue"},{key:"active",label:"الموردين النشطين",value:g.active,icon:H,color:"green",showDot:!0,dotColor:"bg-green-500"}]},{columns:2,gap:"sm",items:[{key:"inactive",label:"غير النشطين",value:g.inactive,icon:J,color:"orange"},{key:"totalDebt",label:"إجمالي المديونية",value:P(g.totalDebt),icon:M,color:g.totalDebt>0?"red":"green"}]}],[g]),G=s.useMemo(()=>[{key:"status",label:"الحالة",type:"select",defaultValue:"all",options:[{value:"all",label:"جميع الحالات"},{value:"active",label:"نشط"},{value:"inactive",label:"غير نشط"}]}],[]);return T?e.jsxs("div",{className:"container mx-auto p-4 space-y-1",children:[e.jsxs("div",{className:"animate-pulse space-y-1",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted rounded w-64"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:[...Array(4)].map((t,n)=>e.jsx(Q,{className:"animate-pulse",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-16"}),e.jsx("div",{className:"h-6 bg-muted rounded w-12"})]}),e.jsx("div",{className:"h-8 w-8 bg-muted rounded"})]})})},n))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-4",children:[...Array(8)].map((t,n)=>e.jsx(Q,{className:"animate-pulse",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-5 bg-muted rounded w-24"}),e.jsx("div",{className:"h-3 bg-muted rounded w-20"}),e.jsx("div",{className:"h-3 bg-muted rounded w-28"})]})})},n))})]}):e.jsxs("div",{className:"container mx-auto p-4 space-y-2",children:[e.jsx(X,{open:l,onOpenChange:p,children:e.jsxs(Z,{className:"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{children:[e.jsx(ee,{className:"text-lg sm:text-xl",children:x?"تعديل بيانات المورد":"إضافة مورد جديد"}),e.jsx(te,{children:x?"قم بتعديل بيانات المورد المحدد":"أدخل بيانات المورد الجديد"})]}),e.jsx(ue,{supplier:x,onSuccess:()=>{A(),F.refetchQueries({queryKey:N.suppliers})},onCancel:A,submitLabel:x?"تحديث المورد":"إضافة المورد"})]})}),e.jsx(se,{statsRows:$,searchValue:a,onSearchChange:w,searchPlaceholder:"البحث في الموردين (الاسم، الشخص المسؤول، رقم الهاتف)...",filters:G,filterValues:o,onFilterChange:k,onReset:f,onRefresh:_,isRefreshing:h,resultsSummary:a||o.status!=="all"?{totalCount:c.length,filteredCount:i.length,totalLabel:"النتائج",filteredLabel:"من",totalValue:i.reduce((t,n)=>t+(parseFloat(n.totalDebt?.toString()||"0")||0),0),totalValueLabel:"إجمالي المديونية",unit:"ر.ي"}:void 0}),i.length===0?e.jsx(Q,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(q,{className:"h-16 w-16 mx-auto text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium mt-4",children:a?"لا توجد نتائج":"لا توجد موردين"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto mt-2",children:a?"لم يتم العثور على موردين يطابقون كلمات البحث المدخلة. جرب كلمات أخرى.":"ابدأ ببناء قاعدة بيانات الموردين الخاصة بك عن طريق إضافة أول مورد."}),!a&&e.jsxs(K,{onClick:()=>{A(),p(!0)},className:"gap-2 mt-4",children:[e.jsx(ae,{className:"h-4 w-4"}),"إضافة مورد جديد"]})]})}):e.jsx(ne,{columns:4,children:i.map(t=>{const n=parseFloat(t.totalDebt?.toString()||"0")||0;return e.jsx(le,{title:t.name,subtitle:t.contactPerson||void 0,titleIcon:q,headerColor:t.isActive?"#22c55e":"#6b7280",badges:[{label:t.isActive?"نشط":"معطل",variant:t.isActive?"success":"secondary"},...n>0?[{label:"مديون",variant:"destructive"}]:[{label:"رصيد سليم",variant:"success"}]],fields:[{label:"المديونية",value:n>0?P(n):"لا يوجد",icon:M,emphasis:n>0,color:n>0?"danger":"success"},{label:"رقم الهاتف",value:t.phone||"غير محدد",icon:ie},{label:"شروط الدفع",value:t.paymentTerms||"غير محدد",icon:M},{label:"تاريخ الإضافة",value:t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB"):"غير محدد",icon:ce},...t.address?[{label:"العنوان",value:t.address,icon:de}]:[]],actions:[{icon:re,label:"تعديل",onClick:()=>b(t)},{icon:oe,label:"حذف",variant:"ghost",onClick:()=>E(t)}],footer:t.notes?e.jsx("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded text-xs",children:e.jsx("p",{className:"line-clamp-2 text-amber-800 dark:text-amber-200",children:t.notes})}):void 0,compact:!0},t.id)})})]})}export{xe as default};
