import{r as s,a as K,b as U,g as B,j as e,L as v,J as j,X as I,B as Q,V as T,c as G,f as z,Y as M,T as H,Z as J,C as R,l as E,m as V,w as X,x as Y,y as Z,z as W,A as ee,i as te,P as se,n as ae,o as ne,p as le,q as re,v as ie,s as oe,$ as ce}from"./index-CtrRstG1.js";import{S as de}from"./switch-B-ybExO5.js";function me({supplier:l,onSuccess:p,onCancel:x,submitLabel:N="إضافة المورد"}){const[a,C]=s.useState(l?.name||""),[i,w]=s.useState(l?.contactPerson||""),[h,S]=s.useState(l?.phone||""),[r,D]=s.useState(l?.address||""),[u,A]=s.useState(l?.paymentTerms||"نقد"),[f,F]=s.useState(l?.notes||""),[c,k]=s.useState(l?.isActive??!0),{toast:y}=K(),P=U(),d=async(m,o)=>{if(!(!o||typeof o!="string"||!o.trim()))try{await T("/api/autocomplete","POST",{category:m,value:o.trim()})}catch{}},b=B({mutationFn:async m=>(await Promise.all([d("supplier_name",a),d("supplier_contact_person",i),d("supplier_phone",h),d("supplier_address",r),d("supplier_payment_terms",u)]),l?T(`/api/suppliers/${l.id}`,"PUT",m):T("/api/suppliers","POST",m)),onSuccess:async m=>{await P.invalidateQueries({queryKey:["/api/suppliers"]}),await P.invalidateQueries({queryKey:["/api/autocomplete"]}),y({title:"تم الحفظ",description:l?"تم تعديل المورد بنجاح":"تم إضافة المورد بنجاح"}),l||L(),p?.()},onError:async m=>{await Promise.all([d("supplier_name",a),d("supplier_contact_person",i),d("supplier_phone",h),d("supplier_address",r),d("supplier_payment_terms",u)]),await P.invalidateQueries({queryKey:["/api/autocomplete"]});const o=m?.message||(l?"حدث خطأ أثناء تعديل المورد":"حدث خطأ أثناء إضافة المورد");y({title:l?"فشل في تعديل المورد":"فشل في إضافة المورد",description:o,variant:"destructive"})}}),L=()=>{C(""),w(""),S(""),D(""),A("نقد"),F(""),k(!0)},_=m=>{if(m.preventDefault(),!a||typeof a!="string"||!a.trim()){y({title:"خطأ",description:"يرجى ملء اسم المورد",variant:"destructive"});return}const o={name:a&&typeof a=="string"?a.trim():"",contactPerson:i&&typeof i=="string"&&i.trim()||null,phone:h&&typeof h=="string"&&h.trim()||null,address:r&&typeof r=="string"&&r.trim()||null,paymentTerms:u&&typeof u=="string"&&u.trim()||"نقد",notes:f&&typeof f=="string"&&f.trim()||null,isActive:c,totalDebt:"0"};b.mutate(o)};return e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"supplier-name",className:"text-sm font-medium text-foreground",children:"اسم المورد *"}),e.jsx(j,{value:a,onChange:C,placeholder:"اسم المورد أو الشركة",category:"supplier_name",className:"w-full"})]}),e.jsxs(I,{columns:2,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"contact-person",className:"text-sm font-medium text-foreground",children:"الشخص المسؤول"}),e.jsx(j,{value:i,onChange:w,placeholder:"اسم الشخص المسؤول",category:"supplier_contact_person",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"رقم الهاتف"}),e.jsx(j,{value:h,onChange:S,placeholder:"777123456",category:"supplier_phone",type:"tel",inputMode:"numeric",className:"w-full"})]})]}),e.jsxs(I,{columns:2,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"address",className:"text-sm font-medium text-foreground",children:"العنوان"}),e.jsx(j,{value:r,onChange:D,placeholder:"العنوان الكامل",category:"supplier_address",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"payment-terms",className:"text-sm font-medium text-foreground",children:"شروط الدفع"}),e.jsx(j,{value:u,onChange:A,placeholder:"نقد / 30 يوم / 60 يوم",category:"supplier_payment_terms",className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"notes",className:"text-sm font-medium text-foreground",children:"ملاحظات"}),e.jsx(j,{value:f,onChange:F,placeholder:"ملاحظات إضافية...",category:"notes",className:"w-full"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{className:"text-sm font-medium",children:"حالة المورد"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"نشط ومتاح للتعامل":"غير نشط"})]}),e.jsx(de,{checked:c,onCheckedChange:k})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t",children:[x&&e.jsx(Q,{type:"button",variant:"outline",onClick:x,disabled:b.isPending,children:"إلغاء"}),e.jsx(Q,{type:"submit",disabled:b.isPending,className:"min-w-[100px]",children:b.isPending?"جاري الحفظ...":N})]})]})}function pe(){const[l,p]=s.useState(!1),[x,N]=s.useState(null),[a,C]=s.useState(""),[i,w]=s.useState({status:"all"}),[h,S]=s.useState(!1),{toast:r}=K(),D=U(),{setFloatingAction:u}=G(),A=s.useCallback((t,n)=>{w(q=>({...q,[t]:n}))},[]),f=s.useCallback(()=>{C(""),w({status:"all"}),r({title:"تم إعادة التعيين",description:"تم مسح جميع الفلاتر"})},[r]),F=t=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)+" ر.ي",{data:c=[],isLoading:k,refetch:y}=z({queryKey:["/api/suppliers"]}),P=s.useCallback(async()=>{S(!0);try{await y(),r({title:"تم التحديث",description:"تم تحديث البيانات بنجاح"})}catch{r({title:"خطأ",description:"فشل تحديث البيانات",variant:"destructive"})}finally{S(!1)}},[y,r]),d=B({mutationFn:async t=>await T(`/api/suppliers/${t}`,"DELETE"),onSuccess:()=>{D.refetchQueries({queryKey:["/api/suppliers"]}),r({title:"تم حذف المورد بنجاح"})},onError:()=>{r({title:"خطأ في حذف المورد",variant:"destructive"})}}),b=t=>{N(t),p(!0)},L=t=>{confirm(`هل أنت متأكد من حذف المورد "${t.name}"؟`)&&d.mutate(t.id)},_=()=>{N(null),p(!1)},m=()=>{N(null),p(!0)};s.useEffect(()=>(u(m,"إضافة مورد جديد"),()=>u(null)),[u]);const o=s.useMemo(()=>c.filter(t=>{const n=t.name.toLowerCase().includes(a.toLowerCase())||t.contactPerson&&t.contactPerson.toLowerCase().includes(a.toLowerCase())||t.phone&&t.phone.includes(a),q=i.status==="all"||i.status==="active"&&t.isActive||i.status==="inactive"&&!t.isActive;return n&&q}),[c,a,i]),g=s.useMemo(()=>({total:c.length,active:c.filter(t=>t.isActive).length,inactive:c.filter(t=>!t.isActive).length,totalDebt:c.reduce((t,n)=>t+(parseFloat(n.totalDebt?.toString()||"0")||0),0)}),[c]),O=s.useMemo(()=>[{columns:2,gap:"sm",items:[{key:"total",label:"إجمالي الموردين",value:g.total,icon:M,color:"blue"},{key:"active",label:"الموردين النشطين",value:g.active,icon:H,color:"green",showDot:!0,dotColor:"bg-green-500"}]},{columns:2,gap:"sm",items:[{key:"inactive",label:"غير النشطين",value:g.inactive,icon:J,color:"orange"},{key:"totalDebt",label:"إجمالي المديونية",value:F(g.totalDebt),icon:R,color:g.totalDebt>0?"red":"green"}]}],[g]),$=s.useMemo(()=>[{key:"status",label:"الحالة",type:"select",defaultValue:"all",options:[{value:"all",label:"جميع الحالات"},{value:"active",label:"نشط"},{value:"inactive",label:"غير نشط"}]}],[]);return k?e.jsxs("div",{className:"container mx-auto p-4 space-y-1",children:[e.jsxs("div",{className:"animate-pulse space-y-1",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted rounded w-64"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:[...Array(4)].map((t,n)=>e.jsx(E,{className:"animate-pulse",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-16"}),e.jsx("div",{className:"h-6 bg-muted rounded w-12"})]}),e.jsx("div",{className:"h-8 w-8 bg-muted rounded"})]})})},n))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-4",children:[...Array(8)].map((t,n)=>e.jsx(E,{className:"animate-pulse",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-5 bg-muted rounded w-24"}),e.jsx("div",{className:"h-3 bg-muted rounded w-20"}),e.jsx("div",{className:"h-3 bg-muted rounded w-28"})]})})},n))})]}):e.jsxs("div",{className:"container mx-auto p-4 space-y-2",children:[e.jsx(X,{open:l,onOpenChange:p,children:e.jsxs(Y,{className:"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(W,{className:"text-lg sm:text-xl",children:x?"تعديل بيانات المورد":"إضافة مورد جديد"}),e.jsx(ee,{children:x?"قم بتعديل بيانات المورد المحدد":"أدخل بيانات المورد الجديد"})]}),e.jsx(me,{supplier:x,onSuccess:()=>{_(),D.refetchQueries({queryKey:["/api/suppliers"]})},onCancel:_,submitLabel:x?"تحديث المورد":"إضافة المورد"})]})}),e.jsx(te,{statsRows:O,searchValue:a,onSearchChange:C,searchPlaceholder:"البحث في الموردين (الاسم، الشخص المسؤول، رقم الهاتف)...",filters:$,filterValues:i,onFilterChange:A,onReset:f,onRefresh:P,isRefreshing:h,resultsSummary:a||i.status!=="all"?{totalCount:c.length,filteredCount:o.length,totalLabel:"النتائج",filteredLabel:"من",totalValue:o.reduce((t,n)=>t+(parseFloat(n.totalDebt?.toString()||"0")||0),0),totalValueLabel:"إجمالي المديونية",unit:"ر.ي"}:void 0}),o.length===0?e.jsx(E,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(M,{className:"h-16 w-16 mx-auto text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium mt-4",children:a?"لا توجد نتائج":"لا توجد موردين"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto mt-2",children:a?"لم يتم العثور على موردين يطابقون كلمات البحث المدخلة. جرب كلمات أخرى.":"ابدأ ببناء قاعدة بيانات الموردين الخاصة بك عن طريق إضافة أول مورد."}),!a&&e.jsxs(Q,{onClick:()=>{_(),p(!0)},className:"gap-2 mt-4",children:[e.jsx(se,{className:"h-4 w-4"}),"إضافة مورد جديد"]})]})}):e.jsx(ae,{columns:4,children:o.map(t=>{const n=parseFloat(t.totalDebt?.toString()||"0")||0;return e.jsx(ne,{title:t.name,subtitle:t.contactPerson||void 0,titleIcon:M,headerColor:t.isActive?"#22c55e":"#6b7280",badges:[{label:t.isActive?"نشط":"معطل",variant:t.isActive?"success":"secondary"},...n>0?[{label:"مديون",variant:"destructive"}]:[{label:"رصيد سليم",variant:"success"}]],fields:[{label:"المديونية",value:n>0?F(n):"لا يوجد",icon:R,emphasis:n>0,color:n>0?"danger":"success"},{label:"رقم الهاتف",value:t.phone||"غير محدد",icon:ie},{label:"شروط الدفع",value:t.paymentTerms||"غير محدد",icon:R},{label:"تاريخ الإضافة",value:t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB"):"غير محدد",icon:oe},...t.address?[{label:"العنوان",value:t.address,icon:ce}]:[]],actions:[{icon:le,label:"تعديل",onClick:()=>b(t)},{icon:re,label:"حذف",variant:"ghost",onClick:()=>L(t)}],footer:t.notes?e.jsx("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded text-xs",children:e.jsx("p",{className:"line-clamp-2 text-amber-800 dark:text-amber-200",children:t.notes})}):void 0,compact:!0},t.id)})})]})}export{pe as default};
