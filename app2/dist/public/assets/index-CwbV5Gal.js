const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-CT50dpqw.js","assets/vendor-Dazix4UH.js","assets/excel-CdQGSzc_.js"])))=>i.map(i=>d[i]);
var R1=Object.defineProperty;var F1=(t,s,r)=>s in t?R1(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var O=(t,s,r)=>F1(t,typeof s!="symbol"?s+"":s,r);import{r as f,j as e,V as Ig,a as Rg,A as Fg,C as $g,T as Vg,D as Og,P as $1,c as Os,b as Cs,d as pn,e as Rc,f as Fc,g as Lg,h as V1,u as Pt,i as Bo,k as xt,l as Te,m as $c,S as zg,O as Ni,n as Vc,o as wi,p as qo,q as ki,s as Ti,t as Oc,v as Lc,w as Bg,I as O1,x as qg,y as Ug,z as L1,B as Wg,E as z1,L as Kg,F as Gg,G as B1,H as q1,J as Hg,K as U1,M as W1,N as Ye,Q as Qg,U as Hn,W as Si,X as Ma,Y as mr,Z as zc,_ as Bc,$ as Xg,a0 as K1,a1 as Zg,a2 as Yg,a3 as Jg,a4 as e0,a5 as t0,a6 as s0,a7 as r0,a8 as a0,a9 as G1,aa as H1,ab as Q1}from"./ui-De53Fnn7.js";import{a as X1,c as Ki}from"./vendor-Dazix4UH.js";import{u as or,L as Tu,R as va,S as n0,a as jt}from"./router-Bw6RD1oa.js";import{Q as Z1,u as Se,a as Gt,b as Ae,c as Y1}from"./query-YiOUlyih.js";import{c as i0}from"./charts-DOP7HDiW.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var Gi={},Su;function J1(){if(Su)return Gi;Su=1;var t=X1();return Gi.createRoot=t.createRoot,Gi.hydrateRoot=t.hydrateRoot,Gi}var e2=J1();async function o0(t){if(!t.ok){let s="حدث خطأ غير متوقع";try{s=(await t.json()).message||s}catch{t.status===400?s="البيانات المدخلة غير صحيحة":t.status===404?s="العنصر المطلوب غير موجود":t.status===500?s="حدث خطأ في الخادم":s="حدث خطأ في الاتصال"}throw new Error(s)}}let Aa=null;function Au(t){Aa=t}function l0(){return Aa?Aa.getAccessToken():localStorage.getItem("accessToken")}async function c0(){return Aa?await Aa.refreshToken():(console.warn("⚠️ AuthProvider helpers غير مسجلة - استخدام fallback"),!1)}async function me(t,s,r){const a=new AbortController,n=setTimeout(()=>a.abort(),3e4);async function i(o=0){try{const l={};r&&(l["Content-Type"]="application/json");const u=l0();u&&(l.Authorization=`Bearer ${u}`);const d=await fetch(t,{method:s,headers:l,body:r?JSON.stringify(r):void 0,credentials:"include",signal:a.signal});if(d.status===401&&o===0){if(console.log("🔄 محاولة تجديد التوكن..."),await c0())return console.log("✅ تم تجديد التوكن، محاولة الطلب مرة أخرى..."),i(1);throw console.log("❌ فشل في تجديد التوكن"),Aa?await Aa.logout():window.location.href="/login",new Error("انتهت جلسة المصادقة، يرجى تسجيل الدخول مرة أخرى")}if(await o0(d),s==="DELETE"&&d.status===204)return{};const c=d.headers.get("content-type");if(!c||!c.includes("application/json")){const h=await d.text();throw console.error(`❌ [apiRequest] الخادم أرسل ${c||"غير محدد"} بدلاً من JSON:`,{url:t,method:s,status:d.status,contentType:c,responsePreview:h.substring(0,200)}),new Error(`خطأ في نوع الاستجابة: متوقع JSON لكن تم استلام ${c||"غير محدد"}`)}let m;try{m=await d.json()}catch(h){const x=await d.clone().text();throw console.error("❌ [apiRequest] خطأ في تحليل JSON:",{url:t,method:s,parseError:h,responsePreview:x.substring(0,200)}),new Error("خطأ في تحليل استجابة JSON من الخادم")}return m}catch(l){throw l instanceof Error&&l.name==="AbortError"?new Error("انتهت مهلة الطلب، يرجى المحاولة مرة أخرى"):l}}try{const o=await i();return clearTimeout(n),o}catch(o){throw clearTimeout(n),o}}const t2=({on401:t})=>async({queryKey:s})=>{async function r(a=0){const n=new AbortController,i=setTimeout(()=>n.abort(),15e3);try{const o={},l=l0();l&&(o.Authorization=`Bearer ${l}`),console.log(`🔍 [QueryClient] إرسال طلب: ${s.join("/")}`,{hasToken:!!l});const u=await fetch(s.join("/"),{headers:o,credentials:"include",signal:n.signal});if(clearTimeout(i),u.status===401){if(console.error(`🚫 [QueryClient] خطأ 401 غير مصرح لـ ${s.join("/")}`,{retryCount:a,hasToken:!!localStorage.getItem("accessToken"),queryKey:s.join("/")}),a===0&&(console.log("🔄 محاولة تجديد التوكن في query..."),await c0()))return console.log("✅ تم تجديد التوكن، إعادة تشغيل query..."),r(1);throw console.error("❌ فشل المصادقة - إظهار الخطأ الحقيقي"),new Error(`خطأ في المصادقة (401): ${s.join("/")} - يرجى تسجيل الدخول مرة أخرى`)}await o0(u);const d=await u.json();if(console.log(`✅ [QueryClient] استجابة ناجحة لـ ${s.join("/")}:`,{hasData:!!d,dataType:typeof d}),console.log(`📊 [QueryClient] تحليل البيانات لـ ${s.join("/")}:`,{dataType:typeof d,isObject:d&&typeof d=="object",hasSuccess:d?.success!==void 0,hasDataProperty:d?.data!==void 0,actualDataValue:d?.data,rawData:d}),d&&typeof d=="object"){const c=typeof s[0]=="string"&&s[0].includes("migration");if(d.success!==void 0&&d.data!==void 0)return console.log(`✅ [QueryClient] بيانات API صحيحة لـ ${s.join("/")}:`,{success:d.success,dataExists:d.data!==null,dataType:typeof d.data,isArray:Array.isArray(d.data)}),c?d.data:d.data===null||d.data===void 0?(console.warn(`⚠️ [QueryClient] البيانات null/undefined لـ ${s.join("/")} - إرجاع مصفوفة فارغة`),[]):d.data;if(Array.isArray(d))return console.log(`📋 [QueryClient] مصفوفة مباشرة لـ ${s.join("/")}:`,d.length),d;if(d.data!==void 0)return console.log(`🔗 [QueryClient] خاصية data مباشرة لـ ${s.join("/")}:`,d.data),d.data!==null?d.data:[]}return console.log(`🔄 [QueryClient] إرجاع البيانات كما هي لـ ${s.join("/")}:`,d),d}catch(o){throw clearTimeout(i),o instanceof Error&&o.name==="AbortError"?(console.log(`⏰ [QueryClient] timeout لـ ${s.join("/")}`),new Error("انتهت مهلة الطلب، يرجى المحاولة مرة أخرى")):(console.error(`❌ [QueryClient] خطأ في ${s.join("/")}`,o),o)}}return r()},Yl=new Z1({defaultOptions:{queries:{queryFn:t2({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1e3*60*15,retry:1,refetchOnReconnect:!1},mutations:{retry:1}}}),s2=3,r2=5e3;let Sl=0;function a2(){return Sl=(Sl+1)%Number.MAX_SAFE_INTEGER,Sl.toString()}const Al=new Map,_u=t=>{if(Al.has(t))return;const s=setTimeout(()=>{Al.delete(t),$n({type:"REMOVE_TOAST",toastId:t})},r2);Al.set(t,s)},n2=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,s2)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===s.toast.id?{...r,...s.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=s;return r?_u(r):t.toasts.forEach(a=>{_u(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===r||r===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==s.toastId)}}},Ji=[];let eo={toasts:[]};function $n(t){eo=n2(eo,t),Ji.forEach(s=>{s(eo)})}function d0({...t}){const s=a2(),r=n=>$n({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>$n({type:"DISMISS_TOAST",toastId:s});return $n({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:r}}function Dt(){const[t,s]=f.useState(eo);return f.useEffect(()=>(Ji.push(s),()=>{const r=Ji.indexOf(s);r>-1&&Ji.splice(r,1)}),[t]),{...t,toast:d0,dismiss:r=>$n({type:"DISMISS_TOAST",toastId:r})}}const Cu=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Pu=i0,xn=(t,s)=>r=>{var a;if(s?.variants==null)return Pu(t,r?.class,r?.className);const{variants:n,defaultVariants:i}=s,o=Object.keys(n).map(d=>{const c=r?.[d],m=i?.[d];if(c===null)return null;const h=Cu(c)||Cu(m);return n[d][h]}),l=r&&Object.entries(r).reduce((d,c)=>{let[m,h]=c;return h===void 0||(d[m]=h),d},{}),u=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((d,c)=>{let{class:m,className:h,...x}=c;return Object.entries(x).every(p=>{let[k,g]=p;return Array.isArray(g)?g.includes({...i,...l}[k]):{...i,...l}[k]===g})?[...d,m,h]:d},[]);return Pu(t,o,u,r?.class,r?.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i2=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),u0=(...t)=>t.filter((s,r,a)=>!!s&&a.indexOf(s)===r).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var o2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l2=f.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:i,iconNode:o,...l},u)=>f.createElement("svg",{ref:u,...o2,width:s,height:s,stroke:t,strokeWidth:a?Number(r)*24/Number(s):r,className:u0("lucide",n),...l},[...o.map(([d,c])=>f.createElement(d,c)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=(t,s)=>{const r=f.forwardRef(({className:a,...n},i)=>f.createElement(l2,{ref:i,iconNode:s,className:u0(`lucide-${i2(t)}`,a),...n}));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=le("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=le("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=le("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=le("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=le("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c2=le("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d2=le("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=le("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=le("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=le("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m0=le("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=le("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=le("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Du=le("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=le("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=le("ChartGantt",[["path",{d:"M10 6h8",key:"zvc2xc"}],["path",{d:"M12 16h6",key:"yi5mkt"}],["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M8 11h7",key:"wz2hg0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u2=le("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m2=le("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h2=le("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=le("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _i=le("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f2=le("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wo=le("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=le("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=le("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=le("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mu=le("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h0=le("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=le("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p2=le("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=le("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x2=le("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=le("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g2=le("Delete",[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=le("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y2=le("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v2=le("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=le("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=le("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f0=le("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=le("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qc=le("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b2=le("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j2=le("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N2=le("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w2=le("Hammer",[["path",{d:"m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9",key:"eefl8a"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"b7pghm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k2=le("HardHat",[["path",{d:"M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z",key:"1dej2m"}],["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=le("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uc=le("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ro=le("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=le("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=le("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=le("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jl=le("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T2=le("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=le("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=le("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S2=le("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A2=le("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _2=le("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=le("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C2=le("Paintbrush",[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iu=le("PenTool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=le("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=le("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=le("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P2=le("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=le("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=le("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=le("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=le("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ec=le("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=le("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E2=le("ShieldX",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=le("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p0=le("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D2=le("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x0=le("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=le("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g0=le("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M2=le("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=le("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=le("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=le("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=le("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=le("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tc=le("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=le("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fu=le("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=le("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=le("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $u=le("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=le("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=le("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=le("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Wc="-",I2=t=>{const s=F2(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:o=>{const l=o.split(Wc);return l[0]===""&&l.length!==1&&l.shift(),y0(l,s)||R2(o)},getConflictingClassGroupIds:(o,l)=>{const u=r[o]||[];return l&&a[o]?[...u,...a[o]]:u}}},y0=(t,s)=>{if(t.length===0)return s.classGroupId;const r=t[0],a=s.nextPart.get(r),n=a?y0(t.slice(1),a):void 0;if(n)return n;if(s.validators.length===0)return;const i=t.join(Wc);return s.validators.find(({validator:o})=>o(i))?.classGroupId},Vu=/^\[(.+)\]$/,R2=t=>{if(Vu.test(t)){const s=Vu.exec(t)[1],r=s?.substring(0,s.indexOf(":"));if(r)return"arbitrary.."+r}},F2=t=>{const{theme:s,prefix:r}=t,a={nextPart:new Map,validators:[]};return V2(Object.entries(t.classGroups),r).forEach(([i,o])=>{sc(o,a,i,s)}),a},sc=(t,s,r,a)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?s:Ou(s,n);i.classGroupId=r;return}if(typeof n=="function"){if($2(n)){sc(n(a),s,r,a);return}s.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([i,o])=>{sc(o,Ou(s,i),r,a)})})},Ou=(t,s)=>{let r=t;return s.split(Wc).forEach(a=>{r.nextPart.has(a)||r.nextPart.set(a,{nextPart:new Map,validators:[]}),r=r.nextPart.get(a)}),r},$2=t=>t.isThemeGetter,V2=(t,s)=>s?t.map(([r,a])=>{const n=a.map(i=>typeof i=="string"?s+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,l])=>[s+o,l])):i);return[r,n]}):t,O2=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,r=new Map,a=new Map;const n=(i,o)=>{r.set(i,o),s++,s>t&&(s=0,a=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=a.get(i))!==void 0)return n(i,o),o},set(i,o){r.has(i)?r.set(i,o):n(i,o)}}},v0="!",L2=t=>{const{separator:s,experimentalParseClassName:r}=t,a=s.length===1,n=s[0],i=s.length,o=l=>{const u=[];let d=0,c=0,m;for(let g=0;g<l.length;g++){let b=l[g];if(d===0){if(b===n&&(a||l.slice(g,g+i)===s)){u.push(l.slice(c,g)),c=g+i;continue}if(b==="/"){m=g;continue}}b==="["?d++:b==="]"&&d--}const h=u.length===0?l:l.substring(c),x=h.startsWith(v0),p=x?h.substring(1):h,k=m&&m>c?m-c:void 0;return{modifiers:u,hasImportantModifier:x,baseClassName:p,maybePostfixModifierPosition:k}};return r?l=>r({className:l,parseClassName:o}):o},z2=t=>{if(t.length<=1)return t;const s=[];let r=[];return t.forEach(a=>{a[0]==="["?(s.push(...r.sort(),a),r=[]):r.push(a)}),s.push(...r.sort()),s},B2=t=>({cache:O2(t.cacheSize),parseClassName:L2(t),...I2(t)}),q2=/\s+/,U2=(t,s)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:n}=s,i=[],o=t.trim().split(q2);let l="";for(let u=o.length-1;u>=0;u-=1){const d=o[u],{modifiers:c,hasImportantModifier:m,baseClassName:h,maybePostfixModifierPosition:x}=r(d);let p=!!x,k=a(p?h.substring(0,x):h);if(!k){if(!p){l=d+(l.length>0?" "+l:l);continue}if(k=a(h),!k){l=d+(l.length>0?" "+l:l);continue}p=!1}const g=z2(c).join(":"),b=m?g+v0:g,j=b+k;if(i.includes(j))continue;i.push(j);const y=n(k,p);for(let M=0;M<y.length;++M){const N=y[M];i.push(b+N)}l=d+(l.length>0?" "+l:l)}return l};function W2(){let t=0,s,r,a="";for(;t<arguments.length;)(s=arguments[t++])&&(r=b0(s))&&(a&&(a+=" "),a+=r);return a}const b0=t=>{if(typeof t=="string")return t;let s,r="";for(let a=0;a<t.length;a++)t[a]&&(s=b0(t[a]))&&(r&&(r+=" "),r+=s);return r};function K2(t,...s){let r,a,n,i=o;function o(u){const d=s.reduce((c,m)=>m(c),t());return r=B2(d),a=r.cache.get,n=r.cache.set,i=l,l(u)}function l(u){const d=a(u);if(d)return d;const c=U2(u,r);return n(u,c),c}return function(){return i(W2.apply(null,arguments))}}const At=t=>{const s=r=>r[t]||[];return s.isThemeGetter=!0,s},j0=/^\[(?:([a-z-]+):)?(.+)\]$/i,G2=/^\d+\/\d+$/,H2=new Set(["px","full","screen"]),Q2=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,X2=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Z2=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Y2=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,J2=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Dr=t=>Ya(t)||H2.has(t)||G2.test(t),Zr=t=>gn(t,"length",ok),Ya=t=>!!t&&!Number.isNaN(Number(t)),Cl=t=>gn(t,"number",Ya),kn=t=>!!t&&Number.isInteger(Number(t)),ek=t=>t.endsWith("%")&&Ya(t.slice(0,-1)),Ze=t=>j0.test(t),Yr=t=>Q2.test(t),tk=new Set(["length","size","percentage"]),sk=t=>gn(t,tk,N0),rk=t=>gn(t,"position",N0),ak=new Set(["image","url"]),nk=t=>gn(t,ak,ck),ik=t=>gn(t,"",lk),Tn=()=>!0,gn=(t,s,r)=>{const a=j0.exec(t);return a?a[1]?typeof s=="string"?a[1]===s:s.has(a[1]):r(a[2]):!1},ok=t=>X2.test(t)&&!Z2.test(t),N0=()=>!1,lk=t=>Y2.test(t),ck=t=>J2.test(t),dk=()=>{const t=At("colors"),s=At("spacing"),r=At("blur"),a=At("brightness"),n=At("borderColor"),i=At("borderRadius"),o=At("borderSpacing"),l=At("borderWidth"),u=At("contrast"),d=At("grayscale"),c=At("hueRotate"),m=At("invert"),h=At("gap"),x=At("gradientColorStops"),p=At("gradientColorStopPositions"),k=At("inset"),g=At("margin"),b=At("opacity"),j=At("padding"),y=At("saturate"),M=At("scale"),N=At("sepia"),T=At("skew"),S=At("space"),I=At("translate"),E=()=>["auto","contain","none"],z=()=>["auto","hidden","clip","visible","scroll"],w=()=>["auto",Ze,s],v=()=>[Ze,s],D=()=>["",Dr,Zr],V=()=>["auto",Ya,Ze],X=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],C=()=>["solid","dashed","dotted","double","none"],q=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ue=()=>["start","end","center","between","around","evenly","stretch"],R=()=>["","0",Ze],fe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ce=()=>[Ya,Ze];return{cacheSize:500,separator:":",theme:{colors:[Tn],spacing:[Dr,Zr],blur:["none","",Yr,Ze],brightness:ce(),borderColor:[t],borderRadius:["none","","full",Yr,Ze],borderSpacing:v(),borderWidth:D(),contrast:ce(),grayscale:R(),hueRotate:ce(),invert:R(),gap:v(),gradientColorStops:[t],gradientColorStopPositions:[ek,Zr],inset:w(),margin:w(),opacity:ce(),padding:v(),saturate:ce(),scale:ce(),sepia:R(),skew:ce(),space:v(),translate:v()},classGroups:{aspect:[{aspect:["auto","square","video",Ze]}],container:["container"],columns:[{columns:[Yr]}],"break-after":[{"break-after":fe()}],"break-before":[{"break-before":fe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...X(),Ze]}],overflow:[{overflow:z()}],"overflow-x":[{"overflow-x":z()}],"overflow-y":[{"overflow-y":z()}],overscroll:[{overscroll:E()}],"overscroll-x":[{"overscroll-x":E()}],"overscroll-y":[{"overscroll-y":E()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[k]}],"inset-x":[{"inset-x":[k]}],"inset-y":[{"inset-y":[k]}],start:[{start:[k]}],end:[{end:[k]}],top:[{top:[k]}],right:[{right:[k]}],bottom:[{bottom:[k]}],left:[{left:[k]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",kn,Ze]}],basis:[{basis:w()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ze]}],grow:[{grow:R()}],shrink:[{shrink:R()}],order:[{order:["first","last","none",kn,Ze]}],"grid-cols":[{"grid-cols":[Tn]}],"col-start-end":[{col:["auto",{span:["full",kn,Ze]},Ze]}],"col-start":[{"col-start":V()}],"col-end":[{"col-end":V()}],"grid-rows":[{"grid-rows":[Tn]}],"row-start-end":[{row:["auto",{span:[kn,Ze]},Ze]}],"row-start":[{"row-start":V()}],"row-end":[{"row-end":V()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ze]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ze]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...ue()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ue(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ue(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[j]}],px:[{px:[j]}],py:[{py:[j]}],ps:[{ps:[j]}],pe:[{pe:[j]}],pt:[{pt:[j]}],pr:[{pr:[j]}],pb:[{pb:[j]}],pl:[{pl:[j]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ze,s]}],"min-w":[{"min-w":[Ze,s,"min","max","fit"]}],"max-w":[{"max-w":[Ze,s,"none","full","min","max","fit","prose",{screen:[Yr]},Yr]}],h:[{h:[Ze,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ze,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ze,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ze,s,"auto","min","max","fit"]}],"font-size":[{text:["base",Yr,Zr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Cl]}],"font-family":[{font:[Tn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ze]}],"line-clamp":[{"line-clamp":["none",Ya,Cl]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Dr,Ze]}],"list-image":[{"list-image":["none",Ze]}],"list-style-type":[{list:["none","disc","decimal",Ze]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...C(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Dr,Zr]}],"underline-offset":[{"underline-offset":["auto",Dr,Ze]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:v()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ze]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ze]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...X(),rk]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",sk]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},nk]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[x]}],"gradient-via":[{via:[x]}],"gradient-to":[{to:[x]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...C(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:C()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...C()]}],"outline-offset":[{"outline-offset":[Dr,Ze]}],"outline-w":[{outline:[Dr,Zr]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:D()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[Dr,Zr]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Yr,ik]}],"shadow-color":[{shadow:[Tn]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...q(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":q()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[a]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",Yr,Ze]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[m]}],saturate:[{saturate:[y]}],sepia:[{sepia:[N]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[m]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[y]}],"backdrop-sepia":[{"backdrop-sepia":[N]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ze]}],duration:[{duration:ce()}],ease:[{ease:["linear","in","out","in-out",Ze]}],delay:[{delay:ce()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ze]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[M]}],"scale-x":[{"scale-x":[M]}],"scale-y":[{"scale-y":[M]}],rotate:[{rotate:[kn,Ze]}],"translate-x":[{"translate-x":[I]}],"translate-y":[{"translate-y":[I]}],"skew-x":[{"skew-x":[T]}],"skew-y":[{"skew-y":[T]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ze]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ze]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":v()}],"scroll-mx":[{"scroll-mx":v()}],"scroll-my":[{"scroll-my":v()}],"scroll-ms":[{"scroll-ms":v()}],"scroll-me":[{"scroll-me":v()}],"scroll-mt":[{"scroll-mt":v()}],"scroll-mr":[{"scroll-mr":v()}],"scroll-mb":[{"scroll-mb":v()}],"scroll-ml":[{"scroll-ml":v()}],"scroll-p":[{"scroll-p":v()}],"scroll-px":[{"scroll-px":v()}],"scroll-py":[{"scroll-py":v()}],"scroll-ps":[{"scroll-ps":v()}],"scroll-pe":[{"scroll-pe":v()}],"scroll-pt":[{"scroll-pt":v()}],"scroll-pr":[{"scroll-pr":v()}],"scroll-pb":[{"scroll-pb":v()}],"scroll-pl":[{"scroll-pl":v()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ze]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Dr,Zr,Cl]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},uk=K2(dk);function de(...t){return uk(i0(t))}const Ge=t=>{if(t==null)return"0 ر.ي";let s;if(typeof t=="string"){if(t.match(/^(\d{1,3})\1{2,}$/))return"0 ر.ي";const r=t.replace(/[^\d.-]/g,"");s=parseFloat(r)}else s=t;return isNaN(s)||!isFinite(s)?"0 ر.ي":Math.abs(s)>1e11?(console.warn("⚠️ قيمة مالية غير منطقية:",s),"0 ر.ي"):`${s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})} ر.ي`},Mr=t=>{if(t==null)return 0;if(typeof t=="number")return isNaN(t)||!isFinite(t)||Math.abs(t)>1e11?0:t;if(typeof t=="string"){if(t.match(/^(\d{1,3})\1{2,}$/)||t.match(/^(\d)\1{5,}$/))return 0;const s=t.replace(/[^\d.-]/g,""),r=parseFloat(s);return isNaN(r)||!isFinite(r)||Math.abs(r)>1e11?0:r}return 0},ur=t=>{const s=typeof t=="string"?new Date(t):t;return isNaN(s.getTime())?"تاريخ غير صالح":new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"}).format(s)};function er(){return new Date().toISOString().split("T")[0]}const mk=$1,w0=f.forwardRef(({className:t,...s},r)=>e.jsx(Ig,{ref:r,className:de("fixed top-4 left-4 z-[200] flex max-h-screen w-full max-w-md flex-col gap-3 p-4 sm:max-w-[420px]",t),...s}));w0.displayName=Ig.displayName;const hk=xn("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-2xl border p-4 pr-8 shadow-2xl transition-all duration-300 ease-out data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-right-full data-[state=open]:slide-in-from-top-8 backdrop-blur-md hover:scale-[1.02] hover:shadow-3xl",{variants:{variant:{default:"border-gray-200 bg-gradient-to-r from-white/95 to-blue-50/95 text-gray-800 shadow-lg",destructive:"destructive group border-red-200 bg-gradient-to-r from-red-50/95 to-red-100/95 text-red-800 shadow-lg",success:"border-green-200 bg-gradient-to-r from-green-50/95 to-green-100/95 text-green-800 shadow-lg",warning:"border-yellow-200 bg-gradient-to-r from-yellow-50/95 to-yellow-100/95 text-yellow-800 shadow-lg"}},defaultVariants:{variant:"default"}}),k0=f.forwardRef(({className:t,variant:s,...r},a)=>e.jsx(Rg,{ref:a,className:de(hk({variant:s}),t),...r}));k0.displayName=Rg.displayName;const fk=f.forwardRef(({className:t,...s},r)=>e.jsx(Fg,{ref:r,className:de("inline-flex h-8 shrink-0 items-center justify-center rounded-xl border bg-transparent px-3 text-sm font-medium ring-offset-background transition-all duration-200 hover:bg-secondary hover:scale-105 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-red-300/40 group-[.destructive]:hover:border-red-500/30 group-[.destructive]:hover:bg-red-500 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400",t),...s}));fk.displayName=Fg.displayName;const T0=f.forwardRef(({className:t,...s},r)=>e.jsx($g,{ref:r,className:de("absolute right-2 top-2 rounded-xl p-1.5 text-foreground/50 opacity-0 transition-all duration-200 hover:text-foreground hover:bg-gray-100/80 hover:scale-110 focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:hover:bg-red-500/20 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(vr,{className:"h-4 w-4 transition-transform duration-200 hover:rotate-90"})}));T0.displayName=$g.displayName;const S0=f.forwardRef(({className:t,...s},r)=>e.jsx(Vg,{ref:r,className:de("text-sm font-bold tracking-wide",t),...s}));S0.displayName=Vg.displayName;const A0=f.forwardRef(({className:t,...s},r)=>e.jsx(Og,{ref:r,className:de("text-sm opacity-90 leading-relaxed",t),...s}));A0.displayName=Og.displayName;function pk(){const{toasts:t}=Dt();return e.jsxs(mk,{children:[t.map(function({id:s,title:r,description:a,action:n,...i}){return e.jsxs(k0,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(S0,{children:r}),a&&e.jsx(A0,{children:a})]}),n,e.jsx(T0,{})]},s)}),e.jsx(w0,{})]})}var[Ho]=Os("Tooltip",[pn]),Kc=pn(),_0="TooltipProvider",xk=700,Lu="tooltip.open",[gk,C0]=Ho(_0),P0=t=>{const{__scopeTooltip:s,delayDuration:r=xk,skipDelayDuration:a=300,disableHoverableContent:n=!1,children:i}=t,o=f.useRef(!0),l=f.useRef(!1),u=f.useRef(0);return f.useEffect(()=>{const d=u.current;return()=>window.clearTimeout(d)},[]),e.jsx(gk,{scope:s,isOpenDelayedRef:o,delayDuration:r,onOpen:f.useCallback(()=>{window.clearTimeout(u.current),o.current=!1},[]),onClose:f.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>o.current=!0,a)},[a]),isPointerInTransitRef:l,onPointerInTransitChange:f.useCallback(d=>{l.current=d},[]),disableHoverableContent:n,children:i})};P0.displayName=_0;var E0="Tooltip",[oR,Qo]=Ho(E0),rc="TooltipTrigger",yk=f.forwardRef((t,s)=>{const{__scopeTooltip:r,...a}=t,n=Qo(rc,r),i=C0(rc,r),o=Kc(r),l=f.useRef(null),u=Pt(s,l,n.onTriggerChange),d=f.useRef(!1),c=f.useRef(!1),m=f.useCallback(()=>d.current=!1,[]);return f.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),e.jsx(Bo,{asChild:!0,...o,children:e.jsx(xt.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...a,ref:u,onPointerMove:Te(t.onPointerMove,h=>{h.pointerType!=="touch"&&!c.current&&!i.isPointerInTransitRef.current&&(n.onTriggerEnter(),c.current=!0)}),onPointerLeave:Te(t.onPointerLeave,()=>{n.onTriggerLeave(),c.current=!1}),onPointerDown:Te(t.onPointerDown,()=>{n.open&&n.onClose(),d.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:Te(t.onFocus,()=>{d.current||n.onOpen()}),onBlur:Te(t.onBlur,n.onClose),onClick:Te(t.onClick,n.onClose)})})});yk.displayName=rc;var vk="TooltipPortal",[lR,bk]=Ho(vk,{forceMount:void 0}),an="TooltipContent",D0=f.forwardRef((t,s)=>{const r=bk(an,t.__scopeTooltip),{forceMount:a=r.forceMount,side:n="top",...i}=t,o=Qo(an,t.__scopeTooltip);return e.jsx(Cs,{present:a||o.open,children:o.disableHoverableContent?e.jsx(M0,{side:n,...i,ref:s}):e.jsx(jk,{side:n,...i,ref:s})})}),jk=f.forwardRef((t,s)=>{const r=Qo(an,t.__scopeTooltip),a=C0(an,t.__scopeTooltip),n=f.useRef(null),i=Pt(s,n),[o,l]=f.useState(null),{trigger:u,onClose:d}=r,c=n.current,{onPointerInTransitChange:m}=a,h=f.useCallback(()=>{l(null),m(!1)},[m]),x=f.useCallback((p,k)=>{const g=p.currentTarget,b={x:p.clientX,y:p.clientY},j=Sk(b,g.getBoundingClientRect()),y=Ak(b,j),M=_k(k.getBoundingClientRect()),N=Pk([...y,...M]);l(N),m(!0)},[m]);return f.useEffect(()=>()=>h(),[h]),f.useEffect(()=>{if(u&&c){const p=g=>x(g,c),k=g=>x(g,u);return u.addEventListener("pointerleave",p),c.addEventListener("pointerleave",k),()=>{u.removeEventListener("pointerleave",p),c.removeEventListener("pointerleave",k)}}},[u,c,x,h]),f.useEffect(()=>{if(o){const p=k=>{const g=k.target,b={x:k.clientX,y:k.clientY},j=u?.contains(g)||c?.contains(g),y=!Ck(b,o);j?h():y&&(h(),d())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[u,c,o,d,h]),e.jsx(M0,{...t,ref:i})}),[Nk,wk]=Ho(E0,{isInside:!1}),kk=Lg("TooltipContent"),M0=f.forwardRef((t,s)=>{const{__scopeTooltip:r,children:a,"aria-label":n,onEscapeKeyDown:i,onPointerDownOutside:o,...l}=t,u=Qo(an,r),d=Kc(r),{onClose:c}=u;return f.useEffect(()=>(document.addEventListener(Lu,c),()=>document.removeEventListener(Lu,c)),[c]),f.useEffect(()=>{if(u.trigger){const m=h=>{h.target?.contains(u.trigger)&&c()};return window.addEventListener("scroll",m,{capture:!0}),()=>window.removeEventListener("scroll",m,{capture:!0})}},[u.trigger,c]),e.jsx(Rc,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:m=>m.preventDefault(),onDismiss:c,children:e.jsxs(Fc,{"data-state":u.stateAttribute,...d,...l,ref:s,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(kk,{children:a}),e.jsx(Nk,{scope:r,isInside:!0,children:e.jsx(V1,{id:u.contentId,role:"tooltip",children:n||a})})]})})});D0.displayName=an;var I0="TooltipArrow",Tk=f.forwardRef((t,s)=>{const{__scopeTooltip:r,...a}=t,n=Kc(r);return wk(I0,r).isInside?null:e.jsx($c,{...n,...a,ref:s})});Tk.displayName=I0;function Sk(t,s){const r=Math.abs(s.top-t.y),a=Math.abs(s.bottom-t.y),n=Math.abs(s.right-t.x),i=Math.abs(s.left-t.x);switch(Math.min(r,a,n,i)){case i:return"left";case n:return"right";case r:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function Ak(t,s,r=5){const a=[];switch(s){case"top":a.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":a.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":a.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":a.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return a}function _k(t){const{top:s,right:r,bottom:a,left:n}=t;return[{x:n,y:s},{x:r,y:s},{x:r,y:a},{x:n,y:a}]}function Ck(t,s){const{x:r,y:a}=t;let n=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const l=s[i],u=s[o],d=l.x,c=l.y,m=u.x,h=u.y;c>a!=h>a&&r<(m-d)*(a-c)/(h-c)+d&&(n=!n)}return n}function Pk(t){const s=t.slice();return s.sort((r,a)=>r.x<a.x?-1:r.x>a.x?1:r.y<a.y?-1:r.y>a.y?1:0),Ek(s)}function Ek(t){if(t.length<=1)return t.slice();const s=[];for(let a=0;a<t.length;a++){const n=t[a];for(;s.length>=2;){const i=s[s.length-1],o=s[s.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))s.pop();else break}s.push(n)}s.pop();const r=[];for(let a=t.length-1;a>=0;a--){const n=t[a];for(;r.length>=2;){const i=r[r.length-1],o=r[r.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))r.pop();else break}r.push(n)}return r.pop(),s.length===1&&r.length===1&&s[0].x===r[0].x&&s[0].y===r[0].y?s:s.concat(r)}var Dk=P0,R0=D0;const Mk=Dk,Ik=f.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(R0,{ref:a,sideOffset:s,className:de("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...r}));Ik.displayName=R0.displayName;const ee=f.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:de("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));ee.displayName="Card";const He=f.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:de("flex flex-col space-y-1.5 p-6",t),...s}));He.displayName="CardHeader";const et=f.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:de("text-2xl font-semibold leading-none tracking-tight",t),...s}));et.displayName="CardTitle";const br=f.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:de("text-sm text-muted-foreground",t),...s}));br.displayName="CardDescription";const oe=f.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:de("p-6 pt-0",t),...s}));oe.displayName="CardContent";const Rk=f.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:de("flex items-center p-6 pt-0",t),...s}));Rk.displayName="CardFooter";function Fk(){return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:e.jsx(ee,{className:"w-full max-w-md mx-4",children:e.jsxs(oe,{className:"pt-6",children:[e.jsxs("div",{className:"flex mb-4 gap-2",children:[e.jsx(cs,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const Gc=f.createContext({});function Hc(t){const s=f.useRef(null);return s.current===null&&(s.current=t()),s.current}const Xo=f.createContext(null),Qc=f.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class $k extends f.Component{getSnapshotBeforeUpdate(s){const r=this.props.childRef.current;if(r&&s.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=r.offsetHeight||0,a.width=r.offsetWidth||0,a.top=r.offsetTop,a.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Vk({children:t,isPresent:s}){const r=f.useId(),a=f.useRef(null),n=f.useRef({width:0,height:0,top:0,left:0}),{nonce:i}=f.useContext(Qc);return f.useInsertionEffect(()=>{const{width:o,height:l,top:u,left:d}=n.current;if(s||!a.current||!o||!l)return;a.current.dataset.motionPopId=r;const c=document.createElement("style");return i&&(c.nonce=i),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${l}px !important;
            top: ${u}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[s]),e.jsx($k,{isPresent:s,childRef:a,sizeRef:n,children:f.cloneElement(t,{ref:a})})}const Ok=({children:t,initial:s,isPresent:r,onExitComplete:a,custom:n,presenceAffectsLayout:i,mode:o})=>{const l=Hc(Lk),u=f.useId(),d=f.useCallback(m=>{l.set(m,!0);for(const h of l.values())if(!h)return;a&&a()},[l,a]),c=f.useMemo(()=>({id:u,initial:s,isPresent:r,custom:n,onExitComplete:d,register:m=>(l.set(m,!1),()=>l.delete(m))}),i?[Math.random(),d]:[r,d]);return f.useMemo(()=>{l.forEach((m,h)=>l.set(h,!1))},[r]),f.useEffect(()=>{!r&&!l.size&&a&&a()},[r]),o==="popLayout"&&(t=e.jsx(Vk,{isPresent:r,children:t})),e.jsx(Xo.Provider,{value:c,children:t})};function Lk(){return new Map}function F0(t=!0){const s=f.useContext(Xo);if(s===null)return[!0,null];const{isPresent:r,onExitComplete:a,register:n}=s,i=f.useId();f.useEffect(()=>{t&&n(i)},[t]);const o=f.useCallback(()=>t&&a&&a(i),[i,a,t]);return!r&&a?[!1,o]:[!0]}const Hi=t=>t.key||"";function zu(t){const s=[];return f.Children.forEach(t,r=>{f.isValidElement(r)&&s.push(r)}),s}const Xc=typeof window<"u",$0=Xc?f.useLayoutEffect:f.useEffect,Zc=({children:t,custom:s,initial:r=!0,onExitComplete:a,presenceAffectsLayout:n=!0,mode:i="sync",propagate:o=!1})=>{const[l,u]=F0(o),d=f.useMemo(()=>zu(t),[t]),c=o&&!l?[]:d.map(Hi),m=f.useRef(!0),h=f.useRef(d),x=Hc(()=>new Map),[p,k]=f.useState(d),[g,b]=f.useState(d);$0(()=>{m.current=!1,h.current=d;for(let M=0;M<g.length;M++){const N=Hi(g[M]);c.includes(N)?x.delete(N):x.get(N)!==!0&&x.set(N,!1)}},[g,c.length,c.join("-")]);const j=[];if(d!==p){let M=[...d];for(let N=0;N<g.length;N++){const T=g[N],S=Hi(T);c.includes(S)||(M.splice(N,0,T),j.push(T))}i==="wait"&&j.length&&(M=j),b(zu(M)),k(d);return}const{forceRender:y}=f.useContext(Gc);return e.jsx(e.Fragment,{children:g.map(M=>{const N=Hi(M),T=o&&!l?!1:d===g||c.includes(N),S=()=>{if(x.has(N))x.set(N,!0);else return;let I=!0;x.forEach(E=>{E||(I=!1)}),I&&(y?.(),b(h.current),o&&u?.(),a&&a())};return e.jsx(Ok,{isPresent:T,initial:!m.current||r?void 0:!1,custom:T?void 0:s,presenceAffectsLayout:n,mode:i,onExitComplete:T?void 0:S,children:M},N)})})},Rs=t=>t;let V0=Rs;function Yc(t){let s;return()=>(s===void 0&&(s=t()),s)}const nn=(t,s,r)=>{const a=s-t;return a===0?1:(r-t)/a},qr=t=>t*1e3,Ur=t=>t/1e3,zk={useManualTiming:!1};function Bk(t){let s=new Set,r=new Set,a=!1,n=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(d){i.has(d)&&(u.schedule(d),t()),d(o)}const u={schedule:(d,c=!1,m=!1)=>{const x=m&&a?s:r;return c&&i.add(d),x.has(d)||x.add(d),d},cancel:d=>{r.delete(d),i.delete(d)},process:d=>{if(o=d,a){n=!0;return}a=!0,[s,r]=[r,s],s.forEach(l),s.clear(),a=!1,n&&(n=!1,u.process(d))}};return u}const Qi=["read","resolveKeyframes","update","preRender","render","postRender"],qk=40;function O0(t,s){let r=!1,a=!0;const n={delta:0,timestamp:0,isProcessing:!1},i=()=>r=!0,o=Qi.reduce((b,j)=>(b[j]=Bk(i),b),{}),{read:l,resolveKeyframes:u,update:d,preRender:c,render:m,postRender:h}=o,x=()=>{const b=performance.now();r=!1,n.delta=a?1e3/60:Math.max(Math.min(b-n.timestamp,qk),1),n.timestamp=b,n.isProcessing=!0,l.process(n),u.process(n),d.process(n),c.process(n),m.process(n),h.process(n),n.isProcessing=!1,r&&s&&(a=!1,t(x))},p=()=>{r=!0,a=!0,n.isProcessing||t(x)};return{schedule:Qi.reduce((b,j)=>{const y=o[j];return b[j]=(M,N=!1,T=!1)=>(r||p(),y.schedule(M,N,T)),b},{}),cancel:b=>{for(let j=0;j<Qi.length;j++)o[Qi[j]].cancel(b)},state:n,steps:o}}const{schedule:Ct,cancel:aa,state:is,steps:Pl}=O0(typeof requestAnimationFrame<"u"?requestAnimationFrame:Rs,!0),L0=f.createContext({strict:!1}),Bu={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},on={};for(const t in Bu)on[t]={isEnabled:s=>Bu[t].some(r=>!!s[r])};function Uk(t){for(const s in t)on[s]={...on[s],...t[s]}}const Wk=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ho(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Wk.has(t)}let z0=t=>!ho(t);function Kk(t){t&&(z0=s=>s.startsWith("on")?!ho(s):t(s))}try{Kk(require("@emotion/is-prop-valid").default)}catch{}function Gk(t,s,r){const a={};for(const n in t)n==="values"&&typeof t.values=="object"||(z0(n)||r===!0&&ho(n)||!s&&!ho(n)||t.draggable&&n.startsWith("onDrag"))&&(a[n]=t[n]);return a}function Hk(t){if(typeof Proxy>"u")return t;const s=new Map,r=(...a)=>t(...a);return new Proxy(r,{get:(a,n)=>n==="create"?t:(s.has(n)||s.set(n,t(n)),s.get(n))})}const Zo=f.createContext({});function Jn(t){return typeof t=="string"||Array.isArray(t)}function Yo(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const Jc=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ed=["initial",...Jc];function Jo(t){return Yo(t.animate)||ed.some(s=>Jn(t[s]))}function B0(t){return!!(Jo(t)||t.variants)}function Qk(t,s){if(Jo(t)){const{initial:r,animate:a}=t;return{initial:r===!1||Jn(r)?r:void 0,animate:Jn(a)?a:void 0}}return t.inherit!==!1?s:{}}function Xk(t){const{initial:s,animate:r}=Qk(t,f.useContext(Zo));return f.useMemo(()=>({initial:s,animate:r}),[qu(s),qu(r)])}function qu(t){return Array.isArray(t)?t.join(" "):t}const Zk=Symbol.for("motionComponentSymbol");function Ua(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function Yk(t,s,r){return f.useCallback(a=>{a&&t.onMount&&t.onMount(a),s&&(a?s.mount(a):s.unmount()),r&&(typeof r=="function"?r(a):Ua(r)&&(r.current=a))},[s])}const td=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Jk="framerAppearId",q0="data-"+td(Jk),{schedule:sd}=O0(queueMicrotask,!1),U0=f.createContext({});function eT(t,s,r,a,n){var i,o;const{visualElement:l}=f.useContext(Zo),u=f.useContext(L0),d=f.useContext(Xo),c=f.useContext(Qc).reducedMotion,m=f.useRef(null);a=a||u.renderer,!m.current&&a&&(m.current=a(t,{visualState:s,parent:l,props:r,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:c}));const h=m.current,x=f.useContext(U0);h&&!h.projection&&n&&(h.type==="html"||h.type==="svg")&&tT(m.current,r,n,x);const p=f.useRef(!1);f.useInsertionEffect(()=>{h&&p.current&&h.update(r,d)});const k=r[q0],g=f.useRef(!!k&&!(!((i=window.MotionHandoffIsComplete)===null||i===void 0)&&i.call(window,k))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,k)));return $0(()=>{h&&(p.current=!0,window.MotionIsMounted=!0,h.updateFeatures(),sd.render(h.render),g.current&&h.animationState&&h.animationState.animateChanges())}),f.useEffect(()=>{h&&(!g.current&&h.animationState&&h.animationState.animateChanges(),g.current&&(queueMicrotask(()=>{var b;(b=window.MotionHandoffMarkAsComplete)===null||b===void 0||b.call(window,k)}),g.current=!1))}),h}function tT(t,s,r,a){const{layoutId:n,layout:i,drag:o,dragConstraints:l,layoutScroll:u,layoutRoot:d}=s;t.projection=new r(t.latestValues,s["data-framer-portal-id"]?void 0:W0(t.parent)),t.projection.setOptions({layoutId:n,layout:i,alwaysMeasureLayout:!!o||l&&Ua(l),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:a,layoutScroll:u,layoutRoot:d})}function W0(t){if(t)return t.options.allowProjection!==!1?t.projection:W0(t.parent)}function sT({preloadedFeatures:t,createVisualElement:s,useRender:r,useVisualState:a,Component:n}){var i,o;t&&Uk(t);function l(d,c){let m;const h={...f.useContext(Qc),...d,layoutId:rT(d)},{isStatic:x}=h,p=Xk(d),k=a(d,x);if(!x&&Xc){aT();const g=nT(h);m=g.MeasureLayout,p.visualElement=eT(n,k,h,s,g.ProjectionNode)}return e.jsxs(Zo.Provider,{value:p,children:[m&&p.visualElement?e.jsx(m,{visualElement:p.visualElement,...h}):null,r(n,d,Yk(k,p.visualElement,c),k,x,p.visualElement)]})}l.displayName=`motion.${typeof n=="string"?n:`create(${(o=(i=n.displayName)!==null&&i!==void 0?i:n.name)!==null&&o!==void 0?o:""})`}`;const u=f.forwardRef(l);return u[Zk]=n,u}function rT({layoutId:t}){const s=f.useContext(Gc).id;return s&&t!==void 0?s+"-"+t:t}function aT(t,s){f.useContext(L0).strict}function nT(t){const{drag:s,layout:r}=on;if(!s&&!r)return{};const a={...s,...r};return{MeasureLayout:s?.isEnabled(t)||r?.isEnabled(t)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const iT=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function rd(t){return typeof t!="string"||t.includes("-")?!1:!!(iT.indexOf(t)>-1||/[A-Z]/u.test(t))}function Uu(t){const s=[{},{}];return t?.values.forEach((r,a)=>{s[0][a]=r.get(),s[1][a]=r.getVelocity()}),s}function ad(t,s,r,a){if(typeof s=="function"){const[n,i]=Uu(a);s=s(r!==void 0?r:t.custom,n,i)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[n,i]=Uu(a);s=s(r!==void 0?r:t.custom,n,i)}return s}const ac=t=>Array.isArray(t),oT=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),lT=t=>ac(t)?t[t.length-1]||0:t,ms=t=>!!(t&&t.getVelocity);function no(t){const s=ms(t)?t.get():t;return oT(s)?s.toValue():s}function cT({scrapeMotionValuesFromProps:t,createRenderState:s,onUpdate:r},a,n,i){const o={latestValues:dT(a,n,i,t),renderState:s()};return r&&(o.onMount=l=>r({props:a,current:l,...o}),o.onUpdate=l=>r(l)),o}const K0=t=>(s,r)=>{const a=f.useContext(Zo),n=f.useContext(Xo),i=()=>cT(t,s,a,n);return r?i():Hc(i)};function dT(t,s,r,a){const n={},i=a(t,{});for(const h in i)n[h]=no(i[h]);let{initial:o,animate:l}=t;const u=Jo(t),d=B0(t);s&&d&&!u&&t.inherit!==!1&&(o===void 0&&(o=s.initial),l===void 0&&(l=s.animate));let c=r?r.initial===!1:!1;c=c||o===!1;const m=c?l:o;if(m&&typeof m!="boolean"&&!Yo(m)){const h=Array.isArray(m)?m:[m];for(let x=0;x<h.length;x++){const p=ad(t,h[x]);if(p){const{transitionEnd:k,transition:g,...b}=p;for(const j in b){let y=b[j];if(Array.isArray(y)){const M=c?y.length-1:0;y=y[M]}y!==null&&(n[j]=y)}for(const j in k)n[j]=k[j]}}}return n}const yn=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ia=new Set(yn),G0=t=>s=>typeof s=="string"&&s.startsWith(t),H0=G0("--"),uT=G0("var(--"),nd=t=>uT(t)?mT.test(t.split("/*")[0].trim()):!1,mT=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Q0=(t,s)=>s&&typeof t=="number"?s.transform(t):t,Gr=(t,s,r)=>r>s?s:r<t?t:r,vn={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ei={...vn,transform:t=>Gr(0,1,t)},Xi={...vn,default:1},Ci=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),ea=Ci("deg"),jr=Ci("%"),Ie=Ci("px"),hT=Ci("vh"),fT=Ci("vw"),Wu={...jr,parse:t=>jr.parse(t)/100,transform:t=>jr.transform(t*100)},pT={borderWidth:Ie,borderTopWidth:Ie,borderRightWidth:Ie,borderBottomWidth:Ie,borderLeftWidth:Ie,borderRadius:Ie,radius:Ie,borderTopLeftRadius:Ie,borderTopRightRadius:Ie,borderBottomRightRadius:Ie,borderBottomLeftRadius:Ie,width:Ie,maxWidth:Ie,height:Ie,maxHeight:Ie,top:Ie,right:Ie,bottom:Ie,left:Ie,padding:Ie,paddingTop:Ie,paddingRight:Ie,paddingBottom:Ie,paddingLeft:Ie,margin:Ie,marginTop:Ie,marginRight:Ie,marginBottom:Ie,marginLeft:Ie,backgroundPositionX:Ie,backgroundPositionY:Ie},xT={rotate:ea,rotateX:ea,rotateY:ea,rotateZ:ea,scale:Xi,scaleX:Xi,scaleY:Xi,scaleZ:Xi,skew:ea,skewX:ea,skewY:ea,distance:Ie,translateX:Ie,translateY:Ie,translateZ:Ie,x:Ie,y:Ie,z:Ie,perspective:Ie,transformPerspective:Ie,opacity:ei,originX:Wu,originY:Wu,originZ:Ie},Ku={...vn,transform:Math.round},id={...pT,...xT,zIndex:Ku,size:Ie,fillOpacity:ei,strokeOpacity:ei,numOctaves:Ku},gT={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},yT=yn.length;function vT(t,s,r){let a="",n=!0;for(let i=0;i<yT;i++){const o=yn[i],l=t[o];if(l===void 0)continue;let u=!0;if(typeof l=="number"?u=l===(o.startsWith("scale")?1:0):u=parseFloat(l)===0,!u||r){const d=Q0(l,id[o]);if(!u){n=!1;const c=gT[o]||o;a+=`${c}(${d}) `}r&&(s[o]=d)}}return a=a.trim(),r?a=r(s,n?"":a):n&&(a="none"),a}function od(t,s,r){const{style:a,vars:n,transformOrigin:i}=t;let o=!1,l=!1;for(const u in s){const d=s[u];if(Ia.has(u)){o=!0;continue}else if(H0(u)){n[u]=d;continue}else{const c=Q0(d,id[u]);u.startsWith("origin")?(l=!0,i[u]=c):a[u]=c}}if(s.transform||(o||r?a.transform=vT(s,t.transform,r):a.transform&&(a.transform="none")),l){const{originX:u="50%",originY:d="50%",originZ:c=0}=i;a.transformOrigin=`${u} ${d} ${c}`}}const bT={offset:"stroke-dashoffset",array:"stroke-dasharray"},jT={offset:"strokeDashoffset",array:"strokeDasharray"};function NT(t,s,r=1,a=0,n=!0){t.pathLength=1;const i=n?bT:jT;t[i.offset]=Ie.transform(-a);const o=Ie.transform(s),l=Ie.transform(r);t[i.array]=`${o} ${l}`}function Gu(t,s,r){return typeof t=="string"?t:Ie.transform(s+r*t)}function wT(t,s,r){const a=Gu(s,t.x,t.width),n=Gu(r,t.y,t.height);return`${a} ${n}`}function ld(t,{attrX:s,attrY:r,attrScale:a,originX:n,originY:i,pathLength:o,pathSpacing:l=1,pathOffset:u=0,...d},c,m){if(od(t,d,m),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:x,dimensions:p}=t;h.transform&&(p&&(x.transform=h.transform),delete h.transform),p&&(n!==void 0||i!==void 0||x.transform)&&(x.transformOrigin=wT(p,n!==void 0?n:.5,i!==void 0?i:.5)),s!==void 0&&(h.x=s),r!==void 0&&(h.y=r),a!==void 0&&(h.scale=a),o!==void 0&&NT(h,o,l,u,!1)}const cd=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),X0=()=>({...cd(),attrs:{}}),dd=t=>typeof t=="string"&&t.toLowerCase()==="svg";function Z0(t,{style:s,vars:r},a,n){Object.assign(t.style,s,n&&n.getProjectionStyles(a));for(const i in r)t.style.setProperty(i,r[i])}const Y0=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function J0(t,s,r,a){Z0(t,s,void 0,a);for(const n in s.attrs)t.setAttribute(Y0.has(n)?n:td(n),s.attrs[n])}const fo={};function kT(t){Object.assign(fo,t)}function ey(t,{layout:s,layoutId:r}){return Ia.has(t)||t.startsWith("origin")||(s||r!==void 0)&&(!!fo[t]||t==="opacity")}function ud(t,s,r){var a;const{style:n}=t,i={};for(const o in n)(ms(n[o])||s.style&&ms(s.style[o])||ey(o,t)||((a=r?.getValue(o))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(i[o]=n[o]);return i}function ty(t,s,r){const a=ud(t,s,r);for(const n in t)if(ms(t[n])||ms(s[n])){const i=yn.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;a[i]=t[n]}return a}function TT(t,s){try{s.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{s.dimensions={x:0,y:0,width:0,height:0}}}const Hu=["x","y","width","height","cx","cy","r"],ST={useVisualState:K0({scrapeMotionValuesFromProps:ty,createRenderState:X0,onUpdate:({props:t,prevProps:s,current:r,renderState:a,latestValues:n})=>{if(!r)return;let i=!!t.drag;if(!i){for(const l in n)if(Ia.has(l)){i=!0;break}}if(!i)return;let o=!s;if(s)for(let l=0;l<Hu.length;l++){const u=Hu[l];t[u]!==s[u]&&(o=!0)}o&&Ct.read(()=>{TT(r,a),Ct.render(()=>{ld(a,n,dd(r.tagName),t.transformTemplate),J0(r,a)})})}})},AT={useVisualState:K0({scrapeMotionValuesFromProps:ud,createRenderState:cd})};function sy(t,s,r){for(const a in s)!ms(s[a])&&!ey(a,r)&&(t[a]=s[a])}function _T({transformTemplate:t},s){return f.useMemo(()=>{const r=cd();return od(r,s,t),Object.assign({},r.vars,r.style)},[s])}function CT(t,s){const r=t.style||{},a={};return sy(a,r,t),Object.assign(a,_T(t,s)),a}function PT(t,s){const r={},a=CT(t,s);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=a,r}function ET(t,s,r,a){const n=f.useMemo(()=>{const i=X0();return ld(i,s,dd(a),t.transformTemplate),{...i.attrs,style:{...i.style}}},[s]);if(t.style){const i={};sy(i,t.style,t),n.style={...i,...n.style}}return n}function DT(t=!1){return(r,a,n,{latestValues:i},o)=>{const u=(rd(r)?ET:PT)(a,i,o,r),d=Gk(a,typeof r=="string",t),c=r!==f.Fragment?{...d,...u,ref:n}:{},{children:m}=a,h=f.useMemo(()=>ms(m)?m.get():m,[m]);return f.createElement(r,{...c,children:h})}}function MT(t,s){return function(a,{forwardMotionProps:n}={forwardMotionProps:!1}){const o={...rd(a)?ST:AT,preloadedFeatures:t,useRender:DT(n),createVisualElement:s,Component:a};return sT(o)}}function ry(t,s){if(!Array.isArray(s))return!1;const r=s.length;if(r!==t.length)return!1;for(let a=0;a<r;a++)if(s[a]!==t[a])return!1;return!0}function el(t,s,r){const a=t.getProps();return ad(a,s,r!==void 0?r:a.custom,t)}const IT=Yc(()=>window.ScrollTimeline!==void 0);class RT{constructor(s){this.stop=()=>this.runAll("stop"),this.animations=s.filter(Boolean)}get finished(){return Promise.all(this.animations.map(s=>"finished"in s?s.finished:s))}getAll(s){return this.animations[0][s]}setAll(s,r){for(let a=0;a<this.animations.length;a++)this.animations[a][s]=r}attachTimeline(s,r){const a=this.animations.map(n=>{if(IT()&&n.attachTimeline)return n.attachTimeline(s);if(typeof r=="function")return r(n)});return()=>{a.forEach((n,i)=>{n&&n(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(s){this.setAll("time",s)}get speed(){return this.getAll("speed")}set speed(s){this.setAll("speed",s)}get startTime(){return this.getAll("startTime")}get duration(){let s=0;for(let r=0;r<this.animations.length;r++)s=Math.max(s,this.animations[r].duration);return s}runAll(s){this.animations.forEach(r=>r[s]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class FT extends RT{then(s,r){return Promise.all(this.animations).then(s).catch(r)}}function md(t,s){return t?t[s]||t.default||t:void 0}const nc=2e4;function ay(t){let s=0;const r=50;let a=t.next(s);for(;!a.done&&s<nc;)s+=r,a=t.next(s);return s>=nc?1/0:s}function hd(t){return typeof t=="function"}function Qu(t,s){t.timeline=s,t.onfinish=null}const fd=t=>Array.isArray(t)&&typeof t[0]=="number",$T={linearEasing:void 0};function VT(t,s){const r=Yc(t);return()=>{var a;return(a=$T[s])!==null&&a!==void 0?a:r()}}const po=VT(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ny=(t,s,r=10)=>{let a="";const n=Math.max(Math.round(s/r),2);for(let i=0;i<n;i++)a+=t(nn(0,n-1,i))+", ";return`linear(${a.substring(0,a.length-2)})`};function iy(t){return!!(typeof t=="function"&&po()||!t||typeof t=="string"&&(t in ic||po())||fd(t)||Array.isArray(t)&&t.every(iy))}const Dn=([t,s,r,a])=>`cubic-bezier(${t}, ${s}, ${r}, ${a})`,ic={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Dn([0,.65,.55,1]),circOut:Dn([.55,0,1,.45]),backIn:Dn([.31,.01,.66,-.59]),backOut:Dn([.33,1.53,.69,.99])};function oy(t,s){if(t)return typeof t=="function"&&po()?ny(t,s):fd(t)?Dn(t):Array.isArray(t)?t.map(r=>oy(r,s)||ic.easeOut):ic[t]}const Js={x:!1,y:!1};function ly(){return Js.x||Js.y}function OT(t,s,r){var a;if(t instanceof Element)return[t];if(typeof t=="string"){let n=document;const i=(a=void 0)!==null&&a!==void 0?a:n.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}function cy(t,s){const r=OT(t),a=new AbortController,n={passive:!0,...s,signal:a.signal};return[r,n,()=>a.abort()]}function Xu(t){return s=>{s.pointerType==="touch"||ly()||t(s)}}function LT(t,s,r={}){const[a,n,i]=cy(t,r),o=Xu(l=>{const{target:u}=l,d=s(l);if(typeof d!="function"||!u)return;const c=Xu(m=>{d(m),u.removeEventListener("pointerleave",c)});u.addEventListener("pointerleave",c,n)});return a.forEach(l=>{l.addEventListener("pointerenter",o,n)}),i}const dy=(t,s)=>s?t===s?!0:dy(t,s.parentElement):!1,pd=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,zT=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function BT(t){return zT.has(t.tagName)||t.tabIndex!==-1}const Mn=new WeakSet;function Zu(t){return s=>{s.key==="Enter"&&t(s)}}function El(t,s){t.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const qT=(t,s)=>{const r=t.currentTarget;if(!r)return;const a=Zu(()=>{if(Mn.has(r))return;El(r,"down");const n=Zu(()=>{El(r,"up")}),i=()=>El(r,"cancel");r.addEventListener("keyup",n,s),r.addEventListener("blur",i,s)});r.addEventListener("keydown",a,s),r.addEventListener("blur",()=>r.removeEventListener("keydown",a),s)};function Yu(t){return pd(t)&&!ly()}function UT(t,s,r={}){const[a,n,i]=cy(t,r),o=l=>{const u=l.currentTarget;if(!Yu(l)||Mn.has(u))return;Mn.add(u);const d=s(l),c=(x,p)=>{window.removeEventListener("pointerup",m),window.removeEventListener("pointercancel",h),!(!Yu(x)||!Mn.has(u))&&(Mn.delete(u),typeof d=="function"&&d(x,{success:p}))},m=x=>{c(x,r.useGlobalTarget||dy(u,x.target))},h=x=>{c(x,!1)};window.addEventListener("pointerup",m,n),window.addEventListener("pointercancel",h,n)};return a.forEach(l=>{!BT(l)&&l.getAttribute("tabindex")===null&&(l.tabIndex=0),(r.useGlobalTarget?window:l).addEventListener("pointerdown",o,n),l.addEventListener("focus",d=>qT(d,n),n)}),i}function WT(t){return t==="x"||t==="y"?Js[t]?null:(Js[t]=!0,()=>{Js[t]=!1}):Js.x||Js.y?null:(Js.x=Js.y=!0,()=>{Js.x=Js.y=!1})}const uy=new Set(["width","height","top","left","right","bottom",...yn]);let io;function KT(){io=void 0}const Nr={now:()=>(io===void 0&&Nr.set(is.isProcessing||zk.useManualTiming?is.timestamp:performance.now()),io),set:t=>{io=t,queueMicrotask(KT)}};function xd(t,s){t.indexOf(s)===-1&&t.push(s)}function gd(t,s){const r=t.indexOf(s);r>-1&&t.splice(r,1)}class yd{constructor(){this.subscriptions=[]}add(s){return xd(this.subscriptions,s),()=>gd(this.subscriptions,s)}notify(s,r,a){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](s,r,a);else for(let i=0;i<n;i++){const o=this.subscriptions[i];o&&o(s,r,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function my(t,s){return s?t*(1e3/s):0}const Ju=30,GT=t=>!isNaN(parseFloat(t));class HT{constructor(s,r={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,n=!0)=>{const i=Nr.now();this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(s),this.owner=r.owner}setCurrent(s){this.current=s,this.updatedAt=Nr.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=GT(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,r){this.events[s]||(this.events[s]=new yd);const a=this.events[s].add(r);return s==="change"?()=>{a(),Ct.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,r){this.passiveEffect=s,this.stopPassiveEffect=r}set(s,r=!0){!r||!this.passiveEffect?this.updateAndNotify(s,r):this.passiveEffect(s,this.updateAndNotify)}setWithVelocity(s,r,a){this.set(r),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-a}jump(s,r=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=Nr.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>Ju)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,Ju);return my(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(s){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=s(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ti(t,s){return new HT(t,s)}function QT(t,s,r){t.hasValue(s)?t.getValue(s).set(r):t.addValue(s,ti(r))}function XT(t,s){const r=el(t,s);let{transitionEnd:a={},transition:n={},...i}=r||{};i={...i,...a};for(const o in i){const l=lT(i[o]);QT(t,o,l)}}function ZT(t){return!!(ms(t)&&t.add)}function oc(t,s){const r=t.getValue("willChange");if(ZT(r))return r.add(s)}function hy(t){return t.props[q0]}const fy=(t,s,r)=>(((1-3*r+3*s)*t+(3*r-6*s))*t+3*s)*t,YT=1e-7,JT=12;function eS(t,s,r,a,n){let i,o,l=0;do o=s+(r-s)/2,i=fy(o,a,n)-t,i>0?r=o:s=o;while(Math.abs(i)>YT&&++l<JT);return o}function Pi(t,s,r,a){if(t===s&&r===a)return Rs;const n=i=>eS(i,0,1,t,r);return i=>i===0||i===1?i:fy(n(i),s,a)}const py=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,xy=t=>s=>1-t(1-s),gy=Pi(.33,1.53,.69,.99),vd=xy(gy),yy=py(vd),vy=t=>(t*=2)<1?.5*vd(t):.5*(2-Math.pow(2,-10*(t-1))),bd=t=>1-Math.sin(Math.acos(t)),by=xy(bd),jy=py(bd),Ny=t=>/^0[^.\s]+$/u.test(t);function tS(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||Ny(t):!0}const zn=t=>Math.round(t*1e5)/1e5,jd=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function sS(t){return t==null}const rS=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Nd=(t,s)=>r=>!!(typeof r=="string"&&rS.test(r)&&r.startsWith(t)||s&&!sS(r)&&Object.prototype.hasOwnProperty.call(r,s)),wy=(t,s,r)=>a=>{if(typeof a!="string")return a;const[n,i,o,l]=a.match(jd);return{[t]:parseFloat(n),[s]:parseFloat(i),[r]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},aS=t=>Gr(0,255,t),Dl={...vn,transform:t=>Math.round(aS(t))},ja={test:Nd("rgb","red"),parse:wy("red","green","blue"),transform:({red:t,green:s,blue:r,alpha:a=1})=>"rgba("+Dl.transform(t)+", "+Dl.transform(s)+", "+Dl.transform(r)+", "+zn(ei.transform(a))+")"};function nS(t){let s="",r="",a="",n="";return t.length>5?(s=t.substring(1,3),r=t.substring(3,5),a=t.substring(5,7),n=t.substring(7,9)):(s=t.substring(1,2),r=t.substring(2,3),a=t.substring(3,4),n=t.substring(4,5),s+=s,r+=r,a+=a,n+=n),{red:parseInt(s,16),green:parseInt(r,16),blue:parseInt(a,16),alpha:n?parseInt(n,16)/255:1}}const lc={test:Nd("#"),parse:nS,transform:ja.transform},Wa={test:Nd("hsl","hue"),parse:wy("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:r,alpha:a=1})=>"hsla("+Math.round(t)+", "+jr.transform(zn(s))+", "+jr.transform(zn(r))+", "+zn(ei.transform(a))+")"},us={test:t=>ja.test(t)||lc.test(t)||Wa.test(t),parse:t=>ja.test(t)?ja.parse(t):Wa.test(t)?Wa.parse(t):lc.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?ja.transform(t):Wa.transform(t)},iS=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function oS(t){var s,r;return isNaN(t)&&typeof t=="string"&&(((s=t.match(jd))===null||s===void 0?void 0:s.length)||0)+(((r=t.match(iS))===null||r===void 0?void 0:r.length)||0)>0}const ky="number",Ty="color",lS="var",cS="var(",em="${}",dS=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function si(t){const s=t.toString(),r=[],a={color:[],number:[],var:[]},n=[];let i=0;const l=s.replace(dS,u=>(us.test(u)?(a.color.push(i),n.push(Ty),r.push(us.parse(u))):u.startsWith(cS)?(a.var.push(i),n.push(lS),r.push(u)):(a.number.push(i),n.push(ky),r.push(parseFloat(u))),++i,em)).split(em);return{values:r,split:l,indexes:a,types:n}}function Sy(t){return si(t).values}function Ay(t){const{split:s,types:r}=si(t),a=s.length;return n=>{let i="";for(let o=0;o<a;o++)if(i+=s[o],n[o]!==void 0){const l=r[o];l===ky?i+=zn(n[o]):l===Ty?i+=us.transform(n[o]):i+=n[o]}return i}}const uS=t=>typeof t=="number"?0:t;function mS(t){const s=Sy(t);return Ay(t)(s.map(uS))}const na={test:oS,parse:Sy,createTransformer:Ay,getAnimatableNone:mS},hS=new Set(["brightness","contrast","saturate","opacity"]);function fS(t){const[s,r]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[a]=r.match(jd)||[];if(!a)return t;const n=r.replace(a,"");let i=hS.has(s)?1:0;return a!==r&&(i*=100),s+"("+i+n+")"}const pS=/\b([a-z-]*)\(.*?\)/gu,cc={...na,getAnimatableNone:t=>{const s=t.match(pS);return s?s.map(fS).join(" "):t}},xS={...id,color:us,backgroundColor:us,outlineColor:us,fill:us,stroke:us,borderColor:us,borderTopColor:us,borderRightColor:us,borderBottomColor:us,borderLeftColor:us,filter:cc,WebkitFilter:cc},wd=t=>xS[t];function _y(t,s){let r=wd(t);return r!==cc&&(r=na),r.getAnimatableNone?r.getAnimatableNone(s):void 0}const gS=new Set(["auto","none","0"]);function yS(t,s,r){let a=0,n;for(;a<t.length&&!n;){const i=t[a];typeof i=="string"&&!gS.has(i)&&si(i).values.length&&(n=t[a]),a++}if(n&&r)for(const i of s)t[i]=_y(r,n)}const tm=t=>t===vn||t===Ie,sm=(t,s)=>parseFloat(t.split(", ")[s]),rm=(t,s)=>(r,{transform:a})=>{if(a==="none"||!a)return 0;const n=a.match(/^matrix3d\((.+)\)$/u);if(n)return sm(n[1],s);{const i=a.match(/^matrix\((.+)\)$/u);return i?sm(i[1],t):0}},vS=new Set(["x","y","z"]),bS=yn.filter(t=>!vS.has(t));function jS(t){const s=[];return bS.forEach(r=>{const a=t.getValue(r);a!==void 0&&(s.push([r,a.get()]),a.set(r.startsWith("scale")?1:0))}),s}const ln={width:({x:t},{paddingLeft:s="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(s)-parseFloat(r),height:({y:t},{paddingTop:s="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(s)-parseFloat(r),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:rm(4,13),y:rm(5,14)};ln.translateX=ln.x;ln.translateY=ln.y;const ka=new Set;let dc=!1,uc=!1;function Cy(){if(uc){const t=Array.from(ka).filter(a=>a.needsMeasurement),s=new Set(t.map(a=>a.element)),r=new Map;s.forEach(a=>{const n=jS(a);n.length&&(r.set(a,n),a.render())}),t.forEach(a=>a.measureInitialState()),s.forEach(a=>{a.render();const n=r.get(a);n&&n.forEach(([i,o])=>{var l;(l=a.getValue(i))===null||l===void 0||l.set(o)})}),t.forEach(a=>a.measureEndState()),t.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}uc=!1,dc=!1,ka.forEach(t=>t.complete()),ka.clear()}function Py(){ka.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(uc=!0)})}function NS(){Py(),Cy()}class kd{constructor(s,r,a,n,i,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...s],this.onComplete=r,this.name=a,this.motionValue=n,this.element=i,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ka.add(this),dc||(dc=!0,Ct.read(Py),Ct.resolveKeyframes(Cy))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:r,element:a,motionValue:n}=this;for(let i=0;i<s.length;i++)if(s[i]===null)if(i===0){const o=n?.get(),l=s[s.length-1];if(o!==void 0)s[0]=o;else if(a&&r){const u=a.readValue(r,l);u!=null&&(s[0]=u)}s[0]===void 0&&(s[0]=l),n&&o===void 0&&n.set(s[0])}else s[i]=s[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ka.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ka.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Ey=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),wS=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function kS(t){const s=wS.exec(t);if(!s)return[,];const[,r,a,n]=s;return[`--${r??a}`,n]}function Dy(t,s,r=1){const[a,n]=kS(t);if(!a)return;const i=window.getComputedStyle(s).getPropertyValue(a);if(i){const o=i.trim();return Ey(o)?parseFloat(o):o}return nd(n)?Dy(n,s,r+1):n}const My=t=>s=>s.test(t),TS={test:t=>t==="auto",parse:t=>t},Iy=[vn,Ie,jr,ea,fT,hT,TS],am=t=>Iy.find(My(t));class Ry extends kd{constructor(s,r,a,n,i){super(s,r,a,n,i,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:r,name:a}=this;if(!r||!r.current)return;super.readKeyframes();for(let u=0;u<s.length;u++){let d=s[u];if(typeof d=="string"&&(d=d.trim(),nd(d))){const c=Dy(d,r.current);c!==void 0&&(s[u]=c),u===s.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!uy.has(a)||s.length!==2)return;const[n,i]=s,o=am(n),l=am(i);if(o!==l)if(tm(o)&&tm(l))for(let u=0;u<s.length;u++){const d=s[u];typeof d=="string"&&(s[u]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:r}=this,a=[];for(let n=0;n<s.length;n++)tS(s[n])&&a.push(n);a.length&&yS(s,a,r)}measureInitialState(){const{element:s,unresolvedKeyframes:r,name:a}=this;if(!s||!s.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ln[a](s.measureViewportBox(),window.getComputedStyle(s.current)),r[0]=this.measuredOrigin;const n=r[r.length-1];n!==void 0&&s.getValue(a,n).jump(n,!1)}measureEndState(){var s;const{element:r,name:a,unresolvedKeyframes:n}=this;if(!r||!r.current)return;const i=r.getValue(a);i&&i.jump(this.measuredOrigin,!1);const o=n.length-1,l=n[o];n[o]=ln[a](r.measureViewportBox(),window.getComputedStyle(r.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),!((s=this.removedTransforms)===null||s===void 0)&&s.length&&this.removedTransforms.forEach(([u,d])=>{r.getValue(u).set(d)}),this.resolveNoneKeyframes()}}const nm=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(na.test(t)||t==="0")&&!t.startsWith("url("));function SS(t){const s=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==s)return!0}function AS(t,s,r,a){const n=t[0];if(n===null)return!1;if(s==="display"||s==="visibility")return!0;const i=t[t.length-1],o=nm(n,s),l=nm(i,s);return!o||!l?!1:SS(t)||(r==="spring"||hd(r))&&a}const _S=t=>t!==null;function tl(t,{repeat:s,repeatType:r="loop"},a){const n=t.filter(_S),i=s&&r!=="loop"&&s%2===1?0:n.length-1;return!i||a===void 0?n[i]:a}const CS=40;class Fy{constructor({autoplay:s=!0,delay:r=0,type:a="keyframes",repeat:n=0,repeatDelay:i=0,repeatType:o="loop",...l}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Nr.now(),this.options={autoplay:s,delay:r,type:a,repeat:n,repeatDelay:i,repeatType:o,...l},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>CS?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&NS(),this._resolved}onKeyframesResolved(s,r){this.resolvedAt=Nr.now(),this.hasAttemptedResolve=!0;const{name:a,type:n,velocity:i,delay:o,onComplete:l,onUpdate:u,isGenerator:d}=this.options;if(!d&&!AS(s,a,n,i))if(o)this.options.duration=0;else{u&&u(tl(s,this.options,r)),l&&l(),this.resolveFinishedPromise();return}const c=this.initPlayback(s,r);c!==!1&&(this._resolved={keyframes:s,finalKeyframe:r,...c},this.onPostResolved())}onPostResolved(){}then(s,r){return this.currentFinishedPromise.then(s,r)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(s=>{this.resolveFinishedPromise=s})}}const Ft=(t,s,r)=>t+(s-t)*r;function Ml(t,s,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(s-t)*6*r:r<1/2?s:r<2/3?t+(s-t)*(2/3-r)*6:t}function PS({hue:t,saturation:s,lightness:r,alpha:a}){t/=360,s/=100,r/=100;let n=0,i=0,o=0;if(!s)n=i=o=r;else{const l=r<.5?r*(1+s):r+s-r*s,u=2*r-l;n=Ml(u,l,t+1/3),i=Ml(u,l,t),o=Ml(u,l,t-1/3)}return{red:Math.round(n*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:a}}function xo(t,s){return r=>r>0?s:t}const Il=(t,s,r)=>{const a=t*t,n=r*(s*s-a)+a;return n<0?0:Math.sqrt(n)},ES=[lc,ja,Wa],DS=t=>ES.find(s=>s.test(t));function im(t){const s=DS(t);if(!s)return!1;let r=s.parse(t);return s===Wa&&(r=PS(r)),r}const om=(t,s)=>{const r=im(t),a=im(s);if(!r||!a)return xo(t,s);const n={...r};return i=>(n.red=Il(r.red,a.red,i),n.green=Il(r.green,a.green,i),n.blue=Il(r.blue,a.blue,i),n.alpha=Ft(r.alpha,a.alpha,i),ja.transform(n))},MS=(t,s)=>r=>s(t(r)),Ei=(...t)=>t.reduce(MS),mc=new Set(["none","hidden"]);function IS(t,s){return mc.has(t)?r=>r<=0?t:s:r=>r>=1?s:t}function RS(t,s){return r=>Ft(t,s,r)}function Td(t){return typeof t=="number"?RS:typeof t=="string"?nd(t)?xo:us.test(t)?om:VS:Array.isArray(t)?$y:typeof t=="object"?us.test(t)?om:FS:xo}function $y(t,s){const r=[...t],a=r.length,n=t.map((i,o)=>Td(i)(i,s[o]));return i=>{for(let o=0;o<a;o++)r[o]=n[o](i);return r}}function FS(t,s){const r={...t,...s},a={};for(const n in r)t[n]!==void 0&&s[n]!==void 0&&(a[n]=Td(t[n])(t[n],s[n]));return n=>{for(const i in a)r[i]=a[i](n);return r}}function $S(t,s){var r;const a=[],n={color:0,var:0,number:0};for(let i=0;i<s.values.length;i++){const o=s.types[i],l=t.indexes[o][n[o]],u=(r=t.values[l])!==null&&r!==void 0?r:0;a[i]=u,n[o]++}return a}const VS=(t,s)=>{const r=na.createTransformer(s),a=si(t),n=si(s);return a.indexes.var.length===n.indexes.var.length&&a.indexes.color.length===n.indexes.color.length&&a.indexes.number.length>=n.indexes.number.length?mc.has(t)&&!n.values.length||mc.has(s)&&!a.values.length?IS(t,s):Ei($y($S(a,n),n.values),r):xo(t,s)};function Vy(t,s,r){return typeof t=="number"&&typeof s=="number"&&typeof r=="number"?Ft(t,s,r):Td(t)(t,s)}const OS=5;function Oy(t,s,r){const a=Math.max(s-OS,0);return my(r-t(a),s-a)}const $t={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Rl=.001;function LS({duration:t=$t.duration,bounce:s=$t.bounce,velocity:r=$t.velocity,mass:a=$t.mass}){let n,i,o=1-s;o=Gr($t.minDamping,$t.maxDamping,o),t=Gr($t.minDuration,$t.maxDuration,Ur(t)),o<1?(n=d=>{const c=d*o,m=c*t,h=c-r,x=hc(d,o),p=Math.exp(-m);return Rl-h/x*p},i=d=>{const m=d*o*t,h=m*r+r,x=Math.pow(o,2)*Math.pow(d,2)*t,p=Math.exp(-m),k=hc(Math.pow(d,2),o);return(-n(d)+Rl>0?-1:1)*((h-x)*p)/k}):(n=d=>{const c=Math.exp(-d*t),m=(d-r)*t+1;return-Rl+c*m},i=d=>{const c=Math.exp(-d*t),m=(r-d)*(t*t);return c*m});const l=5/t,u=BS(n,i,l);if(t=qr(t),isNaN(u))return{stiffness:$t.stiffness,damping:$t.damping,duration:t};{const d=Math.pow(u,2)*a;return{stiffness:d,damping:o*2*Math.sqrt(a*d),duration:t}}}const zS=12;function BS(t,s,r){let a=r;for(let n=1;n<zS;n++)a=a-t(a)/s(a);return a}function hc(t,s){return t*Math.sqrt(1-s*s)}const qS=["duration","bounce"],US=["stiffness","damping","mass"];function lm(t,s){return s.some(r=>t[r]!==void 0)}function WS(t){let s={velocity:$t.velocity,stiffness:$t.stiffness,damping:$t.damping,mass:$t.mass,isResolvedFromDuration:!1,...t};if(!lm(t,US)&&lm(t,qS))if(t.visualDuration){const r=t.visualDuration,a=2*Math.PI/(r*1.2),n=a*a,i=2*Gr(.05,1,1-(t.bounce||0))*Math.sqrt(n);s={...s,mass:$t.mass,stiffness:n,damping:i}}else{const r=LS(t);s={...s,...r,mass:$t.mass},s.isResolvedFromDuration=!0}return s}function Ly(t=$t.visualDuration,s=$t.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:a,restDelta:n}=r;const i=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],l={done:!1,value:i},{stiffness:u,damping:d,mass:c,duration:m,velocity:h,isResolvedFromDuration:x}=WS({...r,velocity:-Ur(r.velocity||0)}),p=h||0,k=d/(2*Math.sqrt(u*c)),g=o-i,b=Ur(Math.sqrt(u/c)),j=Math.abs(g)<5;a||(a=j?$t.restSpeed.granular:$t.restSpeed.default),n||(n=j?$t.restDelta.granular:$t.restDelta.default);let y;if(k<1){const N=hc(b,k);y=T=>{const S=Math.exp(-k*b*T);return o-S*((p+k*b*g)/N*Math.sin(N*T)+g*Math.cos(N*T))}}else if(k===1)y=N=>o-Math.exp(-b*N)*(g+(p+b*g)*N);else{const N=b*Math.sqrt(k*k-1);y=T=>{const S=Math.exp(-k*b*T),I=Math.min(N*T,300);return o-S*((p+k*b*g)*Math.sinh(I)+N*g*Math.cosh(I))/N}}const M={calculatedDuration:x&&m||null,next:N=>{const T=y(N);if(x)l.done=N>=m;else{let S=0;k<1&&(S=N===0?qr(p):Oy(y,N,T));const I=Math.abs(S)<=a,E=Math.abs(o-T)<=n;l.done=I&&E}return l.value=l.done?o:T,l},toString:()=>{const N=Math.min(ay(M),nc),T=ny(S=>M.next(N*S).value,N,30);return N+"ms "+T}};return M}function cm({keyframes:t,velocity:s=0,power:r=.8,timeConstant:a=325,bounceDamping:n=10,bounceStiffness:i=500,modifyTarget:o,min:l,max:u,restDelta:d=.5,restSpeed:c}){const m=t[0],h={done:!1,value:m},x=I=>l!==void 0&&I<l||u!==void 0&&I>u,p=I=>l===void 0?u:u===void 0||Math.abs(l-I)<Math.abs(u-I)?l:u;let k=r*s;const g=m+k,b=o===void 0?g:o(g);b!==g&&(k=b-m);const j=I=>-k*Math.exp(-I/a),y=I=>b+j(I),M=I=>{const E=j(I),z=y(I);h.done=Math.abs(E)<=d,h.value=h.done?b:z};let N,T;const S=I=>{x(h.value)&&(N=I,T=Ly({keyframes:[h.value,p(h.value)],velocity:Oy(y,I,h.value),damping:n,stiffness:i,restDelta:d,restSpeed:c}))};return S(0),{calculatedDuration:null,next:I=>{let E=!1;return!T&&N===void 0&&(E=!0,M(I),S(I)),N!==void 0&&I>=N?T.next(I-N):(!E&&M(I),h)}}}const KS=Pi(.42,0,1,1),GS=Pi(0,0,.58,1),zy=Pi(.42,0,.58,1),HS=t=>Array.isArray(t)&&typeof t[0]!="number",QS={linear:Rs,easeIn:KS,easeInOut:zy,easeOut:GS,circIn:bd,circInOut:jy,circOut:by,backIn:vd,backInOut:yy,backOut:gy,anticipate:vy},dm=t=>{if(fd(t)){V0(t.length===4);const[s,r,a,n]=t;return Pi(s,r,a,n)}else if(typeof t=="string")return QS[t];return t};function XS(t,s,r){const a=[],n=r||Vy,i=t.length-1;for(let o=0;o<i;o++){let l=n(t[o],t[o+1]);if(s){const u=Array.isArray(s)?s[o]||Rs:s;l=Ei(u,l)}a.push(l)}return a}function ZS(t,s,{clamp:r=!0,ease:a,mixer:n}={}){const i=t.length;if(V0(i===s.length),i===1)return()=>s[0];if(i===2&&s[0]===s[1])return()=>s[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),s=[...s].reverse());const l=XS(s,a,n),u=l.length,d=c=>{if(o&&c<t[0])return s[0];let m=0;if(u>1)for(;m<t.length-2&&!(c<t[m+1]);m++);const h=nn(t[m],t[m+1],c);return l[m](h)};return r?c=>d(Gr(t[0],t[i-1],c)):d}function YS(t,s){const r=t[t.length-1];for(let a=1;a<=s;a++){const n=nn(0,s,a);t.push(Ft(r,1,n))}}function JS(t){const s=[0];return YS(s,t.length-1),s}function eA(t,s){return t.map(r=>r*s)}function tA(t,s){return t.map(()=>s||zy).splice(0,t.length-1)}function go({duration:t=300,keyframes:s,times:r,ease:a="easeInOut"}){const n=HS(a)?a.map(dm):dm(a),i={done:!1,value:s[0]},o=eA(r&&r.length===s.length?r:JS(s),t),l=ZS(o,s,{ease:Array.isArray(n)?n:tA(s,n)});return{calculatedDuration:t,next:u=>(i.value=l(u),i.done=u>=t,i)}}const sA=t=>{const s=({timestamp:r})=>t(r);return{start:()=>Ct.update(s,!0),stop:()=>aa(s),now:()=>is.isProcessing?is.timestamp:Nr.now()}},rA={decay:cm,inertia:cm,tween:go,keyframes:go,spring:Ly},aA=t=>t/100;class Sd extends Fy{constructor(s){super(s),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:u}=this.options;u&&u()};const{name:r,motionValue:a,element:n,keyframes:i}=this.options,o=n?.KeyframeResolver||kd,l=(u,d)=>this.onKeyframesResolved(u,d);this.resolver=new o(i,l,r,a,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(s){const{type:r="keyframes",repeat:a=0,repeatDelay:n=0,repeatType:i,velocity:o=0}=this.options,l=hd(r)?r:rA[r]||go;let u,d;l!==go&&typeof s[0]!="number"&&(u=Ei(aA,Vy(s[0],s[1])),s=[0,100]);const c=l({...this.options,keyframes:s});i==="mirror"&&(d=l({...this.options,keyframes:[...s].reverse(),velocity:-o})),c.calculatedDuration===null&&(c.calculatedDuration=ay(c));const{calculatedDuration:m}=c,h=m+n,x=h*(a+1)-n;return{generator:c,mirroredGenerator:d,mapPercentToKeyframes:u,calculatedDuration:m,resolvedDuration:h,totalDuration:x}}onPostResolved(){const{autoplay:s=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!s?this.pause():this.state=this.pendingPlayState}tick(s,r=!1){const{resolved:a}=this;if(!a){const{keyframes:I}=this.options;return{done:!0,value:I[I.length-1]}}const{finalKeyframe:n,generator:i,mirroredGenerator:o,mapPercentToKeyframes:l,keyframes:u,calculatedDuration:d,totalDuration:c,resolvedDuration:m}=a;if(this.startTime===null)return i.next(0);const{delay:h,repeat:x,repeatType:p,repeatDelay:k,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-c/this.speed,this.startTime)),r?this.currentTime=s:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(s-this.startTime)*this.speed;const b=this.currentTime-h*(this.speed>=0?1:-1),j=this.speed>=0?b<0:b>c;this.currentTime=Math.max(b,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let y=this.currentTime,M=i;if(x){const I=Math.min(this.currentTime,c)/m;let E=Math.floor(I),z=I%1;!z&&I>=1&&(z=1),z===1&&E--,E=Math.min(E,x+1),!!(E%2)&&(p==="reverse"?(z=1-z,k&&(z-=k/m)):p==="mirror"&&(M=o)),y=Gr(0,1,z)*m}const N=j?{done:!1,value:u[0]}:M.next(y);l&&(N.value=l(N.value));let{done:T}=N;!j&&d!==null&&(T=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const S=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return S&&n!==void 0&&(N.value=tl(u,this.options,n)),g&&g(N.value),S&&this.finish(),N}get duration(){const{resolved:s}=this;return s?Ur(s.calculatedDuration):0}get time(){return Ur(this.currentTime)}set time(s){s=qr(s),this.currentTime=s,this.holdTime!==null||this.speed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.speed)}get speed(){return this.playbackSpeed}set speed(s){const r=this.playbackSpeed!==s;this.playbackSpeed=s,r&&(this.time=Ur(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:s=sA,onPlay:r,startTime:a}=this.options;this.driver||(this.driver=s(i=>this.tick(i))),r&&r();const n=this.driver.now();this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=n):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var s;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(s=this.currentTime)!==null&&s!==void 0?s:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:s}=this.options;s&&s()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}}const nA=new Set(["opacity","clipPath","filter","transform"]);function iA(t,s,r,{delay:a=0,duration:n=300,repeat:i=0,repeatType:o="loop",ease:l="easeInOut",times:u}={}){const d={[s]:r};u&&(d.offset=u);const c=oy(l,n);return Array.isArray(c)&&(d.easing=c),t.animate(d,{delay:a,duration:n,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}const oA=Yc(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),yo=10,lA=2e4;function cA(t){return hd(t.type)||t.type==="spring"||!iy(t.ease)}function dA(t,s){const r=new Sd({...s,keyframes:t,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:t[0]};const n=[];let i=0;for(;!a.done&&i<lA;)a=r.sample(i),n.push(a.value),i+=yo;return{times:void 0,keyframes:n,duration:i-yo,ease:"linear"}}const By={anticipate:vy,backInOut:yy,circInOut:jy};function uA(t){return t in By}class um extends Fy{constructor(s){super(s);const{name:r,motionValue:a,element:n,keyframes:i}=this.options;this.resolver=new Ry(i,(o,l)=>this.onKeyframesResolved(o,l),r,a,n),this.resolver.scheduleResolve()}initPlayback(s,r){let{duration:a=300,times:n,ease:i,type:o,motionValue:l,name:u,startTime:d}=this.options;if(!l.owner||!l.owner.current)return!1;if(typeof i=="string"&&po()&&uA(i)&&(i=By[i]),cA(this.options)){const{onComplete:m,onUpdate:h,motionValue:x,element:p,...k}=this.options,g=dA(s,k);s=g.keyframes,s.length===1&&(s[1]=s[0]),a=g.duration,n=g.times,i=g.ease,o="keyframes"}const c=iA(l.owner.current,u,s,{...this.options,duration:a,times:n,ease:i});return c.startTime=d??this.calcStartTime(),this.pendingTimeline?(Qu(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:m}=this.options;l.set(tl(s,this.options,r)),m&&m(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:a,times:n,type:o,ease:i,keyframes:s}}get duration(){const{resolved:s}=this;if(!s)return 0;const{duration:r}=s;return Ur(r)}get time(){const{resolved:s}=this;if(!s)return 0;const{animation:r}=s;return Ur(r.currentTime||0)}set time(s){const{resolved:r}=this;if(!r)return;const{animation:a}=r;a.currentTime=qr(s)}get speed(){const{resolved:s}=this;if(!s)return 1;const{animation:r}=s;return r.playbackRate}set speed(s){const{resolved:r}=this;if(!r)return;const{animation:a}=r;a.playbackRate=s}get state(){const{resolved:s}=this;if(!s)return"idle";const{animation:r}=s;return r.playState}get startTime(){const{resolved:s}=this;if(!s)return null;const{animation:r}=s;return r.startTime}attachTimeline(s){if(!this._resolved)this.pendingTimeline=s;else{const{resolved:r}=this;if(!r)return Rs;const{animation:a}=r;Qu(a,s)}return Rs}play(){if(this.isStopped)return;const{resolved:s}=this;if(!s)return;const{animation:r}=s;r.playState==="finished"&&this.updateFinishedPromise(),r.play()}pause(){const{resolved:s}=this;if(!s)return;const{animation:r}=s;r.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:s}=this;if(!s)return;const{animation:r,keyframes:a,duration:n,type:i,ease:o,times:l}=s;if(r.playState==="idle"||r.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:c,onComplete:m,element:h,...x}=this.options,p=new Sd({...x,keyframes:a,duration:n,type:i,ease:o,times:l,isGenerator:!0}),k=qr(this.time);d.setWithVelocity(p.sample(k-yo).value,p.sample(k).value,yo)}const{onStop:u}=this.options;u&&u(),this.cancel()}complete(){const{resolved:s}=this;s&&s.animation.finish()}cancel(){const{resolved:s}=this;s&&s.animation.cancel()}static supports(s){const{motionValue:r,name:a,repeatDelay:n,repeatType:i,damping:o,type:l}=s;if(!r||!r.owner||!(r.owner.current instanceof HTMLElement))return!1;const{onUpdate:u,transformTemplate:d}=r.owner.getProps();return oA()&&a&&nA.has(a)&&!u&&!d&&!n&&i!=="mirror"&&o!==0&&l!=="inertia"}}const mA={type:"spring",stiffness:500,damping:25,restSpeed:10},hA=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),fA={type:"keyframes",duration:.8},pA={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},xA=(t,{keyframes:s})=>s.length>2?fA:Ia.has(t)?t.startsWith("scale")?hA(s[1]):mA:pA;function gA({when:t,delay:s,delayChildren:r,staggerChildren:a,staggerDirection:n,repeat:i,repeatType:o,repeatDelay:l,from:u,elapsed:d,...c}){return!!Object.keys(c).length}const Ad=(t,s,r,a={},n,i)=>o=>{const l=md(a,t)||{},u=l.delay||a.delay||0;let{elapsed:d=0}=a;d=d-qr(u);let c={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:s.getVelocity(),...l,delay:-d,onUpdate:h=>{s.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:s,element:i?void 0:n};gA(l)||(c={...c,...xA(t,c)}),c.duration&&(c.duration=qr(c.duration)),c.repeatDelay&&(c.repeatDelay=qr(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let m=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(c.duration=0,c.delay===0&&(m=!0)),m&&!i&&s.get()!==void 0){const h=tl(c.keyframes,l);if(h!==void 0)return Ct.update(()=>{c.onUpdate(h),c.onComplete()}),new FT([])}return!i&&um.supports(c)?new um(c):new Sd(c)};function yA({protectedKeys:t,needsAnimating:s},r){const a=t.hasOwnProperty(r)&&s[r]!==!0;return s[r]=!1,a}function qy(t,s,{delay:r=0,transitionOverride:a,type:n}={}){var i;let{transition:o=t.getDefaultTransition(),transitionEnd:l,...u}=s;a&&(o=a);const d=[],c=n&&t.animationState&&t.animationState.getState()[n];for(const m in u){const h=t.getValue(m,(i=t.latestValues[m])!==null&&i!==void 0?i:null),x=u[m];if(x===void 0||c&&yA(c,m))continue;const p={delay:r,...md(o||{},m)};let k=!1;if(window.MotionHandoffAnimation){const b=hy(t);if(b){const j=window.MotionHandoffAnimation(b,m,Ct);j!==null&&(p.startTime=j,k=!0)}}oc(t,m),h.start(Ad(m,h,x,t.shouldReduceMotion&&uy.has(m)?{type:!1}:p,t,k));const g=h.animation;g&&d.push(g)}return l&&Promise.all(d).then(()=>{Ct.update(()=>{l&&XT(t,l)})}),d}function fc(t,s,r={}){var a;const n=el(t,s,r.type==="exit"?(a=t.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(i=r.transitionOverride);const o=n?()=>Promise.all(qy(t,n,r)):()=>Promise.resolve(),l=t.variantChildren&&t.variantChildren.size?(d=0)=>{const{delayChildren:c=0,staggerChildren:m,staggerDirection:h}=i;return vA(t,s,c+d,m,h,r)}:()=>Promise.resolve(),{when:u}=i;if(u){const[d,c]=u==="beforeChildren"?[o,l]:[l,o];return d().then(()=>c())}else return Promise.all([o(),l(r.delay)])}function vA(t,s,r=0,a=0,n=1,i){const o=[],l=(t.variantChildren.size-1)*a,u=n===1?(d=0)=>d*a:(d=0)=>l-d*a;return Array.from(t.variantChildren).sort(bA).forEach((d,c)=>{d.notify("AnimationStart",s),o.push(fc(d,s,{...i,delay:r+u(c)}).then(()=>d.notify("AnimationComplete",s)))}),Promise.all(o)}function bA(t,s){return t.sortNodePosition(s)}function jA(t,s,r={}){t.notify("AnimationStart",s);let a;if(Array.isArray(s)){const n=s.map(i=>fc(t,i,r));a=Promise.all(n)}else if(typeof s=="string")a=fc(t,s,r);else{const n=typeof s=="function"?el(t,s,r.custom):s;a=Promise.all(qy(t,n,r))}return a.then(()=>{t.notify("AnimationComplete",s)})}const NA=ed.length;function Uy(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?Uy(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const s={};for(let r=0;r<NA;r++){const a=ed[r],n=t.props[a];(Jn(n)||n===!1)&&(s[a]=n)}return s}const wA=[...Jc].reverse(),kA=Jc.length;function TA(t){return s=>Promise.all(s.map(({animation:r,options:a})=>jA(t,r,a)))}function SA(t){let s=TA(t),r=mm(),a=!0;const n=u=>(d,c)=>{var m;const h=el(t,c,u==="exit"?(m=t.presenceContext)===null||m===void 0?void 0:m.custom:void 0);if(h){const{transition:x,transitionEnd:p,...k}=h;d={...d,...k,...p}}return d};function i(u){s=u(t)}function o(u){const{props:d}=t,c=Uy(t.parent)||{},m=[],h=new Set;let x={},p=1/0;for(let g=0;g<kA;g++){const b=wA[g],j=r[b],y=d[b]!==void 0?d[b]:c[b],M=Jn(y),N=b===u?j.isActive:null;N===!1&&(p=g);let T=y===c[b]&&y!==d[b]&&M;if(T&&a&&t.manuallyAnimateOnMount&&(T=!1),j.protectedKeys={...x},!j.isActive&&N===null||!y&&!j.prevProp||Yo(y)||typeof y=="boolean")continue;const S=AA(j.prevProp,y);let I=S||b===u&&j.isActive&&!T&&M||g>p&&M,E=!1;const z=Array.isArray(y)?y:[y];let w=z.reduce(n(b),{});N===!1&&(w={});const{prevResolvedValues:v={}}=j,D={...v,...w},V=q=>{I=!0,h.has(q)&&(E=!0,h.delete(q)),j.needsAnimating[q]=!0;const ue=t.getValue(q);ue&&(ue.liveStyle=!1)};for(const q in D){const ue=w[q],R=v[q];if(x.hasOwnProperty(q))continue;let fe=!1;ac(ue)&&ac(R)?fe=!ry(ue,R):fe=ue!==R,fe?ue!=null?V(q):h.add(q):ue!==void 0&&h.has(q)?V(q):j.protectedKeys[q]=!0}j.prevProp=y,j.prevResolvedValues=w,j.isActive&&(x={...x,...w}),a&&t.blockInitialAnimation&&(I=!1),I&&(!(T&&S)||E)&&m.push(...z.map(q=>({animation:q,options:{type:b}})))}if(h.size){const g={};h.forEach(b=>{const j=t.getBaseTarget(b),y=t.getValue(b);y&&(y.liveStyle=!0),g[b]=j??null}),m.push({animation:g})}let k=!!m.length;return a&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(k=!1),a=!1,k?s(m):Promise.resolve()}function l(u,d){var c;if(r[u].isActive===d)return Promise.resolve();(c=t.variantChildren)===null||c===void 0||c.forEach(h=>{var x;return(x=h.animationState)===null||x===void 0?void 0:x.setActive(u,d)}),r[u].isActive=d;const m=o(u);for(const h in r)r[h].protectedKeys={};return m}return{animateChanges:o,setActive:l,setAnimateFunction:i,getState:()=>r,reset:()=>{r=mm(),a=!0}}}function AA(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!ry(s,t):!1}function fa(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function mm(){return{animate:fa(!0),whileInView:fa(),whileHover:fa(),whileTap:fa(),whileDrag:fa(),whileFocus:fa(),exit:fa()}}class ma{constructor(s){this.isMounted=!1,this.node=s}update(){}}class _A extends ma{constructor(s){super(s),s.animationState||(s.animationState=SA(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();Yo(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:r}=this.node.prevProps||{};s!==r&&this.updateAnimationControlsSubscription()}unmount(){var s;this.node.animationState.reset(),(s=this.unmountControls)===null||s===void 0||s.call(this)}}let CA=0;class PA extends ma{constructor(){super(...arguments),this.id=CA++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:r}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===a)return;const n=this.node.animationState.setActive("exit",!s);r&&!s&&n.then(()=>r(this.id))}mount(){const{register:s}=this.node.presenceContext||{};s&&(this.unmount=s(this.id))}unmount(){}}const EA={animation:{Feature:_A},exit:{Feature:PA}};function ri(t,s,r,a={passive:!0}){return t.addEventListener(s,r,a),()=>t.removeEventListener(s,r)}function Di(t){return{point:{x:t.pageX,y:t.pageY}}}const DA=t=>s=>pd(s)&&t(s,Di(s));function Bn(t,s,r,a){return ri(t,s,DA(r),a)}const hm=(t,s)=>Math.abs(t-s);function MA(t,s){const r=hm(t.x,s.x),a=hm(t.y,s.y);return Math.sqrt(r**2+a**2)}class Wy{constructor(s,r,{transformPagePoint:a,contextWindow:n,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=$l(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,x=MA(m.offset,{x:0,y:0})>=3;if(!h&&!x)return;const{point:p}=m,{timestamp:k}=is;this.history.push({...p,timestamp:k});const{onStart:g,onMove:b}=this.handlers;h||(g&&g(this.lastMoveEvent,m),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,m)},this.handlePointerMove=(m,h)=>{this.lastMoveEvent=m,this.lastMoveEventInfo=Fl(h,this.transformPagePoint),Ct.update(this.updatePoint,!0)},this.handlePointerUp=(m,h)=>{this.end();const{onEnd:x,onSessionEnd:p,resumeAnimation:k}=this.handlers;if(this.dragSnapToOrigin&&k&&k(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=$l(m.type==="pointercancel"?this.lastMoveEventInfo:Fl(h,this.transformPagePoint),this.history);this.startEvent&&x&&x(m,g),p&&p(m,g)},!pd(s))return;this.dragSnapToOrigin=i,this.handlers=r,this.transformPagePoint=a,this.contextWindow=n||window;const o=Di(s),l=Fl(o,this.transformPagePoint),{point:u}=l,{timestamp:d}=is;this.history=[{...u,timestamp:d}];const{onSessionStart:c}=r;c&&c(s,$l(l,this.history)),this.removeListeners=Ei(Bn(this.contextWindow,"pointermove",this.handlePointerMove),Bn(this.contextWindow,"pointerup",this.handlePointerUp),Bn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),aa(this.updatePoint)}}function Fl(t,s){return s?{point:s(t.point)}:t}function fm(t,s){return{x:t.x-s.x,y:t.y-s.y}}function $l({point:t},s){return{point:t,delta:fm(t,Ky(s)),offset:fm(t,IA(s)),velocity:RA(s,.1)}}function IA(t){return t[0]}function Ky(t){return t[t.length-1]}function RA(t,s){if(t.length<2)return{x:0,y:0};let r=t.length-1,a=null;const n=Ky(t);for(;r>=0&&(a=t[r],!(n.timestamp-a.timestamp>qr(s)));)r--;if(!a)return{x:0,y:0};const i=Ur(n.timestamp-a.timestamp);if(i===0)return{x:0,y:0};const o={x:(n.x-a.x)/i,y:(n.y-a.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const Gy=1e-4,FA=1-Gy,$A=1+Gy,Hy=.01,VA=0-Hy,OA=0+Hy;function Vs(t){return t.max-t.min}function LA(t,s,r){return Math.abs(t-s)<=r}function pm(t,s,r,a=.5){t.origin=a,t.originPoint=Ft(s.min,s.max,t.origin),t.scale=Vs(r)/Vs(s),t.translate=Ft(r.min,r.max,t.origin)-t.originPoint,(t.scale>=FA&&t.scale<=$A||isNaN(t.scale))&&(t.scale=1),(t.translate>=VA&&t.translate<=OA||isNaN(t.translate))&&(t.translate=0)}function qn(t,s,r,a){pm(t.x,s.x,r.x,a?a.originX:void 0),pm(t.y,s.y,r.y,a?a.originY:void 0)}function xm(t,s,r){t.min=r.min+s.min,t.max=t.min+Vs(s)}function zA(t,s,r){xm(t.x,s.x,r.x),xm(t.y,s.y,r.y)}function gm(t,s,r){t.min=s.min-r.min,t.max=t.min+Vs(s)}function Un(t,s,r){gm(t.x,s.x,r.x),gm(t.y,s.y,r.y)}function BA(t,{min:s,max:r},a){return s!==void 0&&t<s?t=a?Ft(s,t,a.min):Math.max(t,s):r!==void 0&&t>r&&(t=a?Ft(r,t,a.max):Math.min(t,r)),t}function ym(t,s,r){return{min:s!==void 0?t.min+s:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function qA(t,{top:s,left:r,bottom:a,right:n}){return{x:ym(t.x,r,n),y:ym(t.y,s,a)}}function vm(t,s){let r=s.min-t.min,a=s.max-t.max;return s.max-s.min<t.max-t.min&&([r,a]=[a,r]),{min:r,max:a}}function UA(t,s){return{x:vm(t.x,s.x),y:vm(t.y,s.y)}}function WA(t,s){let r=.5;const a=Vs(t),n=Vs(s);return n>a?r=nn(s.min,s.max-a,t.min):a>n&&(r=nn(t.min,t.max-n,s.min)),Gr(0,1,r)}function KA(t,s){const r={};return s.min!==void 0&&(r.min=s.min-t.min),s.max!==void 0&&(r.max=s.max-t.min),r}const pc=.35;function GA(t=pc){return t===!1?t=0:t===!0&&(t=pc),{x:bm(t,"left","right"),y:bm(t,"top","bottom")}}function bm(t,s,r){return{min:jm(t,s),max:jm(t,r)}}function jm(t,s){return typeof t=="number"?t:t[s]||0}const Nm=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ka=()=>({x:Nm(),y:Nm()}),wm=()=>({min:0,max:0}),zt=()=>({x:wm(),y:wm()});function Us(t){return[t("x"),t("y")]}function Qy({top:t,left:s,right:r,bottom:a}){return{x:{min:s,max:r},y:{min:t,max:a}}}function HA({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function QA(t,s){if(!s)return t;const r=s({x:t.left,y:t.top}),a=s({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:a.y,right:a.x}}function Vl(t){return t===void 0||t===1}function xc({scale:t,scaleX:s,scaleY:r}){return!Vl(t)||!Vl(s)||!Vl(r)}function pa(t){return xc(t)||Xy(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Xy(t){return km(t.x)||km(t.y)}function km(t){return t&&t!=="0%"}function vo(t,s,r){const a=t-r,n=s*a;return r+n}function Tm(t,s,r,a,n){return n!==void 0&&(t=vo(t,n,a)),vo(t,r,a)+s}function gc(t,s=0,r=1,a,n){t.min=Tm(t.min,s,r,a,n),t.max=Tm(t.max,s,r,a,n)}function Zy(t,{x:s,y:r}){gc(t.x,s.translate,s.scale,s.originPoint),gc(t.y,r.translate,r.scale,r.originPoint)}const Sm=.999999999999,Am=1.0000000000001;function XA(t,s,r,a=!1){const n=r.length;if(!n)return;s.x=s.y=1;let i,o;for(let l=0;l<n;l++){i=r[l],o=i.projectionDelta;const{visualElement:u}=i.options;u&&u.props.style&&u.props.style.display==="contents"||(a&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Ha(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(s.x*=o.x.scale,s.y*=o.y.scale,Zy(t,o)),a&&pa(i.latestValues)&&Ha(t,i.latestValues))}s.x<Am&&s.x>Sm&&(s.x=1),s.y<Am&&s.y>Sm&&(s.y=1)}function Ga(t,s){t.min=t.min+s,t.max=t.max+s}function _m(t,s,r,a,n=.5){const i=Ft(t.min,t.max,n);gc(t,s,r,i,a)}function Ha(t,s){_m(t.x,s.x,s.scaleX,s.scale,s.originX),_m(t.y,s.y,s.scaleY,s.scale,s.originY)}function Yy(t,s){return Qy(QA(t.getBoundingClientRect(),s))}function ZA(t,s,r){const a=Yy(t,r),{scroll:n}=s;return n&&(Ga(a.x,n.offset.x),Ga(a.y,n.offset.y)),a}const Jy=({current:t})=>t?t.ownerDocument.defaultView:null,YA=new WeakMap;class JA{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=zt(),this.visualElement=s}start(s,{snapToCursor:r=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const n=c=>{const{dragSnapToOrigin:m}=this.getProps();m?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Di(c).point)},i=(c,m)=>{const{drag:h,dragPropagation:x,onDragStart:p}=this.getProps();if(h&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=WT(h),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Us(g=>{let b=this.getAxisMotionValue(g).get()||0;if(jr.test(b)){const{projection:j}=this.visualElement;if(j&&j.layout){const y=j.layout.layoutBox[g];y&&(b=Vs(y)*(parseFloat(b)/100))}}this.originPoint[g]=b}),p&&Ct.postRender(()=>p(c,m)),oc(this.visualElement,"transform");const{animationState:k}=this.visualElement;k&&k.setActive("whileDrag",!0)},o=(c,m)=>{const{dragPropagation:h,dragDirectionLock:x,onDirectionLock:p,onDrag:k}=this.getProps();if(!h&&!this.openDragLock)return;const{offset:g}=m;if(x&&this.currentDirection===null){this.currentDirection=e_(g),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",m.point,g),this.updateAxis("y",m.point,g),this.visualElement.render(),k&&k(c,m)},l=(c,m)=>this.stop(c,m),u=()=>Us(c=>{var m;return this.getAnimationState(c)==="paused"&&((m=this.getAxisMotionValue(c).animation)===null||m===void 0?void 0:m.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new Wy(s,{onSessionStart:n,onStart:i,onMove:o,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:Jy(this.visualElement)})}stop(s,r){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:n}=r;this.startAnimation(n);const{onDragEnd:i}=this.getProps();i&&Ct.postRender(()=>i(s,r))}cancel(){this.isDragging=!1;const{projection:s,animationState:r}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(s,r,a){const{drag:n}=this.getProps();if(!a||!Zi(s,n,this.currentDirection))return;const i=this.getAxisMotionValue(s);let o=this.originPoint[s]+a[s];this.constraints&&this.constraints[s]&&(o=BA(o,this.constraints[s],this.elastic[s])),i.set(o)}resolveConstraints(){var s;const{dragConstraints:r,dragElastic:a}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(s=this.visualElement.projection)===null||s===void 0?void 0:s.layout,i=this.constraints;r&&Ua(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&n?this.constraints=qA(n.layoutBox,r):this.constraints=!1,this.elastic=GA(a),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Us(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=KA(n.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:r}=this.getProps();if(!s||!Ua(s))return!1;const a=s.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const i=ZA(a,n.root,this.visualElement.getTransformPagePoint());let o=UA(n.layout.layoutBox,i);if(r){const l=r(HA(o));this.hasMutatedConstraints=!!l,l&&(o=Qy(l))}return o}startAnimation(s){const{drag:r,dragMomentum:a,dragElastic:n,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),u=this.constraints||{},d=Us(c=>{if(!Zi(c,r,this.currentDirection))return;let m=u&&u[c]||{};o&&(m={min:0,max:0});const h=n?200:1e6,x=n?40:1e7,p={type:"inertia",velocity:a?s[c]:0,bounceStiffness:h,bounceDamping:x,timeConstant:750,restDelta:1,restSpeed:10,...i,...m};return this.startAxisValueAnimation(c,p)});return Promise.all(d).then(l)}startAxisValueAnimation(s,r){const a=this.getAxisMotionValue(s);return oc(this.visualElement,s),a.start(Ad(s,a,0,r,this.visualElement,!1))}stopAnimation(){Us(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){Us(s=>{var r;return(r=this.getAxisMotionValue(s).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(s){var r;return(r=this.getAxisMotionValue(s).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(s){const r=`_drag${s.toUpperCase()}`,a=this.visualElement.getProps(),n=a[r];return n||this.visualElement.getValue(s,(a.initial?a.initial[s]:void 0)||0)}snapToCursor(s){Us(r=>{const{drag:a}=this.getProps();if(!Zi(r,a,this.currentDirection))return;const{projection:n}=this.visualElement,i=this.getAxisMotionValue(r);if(n&&n.layout){const{min:o,max:l}=n.layout.layoutBox[r];i.set(s[r]-Ft(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:r}=this.getProps(),{projection:a}=this.visualElement;if(!Ua(r)||!a||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};Us(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const u=l.get();n[o]=WA({min:u,max:u},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Us(o=>{if(!Zi(o,s,null))return;const l=this.getAxisMotionValue(o),{min:u,max:d}=this.constraints[o];l.set(Ft(u,d,n[o]))})}addListeners(){if(!this.visualElement.current)return;YA.set(this.visualElement,this);const s=this.visualElement.current,r=Bn(s,"pointerdown",u=>{const{drag:d,dragListener:c=!0}=this.getProps();d&&c&&this.start(u)}),a=()=>{const{dragConstraints:u}=this.getProps();Ua(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",a);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Ct.read(a);const o=ri(window,"resize",()=>this.scalePositionWithinConstraints()),l=n.addEventListener("didUpdate",(({delta:u,hasLayoutChanged:d})=>{this.isDragging&&d&&(Us(c=>{const m=this.getAxisMotionValue(c);m&&(this.originPoint[c]+=u[c].translate,m.set(m.get()+u[c].translate))}),this.visualElement.render())}));return()=>{o(),r(),i(),l&&l()}}getProps(){const s=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:a=!1,dragPropagation:n=!1,dragConstraints:i=!1,dragElastic:o=pc,dragMomentum:l=!0}=s;return{...s,drag:r,dragDirectionLock:a,dragPropagation:n,dragConstraints:i,dragElastic:o,dragMomentum:l}}}function Zi(t,s,r){return(s===!0||s===t)&&(r===null||r===t)}function e_(t,s=10){let r=null;return Math.abs(t.y)>s?r="y":Math.abs(t.x)>s&&(r="x"),r}class t_ extends ma{constructor(s){super(s),this.removeGroupControls=Rs,this.removeListeners=Rs,this.controls=new JA(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Rs}unmount(){this.removeGroupControls(),this.removeListeners()}}const Cm=t=>(s,r)=>{t&&Ct.postRender(()=>t(s,r))};class s_ extends ma{constructor(){super(...arguments),this.removePointerDownListener=Rs}onPointerDown(s){this.session=new Wy(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Jy(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:r,onPan:a,onPanEnd:n}=this.node.getProps();return{onSessionStart:Cm(s),onStart:Cm(r),onMove:a,onEnd:(i,o)=>{delete this.session,n&&Ct.postRender(()=>n(i,o))}}}mount(){this.removePointerDownListener=Bn(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const oo={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Pm(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const Sn={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(Ie.test(t))t=parseFloat(t);else return t;const r=Pm(t,s.target.x),a=Pm(t,s.target.y);return`${r}% ${a}%`}},r_={correct:(t,{treeScale:s,projectionDelta:r})=>{const a=t,n=na.parse(t);if(n.length>5)return a;const i=na.createTransformer(t),o=typeof n[0]!="number"?1:0,l=r.x.scale*s.x,u=r.y.scale*s.y;n[0+o]/=l,n[1+o]/=u;const d=Ft(l,u,.5);return typeof n[2+o]=="number"&&(n[2+o]/=d),typeof n[3+o]=="number"&&(n[3+o]/=d),i(n)}};class a_ extends f.Component{componentDidMount(){const{visualElement:s,layoutGroup:r,switchLayoutGroup:a,layoutId:n}=this.props,{projection:i}=s;kT(n_),i&&(r.group&&r.group.add(i),a&&a.register&&n&&a.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),oo.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:r,visualElement:a,drag:n,isPresent:i}=this.props,o=a.projection;return o&&(o.isPresent=i,n||s.layoutDependency!==r||r===void 0?o.willUpdate():this.safeToRemove(),s.isPresent!==i&&(i?o.promote():o.relegate()||Ct.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),sd.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:r,switchLayoutGroup:a}=this.props,{projection:n}=s;n&&(n.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(n),a&&a.deregister&&a.deregister(n))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function ev(t){const[s,r]=F0(),a=f.useContext(Gc);return e.jsx(a_,{...t,layoutGroup:a,switchLayoutGroup:f.useContext(U0),isPresent:s,safeToRemove:r})}const n_={borderRadius:{...Sn,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Sn,borderTopRightRadius:Sn,borderBottomLeftRadius:Sn,borderBottomRightRadius:Sn,boxShadow:r_};function i_(t,s,r){const a=ms(t)?t:ti(t);return a.start(Ad("",a,s,r)),a.animation}function o_(t){return t instanceof SVGElement&&t.tagName!=="svg"}const l_=(t,s)=>t.depth-s.depth;class c_{constructor(){this.children=[],this.isDirty=!1}add(s){xd(this.children,s),this.isDirty=!0}remove(s){gd(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(l_),this.isDirty=!1,this.children.forEach(s)}}function d_(t,s){const r=Nr.now(),a=({timestamp:n})=>{const i=n-r;i>=s&&(aa(a),t(i-s))};return Ct.read(a,!0),()=>aa(a)}const tv=["TopLeft","TopRight","BottomLeft","BottomRight"],u_=tv.length,Em=t=>typeof t=="string"?parseFloat(t):t,Dm=t=>typeof t=="number"||Ie.test(t);function m_(t,s,r,a,n,i){n?(t.opacity=Ft(0,r.opacity!==void 0?r.opacity:1,h_(a)),t.opacityExit=Ft(s.opacity!==void 0?s.opacity:1,0,f_(a))):i&&(t.opacity=Ft(s.opacity!==void 0?s.opacity:1,r.opacity!==void 0?r.opacity:1,a));for(let o=0;o<u_;o++){const l=`border${tv[o]}Radius`;let u=Mm(s,l),d=Mm(r,l);if(u===void 0&&d===void 0)continue;u||(u=0),d||(d=0),u===0||d===0||Dm(u)===Dm(d)?(t[l]=Math.max(Ft(Em(u),Em(d),a),0),(jr.test(d)||jr.test(u))&&(t[l]+="%")):t[l]=d}(s.rotate||r.rotate)&&(t.rotate=Ft(s.rotate||0,r.rotate||0,a))}function Mm(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const h_=sv(0,.5,by),f_=sv(.5,.95,Rs);function sv(t,s,r){return a=>a<t?0:a>s?1:r(nn(t,s,a))}function Im(t,s){t.min=s.min,t.max=s.max}function Bs(t,s){Im(t.x,s.x),Im(t.y,s.y)}function Rm(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}function Fm(t,s,r,a,n){return t-=s,t=vo(t,1/r,a),n!==void 0&&(t=vo(t,1/n,a)),t}function p_(t,s=0,r=1,a=.5,n,i=t,o=t){if(jr.test(s)&&(s=parseFloat(s),s=Ft(o.min,o.max,s/100)-o.min),typeof s!="number")return;let l=Ft(i.min,i.max,a);t===i&&(l-=s),t.min=Fm(t.min,s,r,l,n),t.max=Fm(t.max,s,r,l,n)}function $m(t,s,[r,a,n],i,o){p_(t,s[r],s[a],s[n],s.scale,i,o)}const x_=["x","scaleX","originX"],g_=["y","scaleY","originY"];function Vm(t,s,r,a){$m(t.x,s,x_,r?r.x:void 0,a?a.x:void 0),$m(t.y,s,g_,r?r.y:void 0,a?a.y:void 0)}function Om(t){return t.translate===0&&t.scale===1}function rv(t){return Om(t.x)&&Om(t.y)}function Lm(t,s){return t.min===s.min&&t.max===s.max}function y_(t,s){return Lm(t.x,s.x)&&Lm(t.y,s.y)}function zm(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function av(t,s){return zm(t.x,s.x)&&zm(t.y,s.y)}function Bm(t){return Vs(t.x)/Vs(t.y)}function qm(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}class v_{constructor(){this.members=[]}add(s){xd(this.members,s),s.scheduleRender()}remove(s){if(gd(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(s){const r=this.members.findIndex(n=>s===n);if(r===0)return!1;let a;for(let n=r;n>=0;n--){const i=this.members[n];if(i.isPresent!==!1){a=i;break}}return a?(this.promote(a),!0):!1}promote(s,r){const a=this.lead;if(s!==a&&(this.prevLead=a,this.lead=s,s.show(),a)){a.instance&&a.scheduleRender(),s.scheduleRender(),s.resumeFrom=a,r&&(s.resumeFrom.preserveOpacity=!0),a.snapshot&&(s.snapshot=a.snapshot,s.snapshot.latestValues=a.animationValues||a.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:n}=s.options;n===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:r,resumingFrom:a}=s;r.onExitComplete&&r.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function b_(t,s,r){let a="";const n=t.x.translate/s.x,i=t.y.translate/s.y,o=r?.z||0;if((n||i||o)&&(a=`translate3d(${n}px, ${i}px, ${o}px) `),(s.x!==1||s.y!==1)&&(a+=`scale(${1/s.x}, ${1/s.y}) `),r){const{transformPerspective:d,rotate:c,rotateX:m,rotateY:h,skewX:x,skewY:p}=r;d&&(a=`perspective(${d}px) ${a}`),c&&(a+=`rotate(${c}deg) `),m&&(a+=`rotateX(${m}deg) `),h&&(a+=`rotateY(${h}deg) `),x&&(a+=`skewX(${x}deg) `),p&&(a+=`skewY(${p}deg) `)}const l=t.x.scale*s.x,u=t.y.scale*s.y;return(l!==1||u!==1)&&(a+=`scale(${l}, ${u})`),a||"none"}const xa={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},In=typeof window<"u"&&window.MotionDebug!==void 0,Ol=["","X","Y","Z"],j_={visibility:"hidden"},Um=1e3;let N_=0;function Ll(t,s,r,a){const{latestValues:n}=s;n[t]&&(r[t]=n[t],s.setStaticValue(t,0),a&&(a[t]=0))}function nv(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const r=hy(s);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:n,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",Ct,!(n||i))}const{parent:a}=t;a&&!a.hasCheckedOptimisedAppear&&nv(a)}function iv({attachResizeListener:t,defaultParent:s,measureScroll:r,checkIsScrollRoot:a,resetTransform:n}){return class{constructor(o={},l=s?.()){this.id=N_++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,In&&(xa.totalNodes=xa.resolvedTargetDeltas=xa.recalculatedProjection=0),this.nodes.forEach(T_),this.nodes.forEach(P_),this.nodes.forEach(E_),this.nodes.forEach(S_),In&&window.MotionDebug.record(xa)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new c_)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new yd),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const u=this.eventHandlers.get(o);u&&u.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=o_(o),this.instance=o;const{layoutId:u,layout:d,visualElement:c}=this.options;if(c&&!c.current&&c.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||u)&&(this.isLayoutDirty=!0),t){let m;const h=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,m&&m(),m=d_(h,250),oo.hasAnimatedSinceResize&&(oo.hasAnimatedSinceResize=!1,this.nodes.forEach(Km))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&c&&(u||d)&&this.addEventListener("didUpdate",({delta:m,hasLayoutChanged:h,hasRelativeTargetChanged:x,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const k=this.options.transition||c.getDefaultTransition()||F_,{onLayoutAnimationStart:g,onLayoutAnimationComplete:b}=c.getProps(),j=!this.targetLayout||!av(this.targetLayout,p)||x,y=!h&&x;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||y||h&&(j||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(m,y);const M={...md(k,"layout"),onPlay:g,onComplete:b};(c.shouldReduceMotion||this.options.layoutRoot)&&(M.delay=0,M.type=!1),this.startAnimation(M)}else h||Km(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,aa(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(D_),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&nv(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const m=this.path[c];m.shouldResetTransform=!0,m.updateScroll("snapshot"),m.options.layoutRoot&&m.willUpdate(!1)}const{layoutId:l,layout:u}=this.options;if(l===void 0&&!u)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Wm);return}this.isUpdating||this.nodes.forEach(__),this.isUpdating=!1,this.nodes.forEach(C_),this.nodes.forEach(w_),this.nodes.forEach(k_),this.clearAllSnapshots();const l=Nr.now();is.delta=Gr(0,1e3/60,l-is.timestamp),is.timestamp=l,is.isProcessing=!0,Pl.update.process(is),Pl.preRender.process(is),Pl.render.process(is),is.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,sd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(A_),this.sharedNodes.forEach(M_)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ct.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ct.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=zt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l){const u=a(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:u,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!n)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!rv(this.projectionDelta),u=this.getTransformTemplate(),d=u?u(this.latestValues,""):void 0,c=d!==this.prevTransformTemplateValue;o&&(l||pa(this.latestValues)||c)&&(n(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let u=this.removeElementScroll(l);return o&&(u=this.removeTransform(u)),$_(u),{animationId:this.root.animationId,measuredBox:l,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:l}=this.options;if(!l)return zt();const u=l.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(V_))){const{scroll:c}=this.root;c&&(Ga(u.x,c.offset.x),Ga(u.y,c.offset.y))}return u}removeElementScroll(o){var l;const u=zt();if(Bs(u,o),!((l=this.scroll)===null||l===void 0)&&l.wasRoot)return u;for(let d=0;d<this.path.length;d++){const c=this.path[d],{scroll:m,options:h}=c;c!==this.root&&m&&h.layoutScroll&&(m.wasRoot&&Bs(u,o),Ga(u.x,m.offset.x),Ga(u.y,m.offset.y))}return u}applyTransform(o,l=!1){const u=zt();Bs(u,o);for(let d=0;d<this.path.length;d++){const c=this.path[d];!l&&c.options.layoutScroll&&c.scroll&&c!==c.root&&Ha(u,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),pa(c.latestValues)&&Ha(u,c.latestValues)}return pa(this.latestValues)&&Ha(u,this.latestValues),u}removeTransform(o){const l=zt();Bs(l,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];if(!d.instance||!pa(d.latestValues))continue;xc(d.latestValues)&&d.updateSnapshot();const c=zt(),m=d.measurePageBox();Bs(c,m),Vm(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,c)}return pa(this.latestValues)&&Vm(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==is.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var l;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==u;if(!(o||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:m,layoutId:h}=this.options;if(!(!this.layout||!(m||h))){if(this.resolvedRelativeTargetAt=is.timestamp,!this.targetDelta&&!this.relativeTarget){const x=this.getClosestProjectingParent();x&&x.layout&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zt(),this.relativeTargetOrigin=zt(),Un(this.relativeTargetOrigin,this.layout.layoutBox,x.layout.layoutBox),Bs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=zt(),this.targetWithTransforms=zt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),zA(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Bs(this.target,this.layout.layoutBox),Zy(this.target,this.targetDelta)):Bs(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const x=this.getClosestProjectingParent();x&&!!x.resumingFrom==!!this.resumingFrom&&!x.options.layoutScroll&&x.target&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zt(),this.relativeTargetOrigin=zt(),Un(this.relativeTargetOrigin,this.target,x.target),Bs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}In&&xa.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||xc(this.parent.latestValues)||Xy(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const l=this.getLead(),u=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(d=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===is.timestamp&&(d=!1),d)return;const{layout:c,layoutId:m}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||m))return;Bs(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,x=this.treeScale.y;XA(this.layoutCorrected,this.treeScale,this.path,u),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=zt());const{target:p}=l;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Rm(this.prevProjectionDelta.x,this.projectionDelta.x),Rm(this.prevProjectionDelta.y,this.projectionDelta.y)),qn(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==x||!qm(this.projectionDelta.x,this.prevProjectionDelta.x)||!qm(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p)),In&&xa.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var l;if((l=this.options.visualElement)===null||l===void 0||l.scheduleRender(),o){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ka(),this.projectionDelta=Ka(),this.projectionDeltaWithTransform=Ka()}setAnimationOrigin(o,l=!1){const u=this.snapshot,d=u?u.latestValues:{},c={...this.latestValues},m=Ka();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=zt(),x=u?u.source:void 0,p=this.layout?this.layout.source:void 0,k=x!==p,g=this.getStack(),b=!g||g.members.length<=1,j=!!(k&&!b&&this.options.crossfade===!0&&!this.path.some(R_));this.animationProgress=0;let y;this.mixTargetDelta=M=>{const N=M/1e3;Gm(m.x,o.x,N),Gm(m.y,o.y,N),this.setTargetDelta(m),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Un(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),I_(this.relativeTarget,this.relativeTargetOrigin,h,N),y&&y_(this.relativeTarget,y)&&(this.isProjectionDirty=!1),y||(y=zt()),Bs(y,this.relativeTarget)),k&&(this.animationValues=c,m_(c,d,this.latestValues,N,j,b)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=N},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(aa(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ct.update(()=>{oo.hasAnimatedSinceResize=!0,this.currentAnimation=i_(0,Um,{...o,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Um),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:u,layout:d,latestValues:c}=o;if(!(!l||!u||!d)){if(this!==o&&this.layout&&d&&ov(this.options.animationType,this.layout.layoutBox,d.layoutBox)){u=this.target||zt();const m=Vs(this.layout.layoutBox.x);u.x.min=o.target.x.min,u.x.max=u.x.min+m;const h=Vs(this.layout.layoutBox.y);u.y.min=o.target.y.min,u.y.max=u.y.min+h}Bs(l,u),Ha(l,c),qn(this.projectionDeltaWithTransform,this.layoutCorrected,l,c)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new v_),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:l}=this.options;return l?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:l}=this.options;return l?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:u}={}){const d=this.getStack();d&&d.promote(this,u),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:u}=o;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(l=!0),!l)return;const d={};u.z&&Ll("z",o,d,this.animationValues);for(let c=0;c<Ol.length;c++)Ll(`rotate${Ol[c]}`,o,d,this.animationValues),Ll(`skew${Ol[c]}`,o,d,this.animationValues);o.render();for(const c in d)o.setStaticValue(c,d[c]),this.animationValues&&(this.animationValues[c]=d[c]);o.scheduleRender()}getProjectionStyles(o){var l,u;if(!this.instance||this.isSVG)return;if(!this.isVisible)return j_;const d={visibility:""},c=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=no(o?.pointerEvents)||"",d.transform=c?c(this.latestValues,""):"none",d;const m=this.getLead();if(!this.projectionDelta||!this.layout||!m.target){const k={};return this.options.layoutId&&(k.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,k.pointerEvents=no(o?.pointerEvents)||""),this.hasProjected&&!pa(this.latestValues)&&(k.transform=c?c({},""):"none",this.hasProjected=!1),k}const h=m.animationValues||m.latestValues;this.applyTransformsToTarget(),d.transform=b_(this.projectionDeltaWithTransform,this.treeScale,h),c&&(d.transform=c(h,d.transform));const{x,y:p}=this.projectionDelta;d.transformOrigin=`${x.origin*100}% ${p.origin*100}% 0`,m.animationValues?d.opacity=m===this?(u=(l=h.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&u!==void 0?u:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:d.opacity=m===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const k in fo){if(h[k]===void 0)continue;const{correct:g,applyTo:b}=fo[k],j=d.transform==="none"?h[k]:g(h[k],m);if(b){const y=b.length;for(let M=0;M<y;M++)d[b[M]]=j}else d[k]=j}return this.options.layoutId&&(d.pointerEvents=m===this?no(o?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var l;return(l=o.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(Wm),this.root.sharedNodes.clear()}}}function w_(t){t.updateLayout()}function k_(t){var s;const r=((s=t.resumeFrom)===null||s===void 0?void 0:s.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&r&&t.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:n}=t.layout,{animationType:i}=t.options,o=r.source!==t.layout.source;i==="size"?Us(m=>{const h=o?r.measuredBox[m]:r.layoutBox[m],x=Vs(h);h.min=a[m].min,h.max=h.min+x}):ov(i,r.layoutBox,a)&&Us(m=>{const h=o?r.measuredBox[m]:r.layoutBox[m],x=Vs(a[m]);h.max=h.min+x,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[m].max=t.relativeTarget[m].min+x)});const l=Ka();qn(l,a,r.layoutBox);const u=Ka();o?qn(u,t.applyTransform(n,!0),r.measuredBox):qn(u,a,r.layoutBox);const d=!rv(l);let c=!1;if(!t.resumeFrom){const m=t.getClosestProjectingParent();if(m&&!m.resumeFrom){const{snapshot:h,layout:x}=m;if(h&&x){const p=zt();Un(p,r.layoutBox,h.layoutBox);const k=zt();Un(k,a,x.layoutBox),av(p,k)||(c=!0),m.options.layoutRoot&&(t.relativeTarget=k,t.relativeTargetOrigin=p,t.relativeParent=m)}}}t.notifyListeners("didUpdate",{layout:a,snapshot:r,delta:u,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:c})}else if(t.isLead()){const{onExitComplete:a}=t.options;a&&a()}t.options.transition=void 0}function T_(t){In&&xa.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function S_(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function A_(t){t.clearSnapshot()}function Wm(t){t.clearMeasurements()}function __(t){t.isLayoutDirty=!1}function C_(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function Km(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function P_(t){t.resolveTargetDelta()}function E_(t){t.calcProjection()}function D_(t){t.resetSkewAndRotation()}function M_(t){t.removeLeadSnapshot()}function Gm(t,s,r){t.translate=Ft(s.translate,0,r),t.scale=Ft(s.scale,1,r),t.origin=s.origin,t.originPoint=s.originPoint}function Hm(t,s,r,a){t.min=Ft(s.min,r.min,a),t.max=Ft(s.max,r.max,a)}function I_(t,s,r,a){Hm(t.x,s.x,r.x,a),Hm(t.y,s.y,r.y,a)}function R_(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const F_={duration:.45,ease:[.4,0,.1,1]},Qm=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Xm=Qm("applewebkit/")&&!Qm("chrome/")?Math.round:Rs;function Zm(t){t.min=Xm(t.min),t.max=Xm(t.max)}function $_(t){Zm(t.x),Zm(t.y)}function ov(t,s,r){return t==="position"||t==="preserve-aspect"&&!LA(Bm(s),Bm(r),.2)}function V_(t){var s;return t!==t.root&&((s=t.scroll)===null||s===void 0?void 0:s.wasRoot)}const O_=iv({attachResizeListener:(t,s)=>ri(t,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),zl={current:void 0},lv=iv({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!zl.current){const t=new O_({});t.mount(window),t.setOptions({layoutScroll:!0}),zl.current=t}return zl.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),L_={pan:{Feature:s_},drag:{Feature:t_,ProjectionNode:lv,MeasureLayout:ev}};function Ym(t,s,r){const{props:a}=t;t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",r==="Start");const n="onHover"+r,i=a[n];i&&Ct.postRender(()=>i(s,Di(s)))}class z_ extends ma{mount(){const{current:s}=this.node;s&&(this.unmount=LT(s,r=>(Ym(this.node,r,"Start"),a=>Ym(this.node,a,"End"))))}unmount(){}}class B_ extends ma{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ei(ri(this.node.current,"focus",()=>this.onFocus()),ri(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Jm(t,s,r){const{props:a}=t;t.animationState&&a.whileTap&&t.animationState.setActive("whileTap",r==="Start");const n="onTap"+(r==="End"?"":r),i=a[n];i&&Ct.postRender(()=>i(s,Di(s)))}class q_ extends ma{mount(){const{current:s}=this.node;s&&(this.unmount=UT(s,r=>(Jm(this.node,r,"Start"),(a,{success:n})=>Jm(this.node,a,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const yc=new WeakMap,Bl=new WeakMap,U_=t=>{const s=yc.get(t.target);s&&s(t)},W_=t=>{t.forEach(U_)};function K_({root:t,...s}){const r=t||document;Bl.has(r)||Bl.set(r,{});const a=Bl.get(r),n=JSON.stringify(s);return a[n]||(a[n]=new IntersectionObserver(W_,{root:t,...s})),a[n]}function G_(t,s,r){const a=K_(s);return yc.set(t,r),a.observe(t),()=>{yc.delete(t),a.unobserve(t)}}const H_={some:0,all:1};class Q_ extends ma{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:r,margin:a,amount:n="some",once:i}=s,o={root:r?r.current:void 0,rootMargin:a,threshold:typeof n=="number"?n:H_[n]},l=u=>{const{isIntersecting:d}=u;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:c,onViewportLeave:m}=this.node.getProps(),h=d?c:m;h&&h(u)};return G_(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:r}=this.node;["amount","margin","root"].some(X_(s,r))&&this.startObserver()}unmount(){}}function X_({viewport:t={}},{viewport:s={}}={}){return r=>t[r]!==s[r]}const Z_={inView:{Feature:Q_},tap:{Feature:q_},focus:{Feature:B_},hover:{Feature:z_}},Y_={layout:{ProjectionNode:lv,MeasureLayout:ev}},vc={current:null},cv={current:!1};function J_(){if(cv.current=!0,!!Xc)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>vc.current=t.matches;t.addListener(s),s()}else vc.current=!1}const eC=[...Iy,us,na],tC=t=>eC.find(My(t)),eh=new WeakMap;function sC(t,s,r){for(const a in s){const n=s[a],i=r[a];if(ms(n))t.addValue(a,n);else if(ms(i))t.addValue(a,ti(n,{owner:t}));else if(i!==n)if(t.hasValue(a)){const o=t.getValue(a);o.liveStyle===!0?o.jump(n):o.hasAnimated||o.set(n)}else{const o=t.getStaticValue(a);t.addValue(a,ti(o!==void 0?o:n,{owner:t}))}}for(const a in r)s[a]===void 0&&t.removeValue(a);return s}const th=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class rC{scrapeMotionValuesFromProps(s,r,a){return{}}constructor({parent:s,props:r,presenceContext:a,reducedMotionConfig:n,blockInitialAnimation:i,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=kd,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const x=Nr.now();this.renderScheduledAt<x&&(this.renderScheduledAt=x,Ct.render(this.render,!1,!0))};const{latestValues:u,renderState:d,onUpdate:c}=o;this.onUpdate=c,this.latestValues=u,this.baseTarget={...u},this.initialValues=r.initial?{...u}:{},this.renderState=d,this.parent=s,this.props=r,this.presenceContext=a,this.depth=s?s.depth+1:0,this.reducedMotionConfig=n,this.options=l,this.blockInitialAnimation=!!i,this.isControllingVariants=Jo(r),this.isVariantNode=B0(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:m,...h}=this.scrapeMotionValuesFromProps(r,{},this);for(const x in h){const p=h[x];u[x]!==void 0&&ms(p)&&p.set(u[x],!1)}}mount(s){this.current=s,eh.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,a)=>this.bindToMotionValue(a,r)),cv.current||J_(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:vc.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){eh.delete(this.current),this.projection&&this.projection.unmount(),aa(this.notifyUpdate),aa(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const r=this.features[s];r&&(r.unmount(),r.isMounted=!1)}this.current=null}bindToMotionValue(s,r){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const a=Ia.has(s),n=r.on("change",l=>{this.latestValues[s]=l,this.props.onUpdate&&Ct.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),i=r.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,s,r)),this.valueSubscriptions.set(s,()=>{n(),i(),o&&o(),r.owner&&r.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in on){const r=on[s];if(!r)continue;const{isEnabled:a,Feature:n}=r;if(!this.features[s]&&n&&a(this.props)&&(this.features[s]=new n(this)),this.features[s]){const i=this.features[s];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):zt()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,r){this.latestValues[s]=r}update(s,r){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let a=0;a<th.length;a++){const n=th[a];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const i="on"+n,o=s[i];o&&(this.propEventSubscriptions[n]=this.on(n,o))}this.prevMotionValues=sC(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(s),()=>r.variantChildren.delete(s)}addValue(s,r){const a=this.values.get(s);r!==a&&(a&&this.removeValue(s),this.bindToMotionValue(s,r),this.values.set(s,r),this.latestValues[s]=r.get())}removeValue(s){this.values.delete(s);const r=this.valueSubscriptions.get(s);r&&(r(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,r){if(this.props.values&&this.props.values[s])return this.props.values[s];let a=this.values.get(s);return a===void 0&&r!==void 0&&(a=ti(r===null?void 0:r,{owner:this}),this.addValue(s,a)),a}readValue(s,r){var a;let n=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:(a=this.getBaseTargetFromProps(this.props,s))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,s,this.options);return n!=null&&(typeof n=="string"&&(Ey(n)||Ny(n))?n=parseFloat(n):!tC(n)&&na.test(r)&&(n=_y(s,r)),this.setBaseTarget(s,ms(n)?n.get():n)),ms(n)?n.get():n}setBaseTarget(s,r){this.baseTarget[s]=r}getBaseTarget(s){var r;const{initial:a}=this.props;let n;if(typeof a=="string"||typeof a=="object"){const o=ad(this.props,a,(r=this.presenceContext)===null||r===void 0?void 0:r.custom);o&&(n=o[s])}if(a&&n!==void 0)return n;const i=this.getBaseTargetFromProps(this.props,s);return i!==void 0&&!ms(i)?i:this.initialValues[s]!==void 0&&n===void 0?void 0:this.baseTarget[s]}on(s,r){return this.events[s]||(this.events[s]=new yd),this.events[s].add(r)}notify(s,...r){this.events[s]&&this.events[s].notify(...r)}}class dv extends rC{constructor(){super(...arguments),this.KeyframeResolver=Ry}sortInstanceNodePosition(s,r){return s.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(s,r){return s.style?s.style[r]:void 0}removeValueFromRenderState(s,{vars:r,style:a}){delete r[s],delete a[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;ms(s)&&(this.childSubscription=s.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function aC(t){return window.getComputedStyle(t)}class nC extends dv{constructor(){super(...arguments),this.type="html",this.renderInstance=Z0}readValueFromInstance(s,r){if(Ia.has(r)){const a=wd(r);return a&&a.default||0}else{const a=aC(s),n=(H0(r)?a.getPropertyValue(r):a[r])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(s,{transformPagePoint:r}){return Yy(s,r)}build(s,r,a){od(s,r,a.transformTemplate)}scrapeMotionValuesFromProps(s,r,a){return ud(s,r,a)}}class iC extends dv{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=zt}getBaseTargetFromProps(s,r){return s[r]}readValueFromInstance(s,r){if(Ia.has(r)){const a=wd(r);return a&&a.default||0}return r=Y0.has(r)?r:td(r),s.getAttribute(r)}scrapeMotionValuesFromProps(s,r,a){return ty(s,r,a)}build(s,r,a){ld(s,r,this.isSVGTag,a.transformTemplate)}renderInstance(s,r,a,n){J0(s,r,a,n)}mount(s){this.isSVGTag=dd(s.tagName),super.mount(s)}}const oC=(t,s)=>rd(t)?new iC(s):new nC(s,{allowProjection:t!==f.Fragment}),lC=MT({...EA,...Z_,...L_,...Y_},oC),Ut=Hk(lC),cC=(t=1e3)=>{const[s,r]=f.useState(!1),a=f.useRef(0),n=f.useCallback(()=>{const i=Date.now();return i-a.current<t?(r(!0),!1):(a.current=i,r(!1),!0)},[t]);return{isLimited:s,checkRateLimit:n}},_d=xn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-300 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 transform-gpu relative overflow-hidden",{variants:{variant:{default:"bg-gradient-to-r from-blue-600 to-blue-700 text-primary-foreground hover:from-blue-700 hover:to-blue-800 hover:shadow-lg hover:shadow-blue-500/25 active:scale-95",destructive:"bg-gradient-to-r from-red-600 to-red-700 text-destructive-foreground hover:from-red-700 hover:to-red-800 hover:shadow-lg hover:shadow-red-500/25 active:scale-95",outline:"border-2 border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-blue-300 hover:shadow-md active:scale-95",secondary:"bg-gradient-to-r from-gray-200 to-gray-300 text-secondary-foreground hover:from-gray-300 hover:to-gray-400 hover:shadow-md active:scale-95",ghost:"hover:bg-accent hover:text-accent-foreground hover:shadow-sm active:scale-95",link:"text-primary underline-offset-4 hover:underline hover:text-blue-600 active:scale-95",success:"bg-gradient-to-r from-green-600 to-green-700 text-white hover:from-green-700 hover:to-green-800 hover:shadow-lg hover:shadow-green-500/25 active:scale-95",warning:"bg-gradient-to-r from-orange-500 to-orange-600 text-white hover:from-orange-600 hover:to-orange-700 hover:shadow-lg hover:shadow-orange-500/25 active:scale-95"},size:{default:"h-11 px-6 py-2.5",sm:"h-9 rounded-md px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base",icon:"h-11 w-11",xs:"h-7 px-2 text-xs rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),K=f.forwardRef(({className:t,variant:s,size:r,asChild:a=!1,loading:n=!1,loadingText:i="جاري التحميل...",enableRateLimit:o=!1,rateLimitDelay:l=1e3,ripple:u=!0,onClick:d,children:c,disabled:m,...h},x)=>{const p=a?zg:"button",{isLimited:k,checkRateLimit:g}=cC(l),[b,j]=f.useState({}),[y,M]=f.useState(!1),N=f.useCallback(S=>{if(!(n||m)){if(o&&!g()){S.preventDefault();return}if(u){const E=S.currentTarget.getBoundingClientRect(),z=S.clientX-E.left,w=S.clientY-E.top;j({left:z-10,top:w-10,width:20,height:20}),M(!0),setTimeout(()=>M(!1),600)}d?.(S)}},[n,m,o,g,u,d]),T=m||n||o&&k;return e.jsx(Ut.div,{whileHover:{scale:T?1:1.02},whileTap:{scale:T?1:.98},transition:{type:"spring",stiffness:400,damping:25},children:e.jsxs(p,{className:de(_d({variant:s,size:r,className:t})),ref:x,onClick:N,disabled:T,...h,children:[y&&u&&e.jsx(Ut.span,{className:"absolute bg-white/30 rounded-full pointer-events-none",style:b,initial:{scale:0,opacity:1},animate:{scale:4,opacity:0},transition:{duration:.6,ease:"easeOut"}}),n?e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"h-4 w-4 animate-spin"}),i]}):c,o&&k&&e.jsx(Ut.div,{className:"absolute inset-0 bg-gray-400/20 rounded-lg flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx("span",{className:"text-xs text-gray-600",children:"انتظر..."})})]})})});K.displayName="Button";const dC=xn("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Fe({className:t,variant:s,...r}){return e.jsx("div",{className:de(dC({variant:s}),t),...r})}const Ss=Oc,Cd=Lc,uC=Vc,uv=f.forwardRef(({className:t,...s},r)=>e.jsx(Ni,{ref:r,className:de("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));uv.displayName=Ni.displayName;const js=f.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(uC,{children:[e.jsx(uv,{}),e.jsxs(wi,{ref:a,className:de("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[s,e.jsxs(qo,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(vr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));js.displayName=wi.displayName;const As=({className:t,...s})=>e.jsx("div",{className:de("flex flex-col space-y-1.5 text-center sm:text-right",t),...s});As.displayName="DialogHeader";const bc=({className:t,...s})=>e.jsx("div",{className:de("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});bc.displayName="DialogFooter";const _s=f.forwardRef(({className:t,...s},r)=>e.jsx(ki,{ref:r,className:de("text-lg font-semibold leading-none tracking-tight",t),...s}));_s.displayName=ki.displayName;const Fs=f.forwardRef(({className:t,...s},r)=>e.jsx(Ti,{ref:r,className:de("text-sm text-muted-foreground",t),...s}));Fs.displayName=Ti.displayName;const mC=(t,s="")=>{const[r,a]=f.useState(()=>typeof window<"u"&&localStorage.getItem(`form-memory-${t}`)||s),n=f.useCallback(o=>{a(o),typeof window<"u"&&(o?localStorage.setItem(`form-memory-${t}`,o):localStorage.removeItem(`form-memory-${t}`))},[t]),i=f.useCallback(()=>{a(""),typeof window<"u"&&localStorage.removeItem(`form-memory-${t}`)},[t]);return{value:r,updateValue:n,clearMemory:i}},hC=(t,s,r,a)=>{const[n,i]=f.useState({isValid:!0});return f.useEffect(()=>{if(!t){i({isValid:!0});return}if(r&&!s){i(l=>({...l,isValidating:!0}));const o=setTimeout(()=>{const l=r(t);i({...l,isValidating:!1})},300);return()=>clearTimeout(o)}if(s&&(s==="email"||s==="password")){i(l=>({...l,isValidating:!0}));const o=setTimeout(async()=>{try{const u=await(await fetch("/api/auth/validate-field",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({field:s,value:t,context:a||"register"})})).json();u.success?i({isValid:u.isValid,message:u.message,strength:u.strength,suggestions:u.suggestions,isValidating:!1}):i({isValid:!1,message:"حدث خطأ في التحقق",isValidating:!1})}catch(l){console.error("خطأ في التحقق:",l),i({isValid:!1,message:"حدث خطأ في التحقق",isValidating:!1})}},500);return()=>clearTimeout(o)}},[t,r,s,a]),n},je=f.forwardRef(({className:t,type:s="text",enableMemory:r=!1,memoryKey:a,validator:n,showValidation:i=!0,leftIcon:o,rightIcon:l,loading:u=!1,strengthIndicator:d=!1,fieldType:c,validationContext:m,onChange:h,value:x,...p},k)=>{const[g,b]=f.useState(!1),[j,y]=f.useState(!1),{value:M,updateValue:N}=mC(a||`input-${p.name||"default"}`,typeof x=="string"?x:""),T=x!==void 0?String(x):M,S=hC(T,c,n,m),I=f.useCallback(V=>{const X=V.target.value;r&&x===void 0&&N(X),h?.(V)},[r,x,N,h]),E=f.useCallback(()=>{b(V=>!V)},[]),z=s==="password"?g?"text":"password":s,w=o||u,v=l||s==="password"||i&&S.message,D=()=>S.isValidating?"border-blue-300 ring-blue-100":S.isValid?S.isValid&&T?"border-green-300 ring-green-100 focus:border-green-500 focus:ring-green-200":"border-input focus:border-blue-500 focus:ring-blue-200":"border-red-300 ring-red-100 focus:border-red-500 focus:ring-red-200";return e.jsxs("div",{className:"relative w-full",children:[e.jsxs(Ut.div,{animate:{scale:j?1.01:1},transition:{type:"spring",stiffness:300,damping:25},style:{position:"relative"},children:[e.jsx("input",{type:z,className:de("flex h-11 w-full rounded-xl border-2 bg-background/50 backdrop-blur-sm px-4 py-2.5 text-sm ring-offset-background transition-all duration-300","file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground","placeholder:text-muted-foreground/70","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-1","disabled:cursor-not-allowed disabled:opacity-50","hover:bg-background/80",w&&"pr-11",v&&"pl-11",D(),t),ref:k,value:T,onChange:I,onFocus:()=>y(!0),onBlur:()=>y(!1),...p}),w&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:u?e.jsx(Ar,{className:"h-4 w-4 animate-spin"}):o}),v&&e.jsxs("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[s==="password"&&e.jsx(Ut.div,{whileTap:{scale:.95},style:{background:"none",border:"none",padding:"4px",borderRadius:"6px",cursor:"pointer",color:"var(--muted-foreground)",transition:"colors 0.2s"},onTap:E,children:g?e.jsx(Xn,{className:"h-4 w-4"}):e.jsx(Wr,{className:"h-4 w-4"})}),i&&T&&!S.isValidating&&e.jsx(Ut.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:S.isValid?e.jsx(Is,{className:"h-4 w-4 text-green-500"}):e.jsx(cs,{className:"h-4 w-4 text-red-500"})}),S.isValidating&&e.jsx(Ar,{className:"h-4 w-4 animate-spin text-blue-500"}),l]})]}),d&&s==="password"&&T&&typeof S.strength=="number"&&e.jsxs(Ut.div,{style:{marginTop:"8px"},initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[e.jsx("div",{className:"flex space-x-1 rtl:space-x-reverse",style:{marginBottom:"4px"},children:[1,2,3,4].map(V=>e.jsx("div",{style:{height:"4px",flex:1,borderRadius:"2px",transition:"all 0.3s",backgroundColor:S.strength>=V?V<=2?"#ef4444":V===3?"#eab308":"#22c55e":"#e5e7eb"}},V))}),e.jsxs("p",{style:{fontSize:"12px",color:"var(--muted-foreground)"},children:["قوة كلمة المرور: ",S.strength<=2?"ضعيفة":S.strength===3?"متوسطة":"قوية"]})]}),e.jsx(Zc,{children:i&&S.message&&e.jsxs(Ut.div,{initial:{opacity:0,y:-10,height:0},animate:{opacity:1,y:0,height:"auto"},exit:{opacity:0,y:-10,height:0},transition:{duration:.2},style:{marginTop:"8px",fontSize:"12px",padding:"8px 12px",borderRadius:"8px",border:"1px solid",display:"flex",alignItems:"center",gap:"8px",color:S.isValid?"#15803d":"#dc2626",backgroundColor:S.isValid?"#f0fdf4":"#fef2f2",borderColor:S.isValid?"#bbf7d0":"#fecaca"},children:[S.isValid?e.jsx(Is,{className:"h-3 w-3 text-green-500"}):e.jsx(cs,{className:"h-3 w-3 text-red-500"}),S.message]})})]})});je.displayName="Input";var fC="Label",mv=f.forwardRef((t,s)=>e.jsx(xt.label,{...t,ref:s,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));mv.displayName=fC;var hv=mv;const pC=xn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),re=f.forwardRef(({className:t,...s},r)=>e.jsx(hv,{ref:r,className:de(pC(),t),...s}));re.displayName=hv.displayName;const We=U1,Ke=W1,ze=f.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(Bg,{ref:a,className:de("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[s,e.jsx(O1,{asChild:!0,children:e.jsx(_i,{className:"h-4 w-4 opacity-50"})})]}));ze.displayName=Bg.displayName;const fv=f.forwardRef(({className:t,...s},r)=>e.jsx(qg,{ref:r,className:de("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Wo,{className:"h-4 w-4"})}));fv.displayName=qg.displayName;const pv=f.forwardRef(({className:t,...s},r)=>e.jsx(Ug,{ref:r,className:de("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(_i,{className:"h-4 w-4"})}));pv.displayName=Ug.displayName;const Be=f.forwardRef(({className:t,children:s,position:r="popper",...a},n)=>e.jsx(L1,{children:e.jsxs(Wg,{ref:n,className:de("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...a,children:[e.jsx(fv,{}),e.jsx(z1,{className:de("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(pv,{})]})}));Be.displayName=Wg.displayName;const xC=f.forwardRef(({className:t,...s},r)=>e.jsx(Kg,{ref:r,className:de("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));xC.displayName=Kg.displayName;const W=f.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(Gg,{ref:a,className:de("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(B1,{children:e.jsx(Uo,{className:"h-4 w-4"})})}),e.jsx(q1,{children:s})]}));W.displayName=Gg.displayName;const gC=f.forwardRef(({className:t,...s},r)=>e.jsx(Hg,{ref:r,className:de("-mx-1 my-1 h-px bg-muted",t),...s}));gC.displayName=Hg.displayName;const yC={blue:{border:"border-l-blue-500",text:"text-blue-600",bg:"bg-blue-50 dark:bg-blue-900/20",iconBg:"bg-blue-100 dark:bg-blue-900/30",iconColor:"text-blue-600 dark:text-blue-400"},green:{border:"border-l-green-500",text:"text-green-600",bg:"bg-green-50 dark:bg-green-900/20",iconBg:"bg-green-100 dark:bg-green-900/30",iconColor:"text-green-600 dark:text-green-400"},orange:{border:"border-l-orange-500",text:"text-orange-600",bg:"bg-orange-50 dark:bg-orange-900/20",iconBg:"bg-orange-100 dark:bg-orange-900/30",iconColor:"text-orange-600 dark:text-orange-400"},red:{border:"border-l-red-500",text:"text-red-600",bg:"bg-red-50 dark:bg-red-900/20",iconBg:"bg-red-100 dark:bg-red-900/30",iconColor:"text-red-600 dark:text-red-400"},purple:{border:"border-l-purple-500",text:"text-purple-600",bg:"bg-purple-50 dark:bg-purple-900/20",iconBg:"bg-purple-100 dark:bg-purple-900/30",iconColor:"text-purple-600 dark:text-purple-400"},teal:{border:"border-l-teal-500",text:"text-teal-600",bg:"bg-teal-50 dark:bg-teal-900/20",iconBg:"bg-teal-100 dark:bg-teal-900/30",iconColor:"text-teal-600 dark:text-teal-400"},indigo:{border:"border-l-indigo-500",text:"text-indigo-600",bg:"bg-indigo-50 dark:bg-indigo-900/20",iconBg:"bg-indigo-100 dark:bg-indigo-900/30",iconColor:"text-indigo-600 dark:text-indigo-400"},emerald:{border:"border-l-emerald-500",text:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-900/20",iconBg:"bg-emerald-100 dark:bg-emerald-900/30",iconColor:"text-emerald-600 dark:text-emerald-400"},amber:{border:"border-l-amber-500",text:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-900/20",iconBg:"bg-amber-100 dark:bg-amber-900/30",iconColor:"text-amber-600 dark:text-amber-400"},gray:{border:"border-l-gray-500",text:"text-gray-600",bg:"bg-gray-50 dark:bg-gray-900/20",iconBg:"bg-gray-100 dark:bg-gray-900/30",iconColor:"text-gray-600 dark:text-gray-400"}};function it({title:t,value:s,icon:r,color:a="blue",formatter:n,className:i="","data-testid":o}){const l=yC[a],d=(()=>{if(typeof s=="number"){if(isNaN(s)||!isFinite(s))return"0";if(Math.abs(s)>1e11)return console.warn("⚠️ [StatsCard] قيمة رقمية غير منطقية:",s),"0";const p=Math.max(0,s);return n?n(p):p.toLocaleString("en-US")}const c=s.toString().trim();if(c.match(/^(\d{1,3})\1{2,}$/))return console.warn("⚠️ [StatsCard] نمط متكرر مشبوه:",c),"0";if(c.match(/^(\d)\1{5,}$/))return console.warn("⚠️ [StatsCard] تكرار رقم واحد:",c),"0";if(c.length>12&&c.match(/^\d+$/))return console.warn("⚠️ [StatsCard] رقم طويل غير منطقي:",c),"0";const m=[/^(\d{2,3})\1{3,}$/,/^0+[1-9]0*\1+$/,/^(123|234|345|456|567|678|789|012|098|987|876|765|654|543|432|321){3,}$/];for(const p of m)if(p.test(c))return console.warn("⚠️ [StatsCard] نمط مشبوه آخر:",c),"0";const h=c.replace(/[^\d.-]/g,"");if(!h||h===""||h==="-")return"0";const x=parseFloat(h);if(!isNaN(x)&&isFinite(x)){if(Math.abs(x)>1e11)return console.warn("⚠️ [StatsCard] قيمة محولة غير منطقية:",x),"0";const p=Math.max(0,x);return Number.isInteger(p)&&p>1e6&&t.includes("عامل")?(console.warn("⚠️ [StatsCard] عدد عمال غير منطقي:",p),"0"):p.toLocaleString("en-US")}return"0"})();return e.jsx(ee,{className:`${l.border} ${l.bg} border-l-4 hover:shadow-md transition-shadow duration-200`,children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:t}),e.jsx("p",{className:`text-lg font-bold ${l.text}`,children:d})]}),e.jsx("div",{className:`h-10 w-10 ${l.iconBg} rounded-full flex items-center justify-center`,children:e.jsx(r,{className:`h-5 w-5 ${l.iconColor}`})})]})})})}function Pd({children:t,className:s=""}){return e.jsx("div",{className:`grid grid-cols-2 lg:grid-cols-4 gap-3 ${s}`,children:t})}const An="construction-app-selected-project",Yi="construction-app-selected-project-name";function Mi(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState(!0),[o,l]=f.useState([]);f.useEffect(()=>{try{const m=localStorage.getItem(An),h=localStorage.getItem(Yi);m&&m!=="undefined"&&m!=="null"&&(s(m),h&&a(h))}catch{localStorage.removeItem(An),localStorage.removeItem(Yi)}finally{i(!1)}},[]);const u=f.useCallback((m,h)=>{s(m),h&&a(h);try{m&&m!=="undefined"&&m!=="null"?(localStorage.setItem(An,m),h&&localStorage.setItem(Yi,h)):(localStorage.removeItem(An),localStorage.removeItem(Yi),a(""))}catch{}},[]),d=f.useCallback(()=>{u("","")},[u]),c=f.useCallback(()=>{try{const m=localStorage.getItem(An);return m&&m!=="undefined"&&m!=="null"}catch{return!1}},[]);return{selectedProjectId:t,selectedProjectName:r,isLoading:n,selectProject:u,clearProject:d,hasStoredProject:c,projects:o}}function Ii({selectedProjectId:t,onProjectChange:s,showHeader:r=!0,variant:a="default",className:n=""}){const{data:i=[],isLoading:o,error:l}=Se({queryKey:["/api/projects"],queryFn:async()=>{try{console.log("🔄 [ProjectSelector] جلب قائمة المشاريع...");const c=await me("/api/projects","GET");console.log("📊 [ProjectSelector] استجابة المشاريع:",c);let m=[];return c&&typeof c=="object"&&(c.success!==void 0&&c.data!==void 0?(m=Array.isArray(c.data)?c.data:[],console.log("✅ [ProjectSelector] استخراج البيانات من data.data")):Array.isArray(c)?(m=c,console.log("✅ [ProjectSelector] استخدام المصفوفة مباشرة")):c.id?(m=[c],console.log("✅ [ProjectSelector] تحويل كائن واحد لمصفوفة")):console.warn("⚠️ [ProjectSelector] هيكل غير متوقع:",c)),Array.isArray(m)||(console.warn("⚠️ [ProjectSelector] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),m=[]),console.log(`✅ [ProjectSelector] تم جلب ${m.length} مشروع بنجاح`),m}catch(c){return console.error("❌ [ProjectSelector] خطأ في جلب المشاريع:",c),[]}},staleTime:3e5,retry:2,refetchOnWindowFocus:!1}),u=Array.isArray(i)?i.find(c=>c.id===t):void 0,d=c=>{const m=Array.isArray(i)?i.find(h=>h.id===c):void 0;s(c,m?.name)};return a==="compact"?e.jsx("div",{className:`space-y-2 ${n}`,children:e.jsxs(We,{value:t,onValueChange:d,disabled:o,children:[e.jsx(ze,{className:"w-full h-12 bg-white/90 backdrop-blur-sm border-white/30 text-gray-800 font-medium",children:e.jsx(Ke,{placeholder:"اختر المشروع..."})}),e.jsx(Be,{children:Array.isArray(i)?i.map(c=>e.jsx(W,{value:c.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ks,{className:"h-4 w-4"}),c.name,e.jsx(Fe,{variant:"secondary",className:"mr-auto",children:c.status==="active"?"نشط":"مكتمل"})]})},c.id)):null})]})}):a==="premium"?e.jsxs(ee,{className:`mb-6 border-0 shadow-2xl bg-gradient-to-br from-white via-blue-50 to-indigo-50 overflow-hidden project-selector-premium project-selector-card transition-all duration-500 ${n}`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-500/10 to-purple-500/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-500/10 to-blue-500/10 rounded-full translate-y-12 -translate-x-12"}),r&&e.jsx(He,{className:"pb-3 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(b2,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:"اختيار المشروع النشط"}),e.jsx("p",{className:"text-sm text-gray-600",children:"اختر المشروع لعرض التقارير والإحصائيات"})]})]}),e.jsxs(Fe,{className:"bg-green-100 text-green-700 border-green-200",children:[e.jsx(Ln,{className:"h-3 w-3 mr-1"}),i.length," مشروع متاح"]})]})}),e.jsx(oe,{className:"p-6 pt-2 relative",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(We,{value:t,onValueChange:d,disabled:o,children:[e.jsx(ze,{className:"w-full h-14 bg-white border-2 border-gray-200 hover:border-blue-400 transition-all duration-300 text-gray-800 font-medium rounded-xl shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx(Ks,{className:"h-5 w-5 text-blue-600"}),e.jsx(Ke,{placeholder:"اختر المشروع..."})]})}),e.jsx(Be,{className:"bg-white border-2 border-gray-200 shadow-2xl rounded-xl",children:Array.isArray(i)?i.map(c=>e.jsx(W,{value:c.id,className:"py-3 px-4 hover:bg-blue-50 transition-colors duration-200 project-option",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:e.jsx(Ks,{className:"h-4 w-4 text-blue-600"})}),e.jsx("span",{className:"font-medium text-gray-800",children:c.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.status==="active"?e.jsxs(Fe,{className:"bg-green-100 text-green-700 border-green-200",children:[e.jsx(Ln,{className:"h-3 w-3 mr-1"}),"نشط"]}):e.jsxs(Fe,{variant:"secondary",children:[e.jsx(Ls,{className:"h-3 w-3 mr-1"}),"مكتمل"]}),t===c.id&&e.jsx(Ru,{className:"h-4 w-4 text-yellow-500 fill-yellow-500"})]})]})},c.id)):null})]}),u&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(Ru,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"المشروع المحدد:"}),e.jsx("p",{className:"font-bold text-blue-900",children:u.name})]}),e.jsx("div",{className:"mr-auto",children:e.jsx(Fe,{className:"bg-blue-500 text-white",children:u.status==="active"?"مشروع نشط":"مشروع مكتمل"})})]})})]})})]}):e.jsx(ee,{className:`mb-4 ${n}`,children:e.jsxs(oe,{className:"p-4",children:[r&&e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Ai,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsxs(We,{value:t,onValueChange:d,disabled:o,children:[e.jsx(ze,{className:"w-full",children:e.jsx(Ke,{placeholder:"اختر المشروع..."})}),e.jsx(Be,{children:Array.isArray(i)?i.map(c=>e.jsx(W,{value:c.id,children:c.name},c.id)):null})]})]})})}function vC({size:t="md",className:s="",variant:r="default"}){const a={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return r==="professional"?e.jsxs(Ut.div,{className:`relative ${a[t]} ${s}`,animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-primary/30"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-primary border-t-transparent"}),e.jsx(Ut.div,{className:"absolute inset-1 rounded-full bg-gradient-to-br from-primary to-secondary opacity-20",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}):r==="minimal"?e.jsx(Ut.div,{className:`${a[t]} border-2 border-muted border-t-primary rounded-full ${s}`,animate:{rotate:360},transition:{duration:.8,repeat:1/0,ease:"linear"}}):e.jsx("div",{className:`animate-spin rounded-full border-2 border-gray-300 border-t-primary ${a[t]} ${s}`})}function bC(){return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx(vC,{size:"lg"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"جاري التحميل..."})]})})}const xv=f.createContext(void 0);function jC({children:t}){const[s,r]=f.useState(null),[a,n]=f.useState("إضافة جديد"),i=f.useCallback((o,l="إضافة جديد")=>{r(u=>u===o?u:o),n(u=>u===l?u:l)},[]);return e.jsx(xv.Provider,{value:{setFloatingAction:i,floatingAction:s,floatingLabel:a},children:t})}function Ps(){const t=f.useContext(xv);if(t===void 0)throw new Error("useFloatingButton must be used within a FloatingButtonProvider");return t}function NC(){const[,t]=or(),{selectedProjectId:s,selectProject:r}=Mi(),[a,n]=f.useState(!1),[i,o]=f.useState(!1),[l,u]=f.useState(!1),[d,c]=f.useState({name:"",phone:"",type:"",dailyWage:""}),[m,h]=f.useState(!1),[x,p]=f.useState(""),[k,g]=f.useState({name:"",status:"active",description:""}),b=Gt(),{setFloatingAction:j}=Ps(),{toast:y}=Dt(),M=async(C,q)=>{if(!(!q||typeof q!="string"||!q.trim()))try{await me("/api/autocomplete","POST",{category:C,value:q.trim()})}catch(ue){console.log(`Failed to save autocomplete value for ${C}:`,ue)}},{data:N=[],isLoading:T,error:S}=Se({queryKey:["/api/projects/with-stats"],queryFn:async()=>{try{console.log("🔄 [Dashboard] جلب المشاريع مع الإحصائيات...");const C=await me("/api/projects/with-stats","GET");console.log("📊 [Dashboard] استجابة المشاريع:",C);let q=[];return C&&typeof C=="object"&&(C.success!==void 0&&C.data!==void 0?(q=Array.isArray(C.data)?C.data:[],console.log("✅ [Dashboard] استخراج البيانات من response.data")):Array.isArray(C)?(q=C,console.log("✅ [Dashboard] استخدام الاستجابة كمصفوفة مباشرة")):C.id?(q=[C],console.log("✅ [Dashboard] تحويل كائن واحد لمصفوفة")):C.data&&(q=Array.isArray(C.data)?C.data:[],console.log("✅ [Dashboard] استخراج البيانات من data فقط"))),Array.isArray(q)||(console.warn("⚠️ [Dashboard] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),q=[]),console.log(`✅ [Dashboard] تم جلب ${q.length} مشروع مع الإحصائيات`),q}catch(C){return console.error("❌ [Dashboard] خطأ في جلب المشاريع:",C),[]}},staleTime:1e3*30,refetchInterval:1e3*60,retry:2,refetchOnWindowFocus:!1}),{data:I=[]}=Se({queryKey:["/api/worker-types"],queryFn:async()=>{try{const C=await me("/api/worker-types","GET");return C&&C.data&&Array.isArray(C.data)?C.data:Array.isArray(C)?C:[]}catch(C){return console.error("Error fetching worker types:",C),[]}}}),E=Ae({mutationFn:async C=>(await Promise.all([M("workerNames",C.name),M("workerTypes",C.type)]),me("/api/workers","POST",C)),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/autocomplete"]}),b.invalidateQueries({queryKey:["/api/workers"]}),y({title:"نجح الحفظ",description:"تم إضافة العامل بنجاح"}),o(!1),c({name:"",phone:"",type:"",dailyWage:""})},onError:C=>{y({title:"خطأ",description:"حدث خطأ أثناء إضافة العامل",variant:"destructive"})}}),z=Ae({mutationFn:async C=>(await Promise.all([M("projectNames",C.name),M("projectDescriptions",C.description)]),me("/api/projects","POST",C)),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/autocomplete"]}),b.invalidateQueries({queryKey:["/api/projects"]}),b.invalidateQueries({queryKey:["/api/projects/with-stats"]}),y({title:"نجح الحفظ",description:"تم إضافة المشروع بنجاح"}),u(!1),g({name:"",status:"active",description:""})},onError:C=>{y({title:"خطأ",description:"حدث خطأ أثناء إضافة المشروع",variant:"destructive"})}}),w=Ae({mutationFn:async C=>(await M("workerTypes",C.name),me("/api/worker-types","POST",C)),onSuccess:C=>{b.invalidateQueries({queryKey:["/api/autocomplete"]}),y({title:"تم الحفظ",description:"تم إضافة نوع العامل بنجاح"}),c({...d,type:C.name}),p(""),h(!1),b.invalidateQueries({queryKey:["/api/worker-types"]})},onError:C=>{y({title:"خطأ",description:"حدث خطأ أثناء إضافة نوع العامل",variant:"destructive"})}}),{data:v}=Se({queryKey:["/api/projects",s,"daily-summary",new Date().toISOString().split("T")[0]],enabled:!!s,staleTime:1e3*30}),D=Array.isArray(N)?N.find(C=>C.id===s):void 0;f.useEffect(()=>(j(()=>{n(!a)},"إضافة"),()=>j(null)),[j,a]),f.useEffect(()=>{D&&(console.log("🔍 بيانات المشروع المحدد في Frontend:",{projectId:D.id,projectName:D.name,totalIncome:D.stats?.totalIncome,totalExpenses:D.stats?.totalExpenses,currentBalance:D.stats?.currentBalance}),D.name.includes("الحبشي")&&console.warn("🚨 مشروع الحبشي - تحقق من البيانات:",{مشروع:D.name,الدخل:D.stats?.totalIncome,المصاريف:D.stats?.totalExpenses,هل_متساوية:D.stats?.totalIncome===D.stats?.totalExpenses,fullStats:D.stats}))},[D]);const V=C=>{if(typeof C!="number"){const q=parseFloat(String(C));if(isNaN(q))return"0 ر.ي";C=q}return new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(C)+" ر.ي"},X=[{icon:Ls,label:"تسجيل حضور",bgColor:"bg-primary",hoverColor:"hover:bg-primary/90",textColor:"text-primary-foreground",action:()=>t("/worker-attendance")},{icon:ao,label:"مصروفات يومية",bgColor:"bg-secondary",hoverColor:"hover:bg-secondary/90",textColor:"text-secondary-foreground",action:()=>t("/daily-expenses")},{icon:p0,label:"شراء مواد",bgColor:"bg-success",hoverColor:"hover:bg-success/90",textColor:"text-success-foreground",action:()=>t("/material-purchase")},{icon:m2,label:"التقارير",bgColor:"bg-purple-600",hoverColor:"hover:bg-purple-700",textColor:"text-white",action:()=>t("/reports")},{icon:ba,label:"ترحيل أموال",bgColor:"bg-orange-600",hoverColor:"hover:bg-orange-700",textColor:"text-white",action:()=>t("/project-transfers")},{icon:gr,label:"إعدادات القوالب",bgColor:"bg-indigo-600",hoverColor:"hover:bg-indigo-700",textColor:"text-white",action:()=>t("/report-template-settings-enhanced")}];return T?e.jsx(bC,{}):e.jsxs("div",{className:"p-4 fade-in",children:[e.jsx(Ii,{selectedProjectId:s,onProjectChange:(C,q)=>r(C,q)}),D&&e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground",children:D.name}),e.jsx(Fe,{variant:"secondary",className:"bg-success text-success-foreground",children:"نشط"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(it,{title:"إجمالي التوريد",value:D?.stats?.totalIncome||0,icon:bs,color:"blue",formatter:V}),e.jsx(it,{title:"إجمالي المنصرف",value:D?.stats?.totalExpenses||0,icon:Zn,color:"red",formatter:V}),e.jsx(it,{title:"المتبقي الحالي",value:D?.stats?.currentBalance||0,icon:Ns,color:"green",formatter:V}),e.jsx(it,{title:"العمال النشطين",value:D?.stats?.activeWorkers||"0",icon:Go,color:"purple"}),e.jsx(it,{title:"أيام العمل المكتملة",value:D?.stats?.completedDays||"0",icon:yr,color:"teal"}),e.jsx(it,{title:"مشتريات المواد",value:D?.stats?.materialPurchases||"0",icon:ra,color:"indigo"})]})]})}),e.jsx(ee,{children:e.jsxs(oe,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground mb-4",children:"إجراءات سريعة"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.isArray(X)&&X.map((C,q)=>{const ue=C.icon;return e.jsxs(K,{onClick:C.action,className:`${C.bgColor} ${C.hoverColor} ${C.textColor} p-4 h-auto flex-col space-y-2 transition-colors`,children:[e.jsx(ue,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm font-medium",children:C.label})]},q)})})]})}),a&&e.jsxs("div",{className:"fixed bottom-20 right-4 z-50 space-y-2",children:[e.jsxs(K,{onClick:()=>{o(!0),n(!1)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white shadow-lg rounded-full px-4 py-3",size:"sm",children:[e.jsx(Hs,{className:"h-4 w-4"}),e.jsx("span",{children:"إضافة عامل"})]}),e.jsxs(K,{onClick:()=>{u(!0),n(!1)},className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white shadow-lg rounded-full px-4 py-3",size:"sm",children:[e.jsx(j2,{className:"h-4 w-4"}),e.jsx("span",{children:"إضافة مشروع"})]})]}),a&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-20",onClick:()=>n(!1)}),e.jsx(Ss,{open:i,onOpenChange:o,children:e.jsxs(js,{className:"max-w-md",children:[e.jsxs(As,{children:[e.jsx(_s,{children:"إضافة عامل جديد"}),e.jsx(Fs,{children:"أدخل بيانات العامل الجديد لإضافته إلى النظام"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(re,{htmlFor:"worker-name",children:"اسم العامل"}),e.jsx(je,{id:"worker-name",value:d.name,onChange:C=>c({...d,name:C.target.value}),placeholder:"أدخل اسم العامل"})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"worker-phone",children:"رقم الهاتف"}),e.jsx(je,{id:"worker-phone",value:d.phone,onChange:C=>c({...d,phone:C.target.value}),placeholder:"أدخل رقم الهاتف"})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"worker-type",children:"نوع العامل"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(We,{value:d.type,onValueChange:C=>c({...d,type:C}),children:[e.jsx(ze,{className:"flex-1",children:e.jsx(Ke,{placeholder:"اختر نوع العامل..."})}),e.jsxs(Be,{children:[Array.isArray(I)?I.map(C=>e.jsx(W,{value:C.value,children:C.value},C.id)):null,I.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(W,{value:"معلم",children:"معلم"}),e.jsx(W,{value:"عامل",children:"عامل"}),e.jsx(W,{value:"حداد",children:"حداد"}),e.jsx(W,{value:"نجار",children:"نجار"}),e.jsx(W,{value:"سائق",children:"سائق"}),e.jsx(W,{value:"كهربائي",children:"كهربائي"}),e.jsx(W,{value:"سباك",children:"سباك"})]})]})]}),e.jsxs(Ss,{open:m,onOpenChange:h,children:[e.jsx(Cd,{asChild:!0,children:e.jsx(K,{type:"button",variant:"outline",size:"icon",className:"shrink-0",title:"إضافة نوع جديد",children:e.jsx(os,{className:"h-4 w-4"})})}),e.jsxs(js,{className:"sm:max-w-md",children:[e.jsxs(As,{children:[e.jsx(_s,{children:"إضافة نوع عامل جديد"}),e.jsx(Fs,{children:"أدخل اسم نوع العامل الجديد ليتم حفظه في قاعدة البيانات"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(re,{htmlFor:"new-type-name",children:"اسم نوع العامل"}),e.jsx(je,{id:"new-type-name",type:"text",value:x,onChange:C=>p(C.target.value),placeholder:"مثال: كهربائي، سباك، حداد...",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{type:"button",onClick:()=>{x.trim()&&w.mutate({name:x.trim()})},disabled:!x.trim()||w.isPending,className:"flex-1",children:w.isPending?"جاري الإضافة...":"إضافة"}),e.jsx(K,{type:"button",variant:"outline",onClick:()=>{h(!1),p("")},className:"flex-1",children:"إلغاء"})]})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"worker-wage",children:"الأجر اليومي (ر.ي)"}),e.jsx(je,{id:"worker-wage",type:"number",inputMode:"decimal",value:d.dailyWage,onChange:C=>c({...d,dailyWage:C.target.value}),placeholder:"0",className:"text-center arabic-numbers",required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(K,{onClick:()=>{if(!d.name.trim()||!d.type||!d.dailyWage){y({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const C=parseFloat(d.dailyWage);if(isNaN(C)||C<=0){y({title:"خطأ",description:"يرجى إدخال مبلغ صحيح للأجر اليومي",variant:"destructive"});return}E.mutate({name:d.name.trim(),phone:d.phone||null,type:d.type,dailyWage:C.toString(),isActive:!0})},disabled:E.isPending,className:"flex-1",children:E.isPending?"جاري الحفظ...":"حفظ"}),e.jsx(K,{variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"إلغاء"})]})]})]})}),e.jsx(Ss,{open:l,onOpenChange:u,children:e.jsxs(js,{className:"max-w-md",children:[e.jsxs(As,{children:[e.jsx(_s,{children:"إضافة مشروع جديد"}),e.jsx(Fs,{children:"أدخل بيانات المشروع الجديد لإضافته إلى النظام"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(re,{htmlFor:"project-name",children:"اسم المشروع"}),e.jsx(je,{id:"project-name",value:k.name,onChange:C=>g({...k,name:C.target.value}),placeholder:"أدخل اسم المشروع"})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"project-status",children:"حالة المشروع"}),e.jsxs(We,{value:k.status,onValueChange:C=>g({...k,status:C}),children:[e.jsx(ze,{children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"completed",children:"مكتمل"}),e.jsx(W,{value:"paused",children:"متوقف"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"project-description",children:"وصف المشروع"}),e.jsx(je,{id:"project-description",value:k.description,onChange:C=>g({...k,description:C.target.value}),placeholder:"أدخل وصف المشروع (اختياري)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(K,{onClick:()=>{k.name&&z.mutate({name:k.name,status:k.status,description:k.description||null})},disabled:!k.name||z.isPending,className:"flex-1",children:z.isPending?"جاري الحفظ...":"حفظ"}),e.jsx(K,{variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"إلغاء"})]})]})]})})]})}var Ri=t=>t.type==="checkbox",Na=t=>t instanceof Date,ys=t=>t==null;const gv=t=>typeof t=="object";var Kt=t=>!ys(t)&&!Array.isArray(t)&&gv(t)&&!Na(t),yv=t=>Kt(t)&&t.target?Ri(t.target)?t.target.checked:t.target.value:t,wC=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,vv=(t,s)=>t.has(wC(s)),kC=t=>{const s=t.constructor&&t.constructor.prototype;return Kt(s)&&s.hasOwnProperty("isPrototypeOf")},Ed=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Xt(t){let s;const r=Array.isArray(t),a=typeof FileList<"u"?t instanceof FileList:!1;if(t instanceof Date)s=new Date(t);else if(!(Ed&&(t instanceof Blob||a))&&(r||Kt(t)))if(s=r?[]:Object.create(Object.getPrototypeOf(t)),!r&&!kC(t))s=t;else for(const n in t)t.hasOwnProperty(n)&&(s[n]=Xt(t[n]));else return t;return s}var sl=t=>/^\w*$/.test(t),qt=t=>t===void 0,Dd=t=>Array.isArray(t)?t.filter(Boolean):[],Md=t=>Dd(t.replace(/["|']|\]/g,"").split(/\.|\[/)),xe=(t,s,r)=>{if(!s||!Kt(t))return r;const a=(sl(s)?[s]:Md(s)).reduce((n,i)=>ys(n)?n:n[i],t);return qt(a)||a===t?qt(t[s])?r:t[s]:a},Es=t=>typeof t=="boolean",Nt=(t,s,r)=>{let a=-1;const n=sl(s)?[s]:Md(s),i=n.length,o=i-1;for(;++a<i;){const l=n[a];let u=r;if(a!==o){const d=t[l];u=Kt(d)||Array.isArray(d)?d:isNaN(+n[a+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;t[l]=u,t=t[l]}};const bo={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},sr={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Ir={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Id=Ye.createContext(null);Id.displayName="HookFormContext";const rl=()=>Ye.useContext(Id),TC=t=>{const{children:s,...r}=t;return Ye.createElement(Id.Provider,{value:r},s)};var bv=(t,s,r,a=!0)=>{const n={defaultValues:s._defaultValues};for(const i in t)Object.defineProperty(n,i,{get:()=>{const o=i;return s._proxyFormState[o]!==sr.all&&(s._proxyFormState[o]=!a||sr.all),r&&(r[o]=!0),t[o]}});return n};const Rd=typeof window<"u"?Ye.useLayoutEffect:Ye.useEffect;function SC(t){const s=rl(),{control:r=s.control,disabled:a,name:n,exact:i}=t||{},[o,l]=Ye.useState(r._formState),u=Ye.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return Rd(()=>r._subscribe({name:n,formState:u.current,exact:i,callback:d=>{!a&&l({...r._formState,...d})}}),[n,a,i]),Ye.useEffect(()=>{u.current.isValid&&r._setValid(!0)},[r]),Ye.useMemo(()=>bv(o,r,u.current,!1),[o,r])}var Ds=t=>typeof t=="string",jv=(t,s,r,a,n)=>Ds(t)?(a&&s.watch.add(t),xe(r,t,n)):Array.isArray(t)?t.map(i=>(a&&s.watch.add(i),xe(r,i))):(a&&(s.watchAll=!0),r),jc=t=>ys(t)||!gv(t);function Lr(t,s,r=new WeakSet){if(jc(t)||jc(s))return t===s;if(Na(t)&&Na(s))return t.getTime()===s.getTime();const a=Object.keys(t),n=Object.keys(s);if(a.length!==n.length)return!1;if(r.has(t)||r.has(s))return!0;r.add(t),r.add(s);for(const i of a){const o=t[i];if(!n.includes(i))return!1;if(i!=="ref"){const l=s[i];if(Na(o)&&Na(l)||Kt(o)&&Kt(l)||Array.isArray(o)&&Array.isArray(l)?!Lr(o,l,r):o!==l)return!1}}return!0}function AC(t){const s=rl(),{control:r=s.control,name:a,defaultValue:n,disabled:i,exact:o,compute:l}=t||{},u=Ye.useRef(n),d=Ye.useRef(l),c=Ye.useRef(void 0);d.current=l;const m=Ye.useMemo(()=>r._getWatch(a,u.current),[r,a]),[h,x]=Ye.useState(d.current?d.current(m):m);return Rd(()=>r._subscribe({name:a,formState:{values:!0},exact:o,callback:p=>{if(!i){const k=jv(a,r._names,p.values||r._formValues,!1,u.current);if(d.current){const g=d.current(k);Lr(g,c.current)||(x(g),c.current=g)}else x(k)}}}),[r,i,a,o]),Ye.useEffect(()=>r._removeUnmounted()),h}function _C(t){const s=rl(),{name:r,disabled:a,control:n=s.control,shouldUnregister:i,defaultValue:o}=t,l=vv(n._names.array,r),u=Ye.useMemo(()=>xe(n._formValues,r,xe(n._defaultValues,r,o)),[n,r,o]),d=AC({control:n,name:r,defaultValue:u,exact:!0}),c=SC({control:n,name:r,exact:!0}),m=Ye.useRef(t),h=Ye.useRef(void 0),x=Ye.useRef(n.register(r,{...t.rules,value:d,...Es(t.disabled)?{disabled:t.disabled}:{}}));m.current=t;const p=Ye.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!xe(c.errors,r)},isDirty:{enumerable:!0,get:()=>!!xe(c.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!xe(c.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!xe(c.validatingFields,r)},error:{enumerable:!0,get:()=>xe(c.errors,r)}}),[c,r]),k=Ye.useCallback(y=>x.current.onChange({target:{value:yv(y),name:r},type:bo.CHANGE}),[r]),g=Ye.useCallback(()=>x.current.onBlur({target:{value:xe(n._formValues,r),name:r},type:bo.BLUR}),[r,n._formValues]),b=Ye.useCallback(y=>{const M=xe(n._fields,r);M&&y&&(M._f.ref={focus:()=>y.focus&&y.focus(),select:()=>y.select&&y.select(),setCustomValidity:N=>y.setCustomValidity(N),reportValidity:()=>y.reportValidity()})},[n._fields,r]),j=Ye.useMemo(()=>({name:r,value:d,...Es(a)||c.disabled?{disabled:c.disabled||a}:{},onChange:k,onBlur:g,ref:b}),[r,a,c.disabled,k,g,b,d]);return Ye.useEffect(()=>{const y=n._options.shouldUnregister||i,M=h.current;M&&M!==r&&!l&&n.unregister(M),n.register(r,{...m.current.rules,...Es(m.current.disabled)?{disabled:m.current.disabled}:{}});const N=(T,S)=>{const I=xe(n._fields,T);I&&I._f&&(I._f.mount=S)};if(N(r,!0),y){const T=Xt(xe(n._options.defaultValues,r));Nt(n._defaultValues,r,T),qt(xe(n._formValues,r))&&Nt(n._formValues,r,T)}return!l&&n.register(r),h.current=r,()=>{(l?y&&!n._state.action:y)?n.unregister(r):N(r,!1)}},[r,n,l,i]),Ye.useEffect(()=>{n._setDisabledField({disabled:a,name:r})},[a,r,n]),Ye.useMemo(()=>({field:j,formState:c,fieldState:p}),[j,c,p])}const CC=t=>t.render(_C(t));var Nv=(t,s,r,a,n)=>s?{...r[t],types:{...r[t]&&r[t].types?r[t].types:{},[a]:n||!0}}:{},Wn=t=>Array.isArray(t)?t:[t],sh=()=>{let t=[];return{get observers(){return t},next:n=>{for(const i of t)i.next&&i.next(n)},subscribe:n=>(t.push(n),{unsubscribe:()=>{t=t.filter(i=>i!==n)}}),unsubscribe:()=>{t=[]}}};function wv(t,s){const r={};for(const a in t)if(t.hasOwnProperty(a)){const n=t[a],i=s[a];if(n&&Kt(n)&&i){const o=wv(n,i);Kt(o)&&(r[a]=o)}else t[a]&&(r[a]=i)}return r}var Ts=t=>Kt(t)&&!Object.keys(t).length,Fd=t=>t.type==="file",rr=t=>typeof t=="function",jo=t=>{if(!Ed)return!1;const s=t?t.ownerDocument:0;return t instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},kv=t=>t.type==="select-multiple",$d=t=>t.type==="radio",PC=t=>$d(t)||Ri(t),ql=t=>jo(t)&&t.isConnected;function EC(t,s){const r=s.slice(0,-1).length;let a=0;for(;a<r;)t=qt(t)?a++:t[s[a++]];return t}function DC(t){for(const s in t)if(t.hasOwnProperty(s)&&!qt(t[s]))return!1;return!0}function Wt(t,s){const r=Array.isArray(s)?s:sl(s)?[s]:Md(s),a=r.length===1?t:EC(t,r),n=r.length-1,i=r[n];return a&&delete a[i],n!==0&&(Kt(a)&&Ts(a)||Array.isArray(a)&&DC(a))&&Wt(t,r.slice(0,-1)),t}var MC=t=>{for(const s in t)if(rr(t[s]))return!0;return!1};function Tv(t){return Array.isArray(t)||Kt(t)&&!MC(t)}function Nc(t,s={}){for(const r in t)Tv(t[r])?(s[r]=Array.isArray(t[r])?[]:{},Nc(t[r],s[r])):ys(t[r])||(s[r]=!0);return s}function Ba(t,s,r){r||(r=Nc(s));for(const a in t)Tv(t[a])?qt(s)||jc(r[a])?r[a]=Nc(t[a],Array.isArray(t[a])?[]:{}):Ba(t[a],ys(s)?{}:s[a],r[a]):r[a]=!Lr(t[a],s[a]);return r}const rh={value:!1,isValid:!1},ah={value:!0,isValid:!0};var Sv=t=>{if(Array.isArray(t)){if(t.length>1){const s=t.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:s,isValid:!!s.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!qt(t[0].attributes.value)?qt(t[0].value)||t[0].value===""?ah:{value:t[0].value,isValid:!0}:ah:rh}return rh},Av=(t,{valueAsNumber:s,valueAsDate:r,setValueAs:a})=>qt(t)?t:s?t===""?NaN:t&&+t:r&&Ds(t)?new Date(t):a?a(t):t;const nh={isValid:!1,value:null};var _v=t=>Array.isArray(t)?t.reduce((s,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:s,nh):nh;function ih(t){const s=t.ref;return Fd(s)?s.files:$d(s)?_v(t.refs).value:kv(s)?[...s.selectedOptions].map(({value:r})=>r):Ri(s)?Sv(t.refs).value:Av(qt(s.value)?t.ref.value:s.value,t)}var IC=(t,s,r,a)=>{const n={};for(const i of t){const o=xe(s,i);o&&Nt(n,i,o._f)}return{criteriaMode:r,names:[...t],fields:n,shouldUseNativeValidation:a}},No=t=>t instanceof RegExp,_n=t=>qt(t)?t:No(t)?t.source:Kt(t)?No(t.value)?t.value.source:t.value:t,oh=t=>({isOnSubmit:!t||t===sr.onSubmit,isOnBlur:t===sr.onBlur,isOnChange:t===sr.onChange,isOnAll:t===sr.all,isOnTouch:t===sr.onTouched});const lh="AsyncFunction";var RC=t=>!!t&&!!t.validate&&!!(rr(t.validate)&&t.validate.constructor.name===lh||Kt(t.validate)&&Object.values(t.validate).find(s=>s.constructor.name===lh)),FC=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate),ch=(t,s,r)=>!r&&(s.watchAll||s.watch.has(t)||[...s.watch].some(a=>t.startsWith(a)&&/^\.\w+/.test(t.slice(a.length))));const Kn=(t,s,r,a)=>{for(const n of r||Object.keys(t)){const i=xe(t,n);if(i){const{_f:o,...l}=i;if(o){if(o.refs&&o.refs[0]&&s(o.refs[0],n)&&!a)return!0;if(o.ref&&s(o.ref,o.name)&&!a)return!0;if(Kn(l,s))break}else if(Kt(l)&&Kn(l,s))break}}};function dh(t,s,r){const a=xe(t,r);if(a||sl(r))return{error:a,name:r};const n=r.split(".");for(;n.length;){const i=n.join("."),o=xe(s,i),l=xe(t,i);if(o&&!Array.isArray(o)&&r!==i)return{name:r};if(l&&l.type)return{name:i,error:l};if(l&&l.root&&l.root.type)return{name:`${i}.root`,error:l.root};n.pop()}return{name:r}}var $C=(t,s,r,a)=>{r(t);const{name:n,...i}=t;return Ts(i)||Object.keys(i).length>=Object.keys(s).length||Object.keys(i).find(o=>s[o]===(!a||sr.all))},VC=(t,s,r)=>!t||!s||t===s||Wn(t).some(a=>a&&(r?a===s:a.startsWith(s)||s.startsWith(a))),OC=(t,s,r,a,n)=>n.isOnAll?!1:!r&&n.isOnTouch?!(s||t):(r?a.isOnBlur:n.isOnBlur)?!t:(r?a.isOnChange:n.isOnChange)?t:!0,LC=(t,s)=>!Dd(xe(t,s)).length&&Wt(t,s),zC=(t,s,r)=>{const a=Wn(xe(t,r));return Nt(a,"root",s[r]),Nt(t,r,a),t};function uh(t,s,r="validate"){if(Ds(t)||Array.isArray(t)&&t.every(Ds)||Es(t)&&!t)return{type:r,message:Ds(t)?t:"",ref:s}}var Oa=t=>Kt(t)&&!No(t)?t:{value:t,message:""},mh=async(t,s,r,a,n,i)=>{const{ref:o,refs:l,required:u,maxLength:d,minLength:c,min:m,max:h,pattern:x,validate:p,name:k,valueAsNumber:g,mount:b}=t._f,j=xe(r,k);if(!b||s.has(k))return{};const y=l?l[0]:o,M=v=>{n&&y.reportValidity&&(y.setCustomValidity(Es(v)?"":v||""),y.reportValidity())},N={},T=$d(o),S=Ri(o),I=T||S,E=(g||Fd(o))&&qt(o.value)&&qt(j)||jo(o)&&o.value===""||j===""||Array.isArray(j)&&!j.length,z=Nv.bind(null,k,a,N),w=(v,D,V,X=Ir.maxLength,C=Ir.minLength)=>{const q=v?D:V;N[k]={type:v?X:C,message:q,ref:o,...z(v?X:C,q)}};if(i?!Array.isArray(j)||!j.length:u&&(!I&&(E||ys(j))||Es(j)&&!j||S&&!Sv(l).isValid||T&&!_v(l).isValid)){const{value:v,message:D}=Ds(u)?{value:!!u,message:u}:Oa(u);if(v&&(N[k]={type:Ir.required,message:D,ref:y,...z(Ir.required,D)},!a))return M(D),N}if(!E&&(!ys(m)||!ys(h))){let v,D;const V=Oa(h),X=Oa(m);if(!ys(j)&&!isNaN(j)){const C=o.valueAsNumber||j&&+j;ys(V.value)||(v=C>V.value),ys(X.value)||(D=C<X.value)}else{const C=o.valueAsDate||new Date(j),q=fe=>new Date(new Date().toDateString()+" "+fe),ue=o.type=="time",R=o.type=="week";Ds(V.value)&&j&&(v=ue?q(j)>q(V.value):R?j>V.value:C>new Date(V.value)),Ds(X.value)&&j&&(D=ue?q(j)<q(X.value):R?j<X.value:C<new Date(X.value))}if((v||D)&&(w(!!v,V.message,X.message,Ir.max,Ir.min),!a))return M(N[k].message),N}if((d||c)&&!E&&(Ds(j)||i&&Array.isArray(j))){const v=Oa(d),D=Oa(c),V=!ys(v.value)&&j.length>+v.value,X=!ys(D.value)&&j.length<+D.value;if((V||X)&&(w(V,v.message,D.message),!a))return M(N[k].message),N}if(x&&!E&&Ds(j)){const{value:v,message:D}=Oa(x);if(No(v)&&!j.match(v)&&(N[k]={type:Ir.pattern,message:D,ref:o,...z(Ir.pattern,D)},!a))return M(D),N}if(p){if(rr(p)){const v=await p(j,r),D=uh(v,y);if(D&&(N[k]={...D,...z(Ir.validate,D.message)},!a))return M(D.message),N}else if(Kt(p)){let v={};for(const D in p){if(!Ts(v)&&!a)break;const V=uh(await p[D](j,r),y,D);V&&(v={...V,...z(D,V.message)},M(V.message),a&&(N[k]=v))}if(!Ts(v)&&(N[k]={ref:y,...v},!a))return N}}return M(!0),N};const BC={mode:sr.onSubmit,reValidateMode:sr.onChange,shouldFocusError:!0};function qC(t={}){let s={...BC,...t},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:rr(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},a={},n=Kt(s.defaultValues)||Kt(s.values)?Xt(s.defaultValues||s.values)||{}:{},i=s.shouldUnregister?{}:Xt(n),o={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},u,d=0;const c={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let m={...c};const h={array:sh(),state:sh()},x=s.criteriaMode===sr.all,p=_=>$=>{clearTimeout(d),d=setTimeout(_,$)},k=async _=>{if(!s.disabled&&(c.isValid||m.isValid||_)){const $=s.resolver?Ts((await S()).errors):await E(a,!0);$!==r.isValid&&h.state.next({isValid:$})}},g=(_,$)=>{!s.disabled&&(c.isValidating||c.validatingFields||m.isValidating||m.validatingFields)&&((_||Array.from(l.mount)).forEach(B=>{B&&($?Nt(r.validatingFields,B,$):Wt(r.validatingFields,B))}),h.state.next({validatingFields:r.validatingFields,isValidating:!Ts(r.validatingFields)}))},b=(_,$=[],B,se,ae=!0,Y=!0)=>{if(se&&B&&!s.disabled){if(o.action=!0,Y&&Array.isArray(xe(a,_))){const pe=B(xe(a,_),se.argA,se.argB);ae&&Nt(a,_,pe)}if(Y&&Array.isArray(xe(r.errors,_))){const pe=B(xe(r.errors,_),se.argA,se.argB);ae&&Nt(r.errors,_,pe),LC(r.errors,_)}if((c.touchedFields||m.touchedFields)&&Y&&Array.isArray(xe(r.touchedFields,_))){const pe=B(xe(r.touchedFields,_),se.argA,se.argB);ae&&Nt(r.touchedFields,_,pe)}(c.dirtyFields||m.dirtyFields)&&(r.dirtyFields=Ba(n,i)),h.state.next({name:_,isDirty:w(_,$),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else Nt(i,_,$)},j=(_,$)=>{Nt(r.errors,_,$),h.state.next({errors:r.errors})},y=_=>{r.errors=_,h.state.next({errors:r.errors,isValid:!1})},M=(_,$,B,se)=>{const ae=xe(a,_);if(ae){const Y=xe(i,_,qt(B)?xe(n,_):B);qt(Y)||se&&se.defaultChecked||$?Nt(i,_,$?Y:ih(ae._f)):V(_,Y),o.mount&&k()}},N=(_,$,B,se,ae)=>{let Y=!1,pe=!1;const Pe={name:_};if(!s.disabled){if(!B||se){(c.isDirty||m.isDirty)&&(pe=r.isDirty,r.isDirty=Pe.isDirty=w(),Y=pe!==Pe.isDirty);const nt=Lr(xe(n,_),$);pe=!!xe(r.dirtyFields,_),nt?Wt(r.dirtyFields,_):Nt(r.dirtyFields,_,!0),Pe.dirtyFields=r.dirtyFields,Y=Y||(c.dirtyFields||m.dirtyFields)&&pe!==!nt}if(B){const nt=xe(r.touchedFields,_);nt||(Nt(r.touchedFields,_,B),Pe.touchedFields=r.touchedFields,Y=Y||(c.touchedFields||m.touchedFields)&&nt!==B)}Y&&ae&&h.state.next(Pe)}return Y?Pe:{}},T=(_,$,B,se)=>{const ae=xe(r.errors,_),Y=(c.isValid||m.isValid)&&Es($)&&r.isValid!==$;if(s.delayError&&B?(u=p(()=>j(_,B)),u(s.delayError)):(clearTimeout(d),u=null,B?Nt(r.errors,_,B):Wt(r.errors,_)),(B?!Lr(ae,B):ae)||!Ts(se)||Y){const pe={...se,...Y&&Es($)?{isValid:$}:{},errors:r.errors,name:_};r={...r,...pe},h.state.next(pe)}},S=async _=>{g(_,!0);const $=await s.resolver(i,s.context,IC(_||l.mount,a,s.criteriaMode,s.shouldUseNativeValidation));return g(_),$},I=async _=>{const{errors:$}=await S(_);if(_)for(const B of _){const se=xe($,B);se?Nt(r.errors,B,se):Wt(r.errors,B)}else r.errors=$;return $},E=async(_,$,B={valid:!0})=>{for(const se in _){const ae=_[se];if(ae){const{_f:Y,...pe}=ae;if(Y){const Pe=l.array.has(Y.name),nt=ae._f&&RC(ae._f);nt&&c.validatingFields&&g([Y.name],!0);const Ot=await mh(ae,l.disabled,i,x,s.shouldUseNativeValidation&&!$,Pe);if(nt&&c.validatingFields&&g([Y.name]),Ot[Y.name]&&(B.valid=!1,$))break;!$&&(xe(Ot,Y.name)?Pe?zC(r.errors,Ot,Y.name):Nt(r.errors,Y.name,Ot[Y.name]):Wt(r.errors,Y.name))}!Ts(pe)&&await E(pe,$,B)}}return B.valid},z=()=>{for(const _ of l.unMount){const $=xe(a,_);$&&($._f.refs?$._f.refs.every(B=>!ql(B)):!ql($._f.ref))&&H(_)}l.unMount=new Set},w=(_,$)=>!s.disabled&&(_&&$&&Nt(i,_,$),!Lr(fe(),n)),v=(_,$,B)=>jv(_,l,{...o.mount?i:qt($)?n:Ds(_)?{[_]:$}:$},B,$),D=_=>Dd(xe(o.mount?i:n,_,s.shouldUnregister?xe(n,_,[]):[])),V=(_,$,B={})=>{const se=xe(a,_);let ae=$;if(se){const Y=se._f;Y&&(!Y.disabled&&Nt(i,_,Av($,Y)),ae=jo(Y.ref)&&ys($)?"":$,kv(Y.ref)?[...Y.ref.options].forEach(pe=>pe.selected=ae.includes(pe.value)):Y.refs?Ri(Y.ref)?Y.refs.forEach(pe=>{(!pe.defaultChecked||!pe.disabled)&&(Array.isArray(ae)?pe.checked=!!ae.find(Pe=>Pe===pe.value):pe.checked=ae===pe.value||!!ae)}):Y.refs.forEach(pe=>pe.checked=pe.value===ae):Fd(Y.ref)?Y.ref.value="":(Y.ref.value=ae,Y.ref.type||h.state.next({name:_,values:Xt(i)})))}(B.shouldDirty||B.shouldTouch)&&N(_,ae,B.shouldTouch,B.shouldDirty,!0),B.shouldValidate&&R(_)},X=(_,$,B)=>{for(const se in $){if(!$.hasOwnProperty(se))return;const ae=$[se],Y=_+"."+se,pe=xe(a,Y);(l.array.has(_)||Kt(ae)||pe&&!pe._f)&&!Na(ae)?X(Y,ae,B):V(Y,ae,B)}},C=(_,$,B={})=>{const se=xe(a,_),ae=l.array.has(_),Y=Xt($);Nt(i,_,Y),ae?(h.array.next({name:_,values:Xt(i)}),(c.isDirty||c.dirtyFields||m.isDirty||m.dirtyFields)&&B.shouldDirty&&h.state.next({name:_,dirtyFields:Ba(n,i),isDirty:w(_,Y)})):se&&!se._f&&!ys(Y)?X(_,Y,B):V(_,Y,B),ch(_,l)&&h.state.next({...r,name:_}),h.state.next({name:o.mount?_:void 0,values:Xt(i)})},q=async _=>{o.mount=!0;const $=_.target;let B=$.name,se=!0;const ae=xe(a,B),Y=nt=>{se=Number.isNaN(nt)||Na(nt)&&isNaN(nt.getTime())||Lr(nt,xe(i,B,nt))},pe=oh(s.mode),Pe=oh(s.reValidateMode);if(ae){let nt,Ot;const Zs=$.type?ih(ae._f):yv(_),as=_.type===bo.BLUR||_.type===bo.FOCUS_OUT,Ys=!FC(ae._f)&&!s.resolver&&!xe(r.errors,B)&&!ae._f.deps||OC(as,xe(r.touchedFields,B),r.isSubmitted,Pe,pe),Er=ch(B,l,as);Nt(i,B,Zs),as?(!$||!$.readOnly)&&(ae._f.onBlur&&ae._f.onBlur(_),u&&u(0)):ae._f.onChange&&ae._f.onChange(_);const F=N(B,Zs,as),Ce=!Ts(F)||Er;if(!as&&h.state.next({name:B,type:_.type,values:Xt(i)}),Ys)return(c.isValid||m.isValid)&&(s.mode==="onBlur"?as&&k():as||k()),Ce&&h.state.next({name:B,...Er?{}:F});if(!as&&Er&&h.state.next({...r}),s.resolver){const{errors:_e}=await S([B]);if(Y(Zs),se){const Mt=dh(r.errors,a,B),Ee=dh(_e,a,Mt.name||B);nt=Ee.error,B=Ee.name,Ot=Ts(_e)}}else g([B],!0),nt=(await mh(ae,l.disabled,i,x,s.shouldUseNativeValidation))[B],g([B]),Y(Zs),se&&(nt?Ot=!1:(c.isValid||m.isValid)&&(Ot=await E(a,!0)));se&&(ae._f.deps&&(!Array.isArray(ae._f.deps)||ae._f.deps.length>0)&&R(ae._f.deps),T(B,Ot,nt,F))}},ue=(_,$)=>{if(xe(r.errors,$)&&_.focus)return _.focus(),1},R=async(_,$={})=>{let B,se;const ae=Wn(_);if(s.resolver){const Y=await I(qt(_)?_:ae);B=Ts(Y),se=_?!ae.some(pe=>xe(Y,pe)):B}else _?(se=(await Promise.all(ae.map(async Y=>{const pe=xe(a,Y);return await E(pe&&pe._f?{[Y]:pe}:pe)}))).every(Boolean),!(!se&&!r.isValid)&&k()):se=B=await E(a);return h.state.next({...!Ds(_)||(c.isValid||m.isValid)&&B!==r.isValid?{}:{name:_},...s.resolver||!_?{isValid:B}:{},errors:r.errors}),$.shouldFocus&&!se&&Kn(a,ue,_?ae:l.mount),se},fe=(_,$)=>{let B={...o.mount?i:n};return $&&(B=wv($.dirtyFields?r.dirtyFields:r.touchedFields,B)),qt(_)?B:Ds(_)?xe(B,_):_.map(se=>xe(B,se))},ce=(_,$)=>({invalid:!!xe(($||r).errors,_),isDirty:!!xe(($||r).dirtyFields,_),error:xe(($||r).errors,_),isValidating:!!xe(r.validatingFields,_),isTouched:!!xe(($||r).touchedFields,_)}),ne=_=>{_&&Wn(_).forEach($=>Wt(r.errors,$)),h.state.next({errors:_?r.errors:{}})},ye=(_,$,B)=>{const se=(xe(a,_,{_f:{}})._f||{}).ref,ae=xe(r.errors,_)||{},{ref:Y,message:pe,type:Pe,...nt}=ae;Nt(r.errors,_,{...nt,...$,ref:se}),h.state.next({name:_,errors:r.errors,isValid:!1}),B&&B.shouldFocus&&se&&se.focus&&se.focus()},tt=(_,$)=>rr(_)?h.state.subscribe({next:B=>"values"in B&&_(v(void 0,$),B)}):v(_,$,!0),at=_=>h.state.subscribe({next:$=>{VC(_.name,$.name,_.exact)&&$C($,_.formState||c,G,_.reRenderRoot)&&_.callback({values:{...i},...r,...$,defaultValues:n})}}).unsubscribe,st=_=>(o.mount=!0,m={...m,..._.formState},at({..._,formState:m})),H=(_,$={})=>{for(const B of _?Wn(_):l.mount)l.mount.delete(B),l.array.delete(B),$.keepValue||(Wt(a,B),Wt(i,B)),!$.keepError&&Wt(r.errors,B),!$.keepDirty&&Wt(r.dirtyFields,B),!$.keepTouched&&Wt(r.touchedFields,B),!$.keepIsValidating&&Wt(r.validatingFields,B),!s.shouldUnregister&&!$.keepDefaultValue&&Wt(n,B);h.state.next({values:Xt(i)}),h.state.next({...r,...$.keepDirty?{isDirty:w()}:{}}),!$.keepIsValid&&k()},L=({disabled:_,name:$})=>{(Es(_)&&o.mount||_||l.disabled.has($))&&(_?l.disabled.add($):l.disabled.delete($))},Q=(_,$={})=>{let B=xe(a,_);const se=Es($.disabled)||Es(s.disabled);return Nt(a,_,{...B||{},_f:{...B&&B._f?B._f:{ref:{name:_}},name:_,mount:!0,...$}}),l.mount.add(_),B?L({disabled:Es($.disabled)?$.disabled:s.disabled,name:_}):M(_,!0,$.value),{...se?{disabled:$.disabled||s.disabled}:{},...s.progressive?{required:!!$.required,min:_n($.min),max:_n($.max),minLength:_n($.minLength),maxLength:_n($.maxLength),pattern:_n($.pattern)}:{},name:_,onChange:q,onBlur:q,ref:ae=>{if(ae){Q(_,$),B=xe(a,_);const Y=qt(ae.value)&&ae.querySelectorAll&&ae.querySelectorAll("input,select,textarea")[0]||ae,pe=PC(Y),Pe=B._f.refs||[];if(pe?Pe.find(nt=>nt===Y):Y===B._f.ref)return;Nt(a,_,{_f:{...B._f,...pe?{refs:[...Pe.filter(ql),Y,...Array.isArray(xe(n,_))?[{}]:[]],ref:{type:Y.type,name:_}}:{ref:Y}}}),M(_,!1,void 0,Y)}else B=xe(a,_,{}),B._f&&(B._f.mount=!1),(s.shouldUnregister||$.shouldUnregister)&&!(vv(l.array,_)&&o.action)&&l.unMount.add(_)}}},Ne=()=>s.shouldFocusError&&Kn(a,ue,l.mount),pt=_=>{Es(_)&&(h.state.next({disabled:_}),Kn(a,($,B)=>{const se=xe(a,B);se&&($.disabled=se._f.disabled||_,Array.isArray(se._f.refs)&&se._f.refs.forEach(ae=>{ae.disabled=se._f.disabled||_}))},0,!1))},yt=(_,$)=>async B=>{let se;B&&(B.preventDefault&&B.preventDefault(),B.persist&&B.persist());let ae=Xt(i);if(h.state.next({isSubmitting:!0}),s.resolver){const{errors:Y,values:pe}=await S();r.errors=Y,ae=Xt(pe)}else await E(a);if(l.disabled.size)for(const Y of l.disabled)Wt(ae,Y);if(Wt(r.errors,"root"),Ts(r.errors)){h.state.next({errors:{}});try{await _(ae,B)}catch(Y){se=Y}}else $&&await $({...r.errors},B),Ne(),setTimeout(Ne);if(h.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ts(r.errors)&&!se,submitCount:r.submitCount+1,errors:r.errors}),se)throw se},Me=(_,$={})=>{xe(a,_)&&(qt($.defaultValue)?C(_,Xt(xe(n,_))):(C(_,$.defaultValue),Nt(n,_,Xt($.defaultValue))),$.keepTouched||Wt(r.touchedFields,_),$.keepDirty||(Wt(r.dirtyFields,_),r.isDirty=$.defaultValue?w(_,Xt(xe(n,_))):w()),$.keepError||(Wt(r.errors,_),c.isValid&&k()),h.state.next({...r}))},bt=(_,$={})=>{const B=_?Xt(_):n,se=Xt(B),ae=Ts(_),Y=ae?n:se;if($.keepDefaultValues||(n=B),!$.keepValues){if($.keepDirtyValues){const pe=new Set([...l.mount,...Object.keys(Ba(n,i))]);for(const Pe of Array.from(pe))xe(r.dirtyFields,Pe)?Nt(Y,Pe,xe(i,Pe)):C(Pe,xe(Y,Pe))}else{if(Ed&&qt(_))for(const pe of l.mount){const Pe=xe(a,pe);if(Pe&&Pe._f){const nt=Array.isArray(Pe._f.refs)?Pe._f.refs[0]:Pe._f.ref;if(jo(nt)){const Ot=nt.closest("form");if(Ot){Ot.reset();break}}}}if($.keepFieldsRef)for(const pe of l.mount)C(pe,xe(Y,pe));else a={}}i=s.shouldUnregister?$.keepDefaultValues?Xt(n):{}:Xt(Y),h.array.next({values:{...Y}}),h.state.next({values:{...Y}})}l={mount:$.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!c.isValid||!!$.keepIsValid||!!$.keepDirtyValues,o.watch=!!s.shouldUnregister,h.state.next({submitCount:$.keepSubmitCount?r.submitCount:0,isDirty:ae?!1:$.keepDirty?r.isDirty:!!($.keepDefaultValues&&!Lr(_,n)),isSubmitted:$.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:ae?{}:$.keepDirtyValues?$.keepDefaultValues&&i?Ba(n,i):r.dirtyFields:$.keepDefaultValues&&_?Ba(n,_):$.keepDirty?r.dirtyFields:{},touchedFields:$.keepTouched?r.touchedFields:{},errors:$.keepErrors?r.errors:{},isSubmitSuccessful:$.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:n})},rs=(_,$)=>bt(rr(_)?_(i):_,$),ds=(_,$={})=>{const B=xe(a,_),se=B&&B._f;if(se){const ae=se.refs?se.refs[0]:se.ref;ae.focus&&(ae.focus(),$.shouldSelect&&rr(ae.select)&&ae.select())}},G=_=>{r={...r,..._}},he={control:{register:Q,unregister:H,getFieldState:ce,handleSubmit:yt,setError:ye,_subscribe:at,_runSchema:S,_focusError:Ne,_getWatch:v,_getDirty:w,_setValid:k,_setFieldArray:b,_setDisabledField:L,_setErrors:y,_getFieldArray:D,_reset:bt,_resetDefaultValues:()=>rr(s.defaultValues)&&s.defaultValues().then(_=>{rs(_,s.resetOptions),h.state.next({isLoading:!1})}),_removeUnmounted:z,_disableForm:pt,_subjects:h,_proxyFormState:c,get _fields(){return a},get _formValues(){return i},get _state(){return o},set _state(_){o=_},get _defaultValues(){return n},get _names(){return l},set _names(_){l=_},get _formState(){return r},get _options(){return s},set _options(_){s={...s,..._}}},subscribe:st,trigger:R,register:Q,handleSubmit:yt,watch:tt,setValue:C,getValues:fe,reset:rs,resetField:Me,clearErrors:ne,unregister:H,setError:ye,setFocus:ds,getFieldState:ce};return{...he,formControl:he}}function wr(t={}){const s=Ye.useRef(void 0),r=Ye.useRef(void 0),[a,n]=Ye.useState({isDirty:!1,isValidating:!1,isLoading:rr(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,isReady:!1,defaultValues:rr(t.defaultValues)?void 0:t.defaultValues});if(!s.current)if(t.formControl)s.current={...t.formControl,formState:a},t.defaultValues&&!rr(t.defaultValues)&&t.formControl.reset(t.defaultValues,t.resetOptions);else{const{formControl:o,...l}=qC(t);s.current={...l,formState:a}}const i=s.current.control;return i._options=t,Rd(()=>{const o=i._subscribe({formState:i._proxyFormState,callback:()=>n({...i._formState}),reRenderRoot:!0});return n(l=>({...l,isReady:!0})),i._formState.isReady=!0,o},[i]),Ye.useEffect(()=>i._disableForm(t.disabled),[i,t.disabled]),Ye.useEffect(()=>{t.mode&&(i._options.mode=t.mode),t.reValidateMode&&(i._options.reValidateMode=t.reValidateMode)},[i,t.mode,t.reValidateMode]),Ye.useEffect(()=>{t.errors&&(i._setErrors(t.errors),i._focusError())},[i,t.errors]),Ye.useEffect(()=>{t.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,t.shouldUnregister]),Ye.useEffect(()=>{if(i._proxyFormState.isDirty){const o=i._getDirty();o!==a.isDirty&&i._subjects.state.next({isDirty:o})}},[i,a.isDirty]),Ye.useEffect(()=>{t.values&&!Lr(t.values,r.current)?(i._reset(t.values,{keepFieldsRef:!0,...i._options.resetOptions}),r.current=t.values,n(o=>({...o}))):i._resetDefaultValues()},[i,t.values]),Ye.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),s.current.formState=bv(a,i),s.current}const hh=(t,s,r)=>{if(t&&"reportValidity"in t){const a=xe(r,s);t.setCustomValidity(a&&a.message||""),t.reportValidity()}},Cv=(t,s)=>{for(const r in s.fields){const a=s.fields[r];a&&a.ref&&"reportValidity"in a.ref?hh(a.ref,r,t):a.refs&&a.refs.forEach(n=>hh(n,r,t))}},UC=(t,s)=>{s.shouldUseNativeValidation&&Cv(t,s);const r={};for(const a in t){const n=xe(s.fields,a),i=Object.assign(t[a]||{},{ref:n&&n.ref});if(WC(s.names||Object.keys(t),a)){const o=Object.assign({},xe(r,a));Nt(o,"root",i),Nt(r,a,o)}else Nt(r,a,i)}return r},WC=(t,s)=>t.some(r=>r.startsWith(s+"."));var KC=function(t,s){for(var r={};t.length;){var a=t[0],n=a.code,i=a.message,o=a.path.join(".");if(!r[o])if("unionErrors"in a){var l=a.unionErrors[0].errors[0];r[o]={message:l.message,type:l.code}}else r[o]={message:i,type:n};if("unionErrors"in a&&a.unionErrors.forEach(function(c){return c.errors.forEach(function(m){return t.push(m)})}),s){var u=r[o].types,d=u&&u[a.code];r[o]=Nv(o,s,r,n,d?[].concat(d,a.message):a.message)}t.shift()}return r},kr=function(t,s,r){return r===void 0&&(r={}),function(a,n,i){try{return Promise.resolve((function(o,l){try{var u=Promise.resolve(t[r.mode==="sync"?"parse":"parseAsync"](a,s)).then(function(d){return i.shouldUseNativeValidation&&Cv({},i),{errors:{},values:r.raw?a:d}})}catch(d){return l(d)}return u&&u.then?u.then(void 0,l):u})(0,function(o){if((function(l){return Array.isArray(l?.errors)})(o))return{values:{},errors:UC(KC(o.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw o}))}catch(o){return Promise.reject(o)}}},mt;(function(t){t.assertEqual=n=>{};function s(n){}t.assertIs=s;function r(n){throw new Error}t.assertNever=r,t.arrayToEnum=n=>{const i={};for(const o of n)i[o]=o;return i},t.getValidEnumValues=n=>{const i=t.objectKeys(n).filter(l=>typeof n[n[l]]!="number"),o={};for(const l of i)o[l]=n[l];return t.objectValues(o)},t.objectValues=n=>t.objectKeys(n).map(function(i){return n[i]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);return i},t.find=(n,i)=>{for(const o of n)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function a(n,i=" | "){return n.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=a,t.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(mt||(mt={}));var wc;(function(t){t.mergeShapes=(s,r)=>({...s,...r})})(wc||(wc={}));const be=mt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Vr=t=>{switch(typeof t){case"undefined":return be.undefined;case"string":return be.string;case"number":return Number.isNaN(t)?be.nan:be.number;case"boolean":return be.boolean;case"function":return be.function;case"bigint":return be.bigint;case"symbol":return be.symbol;case"object":return Array.isArray(t)?be.array:t===null?be.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?be.promise:typeof Map<"u"&&t instanceof Map?be.map:typeof Set<"u"&&t instanceof Set?be.set:typeof Date<"u"&&t instanceof Date?be.date:be.object;default:return be.unknown}},ie=mt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),GC=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class $s extends Error{get errors(){return this.issues}constructor(s){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=s}format(s){const r=s||function(i){return i.message},a={_errors:[]},n=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(n);else if(o.code==="invalid_return_type")n(o.returnTypeError);else if(o.code==="invalid_arguments")n(o.argumentsError);else if(o.path.length===0)a._errors.push(r(o));else{let l=a,u=0;for(;u<o.path.length;){const d=o.path[u];u===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(r(o))):l[d]=l[d]||{_errors:[]},l=l[d],u++}}};return n(this),a}static assert(s){if(!(s instanceof $s))throw new Error(`Not a ZodError: ${s}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,mt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(s=r=>r.message){const r={},a=[];for(const n of this.issues)if(n.path.length>0){const i=n.path[0];r[i]=r[i]||[],r[i].push(s(n))}else a.push(s(n));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}}$s.create=t=>new $s(t);const cn=(t,s)=>{let r;switch(t.code){case ie.invalid_type:t.received===be.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case ie.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,mt.jsonStringifyReplacer)}`;break;case ie.unrecognized_keys:r=`Unrecognized key(s) in object: ${mt.joinValues(t.keys,", ")}`;break;case ie.invalid_union:r="Invalid input";break;case ie.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${mt.joinValues(t.options)}`;break;case ie.invalid_enum_value:r=`Invalid enum value. Expected ${mt.joinValues(t.options)}, received '${t.received}'`;break;case ie.invalid_arguments:r="Invalid function arguments";break;case ie.invalid_return_type:r="Invalid function return type";break;case ie.invalid_date:r="Invalid date";break;case ie.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:mt.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case ie.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case ie.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case ie.custom:r="Invalid input";break;case ie.invalid_intersection_types:r="Intersection results could not be merged";break;case ie.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case ie.not_finite:r="Number must be finite";break;default:r=s.defaultError,mt.assertNever(t)}return{message:r}};let Pv=cn;function HC(t){Pv=t}function wo(){return Pv}const ko=t=>{const{data:s,path:r,errorMaps:a,issueData:n}=t,i=[...r,...n.path||[]],o={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let l="";const u=a.filter(d=>!!d).slice().reverse();for(const d of u)l=d(o,{data:s,defaultError:l}).message;return{...n,path:i,message:l}},QC=[];function ge(t,s){const r=wo(),a=ko({issueData:s,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===cn?void 0:cn].filter(n=>!!n)});t.common.issues.push(a)}class ps{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(s,r){const a=[];for(const n of r){if(n.status==="aborted")return Re;n.status==="dirty"&&s.dirty(),a.push(n.value)}return{status:s.value,value:a}}static async mergeObjectAsync(s,r){const a=[];for(const n of r){const i=await n.key,o=await n.value;a.push({key:i,value:o})}return ps.mergeObjectSync(s,a)}static mergeObjectSync(s,r){const a={};for(const n of r){const{key:i,value:o}=n;if(i.status==="aborted"||o.status==="aborted")return Re;i.status==="dirty"&&s.dirty(),o.status==="dirty"&&s.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||n.alwaysSet)&&(a[i.value]=o.value)}return{status:s.value,value:a}}}const Re=Object.freeze({status:"aborted"}),Qa=t=>({status:"dirty",value:t}),ws=t=>({status:"valid",value:t}),kc=t=>t.status==="aborted",Tc=t=>t.status==="dirty",Ca=t=>t.status==="valid",ai=t=>typeof Promise<"u"&&t instanceof Promise;var ke;(function(t){t.errToObj=s=>typeof s=="string"?{message:s}:s||{},t.toString=s=>typeof s=="string"?s:s?.message})(ke||(ke={}));class _r{constructor(s,r,a,n){this._cachedPath=[],this.parent=s,this.data=r,this._path=a,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const fh=(t,s)=>{if(Ca(s))return{success:!0,data:s.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new $s(t.common.issues);return this._error=r,this._error}}};function Qe(t){if(!t)return{};const{errorMap:s,invalid_type_error:r,required_error:a,description:n}=t;if(s&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return s?{errorMap:s,description:n}:{errorMap:(o,l)=>{const{message:u}=t;return o.code==="invalid_enum_value"?{message:u??l.defaultError}:typeof l.data>"u"?{message:u??a??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:u??r??l.defaultError}},description:n}}class Je{get description(){return this._def.description}_getType(s){return Vr(s.data)}_getOrReturnCtx(s,r){return r||{common:s.parent.common,data:s.data,parsedType:Vr(s.data),schemaErrorMap:this._def.errorMap,path:s.path,parent:s.parent}}_processInputParams(s){return{status:new ps,ctx:{common:s.parent.common,data:s.data,parsedType:Vr(s.data),schemaErrorMap:this._def.errorMap,path:s.path,parent:s.parent}}}_parseSync(s){const r=this._parse(s);if(ai(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(s){const r=this._parse(s);return Promise.resolve(r)}parse(s,r){const a=this.safeParse(s,r);if(a.success)return a.data;throw a.error}safeParse(s,r){const a={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Vr(s)},n=this._parseSync({data:s,path:a.path,parent:a});return fh(a,n)}"~validate"(s){const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Vr(s)};if(!this["~standard"].async)try{const a=this._parseSync({data:s,path:[],parent:r});return Ca(a)?{value:a.value}:{issues:r.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:s,path:[],parent:r}).then(a=>Ca(a)?{value:a.value}:{issues:r.common.issues})}async parseAsync(s,r){const a=await this.safeParseAsync(s,r);if(a.success)return a.data;throw a.error}async safeParseAsync(s,r){const a={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Vr(s)},n=this._parse({data:s,path:a.path,parent:a}),i=await(ai(n)?n:Promise.resolve(n));return fh(a,i)}refine(s,r){const a=n=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(n):r;return this._refinement((n,i)=>{const o=s(n),l=()=>i.addIssue({code:ie.custom,...a(n)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(s,r){return this._refinement((a,n)=>s(a)?!0:(n.addIssue(typeof r=="function"?r(a,n):r),!1))}_refinement(s){return new ir({schema:this,typeName:$e.ZodEffects,effect:{type:"refinement",refinement:s}})}superRefine(s){return this._refinement(s)}constructor(s){this.spa=this.safeParseAsync,this._def=s,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Tr.create(this,this._def)}nullable(){return ca.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return nr.create(this)}promise(){return un.create(this,this._def)}or(s){return li.create([this,s],this._def)}and(s){return ci.create(this,s,this._def)}transform(s){return new ir({...Qe(this._def),schema:this,typeName:$e.ZodEffects,effect:{type:"transform",transform:s}})}default(s){const r=typeof s=="function"?s:()=>s;return new fi({...Qe(this._def),innerType:this,defaultValue:r,typeName:$e.ZodDefault})}brand(){return new Vd({typeName:$e.ZodBranded,type:this,...Qe(this._def)})}catch(s){const r=typeof s=="function"?s:()=>s;return new pi({...Qe(this._def),innerType:this,catchValue:r,typeName:$e.ZodCatch})}describe(s){const r=this.constructor;return new r({...this._def,description:s})}pipe(s){return Fi.create(this,s)}readonly(){return xi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const XC=/^c[^\s-]{8,}$/i,ZC=/^[0-9a-z]+$/,YC=/^[0-9A-HJKMNP-TV-Z]{26}$/i,JC=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,eP=/^[a-z0-9_-]{21}$/i,tP=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,sP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,aP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ul;const nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,oP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,lP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ev="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${Ev}$`);function Dv(t){let s="[0-5]\\d";t.precision?s=`${s}\\.\\d{${t.precision}}`:t.precision==null&&(s=`${s}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${s})${r}`}function mP(t){return new RegExp(`^${Dv(t)}$`)}function Mv(t){let s=`${Ev}T${Dv(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),s=`${s}(${r.join("|")})`,new RegExp(`^${s}$`)}function hP(t,s){return!!((s==="v4"||!s)&&nP.test(t)||(s==="v6"||!s)&&oP.test(t))}function fP(t,s){if(!tP.test(t))return!1;try{const[r]=t.split(".");if(!r)return!1;const a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||s&&n.alg!==s)}catch{return!1}}function pP(t,s){return!!((s==="v4"||!s)&&iP.test(t)||(s==="v6"||!s)&&lP.test(t))}class ar extends Je{_parse(s){if(this._def.coerce&&(s.data=String(s.data)),this._getType(s)!==be.string){const i=this._getOrReturnCtx(s);return ge(i,{code:ie.invalid_type,expected:be.string,received:i.parsedType}),Re}const a=new ps;let n;for(const i of this._def.checks)if(i.kind==="min")s.data.length<i.value&&(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="max")s.data.length>i.value&&(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="length"){const o=s.data.length>i.value,l=s.data.length<i.value;(o||l)&&(n=this._getOrReturnCtx(s,n),o?ge(n,{code:ie.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):l&&ge(n,{code:ie.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),a.dirty())}else if(i.kind==="email")rP.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"email",code:ie.invalid_string,message:i.message}),a.dirty());else if(i.kind==="emoji")Ul||(Ul=new RegExp(aP,"u")),Ul.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"emoji",code:ie.invalid_string,message:i.message}),a.dirty());else if(i.kind==="uuid")JC.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"uuid",code:ie.invalid_string,message:i.message}),a.dirty());else if(i.kind==="nanoid")eP.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"nanoid",code:ie.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid")XC.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"cuid",code:ie.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid2")ZC.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"cuid2",code:ie.invalid_string,message:i.message}),a.dirty());else if(i.kind==="ulid")YC.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"ulid",code:ie.invalid_string,message:i.message}),a.dirty());else if(i.kind==="url")try{new URL(s.data)}catch{n=this._getOrReturnCtx(s,n),ge(n,{validation:"url",code:ie.invalid_string,message:i.message}),a.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"regex",code:ie.invalid_string,message:i.message}),a.dirty())):i.kind==="trim"?s.data=s.data.trim():i.kind==="includes"?s.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),a.dirty()):i.kind==="toLowerCase"?s.data=s.data.toLowerCase():i.kind==="toUpperCase"?s.data=s.data.toUpperCase():i.kind==="startsWith"?s.data.startsWith(i.value)||(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.invalid_string,validation:{startsWith:i.value},message:i.message}),a.dirty()):i.kind==="endsWith"?s.data.endsWith(i.value)||(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.invalid_string,validation:{endsWith:i.value},message:i.message}),a.dirty()):i.kind==="datetime"?Mv(i).test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.invalid_string,validation:"datetime",message:i.message}),a.dirty()):i.kind==="date"?uP.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.invalid_string,validation:"date",message:i.message}),a.dirty()):i.kind==="time"?mP(i).test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.invalid_string,validation:"time",message:i.message}),a.dirty()):i.kind==="duration"?sP.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"duration",code:ie.invalid_string,message:i.message}),a.dirty()):i.kind==="ip"?hP(s.data,i.version)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"ip",code:ie.invalid_string,message:i.message}),a.dirty()):i.kind==="jwt"?fP(s.data,i.alg)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"jwt",code:ie.invalid_string,message:i.message}),a.dirty()):i.kind==="cidr"?pP(s.data,i.version)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"cidr",code:ie.invalid_string,message:i.message}),a.dirty()):i.kind==="base64"?cP.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"base64",code:ie.invalid_string,message:i.message}),a.dirty()):i.kind==="base64url"?dP.test(s.data)||(n=this._getOrReturnCtx(s,n),ge(n,{validation:"base64url",code:ie.invalid_string,message:i.message}),a.dirty()):mt.assertNever(i);return{status:a.value,value:s.data}}_regex(s,r,a){return this.refinement(n=>s.test(n),{validation:r,code:ie.invalid_string,...ke.errToObj(a)})}_addCheck(s){return new ar({...this._def,checks:[...this._def.checks,s]})}email(s){return this._addCheck({kind:"email",...ke.errToObj(s)})}url(s){return this._addCheck({kind:"url",...ke.errToObj(s)})}emoji(s){return this._addCheck({kind:"emoji",...ke.errToObj(s)})}uuid(s){return this._addCheck({kind:"uuid",...ke.errToObj(s)})}nanoid(s){return this._addCheck({kind:"nanoid",...ke.errToObj(s)})}cuid(s){return this._addCheck({kind:"cuid",...ke.errToObj(s)})}cuid2(s){return this._addCheck({kind:"cuid2",...ke.errToObj(s)})}ulid(s){return this._addCheck({kind:"ulid",...ke.errToObj(s)})}base64(s){return this._addCheck({kind:"base64",...ke.errToObj(s)})}base64url(s){return this._addCheck({kind:"base64url",...ke.errToObj(s)})}jwt(s){return this._addCheck({kind:"jwt",...ke.errToObj(s)})}ip(s){return this._addCheck({kind:"ip",...ke.errToObj(s)})}cidr(s){return this._addCheck({kind:"cidr",...ke.errToObj(s)})}datetime(s){return typeof s=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:s}):this._addCheck({kind:"datetime",precision:typeof s?.precision>"u"?null:s?.precision,offset:s?.offset??!1,local:s?.local??!1,...ke.errToObj(s?.message)})}date(s){return this._addCheck({kind:"date",message:s})}time(s){return typeof s=="string"?this._addCheck({kind:"time",precision:null,message:s}):this._addCheck({kind:"time",precision:typeof s?.precision>"u"?null:s?.precision,...ke.errToObj(s?.message)})}duration(s){return this._addCheck({kind:"duration",...ke.errToObj(s)})}regex(s,r){return this._addCheck({kind:"regex",regex:s,...ke.errToObj(r)})}includes(s,r){return this._addCheck({kind:"includes",value:s,position:r?.position,...ke.errToObj(r?.message)})}startsWith(s,r){return this._addCheck({kind:"startsWith",value:s,...ke.errToObj(r)})}endsWith(s,r){return this._addCheck({kind:"endsWith",value:s,...ke.errToObj(r)})}min(s,r){return this._addCheck({kind:"min",value:s,...ke.errToObj(r)})}max(s,r){return this._addCheck({kind:"max",value:s,...ke.errToObj(r)})}length(s,r){return this._addCheck({kind:"length",value:s,...ke.errToObj(r)})}nonempty(s){return this.min(1,ke.errToObj(s))}trim(){return new ar({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ar({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ar({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(s=>s.kind==="datetime")}get isDate(){return!!this._def.checks.find(s=>s.kind==="date")}get isTime(){return!!this._def.checks.find(s=>s.kind==="time")}get isDuration(){return!!this._def.checks.find(s=>s.kind==="duration")}get isEmail(){return!!this._def.checks.find(s=>s.kind==="email")}get isURL(){return!!this._def.checks.find(s=>s.kind==="url")}get isEmoji(){return!!this._def.checks.find(s=>s.kind==="emoji")}get isUUID(){return!!this._def.checks.find(s=>s.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(s=>s.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(s=>s.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(s=>s.kind==="cuid2")}get isULID(){return!!this._def.checks.find(s=>s.kind==="ulid")}get isIP(){return!!this._def.checks.find(s=>s.kind==="ip")}get isCIDR(){return!!this._def.checks.find(s=>s.kind==="cidr")}get isBase64(){return!!this._def.checks.find(s=>s.kind==="base64")}get isBase64url(){return!!this._def.checks.find(s=>s.kind==="base64url")}get minLength(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s}get maxLength(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s}}ar.create=t=>new ar({checks:[],typeName:$e.ZodString,coerce:t?.coerce??!1,...Qe(t)});function xP(t,s){const r=(t.toString().split(".")[1]||"").length,a=(s.toString().split(".")[1]||"").length,n=r>a?r:a,i=Number.parseInt(t.toFixed(n).replace(".","")),o=Number.parseInt(s.toFixed(n).replace(".",""));return i%o/10**n}class ia extends Je{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(s){if(this._def.coerce&&(s.data=Number(s.data)),this._getType(s)!==be.number){const i=this._getOrReturnCtx(s);return ge(i,{code:ie.invalid_type,expected:be.number,received:i.parsedType}),Re}let a;const n=new ps;for(const i of this._def.checks)i.kind==="int"?mt.isInteger(s.data)||(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?s.data<i.value:s.data<=i.value)&&(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?s.data>i.value:s.data>=i.value)&&(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?xP(s.data,i.value)!==0&&(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(s.data)||(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.not_finite,message:i.message}),n.dirty()):mt.assertNever(i);return{status:n.value,value:s.data}}gte(s,r){return this.setLimit("min",s,!0,ke.toString(r))}gt(s,r){return this.setLimit("min",s,!1,ke.toString(r))}lte(s,r){return this.setLimit("max",s,!0,ke.toString(r))}lt(s,r){return this.setLimit("max",s,!1,ke.toString(r))}setLimit(s,r,a,n){return new ia({...this._def,checks:[...this._def.checks,{kind:s,value:r,inclusive:a,message:ke.toString(n)}]})}_addCheck(s){return new ia({...this._def,checks:[...this._def.checks,s]})}int(s){return this._addCheck({kind:"int",message:ke.toString(s)})}positive(s){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ke.toString(s)})}negative(s){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ke.toString(s)})}nonpositive(s){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ke.toString(s)})}nonnegative(s){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ke.toString(s)})}multipleOf(s,r){return this._addCheck({kind:"multipleOf",value:s,message:ke.toString(r)})}finite(s){return this._addCheck({kind:"finite",message:ke.toString(s)})}safe(s){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ke.toString(s)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ke.toString(s)})}get minValue(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s}get maxValue(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s}get isInt(){return!!this._def.checks.find(s=>s.kind==="int"||s.kind==="multipleOf"&&mt.isInteger(s.value))}get isFinite(){let s=null,r=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(s===null||a.value<s)&&(s=a.value)}return Number.isFinite(r)&&Number.isFinite(s)}}ia.create=t=>new ia({checks:[],typeName:$e.ZodNumber,coerce:t?.coerce||!1,...Qe(t)});class oa extends Je{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(s){if(this._def.coerce)try{s.data=BigInt(s.data)}catch{return this._getInvalidInput(s)}if(this._getType(s)!==be.bigint)return this._getInvalidInput(s);let a;const n=new ps;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?s.data<i.value:s.data<=i.value)&&(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?s.data>i.value:s.data>=i.value)&&(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?s.data%i.value!==BigInt(0)&&(a=this._getOrReturnCtx(s,a),ge(a,{code:ie.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):mt.assertNever(i);return{status:n.value,value:s.data}}_getInvalidInput(s){const r=this._getOrReturnCtx(s);return ge(r,{code:ie.invalid_type,expected:be.bigint,received:r.parsedType}),Re}gte(s,r){return this.setLimit("min",s,!0,ke.toString(r))}gt(s,r){return this.setLimit("min",s,!1,ke.toString(r))}lte(s,r){return this.setLimit("max",s,!0,ke.toString(r))}lt(s,r){return this.setLimit("max",s,!1,ke.toString(r))}setLimit(s,r,a,n){return new oa({...this._def,checks:[...this._def.checks,{kind:s,value:r,inclusive:a,message:ke.toString(n)}]})}_addCheck(s){return new oa({...this._def,checks:[...this._def.checks,s]})}positive(s){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ke.toString(s)})}negative(s){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ke.toString(s)})}nonpositive(s){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ke.toString(s)})}nonnegative(s){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ke.toString(s)})}multipleOf(s,r){return this._addCheck({kind:"multipleOf",value:s,message:ke.toString(r)})}get minValue(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s}get maxValue(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s}}oa.create=t=>new oa({checks:[],typeName:$e.ZodBigInt,coerce:t?.coerce??!1,...Qe(t)});class ni extends Je{_parse(s){if(this._def.coerce&&(s.data=!!s.data),this._getType(s)!==be.boolean){const a=this._getOrReturnCtx(s);return ge(a,{code:ie.invalid_type,expected:be.boolean,received:a.parsedType}),Re}return ws(s.data)}}ni.create=t=>new ni({typeName:$e.ZodBoolean,coerce:t?.coerce||!1,...Qe(t)});class Pa extends Je{_parse(s){if(this._def.coerce&&(s.data=new Date(s.data)),this._getType(s)!==be.date){const i=this._getOrReturnCtx(s);return ge(i,{code:ie.invalid_type,expected:be.date,received:i.parsedType}),Re}if(Number.isNaN(s.data.getTime())){const i=this._getOrReturnCtx(s);return ge(i,{code:ie.invalid_date}),Re}const a=new ps;let n;for(const i of this._def.checks)i.kind==="min"?s.data.getTime()<i.value&&(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),a.dirty()):i.kind==="max"?s.data.getTime()>i.value&&(n=this._getOrReturnCtx(s,n),ge(n,{code:ie.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),a.dirty()):mt.assertNever(i);return{status:a.value,value:new Date(s.data.getTime())}}_addCheck(s){return new Pa({...this._def,checks:[...this._def.checks,s]})}min(s,r){return this._addCheck({kind:"min",value:s.getTime(),message:ke.toString(r)})}max(s,r){return this._addCheck({kind:"max",value:s.getTime(),message:ke.toString(r)})}get minDate(){let s=null;for(const r of this._def.checks)r.kind==="min"&&(s===null||r.value>s)&&(s=r.value);return s!=null?new Date(s):null}get maxDate(){let s=null;for(const r of this._def.checks)r.kind==="max"&&(s===null||r.value<s)&&(s=r.value);return s!=null?new Date(s):null}}Pa.create=t=>new Pa({checks:[],coerce:t?.coerce||!1,typeName:$e.ZodDate,...Qe(t)});class To extends Je{_parse(s){if(this._getType(s)!==be.symbol){const a=this._getOrReturnCtx(s);return ge(a,{code:ie.invalid_type,expected:be.symbol,received:a.parsedType}),Re}return ws(s.data)}}To.create=t=>new To({typeName:$e.ZodSymbol,...Qe(t)});class ii extends Je{_parse(s){if(this._getType(s)!==be.undefined){const a=this._getOrReturnCtx(s);return ge(a,{code:ie.invalid_type,expected:be.undefined,received:a.parsedType}),Re}return ws(s.data)}}ii.create=t=>new ii({typeName:$e.ZodUndefined,...Qe(t)});class oi extends Je{_parse(s){if(this._getType(s)!==be.null){const a=this._getOrReturnCtx(s);return ge(a,{code:ie.invalid_type,expected:be.null,received:a.parsedType}),Re}return ws(s.data)}}oi.create=t=>new oi({typeName:$e.ZodNull,...Qe(t)});class dn extends Je{constructor(){super(...arguments),this._any=!0}_parse(s){return ws(s.data)}}dn.create=t=>new dn({typeName:$e.ZodAny,...Qe(t)});class Ta extends Je{constructor(){super(...arguments),this._unknown=!0}_parse(s){return ws(s.data)}}Ta.create=t=>new Ta({typeName:$e.ZodUnknown,...Qe(t)});class Hr extends Je{_parse(s){const r=this._getOrReturnCtx(s);return ge(r,{code:ie.invalid_type,expected:be.never,received:r.parsedType}),Re}}Hr.create=t=>new Hr({typeName:$e.ZodNever,...Qe(t)});class So extends Je{_parse(s){if(this._getType(s)!==be.undefined){const a=this._getOrReturnCtx(s);return ge(a,{code:ie.invalid_type,expected:be.void,received:a.parsedType}),Re}return ws(s.data)}}So.create=t=>new So({typeName:$e.ZodVoid,...Qe(t)});class nr extends Je{_parse(s){const{ctx:r,status:a}=this._processInputParams(s),n=this._def;if(r.parsedType!==be.array)return ge(r,{code:ie.invalid_type,expected:be.array,received:r.parsedType}),Re;if(n.exactLength!==null){const o=r.data.length>n.exactLength.value,l=r.data.length<n.exactLength.value;(o||l)&&(ge(r,{code:o?ie.too_big:ie.too_small,minimum:l?n.exactLength.value:void 0,maximum:o?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),a.dirty())}if(n.minLength!==null&&r.data.length<n.minLength.value&&(ge(r,{code:ie.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),a.dirty()),n.maxLength!==null&&r.data.length>n.maxLength.value&&(ge(r,{code:ie.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((o,l)=>n.type._parseAsync(new _r(r,o,r.path,l)))).then(o=>ps.mergeArray(a,o));const i=[...r.data].map((o,l)=>n.type._parseSync(new _r(r,o,r.path,l)));return ps.mergeArray(a,i)}get element(){return this._def.type}min(s,r){return new nr({...this._def,minLength:{value:s,message:ke.toString(r)}})}max(s,r){return new nr({...this._def,maxLength:{value:s,message:ke.toString(r)}})}length(s,r){return new nr({...this._def,exactLength:{value:s,message:ke.toString(r)}})}nonempty(s){return this.min(1,s)}}nr.create=(t,s)=>new nr({type:t,minLength:null,maxLength:null,exactLength:null,typeName:$e.ZodArray,...Qe(s)});function qa(t){if(t instanceof Rt){const s={};for(const r in t.shape){const a=t.shape[r];s[r]=Tr.create(qa(a))}return new Rt({...t._def,shape:()=>s})}else return t instanceof nr?new nr({...t._def,type:qa(t.element)}):t instanceof Tr?Tr.create(qa(t.unwrap())):t instanceof ca?ca.create(qa(t.unwrap())):t instanceof Cr?Cr.create(t.items.map(s=>qa(s))):t}class Rt extends Je{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const s=this._def.shape(),r=mt.objectKeys(s);return this._cached={shape:s,keys:r},this._cached}_parse(s){if(this._getType(s)!==be.object){const d=this._getOrReturnCtx(s);return ge(d,{code:ie.invalid_type,expected:be.object,received:d.parsedType}),Re}const{status:a,ctx:n}=this._processInputParams(s),{shape:i,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof Hr&&this._def.unknownKeys==="strip"))for(const d in n.data)o.includes(d)||l.push(d);const u=[];for(const d of o){const c=i[d],m=n.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new _r(n,m,n.path,d)),alwaysSet:d in n.data})}if(this._def.catchall instanceof Hr){const d=this._def.unknownKeys;if(d==="passthrough")for(const c of l)u.push({key:{status:"valid",value:c},value:{status:"valid",value:n.data[c]}});else if(d==="strict")l.length>0&&(ge(n,{code:ie.unrecognized_keys,keys:l}),a.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const c of l){const m=n.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new _r(n,m,n.path,c)),alwaysSet:c in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const d=[];for(const c of u){const m=await c.key,h=await c.value;d.push({key:m,value:h,alwaysSet:c.alwaysSet})}return d}).then(d=>ps.mergeObjectSync(a,d)):ps.mergeObjectSync(a,u)}get shape(){return this._def.shape()}strict(s){return ke.errToObj,new Rt({...this._def,unknownKeys:"strict",...s!==void 0?{errorMap:(r,a)=>{const n=this._def.errorMap?.(r,a).message??a.defaultError;return r.code==="unrecognized_keys"?{message:ke.errToObj(s).message??n}:{message:n}}}:{}})}strip(){return new Rt({...this._def,unknownKeys:"strip"})}passthrough(){return new Rt({...this._def,unknownKeys:"passthrough"})}extend(s){return new Rt({...this._def,shape:()=>({...this._def.shape(),...s})})}merge(s){return new Rt({unknownKeys:s._def.unknownKeys,catchall:s._def.catchall,shape:()=>({...this._def.shape(),...s._def.shape()}),typeName:$e.ZodObject})}setKey(s,r){return this.augment({[s]:r})}catchall(s){return new Rt({...this._def,catchall:s})}pick(s){const r={};for(const a of mt.objectKeys(s))s[a]&&this.shape[a]&&(r[a]=this.shape[a]);return new Rt({...this._def,shape:()=>r})}omit(s){const r={};for(const a of mt.objectKeys(this.shape))s[a]||(r[a]=this.shape[a]);return new Rt({...this._def,shape:()=>r})}deepPartial(){return qa(this)}partial(s){const r={};for(const a of mt.objectKeys(this.shape)){const n=this.shape[a];s&&!s[a]?r[a]=n:r[a]=n.optional()}return new Rt({...this._def,shape:()=>r})}required(s){const r={};for(const a of mt.objectKeys(this.shape))if(s&&!s[a])r[a]=this.shape[a];else{let i=this.shape[a];for(;i instanceof Tr;)i=i._def.innerType;r[a]=i}return new Rt({...this._def,shape:()=>r})}keyof(){return Iv(mt.objectKeys(this.shape))}}Rt.create=(t,s)=>new Rt({shape:()=>t,unknownKeys:"strip",catchall:Hr.create(),typeName:$e.ZodObject,...Qe(s)});Rt.strictCreate=(t,s)=>new Rt({shape:()=>t,unknownKeys:"strict",catchall:Hr.create(),typeName:$e.ZodObject,...Qe(s)});Rt.lazycreate=(t,s)=>new Rt({shape:t,unknownKeys:"strip",catchall:Hr.create(),typeName:$e.ZodObject,...Qe(s)});class li extends Je{_parse(s){const{ctx:r}=this._processInputParams(s),a=this._def.options;function n(i){for(const l of i)if(l.result.status==="valid")return l.result;for(const l of i)if(l.result.status==="dirty")return r.common.issues.push(...l.ctx.common.issues),l.result;const o=i.map(l=>new $s(l.ctx.common.issues));return ge(r,{code:ie.invalid_union,unionErrors:o}),Re}if(r.common.async)return Promise.all(a.map(async i=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(n);{let i;const o=[];for(const u of a){const d={...r,common:{...r.common,issues:[]},parent:null},c=u._parseSync({data:r.data,path:r.path,parent:d});if(c.status==="valid")return c;c.status==="dirty"&&!i&&(i={result:c,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const l=o.map(u=>new $s(u));return ge(r,{code:ie.invalid_union,unionErrors:l}),Re}}get options(){return this._def.options}}li.create=(t,s)=>new li({options:t,typeName:$e.ZodUnion,...Qe(s)});const Fr=t=>t instanceof ui?Fr(t.schema):t instanceof ir?Fr(t.innerType()):t instanceof mi?[t.value]:t instanceof la?t.options:t instanceof hi?mt.objectValues(t.enum):t instanceof fi?Fr(t._def.innerType):t instanceof ii?[void 0]:t instanceof oi?[null]:t instanceof Tr?[void 0,...Fr(t.unwrap())]:t instanceof ca?[null,...Fr(t.unwrap())]:t instanceof Vd||t instanceof xi?Fr(t.unwrap()):t instanceof pi?Fr(t._def.innerType):[];class al extends Je{_parse(s){const{ctx:r}=this._processInputParams(s);if(r.parsedType!==be.object)return ge(r,{code:ie.invalid_type,expected:be.object,received:r.parsedType}),Re;const a=this.discriminator,n=r.data[a],i=this.optionsMap.get(n);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(ge(r,{code:ie.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),Re)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(s,r,a){const n=new Map;for(const i of r){const o=Fr(i.shape[s]);if(!o.length)throw new Error(`A discriminator value for key \`${s}\` could not be extracted from all schema options`);for(const l of o){if(n.has(l))throw new Error(`Discriminator property ${String(s)} has duplicate value ${String(l)}`);n.set(l,i)}}return new al({typeName:$e.ZodDiscriminatedUnion,discriminator:s,options:r,optionsMap:n,...Qe(a)})}}function Sc(t,s){const r=Vr(t),a=Vr(s);if(t===s)return{valid:!0,data:t};if(r===be.object&&a===be.object){const n=mt.objectKeys(s),i=mt.objectKeys(t).filter(l=>n.indexOf(l)!==-1),o={...t,...s};for(const l of i){const u=Sc(t[l],s[l]);if(!u.valid)return{valid:!1};o[l]=u.data}return{valid:!0,data:o}}else if(r===be.array&&a===be.array){if(t.length!==s.length)return{valid:!1};const n=[];for(let i=0;i<t.length;i++){const o=t[i],l=s[i],u=Sc(o,l);if(!u.valid)return{valid:!1};n.push(u.data)}return{valid:!0,data:n}}else return r===be.date&&a===be.date&&+t==+s?{valid:!0,data:t}:{valid:!1}}class ci extends Je{_parse(s){const{status:r,ctx:a}=this._processInputParams(s),n=(i,o)=>{if(kc(i)||kc(o))return Re;const l=Sc(i.value,o.value);return l.valid?((Tc(i)||Tc(o))&&r.dirty(),{status:r.value,value:l.data}):(ge(a,{code:ie.invalid_intersection_types}),Re)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([i,o])=>n(i,o)):n(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}ci.create=(t,s,r)=>new ci({left:t,right:s,typeName:$e.ZodIntersection,...Qe(r)});class Cr extends Je{_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==be.array)return ge(a,{code:ie.invalid_type,expected:be.array,received:a.parsedType}),Re;if(a.data.length<this._def.items.length)return ge(a,{code:ie.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Re;!this._def.rest&&a.data.length>this._def.items.length&&(ge(a,{code:ie.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...a.data].map((o,l)=>{const u=this._def.items[l]||this._def.rest;return u?u._parse(new _r(a,o,a.path,l)):null}).filter(o=>!!o);return a.common.async?Promise.all(i).then(o=>ps.mergeArray(r,o)):ps.mergeArray(r,i)}get items(){return this._def.items}rest(s){return new Cr({...this._def,rest:s})}}Cr.create=(t,s)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Cr({items:t,typeName:$e.ZodTuple,rest:null,...Qe(s)})};class di extends Je{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==be.object)return ge(a,{code:ie.invalid_type,expected:be.object,received:a.parsedType}),Re;const n=[],i=this._def.keyType,o=this._def.valueType;for(const l in a.data)n.push({key:i._parse(new _r(a,l,a.path,l)),value:o._parse(new _r(a,a.data[l],a.path,l)),alwaysSet:l in a.data});return a.common.async?ps.mergeObjectAsync(r,n):ps.mergeObjectSync(r,n)}get element(){return this._def.valueType}static create(s,r,a){return r instanceof Je?new di({keyType:s,valueType:r,typeName:$e.ZodRecord,...Qe(a)}):new di({keyType:ar.create(),valueType:s,typeName:$e.ZodRecord,...Qe(r)})}}class Ao extends Je{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==be.map)return ge(a,{code:ie.invalid_type,expected:be.map,received:a.parsedType}),Re;const n=this._def.keyType,i=this._def.valueType,o=[...a.data.entries()].map(([l,u],d)=>({key:n._parse(new _r(a,l,a.path,[d,"key"])),value:i._parse(new _r(a,u,a.path,[d,"value"]))}));if(a.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const u of o){const d=await u.key,c=await u.value;if(d.status==="aborted"||c.status==="aborted")return Re;(d.status==="dirty"||c.status==="dirty")&&r.dirty(),l.set(d.value,c.value)}return{status:r.value,value:l}})}else{const l=new Map;for(const u of o){const d=u.key,c=u.value;if(d.status==="aborted"||c.status==="aborted")return Re;(d.status==="dirty"||c.status==="dirty")&&r.dirty(),l.set(d.value,c.value)}return{status:r.value,value:l}}}}Ao.create=(t,s,r)=>new Ao({valueType:s,keyType:t,typeName:$e.ZodMap,...Qe(r)});class Ea extends Je{_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.parsedType!==be.set)return ge(a,{code:ie.invalid_type,expected:be.set,received:a.parsedType}),Re;const n=this._def;n.minSize!==null&&a.data.size<n.minSize.value&&(ge(a,{code:ie.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),r.dirty()),n.maxSize!==null&&a.data.size>n.maxSize.value&&(ge(a,{code:ie.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),r.dirty());const i=this._def.valueType;function o(u){const d=new Set;for(const c of u){if(c.status==="aborted")return Re;c.status==="dirty"&&r.dirty(),d.add(c.value)}return{status:r.value,value:d}}const l=[...a.data.values()].map((u,d)=>i._parse(new _r(a,u,a.path,d)));return a.common.async?Promise.all(l).then(u=>o(u)):o(l)}min(s,r){return new Ea({...this._def,minSize:{value:s,message:ke.toString(r)}})}max(s,r){return new Ea({...this._def,maxSize:{value:s,message:ke.toString(r)}})}size(s,r){return this.min(s,r).max(s,r)}nonempty(s){return this.min(1,s)}}Ea.create=(t,s)=>new Ea({valueType:t,minSize:null,maxSize:null,typeName:$e.ZodSet,...Qe(s)});class Ja extends Je{constructor(){super(...arguments),this.validate=this.implement}_parse(s){const{ctx:r}=this._processInputParams(s);if(r.parsedType!==be.function)return ge(r,{code:ie.invalid_type,expected:be.function,received:r.parsedType}),Re;function a(l,u){return ko({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,wo(),cn].filter(d=>!!d),issueData:{code:ie.invalid_arguments,argumentsError:u}})}function n(l,u){return ko({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,wo(),cn].filter(d=>!!d),issueData:{code:ie.invalid_return_type,returnTypeError:u}})}const i={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof un){const l=this;return ws(async function(...u){const d=new $s([]),c=await l._def.args.parseAsync(u,i).catch(x=>{throw d.addIssue(a(u,x)),d}),m=await Reflect.apply(o,this,c);return await l._def.returns._def.type.parseAsync(m,i).catch(x=>{throw d.addIssue(n(m,x)),d})})}else{const l=this;return ws(function(...u){const d=l._def.args.safeParse(u,i);if(!d.success)throw new $s([a(u,d.error)]);const c=Reflect.apply(o,this,d.data),m=l._def.returns.safeParse(c,i);if(!m.success)throw new $s([n(c,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...s){return new Ja({...this._def,args:Cr.create(s).rest(Ta.create())})}returns(s){return new Ja({...this._def,returns:s})}implement(s){return this.parse(s)}strictImplement(s){return this.parse(s)}static create(s,r,a){return new Ja({args:s||Cr.create([]).rest(Ta.create()),returns:r||Ta.create(),typeName:$e.ZodFunction,...Qe(a)})}}class ui extends Je{get schema(){return this._def.getter()}_parse(s){const{ctx:r}=this._processInputParams(s);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}ui.create=(t,s)=>new ui({getter:t,typeName:$e.ZodLazy,...Qe(s)});class mi extends Je{_parse(s){if(s.data!==this._def.value){const r=this._getOrReturnCtx(s);return ge(r,{received:r.data,code:ie.invalid_literal,expected:this._def.value}),Re}return{status:"valid",value:s.data}}get value(){return this._def.value}}mi.create=(t,s)=>new mi({value:t,typeName:$e.ZodLiteral,...Qe(s)});function Iv(t,s){return new la({values:t,typeName:$e.ZodEnum,...Qe(s)})}class la extends Je{_parse(s){if(typeof s.data!="string"){const r=this._getOrReturnCtx(s),a=this._def.values;return ge(r,{expected:mt.joinValues(a),received:r.parsedType,code:ie.invalid_type}),Re}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(s.data)){const r=this._getOrReturnCtx(s),a=this._def.values;return ge(r,{received:r.data,code:ie.invalid_enum_value,options:a}),Re}return ws(s.data)}get options(){return this._def.values}get enum(){const s={};for(const r of this._def.values)s[r]=r;return s}get Values(){const s={};for(const r of this._def.values)s[r]=r;return s}get Enum(){const s={};for(const r of this._def.values)s[r]=r;return s}extract(s,r=this._def){return la.create(s,{...this._def,...r})}exclude(s,r=this._def){return la.create(this.options.filter(a=>!s.includes(a)),{...this._def,...r})}}la.create=Iv;class hi extends Je{_parse(s){const r=mt.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(s);if(a.parsedType!==be.string&&a.parsedType!==be.number){const n=mt.objectValues(r);return ge(a,{expected:mt.joinValues(n),received:a.parsedType,code:ie.invalid_type}),Re}if(this._cache||(this._cache=new Set(mt.getValidEnumValues(this._def.values))),!this._cache.has(s.data)){const n=mt.objectValues(r);return ge(a,{received:a.data,code:ie.invalid_enum_value,options:n}),Re}return ws(s.data)}get enum(){return this._def.values}}hi.create=(t,s)=>new hi({values:t,typeName:$e.ZodNativeEnum,...Qe(s)});class un extends Je{unwrap(){return this._def.type}_parse(s){const{ctx:r}=this._processInputParams(s);if(r.parsedType!==be.promise&&r.common.async===!1)return ge(r,{code:ie.invalid_type,expected:be.promise,received:r.parsedType}),Re;const a=r.parsedType===be.promise?r.data:Promise.resolve(r.data);return ws(a.then(n=>this._def.type.parseAsync(n,{path:r.path,errorMap:r.common.contextualErrorMap})))}}un.create=(t,s)=>new un({type:t,typeName:$e.ZodPromise,...Qe(s)});class ir extends Je{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$e.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(s){const{status:r,ctx:a}=this._processInputParams(s),n=this._def.effect||null,i={addIssue:o=>{ge(a,o),o.fatal?r.abort():r.dirty()},get path(){return a.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const o=n.transform(a.data,i);if(a.common.async)return Promise.resolve(o).then(async l=>{if(r.value==="aborted")return Re;const u=await this._def.schema._parseAsync({data:l,path:a.path,parent:a});return u.status==="aborted"?Re:u.status==="dirty"||r.value==="dirty"?Qa(u.value):u});{if(r.value==="aborted")return Re;const l=this._def.schema._parseSync({data:o,path:a.path,parent:a});return l.status==="aborted"?Re:l.status==="dirty"||r.value==="dirty"?Qa(l.value):l}}if(n.type==="refinement"){const o=l=>{const u=n.refinement(l,i);if(a.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(a.common.async===!1){const l=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return l.status==="aborted"?Re:(l.status==="dirty"&&r.dirty(),o(l.value),{status:r.value,value:l.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(l=>l.status==="aborted"?Re:(l.status==="dirty"&&r.dirty(),o(l.value).then(()=>({status:r.value,value:l.value}))))}if(n.type==="transform")if(a.common.async===!1){const o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Ca(o))return Re;const l=n.transform(o.value,i);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:l}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>Ca(o)?Promise.resolve(n.transform(o.value,i)).then(l=>({status:r.value,value:l})):Re);mt.assertNever(n)}}ir.create=(t,s,r)=>new ir({schema:t,typeName:$e.ZodEffects,effect:s,...Qe(r)});ir.createWithPreprocess=(t,s,r)=>new ir({schema:s,effect:{type:"preprocess",transform:t},typeName:$e.ZodEffects,...Qe(r)});class Tr extends Je{_parse(s){return this._getType(s)===be.undefined?ws(void 0):this._def.innerType._parse(s)}unwrap(){return this._def.innerType}}Tr.create=(t,s)=>new Tr({innerType:t,typeName:$e.ZodOptional,...Qe(s)});class ca extends Je{_parse(s){return this._getType(s)===be.null?ws(null):this._def.innerType._parse(s)}unwrap(){return this._def.innerType}}ca.create=(t,s)=>new ca({innerType:t,typeName:$e.ZodNullable,...Qe(s)});class fi extends Je{_parse(s){const{ctx:r}=this._processInputParams(s);let a=r.data;return r.parsedType===be.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}fi.create=(t,s)=>new fi({innerType:t,typeName:$e.ZodDefault,defaultValue:typeof s.default=="function"?s.default:()=>s.default,...Qe(s)});class pi extends Je{_parse(s){const{ctx:r}=this._processInputParams(s),a={...r,common:{...r.common,issues:[]}},n=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return ai(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new $s(a.common.issues)},input:a.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new $s(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}pi.create=(t,s)=>new pi({innerType:t,typeName:$e.ZodCatch,catchValue:typeof s.catch=="function"?s.catch:()=>s.catch,...Qe(s)});class _o extends Je{_parse(s){if(this._getType(s)!==be.nan){const a=this._getOrReturnCtx(s);return ge(a,{code:ie.invalid_type,expected:be.nan,received:a.parsedType}),Re}return{status:"valid",value:s.data}}}_o.create=t=>new _o({typeName:$e.ZodNaN,...Qe(t)});const gP=Symbol("zod_brand");class Vd extends Je{_parse(s){const{ctx:r}=this._processInputParams(s),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}}class Fi extends Je{_parse(s){const{status:r,ctx:a}=this._processInputParams(s);if(a.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?Re:i.status==="dirty"?(r.dirty(),Qa(i.value)):this._def.out._parseAsync({data:i.value,path:a.path,parent:a})})();{const n=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return n.status==="aborted"?Re:n.status==="dirty"?(r.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:a.path,parent:a})}}static create(s,r){return new Fi({in:s,out:r,typeName:$e.ZodPipeline})}}class xi extends Je{_parse(s){const r=this._def.innerType._parse(s),a=n=>(Ca(n)&&(n.value=Object.freeze(n.value)),n);return ai(r)?r.then(n=>a(n)):a(r)}unwrap(){return this._def.innerType}}xi.create=(t,s)=>new xi({innerType:t,typeName:$e.ZodReadonly,...Qe(s)});function ph(t,s){const r=typeof t=="function"?t(s):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function Od(t,s={},r){return t?dn.create().superRefine((a,n)=>{const i=t(a);if(i instanceof Promise)return i.then(o=>{if(!o){const l=ph(s,a),u=l.fatal??r??!0;n.addIssue({code:"custom",...l,fatal:u})}});if(!i){const o=ph(s,a),l=o.fatal??r??!0;n.addIssue({code:"custom",...o,fatal:l})}}):dn.create()}const yP={object:Rt.lazycreate};var $e;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})($e||($e={}));const vP=(t,s={message:`Input not instance of ${t.name}`})=>Od(r=>r instanceof t,s),De=ar.create,Sa=ia.create,bP=_o.create,jP=oa.create,Ld=ni.create,Rn=Pa.create,NP=To.create,wP=ii.create,Rv=oi.create,Co=dn.create,kP=Ta.create,TP=Hr.create,SP=So.create,Fv=nr.create,Qr=Rt.create,AP=Rt.strictCreate,dr=li.create,_P=al.create,CP=ci.create,PP=Cr.create,$v=di.create,EP=Ao.create,DP=Ea.create,MP=Ja.create,IP=ui.create,Vv=mi.create,nl=la.create,RP=hi.create,FP=un.create,xh=ir.create,$P=Tr.create,VP=ca.create,OP=ir.createWithPreprocess,LP=Fi.create,zP=()=>De().optional(),BP=()=>Sa().optional(),qP=()=>Ld().optional(),dt={string:(t=>ar.create({...t,coerce:!0})),number:(t=>ia.create({...t,coerce:!0})),boolean:(t=>ni.create({...t,coerce:!0})),bigint:(t=>oa.create({...t,coerce:!0})),date:(t=>Pa.create({...t,coerce:!0}))},UP=Re,WP=Object.freeze(Object.defineProperty({__proto__:null,BRAND:gP,DIRTY:Qa,EMPTY_PATH:QC,INVALID:Re,NEVER:UP,OK:ws,ParseStatus:ps,Schema:Je,ZodAny:dn,ZodArray:nr,ZodBigInt:oa,ZodBoolean:ni,ZodBranded:Vd,ZodCatch:pi,ZodDate:Pa,ZodDefault:fi,ZodDiscriminatedUnion:al,ZodEffects:ir,ZodEnum:la,ZodError:$s,get ZodFirstPartyTypeKind(){return $e},ZodFunction:Ja,ZodIntersection:ci,ZodIssueCode:ie,ZodLazy:ui,ZodLiteral:mi,ZodMap:Ao,ZodNaN:_o,ZodNativeEnum:hi,ZodNever:Hr,ZodNull:oi,ZodNullable:ca,ZodNumber:ia,ZodObject:Rt,ZodOptional:Tr,ZodParsedType:be,ZodPipeline:Fi,ZodPromise:un,ZodReadonly:xi,ZodRecord:di,ZodSchema:Je,ZodSet:Ea,ZodString:ar,ZodSymbol:To,ZodTransformer:ir,ZodTuple:Cr,ZodType:Je,ZodUndefined:ii,ZodUnion:li,ZodUnknown:Ta,ZodVoid:So,addIssueToContext:ge,any:Co,array:Fv,bigint:jP,boolean:Ld,coerce:dt,custom:Od,date:Rn,datetimeRegex:Mv,defaultErrorMap:cn,discriminatedUnion:_P,effect:xh,enum:nl,function:MP,getErrorMap:wo,getParsedType:Vr,instanceof:vP,intersection:CP,isAborted:kc,isAsync:ai,isDirty:Tc,isValid:Ca,late:yP,lazy:IP,literal:Vv,makeIssue:ko,map:EP,nan:bP,nativeEnum:RP,never:TP,null:Rv,nullable:VP,number:Sa,object:Qr,get objectUtil(){return wc},oboolean:qP,onumber:BP,optional:$P,ostring:zP,pipeline:LP,preprocess:OP,promise:FP,quotelessJson:GC,record:$v,set:DP,setErrorMap:HC,strictObject:AP,string:De,symbol:NP,transformer:xh,tuple:PP,undefined:wP,union:dr,unknown:kP,get util(){return mt},void:SP},Symbol.toStringTag,{value:"Module"})),Ov=f.createContext(void 0);function Ra(){const t=f.useContext(Ov);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function KP({children:t}){const[s,r]=f.useState(null),[a,n]=f.useState(!0),i=Gt(),o=s!==null,l=()=>localStorage.getItem("accessToken"),u=()=>localStorage.getItem("refreshToken"),[d,c]=f.useState(0),[m,h]=f.useState(null);f.useEffect(()=>{Au({getAccessToken:l,refreshToken:N,logout:p})},[]),f.useEffect(()=>{(async()=>{console.log("🔐 [AuthProvider] بدء تهيئة المصادقة...",new Date().toISOString());try{const I=localStorage.getItem("user"),E=localStorage.getItem("accessToken");if(console.log("🔍 [AuthProvider] فحص البيانات المحفوظة:",{hasUser:!!I,hasToken:!!E,userPreview:I?`${I.substring(0,50)}...`:"غير موجود",authFailureCount:d}),I&&E){console.log("📦 [AuthProvider] وُجدت بيانات محفوظة، محاولة التحقق...");try{const z=JSON.parse(I);console.log("👤 [AuthProvider] تم تحليل بيانات المستخدم:",{id:z.id,email:z.email}),console.log("🔍 [AuthProvider] التحقق من صحة التوكن مع الخادم...");const w=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},credentials:"include"});if(console.log("📡 [AuthProvider] استجابة التحقق:",{status:w.status,ok:w.ok}),w.ok){const v=await w.json();if(console.log("✅ [AuthProvider] بيانات الاستجابة:",v),v.success&&v.user)console.log("✅ [AuthProvider] تم التحقق من البيانات بنجاح:",{userId:v.user.id,email:v.user.email}),r(v.user),h(new Date),c(0);else throw new Error("بيانات المستخدم غير صحيحة في الاستجابة")}else if(w.status===401)console.log("🚫 [AuthProvider] التوكن منتهي الصلاحية، تسجيل خروج تلقائي"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),r(null);else{console.log(`⚠️ [AuthProvider] فشل التحقق: ${w.status}`);const v=localStorage.getItem("refreshToken");if(w.status===401&&v){console.log("🔄 [AuthProvider] محاولة تجديد التوكن...");const D=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:v}),credentials:"include"});if(D.ok){const V=await D.json();if(V.success&&V.tokens){console.log("✅ [AuthProvider] تم تجديد التوكن بنجاح"),localStorage.setItem("accessToken",V.tokens.accessToken),localStorage.setItem("refreshToken",V.tokens.refreshToken),r(z),c(0);return}}console.log("❌ [AuthProvider] فشل تجديد التوكن")}throw new Error(`HTTP ${w.status}: فشل التحقق من المصادقة`)}}catch(z){console.error("❌ [AuthProvider] خطأ في التحقق من البيانات:",z);const w=d+1;c(w),w>=3?(console.log("🧹 [AuthProvider] مسح البيانات بسبب تكرار الأخطاء"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),r(null)):console.log(`⏳ [AuthProvider] إبقاء البيانات، محاولة ${w}/3`)}}else console.log("ℹ️ [AuthProvider] لا توجد بيانات محفوظة",{hasSavedUser:!!I,hasAccessToken:!!E})}catch(I){console.error("❌ [AuthProvider] خطأ عام في تحقق المصادقة:",I)}finally{console.log("🏁 [AuthProvider] انتهاء تهيئة المصادقة، isLoading = false"),n(!1)}})()},[d]);const x=async(S,I)=>{console.log("🔑 [AuthProvider.login] بدء تسجيل الدخول:",S,new Date().toISOString()),console.log("📊 [AuthProvider.login] معاملات الدخل:",{email:S,hasPassword:!!I,passwordLength:I?.length||0,isLoading:a,isAuthenticated:o,currentUser:s?.email||"لا يوجد"});try{console.log("📡 [AuthProvider.login] إرسال طلب لـ /api/auth/login...");const E=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S,password:I})}),z=await E.json();if(!E.ok){if(E.status===403&&z.requireEmailVerification){const q=new Error(z.message||"يجب التحقق من البريد الإلكتروني أولاً");throw q.requireEmailVerification=!0,q.userId=z.data?.userId,q.email=z.data?.email,q}throw new Error(z.message||"فشل تسجيل الدخول")}const w=z.data?.user||z.user,v=z.data?.tokens?.accessToken||z.data?.accessToken||z.tokens?.accessToken||z.accessToken||z.token,D=z.data?.tokens?.refreshToken||z.data?.refreshToken||z.tokens?.refreshToken||z.refreshToken;if(console.log("🔍 [AuthProvider.login] فحص البيانات المستخرجة:",{hasUserData:!!w,hasToken:!!v,hasRefreshToken:!!D,userDetails:w?{id:w.id,email:w.email,name:w.name}:"none"}),!w)throw console.error("❌ [AuthProvider.login] بيانات المستخدم مفقودة:",{userData:w,dataStructure:z,possibleUserPaths:["data.user","user"]}),new Error("بيانات المستخدم مفقودة من استجابة الخادم");if(!v)throw console.error("❌ [AuthProvider.login] الرمز المميز مفقود:",{hasToken:!!v,dataStructure:z,possibleTokenPaths:["data.accessToken","tokens.accessToken","accessToken"]}),new Error("الرمز المميز مفقود من استجابة الخادم");const V={id:w.id,email:w.email,name:w.name||`${w.firstName||""} ${w.lastName||""}`.trim()||w.email,role:w.role||"admin",mfaEnabled:w.mfaEnabled||!1,emailVerified:w.emailVerified||!0};if(console.log("👤 [AuthProvider.login] إعداد بيانات المستخدم:",V),console.log("👤 [AuthProvider.login] التحقق من صحة البيانات:",{hasId:!!V.id,hasEmail:!!V.email,hasName:!!V.name,hasRole:!!V.role}),!V.id||!V.email)throw console.error("❌ [AuthProvider.login] بيانات المستخدم الأساسية مفقودة:",V),new Error("بيانات المستخدم الأساسية مفقودة (ID أو البريد الإلكتروني)");console.log("💾 [AuthProvider.login] بدء حفظ البيانات..."),console.log("💾 [AuthProvider.login] محاولة تعيين المستخدم في الحالة:",V),r(V),console.log("✅ [AuthProvider.login] تم تعيين المستخدم في الحالة بنجاح"),console.log("🔍 [AuthProvider.login] التحقق من حالة المستخدم بعد التعيين:",{userSet:!!V,isAuthenticatedNow:!!V,userId:V?.id,userEmail:V?.email});try{const q=JSON.stringify(V);console.log("💾 [AuthProvider.login] محاولة حفظ بيانات المستخدم:",{userJsonLength:q.length,userJson:q.substring(0,100)+"..."}),localStorage.setItem("user",q),console.log("✅ [AuthProvider.login] تم حفظ بيانات المستخدم في localStorage بنجاح")}catch(q){throw console.error("❌ [AuthProvider.login] فشل حفظ المستخدم في localStorage:",q),new Error("فشل في حفظ بيانات المستخدم محلياً")}try{console.log("💾 [AuthProvider.login] محاولة حفظ الرمز المميز:",{tokenLength:v?.length||0,tokenPreview:v?v.substring(0,20)+"...":"فارغ"}),localStorage.setItem("accessToken",v),console.log("✅ [AuthProvider.login] تم حفظ الرمز المميز بنجاح")}catch(q){throw console.error("❌ [AuthProvider.login] فشل حفظ الرمز في localStorage:",q),new Error("فشل في حفظ الرمز المميز محلياً")}D&&(localStorage.setItem("refreshToken",D),console.log("✅ [AuthProvider.login] تم حفظ رمز التجديد")),console.log("💾 [AuthProvider.login] تم حفظ جميع البيانات بنجاح");const X=localStorage.getItem("user"),C=localStorage.getItem("accessToken");console.log("🔍 [AuthProvider.login] تأكيد الحفظ:",{userSaved:!!X,tokenSaved:!!C,userInState:!!V}),console.log("🔄 [AuthProvider.login] تحديث cache queries"),i.invalidateQueries(),console.log("🎉 [AuthProvider.login] اكتمل تسجيل الدخول بنجاح"),console.log("🔄 [AuthProvider.login] إجبار تحديث حالة المصادقة..."),setTimeout(()=>{console.log("✅ [AuthProvider.login] تم تأكيد حالة المصادقة:",{isAuthenticated:!!V,userId:V?.id,userEmail:V?.email})},100)}catch(E){console.error("❌ [AuthProvider.login] خطأ في تسجيل الدخول:",E),console.error("🚨 [AuthProvider.login] تفاصيل الخطأ الشامل:",{errorType:typeof E,errorName:E instanceof Error?E.name:"Unknown",errorMessage:E instanceof Error?E.message:String(E),errorStack:E instanceof Error?E.stack:"No stack trace",timestamp:new Date().toISOString()}),console.error("❌ [AuthProvider.login] تفاصيل الخطأ:",{message:E instanceof Error?E.message:String(E),stack:E instanceof Error?E.stack:void 0,name:E instanceof Error?E.name:"UnknownError"});const z=E instanceof Error?E.message:String(E);throw z&&z.includes("غير مكتملة")||z&&z.includes("مفقود")?E:new Error("حدث خطأ أثناء تسجيل الدخول، يرجى المحاولة مرة أخرى")}},p=async()=>{try{console.log("🚪 [AuthProvider.logout] بدء عملية تسجيل الخروج...");const S=localStorage.getItem("accessToken");if(S){console.log("📤 [AuthProvider.logout] إرسال طلب logout للخادم...");const I=await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${S}`}});if(I.ok){const E=await I.json();console.log("✅ [AuthProvider.logout] استجابة logout من الخادم:",E)}else console.warn("⚠️ [AuthProvider.logout] فشل في logout من الخادم، سنتابع التنظيف المحلي")}else console.log("ℹ️ [AuthProvider.logout] لا يوجد access token، التنظيف المحلي فقط")}catch(S){console.error("❌ [AuthProvider.logout] خطأ في تسجيل الخروج:",S),console.warn("⚠️ [AuthProvider.logout] سنتابع التنظيف المحلي رغم الخطأ")}finally{console.log("🧹 [AuthProvider.logout] بدء التنظيف المحلي..."),r(null),console.log("✅ [AuthProvider.logout] تم مسح بيانات المستخدم من الحالة"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),console.log("✅ [AuthProvider.logout] تم مسح جميع البيانات من localStorage"),i.clear(),console.log("✅ [AuthProvider.logout] تم مسح cache"),console.log("🎉 [AuthProvider.logout] اكتمل تسجيل الخروج بنجاح")}},[k,g]=f.useState(0),[b,j]=f.useState(!1),y=S=>new Promise(I=>setTimeout(I,S)),M=S=>Math.min(100*Math.pow(2,S),5e3),N=async(S=!1)=>{if(console.log("🔄 [AuthProvider.refreshToken] بدء عملية تجديد الرمز..."),b&&!S){for(console.log("⏳ [AuthProvider.refreshToken] تجديد جارٍ بالفعل، انتظار...");b;)await y(100);return localStorage.getItem("accessToken")!==null}j(!0);const I=Date.now();try{const E=localStorage.getItem("refreshToken");if(!E)return console.log("❌ [AuthProvider.refreshToken] لا يوجد refresh token"),!1;const z=3;for(let v=0;v<z;v++){const D=Date.now();console.log(`🔄 [AuthProvider.refreshToken] محاولة ${v+1}/${z}...`);try{const V=new AbortController,X=setTimeout(()=>{V.abort(),console.log(`⏰ [AuthProvider.refreshToken] timeout للمحاولة ${v+1}`)},1e4),C=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:E}),signal:V.signal});clearTimeout(X);const q=Date.now()-D;console.log(`📊 [AuthProvider.refreshToken] محاولة ${v+1} استغرقت ${q}ms`);const ue=await C.text();let R;try{R=JSON.parse(ue)}catch{console.log("❌ [AuthProvider.refreshToken] فشل parsing JSON:",ue),R={success:!1,message:ue}}if(C.ok&&R.success&&R.tokens){console.log("📦 [AuthProvider.refreshToken] استجابة ناجحة:",{success:R.success,hasTokens:!!R.tokens}),localStorage.setItem("accessToken",R.tokens.accessToken),localStorage.setItem("refreshToken",R.tokens.refreshToken),g(0);const fe=Date.now()-I;return console.log(`✅ [AuthProvider.refreshToken] نجح التجديد في ${fe}ms بعد ${v+1} محاولة`),!0}else console.log(`❌ [AuthProvider.refreshToken] فشل ${C.status}:`,R.message||ue);if(C.status===401||C.status===403){console.log("🚫 [AuthProvider.refreshToken] refresh token منتهي الصلاحية - لا فائدة من إعادة المحاولة");break}}catch(V){const X=Date.now()-D;V instanceof Error?V.name==="AbortError"?console.log(`⏰ [AuthProvider.refreshToken] timeout في المحاولة ${v+1} بعد ${X}ms`):console.log(`🌐 [AuthProvider.refreshToken] خطأ شبكة في المحاولة ${v+1}:`,V.message):console.log(`❓ [AuthProvider.refreshToken] خطأ غير معروف في المحاولة ${v+1}:`,V)}if(v<z-1){const V=M(v);console.log(`⏰ [AuthProvider.refreshToken] انتظار ${V}ms قبل المحاولة التالية...`),await y(V)}}g(v=>v+1);const w=Date.now()-I;return console.log(`❌ [AuthProvider.refreshToken] فشل التجديد نهائياً بعد ${w}ms و${z} محاولات`),!1}catch(E){const z=Date.now()-I;return console.error(`💥 [AuthProvider.refreshToken] خطأ عام بعد ${z}ms:`,E),g(w=>w+1),!1}finally{j(!1)}},T={user:s,isAuthenticated:o,isLoading:a,login:x,logout:p,refreshToken:N,getAccessToken:l,getRefreshToken:u};return f.useEffect(()=>{Au({getAccessToken:l,refreshToken:N,logout:p})},[]),e.jsx(Ov.Provider,{value:T,children:t})}const Sr=TC,Lv=f.createContext({}),ut=({...t})=>e.jsx(Lv.Provider,{value:{name:t.name},children:e.jsx(CC,{...t})}),il=()=>{const t=f.useContext(Lv),s=f.useContext(zv),{getFieldState:r,formState:a}=rl(),n=r(t.name,a);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:i}=s;return{id:i,name:t.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},zv=f.createContext({}),ot=f.forwardRef(({className:t,...s},r)=>{const a=f.useId();return e.jsx(zv.Provider,{value:{id:a},children:e.jsx("div",{ref:r,className:de("space-y-2",t),...s})})});ot.displayName="FormItem";const rt=f.forwardRef(({className:t,...s},r)=>{const{error:a,formItemId:n}=il();return e.jsx(re,{ref:r,className:de(a&&"text-destructive",t),htmlFor:n,...s})});rt.displayName="FormLabel";const lt=f.forwardRef(({...t},s)=>{const{error:r,formItemId:a,formDescriptionId:n,formMessageId:i}=il();return e.jsx(zg,{ref:s,id:a,"aria-describedby":r?`${n} ${i}`:`${n}`,"aria-invalid":!!r,...t})});lt.displayName="FormControl";const gi=f.forwardRef(({className:t,...s},r)=>{const{formDescriptionId:a}=il();return e.jsx("p",{ref:r,id:a,className:de("text-sm text-muted-foreground",t),...s})});gi.displayName="FormDescription";const ct=f.forwardRef(({className:t,children:s,...r},a)=>{const{error:n,formMessageId:i}=il(),o=n?String(n?.message??""):s;return o?e.jsx("p",{ref:a,id:i,className:de("text-sm font-medium text-destructive",t),...r,children:o}):null});ct.displayName="FormMessage";var Wl="rovingFocusGroup.onEntryFocus",GP={bubbles:!1,cancelable:!0},$i="RovingFocusGroup",[Ac,Bv,HP]=Qg($i),[QP,bn]=Os($i,[HP]),[XP,ZP]=QP($i),qv=f.forwardRef((t,s)=>e.jsx(Ac.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Ac.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(YP,{...t,ref:s})})}));qv.displayName=$i;var YP=f.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:r,orientation:a,loop:n=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:u,onEntryFocus:d,preventScrollOnEntryFocus:c=!1,...m}=t,h=f.useRef(null),x=Pt(s,h),p=Si(i),[k,g]=Ma({prop:o,defaultProp:l??null,onChange:u,caller:$i}),[b,j]=f.useState(!1),y=mr(d),M=Bv(r),N=f.useRef(!1),[T,S]=f.useState(0);return f.useEffect(()=>{const I=h.current;if(I)return I.addEventListener(Wl,y),()=>I.removeEventListener(Wl,y)},[y]),e.jsx(XP,{scope:r,orientation:a,dir:p,loop:n,currentTabStopId:k,onItemFocus:f.useCallback(I=>g(I),[g]),onItemShiftTab:f.useCallback(()=>j(!0),[]),onFocusableItemAdd:f.useCallback(()=>S(I=>I+1),[]),onFocusableItemRemove:f.useCallback(()=>S(I=>I-1),[]),children:e.jsx(xt.div,{tabIndex:b||T===0?-1:0,"data-orientation":a,...m,ref:x,style:{outline:"none",...t.style},onMouseDown:Te(t.onMouseDown,()=>{N.current=!0}),onFocus:Te(t.onFocus,I=>{const E=!N.current;if(I.target===I.currentTarget&&E&&!b){const z=new CustomEvent(Wl,GP);if(I.currentTarget.dispatchEvent(z),!z.defaultPrevented){const w=M().filter(C=>C.focusable),v=w.find(C=>C.active),D=w.find(C=>C.id===k),X=[v,D,...w].filter(Boolean).map(C=>C.ref.current);Kv(X,c)}}N.current=!1}),onBlur:Te(t.onBlur,()=>j(!1))})})}),Uv="RovingFocusGroupItem",Wv=f.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:n=!1,tabStopId:i,children:o,...l}=t,u=Hn(),d=i||u,c=ZP(Uv,r),m=c.currentTabStopId===d,h=Bv(r),{onFocusableItemAdd:x,onFocusableItemRemove:p,currentTabStopId:k}=c;return f.useEffect(()=>{if(a)return x(),()=>p()},[a,x,p]),e.jsx(Ac.ItemSlot,{scope:r,id:d,focusable:a,active:n,children:e.jsx(xt.span,{tabIndex:m?0:-1,"data-orientation":c.orientation,...l,ref:s,onMouseDown:Te(t.onMouseDown,g=>{a?c.onItemFocus(d):g.preventDefault()}),onFocus:Te(t.onFocus,()=>c.onItemFocus(d)),onKeyDown:Te(t.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){c.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const b=t4(g,c.orientation,c.dir);if(b!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let y=h().filter(M=>M.focusable).map(M=>M.ref.current);if(b==="last")y.reverse();else if(b==="prev"||b==="next"){b==="prev"&&y.reverse();const M=y.indexOf(g.currentTarget);y=c.loop?s4(y,M+1):y.slice(M+1)}setTimeout(()=>Kv(y))}}),children:typeof o=="function"?o({isCurrentTabStop:m,hasTabStop:k!=null}):o})})});Wv.displayName=Uv;var JP={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function e4(t,s){return s!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function t4(t,s,r){const a=e4(t.key,r);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return JP[a]}function Kv(t,s=!1){const r=document.activeElement;for(const a of t)if(a===r||(a.focus({preventScroll:s}),document.activeElement!==r))return}function s4(t,s){return t.map((r,a)=>t[(s+a)%t.length])}var zd=qv,Bd=Wv,ol="Tabs",[r4]=Os(ol,[bn]),Gv=bn(),[a4,qd]=r4(ol),Hv=f.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,onValueChange:n,defaultValue:i,orientation:o="horizontal",dir:l,activationMode:u="automatic",...d}=t,c=Si(l),[m,h]=Ma({prop:a,onChange:n,defaultProp:i??"",caller:ol});return e.jsx(a4,{scope:r,baseId:Hn(),value:m,onValueChange:h,orientation:o,dir:c,activationMode:u,children:e.jsx(xt.div,{dir:c,"data-orientation":o,...d,ref:s})})});Hv.displayName=ol;var Qv="TabsList",Xv=f.forwardRef((t,s)=>{const{__scopeTabs:r,loop:a=!0,...n}=t,i=qd(Qv,r),o=Gv(r);return e.jsx(zd,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:a,children:e.jsx(xt.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:s})})});Xv.displayName=Qv;var Zv="TabsTrigger",Yv=f.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,disabled:n=!1,...i}=t,o=qd(Zv,r),l=Gv(r),u=tb(o.baseId,a),d=sb(o.baseId,a),c=a===o.value;return e.jsx(Bd,{asChild:!0,...l,focusable:!n,active:c,children:e.jsx(xt.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":d,"data-state":c?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:u,...i,ref:s,onMouseDown:Te(t.onMouseDown,m=>{!n&&m.button===0&&m.ctrlKey===!1?o.onValueChange(a):m.preventDefault()}),onKeyDown:Te(t.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&o.onValueChange(a)}),onFocus:Te(t.onFocus,()=>{const m=o.activationMode!=="manual";!c&&!n&&m&&o.onValueChange(a)})})})});Yv.displayName=Zv;var Jv="TabsContent",eb=f.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,forceMount:n,children:i,...o}=t,l=qd(Jv,r),u=tb(l.baseId,a),d=sb(l.baseId,a),c=a===l.value,m=f.useRef(c);return f.useEffect(()=>{const h=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(h)},[]),e.jsx(Cs,{present:n||c,children:({present:h})=>e.jsx(xt.div,{"data-state":c?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":u,hidden:!h,id:d,tabIndex:0,...o,ref:s,style:{...t.style,animationDuration:m.current?"0s":void 0},children:h&&i})})});eb.displayName=Jv;function tb(t,s){return`${t}-trigger-${s}`}function sb(t,s){return`${t}-content-${s}`}var n4=Hv,rb=Xv,ab=Yv,nb=eb;const Vi=n4,jn=f.forwardRef(({className:t,...s},r)=>e.jsx(rb,{ref:r,className:de("inline-flex h-12 items-center justify-center rounded-xl bg-gradient-to-r from-gray-100 to-gray-50 p-1.5 text-muted-foreground shadow-inner backdrop-blur-sm border border-gray-200/50","dark:from-gray-800 dark:to-gray-900 dark:border-gray-700/50","transition-all duration-300 ease-in-out",t),...s}));jn.displayName=rb.displayName;const hs=f.forwardRef(({className:t,children:s,...r},a)=>e.jsx(ab,{ref:a,className:de("relative inline-flex items-center justify-center whitespace-nowrap rounded-lg px-4 py-2.5 text-sm font-medium ring-offset-background transition-all duration-300 ease-in-out","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","hover:bg-white/80 hover:text-foreground hover:shadow-sm hover:scale-105","data-[state=active]:bg-white data-[state=active]:text-foreground data-[state=active]:shadow-lg data-[state=active]:shadow-blue-500/20","data-[state=active]:border data-[state=active]:border-blue-200/50","dark:hover:bg-gray-700/80 dark:data-[state=active]:bg-gray-700 dark:data-[state=active]:border-gray-600/50","before:absolute before:inset-0 before:rounded-lg before:bg-gradient-to-r before:from-blue-500/0 before:to-purple-500/0","data-[state=active]:before:from-blue-500/10 data-[state=active]:before:to-purple-500/10","transform-gpu backface-visibility-hidden",t),...r,children:e.jsx(Ut.span,{initial:{opacity:0,y:-2},animate:{opacity:1,y:0},transition:{duration:.2},className:"relative z-10 flex items-center gap-2",children:s})}));hs.displayName=ab.displayName;const ls=f.forwardRef(({className:t,children:s,animationKey:r,...a},n)=>e.jsx(nb,{ref:n,className:de("mt-4 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","min-h-[200px]",t),...a,children:e.jsx(Zc,{mode:"wait",children:e.jsx(Ut.div,{initial:{opacity:0,y:10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.98},transition:{duration:.3,ease:[.4,0,.2,1]},className:"transform-gpu",children:s},r||a.value)})}));ls.displayName=nb.displayName;const wt="global-toast-overlay";function i4(){if(document.getElementById(`${wt}-styles`))return;const t=document.createElement("style");t.id=`${wt}-styles`,t.textContent=`
#${wt} {
  position: fixed;
  top: 16px;
  left: 50%;
  transform: translateX(-50%) translateY(-10px);
  z-index: 999999;
  pointer-events: none; /* allows clicks through except children that enable pointer-events */
  transition: transform 240ms ease, opacity 240ms ease;
  opacity: 0;
  will-change: transform, opacity;
  display: flex;
  gap: 8px;
  width: min(680px, calc(100% - 32px));
  max-width: 680px;
  box-sizing: border-box;
  direction: rtl; /* for Arabic */
}
#${wt}.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}
.${wt}-card {
  pointer-events: auto;
  background: #111827; /* near-black */
  color: white;
  border-radius: 12px;
  padding: 12px 14px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  overflow: hidden;
  touch-action: pan-y;
  font-family: 'Cairo', -apple-system, BlinkMacSystemFont, sans-serif;
}
.${wt}-card.error {
  background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
}
.${wt}-card.success {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
}
.${wt}-card.warning {
  background: linear-gradient(135deg, #d97706 0%, #92400e 100%);
}
.${wt}-content {
  flex: 1;
}
.${wt}-title {
  font-weight: 600;
  margin: 0 0 4px 0;
  font-size: 14px;
}
.${wt}-message {
  margin: 0;
  font-size: 13px;
  opacity: 0.92;
  line-height: 1.4;
}
.${wt}-close {
  background: transparent;
  border: none;
  color: rgba(255,255,255,0.9);
  font-size: 18px;
  cursor: pointer;
  padding: 6px;
  border-radius: 8px;
  margin-right: 4px;
}
.${wt}-close:hover {
  background: rgba(255,255,255,0.1);
}
.${wt}-close:active { transform: scale(0.98); }
.${wt}-swipe {
  transition: transform 180ms ease, opacity 180ms ease;
  will-change: transform, opacity;
}
@media (prefers-reduced-motion: reduce) {
  #${wt}, .${wt}-swipe { transition: none; }
}
@media (max-width: 640px) {
  #${wt} {
    top: 8px;
    width: calc(100% - 16px);
  }
  .${wt}-card {
    padding: 16px 12px;
  }
  .${wt}-title {
    font-size: 15px;
  }
  .${wt}-message {
    font-size: 14px;
  }
}
`,document.head.appendChild(t)}function o4(){let t=document.getElementById(wt);return t||(t=document.createElement("div"),t.id=wt,t.setAttribute("aria-live","polite"),t.setAttribute("role","status"),document.body.appendChild(t)),t}function l4(t){i4();const{title:s,message:r,duration:a=4e3,variant:n="default"}=t,i=o4(),o=document.createElement("div");o.className=`${wt}-swipe`;const l=document.createElement("div");l.className=`${wt}-card`,n!=="default"&&l.classList.add(n),l.setAttribute("role","region"),l.setAttribute("aria-label",s??"إشعار");const u=document.createElement("div");if(u.className=`${wt}-content`,s){const S=document.createElement("p");S.className=`${wt}-title`,S.textContent=s,u.appendChild(S)}const d=document.createElement("p");d.className=`${wt}-message`,d.textContent=r,u.appendChild(d);const c=document.createElement("button");c.className=`${wt}-close`,c.innerHTML="&times;",c.setAttribute("aria-label","إغلاق الإشعار"),l.appendChild(u),l.appendChild(c),o.appendChild(l),i.appendChild(o),requestAnimationFrame(()=>{i.classList.add("show")});let m=window.setTimeout(()=>x(),a);function h(){m&&(clearTimeout(m),m=null),i.classList.remove("show"),setTimeout(()=>{try{o.remove(),i&&i.children.length===0&&i.remove()}catch{}},220),c.removeEventListener("click",p),l.removeEventListener("keydown",k),l.removeEventListener("touchstart",M),l.removeEventListener("touchmove",N),l.removeEventListener("touchend",T)}function x(){h()}function p(S){S.stopPropagation(),x()}c.addEventListener("click",p);function k(S){S.key==="Escape"&&x()}l.addEventListener("keydown",k),l.setAttribute("tabindex","0");let g=0,b=0,j=0;const y=60;function M(S){S.touches.length===1&&(g=S.touches[0].clientY,b=S.touches[0].clientX,j=0,m&&(clearTimeout(m),m=null))}function N(S){if(S.touches.length!==1)return;const I=S.touches[0].clientY-g;S.touches[0].clientX-b,j=I;const E=`translateY(${j}px)`;o.style.transform=E;const z=Math.max(0,1-Math.abs(j)/200);o.style.opacity=String(z),S.preventDefault()}function T(S){if(Math.abs(j)>y){const I=j<0?-1:1;o.style.transition="transform 180ms ease, opacity 180ms ease",o.style.transform=`translateY(${I*120}px)`,o.style.opacity="0",setTimeout(x,160);return}o.style.transition="transform 180ms ease, opacity 180ms ease",o.style.transform="",o.style.opacity="",m=window.setTimeout(()=>x(),a),setTimeout(()=>{o.style.transition=""},200)}return l.addEventListener("touchstart",M,{passive:!0}),l.addEventListener("touchmove",N,{passive:!1}),l.addEventListener("touchend",T),{dismiss:x}}const c4=Qr({email:De().email("بريد إلكتروني غير صالح").min(1,"البريد الإلكتروني مطلوب"),password:De().min(1,"كلمة المرور مطلوبة"),totpCode:De().optional()}),d4=Qr({name:De().min(2,"الاسم يجب أن يكون حرفين على الأقل").max(50,"الاسم طويل جداً"),email:De().email("بريد إلكتروني غير صالح").min(1,"البريد الإلكتروني مطلوب"),phone:De().min(9,"رقم الهاتف غير صحيح").optional(),password:De().min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"كلمة المرور يجب أن تحتوي على حروف كبيرة وصغيرة وأرقام"),confirmPassword:De().min(1,"تأكيد كلمة المرور مطلوب")}).refine(t=>t.password===t.confirmPassword,{message:"كلمات المرور غير متطابقة",path:["confirmPassword"]}),u4=Qr({email:De().email("بريد إلكتروني غير صالح").min(1,"البريد الإلكتروني مطلوب")}),m4=()=>e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-32 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-purple-600/20 rounded-full blur-3xl animate-blob"}),e.jsx("div",{className:"absolute -bottom-32 -left-40 w-96 h-96 bg-gradient-to-tr from-green-400/20 to-blue-600/20 rounded-full blur-3xl animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gradient-to-r from-purple-400/20 to-pink-600/20 rounded-full blur-3xl animate-blob animation-delay-4000"})]}),h4=()=>e.jsxs("div",{className:"flex flex-col items-center space-y-4 mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full blur-lg opacity-75 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-r from-blue-600 to-purple-600 rounded-full p-4",children:e.jsx(fs,{className:"w-12 h-12 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"نظام إدارة المشاريع"}),e.jsx("p",{className:"text-lg text-gray-600 mt-2",children:"الحل الشامل لإدارة المشاريع الإنشائية"})]})]});function _c(){const[,t]=or(),{toast:s}=Dt();Gt();const{login:r}=Ra(),[a,n]=f.useState("login"),[i,o]=f.useState(!1),[l,u]=f.useState(!1),[d,c]=f.useState("credentials"),m=wr({resolver:kr(c4),defaultValues:{email:"",password:"",totpCode:""}}),h=wr({resolver:kr(d4),defaultValues:{name:"",email:"",phone:"",password:"",confirmPassword:""}}),x=wr({resolver:kr(u4),defaultValues:{email:""}}),p=Ae({mutationFn:async S=>{console.log("🚀 [AuthPage.loginMutation] بدء عملية تسجيل الدخول:",{email:S.email,hasPassword:!!S.password,timestamp:new Date().toISOString()});try{const I=await r(S.email,S.password);return console.log("✅ [AuthPage.loginMutation] تمت عملية login بنجاح:",I),I}catch(I){throw console.error("❌ [AuthPage.loginMutation] خطأ في login:",I),I}},onSuccess:S=>{console.log("🎉 [AuthPage.loginMutation] نجح تسجيل الدخول:",S);const I=S?.data?.user?.name||S?.user?.name;s({title:`أهلاً وسهلاً ${I||"بك"}!`,description:"تم تسجيل الدخول بنجاح. مرحباً بعودتك إلى نظام إدارة المشاريع"}),setTimeout(()=>{t("/"),setTimeout(()=>{window.location.pathname==="/login"&&(window.location.href="/")},1e3)},500)},onError:S=>{if(console.error("❌ [AuthPage.loginMutation] فشل تسجيل الدخول:",S),console.error("❌ [AuthPage.loginMutation] تفاصيل الخطأ:",{status:S?.status,message:S?.message,response:S?.response,data:S?.data}),S?.status===403||S?.message?.includes("requireEmailVerification")||S?.message?.includes("يجب تأكيد البريد")||S?.message?.includes("يجب التحقق من بريدك الإلكتروني")||S?.response?.data?.requireEmailVerification||S?.response?.status===403||S?.data?.requireEmailVerification){const E=S?.data||S?.response?.data,z=E?.data?.userId||E?.userId,w=E?.data?.email||E?.email;l4({title:"البريد الإلكتروني غير مفعل",message:"يجب التحقق من بريدك الإلكتروني أولاً. تم إرسال رمز تحقق جديد.",variant:"error",duration:5e3}),setTimeout(()=>{if(z&&w)t(`/verify-email?userId=${z}&email=${encodeURIComponent(w)}`);else{const v=m.getValues("email");v&&t(`/verify-email?email=${encodeURIComponent(v)}`)}},3e3);return}s({title:"فشل تسجيل الدخول",description:S.message||"حدث خطأ أثناء الاتصال بالخادم",variant:"destructive"})}}),k=Ae({mutationFn:async S=>{const I=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:S.name,email:S.email,phone:S.phone,password:S.password})});if(!I.ok&&I.status!==201&&I.status!==202)throw new Error(`خطأ في الشبكة: ${I.status}`);return I.json()},onSuccess:S=>{if(console.log("✅ [RegisterMutation] استجابة التسجيل:",S),S.success)if(s({title:"تم إنشاء الحساب بنجاح",description:"يرجى التحقق من بريدك الإلكتروني لتفعيل الحساب"}),S.user?.id&&S.user?.email){const I=S.user.id,E=S.user.email;console.log("🔄 [RegisterMutation] التوجيه إلى صفحة التحقق:",{userId:I,userEmail:E}),setTimeout(()=>{t(`/verify-email?userId=${I}&email=${encodeURIComponent(E)}`)},1500)}else if(S.data?.user?.id&&S.data?.user?.email){const I=S.data.user.id,E=S.data.user.email;console.log("🔄 [RegisterMutation] التوجيه إلى صفحة التحقق (احتياطي):",{userId:I,userEmail:E}),setTimeout(()=>{t(`/verify-email?userId=${I}&email=${encodeURIComponent(E)}`)},1500)}else console.log("⚠️ [RegisterMutation] لم يتم العثور على بيانات المستخدم للتوجيه"),n("login");else s({title:"فشل إنشاء الحساب",description:S.message,variant:"destructive"})},onError:S=>{s({title:"خطأ في إنشاء الحساب",description:"حدث خطأ أثناء الاتصال بالخادم",variant:"destructive"}),console.error("Register error:",S)}}),g=Ae({mutationFn:async S=>{const I=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)});if(!I.ok)throw new Error("فشل في إرسال طلب استرجاع كلمة المرور");return I.json()},onSuccess:()=>{s({title:"تم إرسال رابط الاسترجاع",description:"يرجى التحقق من بريدك الإلكتروني"}),n("login")},onError:S=>{s({title:"خطأ في استرجاع كلمة المرور",description:"حدث خطأ أثناء المعالجة",variant:"destructive"})}}),b=f.useCallback(S=>{const I=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return S?I.test(S)?{isValid:!0,message:"البريد الإلكتروني صحيح"}:{isValid:!1,message:"تنسيق البريد الإلكتروني غير صحيح"}:{isValid:!1,message:"البريد الإلكتروني مطلوب"}},[]),j=f.useCallback(S=>{if(!S)return{isValid:!1,message:"كلمة المرور مطلوبة"};if(S.length<8)return{isValid:!1,message:"كلمة المرور قصيرة جداً"};let I=0;return S.length>=8&&I++,/[A-Z]/.test(S)&&I++,/[a-z]/.test(S)&&I++,/\d/.test(S)&&I++,/[^A-Za-z0-9]/.test(S)&&I++,{isValid:!0,message:"كلمة المرور قوية",strength:Math.min(I,4)}},[]),y=S=>{console.log("🚀 [AuthPage.onLoginSubmit] تسجيل دخول:",{email:S.email,hasPassword:!!S.password,timestamp:new Date().toISOString()}),p.mutate(S)},M=S=>{k.mutate(S)},N=S=>{g.mutate(S)},T=()=>{console.log("🎯 [AuthPage.QuickLogin] الضغط على زر الدخول السريع"),m.setValue("email","test@demo.local"),m.setValue("password","testpassword"),setTimeout(()=>{const S=m.getValues();y(S)},100)};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",dir:"rtl",children:[e.jsx(m4,{}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/80 via-white/90 to-purple-50/80 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-10 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsx(h4,{}),e.jsxs(ee,{className:"glass-morphism border-0 shadow-2xl backdrop-blur-xl",children:[e.jsxs(He,{className:"space-y-1 text-center pb-8",children:[e.jsx(et,{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"مرحباً بك"}),e.jsx(br,{className:"text-gray-600",children:"اختر العملية المطلوبة من الأسفل"})]}),e.jsx(oe,{className:"space-y-6",children:e.jsxs(Vi,{value:a,onValueChange:S=>n(S),className:"w-full",children:[e.jsxs(jn,{className:"grid w-full grid-cols-2 glass-tabs gap-2",children:[e.jsxs(hs,{value:"login",className:"flex items-center gap-2 tab-trigger px-6 py-3",children:[e.jsx(fs,{className:"w-4 h-4"}),"تسجيل الدخول"]}),e.jsxs(hs,{value:"register",className:"flex items-center gap-2 tab-trigger px-6 py-3",children:[e.jsx(Fu,{className:"w-4 h-4"}),"حساب جديد"]})]}),e.jsx(ls,{value:"login",className:"space-y-4 tab-content",children:e.jsx(Sr,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(y),className:"space-y-4",children:[d==="credentials"&&e.jsxs(e.Fragment,{children:[e.jsx(ut,{control:m.control,name:"email",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"البريد الإلكتروني"}),e.jsx(lt,{children:e.jsx(je,{...S,type:"email",placeholder:"admin@example.com",leftIcon:e.jsx(En,{className:"h-4 w-4"}),validator:b,fieldType:"email",validationContext:"login",showValidation:!0,enableMemory:!0,memoryKey:"login-email",className:"enhanced-input","data-testid":"input-email"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:m.control,name:"password",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"كلمة المرور"}),e.jsx(lt,{children:e.jsx(je,{...S,type:"password",placeholder:"كلمة المرور",validator:j,fieldType:"password",showValidation:!1,enableMemory:!0,memoryKey:"login-password",className:"enhanced-input","data-testid":"input-password"})}),e.jsx(ct,{})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"remember-me",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"remember-me",className:"text-sm text-gray-600",children:"تذكرني"})]}),e.jsx("button",{type:"button",onClick:()=>n("forgot"),className:"text-sm text-blue-600 hover:text-blue-500 cursor-pointer transition-colors duration-200",children:"نسيت كلمة المرور؟"})]})]}),d==="mfa"&&e.jsx(ut,{control:m.control,name:"totpCode",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"رمز التحقق الثنائي"}),e.jsx(lt,{children:e.jsx(je,{...S,type:"text",placeholder:"000000",maxLength:6,className:"text-center text-2xl tracking-widest enhanced-input","data-testid":"input-totp-code"})}),e.jsx(ct,{}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"أدخل الرمز من تطبيق المصادقة"})]})}),e.jsxs(K,{type:"submit",loading:p.isPending,loadingText:"جارِ تسجيل الدخول...",enableRateLimit:!0,rateLimitDelay:2e3,className:"w-full","data-testid":"button-login",children:[e.jsx(ba,{className:"ml-2 h-4 w-4"}),d==="credentials"&&"تسجيل الدخول",d==="mfa"&&"تأكيد الرمز"]}),d==="credentials"&&e.jsxs(K,{type:"button",variant:"outline",className:"w-full mt-2",onClick:T,loading:p.isPending,enableRateLimit:!0,"data-testid":"button-quick-login",children:[e.jsx(D2,{className:"ml-2 h-4 w-4"}),"تسجيل دخول سريع (تجريبي)"]})]})})}),e.jsx(ls,{value:"register",className:"space-y-4 tab-content",children:e.jsx(Sr,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(M),className:"space-y-4",children:[e.jsx(ut,{control:h.control,name:"name",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"الاسم الكامل"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(Hs,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(je,{...S,type:"text",placeholder:"أحمد محمد",className:"pr-10 enhanced-input","data-testid":"input-name"})]})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"email",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"البريد الإلكتروني"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(En,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(je,{...S,type:"email",placeholder:"ahmed@example.com",className:"pr-10 enhanced-input",validator:b,fieldType:"email",validationContext:"register",showValidation:!0,"data-testid":"input-email"})]})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"phone",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"رقم الهاتف (اختياري)"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(Ko,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(je,{...S,type:"tel",placeholder:"771234567",className:"pr-10 enhanced-input","data-testid":"input-phone"})]})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"password",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"كلمة المرور"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(je,{...S,type:i?"text":"password",placeholder:"كلمة المرور",className:"pl-10 enhanced-input",validator:j,fieldType:"password",showValidation:!0,strengthIndicator:!0,"data-testid":"input-password"}),e.jsx("button",{type:"button",onClick:()=>o(!i),className:"absolute left-3 top-3 h-4 w-4 text-gray-400 hover:text-gray-600 transition-colors","data-testid":"button-toggle-password",children:i?e.jsx(Xn,{}):e.jsx(Wr,{})})]})}),e.jsx(ct,{}),e.jsx("p",{className:"text-xs text-gray-500",children:"يجب أن تحتوي على 8 أحرف، حروف كبيرة وصغيرة، وأرقام"})]})}),e.jsx(ut,{control:h.control,name:"confirmPassword",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"تأكيد كلمة المرور"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(je,{...S,type:l?"text":"password",placeholder:"تأكيد كلمة المرور",className:"pl-10 enhanced-input","data-testid":"input-confirm-password"}),e.jsx("button",{type:"button",onClick:()=>u(!l),className:"absolute left-3 top-3 h-4 w-4 text-gray-400 hover:text-gray-600 transition-colors","data-testid":"button-toggle-confirm-password",children:l?e.jsx(Xn,{}):e.jsx(Wr,{})})]})}),e.jsx(ct,{})]})}),e.jsx(K,{type:"submit",className:"w-full enhanced-button",disabled:k.isPending,"data-testid":"button-register",children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"ml-2 h-4 w-4 animate-spin"}),"جارِ إنشاء الحساب..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fu,{className:"ml-2 h-4 w-4"}),"إنشاء حساب جديد"]})})]})})}),e.jsxs(ls,{value:"forgot",className:"space-y-4 tab-content",children:[e.jsxs("div",{className:"text-center space-y-2 mb-4",children:[e.jsx(Jl,{className:"w-12 h-12 text-blue-500 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"استرجاع كلمة المرور"}),e.jsx("p",{className:"text-sm text-gray-600",children:"أدخل بريدك الإلكتروني وسنرسل لك رابط لإعادة تعيين كلمة المرور"})]}),e.jsx(Sr,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(N),className:"space-y-4",children:[e.jsx(ut,{control:x.control,name:"email",render:({field:S})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"البريد الإلكتروني"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(En,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx(je,{...S,type:"email",placeholder:"أدخل بريدك الإلكتروني",className:"pr-10 enhanced-input",validator:b,fieldType:"email",showValidation:!0,"data-testid":"input-forgot-email"})]})}),e.jsx(ct,{})]})}),e.jsx(K,{type:"submit",className:"w-full enhanced-button",disabled:g.isPending,"data-testid":"button-forgot-password",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"ml-2 h-4 w-4 animate-spin"}),"جارِ الإرسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx(En,{className:"ml-2 h-4 w-4"}),"إرسال رابط الاسترجاع"]})})]})})]})]})})]}),e.jsxs("div",{className:"text-center text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:"© 2025 نظام إدارة المشاريع الإنشائية"}),e.jsx("p",{children:"جميع الحقوق محفوظة"})]})]})})]})}const f4=xn("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),da=f.forwardRef(({className:t,variant:s,...r},a)=>e.jsx("div",{ref:a,role:"alert",className:de(f4({variant:s}),t),...r}));da.displayName="Alert";const p4=f.forwardRef(({className:t,...s},r)=>e.jsx("h5",{ref:r,className:de("mb-1 font-medium leading-none tracking-tight",t),...s}));p4.displayName="AlertTitle";const ua=f.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:de("text-sm [&_p]:leading-relaxed",t),...s}));ua.displayName="AlertDescription";const x4=Qr({newPassword:De().min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"كلمة المرور يجب أن تحتوي على حروف كبيرة وصغيرة وأرقام"),confirmPassword:De().min(1,"تأكيد كلمة المرور مطلوب")}).refine(t=>t.newPassword===t.confirmPassword,{message:"كلمات المرور غير متطابقة",path:["confirmPassword"]}),Kl=()=>e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-32 w-96 h-96 bg-gradient-to-br from-red-400/20 to-pink-600/20 rounded-full blur-3xl animate-blob"}),e.jsx("div",{className:"absolute -bottom-32 -left-40 w-96 h-96 bg-gradient-to-tr from-orange-400/20 to-red-600/20 rounded-full blur-3xl animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gradient-to-r from-pink-400/20 to-purple-600/20 rounded-full blur-3xl animate-blob animation-delay-4000"})]});function ib(){const[,t]=or(),{toast:s}=Dt(),[r,a]=f.useState(!1),[n,i]=f.useState(null),[o,l]=f.useState(!1),[u,d]=f.useState(!1),[c,m]=f.useState(null),h=wr({resolver:kr(x4),defaultValues:{newPassword:"",confirmPassword:""}});f.useEffect(()=>{const b=new URLSearchParams(window.location.search).get("token");b?(i(b),m(!0)):m(!1)},[]);const x=Ae({mutationFn:async g=>{if(!n)throw new Error("رمز الاسترجاع غير موجود");const b=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,newPassword:g.newPassword})});if(!b.ok){const j=await b.json();throw new Error(j.message||"فشل في إعادة تعيين كلمة المرور")}return b.json()},onSuccess:g=>{g.success?(a(!0),s({title:"تم إعادة تعيين كلمة المرور",description:"يمكنك الآن تسجيل الدخول بكلمة المرور الجديدة"})):s({title:"فشل في إعادة تعيين كلمة المرور",description:g.message,variant:"destructive"})},onError:g=>{s({title:"خطأ في إعادة تعيين كلمة المرور",description:g.message||"حدث خطأ أثناء المعالجة",variant:"destructive"}),console.error("Reset password error:",g)}}),p=g=>{x.mutate(g)},k=({password:g})=>{const j=(()=>{if(!g)return{score:0,label:"",color:""};let y=0;g.length>=8&&y++,/[A-Z]/.test(g)&&y++,/[a-z]/.test(g)&&y++,/\d/.test(g)&&y++,/[^A-Za-z0-9]/.test(g)&&y++;const M=["ضعيفة جداً","ضعيفة","متوسطة","قوية","قوية جداً"],N=["bg-red-500","bg-orange-500","bg-yellow-500","bg-green-500","bg-emerald-500"];return{score:y,label:M[y-1]||"",color:N[y-1]||""}})();return g?e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"قوة كلمة المرور"}),e.jsx("span",{className:`text-xs font-medium ${j.score>=3?"text-green-600":"text-orange-600"}`,children:j.label})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${j.color}`,style:{width:`${j.score/5*100}%`}})})]}):null};return c===!1?e.jsxs("div",{className:"min-h-screen relative overflow-hidden",dir:"rtl",children:[e.jsx(Kl,{}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-50/80 via-white/90 to-pink-50/80 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-10 min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{className:"glass-morphism border-0 shadow-2xl backdrop-blur-xl max-w-md w-full",children:[e.jsxs(He,{className:"space-y-1 text-center pb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500 to-pink-500 rounded-full blur-lg opacity-75 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-r from-red-500 to-pink-500 rounded-full p-4",children:e.jsx(Gs,{className:"w-12 h-12 text-white"})})]})}),e.jsx(et,{className:"text-2xl font-bold text-red-700",children:"رابط غير صالح"}),e.jsx(br,{className:"text-gray-600",children:"رابط استرجاع كلمة المرور غير صالح أو منتهي الصلاحية"})]}),e.jsxs(oe,{className:"space-y-6",children:[e.jsxs(da,{className:"border-red-200 bg-red-50",children:[e.jsx(Gs,{className:"h-4 w-4 text-red-600"}),e.jsx(ua,{className:"text-red-800",children:"قد يكون الرابط منتهي الصلاحية أو تم استخدامه مسبقاً. يرجى طلب رابط جديد لاسترجاع كلمة المرور."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{onClick:()=>t("/forgot-password"),className:"w-full enhanced-button",children:[e.jsx(_l,{className:"ml-2 h-4 w-4"}),"طلب رابط جديد"]}),e.jsxs(K,{onClick:()=>t("/login"),variant:"outline",className:"w-full enhanced-outline-button",children:[e.jsx(to,{className:"ml-2 h-4 w-4"}),"العودة لتسجيل الدخول"]})]})]})]})})]}):r?e.jsxs("div",{className:"min-h-screen relative overflow-hidden",dir:"rtl",children:[e.jsx(Kl,{}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-50/80 via-white/90 to-emerald-50/80 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-10 min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{className:"glass-morphism border-0 shadow-2xl backdrop-blur-xl max-w-md w-full",children:[e.jsxs(He,{className:"space-y-1 text-center pb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full blur-lg opacity-75 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-r from-green-500 to-emerald-500 rounded-full p-4",children:e.jsx(Is,{className:"w-12 h-12 text-white"})})]})}),e.jsx(et,{className:"text-2xl font-bold text-green-700",children:"تمت بنجاح!"}),e.jsx(br,{className:"text-gray-600",children:"تم إعادة تعيين كلمة المرور بنجاح"})]}),e.jsxs(oe,{className:"space-y-6",children:[e.jsxs(da,{className:"border-green-200 bg-green-50",children:[e.jsx(Is,{className:"h-4 w-4 text-green-600"}),e.jsx(ua,{className:"text-green-800",children:"تم تحديث كلمة المرور بنجاح. يمكنك الآن تسجيل الدخول باستخدام كلمة المرور الجديدة."})]}),e.jsxs(K,{onClick:()=>t("/login"),className:"w-full enhanced-button",children:[e.jsx(to,{className:"ml-2 h-4 w-4"}),"تسجيل الدخول الآن"]})]})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",dir:"rtl",children:[e.jsx(Kl,{}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-50/80 via-white/90 to-pink-50/80 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-10 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Tu,{href:"/login",children:e.jsxs(K,{variant:"ghost",className:"text-gray-600 hover:text-gray-900",children:[e.jsx(to,{className:"ml-2 h-4 w-4"}),"العودة لتسجيل الدخول"]})})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4 mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-600 to-pink-600 rounded-full blur-lg opacity-75 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-r from-red-600 to-pink-600 rounded-full p-4",children:e.jsx(_l,{className:"w-12 h-12 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-red-600 to-pink-600 bg-clip-text text-transparent",children:"إعادة تعيين كلمة المرور"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"أدخل كلمة المرور الجديدة"})]})]}),e.jsxs(ee,{className:"glass-morphism border-0 shadow-2xl backdrop-blur-xl",children:[e.jsxs(He,{className:"space-y-1 text-center pb-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(Jl,{className:"w-16 h-16 text-red-500"})}),e.jsx(et,{className:"text-2xl font-bold text-gray-900",children:"كلمة مرور جديدة"}),e.jsx(br,{className:"text-gray-600",children:"اختر كلمة مرور قوية لحماية حسابك"})]}),e.jsxs(oe,{className:"space-y-6",children:[e.jsx(Sr,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(p),className:"space-y-4",children:[e.jsx(ut,{control:h.control,name:"newPassword",render:({field:g})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"كلمة المرور الجديدة"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(Jl,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-red-500 transition-colors"}),e.jsx(je,{...g,type:o?"text":"password",placeholder:"أدخل كلمة مرور قوية",className:"pr-10 pl-10 enhanced-input","data-testid":"input-new-password"}),e.jsx("button",{type:"button",className:"absolute left-3 top-3 h-4 w-4 text-gray-400 hover:text-gray-600",onClick:()=>l(!o),children:o?e.jsx(Xn,{}):e.jsx(Wr,{})})]})}),e.jsx(k,{password:g.value}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"confirmPassword",render:({field:g})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"تأكيد كلمة المرور"}),e.jsx(lt,{children:e.jsxs("div",{className:"relative group",children:[e.jsx(fs,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400 group-focus-within:text-red-500 transition-colors"}),e.jsx(je,{...g,type:u?"text":"password",placeholder:"أعد إدخال كلمة المرور",className:"pr-10 pl-10 enhanced-input","data-testid":"input-confirm-password"}),e.jsx("button",{type:"button",className:"absolute left-3 top-3 h-4 w-4 text-gray-400 hover:text-gray-600",onClick:()=>d(!u),children:u?e.jsx(Xn,{}):e.jsx(Wr,{})})]})}),e.jsx(ct,{})]})}),e.jsx(K,{type:"submit",className:"w-full enhanced-button",disabled:x.isPending,"data-testid":"button-reset-password",style:{background:"linear-gradient(135deg, #dc2626 0%, #ec4899 100%)"},children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"ml-2 h-4 w-4 animate-spin"}),"جارِ إعادة التعيين..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_l,{className:"ml-2 h-4 w-4"}),"إعادة تعيين كلمة المرور"]})})]})}),e.jsx("div",{className:"text-center space-y-2 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["تذكرت كلمة المرور؟"," ",e.jsx(Tu,{href:"/login",children:e.jsx("span",{className:"text-red-600 hover:text-red-500 font-medium cursor-pointer",children:"تسجيل الدخول"})})]})})]})]}),e.jsx(ee,{className:"bg-blue-50 border-blue-200",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3 rtl:space-x-reverse",children:[e.jsx(fs,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"نصائح الأمان:"}),e.jsxs("ul",{className:"mt-1 space-y-1 text-blue-700",children:[e.jsx("li",{children:"• استخدم كلمة مرور قوية ومعقدة"}),e.jsx("li",{children:"• تجنب استخدام معلومات شخصية"}),e.jsx("li",{children:"• احتفظ بكلمة المرور في مكان آمن"}),e.jsx("li",{children:"• لا تشارك كلمة المرور مع أي شخص"})]})]})]})})}),e.jsxs("div",{className:"text-center text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:"© 2025 نظام إدارة المشاريع الإنشائية"}),e.jsx("p",{children:"جميع الحقوق محفوظة"})]})]})})]})}const g4=Qr({code:De().length(6,"رمز التحقق يجب أن يكون 6 أرقام").regex(/^\d+$/,"رمز التحقق يجب أن يحتوي على أرقام فقط")}),gh=()=>e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-32 w-96 h-96 bg-gradient-to-br from-green-400/20 to-blue-600/20 rounded-full blur-3xl animate-blob"}),e.jsx("div",{className:"absolute -bottom-32 -left-40 w-96 h-96 bg-gradient-to-tr from-blue-400/20 to-purple-600/20 rounded-full blur-3xl animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gradient-to-r from-purple-400/20 to-pink-600/20 rounded-full blur-3xl animate-blob animation-delay-4000"})]});function ob(){const[,t]=or(),{toast:s}=Dt(),[r,a]=f.useState("input"),[n,i]=f.useState({}),[o,l]=f.useState(0),[u,d]=f.useState(!1);f.useEffect(()=>{const g=new URLSearchParams(window.location.search),b=g.get("userId"),j=g.get("email"),y=g.get("token");b&&j&&i({id:b,email:j}),y&&b&&(console.log("🔄 [EmailVerification] التحقق التلقائي من الرابط:",{token:y,userId:b}),m.mutate({code:y,userId:b}))},[]),f.useEffect(()=>{let g;return o>0&&(g=setTimeout(()=>l(o-1),1e3)),()=>clearTimeout(g)},[o]);const c=wr({resolver:kr(g4),defaultValues:{code:""}}),m=Ae({mutationFn:async g=>{console.log("🔍 [EmailVerification] بدء التحقق من الرمز:",{code:g.code,userId:g.userId||n.id});const b=g.userId||n.id;if(!b)throw new Error("معرف المستخدم مطلوب");const j=await fetch("/api/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:b,code:g.code})}),y=await j.json();if(!j.ok)throw new Error(y.message||"فشل التحقق من الرمز");return y},onSuccess:g=>{console.log("✅ [EmailVerification] تم التحقق بنجاح:",g),g.success?(a("verified"),s({title:"نجح التحقق! 🎉",description:g.message}),setTimeout(()=>{t("/login")},3e3)):(a("error"),s({title:"فشل التحقق",description:g.message,variant:"destructive"}))},onError:g=>{console.error("❌ [EmailVerification] خطأ في التحقق:",g),a("error"),s({title:"فشل التحقق",description:g instanceof Error?g.message:"حدث خطأ غير متوقع",variant:"destructive"})}}),h=Ae({mutationFn:async()=>{if(console.log("📧 [EmailVerification] إعادة إرسال رمز التحقق"),!n.id||!n.email)throw new Error("بيانات المستخدم مطلوبة");const g=await fetch("/api/auth/resend-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.id,email:n.email})}),b=await g.json();if(!g.ok)throw new Error(b.message||"فشل إعادة الإرسال");return b},onSuccess:g=>{console.log("✅ [EmailVerification] تم إعادة الإرسال بنجاح:",g),s({title:"تم إعادة الإرسال",description:g.message}),l(60),c.reset()},onError:g=>{console.error("❌ [EmailVerification] خطأ في إعادة الإرسال:",g),s({title:"فشل إعادة الإرسال",description:g instanceof Error?g.message:"حدث خطأ غير متوقع",variant:"destructive"})}}),x=g=>{m.mutate(g)},p=()=>{o===0&&h.mutate()},k=async()=>{const g=c.getValues("code");if(g&&g.length===6)try{await navigator.clipboard.writeText(g),d(!0),s({title:"تم النسخ!",description:"تم نسخ رمز التحقق إلى الحافظة"}),setTimeout(()=>d(!1),2e3)}catch{s({title:"فشل النسخ",description:"حدث خطأ أثناء نسخ الرمز",variant:"destructive"})}else s({title:"لا يوجد رمز للنسخ",description:"يرجى إدخال رمز التحقق أولاً",variant:"destructive"})};return r==="verified"?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center p-4 relative",children:[e.jsx(gh,{}),e.jsxs(ee,{className:"w-full max-w-md shadow-2xl border-0 bg-white/80 backdrop-blur-sm",children:[e.jsxs(He,{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto bg-gradient-to-r from-green-600 to-blue-600 rounded-full p-4 w-20 h-20 flex items-center justify-center",children:e.jsx(Is,{className:"w-10 h-10 text-white"})}),e.jsx(et,{className:"text-2xl font-bold text-green-600",children:"تم التحقق بنجاح! 🎉"}),e.jsx(br,{className:"text-lg",children:"تم تأكيد بريدك الإلكتروني بنجاح"})]}),e.jsx(oe,{className:"space-y-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"سيتم توجيهك إلى صفحة تسجيل الدخول خلال ثوانِ..."}),e.jsx(K,{onClick:()=>t("/login"),className:"w-full bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700","data-testid":"button-continue-login",children:"المتابعة إلى تسجيل الدخول"})]})})]})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4 relative",children:[e.jsx(gh,{}),e.jsxs(ee,{className:"w-full max-w-md shadow-2xl border-0 bg-white/80 backdrop-blur-sm",children:[e.jsxs(He,{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto bg-gradient-to-r from-blue-600 to-purple-600 rounded-full p-4 w-20 h-20 flex items-center justify-center",children:e.jsx(En,{className:"w-10 h-10 text-white"})}),e.jsx(et,{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"تحقق من بريدك الإلكتروني"}),e.jsx(br,{className:"text-lg",children:"أدخل رمز التحقق المرسل إلى بريدك الإلكتروني"}),n.email&&e.jsxs("p",{className:"text-sm text-gray-600 bg-gray-100 p-2 rounded-lg",children:["📧 ",n.email]})]}),e.jsxs(oe,{className:"space-y-6",children:[r==="error"&&e.jsx(da,{className:"border-red-200 bg-red-50",children:e.jsx(ua,{className:"text-red-700",children:"فشل في التحقق من الرمز. يرجى التأكد من صحة الرمز والمحاولة مرة أخرى."})}),e.jsx(Sr,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(x),className:"space-y-6",children:[e.jsx(ut,{control:c.control,name:"code",render:({field:g})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-gray-700 font-medium",children:"رمز التحقق"}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{children:e.jsx(je,{...g,type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,placeholder:"000000",className:"text-center text-2xl font-mono tracking-widest h-14 border-2 focus:border-blue-500 pr-12",disabled:m.isPending,"data-testid":"input-verification-code",onChange:b=>{const j=b.target.value.replace(/\D/g,"");g.onChange(j)}})}),e.jsx(K,{type:"button",variant:"ghost",size:"sm",onClick:k,className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-10 w-10 p-0 hover:bg-blue-100",title:"نسخ الرمز إلى الحافظة","data-testid":"button-copy-verification-code",children:u?e.jsx(Uo,{className:"h-4 w-4 text-green-600"}):e.jsx(p2,{className:"h-4 w-4 text-gray-500"})})]}),e.jsx(ct,{})]})}),e.jsx(K,{type:"submit",className:"w-full h-12 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold text-lg shadow-lg",disabled:m.isPending,"data-testid":"button-verify-email",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"w-5 h-5 mr-2 animate-spin"}),"جاري التحقق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"w-5 h-5 mr-2"}),"تحقق من الرمز"]})})]})}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"أو"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(K,{variant:"outline",onClick:p,disabled:o>0||h.isPending,className:"w-full border-2 hover:bg-gray-50","data-testid":"button-resend-code",children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"w-4 h-4 mr-2 animate-spin"}),"جاري الإرسال..."]}):o>0?e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"انتظر ",o," ثانية"]}):e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"w-4 h-4 mr-2"}),"إعادة إرسال الرمز"]})}),e.jsxs(K,{variant:"ghost",onClick:()=>t("/login"),className:"w-full text-gray-600 hover:text-gray-800","data-testid":"button-back-login",children:[e.jsx(to,{className:"w-4 h-4 mr-2"}),"العودة إلى تسجيل الدخول"]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"💡 نصائح مهمة:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• تحقق من مجلد الرسائل غير المرغوب فيها"}),e.jsx("li",{children:"• الرمز صالح لمدة 24 ساعة فقط"}),e.jsx("li",{children:"• الرمز يحتوي على 6 أرقام"})]})]})]})]})]})}function _t({value:t,onChange:s,placeholder:r,category:a,disabled:n=!1,className:i="",type:o="text",inputMode:l="text"}){const[u,d]=f.useState(!1),[c,m]=f.useState(""),h=f.useRef(null),x=f.useRef(null),p=Gt(),{data:k=[],isLoading:g}=Se({queryKey:["autocomplete",a],queryFn:()=>me(`/api/autocomplete/${a}`,"GET"),enabled:!!a}),b=Ae({mutationFn:z=>me("/api/autocomplete","POST",z),onSuccess:()=>{p.invalidateQueries({queryKey:["autocomplete",a]}),p.refetchQueries({queryKey:["autocomplete",a]})},onError:z=>{console.error("Error saving autocomplete data:",z)}}),j=Ae({mutationFn:({category:z,value:w})=>me(`/api/autocomplete/${z}/${encodeURIComponent(w)}`,"DELETE"),onSuccess:()=>{p.invalidateQueries({queryKey:["autocomplete",a]})}}),y=Array.isArray(k)?k.filter(z=>z.value.toLowerCase().includes(c.toLowerCase())):[],M=f.useCallback(z=>{s(z),d(!1),m(""),z&&typeof z=="string"&&z.trim()&&b.mutate({category:a,value:z.trim()})},[s,a,b]),N=f.useCallback(z=>{setTimeout(()=>{x.current&&!x.current.contains(z.relatedTarget)&&(d(!1),m(""),t&&typeof t=="string"&&t.trim()&&t.trim().length>=2&&b.mutate({category:a,value:t.trim()}))},150)},[t,a,b]),T=f.useCallback((z,w)=>{w.stopPropagation(),j.mutate({category:a,value:z})},[a,j]);f.useEffect(()=>{const z=w=>{x.current&&!x.current.contains(w.target)&&h.current&&!h.current.contains(w.target)&&(d(!1),m(""))};if(u)return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[u]);const S=z=>{const w=z.target.value;s(w),m(w),!u&&w&&w.length>=1&&d(!0)},I=f.useCallback(z=>{z.key==="Enter"&&t.trim()&&t.trim().length>=2&&(z.preventDefault(),d(!1),m(""),b.mutate({category:a,value:t.trim()}))},[t,a,b]),E=()=>{d(!0),p.refetchQueries({queryKey:["autocomplete",a]})};return e.jsxs("div",{className:"relative w-full",children:[e.jsx(je,{ref:h,value:t,onChange:S,onFocus:E,onBlur:N,onKeyDown:I,placeholder:r,disabled:n,className:`arabic-numbers ${i}`,type:o,inputMode:l}),u&&!n&&e.jsx("div",{ref:x,className:"absolute z-50 w-full mt-1",children:e.jsx(ee,{className:"max-h-64 overflow-y-auto shadow-lg border",children:g?e.jsxs("div",{className:"p-3 text-center text-gray-500",children:[e.jsx(Kr,{className:"w-4 h-4 animate-spin mx-auto mb-2"}),"جاري التحميل..."]}):Array.isArray(y)&&y.length>0?e.jsx("div",{className:"py-1",children:y.slice(0,10).map(z=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 hover:bg-gray-100 cursor-pointer group",onClick:()=>M(z.value),children:[e.jsx("span",{className:"flex-1 text-right",children:z.value}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("span",{className:"text-xs text-gray-400",children:z.usageCount}),e.jsx(K,{variant:"ghost",size:"sm",className:"w-6 h-6 p-0 hover:bg-red-100 hover:text-red-600",onClick:w=>T(z.value,w),children:e.jsx(es,{className:"w-3 h-3"})})]})]},z.id))}):c?e.jsxs("div",{className:"p-3 text-center text-gray-500",children:[e.jsx(Kr,{className:"w-4 h-4 mx-auto mb-2"}),'لا توجد نتائج للبحث "',c,'"']}):e.jsx("div",{className:"p-3 text-center text-gray-500",children:"ابدأ بالكتابة لحفظ البيانات تلقائياً"})})})]})}var ll="Checkbox",[y4]=Os(ll),[v4,Ud]=y4(ll);function b4(t){const{__scopeCheckbox:s,checked:r,children:a,defaultChecked:n,disabled:i,form:o,name:l,onCheckedChange:u,required:d,value:c="on",internal_do_not_use_render:m}=t,[h,x]=Ma({prop:r,defaultProp:n??!1,onChange:u,caller:ll}),[p,k]=f.useState(null),[g,b]=f.useState(null),j=f.useRef(!1),y=p?!!o||!!p.closest("form"):!0,M={checked:h,disabled:i,setChecked:x,control:p,setControl:k,name:l,form:o,value:c,hasConsumerStoppedPropagationRef:j,required:d,defaultChecked:sa(n)?!1:n,isFormControl:y,bubbleInput:g,setBubbleInput:b};return e.jsx(v4,{scope:s,...M,children:j4(m)?m(M):a})}var lb="CheckboxTrigger",cb=f.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:r,...a},n)=>{const{control:i,value:o,disabled:l,checked:u,required:d,setControl:c,setChecked:m,hasConsumerStoppedPropagationRef:h,isFormControl:x,bubbleInput:p}=Ud(lb,t),k=Pt(n,c),g=f.useRef(u);return f.useEffect(()=>{const b=i?.form;if(b){const j=()=>m(g.current);return b.addEventListener("reset",j),()=>b.removeEventListener("reset",j)}},[i,m]),e.jsx(xt.button,{type:"button",role:"checkbox","aria-checked":sa(u)?"mixed":u,"aria-required":d,"data-state":fb(u),"data-disabled":l?"":void 0,disabled:l,value:o,...a,ref:k,onKeyDown:Te(s,b=>{b.key==="Enter"&&b.preventDefault()}),onClick:Te(r,b=>{m(j=>sa(j)?!0:!j),p&&x&&(h.current=b.isPropagationStopped(),h.current||b.stopPropagation())})})});cb.displayName=lb;var Wd=f.forwardRef((t,s)=>{const{__scopeCheckbox:r,name:a,checked:n,defaultChecked:i,required:o,disabled:l,value:u,onCheckedChange:d,form:c,...m}=t;return e.jsx(b4,{__scopeCheckbox:r,checked:n,defaultChecked:i,disabled:l,required:o,onCheckedChange:d,name:a,form:c,value:u,internal_do_not_use_render:({isFormControl:h})=>e.jsxs(e.Fragment,{children:[e.jsx(cb,{...m,ref:s,__scopeCheckbox:r}),h&&e.jsx(hb,{__scopeCheckbox:r})]})})});Wd.displayName=ll;var db="CheckboxIndicator",ub=f.forwardRef((t,s)=>{const{__scopeCheckbox:r,forceMount:a,...n}=t,i=Ud(db,r);return e.jsx(Cs,{present:a||sa(i.checked)||i.checked===!0,children:e.jsx(xt.span,{"data-state":fb(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...t.style}})})});ub.displayName=db;var mb="CheckboxBubbleInput",hb=f.forwardRef(({__scopeCheckbox:t,...s},r)=>{const{control:a,hasConsumerStoppedPropagationRef:n,checked:i,defaultChecked:o,required:l,disabled:u,name:d,value:c,form:m,bubbleInput:h,setBubbleInput:x}=Ud(mb,t),p=Pt(r,x),k=zc(i),g=Bc(a);f.useEffect(()=>{const j=h;if(!j)return;const y=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(y,"checked").set,T=!n.current;if(k!==i&&N){const S=new Event("click",{bubbles:T});j.indeterminate=sa(i),N.call(j,sa(i)?!1:i),j.dispatchEvent(S)}},[h,k,i,n]);const b=f.useRef(sa(i)?!1:i);return e.jsx(xt.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??b.current,required:l,disabled:u,name:d,value:c,form:m,...s,tabIndex:-1,ref:p,style:{...s.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});hb.displayName=mb;function j4(t){return typeof t=="function"}function sa(t){return t==="indeterminate"}function fb(t){return sa(t)?"indeterminate":t?"checked":"unchecked"}const pb=f.forwardRef(({className:t,...s},r)=>e.jsx(Wd,{ref:r,className:de("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(ub,{className:de("flex items-center justify-center text-current"),children:e.jsx(Uo,{className:"h-4 w-4"})})}));pb.displayName=Wd.displayName;function N4({worker:t,attendance:s,onAttendanceChange:r,selectedDate:a=er()}){const[n,i]=f.useState(s),[o,l]=f.useState(!1),{data:u}=Se({queryKey:["/api/workers",t.id,"stats"],queryFn:async()=>{try{return await me(`/api/workers/${t.id}/stats`,"GET")||{totalWorkDays:0,totalProjects:0,totalEarnings:0}}catch(y){return console.error("Error fetching worker stats:",y),{totalWorkDays:0,totalProjects:0,totalEarnings:0}}},staleTime:3e4}),d=n.isPresent&&a===er();f.useEffect(()=>{i(s)},[s]);const c=y=>{const M={...n,...y};i(M),r(M)},m=y=>{const M=y===!0;if(M){const N=document.querySelector(`[data-testid="worker-card-detailed-${t.id}"]`);N&&(N.classList.add("animate-bounce-subtle"),setTimeout(()=>{N.classList.remove("animate-bounce-subtle")},600))}else l(!1);c({isPresent:M,startTime:M?n.startTime||"07:00":void 0,endTime:M?n.endTime||"15:00":void 0,workDescription:M?n.workDescription:void 0,workDays:M?n.workDays||1:void 0,paidAmount:M?n.paidAmount:void 0,paymentType:M?n.paymentType||"partial":void 0})},h=()=>{if(!n.startTime||!n.endTime)return 0;const y=new Date(`2000-01-01T${n.startTime}:00`);let N=new Date(`2000-01-01T${n.endTime}:00`).getTime()-y.getTime();N<0&&(N+=1440*60*1e3);const T=N/(1e3*60*60);return Math.max(0,T)},x=()=>{const y=n.workDays||1;return parseFloat(t.dailyWage)*y},p=()=>{const y=n.overtime||0,M=n.overtimeRate||0;return y*M},k=()=>{const y=x(),M=p();return Math.max(0,y+M)},g=()=>{const y=k(),M=parseFloat(n.paidAmount||"0");return y-M};f.useEffect(()=>{if(n.isPresent){const y=k(),M=g();if(n.totalPay!==y||n.remainingAmount!==M||n.hoursWorked!==h()){const N={...n,actualWage:x(),totalPay:y,remainingAmount:M,hoursWorked:h()};i(N),r(N)}}},[n.workDays,n.overtime,n.overtimeRate,n.paidAmount,n.startTime,n.endTime]);const b=y=>{switch(y){case"معلم":return e.jsx(Zt,{className:"h-5 w-5"});case"حداد":return e.jsx(w2,{className:"h-5 w-5"});case"بلاط":return e.jsx(N2,{className:"h-5 w-5"});case"دهان":return e.jsx(C2,{className:"h-5 w-5"});case"عامل":return e.jsx(tr,{className:"h-5 w-5"});default:return e.jsx(Hs,{className:"h-5 w-5"})}},j=y=>{switch(y){case"معلم":return"bg-gradient-to-br from-primary to-primary/80";case"حداد":return"bg-gradient-to-br from-orange-500 to-orange-600";case"بلاط":return"bg-gradient-to-br from-blue-500 to-blue-600";case"دهان":return"bg-gradient-to-br from-green-500 to-green-600";case"عامل":return"bg-gradient-to-br from-purple-500 to-purple-600";default:return"bg-gradient-to-br from-gray-500 to-gray-600"}};return e.jsx(ee,{className:`mb-2 shadow-sm border-r-4 w-full max-w-full overflow-hidden worker-card-enhanced ${d?"border-r-green-400 bg-gradient-to-r from-green-50/50 to-green-100/30 dark:from-green-950/20 dark:to-green-900/10 animate-pulse-slow attended-worker-glow":"border-r-primary/20 hover:border-r-primary/40"}`,"data-testid":`worker-card-detailed-${t.id}`,children:e.jsxs(oe,{className:"p-2 sm:p-3 max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-border/30 w-full max-w-full",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 flex-1 min-w-0 max-w-full overflow-hidden",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-md profession-icon-container ${j(t.type)}`,children:b(t.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-1",children:[e.jsx("h4",{className:"font-bold text-lg text-foreground truncate","data-testid":`worker-name-detailed-${t.id}`,children:t.name}),t.isActive?e.jsx(Is,{className:"h-4 w-4 text-green-500 flex-shrink-0","data-testid":`worker-status-active-${t.id}`}):e.jsx(cs,{className:"h-4 w-4 text-red-500 flex-shrink-0","data-testid":`worker-status-inactive-${t.id}`})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-4 text-xs text-muted-foreground",children:[e.jsx("span",{className:"flex items-center space-x-reverse space-x-1",children:e.jsx("span",{className:"font-medium",children:t.type})}),e.jsxs("span",{className:"flex items-center space-x-reverse space-x-1",children:[e.jsx(Ns,{className:"h-3 w-3"}),e.jsx("span",{className:"font-bold arabic-numbers","data-testid":`worker-daily-wage-${t.id}`,children:Ge(t.dailyWage)})]}),e.jsxs("span",{className:"flex items-center space-x-reverse space-x-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),e.jsxs("span",{className:"arabic-numbers",children:[u?.totalWorkDays||0," يوم"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 flex-shrink-0",children:[n.isPresent&&e.jsxs(K,{variant:"ghost",size:"sm",onClick:()=>l(!o),className:"px-2 py-1 h-8","data-testid":`toggle-details-${t.id}`,children:[o?e.jsx(Wo,{className:"h-4 w-4"}):e.jsx(_i,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs mr-1",children:"تفاصيل"})]}),e.jsx(re,{htmlFor:`present-${t.id}`,className:"text-sm font-medium text-foreground cursor-pointer",children:"حاضر"}),e.jsx(pb,{id:`present-${t.id}`,checked:n.isPresent,onCheckedChange:m,className:"w-5 h-5","data-testid":`attendance-checkbox-${t.id}`})]})]}),n.isPresent&&o&&e.jsx("div",{className:"space-y-2 w-full max-w-full overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-50 dark:from-slate-950/30 dark:to-gray-950/30 p-2 rounded-lg border border-slate-200 dark:border-slate-700 w-full max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-2",children:[e.jsx(Ls,{className:"h-4 w-4 text-slate-600"}),e.jsx("h5",{className:"font-medium text-slate-800 dark:text-slate-200 text-sm","data-testid":`work-time-section-${t.id}`,children:"تفاصيل العمل والدفع"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"من"}),e.jsx(je,{type:"time",value:n.startTime||"07:00",onChange:y=>c({startTime:y.target.value}),className:"text-center font-mono text-sm h-8","data-testid":`start-time-input-${t.id}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"إلى"}),e.jsx(je,{type:"time",value:n.endTime||"15:00",onChange:y=>c({endTime:y.target.value}),className:"text-center font-mono text-sm h-8","data-testid":`end-time-input-${t.id}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"أيام"}),e.jsx(je,{type:"number",inputMode:"decimal",step:"0.1",min:"0.1",max:"2.0",value:n.workDays||1,onChange:y=>c({workDays:parseFloat(y.target.value)||1}),className:"text-center arabic-numbers text-sm h-8","data-testid":`work-days-input-${t.id}`})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"ساعات"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300 arabic-numbers text-sm","data-testid":`working-hours-display-${t.id}`,children:h().toFixed(1)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"ساعات إضافية"}),e.jsx(je,{type:"number",inputMode:"decimal",step:"0.5",min:"0",max:"8",value:n.overtime||0,onChange:y=>c({overtime:parseFloat(y.target.value)||0}),className:"text-center arabic-numbers text-sm h-8","data-testid":`overtime-input-${t.id}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"معدل الساعة"}),e.jsx(je,{type:"number",inputMode:"decimal",placeholder:"0",value:n.overtimeRate||"",onChange:y=>c({overtimeRate:parseFloat(y.target.value)||0}),className:"text-center arabic-numbers text-sm h-8","data-testid":`overtime-rate-input-${t.id}`})]})]}),e.jsxs("div",{className:"space-y-1 mb-3 pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"وصف العمل"}),e.jsx(_t,{value:n.workDescription||"",onChange:y=>c({workDescription:y}),placeholder:"اكتب وصف العمل المنجز...",category:"workDescriptions",className:"w-full text-sm","data-testid":`work-description-input-${t.id}`})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-2",children:[e.jsx(c2,{className:"h-4 w-4 text-slate-600"}),e.jsx("h6",{className:"font-medium text-slate-800 dark:text-slate-200 text-sm","data-testid":`payment-section-${t.id}`,children:"معلومات الدفع"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"نوع الدفع"}),e.jsxs(We,{value:n.paymentType||"partial",onValueChange:y=>c({paymentType:y}),children:[e.jsx(ze,{className:"h-8 text-sm","data-testid":`payment-type-select-${t.id}`,children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"full",children:"دفع كامل"}),e.jsx(W,{value:"partial",children:"دفع جزئي"}),e.jsx(W,{value:"credit",children:"على الحساب"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"الأجر الفعلي"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300 arabic-numbers text-sm","data-testid":`actual-wage-display-${t.id}`,children:Ge(x())})})]}),n.paymentType!=="credit"?e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"المبلغ المدفوع"}),e.jsx(je,{type:"number",inputMode:"decimal",placeholder:"0",value:n.paidAmount||"",onChange:y=>c({paidAmount:y.target.value}),className:"text-center arabic-numbers text-sm h-8","data-testid":`paid-amount-input-${t.id}`})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"المبلغ المدفوع"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-slate-500",children:"على الحساب"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"إجمالي الدفع"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-200/50 dark:bg-slate-700/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200 arabic-numbers text-sm","data-testid":`total-pay-display-${t.id}`,children:Ge(k())})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"المبلغ المتبقي"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsxs("span",{className:`font-bold arabic-numbers text-sm ${g()>0?"text-red-600":g()<0?"text-green-600":"text-slate-700 dark:text-slate-300"}`,"data-testid":`remaining-amount-display-${t.id}`,children:[Ge(Math.abs(g())),g()>0&&" (مستحق)",g()<0&&" (فائض)"]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"الوقت الإضافي"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-100/50 dark:bg-slate-800/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300 arabic-numbers text-sm",children:Ge(p())})})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"إجمالي الدفع المطلوب"}),e.jsx("div",{className:"h-8 px-2 py-1 bg-slate-200/50 dark:bg-slate-700/50 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200 arabic-numbers text-sm","data-testid":`total-pay-display-${t.id}`,children:Ge(k())})}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["الأجر الأساسي (",n.workDays||1," يوم):"]}),e.jsx("span",{className:"arabic-numbers",children:Ge(x())})]}),n.overtime&&n.overtimeRate?e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["الوقت الإضافي (",n.overtime," ساعة × ",n.overtimeRate,"):"]}),e.jsx("span",{className:"arabic-numbers",children:Ge(p())})]}):null,e.jsxs("div",{className:"border-t border-slate-300 pt-1 flex justify-between font-medium",children:[e.jsx("span",{children:"الإجمالي:"}),e.jsx("span",{className:"arabic-numbers",children:Ge(k())})]})]})]})})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2 mb-2",children:[e.jsx(A2,{className:"h-4 w-4 text-slate-600"}),e.jsx("h6",{className:"font-medium text-slate-800 dark:text-slate-200 text-sm","data-testid":`notes-section-${t.id}`,children:"ملاحظات"})]}),e.jsx(_t,{value:n.notes||"",onChange:y=>c({notes:y}),placeholder:"اكتب أي ملاحظات إضافية...",category:"workerNotes",className:"w-full text-sm","data-testid":`notes-input-${t.id}`})]})]})})]})})}function w4(){or();const{selectedProjectId:t,selectProject:s}=Mi(),r=new URLSearchParams(window.location.search),a=r.get("edit"),n=r.get("worker"),i=r.get("date"),[o,l]=f.useState(i||er()),[u,d]=f.useState({}),[c,m]=f.useState(!1),[h,x]=f.useState({startTime:"07:00",endTime:"15:00",workDays:1,paymentType:"partial",paidAmount:"",workDescription:""}),{toast:p}=Dt(),k=Gt(),{setFloatingAction:g}=Ps();f.useEffect(()=>(g(()=>{document.querySelector('[type="submit"]')?.click()},"حفظ الحضور"),()=>g(null)),[g]);const b=async(D,V)=>{if(!(!V||typeof V!="string"||!V.trim()))try{await me("/api/autocomplete","POST",{category:D,value:V.trim()})}catch(X){console.log(`Failed to save autocomplete value for ${D}:`,X)}},{data:j=[]}=Se({queryKey:["/api/projects",t,"attendance",o],queryFn:async()=>{try{const D=await me(`/api/projects/${t}/attendance?date=${o}`,"GET");return D&&D.data&&Array.isArray(D.data)?D.data:Array.isArray(D)?D:[]}catch(D){return console.error("Error fetching attendance records:",D),[]}},enabled:!!t}),{data:y}=Se({queryKey:["/api/worker-attendance",a],queryFn:async()=>{try{const D=await me(`/api/worker-attendance/${a}`,"GET");return D&&D.data?D.data:D||null}catch(D){return console.error("Error fetching attendance record for editing:",D),null}},enabled:!!a});f.useEffect(()=>{if(y&&n){const D={...u};D[n]={isPresent:!0,startTime:y.startTime,endTime:y.endTime,workDescription:y.workDescription||"",workDays:parseFloat(y.workDays||"1.0"),paidAmount:y.paidAmount?.toString()||"",paymentType:y.paymentType||"partial"},d(D)}},[y,n]);const M=Ae({mutationFn:D=>me(`/api/worker-attendance/${D}`,"DELETE"),onSuccess:()=>{p({title:"تم الحذف",description:"تم حذف سجل الحضور بنجاح"}),k.invalidateQueries({queryKey:["/api/projects",t,"worker-attendance"]})},onError:()=>{p({title:"خطأ",description:"حدث خطأ أثناء حذف سجل الحضور",variant:"destructive"})}}),N=D=>{if(Array.isArray(T)?T.find(X=>X.id===D.workerId):null){const X={...u};X[D.workerId]={isPresent:!0,startTime:D.startTime,endTime:D.endTime,workDescription:D.workDescription||"",workDays:parseFloat(D.workDays||"1.0"),paidAmount:D.paidAmount,paymentType:D.paymentType||"partial"},d(X)}},{data:T=[],isLoading:S}=Se({queryKey:["/api/workers"]}),I=Ae({mutationFn:async D=>{console.log("💾 بدء حفظ سجلات الحضور للعمال:",D.length);const V=D.flatMap(q=>[b("workDescriptions",q.workDescription),b("paymentTypes",q.paymentType)]).filter(Boolean);V.length>0&&await Promise.all(V);const X=[],C=[];for(const q of D)try{console.log(`🔄 محاولة حفظ حضور العامل: ${q.workerId} في التاريخ: ${q.date}`);try{const ue=await me(`/api/projects/${q.projectId}/attendance?date=${q.date}&workerId=${q.workerId}`,"GET"),R=ue?.data||ue||[],fe=Array.isArray(R)?R.find(ce=>ce.workerId===q.workerId):null;if(fe){console.log(`📝 تحديث سجل موجود للعامل: ${q.workerId}`);const ce=await me(`/api/worker-attendance/${fe.id}`,"PATCH",q);X.push(ce)}else{console.log(`➕ إنشاء سجل جديد للعامل: ${q.workerId}`);const ce=await me("/api/worker-attendance","POST",q);X.push(ce)}}catch{console.log(`➕ سجل غير موجود، إنشاء جديد للعامل: ${q.workerId}`);const R=await me("/api/worker-attendance","POST",q);X.push(R)}}catch(ue){console.error(`❌ فشل في حفظ حضور العامل ${q.workerId}:`,ue),C.push({workerId:q.workerId,error:ue.message||"خطأ غير معروف"})}return console.log(`✅ تم حفظ ${X.length} سجل حضور بنجاح`),C.length>0&&console.warn(`⚠️ فشل في حفظ ${C.length} سجل حضور:`,C),{successful:X,failed:C,totalProcessed:D.length}},onSuccess:async D=>{k.invalidateQueries({queryKey:["/api/autocomplete"]}),k.invalidateQueries({queryKey:["/api/projects",t,"worker-attendance"]});const{successful:V,failed:X,totalProcessed:C}=D;X.length===0?p({title:"تم الحفظ بنجاح",description:`تم حفظ حضور ${V.length} عامل بنجاح`}):V.length>0?(p({title:"تم الحفظ جزئياً",description:`نجح حفظ ${V.length} عامل، فشل ${X.length} عامل`,variant:"default"}),console.error("تفاصيل الأخطاء:",X)):p({title:"فشل الحفظ",description:`فشل في حفظ جميع سجلات الحضور (${X.length} عامل)`,variant:"destructive"}),V.length>0&&d(q=>{const ue={...q};return V.forEach(R=>{const fe=R?.data||R;fe?.workerId&&delete ue[fe.workerId]}),ue})},onError:async(D,V)=>{const X=V.flatMap(q=>[b("workDescriptions",q.workDescription),b("paymentTypes",q.paymentType)]).filter(Boolean);X.length>0&&(await Promise.all(X),k.invalidateQueries({queryKey:["/api/autocomplete"]})),console.error("Error saving attendance:",D);let C="حدث خطأ أثناء حفظ الحضور";if(D?.response?.data?.error||D?.message){const q=D?.response?.data?.error||D?.message;q.includes("تم تسجيل حضور هذا العامل مسبقاً")?C="تم تسجيل حضور هذا العامل مسبقاً في هذا التاريخ":C=q}p({title:"خطأ",description:C,variant:"destructive"})}}),E=(D,V)=>{d(X=>({...X,[D]:V}))},z=()=>{const D={...u};console.log("=== تطبيق الإعدادات المشتركة ==="),console.log("الإعدادات المشتركة:",h),Object.keys(D).forEach(V=>{D[V].isPresent&&(console.log(`تطبيق الإعدادات على العامل ${V}`),console.log(`المبلغ المدفوع من الإعدادات: "${h.paidAmount}"`),D[V]={...D[V],startTime:h.startTime,endTime:h.endTime,workDays:h.workDays,paymentType:h.paymentType,paidAmount:h.paidAmount,workDescription:h.workDescription},console.log("البيانات بعد التطبيق:",D[V]))}),d(D),p({title:"تم التطبيق",description:"تم تطبيق الإعدادات على جميع العمال المحددين"})},w=D=>{const V={};console.log("=== تحديد جميع العمال ==="),console.log("حالة الحضور:",D),console.log("الإعدادات المشتركة:",h),T.forEach(X=>{D?(console.log(`إضافة العامل ${X.name} بالمبلغ: "${h.paidAmount}"`),V[X.id]={isPresent:!0,startTime:h.startTime,endTime:h.endTime,workDays:h.workDays,paymentType:h.paymentType,paidAmount:h.paidAmount,workDescription:h.workDescription}):V[X.id]={isPresent:!1}}),console.log("البيانات النهائية:",V),d(V)},v=()=>{if(!t){p({title:"خطأ",description:"يرجى اختيار المشروع أولاً",variant:"destructive"});return}console.log("=== تصحيح الأخطاء - بيانات الحضور قبل الحفظ ==="),console.log("attendanceData:",u);const D=Object.entries(u).filter(([V,X])=>X.isPresent).map(([V,X])=>{const C=T.find(H=>H.id===V),q=parseFloat(C?.dailyWage||"0"),ue=X.workDays||1,R=q*ue,fe=X.overtime||0,ce=X.overtimeRate||0,ne=fe*ce,ye=Math.max(0,R+ne),tt=parseFloat(X.paidAmount||"0"),at=X.paymentType==="credit"?ye:ye-tt,st=()=>{if(!X.startTime||!X.endTime)return 0;const H=new Date(`2000-01-01T${X.startTime}:00`);let Q=new Date(`2000-01-01T${X.endTime}:00`).getTime()-H.getTime();return Q<0&&(Q+=1440*60*1e3),Math.max(0,Q/(1e3*60*60))};return console.log(`العامل ${C?.name}:`),console.log(`  - الأجر الأساسي: ${R}`),console.log(`  - الوقت الإضافي: ${ne}`),console.log(`  - إجمالي الدفع: ${ye}`),console.log(`  - المبلغ المدفوع: ${tt}`),console.log(`  - المبلغ المتبقي: ${at}`),{projectId:t,workerId:V,date:o,attendanceDate:o,startTime:X.startTime||"07:00",endTime:X.endTime||"15:00",workDescription:X.workDescription||"",isPresent:!0,workDays:ue,dailyWage:C?.dailyWage||"0",hoursWorked:st().toString(),overtime:fe.toString(),overtimeRate:ce.toString(),actualWage:R.toString(),totalPay:ye.toString(),paidAmount:tt.toString(),remainingAmount:at.toString(),paymentType:X.paymentType||"partial",notes:X.notes||""}});if(D.length===0){p({title:"تنبيه",description:"لم يتم تحديد أي عامل كحاضر",variant:"destructive"});return}I.mutate(D)};return e.jsxs("div",{className:"p-4 slide-in",children:[e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Ai,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsx(Ii,{selectedProjectId:t,onProjectChange:(D,V)=>s(D,V),showHeader:!1,variant:"compact"})]})}),e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"التاريخ"}),e.jsx(je,{type:"date",value:o,onChange:D=>l(D.target.value),className:"w-full"})]})}),T.length>0&&e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"الإعدادات المشتركة"}),e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>m(!c),className:"px-2 py-1 h-8","data-testid":"toggle-shared-settings",children:c?e.jsx(Wo,{className:"h-4 w-4"}):e.jsx(_i,{className:"h-4 w-4"})})]}),c&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{size:"sm",variant:"outline",onClick:()=>w(!0),className:"text-xs",children:"تحديد الكل"}),e.jsx(K,{size:"sm",variant:"outline",onClick:()=>w(!1),className:"text-xs",children:"إلغاء الكل"}),e.jsx(K,{size:"sm",onClick:z,className:"text-xs",children:"تطبيق على المحدد"})]})]}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-xs text-muted-foreground",children:"وقت البدء"}),e.jsx(je,{type:"time",value:h.startTime,onChange:D=>x(V=>({...V,startTime:D.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-xs text-muted-foreground",children:"وقت الانتهاء"}),e.jsx(je,{type:"time",value:h.endTime,onChange:D=>x(V=>({...V,endTime:D.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-xs text-muted-foreground",children:"عدد الأيام"}),e.jsx(je,{type:"number",inputMode:"decimal",step:"0.1",min:"0.1",max:"2.0",value:h.workDays,onChange:D=>x(V=>({...V,workDays:parseFloat(D.target.value)||1})),className:"mt-1 arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-xs text-muted-foreground",children:"نوع الدفع"}),e.jsxs(We,{value:h.paymentType,onValueChange:D=>x(V=>({...V,paymentType:D})),children:[e.jsx(ze,{className:"mt-1",children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"full",children:"دفع كامل"}),e.jsx(W,{value:"partial",children:"دفع جزئي"}),e.jsx(W,{value:"credit",children:"على الحساب"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[h.paymentType!=="credit"&&e.jsxs("div",{children:[e.jsx(re,{className:"text-xs text-muted-foreground",children:"المبلغ المدفوع"}),e.jsx(je,{type:"number",inputMode:"decimal",placeholder:"0",value:h.paidAmount,onChange:D=>x(V=>({...V,paidAmount:D.target.value})),className:"mt-1 arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-xs text-muted-foreground",children:"وصف العمل"}),e.jsx(_t,{value:h.workDescription,onChange:D=>x(V=>({...V,workDescription:D})),placeholder:"اكتب وصف العمل...",category:"workDescriptions",className:"mt-1"})]})]})]})]})}),S?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل العمال..."})}):T.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد عمال مسجلين"})}):e.jsx("div",{className:"space-y-3",children:Array.isArray(T)?T.map(D=>e.jsx(N4,{worker:D,attendance:u[D.id]||{isPresent:!1},onAttendanceChange:V=>E(D.id,V),selectedDate:o},D.id)):null}),T.length>0&&e.jsx("div",{className:"mt-6",children:e.jsxs(K,{onClick:v,disabled:I.isPending,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:[e.jsx(Xa,{className:"ml-2 h-4 w-4"}),I.isPending?"جاري الحفظ...":"حفظ الحضور"]})}),t&&j.length>0&&e.jsx(ee,{className:"mt-6",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground mb-4",children:["حضور اليوم المسجل (",o,")"]}),e.jsx("div",{className:"space-y-3",children:j.map(D=>{const V=T.find(X=>X.id===D.workerId);return e.jsx("div",{className:"border rounded-lg p-3 bg-card",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:V?.name}),e.jsx("span",{className:"text-xs bg-success text-success-foreground px-2 py-1 rounded",children:"حاضر"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["الوقت: ",D.startTime," - ",D.endTime]}),e.jsxs("p",{children:["الراتب اليومي: ",D.dailyWage," ر.ي"]}),e.jsxs("p",{children:["المدفوع: ",D.paidAmount," ر.ي | المتبقي: ",D.remainingAmount," ر.ي"]}),D.workDescription&&e.jsxs("p",{children:["الوصف: ",D.workDescription]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{size:"sm",variant:"outline",onClick:()=>N(D),children:"تعديل"}),e.jsx(K,{size:"sm",variant:"destructive",onClick:()=>M.mutate(D.id),disabled:M.isPending,children:"حذف"})]})]})},D.id)})})]})})]})}function k4({totalIncome:t,totalExpenses:s,remainingBalance:r}){const a=typeof t=="number"?t:parseFloat(String(t||"0"))||0,n=typeof s=="number"?s:parseFloat(String(s||"0"))||0,i=typeof r=="number"?r:parseFloat(String(r||"0"))||0;return e.jsxs("div",{className:"mt-4 bg-gradient-to-r from-primary to-primary/80 text-primary-foreground rounded-xl p-4",children:[e.jsx("h4",{className:"font-bold text-lg mb-3",children:"ملخص اليوم"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"opacity-90",children:"إجمالي الدخل:"}),e.jsx("div",{className:"text-lg font-bold arabic-numbers",children:Ge(a)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"opacity-90",children:"إجمالي المنصرف:"}),e.jsx("div",{className:"text-lg font-bold arabic-numbers",children:Ge(n)})]})]}),e.jsxs("div",{className:"text-center mt-3 pt-3 border-t border-primary-foreground/20",children:[e.jsx("div",{className:"text-sm opacity-90",children:"المبلغ المتبقي"}),e.jsx("div",{className:"text-2xl font-bold arabic-numbers",children:Ge(i)})]})]})}function T4({projectId:t,selectedDate:s}){const[r,a]=f.useState(""),[n,i]=f.useState(""),[o,l]=f.useState(null),{toast:u}=Dt(),d=Gt(),{setFloatingAction:c}=Ps();f.useEffect(()=>(c(()=>{const N=document.querySelector('[aria-label="إضافة نثريات جديدة"]');N&&N.click()},"إضافة مصروف جديد"),()=>c(null)),[c]);const m=async(M,N)=>{if(!(!N||N.trim().length<2))try{await me("/api/autocomplete","POST",{category:M,value:N.trim()})}catch(T){console.error(`Error saving autocomplete value for ${M}:`,T)}},{data:h=[]}=Se({queryKey:["/api/worker-misc-expenses",t,s],queryFn:async()=>{try{const M=await me(`/api/worker-misc-expenses?projectId=${t}&date=${s}`,"GET");return M&&M.data&&Array.isArray(M.data)?M.data:Array.isArray(M)?M:[]}catch(M){return console.error("Error fetching worker misc expenses:",M),[]}},enabled:!!t}),x=Ae({mutationFn:M=>me("/api/worker-misc-expenses","POST",M),onSuccess:async()=>{r&&await m("workerMiscDescriptions",r),d.invalidateQueries({queryKey:["/api/worker-misc-expenses"]}),a(""),i(""),u({title:"تم إضافة النثريات",description:"تم إضافة نثريات العمال بنجاح"})},onError:M=>{console.error("Error creating misc expense:",M),u({title:"خطأ في إضافة النثريات",description:"حدث خطأ أثناء إضافة النثريات",variant:"destructive"})}}),p=Ae({mutationFn:({id:M,data:N})=>me(`/api/worker-misc-expenses/${M}`,"PATCH",N),onSuccess:async()=>{r&&await m("workerMiscDescriptions",r),d.invalidateQueries({queryKey:["/api/worker-misc-expenses"]}),b(),u({title:"تم تحديث النثريات",description:"تم تحديث النثريات بنجاح"})},onError:M=>{console.error("Error updating misc expense:",M),u({title:"خطأ في تحديث النثريات",description:"حدث خطأ أثناء تحديث النثريات",variant:"destructive"})}}),k=Ae({mutationFn:M=>me(`/api/worker-misc-expenses/${M}`,"DELETE"),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/worker-misc-expenses"]}),u({title:"تم حذف النثريات",description:"تم حذف النثريات بنجاح"})},onError:M=>{console.error("Error deleting misc expense:",M),u({title:"خطأ في حذف النثريات",description:"حدث خطأ أثناء حذف النثريات",variant:"destructive"})}}),g=async()=>{if(!r.trim()||!n){u({title:"بيانات ناقصة",description:"يرجى إدخال الوصف والمبلغ",variant:"destructive"});return}o?p.mutate({id:o,data:{description:r,amount:n}}):x.mutate({description:r,amount:n,projectId:t,date:s})},b=()=>{a(""),i(""),l(null)},j=M=>{a(M.description),i(M.amount),l(M.id)},y=Array.isArray(h)?h.reduce((M,N)=>M+parseFloat(N.amount||"0"),0):0;return e.jsx(ee,{className:"mb-3",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Ns,{className:"text-purple-600 ml-2 h-5 w-5"}),"نثريات العمال"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(_t,{value:r,onChange:a,category:"workerMiscDescriptions",placeholder:"الوصف"}),e.jsx(je,{type:"number",inputMode:"decimal",value:n,onChange:M=>i(M.target.value),placeholder:"المبلغ",className:"text-center arabic-numbers"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{onClick:g,size:"sm",className:"bg-purple-600 hover:bg-purple-700",children:o?e.jsx(Xa,{className:"h-4 w-4"}):e.jsx(os,{className:"h-4 w-4"})}),o&&e.jsx(K,{onClick:b,size:"sm",variant:"outline",children:"إلغاء"})]}),Array.isArray(h)&&h.map((M,N)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsx("span",{className:"text-sm flex-1",children:M.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Ge(M.amount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>j(M),children:e.jsx(Or,{className:"h-3 w-3"})}),e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>k.mutate(M.id),disabled:k.isPending,children:e.jsx(es,{className:"h-3 w-3"})})]})]})]},M.id||N)),Array.isArray(h)&&h.length>0&&e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي النثريات: "}),e.jsx("span",{className:"font-bold text-purple-600 arabic-numbers",children:Ge(y.toString())})]})]})]})})}class Cc extends f.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(s){return console.error("🚨 [ErrorBoundary] تم التقاط خطأ:",s),{hasError:!0,error:s}}componentDidCatch(s,r){console.error("❌ [ErrorBoundary] تفاصيل الخطأ:",s,r),console.error("📍 [ErrorBoundary] Stack trace:",s.stack)}render(){return this.state.hasError?this.props.fallback||e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200",children:"عذراً، حدث خطأ غير متوقع"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"يرجى إعادة تحميل الصفحة أو المحاولة لاحقاً"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 mr-4",children:"إعادة تحميل الصفحة"}),e.jsx("button",{onClick:()=>{localStorage.clear(),window.location.href="/login"},className:"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"تسجيل دخول جديد"})]}),!1]})}):this.props.children}}function S4(){const[,t]=or(),{selectedProjectId:s,selectProject:r}=Mi(),[a,n]=f.useState(()=>new Date().toISOString().split("T")[0]),[i,o]=f.useState("0"),[l,u]=f.useState(!0),[d,c]=f.useState(""),[m,h]=f.useState(""),[x,p]=f.useState(""),[k,g]=f.useState(""),[b,j]=f.useState(null),[y,M]=f.useState(""),[N,T]=f.useState(""),[S,I]=f.useState(""),[E,z]=f.useState(null),{toast:w}=Dt(),v=Gt(),{setFloatingAction:D}=Ps(),V=async(A,J)=>{if(!(!J||J.trim().length<2))try{if(!(await fetch("/api/autocomplete",{method:"HEAD"})).ok){console.warn(`Autocomplete endpoint not available for ${A}`);return}await me("/api/autocomplete","POST",{category:A,value:J.trim(),usageCount:1}),console.log(`✅ تم حفظ قيمة الإكمال التلقائي: ${A} = ${J.trim()}`)}catch(St){console.warn(`Failed to save autocomplete value for ${A}:`,St)}};f.useEffect(()=>(D(()=>{const J=document.querySelector('[type="submit"]');J&&J.click()},"حفظ المصاريف"),()=>D(null)),[D]);const X=async()=>{const A=[];m&&m.trim().length>=2&&A.push(V("senderNames",m)),x&&x.trim().length>=1&&A.push(V("transferNumbers",x)),k&&k.trim().length>=2&&A.push(V("transferTypes",k)),A.length>0&&await Promise.all(A)},{data:C=[],error:q}=Se({queryKey:["/api/workers"],queryFn:async()=>{try{console.log("🔄 [DailyExpenses] جلب قائمة العمال...");const A=await me("/api/workers","GET");console.log("📊 [DailyExpenses] استجابة العمال:",A);let J=[];return A&&typeof A=="object"&&(A.success!==void 0&&A.data!==void 0?J=Array.isArray(A.data)?A.data:[]:Array.isArray(A)?J=A:A.id?J=[A]:A.data&&(J=Array.isArray(A.data)?A.data:[])),Array.isArray(J)||(console.warn("⚠️ [DailyExpenses] بيانات العمال ليست مصفوفة، تحويل إلى مصفوفة فارغة"),J=[]),console.log(`✅ [DailyExpenses] تم جلب ${J.length} عامل`),J}catch(A){return console.error("❌ [DailyExpenses] خطأ في جلب العمال:",A),[]}},staleTime:3e5,gcTime:6e5,retry:2}),{data:ue=[],error:R}=Se({queryKey:["/api/projects"],queryFn:async()=>{try{console.log("🔄 [DailyExpenses] جلب قائمة المشاريع...");const A=await me("/api/projects","GET");console.log("📊 [DailyExpenses] استجابة المشاريع:",A);let J=[];return A&&typeof A=="object"&&(A.success!==void 0&&A.data!==void 0?J=Array.isArray(A.data)?A.data:[]:Array.isArray(A)?J=A:A.id?J=[A]:A.data&&(J=Array.isArray(A.data)?A.data:[])),Array.isArray(J)||(console.warn("⚠️ [DailyExpenses] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),J=[]),console.log(`✅ [DailyExpenses] تم جلب ${J.length} مشروع`),J}catch(A){return console.error("❌ [DailyExpenses] خطأ في جلب المشاريع:",A),[]}},staleTime:3e5,retry:2}),{data:fe=[]}=Se({queryKey:["/api/materials"],queryFn:async()=>{try{const A=await me("/api/materials","GET");return A&&A.data&&Array.isArray(A.data)?A.data:[]}catch(A){return console.warn("⚠️ لم يتمكن من جلب المواد، استخدام قائمة فارغة:",A),[]}},staleTime:3e5,gcTime:6e5}),{data:ce=[]}=Se({queryKey:["/api/daily-project-transfers",s,a],queryFn:async()=>{try{const A=await me(`/api/daily-project-transfers?projectId=${s}&date=${a}`,"GET");console.log("📊 [ProjectTransfers] استجابة API للصفحة اليومية:",A);let J=[];return A&&A.data&&Array.isArray(A.data)?J=A.data:Array.isArray(A)&&(J=A),Array.isArray(J)?(console.log(`✅ [ProjectTransfers] تم جلب ${J.length} ترحيل لليوم ${a} في الصفحة اليومية`),J):[]}catch(A){return console.error("Error fetching daily project transfers:",A),[]}},enabled:!!s&&!!a&&l,staleTime:6e4,gcTime:3e5}),ne=Array.isArray(ce)?ce:[],{data:ye,isLoading:tt,error:at}=Se({queryKey:["/api/projects",s,"daily-expenses",a],queryFn:async()=>{if(!s||!a)return null;try{console.log(`📊 جلب المصروفات اليومية: مشروع ${s}, تاريخ ${a}`);const A=await me(`/api/projects/${s}/daily-expenses/${a}`,"GET");return console.log("📊 استجابة المصروفات اليومية:",A),A&&A.success&&A.data?A.data:null}catch(A){throw console.error("خطأ في جلب المصروفات اليومية:",A),A}},enabled:!!s&&!!a,retry:2,staleTime:3e4}),st=ye?.fundTransfers||[],H=ye?.workerAttendance||[],L=ye?.transportationExpenses||[],Q=ye?.materialPurchases||[],Ne=ye?.workerTransfers||[],pt=ye?.miscExpenses||[],yt=Array.isArray(H)?H:[],Me=Array.isArray(L)?L:[],bt=Array.isArray(Q)?Q:[],rs=Array.isArray(Ne)?Ne:[],ds=Array.isArray(st)?st:[],{data:G}=Se({queryKey:["/api/projects",s,"previous-balance",a],queryFn:async()=>{try{const A=await me(`/api/projects/${s}/previous-balance/${a}`,"GET");return A&&A.data&&A.data.balance!==void 0?A.data.balance||"0":A?.balance||"0"}catch(A){return console.error("Error fetching previous balance:",A),"0"}},enabled:!!s&&!!a});f.useEffect(()=>{G!=null&&(console.log("🔄 تحديث carriedForward:",{previousBalance:G,type:typeof G}),o(G))},[G]),f.useEffect(()=>{(async()=>{const J=["حولة بنكية","تسليم يدوي","صراف آلي","تحويل داخلي","شيك","نقدية"];for(const St of J)try{await V("transferTypes",St)}catch(gt){console.log(`Type ${St} initialization skipped:`,gt)}})()},[]);const qe=Ae({mutationFn:async A=>(await X(),me("/api/fund-transfers","POST",A)),onSuccess:async A=>{v.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),v.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),w({title:"تم إضافة العهدة",description:"تم إضافة تحويل العهدة بنجاح"}),v.invalidateQueries({queryKey:["/api/autocomplete"]}),c(""),h(""),p(""),g("")},onError:async A=>{await X(),v.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("خطأ في إضافة الحولة:",A);let J="حدث خطأ أثناء إضافة الحولة";A?.response?.data?.message?J=A.response.data.message:A?.message?J=A.message:typeof A=="string"&&(J=A),w({title:"فشل في إضافة الحولة",description:J,variant:"destructive"})}}),he=Ae({mutationFn:async A=>(await Promise.all([V("transportDescriptions",y),V("notes",S)]),me("/api/transportation-expenses","POST",A)),onSuccess:async A=>{v.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),v.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),w({title:"تم إضافة المواصلات",description:"تم إضافة مصروف المواصلات بنجاح"}),v.invalidateQueries({queryKey:["/api/autocomplete"]}),M(""),T(""),I("")},onError:async A=>{await Promise.all([V("transportDescriptions",y),V("notes",S)]),v.invalidateQueries({queryKey:["/api/autocomplete"]}),w({title:"خطأ في إضافة المواصلات",description:A?.message||"حدث خطأ أثناء إضافة مصروف المواصلات",variant:"destructive"})}}),_=Ae({mutationFn:A=>me("/api/daily-expense-summaries","POST",A),onSuccess:()=>{w({title:"تم الحفظ",description:"تم حفظ ملخص المصروفات اليومية بنجاح"}),v.invalidateQueries({queryKey:["/api/projects",s,"daily-summary",a]})},onError:()=>{w({title:"خطأ",description:"حدث خطأ أثناء حفظ الملخص",variant:"destructive"})}}),$=Ae({mutationFn:A=>me(`/api/fund-transfers/${A}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(A,J,St)=>{const{projectId:gt,date:Ht}=St||{projectId:s,date:a};v.setQueryData(["/api/projects",gt,"daily-expenses",Ht],Tt=>Tt&&{...Tt,fundTransfers:Tt.fundTransfers?.filter(zs=>zs.id!==J)||[]}),v.invalidateQueries({queryKey:["/api/projects",gt,"daily-expenses",Ht]}),v.invalidateQueries({queryKey:["/api/projects",gt,"previous-balance"]}),w({title:"تم الحذف",description:"تم حذف العهدة بنجاح"})},onError:A=>{console.error("خطأ في حذف الحولة:",A);let J="حدث خطأ أثناء حذف الحولة";A?.response?.data?.message?J=A.response.data.message:A?.response?.data?.error?J=A.response.data.error:A?.message?J=A.message:typeof A=="string"&&(J=A),w({title:"فشل في حذف الحولة",description:J,variant:"destructive"})}}),B=Ae({mutationFn:A=>me(`/api/transportation-expenses/${A}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(A,J,St)=>{const{projectId:gt,date:Ht}=St||{projectId:s,date:a};v.setQueryData(["/api/projects",gt,"daily-expenses",Ht],Tt=>Tt&&{...Tt,transportationExpenses:Tt.transportationExpenses?.filter(zs=>zs.id!==J)||[]}),v.invalidateQueries({queryKey:["/api/projects",gt,"daily-expenses",Ht]}),v.invalidateQueries({queryKey:["/api/projects",gt,"previous-balance"]}),w({title:"تم الحذف",description:"تم حذف مصروف المواصلات بنجاح"})},onError:A=>{console.error("خطأ في حذف مصروف المواصلات:",A);let J="حدث خطأ أثناء حذف مصروف المواصلات";A?.response?.data?.message?J=A.response.data.message:A?.response?.data?.error?J=A.response.data.error:A?.message?J=A.message:typeof A=="string"&&(J=A),w({title:"فشل في حذف مصروف المواصلات",description:J,variant:"destructive"})}}),se=Ae({mutationFn:A=>me(`/api/material-purchases/${A}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(A,J,St)=>{const{projectId:gt,date:Ht}=St||{projectId:s,date:a};v.setQueryData(["/api/projects",gt,"daily-expenses",Ht],Tt=>Tt&&{...Tt,materialPurchases:Tt.materialPurchases?.filter(zs=>zs.id!==J)||[]}),v.invalidateQueries({queryKey:["/api/projects",gt,"daily-expenses",Ht]}),v.invalidateQueries({queryKey:["/api/projects",gt,"material-purchases"]}),v.invalidateQueries({queryKey:["/api/projects",gt,"previous-balance"]}),w({title:"تم الحذف",description:"تم حذف شراء المواد بنجاح"})},onError:A=>{console.error("خطأ في حذف شراء المواد:",A);let J="حدث خطأ أثناء حذف شراء المواد";A?.response?.data?.message?J=A.response.data.message:A?.response?.data?.error?J=A.response.data.error:A?.message?J=A.message:typeof A=="string"&&(J=A),w({title:"فشل في حذف شراء المواد",description:J,variant:"destructive"})}}),ae=Ae({mutationFn:A=>me(`/api/worker-attendance/${A}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(A,J,St)=>{const{projectId:gt,date:Ht}=St||{projectId:s,date:a};v.setQueryData(["/api/projects",gt,"daily-expenses",Ht],Tt=>Tt&&{...Tt,workerAttendance:Tt.workerAttendance?.filter(zs=>zs.id!==J)||[]}),v.invalidateQueries({queryKey:["/api/projects",gt,"daily-expenses",Ht]}),v.invalidateQueries({queryKey:["/api/projects",gt,"attendance"]}),v.invalidateQueries({queryKey:["/api/projects",gt,"previous-balance"]}),w({title:"تم الحذف",description:"تم حذف حضور العامل بنجاح"})},onError:A=>{console.error("خطأ في حذف حضور العامل:",A);let J="حدث خطأ أثناء حذف حضور العامل";A?.response?.data?.message?J=A.response.data.message:A?.response?.data?.error?J=A.response.data.error:A?.message?J=A.message:typeof A=="string"&&(J=A),w({title:"فشل في حذف حضور العامل",description:J,variant:"destructive"})}}),Y=Ae({mutationFn:A=>me(`/api/worker-transfers/${A}`,"DELETE"),onMutate:()=>({projectId:s,date:a}),onSuccess:(A,J,St)=>{const{projectId:gt,date:Ht}=St||{projectId:s,date:a};v.setQueryData(["/api/projects",gt,"daily-expenses",Ht],Tt=>Tt&&{...Tt,workerTransfers:Tt.workerTransfers?.filter(zs=>zs.id!==J)||[]}),v.invalidateQueries({queryKey:["/api/projects",gt,"daily-expenses",Ht]}),v.invalidateQueries({queryKey:["/api/projects",gt,"previous-balance"]}),w({title:"تم الحذف",description:"تم حذف حوالة العامل بنجاح"})},onError:A=>{console.error("خطأ في حذف حوالة العامل:",A);let J="حدث خطأ أثناء حذف حوالة العامل";A?.response?.data?.message?J=A.response.data.message:A?.response?.data?.error?J=A.response.data.error:A?.message?J=A.message:typeof A=="string"&&(J=A),w({title:"فشل في حذف حوالة العامل",description:J,variant:"destructive"})}}),pe=Ae({mutationFn:({id:A,data:J})=>me(`/api/fund-transfers/${A}`,"PATCH",J),onSuccess:async(A,{id:J})=>{v.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),v.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),m&&await V("senderNames",m),x&&await V("transferNumbers",x),v.invalidateQueries({queryKey:["/api/autocomplete"]}),Pe(),w({title:"تم التحديث",description:"تم تحديث العهدة بنجاح"})},onError:A=>{console.error("خطأ في تحديث الحولة:",A);let J="حدث خطأ أثناء تحديث الحولة";A?.response?.data?.message?J=A.response.data.message:A?.message&&(J=A.message),w({title:"فشل في تحديث الحولة",description:J,variant:"destructive"})}}),Pe=()=>{c(""),h(""),p(""),g(""),j(null)},nt=A=>{c(A.amount),h(A.senderName||""),p(A.transferNumber||""),g(A.transferType),j(A.id)},Ot=()=>{if(!s){w({title:"خطأ",description:"يرجى اختيار المشروع أولاً",variant:"destructive"});return}if(!d||d.trim()===""||parseFloat(d)<=0){w({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!k||k.trim()===""){w({title:"خطأ",description:"يرجى اختيار نوع التحويل",variant:"destructive"});return}const A={projectId:s,amount:d.toString(),senderName:m.trim()||"غير محدد",transferNumber:x.trim()||null,transferType:k,transferDate:new Date(a+"T12:00:00.000Z"),notes:""};b?pe.mutate({id:b,data:A}):qe.mutate(A)},Zs=Ae({mutationFn:({id:A,data:J})=>me(`/api/transportation-expenses/${A}`,"PATCH",J),onSuccess:async(A,{id:J})=>{v.invalidateQueries({queryKey:["/api/projects",s,"daily-expenses",a]}),v.invalidateQueries({queryKey:["/api/projects",s,"previous-balance"]}),y&&await V("transportDescriptions",y),S&&await V("notes",S),as(),w({title:"تم التحديث",description:"تم تحديث مصروف المواصلات بنجاح"})},onError:()=>{w({title:"خطأ",description:"حدث خطأ أثناء تحديث المصروف",variant:"destructive"})}}),as=()=>{M(""),T(""),I(""),z(null)},Ys=A=>{M(A.description),T(A.amount),I(A.notes||""),z(A.id)},Er=()=>{if(!s||!y||!N){w({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const A={projectId:s,amount:N,description:y,date:a,notes:S};E?Zs.mutate({id:E,data:A}):he.mutate(A)},F=()=>{try{const A=Array.isArray(H)?H.filter(Le=>Le&&typeof Le=="object"):[],J=Array.isArray(L)?L.filter(Le=>Le&&typeof Le=="object"):[],St=Array.isArray(Q)?Q.filter(Le=>Le&&typeof Le=="object"):[],gt=Array.isArray(Ne)?Ne.filter(Le=>Le&&typeof Le=="object"):[],Ht=Array.isArray(pt)?pt.filter(Le=>Le&&typeof Le=="object"):[],Tt=Array.isArray(st)?st.filter(Le=>Le&&typeof Le=="object"):[],zs=Array.isArray(ce)?ce.filter(Le=>Le&&typeof Le=="object"):[],yu=A.reduce((Le,Qt)=>{const gs=Mr(Qt.paidAmount);return Le+gs},0),vu=J.reduce((Le,Qt)=>{const gs=Mr(Qt.amount);return Le+gs},0),bu=St.filter(Le=>Le.purchaseType==="نقد").reduce((Le,Qt)=>{const gs=Mr(Qt.totalAmount);return Le+gs},0),ju=gt.reduce((Le,Qt)=>{const gs=Mr(Qt.amount);return Le+gs},0),Nu=Ht.reduce((Le,Qt)=>{const gs=Mr(Qt.amount);return Le+gs},0),qi=Tt.reduce((Le,Qt)=>{const gs=Mr(Qt.amount);return Le+gs},0),Ui=zs.filter(Le=>Le.toProjectId===s).reduce((Le,Qt)=>{const gs=Mr(Qt.amount);return Le+gs},0),wu=zs.filter(Le=>Le.fromProjectId===s).reduce((Le,Qt)=>{const gs=Mr(Qt.amount);return Le+gs},0),wl=Mr(i);console.log("🧮 [calculateTotals] تفاصيل الحساب:",{carriedForward:i,carriedAmount:wl,totalFundTransfers:qi,incomingProjectTransfers:Ui,calculation:`${wl} + ${qi} + ${Ui}`});const kl=wl+qi+Ui,Tl=yu+vu+bu+ju+Nu+wu,ku=kl-Tl;console.log("✅ [calculateTotals] النتيجة النهائية:",{totalIncome:kl,totalExpenses:Tl,remainingBalance:ku});const Wi={totalWorkerWages:yu,totalTransportation:vu,totalMaterialCosts:bu,totalWorkerTransfers:ju,totalMiscExpenses:Nu,totalFundTransfers:qi,incomingProjectTransfers:Ui,outgoingProjectTransfers:wu,totalIncome:kl,totalExpenses:Tl,remainingBalance:ku},I1=1e8;return Object.keys(Wi).forEach(Le=>{const Qt=Wi[Le];typeof Qt=="number"&&Math.abs(Qt)>I1&&(console.warn(`⚠️ [DailyExpenses] قيمة غير منطقية في ${Le}:`,Qt),Le!=="remainingBalance"&&(Wi[Le]=0))}),Wi}catch(A){return console.error("❌ [DailyExpenses] خطأ في calculateTotals:",A),{totalWorkerWages:0,totalTransportation:0,totalMaterialCosts:0,totalWorkerTransfers:0,totalMiscExpenses:0,totalFundTransfers:0,incomingProjectTransfers:0,outgoingProjectTransfers:0,totalIncome:0,totalExpenses:0,remainingBalance:0}}},Ce=()=>{if(!s){w({title:"خطأ",description:"يرجى اختيار المشروع أولاً",variant:"destructive"});return}const A=F();_.mutate({projectId:s,date:a,carriedForwardAmount:i,totalFundTransfers:A.totalFundTransfers.toString(),totalWorkerWages:A.totalWorkerWages.toString(),totalMaterialCosts:A.totalMaterialCosts.toString(),totalTransportationCosts:A.totalTransportation.toString(),totalIncome:A.totalIncome.toString(),totalExpenses:A.totalExpenses.toString(),remainingBalance:A.remainingBalance.toString()})},_e=f.useMemo(()=>{try{const A=F();if(!A||typeof A!="object")throw console.warn("⚠️ [DailyExpenses] calculateTotals returned invalid result:",A),new Error("Invalid result from calculateTotals");return A}catch(A){return console.error("❌ [DailyExpenses] خطأ في حساب المجاميع:",A),{totalWorkerWages:0,totalTransportation:0,totalMaterialCosts:0,totalWorkerTransfers:0,totalMiscExpenses:0,totalFundTransfers:0,incomingProjectTransfers:0,outgoingProjectTransfers:0,totalIncome:0,totalExpenses:0,remainingBalance:0}}},[H,L,Q,Ne,pt,st,ce,i,s]),Mt={fundTransfers:Array.isArray(st)&&st.length>0,attendance:Array.isArray(H)&&H.length>0,transportation:Array.isArray(L)&&L.length>0,materials:Array.isArray(Q)&&Q.length>0,workerTransfers:Array.isArray(Ne)&&Ne.length>0,miscExpenses:Array.isArray(pt)&&pt.length>0},Ee=Object.keys(Mt).length,xs=Object.values(Mt).filter(Boolean).length;return e.jsxs("div",{className:"p-4 slide-in",children:[e.jsx(Ii,{selectedProjectId:s,onProjectChange:(A,J)=>r(A,J)}),s&&e.jsx(ee,{className:`mb-3 border-l-4 ${xs===0?"border-l-amber-400 bg-amber-50/30":xs===Ee?"border-l-green-500 bg-green-50/30":"border-l-blue-500 bg-blue-50/30"}`,children:e.jsxs(oe,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${xs===0?"bg-amber-400":xs===Ee?"bg-green-500":"bg-blue-500"}`}),e.jsxs("span",{className:"text-sm font-medium",children:["بيانات يوم ",ur(a)]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-lg arabic-numbers",children:xs}),e.jsxs("span",{className:"text-muted-foreground",children:["/",Ee]})]}),xs===0&&e.jsx("span",{className:"text-amber-700 bg-amber-100 px-3 py-1 rounded-full text-xs font-medium",children:"لا توجد بيانات"}),xs>0&&xs<Ee&&e.jsx("span",{className:"text-blue-700 bg-blue-100 px-3 py-1 rounded-full text-xs font-medium",children:"بيانات جزئية"}),xs===Ee&&e.jsx("span",{className:"text-green-700 bg-green-100 px-3 py-1 rounded-full text-xs font-medium",children:"بيانات كاملة ✓"})]})]}),xs>0&&e.jsxs("div",{className:"mt-2 flex gap-1 flex-wrap",children:[Mt.fundTransfers&&e.jsx("span",{className:"bg-primary/10 text-primary text-xs px-2 py-1 rounded",children:"عهدة"}),Mt.attendance&&e.jsx("span",{className:"bg-success/10 text-success text-xs px-2 py-1 rounded",children:"حضور"}),Mt.transportation&&e.jsx("span",{className:"bg-secondary/10 text-secondary text-xs px-2 py-1 rounded",children:"نقل"}),Mt.materials&&e.jsx("span",{className:"bg-green-500/10 text-green-600 text-xs px-2 py-1 rounded",children:"مواد"}),Mt.workerTransfers&&e.jsx("span",{className:"bg-orange-500/10 text-orange-600 text-xs px-2 py-1 rounded",children:"حوالات"}),Mt.miscExpenses&&e.jsx("span",{className:"bg-purple-500/10 text-purple-600 text-xs px-2 py-1 rounded",children:"متنوعة"})]})]})}),e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-1",children:"التاريخ"}),e.jsx(je,{type:"date",value:a,onChange:A=>n(A.target.value)})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-1",children:"المبلغ المتبقي السابق"}),e.jsx(je,{type:"number",inputMode:"decimal",value:i,onChange:A=>o(A.target.value),placeholder:"0",className:"text-center arabic-numbers"})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("h4",{className:"font-medium text-foreground mb-2",children:"تحويل عهدة جديدة"}),at&&e.jsx("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm",children:["خطأ في جلب البيانات: ",at.message]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-2",children:[e.jsx(je,{type:"number",inputMode:"decimal",value:d,onChange:A=>c(A.target.value),placeholder:"المبلغ *",className:"text-center",min:"0",step:"0.01"}),e.jsx(_t,{value:m,onChange:h,category:"senderNames",placeholder:"اسم المرسل"})]}),e.jsx(_t,{type:"number",inputMode:"numeric",value:x,onChange:p,category:"transferNumbers",placeholder:"رقم الحولة",className:"w-full mb-2 arabic-numbers"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_t,{value:k,onChange:g,category:"transferTypes",placeholder:"نوع التحويل *",className:"flex-1"}),e.jsx(K,{onClick:Ot,size:"sm",className:"bg-primary",disabled:qe.isPending||pe.isPending,"data-testid":"button-add-fund-transfer",children:qe.isPending||pe.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):b?e.jsx(Xa,{className:"h-4 w-4"}):e.jsx(os,{className:"h-4 w-4"})}),b&&e.jsx(K,{onClick:Pe,size:"sm",variant:"outline",children:"إلغاء"})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("h5",{className:"text-sm font-medium text-muted-foreground mb-2",children:"العهد المضافة اليوم:"}),tt?e.jsx("div",{className:"text-center text-muted-foreground",children:"جاري التحميل..."}):Array.isArray(st)&&st.length>0?e.jsxs("div",{className:"space-y-2",children:[ds.map((A,J)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsxs("div",{className:"text-sm flex-1",children:[e.jsx("div",{children:A.senderName||"غير محدد"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:A.transferType})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Ge(A.amount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>nt(A),"data-testid":"button-edit-fund-transfer",children:e.jsx(Or,{className:"h-3 w-3"})}),e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>$.mutate(A.id),disabled:$.isPending,"data-testid":"button-delete-fund-transfer",children:$.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(es,{className:"h-3 w-3"})})]})]})]},A.id||J)),e.jsxs("div",{className:"text-left pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي العهد: "}),e.jsx("span",{className:"font-bold text-primary arabic-numbers",children:Ge(_e.totalFundTransfers)})]})]}):e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(Ns,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["لا توجد تحويلات عهد للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500",children:"يمكنك إضافة تحويل جديد أو اختيار تاريخ آخر"})]})]})]})]})}),e.jsx(ee,{className:"mb-3",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Zt,{className:"text-primary ml-2 h-5 w-5"}),"أجور العمال"]}),yt.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(Zt,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا يوجد حضور عمال للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اذهب إلى صفحة حضور العمال لتسجيل الحضور"})]}):e.jsxs("div",{className:"space-y-2",children:[yt.map((A,J)=>{const St=C.find(gt=>gt.id===A.workerId);return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsx("span",{className:"text-sm",children:St?.name||`عامل ${J+1}`}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Ge(A.paidAmount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{t(`/worker-attendance?edit=${A.id}&worker=${A.workerId}&date=${a}`)},children:e.jsx(Or,{className:"h-3 w-3"})}),e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>ae.mutate(A.id),disabled:ae.isPending,"data-testid":"button-delete-worker-attendance",children:ae.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(es,{className:"h-3 w-3"})})]})]})]},J)}),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي أجور العمال: "}),e.jsx("span",{className:"font-bold text-primary arabic-numbers",children:Ge(_e.totalWorkerWages)})]})]})]})}),e.jsx(ee,{className:"mb-3",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Du,{className:"text-secondary ml-2 h-5 w-5"}),"أجور المواصلات"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(_t,{value:y,onChange:M,category:"transportDescriptions",placeholder:"الوصف"}),e.jsx(je,{type:"number",inputMode:"decimal",value:N,onChange:A=>T(A.target.value),placeholder:"المبلغ",className:"text-center arabic-numbers"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_t,{value:S,onChange:I,category:"notes",placeholder:"ملاحظات",className:"flex-1"}),e.jsx(K,{onClick:Er,size:"sm",className:"bg-secondary",disabled:he.isPending||Zs.isPending,"data-testid":"button-add-transportation",children:he.isPending||Zs.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border border-white border-t-transparent"}):E?e.jsx(Xa,{className:"h-4 w-4"}):e.jsx(os,{className:"h-4 w-4"})}),E&&e.jsx(K,{onClick:as,size:"sm",variant:"outline",children:"إلغاء"})]}),Me.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200 mt-3",children:[e.jsx(Du,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا توجد مصاريف نقل للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"أضف مصاريف جديدة أو اختر تاريخ آخر"})]}):e.jsxs("div",{className:"mt-3 space-y-2",children:[Me.map((A,J)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsx("span",{className:"text-sm flex-1",children:A.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium arabic-numbers",children:Ge(A.amount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>Ys(A),"data-testid":"button-edit-transportation",children:e.jsx(Or,{className:"h-3 w-3"})}),e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>B.mutate(A.id),disabled:B.isPending,"data-testid":"button-delete-transportation",children:B.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(es,{className:"h-3 w-3"})})]})]})]},J)),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي النقل: "}),e.jsx("span",{className:"font-bold text-secondary arabic-numbers",children:Ge(_e.totalTransportation)})]})]})]})]})}),e.jsx(ee,{className:"mb-3",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(ra,{className:"text-success ml-2 h-5 w-5"}),"شراء مواد"]}),!Array.isArray(Q)||Q.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(ra,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا توجد مشتريات مواد للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اذهب إلى شراء المواد لإضافة مشتريات جديدة"})]}):e.jsxs("div",{className:"space-y-2 mb-3",children:[bt.map((A,J)=>{const St=A.materialName||A.material?.name||"مادة غير محددة",gt=A.materialUnit||A.unit||A.material?.unit||"وحدة",Ht=A.materialCategory||A.material?.category;return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsxs("div",{className:"text-sm flex-1",children:[e.jsx("div",{className:"font-medium",children:St}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[A.quantity," ",gt," × ",Ge(A.unitPrice)]}),A.supplierName&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["المورد: ",A.supplierName]}),A.purchaseType&&e.jsx("div",{className:`text-xs font-medium ${A.purchaseType==="آجل"?"text-orange-600":"text-green-600"}`,children:A.purchaseType==="آجل"?"⏰ آجل":"💵 نقد"}),Ht&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["الفئة: ",Ht]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium arabic-numbers ${A.purchaseType==="آجل"?"text-orange-600":"text-green-600"}`,children:Ge(A.totalAmount)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{t(`/material-purchase?edit=${A.id}`)},children:e.jsx(Or,{className:"h-3 w-3"})}),e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>se.mutate(A.id),disabled:se.isPending,"data-testid":"button-delete-material-purchase",children:se.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(es,{className:"h-3 w-3"})})]})]})]},J)}),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المشتريات النقدية (تؤثر على الرصيد): "}),e.jsx("span",{className:"font-bold text-success arabic-numbers",children:Ge(_e.totalMaterialCosts)})]}),(()=>{const A=Array.isArray(Q)?Q.filter(J=>J.purchaseType==="آجل").reduce((J,St)=>J+parseFloat(St.totalAmount||"0"),0):0;return A>0?e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المشتريات الآجلة (لا تؤثر على الرصيد): "}),e.jsx("span",{className:"font-bold text-orange-600 arabic-numbers",children:Ge(A)})]}):null})()]})]}),e.jsxs(K,{variant:"outline",onClick:()=>t("/material-purchase"),className:"w-full border-2 border-dashed",children:[e.jsx(os,{className:"ml-2 h-4 w-4"}),"إضافة شراء مواد"]})]})}),e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-foreground mb-3 flex items-center",children:[e.jsx(Ns,{className:"text-warning ml-2 h-5 w-5"}),"حولة من حساب العمال"]}),!Array.isArray(Ne)||Ne.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(Vn,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["لا توجد حوالات عمال للتاريخ ",a]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اذهب إلى صفحة العمال لإدارة الحوالات"})]}):e.jsxs("div",{className:"space-y-2 mb-3",children:[rs.map((A,J)=>{const St=C.find(gt=>gt.id===A.workerId);return e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded border-r-4 border-warning",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:St?.name||"عامل غير معروف"}),e.jsx("span",{className:"font-bold text-warning arabic-numbers",children:Ge(A.amount)})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{children:["المستلم: ",A.recipientName]}),A.recipientPhone&&e.jsxs("span",{className:"mr-3",children:["الهاتف: ",A.recipientPhone]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["طريقة التحويل: ",A.transferMethod==="hawaleh"?"حولة":A.transferMethod==="bank"?"تحويل بنكي":"نقداً"]})]}),e.jsxs("div",{className:"flex gap-1 mr-2",children:[e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{t(`/worker-accounts?edit=${A.id}&worker=${A.workerId}`)},children:e.jsx(Or,{className:"h-3 w-3"})}),e.jsx(K,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("هل أنت متأكد من حذف حوالة العامل؟ هذا الإجراء لا يمكن التراجع عنه.")&&Y.mutate(A.id)},disabled:Y.isPending,"data-testid":"button-delete-worker-transfer",children:Y.isPending?e.jsx("div",{className:"h-3 w-3 animate-spin rounded-full border border-red-600 border-t-transparent"}):e.jsx(es,{className:"h-3 w-3"})})]})]},J)}),e.jsxs("div",{className:"text-left mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي الحوالات: "}),e.jsx("span",{className:"font-bold text-warning arabic-numbers",children:Ge(_e.totalWorkerTransfers)})]})]}),e.jsxs(K,{variant:"outline",onClick:()=>t("/worker-accounts"),className:"w-full border-2 border-dashed",children:[e.jsx(os,{className:"ml-2 h-4 w-4"}),"إرسال حولة جديدة"]})]})}),s&&e.jsx(T4,{projectId:s,selectedDate:a}),e.jsx(ee,{className:"bg-background border-border/50",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vn,{className:"h-5 w-5 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"ترحيل الأموال بين المشاريع"})]}),e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>u(!l),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Wo,{className:"h-4 w-4 ml-1"}),"إخفاء"]}):e.jsxs(e.Fragment,{children:[e.jsx(_i,{className:"h-4 w-4 ml-1"}),"إظهار"]})})]}),l&&e.jsx("div",{className:"space-y-3",children:ne.map(A=>e.jsx("div",{className:`p-3 rounded border-r-4 ${A.toProjectId===s?"bg-green-50 border-green-500":"bg-red-50 border-red-500"}`,children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:A.toProjectId===s?e.jsxs("span",{className:"text-green-700",children:["أموال واردة من: ",A.fromProjectName]}):e.jsxs("span",{className:"text-red-700",children:["أموال صادرة إلى: ",A.toProjectName]})}),e.jsxs("span",{className:`font-bold arabic-numbers ${A.toProjectId===s?"text-green-600":"text-red-600"}`,children:[A.toProjectId===s?"+":"-",Ge(A.amount)]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{children:["السبب: ",A.transferReason||"ترحيل أموال"]}),A.description&&e.jsxs("div",{className:"mt-1",children:["الوصف: ",A.description]}),e.jsxs("div",{className:"mt-1",children:["التاريخ: ",ur(A.transferDate)]})]})]})})},A.id))}),e.jsx("div",{className:"mt-4 pt-3 border-t",children:e.jsxs(K,{variant:"outline",onClick:()=>t("/project-transfers"),className:"w-full border-2 border-dashed border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(Vn,{className:"ml-2 h-4 w-4"}),"إدارة عمليات ترحيل الأموال"]})})]})}),e.jsx(k4,{totalIncome:_e.totalIncome,totalExpenses:_e.totalExpenses,remainingBalance:_e.remainingBalance}),e.jsx("div",{className:"mt-4",children:e.jsxs(K,{onClick:Ce,disabled:_.isPending,className:"w-full bg-success hover:bg-success/90 text-success-foreground",children:[e.jsx(Xa,{className:"ml-2 h-4 w-4"}),_.isPending?"جاري الحفظ...":"حفظ المصروفات"]})})]})}function A4(){return e.jsx(Cc,{children:e.jsx(S4,{})})}const Fa=f.forwardRef(({className:t,...s},r)=>e.jsx("textarea",{className:de("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...s}));Fa.displayName="Textarea";var Kd="Radio",[_4,xb]=Os(Kd),[C4,P4]=_4(Kd),gb=f.forwardRef((t,s)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:i,disabled:o,value:l="on",onCheck:u,form:d,...c}=t,[m,h]=f.useState(null),x=Pt(s,g=>h(g)),p=f.useRef(!1),k=m?d||!!m.closest("form"):!0;return e.jsxs(C4,{scope:r,checked:n,disabled:o,children:[e.jsx(xt.button,{type:"button",role:"radio","aria-checked":n,"data-state":jb(n),"data-disabled":o?"":void 0,disabled:o,value:l,...c,ref:x,onClick:Te(t.onClick,g=>{n||u?.(),k&&(p.current=g.isPropagationStopped(),p.current||g.stopPropagation())})}),k&&e.jsx(bb,{control:m,bubbles:!p.current,name:a,value:l,checked:n,required:i,disabled:o,form:d,style:{transform:"translateX(-100%)"}})]})});gb.displayName=Kd;var yb="RadioIndicator",vb=f.forwardRef((t,s)=>{const{__scopeRadio:r,forceMount:a,...n}=t,i=P4(yb,r);return e.jsx(Cs,{present:a||i.checked,children:e.jsx(xt.span,{"data-state":jb(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s})})});vb.displayName=yb;var E4="RadioBubbleInput",bb=f.forwardRef(({__scopeRadio:t,control:s,checked:r,bubbles:a=!0,...n},i)=>{const o=f.useRef(null),l=Pt(o,i),u=zc(r),d=Bc(s);return f.useEffect(()=>{const c=o.current;if(!c)return;const m=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(m,"checked").set;if(u!==r&&x){const p=new Event("click",{bubbles:a});x.call(c,r),c.dispatchEvent(p)}},[u,r,a]),e.jsx(xt.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:l,style:{...n.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});bb.displayName=E4;function jb(t){return t?"checked":"unchecked"}var D4=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],cl="RadioGroup",[M4]=Os(cl,[bn,xb]),Nb=bn(),wb=xb(),[I4,R4]=M4(cl),kb=f.forwardRef((t,s)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:i,required:o=!1,disabled:l=!1,orientation:u,dir:d,loop:c=!0,onValueChange:m,...h}=t,x=Nb(r),p=Si(d),[k,g]=Ma({prop:i,defaultProp:n??null,onChange:m,caller:cl});return e.jsx(I4,{scope:r,name:a,required:o,disabled:l,value:k,onValueChange:g,children:e.jsx(zd,{asChild:!0,...x,orientation:u,dir:p,loop:c,children:e.jsx(xt.div,{role:"radiogroup","aria-required":o,"aria-orientation":u,"data-disabled":l?"":void 0,dir:p,...h,ref:s})})})});kb.displayName=cl;var Tb="RadioGroupItem",Sb=f.forwardRef((t,s)=>{const{__scopeRadioGroup:r,disabled:a,...n}=t,i=R4(Tb,r),o=i.disabled||a,l=Nb(r),u=wb(r),d=f.useRef(null),c=Pt(s,d),m=i.value===n.value,h=f.useRef(!1);return f.useEffect(()=>{const x=k=>{D4.includes(k.key)&&(h.current=!0)},p=()=>h.current=!1;return document.addEventListener("keydown",x),document.addEventListener("keyup",p),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",p)}},[]),e.jsx(Bd,{asChild:!0,...l,focusable:!o,active:m,children:e.jsx(gb,{disabled:o,required:i.required,checked:m,...u,...n,name:i.name,ref:c,onCheck:()=>i.onValueChange(n.value),onKeyDown:Te(x=>{x.key==="Enter"&&x.preventDefault()}),onFocus:Te(n.onFocus,()=>{h.current&&d.current?.click()})})})});Sb.displayName=Tb;var F4="RadioGroupIndicator",Ab=f.forwardRef((t,s)=>{const{__scopeRadioGroup:r,...a}=t,n=wb(r);return e.jsx(vb,{...n,...a,ref:s})});Ab.displayName=F4;var _b=kb,Cb=Sb,$4=Ab;const Pb=f.forwardRef(({className:t,...s},r)=>e.jsx(_b,{className:de("grid gap-2",t),...s,ref:r}));Pb.displayName=_b.displayName;const lo=f.forwardRef(({className:t,...s},r)=>e.jsx(Cb,{ref:r,className:de("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx($4,{className:"flex items-center justify-center",children:e.jsx(h0,{className:"h-2.5 w-2.5 fill-current text-current"})})}));lo.displayName=Cb.displayName;function yh(){const[,t]=or(),{selectedProjectId:s,selectProject:r}=Mi(),n=new URLSearchParams(window.location.search).get("edit"),[i,o]=f.useState(""),[l,u]=f.useState(""),[d,c]=f.useState(""),[m,h]=f.useState(""),[x,p]=f.useState(""),[k,g]=f.useState("نقد"),[b,j]=f.useState(""),[y,M]=f.useState(""),[N,T]=f.useState(er()),[S,I]=f.useState(er()),[E,z]=f.useState(""),[w,v]=f.useState(""),[D,V]=f.useState(null),[X,C]=f.useState(!1),[q,ue]=f.useState(""),[R,fe]=f.useState(""),[ce,ne]=f.useState(""),[ye,tt]=f.useState(""),[at,st]=f.useState("نقد"),[H,L]=f.useState(""),{toast:Q}=Dt(),Ne=Gt(),{setFloatingAction:pt}=Ps(),yt=()=>{if(!s){Q({title:"خطأ",description:"يرجى اختيار مشروع أولاً",variant:"destructive"});return}document.querySelector('[type="submit"]')?.click()};f.useEffect(()=>(pt(yt,"حفظ المشتريات"),()=>pt(null)),[pt,s]);const Me=async(F,Ce)=>{if(!(!Ce||typeof Ce!="string"||!Ce.trim()))try{await me("/api/autocomplete","POST",{category:F,value:Ce.trim()})}catch(_e){console.log(`Failed to save autocomplete value for ${F}:`,_e)}},bt=()=>{ue(""),fe(""),ne(""),tt(""),st("نقد"),L("")},rs=Ae({mutationFn:async F=>(await Promise.all([Me("supplier_name",q),Me("supplier_contact_person",R),Me("supplier_phone",ce),Me("supplier_address",ye),Me("supplier_payment_terms",at)]),me("/api/suppliers","POST",F)),onSuccess:F=>{Ne.invalidateQueries({queryKey:["/api/suppliers"]}),Q({title:"تم إضافة المورد بنجاح",description:`تم إضافة المورد "${q}" إلى قاعدة البيانات`}),j(q),C(!1),bt()},onError:F=>{Q({title:"خطأ في إضافة المورد",description:F?.message||"حدث خطأ أثناء إضافة المورد. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),ds=async F=>{if(F.preventDefault(),!q.trim()){Q({title:"خطأ في البيانات",description:"يرجى إدخال اسم المورد",variant:"destructive"});return}const Ce={name:q.trim(),contactPerson:R.trim()||void 0,phone:ce.trim()||void 0,address:ye.trim()||void 0,paymentTerms:at||void 0,notes:H.trim()||void 0,isActive:!0};rs.mutate(Ce)},{data:G=[]}=Se({queryKey:["/api/materials"],queryFn:async()=>{try{const F=await me("/api/materials","GET");return F&&F.data&&Array.isArray(F.data)?F.data:Array.isArray(F)?F:[]}catch(F){return console.error("Error fetching materials:",F),[]}},staleTime:3e5,gcTime:6e5}),{data:qe=[]}=Se({queryKey:["/api/suppliers"],queryFn:async()=>{try{const F=await me("/api/suppliers","GET");return F&&F.data&&Array.isArray(F.data)?F.data:Array.isArray(F)?F:[]}catch(F){return console.error("Error fetching suppliers:",F),[]}},staleTime:3e5,gcTime:6e5}),{data:he,isLoading:_}=Se({queryKey:["/api/material-purchases",n],queryFn:async()=>{if(!n)return null;try{console.log(`🔄 جلب بيانات المشترية للتعديل: ${n}`);const F=await me(`/api/material-purchases/${n}`,"GET");console.log("📊 استجابة جلب بيانات التعديل:",F);let Ce=null;if(F&&F.data)Ce=F.data;else if(F&&F.id)Ce=F;else return console.warn("⚠️ لا توجد بيانات في الاستجابة"),null;return console.log("✅ تم جلب بيانات المشترية للتعديل:",Ce),Ce}catch(F){return console.error("❌ خطأ في جلب بيانات المشترية للتعديل:",F),null}},enabled:!!n,retry:1,staleTime:0});f.useEffect(()=>{if(he&&n){console.log("🔄 ملء النموذج ببيانات التعديل:",he),console.log("🔍 تحليل البيانات المسترجعة:",{purchaseToEdit:{materialName:he.materialName,materialCategory:he.materialCategory,materialUnit:he.materialUnit,unit:he.unit},material:he.material?{name:he.material.name,category:he.material.category,unit:he.material.unit}:"لا توجد بيانات مادة مرتبطة"});const F=he.materialName||he.material?.name||"",Ce=he.materialCategory||he.material?.category||"",_e=he.materialUnit||he.unit||he.material?.unit||"";console.log("📝 القيم النهائية التي سيتم ملؤها:",{materialName:F,materialCategory:Ce,materialUnit:_e}),o(F),u(Ce),c(_e),h(he.quantity?.toString()||""),p(he.unitPrice?.toString()||""),g(he.purchaseType||"نقد"),j(he.supplierName||""),M(he.invoiceNumber||""),T(he.invoiceDate||er()),I(he.purchaseDate||er()),z(he.notes||""),v(he.invoicePhoto||""),V(he.id),console.log("✅ تم ملء النموذج بالبيانات:",{materialName:F,materialCategory:Ce,materialUnit:_e,quantity:he.quantity,unitPrice:he.unitPrice,purchaseType:he.purchaseType})}},[he,n]),Ae({mutationFn:F=>me("/api/materials","POST",F),onSuccess:()=>{Ne.invalidateQueries({queryKey:["/api/materials"]})},onError:F=>{console.error("Material creation error:",F);let Ce="حدث خطأ أثناء إضافة المادة";F?.response?.data?.message&&(Ce=F.response.data.message),Q({title:"خطأ",description:Ce,variant:"destructive"})}}),Array.isArray(G)&&G.map(F=>F.name),Array.isArray(G)&&Array.from(new Set(G.map(F=>F.category))),Array.isArray(G)&&Array.from(new Set(G.map(F=>F.unit)));const $=Array.isArray(qe)?qe.filter(F=>F.isActive):[],B=Ae({mutationFn:async F=>(await Promise.all([Me("materialNames",i),Me("materialCategories",l),Me("materialUnits",d),Me("supplierNames",b),Me("invoiceNumbers",y),Me("notes",E)]),me("/api/material-purchases","POST",F)),onSuccess:async()=>{Ne.invalidateQueries({queryKey:["/api/autocomplete"]}),Q({title:"تم الحفظ",description:"تم حفظ شراء المواد بنجاح"}),se(),Ne.invalidateQueries({queryKey:["/api/projects",s,"material-purchases"]})},onError:async F=>{await Promise.all([Me("materialNames",i),Me("materialCategories",l),Me("materialUnits",d),Me("supplierNames",b),Me("invoiceNumbers",y),Me("notes",E)]),Ne.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("Material purchase error:",F);let Ce="حدث خطأ أثناء حفظ شراء المواد",_e=[];if(F?.response?.data){const Ee=F.response.data;Ee.message&&(Ce=Ee.message),Ee.details&&Array.isArray(Ee.details)?_e=Ee.details:Ee.validationErrors&&Array.isArray(Ee.validationErrors)&&(_e=Ee.validationErrors)}const Mt=_e.length>0?`${Ce}

${_e.map(Ee=>`• ${Ee}`).join(`
`)}`:Ce;Q({title:"خطأ في حفظ شراء المواد",description:Mt,variant:"destructive",duration:8e3})}}),se=()=>{o(""),u(""),c(""),h(""),p(""),g("نقد"),j(""),M(""),T(er()),I(er()),z(""),v(""),V(null)},ae=Ae({mutationFn:async({id:F,data:Ce})=>{console.log("🔄 [PATCH] بدء تحديث المشترية:",{id:F,data:Ce}),await Promise.all([Me("materialNames",i),Me("materialCategories",l),Me("materialUnits",d),Me("supplierNames",b),Me("invoiceNumbers",y),Me("notes",E)]);const _e=await me(`/api/material-purchases/${F}`,"PATCH",Ce);return console.log("✅ [PATCH] استجابة تحديث المشترية:",_e),_e},onSuccess:async()=>{Ne.invalidateQueries({queryKey:["/api/autocomplete"]}),Q({title:"تم التعديل",description:"تم تعديل شراء المواد بنجاح"}),se(),Ne.invalidateQueries({queryKey:["/api/projects",s,"material-purchases"]})},onError:async F=>{await Promise.all([Me("materialNames",i),Me("materialCategories",l),Me("materialUnits",d),Me("supplierNames",b),Me("invoiceNumbers",y),Me("notes",E)]),Ne.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("Material purchase update error:",F);let Ce="حدث خطأ أثناء تحديث شراء المواد",_e=[];if(F?.response?.data){const Ee=F.response.data;Ee.message&&(Ce=Ee.message),Ee.details&&Array.isArray(Ee.details)?_e=Ee.details:Ee.validationErrors&&Array.isArray(Ee.validationErrors)&&(_e=Ee.validationErrors)}const Mt=_e.length>0?`${Ce}

${_e.map(Ee=>`• ${Ee}`).join(`
`)}`:Ce;Q({title:"خطأ في تحديث شراء المواد",description:Mt,variant:"destructive",duration:8e3})}}),Y=Ae({mutationFn:F=>me(`/api/material-purchases/${F}`,"DELETE"),onSuccess:()=>{Q({title:"تم الحذف",description:"تم حذف شراء المواد بنجاح"}),Ne.invalidateQueries({queryKey:["/api/projects",s,"material-purchases"]})},onError:F=>{console.error("Material purchase delete error:",F);let Ce="حدث خطأ أثناء حذف شراء المواد",_e=[];if(F?.response?.data){const Ee=F.response.data;Ee.message&&(Ce=Ee.message),Ee.details&&Array.isArray(Ee.details)&&(_e=Ee.details)}const Mt=_e.length>0?`${Ce}

${_e.map(Ee=>`• ${Ee}`).join(`
`)}`:Ce;Q({title:"خطأ في حذف شراء المواد",description:Mt,variant:"destructive",duration:6e3})}}),pe=()=>{const F=parseFloat(m)||0,Ce=parseFloat(x)||0;return(F*Ce).toFixed(2)},Pe=F=>{const Ce=F.target.files?.[0];if(Ce){const _e=new FileReader;_e.onload=Mt=>{v(Mt.target?.result)},_e.readAsDataURL(Ce)}},nt=(F=!1)=>{if(!s||!i||!d||!m||!x){Q({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const Ce=parseFloat(pe()),_e={projectId:s,materialName:i.trim(),materialCategory:l.trim()||null,materialUnit:d.trim(),quantity:parseFloat(m),unitPrice:parseFloat(x),totalAmount:Ce,purchaseType:k.trim(),supplierName:b?.trim()||"",invoiceNumber:y?.trim()||"",invoiceDate:N||new Date().toISOString().split("T")[0],invoicePhoto:w||"",notes:E?.trim()||"",purchaseDate:S};console.log("💾 بيانات المشترية قبل الحفظ:",{materialName:_e.materialName,materialCategory:_e.materialCategory,materialUnit:_e.materialUnit,isEditing:!!D}),D?ae.mutate({id:D,data:_e}):B.mutate(_e),!F&&!D&&t("/daily-expenses")},{data:Ot=[],isLoading:Zs,refetch:as}=Se({queryKey:["/api/projects",s,"material-purchases"],enabled:!!s,refetchOnMount:!0,refetchOnWindowFocus:!0,staleTime:0}),Ys=Ot.filter(F=>{if(!F.purchaseDate)return!1;const Ce=new Date(F.purchaseDate),_e=new Date(S);return Ce.toDateString()===_e.toDateString()});f.useEffect(()=>{s&&as()},[s,S,as]);const Er=F=>{o(F.materialName||F.material?.name||""),u(F.materialCategory||F.material?.category||""),c(F.materialUnit||F.material?.unit||F.unit||""),h(F.quantity),p(F.unitPrice),g(F.purchaseType||F.paymentType||"نقد"),j(F.supplierName||""),M(F.invoiceNumber||""),T(F.invoiceDate||er()),I(F.purchaseDate||er()),z(F.notes||""),v(F.invoicePhoto||""),V(F.id)};return e.jsxs("div",{className:"p-4 slide-in",children:[_&&n&&e.jsx(ee,{className:"mb-4 border-blue-200 bg-blue-50",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}),e.jsx("span",{className:"text-blue-700",children:"جاري تحميل بيانات المشترية للتعديل..."})]})})}),e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Ai,{className:"ml-2 h-5 w-5 text-primary"}),D?"تعديل مشترية المواد":"اختر المشروع"]}),e.jsx(Ii,{selectedProjectId:s,onProjectChange:(F,Ce)=>r(F,Ce),showHeader:!1,variant:"compact"})]})}),e.jsx(ee,{className:"mb-4",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"اسم المادة"}),e.jsx(_t,{value:i,onChange:o,category:"materialNames",placeholder:"اختر أو أدخل اسم المادة..."})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"فئة المادة"}),e.jsx(_t,{value:l,onChange:u,category:"materialCategories",placeholder:"اختر أو أدخل فئة المادة..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"الكمية"}),e.jsx(je,{type:"number",inputMode:"decimal",value:m,onChange:F=>h(F.target.value),placeholder:"0",className:"text-center arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"الوحدة"}),e.jsx(_t,{value:d,onChange:c,category:"materialUnits",placeholder:"طن، كيس، م³..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"سعر الوحدة"}),e.jsx(je,{type:"number",inputMode:"decimal",value:x,onChange:F=>p(F.target.value),placeholder:"0.00",className:"text-center arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"المبلغ الإجمالي"}),e.jsx(je,{type:"number",value:pe(),readOnly:!0,className:"text-center arabic-numbers bg-muted"})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"نوع الدفع"}),e.jsxs(Pb,{value:k,onValueChange:g,className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx(lo,{value:"نقد",id:"cash"}),e.jsx(re,{htmlFor:"cash",className:"text-sm",children:"نقد"})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx(lo,{value:"آجل",id:"credit"}),e.jsx(re,{htmlFor:"credit",className:"text-sm",children:"آجل"})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx(lo,{value:"توريد",id:"supply"}),e.jsx(re,{htmlFor:"supply",className:"text-sm",children:"توريد"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"اسم المورد/المحل"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(We,{value:b,onValueChange:j,children:[e.jsx(ze,{className:"flex-1",children:e.jsx(Ke,{placeholder:"اختر المورد..."})}),e.jsxs(Be,{children:[$.map(F=>e.jsx(W,{value:F.name,children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:F.name}),F.contactPerson&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["جهة الاتصال: ",F.contactPerson]})]})},F.id)),$.length===0&&e.jsx(W,{value:"no-suppliers",disabled:!0,children:e.jsx("span",{className:"text-muted-foreground",children:"لا توجد موردين مسجلين"})})]})]}),e.jsxs(Ss,{open:X,onOpenChange:C,children:[e.jsx(Cd,{asChild:!0,children:e.jsx(K,{type:"button",variant:"outline",size:"icon",title:"إضافة مورد جديد",children:e.jsx(os,{className:"h-4 w-4"})})}),e.jsxs(js,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsxs(As,{children:[e.jsx(_s,{children:"إضافة مورد جديد"}),e.jsx(Fs,{children:"أدخل معلومات المورد الجديد. جميع الحقول اختيارية عدا اسم المورد."})]}),e.jsxs("form",{onSubmit:ds,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"supplier-name",children:"اسم المورد/المحل *"}),e.jsx(je,{id:"supplier-name",value:q,onChange:F=>ue(F.target.value),placeholder:"مثال: مؤسسة الخضراء للمواد",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"supplier-contact",children:"الشخص المسؤول"}),e.jsx(je,{id:"supplier-contact",value:R,onChange:F=>fe(F.target.value),placeholder:"مثال: أحمد محمد"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"supplier-phone",children:"رقم الهاتف"}),e.jsx(je,{id:"supplier-phone",value:ce,onChange:F=>ne(F.target.value),placeholder:"مثال: 777123456",type:"tel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"supplier-address",children:"العنوان"}),e.jsx(je,{id:"supplier-address",value:ye,onChange:F=>tt(F.target.value),placeholder:"مثال: شارع الستين، صنعاء"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"supplier-payment",children:"شروط الدفع"}),e.jsxs(We,{value:at,onValueChange:st,children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر شروط الدفع"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"نقد",children:"نقد"}),e.jsx(W,{value:"أجل",children:"أجل"}),e.jsx(W,{value:"نقد وأجل",children:"نقد وأجل"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"supplier-notes",children:"ملاحظات"}),e.jsx(Fa,{id:"supplier-notes",value:H,onChange:F=>L(F.target.value),placeholder:"أي ملاحظات إضافية...",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2 space-x-reverse pt-4",children:[e.jsx(K,{type:"button",variant:"outline",onClick:()=>{C(!1),bt()},children:"إلغاء"}),e.jsx(K,{type:"submit",disabled:rs.isPending||!q.trim(),children:rs.isPending?"جاري الإضافة...":"إضافة المورد"})]})]})]})]})]}),$.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"لا توجد موردين مسجلين. اضغط + لإضافة مورد جديد"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"تاريخ الشراء"}),e.jsx(je,{type:"date",value:S,onChange:F=>I(F.target.value),className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"رقم الفاتورة"}),e.jsx(_t,{type:"number",inputMode:"numeric",value:y,onChange:M,category:"invoiceNumbers",placeholder:"رقم الفاتورة",className:"arabic-numbers"})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"تاريخ الفاتورة"}),e.jsx(je,{type:"date",value:N,onChange:F=>T(F.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"صورة الفاتورة"}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[w?e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:w,alt:"Invoice",className:"max-w-full max-h-32 mx-auto rounded"}),e.jsx("p",{className:"text-sm text-success",children:"تم رفع الصورة بنجاح"})]}):e.jsxs(e.Fragment,{children:[e.jsx(mo,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"اضغط لإضافة صورة الفاتورة"})]}),e.jsx(je,{type:"file",accept:"image/*",onChange:Pe,className:"hidden",id:"invoice-photo"}),e.jsx(re,{htmlFor:"invoice-photo",className:"bg-primary text-primary-foreground px-4 py-2 rounded-lg cursor-pointer hover:bg-primary/90 transition-colors inline-block",children:w?"تغيير الصورة":"اختر صورة"})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"block text-sm font-medium text-foreground mb-2",children:"ملاحظات"}),e.jsx(_t,{value:E,onChange:z,category:"notes",placeholder:"أي ملاحظات إضافية..."})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(K,{onClick:()=>nt(!1),disabled:B.isPending||ae.isPending,className:"w-full bg-success hover:bg-success/90 text-success-foreground",children:[e.jsx(Xa,{className:"ml-2 h-4 w-4"}),B.isPending||ae.isPending?"جاري الحفظ...":D?"تحديث الشراء":"حفظ الشراء"]}),!D&&e.jsxs(K,{onClick:()=>nt(!0),disabled:B.isPending,variant:"outline",className:"w-full",children:[e.jsx(os,{className:"ml-2 h-4 w-4"}),"حفظ وإضافة آخر"]}),D&&e.jsx(K,{onClick:se,variant:"outline",className:"w-full",children:"إلغاء التحرير"})]}),Zs&&e.jsx(ee,{className:"mt-6",children:e.jsx(oe,{className:"p-4",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"جاري تحميل المشتريات..."})})}),s&&Ot.length>0&&Ys.length===0&&e.jsx(ee,{className:"mt-6",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(ra,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground/50"}),e.jsxs("h3",{className:"text-lg font-medium mb-2",children:["لا توجد مشتريات في ",new Date(S).toLocaleDateString("en-GB")]}),e.jsx("p",{className:"text-sm",children:"غيّر تاريخ الشراء أعلاه لعرض مشتريات تواريخ أخرى"}),e.jsxs("p",{className:"text-sm mt-1",children:["إجمالي المشتريات المسجلة: ",Ot.length]})]})})}),s&&Ys&&Ys.length>0&&e.jsx(ee,{className:"mt-6",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["المشتريات في ",new Date(S).toLocaleDateString("en-GB")," (",Ys.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"غيّر تاريخ الشراء أعلاه لعرض مشتريات تواريخ أخرى"})]}),e.jsx("div",{className:"space-y-3",children:Ys.map(F=>e.jsx("div",{className:"border rounded-lg p-3 bg-card",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:F.materialName||F.material?.name||"غير محدد"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",F.materialUnit||F.material?.unit||F.unit||"غير محدد",")"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[(F.materialCategory||F.material?.category)&&e.jsxs("p",{children:["الفئة: ",F.materialCategory||F.material?.category]}),e.jsxs("p",{children:["الكمية: ",F.quantity," | السعر: ",Ge(F.unitPrice)]}),e.jsxs("p",{className:"font-medium",children:["الإجمالي: ",Ge(F.totalAmount)]}),F.supplierName&&e.jsxs("p",{children:["المورد: ",F.supplierName]}),F.purchaseType&&e.jsxs("p",{children:["نوع الدفع: ",F.purchaseType]}),F.purchaseDate&&e.jsxs("p",{children:["تاريخ الشراء: ",new Date(F.purchaseDate).toLocaleDateString("en-GB")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{size:"sm",variant:"outline",onClick:()=>Er(F),disabled:D===F.id,children:"تعديل"}),e.jsx(K,{size:"sm",variant:"destructive",onClick:()=>Y.mutate(F.id),disabled:Y.isPending,children:"حذف"})]})]})},F.id))})]})})]})}const te=Symbol.for("drizzle:entityKind");function ns(t,s){if(!t||typeof t!="object")return!1;if(t instanceof s)return!0;if(!Object.prototype.hasOwnProperty.call(s,te))throw new Error(`Class "${s.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(te in r&&r[te]===s[te])return!0;r=Object.getPrototypeOf(r)}return!1}var Zh;Zh=te;class mn{constructor(s,r){O(this,"name");O(this,"keyAsName");O(this,"primary");O(this,"notNull");O(this,"default");O(this,"defaultFn");O(this,"onUpdateFn");O(this,"hasDefault");O(this,"isUnique");O(this,"uniqueName");O(this,"uniqueType");O(this,"dataType");O(this,"columnType");O(this,"enumValues");O(this,"generated");O(this,"generatedIdentity");O(this,"config");this.table=s,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}mapFromDriverValue(s){return s}mapToDriverValue(s){return s}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}O(mn,Zh,"Column");var Yh;Yh=te;class Eb{constructor(s,r,a){O(this,"config");O(this,"$default",this.$defaultFn);O(this,"$onUpdate",this.$onUpdateFn);this.config={name:s,keyAsName:s==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:a,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(s){return this.config.default=s,this.config.hasDefault=!0,this}$defaultFn(s){return this.config.defaultFn=s,this.config.hasDefault=!0,this}$onUpdateFn(s){return this.config.onUpdateFn=s,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(s){this.config.name===""&&(this.config.name=s)}}O(Eb,Yh,"ColumnBuilder");const en=Symbol.for("drizzle:Name");var Jh;Jh=te;class Db{constructor(s,r){O(this,"reference");O(this,"_onUpdate","no action");O(this,"_onDelete","no action");this.reference=()=>{const{name:a,columns:n,foreignColumns:i}=s();return{name:a,columns:n,foreignTable:i[0].table,foreignColumns:i}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(s){return this._onUpdate=s===void 0?"no action":s,this}onDelete(s){return this._onDelete=s===void 0?"no action":s,this}build(s){return new Mb(s,this)}}O(Db,Jh,"PgForeignKeyBuilder");var ef;ef=te;class Mb{constructor(s,r){O(this,"reference");O(this,"onUpdate");O(this,"onDelete");this.table=s,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}getName(){const{name:s,columns:r,foreignColumns:a}=this.reference(),n=r.map(l=>l.name),i=a.map(l=>l.name),o=[this.table[en],...n,a[0].table[en],...i];return s??`${o.join("_")}_fk`}}O(Mb,ef,"PgForeignKey");function V4(t,...s){return t(...s)}function O4(t,s){return`${t[en]}_${s.join("_")}_unique`}function vh(t,s,r){for(let a=s;a<t.length;a++){const n=t[a];if(n==="\\"){a++;continue}if(n==='"')return[t.slice(s,a).replace(/\\/g,""),a+1];if(!r&&(n===","||n==="}"))return[t.slice(s,a).replace(/\\/g,""),a]}return[t.slice(s).replace(/\\/g,""),t.length]}function Ib(t,s=0){const r=[];let a=s,n=!1;for(;a<t.length;){const i=t[a];if(i===","){(n||a===s)&&r.push(""),n=!0,a++;continue}if(n=!1,i==="\\"){a+=2;continue}if(i==='"'){const[u,d]=vh(t,a+1,!0);r.push(u),a=d;continue}if(i==="}")return[r,a+1];if(i==="{"){const[u,d]=Ib(t,a+1);r.push(u),a=d;continue}const[o,l]=vh(t,a,!1);r.push(o),a=l}return[r,a]}function L4(t){const[s]=Ib(t,1);return s}function Rb(t){return`{${t.map(s=>Array.isArray(s)?Rb(s):typeof s=="string"?`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${s}`).join(",")}}`}var tf,sf;class ft extends(sf=Eb,tf=te,sf){constructor(){super(...arguments);O(this,"foreignKeyConfigs",[])}array(r){return new $b(this.config.name,this,r)}references(r,a={}){return this.foreignKeyConfigs.push({ref:r,actions:a}),this}unique(r,a){return this.config.isUnique=!0,this.config.uniqueName=r,this.config.uniqueType=a?.nulls,this}generatedAlwaysAs(r){return this.config.generated={as:r,type:"always",mode:"stored"},this}buildForeignKeys(r,a){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>V4((o,l)=>{const u=new Db(()=>{const d=o();return{columns:[r],foreignColumns:[d]}});return l.onUpdate&&u.onUpdate(l.onUpdate),l.onDelete&&u.onDelete(l.onDelete),u.build(a)},n,i))}buildExtraConfigColumn(r){return new Fb(r,this.config)}}O(ft,tf,"PgColumnBuilder");var rf,af;class Xe extends(af=mn,rf=te,af){constructor(s,r){r.uniqueName||(r.uniqueName=O4(s,[r.name])),super(s,r),this.table=s}}O(Xe,rf,"PgColumn");var nf,of;class Fb extends(of=Xe,nf=te,of){constructor(){super(...arguments);O(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});O(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(r){return this.indexConfig.opClass=r,this}}O(Fb,nf,"ExtraConfigColumn");var lf,cf;class $b extends(cf=ft,lf=te,cf){constructor(s,r,a){super(s,"array","PgArray"),this.config.baseBuilder=r,this.config.size=a}build(s){const r=this.config.baseBuilder.build(s);return new Pc(s,this.config,r)}}O($b,lf,"PgArrayBuilder");var df,uf;const zo=class zo extends(uf=Xe,df=te,uf){constructor(r,a,n,i){super(r,a);O(this,"size");this.baseColumn=n,this.range=i,this.size=a.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(r){return typeof r=="string"&&(r=L4(r)),r.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(r,a=!1){const n=r.map(i=>i===null?null:ns(this.baseColumn,zo)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return a?n:Rb(n)}};O(zo,df,"PgArray");let Pc=zo;const bh=Symbol.for("drizzle:isPgEnum");function z4(t){return!!t&&typeof t=="function"&&bh in t&&t[bh]===!0}var mf;mf=te;class Gd{constructor(s,r,a,n=!1){this._={brand:"Subquery",sql:s,selectedFields:r,alias:a,isWith:n}}}O(Gd,mf,"Subquery");const B4={startActiveSpan(t,s){return s()}},tn=Symbol.for("drizzle:ViewBaseConfig"),Gl=Symbol.for("drizzle:Schema"),jh=Symbol.for("drizzle:Columns"),Nh=Symbol.for("drizzle:ExtraConfigColumns"),Hl=Symbol.for("drizzle:OriginalName"),Ql=Symbol.for("drizzle:BaseName"),Po=Symbol.for("drizzle:IsAlias"),wh=Symbol.for("drizzle:ExtraConfigBuilder"),Vb=Symbol.for("drizzle:IsDrizzleTable");var hf,ff,pf,xf,gf,yf,vf,bf,jf,Nf;Nf=te,jf=en,bf=Hl,vf=Gl,yf=jh,gf=Nh,xf=Ql,pf=Po,ff=Vb,hf=wh;class vs{constructor(s,r,a){O(this,jf);O(this,bf);O(this,vf);O(this,yf);O(this,gf);O(this,xf);O(this,pf,!1);O(this,ff,!0);O(this,hf);this[en]=this[Hl]=s,this[Gl]=r,this[Ql]=a}}O(vs,Nf,"Table"),O(vs,"Symbol",{Name:en,Schema:Gl,OriginalName:Hl,Columns:jh,ExtraConfigColumns:Nh,BaseName:Ql,IsAlias:Po,ExtraConfigBuilder:wh});function Ob(t){return typeof t=="object"&&t!==null&&Vb in t}function q4(t){return t!=null&&typeof t.getSQL=="function"}function U4(t){const s={sql:"",params:[]};for(const r of t)s.sql+=r.sql,s.params.push(...r.params),r.typings?.length&&(s.typings||(s.typings=[]),s.typings.push(...r.typings));return s}var wf;wf=te;class Ws{constructor(s){O(this,"value");this.value=Array.isArray(s)?s:[s]}getSQL(){return new Yt([this])}}O(Ws,wf,"StringChunk");var kf;kf=te;const ya=class ya{constructor(s){O(this,"decoder",Lb);O(this,"shouldInlineParams",!1);this.queryChunks=s}append(s){return this.queryChunks.push(...s.queryChunks),this}toQuery(s){return B4.startActiveSpan("drizzle.buildSQL",r=>{const a=this.buildQueryFromSourceParams(this.queryChunks,s);return r?.setAttributes({"drizzle.query.text":a.sql,"drizzle.query.params":JSON.stringify(a.params)}),a})}buildQueryFromSourceParams(s,r){const a=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:n,escapeName:i,escapeParam:o,prepareTyping:l,inlineParams:u,paramStartIndex:d}=a;return U4(s.map(c=>{if(ns(c,Ws))return{sql:c.value.join(""),params:[]};if(ns(c,Eo))return{sql:i(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){const m=[new Ws("(")];for(const[h,x]of c.entries())m.push(x),h<c.length-1&&m.push(new Ws(", "));return m.push(new Ws(")")),this.buildQueryFromSourceParams(m,a)}if(ns(c,ya))return this.buildQueryFromSourceParams(c.queryChunks,{...a,inlineParams:u||c.shouldInlineParams});if(ns(c,vs)){const m=c[vs.Symbol.Schema],h=c[vs.Symbol.Name];return{sql:m===void 0||c[Po]?i(h):i(m)+"."+i(h),params:[]}}if(ns(c,mn)){const m=n.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:i(m),params:[]};const h=c.table[vs.Symbol.Schema];return{sql:c.table[Po]||h===void 0?i(c.table[vs.Symbol.Name])+"."+i(m):i(h)+"."+i(c.table[vs.Symbol.Name])+"."+i(m),params:[]}}if(ns(c,qb)){const m=c[tn].schema,h=c[tn].name;return{sql:m===void 0||c[tn].isAlias?i(h):i(m)+"."+i(h),params:[]}}if(ns(c,Hd)){if(ns(c.value,Do))return{sql:o(d.value++,c),params:[c],typings:["none"]};const m=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(ns(m,ya))return this.buildQueryFromSourceParams([m],a);if(u)return{sql:this.mapInlineParam(m,a),params:[]};let h=["none"];return l&&(h=[l(c.encoder)]),{sql:o(d.value++,m),params:[m],typings:h}}return ns(c,Do)?{sql:o(d.value++,c),params:[c],typings:["none"]}:ns(c,ya.Aliased)&&c.fieldAlias!==void 0?{sql:i(c.fieldAlias),params:[]}:ns(c,Gd)?c._.isWith?{sql:i(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Ws("("),c._.sql,new Ws(") "),new Eo(c._.alias)],a):z4(c)?c.schema?{sql:i(c.schema)+"."+i(c.enumName),params:[]}:{sql:i(c.enumName),params:[]}:q4(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],a):this.buildQueryFromSourceParams([new Ws("("),c.getSQL(),new Ws(")")],a):u?{sql:this.mapInlineParam(c,a),params:[]}:{sql:o(d.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(s,{escapeString:r}){if(s===null)return"null";if(typeof s=="number"||typeof s=="boolean")return s.toString();if(typeof s=="string")return r(s);if(typeof s=="object"){const a=s.toString();return r(a==="[object Object]"?JSON.stringify(s):a)}throw new Error("Unexpected param value: "+s)}getSQL(){return this}as(s){return s===void 0?this:new ya.Aliased(this,s)}mapWith(s){return this.decoder=typeof s=="function"?{mapFromDriverValue:s}:s,this}inlineParams(){return this.shouldInlineParams=!0,this}if(s){return s?this:void 0}};O(ya,kf,"SQL");let Yt=ya;var Tf;Tf=te;class Eo{constructor(s){O(this,"brand");this.value=s}getSQL(){return new Yt([this])}}O(Eo,Tf,"Name");const Lb={mapFromDriverValue:t=>t},zb={mapToDriverValue:t=>t};({...Lb,...zb});var Sf;Sf=te;class Hd{constructor(s,r=zb){O(this,"brand");this.value=s,this.encoder=r}getSQL(){return new Yt([this])}}O(Hd,Sf,"Param");function we(t,...s){const r=[];(s.length>0||t.length>0&&t[0]!=="")&&r.push(new Ws(t[0]));for(const[a,n]of s.entries())r.push(n,new Ws(t[a+1]));return new Yt(r)}(t=>{function s(){return new Yt([])}t.empty=s;function r(u){return new Yt(u)}t.fromList=r;function a(u){return new Yt([new Ws(u)])}t.raw=a;function n(u,d){const c=[];for(const[m,h]of u.entries())m>0&&d!==void 0&&c.push(d),c.push(h);return new Yt(c)}t.join=n;function i(u){return new Eo(u)}t.identifier=i;function o(u){return new Do(u)}t.placeholder=o;function l(u,d){return new Hd(u,d)}t.param=l})(we||(we={}));(t=>{var r;r=te;const a=class a{constructor(i,o){O(this,"isSelectionField",!1);this.sql=i,this.fieldAlias=o}getSQL(){return this.sql}clone(){return new a(this.sql,this.fieldAlias)}};O(a,r,"SQL.Aliased");let s=a;t.Aliased=s})(Yt||(Yt={}));var Af;Af=te;class Do{constructor(s){this.name=s}getSQL(){return new Yt([this])}}O(Do,Af,"Placeholder");const Bb=Symbol.for("drizzle:IsDrizzleView");var _f,Cf,Pf;Pf=te,Cf=tn,_f=Bb;class qb{constructor({name:s,schema:r,selectedFields:a,query:n}){O(this,Cf);O(this,_f,!0);this[tn]={name:s,originalName:s,schema:r,selectedFields:a,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new Yt([this])}}O(qb,Pf,"View");function W4(t){return typeof t=="object"&&t!==null&&Bb in t}mn.prototype.getSQL=function(){return new Yt([this])};vs.prototype.getSQL=function(){return new Yt([this])};Gd.prototype.getSQL=function(){return new Yt([this])};function K4(t){return t[vs.Symbol.Columns]}function G4(t){return t[tn].selectedFields}function ss(t,s){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:s}}var Ef,Df;class Oi extends(Df=ft,Ef=te,Df){generatedAlwaysAsIdentity(s){if(s){const{name:r,...a}=s;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:a}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(s){if(s){const{name:r,...a}=s;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:a}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}O(Oi,Ef,"PgIntColumnBaseBuilder");var Mf,If;class Ub extends(If=Oi,Mf=te,If){constructor(s){super(s,"number","PgBigInt53")}build(s){return new Wb(s,this.config)}}O(Ub,Mf,"PgBigInt53Builder");var Rf,Ff;class Wb extends(Ff=Xe,Rf=te,Ff){getSQLType(){return"bigint"}mapFromDriverValue(s){return typeof s=="number"?s:Number(s)}}O(Wb,Rf,"PgBigInt53");var $f,Vf;class Kb extends(Vf=Oi,$f=te,Vf){constructor(s){super(s,"bigint","PgBigInt64")}build(s){return new Gb(s,this.config)}}O(Kb,$f,"PgBigInt64Builder");var Of,Lf;class Gb extends(Lf=Xe,Of=te,Lf){getSQLType(){return"bigint"}mapFromDriverValue(s){return BigInt(s)}}O(Gb,Of,"PgBigInt64");function H4(t,s){const{name:r,config:a}=ss(t,s);return a.mode==="number"?new Ub(r):new Kb(r)}var zf,Bf;class Hb extends(Bf=ft,zf=te,Bf){constructor(s){super(s,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new Qb(s,this.config)}}O(Hb,zf,"PgBigSerial53Builder");var qf,Uf;class Qb extends(Uf=Xe,qf=te,Uf){getSQLType(){return"bigserial"}mapFromDriverValue(s){return typeof s=="number"?s:Number(s)}}O(Qb,qf,"PgBigSerial53");var Wf,Kf;class Xb extends(Kf=ft,Wf=te,Kf){constructor(s){super(s,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(s){return new Zb(s,this.config)}}O(Xb,Wf,"PgBigSerial64Builder");var Gf,Hf;class Zb extends(Hf=Xe,Gf=te,Hf){getSQLType(){return"bigserial"}mapFromDriverValue(s){return BigInt(s)}}O(Zb,Gf,"PgBigSerial64");function Q4(t,s){const{name:r,config:a}=ss(t,s);return a.mode==="number"?new Hb(r):new Xb(r)}var Qf,Xf;class Yb extends(Xf=ft,Qf=te,Xf){constructor(s){super(s,"boolean","PgBoolean")}build(s){return new Jb(s,this.config)}}O(Yb,Qf,"PgBooleanBuilder");var Zf,Yf;class Jb extends(Yf=Xe,Zf=te,Yf){getSQLType(){return"boolean"}}O(Jb,Zf,"PgBoolean");function Ue(t){return new Yb(t??"")}var Jf,ep;class ej extends(ep=ft,Jf=te,ep){constructor(s,r){super(s,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(s){return new tj(s,this.config)}}O(ej,Jf,"PgCharBuilder");var tp,sp;class tj extends(sp=Xe,tp=te,sp){constructor(){super(...arguments);O(this,"length",this.config.length);O(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}O(tj,tp,"PgChar");function X4(t,s={}){const{name:r,config:a}=ss(t,s);return new ej(r,a)}var rp,ap;class sj extends(ap=ft,rp=te,ap){constructor(s){super(s,"string","PgCidr")}build(s){return new rj(s,this.config)}}O(sj,rp,"PgCidrBuilder");var np,ip;class rj extends(ip=Xe,np=te,ip){getSQLType(){return"cidr"}}O(rj,np,"PgCidr");function Z4(t){return new sj(t??"")}var op,lp;class aj extends(lp=ft,op=te,lp){constructor(s,r,a){super(s,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=a}build(s){return new nj(s,this.config)}}O(aj,op,"PgCustomColumnBuilder");var cp,dp;class nj extends(dp=Xe,cp=te,dp){constructor(r,a){super(r,a);O(this,"sqlName");O(this,"mapTo");O(this,"mapFrom");this.sqlName=a.customTypeParams.dataType(a.fieldConfig),this.mapTo=a.customTypeParams.toDriver,this.mapFrom=a.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(r){return typeof this.mapFrom=="function"?this.mapFrom(r):r}mapToDriverValue(r){return typeof this.mapTo=="function"?this.mapTo(r):r}}O(nj,cp,"PgCustomColumn");function Y4(t){return(s,r)=>{const{name:a,config:n}=ss(s,r);return new aj(a,n,t)}}var up,mp;class Nn extends(mp=ft,up=te,mp){defaultNow(){return this.default(we`now()`)}}O(Nn,up,"PgDateColumnBaseBuilder");var hp,fp;class ij extends(fp=Nn,hp=te,fp){constructor(s){super(s,"date","PgDate")}build(s){return new oj(s,this.config)}}O(ij,hp,"PgDateBuilder");var pp,xp;class oj extends(xp=Xe,pp=te,xp){getSQLType(){return"date"}mapFromDriverValue(s){return new Date(s)}mapToDriverValue(s){return s.toISOString()}}O(oj,pp,"PgDate");var gp,yp;class lj extends(yp=Nn,gp=te,yp){constructor(s){super(s,"string","PgDateString")}build(s){return new cj(s,this.config)}}O(lj,gp,"PgDateStringBuilder");var vp,bp;class cj extends(bp=Xe,vp=te,bp){getSQLType(){return"date"}}O(cj,vp,"PgDateString");function zr(t,s){const{name:r,config:a}=ss(t,s);return a?.mode==="date"?new ij(r):new lj(r)}var jp,Np;class dj extends(Np=ft,jp=te,Np){constructor(s){super(s,"number","PgDoublePrecision")}build(s){return new uj(s,this.config)}}O(dj,jp,"PgDoublePrecisionBuilder");var wp,kp;class uj extends(kp=Xe,wp=te,kp){getSQLType(){return"double precision"}mapFromDriverValue(s){return typeof s=="string"?Number.parseFloat(s):s}}O(uj,wp,"PgDoublePrecision");function J4(t){return new dj(t??"")}var Tp,Sp;class mj extends(Sp=ft,Tp=te,Sp){constructor(s){super(s,"string","PgInet")}build(s){return new hj(s,this.config)}}O(mj,Tp,"PgInetBuilder");var Ap,_p;class hj extends(_p=Xe,Ap=te,_p){getSQLType(){return"inet"}}O(hj,Ap,"PgInet");function dl(t){return new mj(t??"")}var Cp,Pp;class fj extends(Pp=Oi,Cp=te,Pp){constructor(s){super(s,"number","PgInteger")}build(s){return new pj(s,this.config)}}O(fj,Cp,"PgIntegerBuilder");var Ep,Dp;class pj extends(Dp=Xe,Ep=te,Dp){getSQLType(){return"integer"}mapFromDriverValue(s){return typeof s=="string"?Number.parseInt(s):s}}O(pj,Ep,"PgInteger");function ht(t){return new fj(t??"")}var Mp,Ip;class xj extends(Ip=ft,Mp=te,Ip){constructor(s,r){super(s,"string","PgInterval"),this.config.intervalConfig=r}build(s){return new gj(s,this.config)}}O(xj,Mp,"PgIntervalBuilder");var Rp,Fp;class gj extends(Fp=Xe,Rp=te,Fp){constructor(){super(...arguments);O(this,"fields",this.config.intervalConfig.fields);O(this,"precision",this.config.intervalConfig.precision)}getSQLType(){const r=this.fields?` ${this.fields}`:"",a=this.precision?`(${this.precision})`:"";return`interval${r}${a}`}}O(gj,Rp,"PgInterval");function e5(t,s={}){const{name:r,config:a}=ss(t,s);return new xj(r,a)}var $p,Vp;class yj extends(Vp=ft,$p=te,Vp){constructor(s){super(s,"json","PgJson")}build(s){return new vj(s,this.config)}}O(yj,$p,"PgJsonBuilder");var Op,Lp;class vj extends(Lp=Xe,Op=te,Lp){constructor(s,r){super(s,r)}getSQLType(){return"json"}mapToDriverValue(s){return JSON.stringify(s)}mapFromDriverValue(s){if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s}}O(vj,Op,"PgJson");function t5(t){return new yj(t??"")}var zp,Bp;class bj extends(Bp=ft,zp=te,Bp){constructor(s){super(s,"json","PgJsonb")}build(s){return new jj(s,this.config)}}O(bj,zp,"PgJsonbBuilder");var qp,Up;class jj extends(Up=Xe,qp=te,Up){constructor(s,r){super(s,r)}getSQLType(){return"jsonb"}mapToDriverValue(s){return JSON.stringify(s)}mapFromDriverValue(s){if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s}}O(jj,qp,"PgJsonb");function Jt(t){return new bj(t??"")}var Wp,Kp;class Nj extends(Kp=ft,Wp=te,Kp){constructor(s){super(s,"array","PgLine")}build(s){return new wj(s,this.config)}}O(Nj,Wp,"PgLineBuilder");var Gp,Hp;class wj extends(Hp=Xe,Gp=te,Hp){getSQLType(){return"line"}mapFromDriverValue(s){const[r,a,n]=s.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(a),Number.parseFloat(n)]}mapToDriverValue(s){return`{${s[0]},${s[1]},${s[2]}}`}}O(wj,Gp,"PgLine");var Qp,Xp;class kj extends(Xp=ft,Qp=te,Xp){constructor(s){super(s,"json","PgLineABC")}build(s){return new Tj(s,this.config)}}O(kj,Qp,"PgLineABCBuilder");var Zp,Yp;class Tj extends(Yp=Xe,Zp=te,Yp){getSQLType(){return"line"}mapFromDriverValue(s){const[r,a,n]=s.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(a),c:Number.parseFloat(n)}}mapToDriverValue(s){return`{${s.a},${s.b},${s.c}}`}}O(Tj,Zp,"PgLineABC");function s5(t,s){const{name:r,config:a}=ss(t,s);return!a?.mode||a.mode==="tuple"?new Nj(r):new kj(r)}var Jp,ex;class Sj extends(ex=ft,Jp=te,ex){constructor(s){super(s,"string","PgMacaddr")}build(s){return new Aj(s,this.config)}}O(Sj,Jp,"PgMacaddrBuilder");var tx,sx;class Aj extends(sx=Xe,tx=te,sx){getSQLType(){return"macaddr"}}O(Aj,tx,"PgMacaddr");function r5(t){return new Sj(t??"")}var rx,ax;class _j extends(ax=ft,rx=te,ax){constructor(s){super(s,"string","PgMacaddr8")}build(s){return new Cj(s,this.config)}}O(_j,rx,"PgMacaddr8Builder");var nx,ix;class Cj extends(ix=Xe,nx=te,ix){getSQLType(){return"macaddr8"}}O(Cj,nx,"PgMacaddr8");function a5(t){return new _j(t??"")}var ox,lx;class Pj extends(lx=ft,ox=te,lx){constructor(s,r,a){super(s,"string","PgNumeric"),this.config.precision=r,this.config.scale=a}build(s){return new Ej(s,this.config)}}O(Pj,ox,"PgNumericBuilder");var cx,dx;class Ej extends(dx=Xe,cx=te,dx){constructor(r,a){super(r,a);O(this,"precision");O(this,"scale");this.precision=a.precision,this.scale=a.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}O(Ej,cx,"PgNumeric");function Dj(t,s){const{name:r,config:a}=ss(t,s);return new Pj(r,a?.precision,a?.scale)}const ve=Dj;var ux,mx;class Mj extends(mx=ft,ux=te,mx){constructor(s){super(s,"array","PgPointTuple")}build(s){return new Ij(s,this.config)}}O(Mj,ux,"PgPointTupleBuilder");var hx,fx;class Ij extends(fx=Xe,hx=te,fx){getSQLType(){return"point"}mapFromDriverValue(s){if(typeof s=="string"){const[r,a]=s.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(a)]}return[s.x,s.y]}mapToDriverValue(s){return`(${s[0]},${s[1]})`}}O(Ij,hx,"PgPointTuple");var px,xx;class Rj extends(xx=ft,px=te,xx){constructor(s){super(s,"json","PgPointObject")}build(s){return new Fj(s,this.config)}}O(Rj,px,"PgPointObjectBuilder");var gx,yx;class Fj extends(yx=Xe,gx=te,yx){getSQLType(){return"point"}mapFromDriverValue(s){if(typeof s=="string"){const[r,a]=s.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(a)}}return s}mapToDriverValue(s){return`(${s.x},${s.y})`}}O(Fj,gx,"PgPointObject");function n5(t,s){const{name:r,config:a}=ss(t,s);return!a?.mode||a.mode==="tuple"?new Mj(r):new Rj(r)}function i5(t){const s=[];for(let r=0;r<t.length;r+=2)s.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(s)}function kh(t,s){const r=new ArrayBuffer(8),a=new DataView(r);for(let n=0;n<8;n++)a.setUint8(n,t[s+n]);return a.getFloat64(0,!0)}function $j(t){const s=i5(t);let r=0;const a=s[r];r+=1;const n=new DataView(s.buffer),i=n.getUint32(r,a===1);if(r+=4,i&536870912&&(n.getUint32(r,a===1),r+=4),(i&65535)===1){const o=kh(s,r);r+=8;const l=kh(s,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var vx,bx;class Vj extends(bx=ft,vx=te,bx){constructor(s){super(s,"array","PgGeometry")}build(s){return new Oj(s,this.config)}}O(Vj,vx,"PgGeometryBuilder");var jx,Nx;class Oj extends(Nx=Xe,jx=te,Nx){getSQLType(){return"geometry(point)"}mapFromDriverValue(s){return $j(s)}mapToDriverValue(s){return`point(${s[0]} ${s[1]})`}}O(Oj,jx,"PgGeometry");var wx,kx;class Lj extends(kx=ft,wx=te,kx){constructor(s){super(s,"json","PgGeometryObject")}build(s){return new zj(s,this.config)}}O(Lj,wx,"PgGeometryObjectBuilder");var Tx,Sx;class zj extends(Sx=Xe,Tx=te,Sx){getSQLType(){return"geometry(point)"}mapFromDriverValue(s){const r=$j(s);return{x:r[0],y:r[1]}}mapToDriverValue(s){return`point(${s.x} ${s.y})`}}O(zj,Tx,"PgGeometryObject");function o5(t,s){const{name:r,config:a}=ss(t,s);return!a?.mode||a.mode==="tuple"?new Vj(r):new Lj(r)}var Ax,_x;class Bj extends(_x=ft,Ax=te,_x){constructor(s,r){super(s,"number","PgReal"),this.config.length=r}build(s){return new qj(s,this.config)}}O(Bj,Ax,"PgRealBuilder");var Cx,Px;class qj extends(Px=Xe,Cx=te,Px){constructor(r,a){super(r,a);O(this,"mapFromDriverValue",r=>typeof r=="string"?Number.parseFloat(r):r)}getSQLType(){return"real"}}O(qj,Cx,"PgReal");function l5(t){return new Bj(t??"")}var Ex,Dx;class Uj extends(Dx=ft,Ex=te,Dx){constructor(s){super(s,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new Wj(s,this.config)}}O(Uj,Ex,"PgSerialBuilder");var Mx,Ix;class Wj extends(Ix=Xe,Mx=te,Ix){getSQLType(){return"serial"}}O(Wj,Mx,"PgSerial");function c5(t){return new Uj(t??"")}var Rx,Fx;class Kj extends(Fx=Oi,Rx=te,Fx){constructor(s){super(s,"number","PgSmallInt")}build(s){return new Gj(s,this.config)}}O(Kj,Rx,"PgSmallIntBuilder");var $x,Vx;class Gj extends(Vx=Xe,$x=te,Vx){constructor(){super(...arguments);O(this,"mapFromDriverValue",r=>typeof r=="string"?Number(r):r)}getSQLType(){return"smallint"}}O(Gj,$x,"PgSmallInt");function d5(t){return new Kj(t??"")}var Ox,Lx;class Hj extends(Lx=ft,Ox=te,Lx){constructor(s){super(s,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new Qj(s,this.config)}}O(Hj,Ox,"PgSmallSerialBuilder");var zx,Bx;class Qj extends(Bx=Xe,zx=te,Bx){getSQLType(){return"smallserial"}}O(Qj,zx,"PgSmallSerial");function u5(t){return new Hj(t??"")}var qx,Ux;class Xj extends(Ux=ft,qx=te,Ux){constructor(s,r){super(s,"string","PgText"),this.config.enumValues=r.enum}build(s){return new Zj(s,this.config)}}O(Xj,qx,"PgTextBuilder");var Wx,Kx;class Zj extends(Kx=Xe,Wx=te,Kx){constructor(){super(...arguments);O(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}O(Zj,Wx,"PgText");function P(t,s={}){const{name:r,config:a}=ss(t,s);return new Xj(r,a)}var Gx,Hx;class Yj extends(Hx=Nn,Gx=te,Hx){constructor(s,r,a){super(s,"string","PgTime"),this.withTimezone=r,this.precision=a,this.config.withTimezone=r,this.config.precision=a}build(s){return new Jj(s,this.config)}}O(Yj,Gx,"PgTimeBuilder");var Qx,Xx;class Jj extends(Xx=Xe,Qx=te,Xx){constructor(r,a){super(r,a);O(this,"withTimezone");O(this,"precision");this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}O(Jj,Qx,"PgTime");function m5(t,s={}){const{name:r,config:a}=ss(t,s);return new Yj(r,a.withTimezone??!1,a.precision)}var Zx,Yx;class eN extends(Yx=Nn,Zx=te,Yx){constructor(s,r,a){super(s,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=a}build(s){return new tN(s,this.config)}}O(eN,Zx,"PgTimestampBuilder");var Jx,eg;class tN extends(eg=Xe,Jx=te,eg){constructor(r,a){super(r,a);O(this,"withTimezone");O(this,"precision");O(this,"mapFromDriverValue",r=>new Date(this.withTimezone?r:r+"+0000"));O(this,"mapToDriverValue",r=>r.toISOString());this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}O(tN,Jx,"PgTimestamp");var tg,sg;class sN extends(sg=Nn,tg=te,sg){constructor(s,r,a){super(s,"string","PgTimestampString"),this.config.withTimezone=r,this.config.precision=a}build(s){return new rN(s,this.config)}}O(sN,tg,"PgTimestampStringBuilder");var rg,ag;class rN extends(ag=Xe,rg=te,ag){constructor(r,a){super(r,a);O(this,"withTimezone");O(this,"precision");this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}O(rN,rg,"PgTimestampString");function Z(t,s={}){const{name:r,config:a}=ss(t,s);return a?.mode==="string"?new sN(r,a.withTimezone??!1,a.precision):new eN(r,a?.withTimezone??!1,a?.precision)}var ng,ig;class aN extends(ig=ft,ng=te,ig){constructor(s){super(s,"string","PgUUID")}defaultRandom(){return this.default(we`gen_random_uuid()`)}build(s){return new nN(s,this.config)}}O(aN,ng,"PgUUIDBuilder");var og,lg;class nN extends(lg=Xe,og=te,lg){getSQLType(){return"uuid"}}O(nN,og,"PgUUID");function ul(t){return new aN(t??"")}var cg,dg;class iN extends(dg=ft,cg=te,dg){constructor(s,r){super(s,"string","PgVarchar"),this.config.length=r.length,this.config.enumValues=r.enum}build(s){return new oN(s,this.config)}}O(iN,cg,"PgVarcharBuilder");var ug,mg;class oN extends(mg=Xe,ug=te,mg){constructor(){super(...arguments);O(this,"length",this.config.length);O(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}O(oN,ug,"PgVarchar");function U(t,s={}){const{name:r,config:a}=ss(t,s);return new iN(r,a)}var hg,fg;class lN extends(fg=ft,hg=te,fg){constructor(s,r){super(s,"string","PgBinaryVector"),this.config.dimensions=r.dimensions}build(s){return new cN(s,this.config)}}O(lN,hg,"PgBinaryVectorBuilder");var pg,xg;class cN extends(xg=Xe,pg=te,xg){constructor(){super(...arguments);O(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}O(cN,pg,"PgBinaryVector");function h5(t,s){const{name:r,config:a}=ss(t,s);return new lN(r,a)}var gg,yg;class dN extends(yg=ft,gg=te,yg){constructor(s,r){super(s,"array","PgHalfVector"),this.config.dimensions=r.dimensions}build(s){return new uN(s,this.config)}}O(dN,gg,"PgHalfVectorBuilder");var vg,bg;class uN extends(bg=Xe,vg=te,bg){constructor(){super(...arguments);O(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}O(uN,vg,"PgHalfVector");function f5(t,s){const{name:r,config:a}=ss(t,s);return new dN(r,a)}var jg,Ng;class mN extends(Ng=ft,jg=te,Ng){constructor(s,r){super(s,"string","PgSparseVector"),this.config.dimensions=r.dimensions}build(s){return new hN(s,this.config)}}O(mN,jg,"PgSparseVectorBuilder");var wg,kg;class hN extends(kg=Xe,wg=te,kg){constructor(){super(...arguments);O(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}O(hN,wg,"PgSparseVector");function p5(t,s){const{name:r,config:a}=ss(t,s);return new mN(r,a)}var Tg,Sg;class fN extends(Sg=ft,Tg=te,Sg){constructor(s,r){super(s,"array","PgVector"),this.config.dimensions=r.dimensions}build(s){return new pN(s,this.config)}}O(fN,Tg,"PgVectorBuilder");var Ag,_g;class pN extends(_g=Xe,Ag=te,_g){constructor(){super(...arguments);O(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}O(pN,Ag,"PgVector");function x5(t,s){const{name:r,config:a}=ss(t,s);return new fN(r,a)}function g5(){return{bigint:H4,bigserial:Q4,boolean:Ue,char:X4,cidr:Z4,customType:Y4,date:zr,doublePrecision:J4,inet:dl,integer:ht,interval:e5,json:t5,jsonb:Jt,line:s5,macaddr:r5,macaddr8:a5,numeric:Dj,point:n5,geometry:o5,real:l5,serial:c5,smallint:d5,smallserial:u5,text:P,time:m5,timestamp:Z,uuid:ul,varchar:U,bit:h5,halfvec:f5,sparsevec:p5,vector:x5}}const Ec=Symbol.for("drizzle:PgInlineForeignKeys"),Th=Symbol.for("drizzle:EnableRLS");var Cg,Pg,Eg,Dg,Mg;class Gn extends(Mg=vs,Dg=te,Eg=Ec,Pg=Th,Cg=vs.Symbol.ExtraConfigBuilder,Mg){constructor(){super(...arguments);O(this,Eg,[]);O(this,Pg,!1);O(this,Cg)}}O(Gn,Dg,"PgTable"),O(Gn,"Symbol",Object.assign({},vs.Symbol,{InlineForeignKeys:Ec,EnableRLS:Th}));function y5(t,s,r,a,n=t){const i=new Gn(t,a,n),o=typeof s=="function"?s(g5()):s,l=Object.fromEntries(Object.entries(o).map(([c,m])=>{const h=m;h.setName(c);const x=h.build(i);return i[Ec].push(...h.buildForeignKeys(x,i)),[c,x]})),u=Object.fromEntries(Object.entries(o).map(([c,m])=>{const h=m;h.setName(c);const x=h.buildExtraConfigColumn(i);return[c,x]})),d=Object.assign(i,l);return d[vs.Symbol.Columns]=l,d[vs.Symbol.ExtraConfigColumns]=u,r&&(d[Gn.Symbol.ExtraConfigBuilder]=r),Object.assign(d,{enableRLS:()=>(d[Gn.Symbol.EnableRLS]=!0,d)})}const Ve=(t,s,r)=>y5(t,s,r,void 0),It={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function Bt(t,s){return s.includes(t.columnType)}function v5(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}const b5=dr([De(),Sa(),Ld(),Rv()]),j5=dr([b5,$v(Co()),Fv(Co())]),N5=Od(t=>t instanceof Buffer);function xN(t,s){const r=s?.zodInstance??WP,a=s?.coerce??{};let n;return v5(t)&&(n=t.enumValues.length?r.enum(t.enumValues):r.string()),n||(Bt(t,["PgGeometry","PgPointTuple"])?n=r.tuple([r.number(),r.number()]):Bt(t,["PgGeometryObject","PgPointObject"])?n=r.object({x:r.number(),y:r.number()}):Bt(t,["PgHalfVector","PgVector"])?(n=r.array(r.number()),n=t.dimensions?n.length(t.dimensions):n):Bt(t,["PgLine"])?n=r.tuple([r.number(),r.number(),r.number()]):Bt(t,["PgLineABC"])?n=r.object({a:r.number(),b:r.number(),c:r.number()}):Bt(t,["PgArray"])?(n=r.array(xN(t.baseColumn,r)),n=t.size?n.length(t.size):n):t.dataType==="array"?n=r.array(r.any()):t.dataType==="number"?n=w5(t,r,a):t.dataType==="bigint"?n=k5(t,r,a):t.dataType==="boolean"?n=a===!0||a.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?n=a===!0||a.date?r.coerce.date():r.date():t.dataType==="string"?n=T5(t,r,a):t.dataType==="json"?n=j5:t.dataType==="custom"?n=r.any():t.dataType==="buffer"&&(n=N5)),n||(n=r.any()),n}function w5(t,s,r){let a=t.getSQLType().includes("unsigned"),n,i,o=!1;Bt(t,["MySqlTinyInt","SingleStoreTinyInt"])?(n=a?0:It.INT8_MIN,i=a?It.INT8_UNSIGNED_MAX:It.INT8_MAX,o=!0):Bt(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(n=a?0:It.INT16_MIN,i=a?It.INT16_UNSIGNED_MAX:It.INT16_MAX,o=!0):Bt(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(n=a?0:It.INT24_MIN,i=a?It.INT24_UNSIGNED_MAX:It.INT24_MAX,o=Bt(t,["MySqlMediumInt","SingleStoreMediumInt"])):Bt(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(n=a?0:It.INT32_MIN,i=a?It.INT32_UNSIGNED_MAX:It.INT32_MAX,o=!0):Bt(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(n=a?0:It.INT48_MIN,i=a?It.INT48_UNSIGNED_MAX:It.INT48_MAX):Bt(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(a=a||Bt(t,["MySqlSerial","SingleStoreSerial"]),n=a?0:Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=!0):Bt(t,["MySqlYear","SingleStoreYear"])?(n=1901,i=2155,o=!0):(n=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER);let l=r===!0||r?.number?s.coerce.number():s.number();return l=l.min(n).max(i),o?l.int():l}function k5(t,s,r){const a=t.getSQLType().includes("unsigned"),n=a?0n:It.INT64_MIN,i=a?It.INT64_UNSIGNED_MAX:It.INT64_MAX;return(r===!0||r?.bigint?s.coerce.bigint():s.bigint()).min(n).max(i)}function T5(t,s,r){if(Bt(t,["PgUUID"]))return s.string().uuid();let a,n,i=!1;Bt(t,["PgVarchar","SQLiteText"])?a=t.length:Bt(t,["MySqlVarChar","SingleStoreVarChar"])?a=t.length??It.INT16_UNSIGNED_MAX:Bt(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?a=It.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?a=It.INT24_UNSIGNED_MAX:t.textType==="text"?a=It.INT16_UNSIGNED_MAX:a=It.INT8_UNSIGNED_MAX),Bt(t,["PgChar","MySqlChar","SingleStoreChar"])&&(a=t.length,i=!0),Bt(t,["PgBinaryVector"])&&(n=/^[01]+$/,a=t.dimensions);let o=r===!0||r?.string?s.coerce.string():s.string();return o=n?o.regex(n):o,a&&i?o.length(a):a?o.max(a):o}function gN(t){return Ob(t)?K4(t):G4(t)}function yN(t,s,r,a){const n={};for(const[i,o]of Object.entries(t)){if(!ns(o,mn)&&!ns(o,Yt)&&!ns(o,Yt.Aliased)&&typeof o=="object"){const m=Ob(o)||W4(o)?gN(o):o;n[i]=yN(m,s[i]??{},r,a);continue}const l=s[i];if(l!==void 0&&typeof l!="function"){n[i]=l;continue}const u=ns(o,mn)?o:void 0,d=u?xN(u,a):Co(),c=typeof l=="function"?l(d):d;r.never(u)||(n[i]=c,u&&(r.nullable(u)&&(n[i]=n[i].nullable()),r.optional(u)&&(n[i]=n[i].optional())))}return Qr(n)}const S5={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull},Oe=(t,s)=>{const r=gN(t);return yN(r,{},S5)},vt=Ve("users",{id:U("id").primaryKey().default(we`gen_random_uuid()`),email:P("email").notNull().unique(),password:P("password").notNull(),firstName:P("first_name"),lastName:P("last_name"),role:P("role").notNull().default("admin"),isActive:Ue("is_active").default(!0).notNull(),emailVerifiedAt:Z("email_verified_at"),totpSecret:P("totp_secret"),mfaEnabled:Ue("mfa_enabled").default(!1).notNull(),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull(),lastLogin:Z("last_login")}),A5=Ve("auth_user_sessions",{id:ul("id").primaryKey().default(we`gen_random_uuid()`),userId:U("user_id").notNull().references(()=>vt.id),sessionToken:U("session_token"),deviceFingerprint:U("device_fingerprint"),userAgent:P("user_agent"),ipAddress:dl("ip_address"),locationData:Jt("location_data"),isTrustedDevice:Ue("is_trusted_device").default(!1).notNull(),expiresAt:Z("expires_at").notNull(),lastActivity:Z("last_activity").defaultNow(),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull(),deviceId:U("device_id"),deviceName:U("device_name"),browserName:U("browser_name"),browserVersion:U("browser_version"),osName:U("os_name"),osVersion:U("os_version"),country:U("country"),city:U("city"),timezone:U("timezone"),loginMethod:U("login_method"),securityFlags:Jt("security_flags"),deviceType:U("device_type"),refreshTokenHash:P("refresh_token_hash"),accessTokenHash:P("access_token_hash"),isRevoked:Ue("is_revoked").default(!1).notNull(),revokedAt:Z("revoked_at",{withTimezone:!0}),revokedReason:U("revoked_reason")});Ve("email_verification_tokens",{id:ul("id").primaryKey().default(we`gen_random_uuid()`),userId:U("user_id").notNull().references(()=>vt.id),email:P("email").notNull(),token:U("token").notNull().unique(),tokenHash:U("token_hash").notNull(),verificationLink:P("verification_link").notNull(),expiresAt:Z("expires_at").notNull(),verifiedAt:Z("verified_at"),createdAt:Z("created_at").defaultNow().notNull(),ipAddress:dl("ip_address"),userAgent:P("user_agent"),attemptsCount:ht("attempts_count").default(0).notNull()});Ve("password_reset_tokens",{id:ul("id").primaryKey().default(we`gen_random_uuid()`),userId:U("user_id").notNull().references(()=>vt.id),token:U("token").notNull().unique(),tokenHash:U("token_hash").notNull(),expiresAt:Z("expires_at").notNull(),usedAt:Z("used_at"),createdAt:Z("created_at").defaultNow().notNull(),ipAddress:dl("ip_address"),userAgent:P("user_agent")});const Vt=Ve("projects",{id:U("id").primaryKey().default(we`gen_random_uuid()`),name:P("name").notNull(),status:P("status").notNull().default("active"),imageUrl:P("image_url"),createdAt:Z("created_at").defaultNow().notNull()}),wn=Ve("workers",{id:U("id").primaryKey().default(we`gen_random_uuid()`),name:P("name").notNull(),type:P("type").notNull(),dailyWage:ve("daily_wage",{precision:10,scale:2}).notNull(),isActive:Ue("is_active").default(!0).notNull(),createdAt:Z("created_at").defaultNow().notNull()}),_5=Ve("fund_transfers",{id:U("id").primaryKey().default(we`gen_random_uuid()`),projectId:U("project_id").notNull().references(()=>Vt.id),amount:ve("amount",{precision:10,scale:2}).notNull(),senderName:P("sender_name"),transferNumber:P("transfer_number").unique(),transferType:P("transfer_type").notNull(),transferDate:Z("transfer_date").notNull(),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),C5=Ve("worker_attendance",{id:U("id").primaryKey().default(we`gen_random_uuid()`),projectId:U("project_id").notNull().references(()=>Vt.id),workerId:U("worker_id").notNull().references(()=>wn.id),attendanceDate:P("attendance_date").notNull(),date:P("date"),startTime:P("start_time"),endTime:P("end_time"),workDescription:P("work_description"),isPresent:Ue("is_present"),hoursWorked:ve("hours_worked",{precision:5,scale:2}).default("8.00"),overtime:ve("overtime",{precision:5,scale:2}).default("0.00"),overtimeRate:ve("overtime_rate",{precision:10,scale:2}).default("0.00"),workDays:ve("work_days",{precision:3,scale:2}).default("1.00"),dailyWage:ve("daily_wage",{precision:10,scale:2}).notNull(),actualWage:ve("actual_wage",{precision:10,scale:2}),totalPay:ve("total_pay",{precision:10,scale:2}).notNull(),paidAmount:ve("paid_amount",{precision:10,scale:2}).default("0"),remainingAmount:ve("remaining_amount",{precision:10,scale:2}).default("0"),paymentType:P("payment_type").default("partial"),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()},t=>({uniqueWorkerDate:we`UNIQUE (worker_id, attendance_date, project_id)`})),ml=Ve("suppliers",{id:U("id").primaryKey().default(we`gen_random_uuid()`),name:P("name").notNull().unique(),contactPerson:P("contact_person"),phone:P("phone"),address:P("address"),paymentTerms:P("payment_terms").default("نقد"),totalDebt:ve("total_debt",{precision:12,scale:2}).default("0").notNull(),isActive:Ue("is_active").default(!0).notNull(),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),P5=Ve("materials",{id:U("id").primaryKey().default(we`gen_random_uuid()`),name:P("name").notNull(),category:P("category").notNull(),unit:P("unit").notNull(),createdAt:Z("created_at").defaultNow().notNull()}),Qd=Ve("material_purchases",{id:U("id").primaryKey().default(we`gen_random_uuid()`),projectId:U("project_id").notNull().references(()=>Vt.id),supplierId:U("supplier_id").references(()=>ml.id),materialName:P("material_name").notNull(),materialCategory:P("material_category"),materialUnit:P("material_unit"),quantity:ve("quantity",{precision:10,scale:3}).notNull(),unit:P("unit").notNull(),unitPrice:ve("unit_price",{precision:10,scale:2}).notNull(),totalAmount:ve("total_amount",{precision:10,scale:2}).notNull(),purchaseType:P("purchase_type").notNull().default("نقد"),paidAmount:ve("paid_amount",{precision:10,scale:2}).default("0").notNull(),remainingAmount:ve("remaining_amount",{precision:10,scale:2}).default("0").notNull(),supplierName:P("supplier_name"),receiptNumber:P("receipt_number"),invoiceNumber:P("invoice_number"),invoiceDate:P("invoice_date"),dueDate:P("due_date"),invoicePhoto:P("invoice_photo"),notes:P("notes"),purchaseDate:P("purchase_date").notNull(),createdAt:Z("created_at").defaultNow().notNull()}),E5=Ve("supplier_payments",{id:U("id").primaryKey().default(we`gen_random_uuid()`),supplierId:U("supplier_id").notNull().references(()=>ml.id),projectId:U("project_id").notNull().references(()=>Vt.id),purchaseId:U("purchase_id").references(()=>Qd.id),amount:ve("amount",{precision:10,scale:2}).notNull(),paymentMethod:P("payment_method").notNull().default("نقد"),paymentDate:P("payment_date").notNull(),referenceNumber:P("reference_number"),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),D5=Ve("transportation_expenses",{id:U("id").primaryKey().default(we`gen_random_uuid()`),projectId:U("project_id").notNull().references(()=>Vt.id),workerId:U("worker_id").references(()=>wn.id),amount:ve("amount",{precision:10,scale:2}).notNull(),description:P("description").notNull(),date:P("date").notNull(),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),M5=Ve("worker_transfers",{id:U("id").primaryKey().default(we`gen_random_uuid()`),workerId:U("worker_id").notNull().references(()=>wn.id),projectId:U("project_id").notNull().references(()=>Vt.id),amount:ve("amount",{precision:10,scale:2}).notNull(),transferNumber:P("transfer_number"),senderName:P("sender_name"),recipientName:P("recipient_name").notNull(),recipientPhone:P("recipient_phone"),transferMethod:P("transfer_method").notNull(),transferDate:P("transfer_date").notNull(),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),I5=Ve("worker_balances",{id:U("id").primaryKey().default(we`gen_random_uuid()`),workerId:U("worker_id").notNull().references(()=>wn.id),projectId:U("project_id").notNull().references(()=>Vt.id),totalEarned:ve("total_earned",{precision:10,scale:2}).default("0").notNull(),totalPaid:ve("total_paid",{precision:10,scale:2}).default("0").notNull(),totalTransferred:ve("total_transferred",{precision:10,scale:2}).default("0").notNull(),currentBalance:ve("current_balance",{precision:10,scale:2}).default("0").notNull(),lastUpdated:Z("last_updated").defaultNow().notNull(),createdAt:Z("created_at").defaultNow().notNull()}),R5=Ve("daily_expense_summaries",{id:U("id").primaryKey().default(we`gen_random_uuid()`),projectId:U("project_id").notNull().references(()=>Vt.id),date:P("date").notNull(),carriedForwardAmount:ve("carried_forward_amount",{precision:10,scale:2}).default("0").notNull(),totalFundTransfers:ve("total_fund_transfers",{precision:10,scale:2}).default("0").notNull(),totalWorkerWages:ve("total_worker_wages",{precision:10,scale:2}).default("0").notNull(),totalMaterialCosts:ve("total_material_costs",{precision:10,scale:2}).default("0").notNull(),totalTransportationCosts:ve("total_transportation_costs",{precision:10,scale:2}).default("0").notNull(),totalWorkerTransfers:ve("total_worker_transfers",{precision:10,scale:2}).default("0").notNull(),totalWorkerMiscExpenses:ve("total_worker_misc_expenses",{precision:10,scale:2}).default("0").notNull(),totalIncome:ve("total_income",{precision:10,scale:2}).notNull(),totalExpenses:ve("total_expenses",{precision:10,scale:2}).notNull(),remainingBalance:ve("remaining_balance",{precision:10,scale:2}).notNull(),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),F5=Ve("worker_types",{id:U("id").primaryKey().default(we`gen_random_uuid()`),name:P("name").notNull().unique(),usageCount:ht("usage_count").default(1).notNull(),lastUsed:Z("last_used").defaultNow().notNull(),createdAt:Z("created_at").defaultNow().notNull()}),$5=Ve("autocomplete_data",{id:U("id").primaryKey().default(we`gen_random_uuid()`),category:P("category").notNull(),value:P("value").notNull(),usageCount:ht("usage_count").default(1).notNull(),lastUsed:Z("last_used").defaultNow().notNull(),createdAt:Z("created_at").defaultNow().notNull()}),V5=Ve("worker_misc_expenses",{id:U("id").primaryKey().default(we`gen_random_uuid()`),projectId:U("project_id").notNull().references(()=>Vt.id,{onDelete:"cascade"}),amount:ve("amount",{precision:10,scale:2}).notNull(),description:P("description").notNull(),date:P("date").notNull(),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),O5=Ve("print_settings",{id:U("id").primaryKey().default(we`gen_random_uuid()`),reportType:P("report_type").notNull().default("worker_statement"),name:P("name").notNull(),pageSize:P("page_size").notNull().default("A4"),pageOrientation:P("page_orientation").notNull().default("portrait"),marginTop:ve("margin_top",{precision:5,scale:2}).notNull().default("15.00"),marginBottom:ve("margin_bottom",{precision:5,scale:2}).notNull().default("15.00"),marginLeft:ve("margin_left",{precision:5,scale:2}).notNull().default("15.00"),marginRight:ve("margin_right",{precision:5,scale:2}).notNull().default("15.00"),fontFamily:P("font_family").notNull().default("Arial"),fontSize:ht("font_size").notNull().default(12),headerFontSize:ht("header_font_size").notNull().default(16),tableFontSize:ht("table_font_size").notNull().default(10),headerBackgroundColor:P("header_background_color").notNull().default("#1e40af"),headerTextColor:P("header_text_color").notNull().default("#ffffff"),tableHeaderColor:P("table_header_color").notNull().default("#1e40af"),tableRowEvenColor:P("table_row_even_color").notNull().default("#ffffff"),tableRowOddColor:P("table_row_odd_color").notNull().default("#f9fafb"),tableBorderColor:P("table_border_color").notNull().default("#000000"),tableBorderWidth:ht("table_border_width").notNull().default(1),tableCellPadding:ht("table_cell_padding").notNull().default(3),tableColumnWidths:P("table_column_widths").notNull().default("[8,12,10,30,12,15,15,12]"),showHeader:Ue("show_header").notNull().default(!0),showLogo:Ue("show_logo").notNull().default(!0),showProjectInfo:Ue("show_project_info").notNull().default(!0),showWorkerInfo:Ue("show_worker_info").notNull().default(!0),showAttendanceTable:Ue("show_attendance_table").notNull().default(!0),showTransfersTable:Ue("show_transfers_table").notNull().default(!0),showSummary:Ue("show_summary").notNull().default(!0),showSignatures:Ue("show_signatures").notNull().default(!0),isDefault:Ue("is_default").notNull().default(!1),isActive:Ue("is_active").notNull().default(!0),userId:P("user_id"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),L5=Ve("project_fund_transfers",{id:U("id").primaryKey().default(we`gen_random_uuid()`),fromProjectId:U("from_project_id").notNull().references(()=>Vt.id),toProjectId:U("to_project_id").notNull().references(()=>Vt.id),amount:ve("amount",{precision:10,scale:2}).notNull(),description:P("description"),transferReason:P("transfer_reason"),transferDate:P("transfer_date").notNull(),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),Sh=Oe(Vt).omit({id:!0,createdAt:!0});Oe(wn).omit({id:!0,createdAt:!0});Oe(_5).omit({id:!0,createdAt:!0}).extend({amount:dt.string(),transferDate:dt.date()});Oe(C5).omit({id:!0,createdAt:!0}).extend({attendanceDate:De(),workDays:Sa().min(.1).max(2).default(1),dailyWage:dt.string(),actualWage:dt.string().optional(),totalPay:dt.string(),paidAmount:dt.string().optional(),remainingAmount:dt.string().optional(),paymentType:De().optional().default("partial"),hoursWorked:dt.string().optional(),overtime:dt.string().optional(),overtimeRate:dt.string().optional(),notes:De().optional(),startTime:De().optional().refine(t=>t?/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(t):!0,"تنسيق الوقت يجب أن يكون HH:MM"),endTime:De().optional().refine(t=>t?/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(t):!0,"تنسيق الوقت يجب أن يكون HH:MM")}).refine(t=>{if(t.startTime&&t.endTime){const s=parseInt(t.startTime.split(":")[0])*60+parseInt(t.startTime.split(":")[1]),r=parseInt(t.endTime.split(":")[0])*60+parseInt(t.endTime.split(":")[1]);return s<r||r<s}return!0},{message:"وقت البداية يجب أن يكون قبل وقت النهاية (للورديات العادية)",path:["endTime"]});Oe(P5).omit({id:!0,createdAt:!0});Oe(Qd).omit({id:!0,createdAt:!0}).extend({quantity:dt.string(),unit:De().min(1,"وحدة القياس مطلوبة").default("كيس"),unitPrice:dt.string(),totalAmount:dt.string(),purchaseType:De().default("نقد"),paidAmount:dt.string().default("0"),remainingAmount:dt.string().default("0")});Oe(D5).omit({id:!0,createdAt:!0}).extend({amount:dt.string()});Oe(M5).omit({id:!0,createdAt:!0}).extend({amount:dt.string()});Oe(I5).omit({id:!0,createdAt:!0,lastUpdated:!0}).extend({totalEarned:dt.string().optional(),totalPaid:dt.string().optional(),totalTransferred:dt.string().optional(),currentBalance:dt.string().optional()});const z5=Oe(L5).omit({id:!0,createdAt:!0}).extend({amount:dt.string()});Oe(R5).omit({id:!0,createdAt:!0,updatedAt:!0});Oe(F5).omit({id:!0,createdAt:!0,lastUsed:!0});Oe($5).omit({id:!0,createdAt:!0,lastUsed:!0});Oe(V5).omit({id:!0,createdAt:!0}).extend({amount:dt.string()});Oe(vt).omit({id:!0,createdAt:!0,updatedAt:!0,lastLogin:!0}).extend({email:De().min(5,"البريد الإلكتروني قصير جداً").max(255,"البريد الإلكتروني طويل جداً").email("تنسيق البريد الإلكتروني غير صحيح").regex(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,"البريد الإلكتروني يحتوي على أحرف غير مسموحة"),password:De().min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل").max(128,"كلمة المرور طويلة جداً").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).*$/,"كلمة المرور يجب أن تحتوي على حرف كبير وصغير ورقم ورمز خاص"),firstName:De().min(1,"الاسم الأول مطلوب").max(100,"الاسم الأول طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-']+$/,"الاسم يحتوي على أحرف غير مسموحة"),lastName:De().max(100,"اسم العائلة طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-']*$/,"اسم العائلة يحتوي على أحرف غير مسموحة").optional(),role:nl(["admin","manager","user"],{errorMap:()=>({message:"الدور يجب أن يكون admin أو manager أو user"})})});Oe(wn).omit({id:!0,createdAt:!0}).extend({name:De().min(2,"اسم العامل قصير جداً").max(100,"اسم العامل طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-']+$/,"اسم العامل يحتوي على أحرف غير مسموحة"),type:nl(["معلم","عامل","مساعد","سائق","حارس"],{errorMap:()=>({message:"نوع العامل غير صحيح"})}),dailyWage:De().regex(/^\d+(\.\d{1,2})?$/,"الأجر اليومي يجب أن يكون رقماً صحيحاً").refine(t=>parseFloat(t)>0&&parseFloat(t)<=1e4,{message:"الأجر اليومي يجب أن يكون بين 1 و 10000"})});const B5=Oe(Vt).omit({id:!0,createdAt:!0}).extend({name:De().min(2,"اسم المشروع قصير جداً").max(200,"اسم المشروع طويل جداً").regex(/^[a-zA-Zا-ي0-9\s\-_().]+$/,"اسم المشروع يحتوي على أحرف غير مسموحة"),status:nl(["active","completed","paused"],{errorMap:()=>({message:"حالة المشروع يجب أن تكون active أو completed أو paused"})}),imageUrl:De().url("رابط الصورة غير صحيح").optional().or(Vv(""))});B5.partial().omit({}).refine(t=>Object.keys(t).length>0,{message:"يجب توفير حقل واحد على الأقل للتحديث"});De().regex(/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"معرف UUID غير صحيح").or(De().regex(/^[a-z0-9-]{8,50}$/,"معرف غير صحيح"));Oe(ml).omit({id:!0,createdAt:!0});Oe(E5).omit({id:!0,createdAt:!0}).extend({amount:dt.string()});Oe(O5).omit({id:!0,createdAt:!0,updatedAt:!0});Oe(A5).omit({id:!0,createdAt:!0,updatedAt:!0,lastActivity:!0});const q5=Ve("report_templates",{id:P("id").primaryKey().default(we`gen_random_uuid()`),templateName:P("template_name").notNull().default("default"),headerTitle:P("header_title").notNull().default("نظام إدارة مشاريع البناء"),headerSubtitle:P("header_subtitle").default("تقرير مالي"),companyName:P("company_name").notNull().default("شركة البناء والتطوير"),companyAddress:P("company_address").default("صنعاء - اليمن"),companyPhone:P("company_phone").default("+967 1 234567"),companyEmail:P("company_email").default("info@company.com"),footerText:P("footer_text").default("تم إنشاء هذا التقرير بواسطة نظام إدارة المشاريع"),footerContact:P("footer_contact").default("للاستفسار: info@company.com | +967 1 234567"),primaryColor:P("primary_color").notNull().default("#1f2937"),secondaryColor:P("secondary_color").notNull().default("#3b82f6"),accentColor:P("accent_color").notNull().default("#10b981"),textColor:P("text_color").notNull().default("#1f2937"),backgroundColor:P("background_color").notNull().default("#ffffff"),fontSize:ht("font_size").notNull().default(11),fontFamily:P("font_family").notNull().default("Arial"),logoUrl:P("logo_url"),pageOrientation:P("page_orientation").notNull().default("portrait"),pageSize:P("page_size").notNull().default("A4"),margins:Jt("margins").default({top:1,bottom:1,left:.75,right:.75}),showHeader:Ue("show_header").notNull().default(!0),showFooter:Ue("show_footer").notNull().default(!0),showLogo:Ue("show_logo").notNull().default(!0),showDate:Ue("show_date").notNull().default(!0),showPageNumbers:Ue("show_page_numbers").notNull().default(!0),isActive:Ue("is_active").notNull().default(!0),createdAt:Z("created_at").defaultNow(),updatedAt:Z("updated_at").defaultNow()});Oe(q5).omit({id:!0,createdAt:!0,updatedAt:!0});const hl=Ve("tool_categories",{id:U("id").primaryKey().default(we`gen_random_uuid()`),name:P("name").notNull().unique(),description:P("description"),icon:P("icon"),color:P("color").default("#3b82f6"),parentId:U("parent_id").references(()=>hl.id,{onDelete:"cascade"}),isActive:Ue("is_active").default(!0).notNull(),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),lr=Ve("tools",{id:U("id").primaryKey().default(we`gen_random_uuid()`),sku:P("sku").unique(),name:P("name").notNull(),description:P("description"),categoryId:U("category_id").references(()=>hl.id),projectId:U("project_id").references(()=>Vt.id),unit:P("unit").notNull().default("قطعة"),isTool:Ue("is_tool").default(!0).notNull(),isConsumable:Ue("is_consumable").default(!1).notNull(),isSerial:Ue("is_serial").default(!1).notNull(),purchasePrice:ve("purchase_price",{precision:12,scale:2}),currentValue:ve("current_value",{precision:12,scale:2}),depreciationRate:ve("depreciation_rate",{precision:5,scale:2}),purchaseDate:zr("purchase_date"),supplierId:U("supplier_id").references(()=>ml.id),warrantyExpiry:zr("warranty_expiry"),maintenanceInterval:ht("maintenance_interval"),lastMaintenanceDate:zr("last_maintenance_date"),nextMaintenanceDate:zr("next_maintenance_date"),status:P("status").notNull().default("available"),condition:P("condition").notNull().default("excellent"),locationType:P("location_type"),locationId:P("location_id"),serialNumber:P("serial_number"),barcode:P("barcode"),qrCode:P("qr_code"),imageUrls:P("image_urls").array(),notes:P("notes"),specifications:Jt("specifications"),totalUsageHours:ve("total_usage_hours",{precision:10,scale:2}).default("0"),usageCount:ht("usage_count").default(0),aiRating:ve("ai_rating",{precision:3,scale:2}),aiNotes:P("ai_notes"),isActive:Ue("is_active").default(!0).notNull(),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),U5=Ve("tool_stock",{id:U("id").primaryKey().default(we`gen_random_uuid()`),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),locationType:P("location_type").notNull(),locationId:U("location_id"),locationName:P("location_name"),quantity:ht("quantity").notNull().default(0),availableQuantity:ht("available_quantity").notNull().default(0),reservedQuantity:ht("reserved_quantity").notNull().default(0),notes:P("notes"),lastVerifiedAt:Z("last_verified_at"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()},t=>({uniqueToolLocation:we`UNIQUE (tool_id, location_type, location_id)`})),W5=Ve("tool_movements",{id:U("id").primaryKey().default(we`gen_random_uuid()`),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),movementType:P("movement_type").notNull(),quantity:ht("quantity").notNull(),fromType:P("from_type"),fromId:U("from_id"),toType:P("to_type"),toId:U("to_id"),projectId:U("project_id").references(()=>Vt.id),reason:P("reason"),notes:P("notes"),referenceNumber:P("reference_number"),performedBy:P("performed_by").notNull(),performedAt:Z("performed_at").defaultNow().notNull()}),K5=Ve("tool_maintenance_logs",{id:U("id").primaryKey().default(we`gen_random_uuid()`),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),maintenanceType:P("maintenance_type").notNull(),priority:P("priority").notNull().default("medium"),title:P("title").notNull(),description:P("description"),workPerformed:P("work_performed"),scheduledDate:Z("scheduled_date"),startedAt:Z("started_at"),completedAt:Z("completed_at"),nextDueDate:Z("next_due_date"),status:P("status").notNull().default("scheduled"),laborCost:ve("labor_cost",{precision:12,scale:2}).default("0"),partsCost:ve("parts_cost",{precision:12,scale:2}).default("0"),totalCost:ve("total_cost",{precision:12,scale:2}).default("0"),performedBy:U("performed_by").references(()=>vt.id),assignedTo:U("assigned_to").references(()=>vt.id),conditionBefore:P("condition_before"),conditionAfter:P("condition_after"),imageUrls:P("image_urls").array(),documentUrls:P("document_urls").array(),notes:P("notes"),issues:P("issues"),recommendations:P("recommendations"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),G5=Ve("tool_usage_analytics",{id:U("id").primaryKey().default(we`gen_random_uuid()`),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),projectId:U("project_id").references(()=>Vt.id),analysisDate:P("analysis_date").notNull(),analysisWeek:P("analysis_week"),analysisMonth:P("analysis_month"),usageHours:ve("usage_hours",{precision:10,scale:2}).default("0"),transferCount:ht("transfer_count").default(0),maintenanceCount:ht("maintenance_count").default(0),operationalCost:ve("operational_cost",{precision:12,scale:2}).default("0"),maintenanceCost:ve("maintenance_cost",{precision:12,scale:2}).default("0"),utilizationRate:ve("utilization_rate",{precision:5,scale:2}),efficiencyScore:ve("efficiency_score",{precision:5,scale:2}),predictedUsage:ve("predicted_usage",{precision:10,scale:2}),createdAt:Z("created_at").defaultNow().notNull()}),H5=Ve("tool_purchase_items",{id:U("id").primaryKey().default(we`gen_random_uuid()`),materialPurchaseId:U("material_purchase_id").notNull().references(()=>Qd.id,{onDelete:"cascade"}),itemName:P("item_name").notNull(),itemDescription:P("item_description"),quantity:ht("quantity").notNull().default(1),unitPrice:ve("unit_price",{precision:12,scale:2}).notNull(),totalPrice:ve("total_price",{precision:12,scale:2}).notNull(),isToolItem:Ue("is_tool_item").default(!1).notNull(),suggestedCategoryId:U("suggested_category_id").references(()=>hl.id),conversionStatus:P("conversion_status").notNull().default("pending"),toolId:U("tool_id").references(()=>lr.id),aiConfidence:ve("ai_confidence",{precision:5,scale:2}),aiSuggestions:Jt("ai_suggestions"),notes:P("notes"),convertedAt:Z("converted_at"),convertedBy:U("converted_by").references(()=>vt.id),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),vN=Ve("maintenance_schedules",{id:U("id").primaryKey().default(we`gen_random_uuid()`),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),scheduleType:P("schedule_type").notNull(),intervalDays:ht("interval_days"),intervalWeeks:ht("interval_weeks"),intervalMonths:ht("interval_months"),usageHoursInterval:ve("usage_hours_interval",{precision:10,scale:2}),usageCountInterval:ht("usage_count_interval"),isActive:Ue("is_active").default(!0).notNull(),lastMaintenanceDate:Z("last_maintenance_date"),nextDueDate:Z("next_due_date").notNull(),maintenanceType:P("maintenance_type").notNull().default("preventive"),priority:P("priority").notNull().default("medium"),estimatedDuration:ht("estimated_duration"),estimatedCost:ve("estimated_cost",{precision:12,scale:2}),assignedTo:U("assigned_to").references(()=>vt.id),createdBy:U("created_by").references(()=>vt.id),title:P("title").notNull(),description:P("description"),checklistItems:Jt("checklist_items"),enableNotifications:Ue("enable_notifications").default(!0).notNull(),notifyDaysBefore:ht("notify_days_before").default(3).notNull(),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),Q5=Ve("maintenance_tasks",{id:U("id").primaryKey().default(we`gen_random_uuid()`),scheduleId:U("schedule_id").notNull().references(()=>vN.id,{onDelete:"cascade"}),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),taskName:P("task_name").notNull(),taskDescription:P("task_description"),taskType:P("task_type").notNull(),priority:P("priority").notNull().default("medium"),status:P("status").notNull().default("pending"),dueDate:Z("due_date").notNull(),startedAt:Z("started_at"),completedAt:Z("completed_at"),estimatedDuration:ht("estimated_duration"),actualDuration:ht("actual_duration"),estimatedCost:ve("estimated_cost",{precision:12,scale:2}),actualCost:ve("actual_cost",{precision:12,scale:2}),assignedTo:U("assigned_to").references(()=>vt.id),performedBy:U("performed_by").references(()=>vt.id),result:P("result"),findings:P("findings"),actionsTaken:P("actions_taken"),recommendations:P("recommendations"),beforeImages:P("before_images").array(),afterImages:P("after_images").array(),documentUrls:P("document_urls").array(),materialsUsed:Jt("materials_used"),performerSignature:P("performer_signature"),supervisorSignature:P("supervisor_signature"),approvedBy:U("approved_by").references(()=>vt.id),approvedAt:Z("approved_at"),notes:P("notes"),internalNotes:P("internal_notes"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),X5=Ve("tool_cost_tracking",{id:U("id").primaryKey().default(we`gen_random_uuid()`),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),costType:P("cost_type").notNull(),costCategory:P("cost_category").notNull(),amount:ve("amount",{precision:12,scale:2}).notNull(),currency:P("currency").notNull().default("YER"),costDate:P("cost_date").notNull(),costPeriod:P("cost_period"),referenceType:P("reference_type"),referenceId:U("reference_id"),description:P("description").notNull(),notes:P("notes"),approvedBy:U("approved_by").references(()=>vt.id),approvedAt:Z("approved_at"),projectId:U("project_id").references(()=>Vt.id),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()},t=>({uniqueToolDate:we`UNIQUE (tool_id, analysis_date)`})),Z5=Ve("tool_reservations",{id:U("id").primaryKey().default(we`gen_random_uuid()`),toolId:U("tool_id").notNull().references(()=>lr.id,{onDelete:"cascade"}),projectId:U("project_id").notNull().references(()=>Vt.id),quantity:ht("quantity").notNull(),reservedBy:U("reserved_by").notNull().references(()=>vt.id),reservationDate:Z("reservation_date").defaultNow().notNull(),requestedDate:Z("requested_date").notNull(),expiryDate:Z("expiry_date"),status:P("status").notNull().default("pending"),priority:P("priority").notNull().default("normal"),reason:P("reason"),notes:P("notes"),approvedBy:U("approved_by").references(()=>vt.id),approvedAt:Z("approved_at"),fulfilledBy:U("fulfilled_by").references(()=>vt.id),fulfilledAt:Z("fulfilled_at"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),Y5=Ve("system_notifications",{id:U("id").primaryKey().default(we`gen_random_uuid()`),type:P("type").notNull(),category:P("category").notNull(),title:P("title").notNull(),message:P("message").notNull(),description:P("description"),priority:P("priority").notNull().default("medium"),severity:P("severity").notNull().default("info"),status:P("status").notNull().default("active"),sourceType:P("source_type"),sourceId:U("source_id"),sourceName:P("source_name"),userId:U("user_id").references(()=>vt.id),targetAudience:P("target_audience").default("all"),actionRequired:Ue("action_required").default(!1).notNull(),actionUrl:P("action_url"),actionLabel:P("action_label"),scheduledFor:Z("scheduled_for"),expiresAt:Z("expires_at"),readAt:Z("read_at"),dismissedAt:Z("dismissed_at"),metadata:Jt("metadata"),attachments:P("attachments").array(),viewCount:ht("view_count").default(0).notNull(),clickCount:ht("click_count").default(0).notNull(),lastViewedAt:Z("last_viewed_at"),isSystem:Ue("is_system").default(!1).notNull(),isAutoGenerated:Ue("is_auto_generated").default(!0).notNull(),isPersistent:Ue("is_persistent").default(!1).notNull(),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()},t=>({userStatusIdx:we`CREATE INDEX IF NOT EXISTS notifications_user_status_idx ON ${t} (user_id, status, priority)`,typeSourceIdx:we`CREATE INDEX IF NOT EXISTS notifications_type_source_idx ON ${t} (type, source_type, source_id)`,scheduledIdx:we`CREATE INDEX IF NOT EXISTS notifications_scheduled_idx ON ${t} (scheduled_for, status)`})),J5=Ve("notification_read_states",{id:U("id").primaryKey().default(we`gen_random_uuid()`),notificationId:P("notification_id").notNull(),userId:U("user_id").references(()=>vt.id),isRead:Ue("is_read").default(!0).notNull(),readAt:Z("read_at").defaultNow().notNull(),deviceInfo:P("device_info"),createdAt:Z("created_at").defaultNow().notNull()},t=>({uniqueNotificationUser:we`UNIQUE (notification_id, user_id)`}));Oe(hl).omit({id:!0,createdAt:!0,updatedAt:!0});const eE=Oe(lr).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({purchasePrice:dt.string().optional(),currentValue:dt.string().optional()});eE.extend({purchasePrice:dr([De(),Sa()]).optional().transform(t=>{if(!(t==null||t===""))return typeof t=="string"?t:t.toString()}),currentValue:dr([De(),Sa()]).optional().transform(t=>{if(!(t==null||t===""))return typeof t=="string"?t:t.toString()}),depreciationRate:dr([De(),Sa()]).optional().transform(t=>{if(!(t==null||t===""))return typeof t=="string"?t:t.toString()}),purchaseDate:dr([De(),Rn()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}}),warrantyExpiry:dr([De(),Rn()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}}),lastMaintenanceDate:dr([De(),Rn()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}}),nextMaintenanceDate:dr([De(),Rn()]).optional().transform(t=>{if(!(!t||t==="")){if(typeof t=="string"){const s=new Date(t+"T00:00:00.000Z");return isNaN(s.getTime())?void 0:s}return t}})}).partial();Oe(U5).omit({id:!0,createdAt:!0,updatedAt:!0});Oe(W5).omit({id:!0,performedAt:!0});Oe(K5).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({laborCost:dt.string().optional(),partsCost:dt.string().optional(),totalCost:dt.string().optional()});Oe(G5).omit({id:!0,createdAt:!0});Oe(Z5).omit({id:!0,createdAt:!0,updatedAt:!0});Oe(Y5).omit({id:!0,createdAt:!0,updatedAt:!0,viewCount:!0,clickCount:!0,lastViewedAt:!0});Oe(H5).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({unitPrice:dt.string(),totalPrice:dt.string()});Oe(vN).omit({id:!0,createdAt:!0,updatedAt:!0});Oe(Q5).omit({id:!0,createdAt:!0,updatedAt:!0});Oe(X5).omit({id:!0,createdAt:!0,updatedAt:!0});const tE=Ve("tool_notifications",{id:U("id").primaryKey().default(we`gen_random_uuid()`),type:P("type").notNull(),title:P("title").notNull(),message:P("message").notNull(),toolId:U("tool_id").references(()=>lr.id),toolName:P("tool_name"),priority:P("priority").notNull().default("medium"),isRead:Ue("is_read").notNull().default(!1),actionRequired:Ue("action_required").notNull().default(!1),metadata:Jt("metadata"),createdAt:Z("created_at").defaultNow().notNull(),readAt:Z("read_at")});Oe(tE);Oe(J5).omit({id:!0,createdAt:!0});const sE=Ve("approvals",{id:U("id").primaryKey().default(we`gen_random_uuid()`),objectType:P("object_type").notNull(),objectId:U("object_id").notNull(),requestedBy:U("requested_by").notNull().references(()=>vt.id),approverId:U("approver_id").references(()=>vt.id),currentLevel:ht("current_level").notNull().default(1),totalLevels:ht("total_levels").notNull().default(1),amount:ve("amount",{precision:12,scale:2}),title:P("title").notNull(),description:P("description"),priority:P("priority").notNull().default("medium"),status:P("status").notNull().default("pending"),reason:P("reason"),metadata:Jt("metadata"),dueDate:Z("due_date"),decidedAt:Z("decided_at"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),bN=Ve("channels",{id:U("id").primaryKey().default(we`gen_random_uuid()`),name:P("name").notNull(),type:P("type").notNull().default("approval"),relatedObjectType:P("related_object_type"),relatedObjectId:U("related_object_id"),participantIds:Jt("participant_ids").notNull(),isPrivate:Ue("is_private").notNull().default(!1),createdBy:U("created_by").notNull().references(()=>vt.id),lastMessageAt:Z("last_message_at"),createdAt:Z("created_at").defaultNow().notNull()}),rE=Ve("messages",{id:U("id").primaryKey().default(we`gen_random_uuid()`),channelId:U("channel_id").notNull().references(()=>bN.id,{onDelete:"cascade"}),senderId:U("sender_id").notNull().references(()=>vt.id),content:P("content").notNull(),messageType:P("message_type").notNull().default("text"),attachments:Jt("attachments"),relatedObjectType:P("related_object_type"),relatedObjectId:U("related_object_id"),isDecision:Ue("is_decision").notNull().default(!1),decisionType:P("decision_type"),isEdited:Ue("is_edited").notNull().default(!1),editedAt:Z("edited_at"),createdAt:Z("created_at").defaultNow().notNull()}),aE=Ve("actions",{id:U("id").primaryKey().default(we`gen_random_uuid()`),title:P("title").notNull(),description:P("description").notNull(),category:P("category").notNull(),priority:P("priority").notNull().default("medium"),ownerId:U("owner_id").notNull().references(()=>vt.id),assignedTo:U("assigned_to").references(()=>vt.id),relatedObjectType:P("related_object_type"),relatedObjectId:U("related_object_id"),status:P("status").notNull().default("open"),progress:ht("progress").notNull().default(0),estimatedCost:ve("estimated_cost",{precision:10,scale:2}),actualCost:ve("actual_cost",{precision:10,scale:2}),dueDate:zr("due_date"),startedAt:Z("started_at"),completedAt:Z("completed_at"),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull(),updatedAt:Z("updated_at").defaultNow().notNull()}),nE=Ve("system_events",{id:U("id").primaryKey().default(we`gen_random_uuid()`),eventType:P("event_type").notNull(),objectType:P("object_type").notNull(),objectId:U("object_id").notNull(),userId:U("user_id").references(()=>vt.id),eventData:Jt("event_data").notNull(),processed:Ue("processed").notNull().default(!1),processedAt:Z("processed_at"),createdAt:Z("created_at").defaultNow().notNull()});Oe(sE).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({amount:dt.string().optional()});Oe(bN).omit({id:!0,createdAt:!0});Oe(rE).omit({id:!0,createdAt:!0});Oe(aE).omit({id:!0,createdAt:!0,updatedAt:!0}).extend({estimatedCost:dt.string().optional(),actualCost:dt.string().optional()});Oe(nE).omit({id:!0,createdAt:!0});const yi=Ve("accounts",{id:U("id").primaryKey().default(we`gen_random_uuid()`),code:P("code").unique().notNull(),name:P("name").notNull(),type:P("type").notNull(),currency:P("currency").default("SAR").notNull(),parentId:U("parent_id"),isActive:Ue("is_active").default(!0).notNull(),description:P("description"),createdAt:Z("created_at").defaultNow().notNull()}),fl=Ve("transactions",{id:U("id").primaryKey().default(we`gen_random_uuid()`),docNumber:P("doc_number"),date:zr("date").notNull(),description:P("description"),totalAmount:ve("total_amount",{precision:12,scale:2}).notNull(),currency:P("currency").default("SAR").notNull(),status:P("status").default("draft").notNull(),transactionType:P("transaction_type").notNull(),projectId:U("project_id").references(()=>Vt.id),relatedObjectType:P("related_object_type"),relatedObjectId:U("related_object_id"),createdBy:U("created_by").references(()=>vt.id),approvedBy:U("approved_by").references(()=>vt.id),postedBy:U("posted_by").references(()=>vt.id),approvedAt:Z("approved_at"),postedAt:Z("posted_at"),createdAt:Z("created_at").defaultNow().notNull()}),iE=Ve("transaction_lines",{id:U("id").primaryKey().default(we`gen_random_uuid()`),transactionId:U("transaction_id").notNull().references(()=>fl.id,{onDelete:"cascade"}),accountId:U("account_id").notNull().references(()=>yi.id),debit:ve("debit",{precision:12,scale:2}).default("0").notNull(),credit:ve("credit",{precision:12,scale:2}).default("0").notNull(),description:P("description"),costCenter:P("cost_center"),projectId:U("project_id").references(()=>Vt.id),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),oE=Ve("journals",{id:U("id").primaryKey().default(we`gen_random_uuid()`),transactionId:U("transaction_id").notNull().references(()=>fl.id),journalNumber:P("journal_number").unique(),period:P("period").notNull(),isReversed:Ue("is_reversed").default(!1).notNull(),reversalJournalId:U("reversal_journal_id"),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull(),postedAt:Z("posted_at")}),lE=Ve("finance_payments",{id:U("id").primaryKey().default(we`gen_random_uuid()`),transactionId:U("transaction_id").references(()=>fl.id),paymentNumber:P("payment_number").unique(),paymentType:P("payment_type").notNull(),amount:ve("amount",{precision:12,scale:2}).notNull(),currency:P("currency").default("SAR").notNull(),fromAccount:U("from_account").references(()=>yi.id),toAccount:U("to_account").references(()=>yi.id),bankReference:P("bank_reference"),checkNumber:P("check_number"),dueDate:zr("due_date"),paidDate:zr("paid_date"),payerId:U("payer_id"),payeeId:U("payee_id"),status:P("status").default("pending").notNull(),notes:P("notes"),createdAt:Z("created_at").defaultNow().notNull()}),cE=Ve("finance_events",{id:U("id").primaryKey().default(we`gen_random_uuid()`),eventName:P("event_name").notNull(),eventType:P("event_type").notNull(),objectType:P("object_type"),objectId:U("object_id"),payload:Jt("payload"),metadata:Jt("metadata"),triggeredBy:U("triggered_by").references(()=>vt.id),processed:Ue("processed").default(!1).notNull(),processedAt:Z("processed_at"),createdAt:Z("created_at").defaultNow().notNull()});Ve("account_balances",{id:U("id").primaryKey().default(we`gen_random_uuid()`),accountId:U("account_id").notNull().references(()=>yi.id),projectId:U("project_id").references(()=>Vt.id),period:P("period").notNull(),openingBalance:ve("opening_balance",{precision:12,scale:2}).default("0").notNull(),debitTotal:ve("debit_total",{precision:12,scale:2}).default("0").notNull(),creditTotal:ve("credit_total",{precision:12,scale:2}).default("0").notNull(),closingBalance:ve("closing_balance",{precision:12,scale:2}).default("0").notNull(),lastUpdated:Z("last_updated").defaultNow().notNull(),createdAt:Z("created_at").defaultNow().notNull()},t=>({uniqueAccountPeriod:we`UNIQUE (account_id, period, project_id)`}));Oe(yi).omit({id:!0,createdAt:!0});Oe(fl).omit({id:!0,createdAt:!0,approvedAt:!0,postedAt:!0});Oe(iE).omit({id:!0,createdAt:!0});Oe(oE).omit({id:!0,createdAt:!0,postedAt:!0});Oe(lE).omit({id:!0,createdAt:!0});Oe(cE).omit({id:!0,createdAt:!0,processedAt:!0});const dE=Ve("notifications",{id:U("id").primaryKey().default(we`gen_random_uuid()`),title:P("title").notNull(),body:P("body").notNull(),type:P("type").notNull(),priority:ht("priority").notNull().default(3),projectId:U("project_id").references(()=>Vt.id),createdBy:U("created_by").references(()=>vt.id),recipients:P("recipients").array(),payload:Jt("payload"),meta:Jt("meta"),readBy:P("read_by").array(),deliveredTo:P("delivered_to").array(),scheduledAt:Z("scheduled_at"),channelPreference:Jt("channel_preference"),createdAt:Z("created_at").defaultNow().notNull()});Oe(dE).omit({id:!0,createdAt:!0});function Cn({className:t,...s}){return e.jsx("div",{className:de("animate-pulse rounded-md bg-muted",t),...s})}function uE(){const{toast:t}=Dt(),s=Gt(),[r,a]=f.useState(!1),[n,i]=f.useState(null),{setFloatingAction:o}=Ps(),{selectedProjectId:l,selectProject:u}=Mi(),d=l||"all";f.useEffect(()=>(o(()=>{a(!0),i(null)},"إضافة عملية ترحيل"),()=>o(null)),[o]);const c=async(w,v)=>{if(!(!v||typeof v!="string"||!v.trim()))try{await me("/api/autocomplete","POST",{category:w,value:v.trim()})}catch(D){console.log(`Failed to save autocomplete value for ${w}:`,D)}},{data:m=[],isLoading:h}=Se({queryKey:["/api/projects"]}),{data:x=[],isLoading:p}=Se({queryKey:["/api/project-fund-transfers"],queryFn:async()=>(await me("/api/project-fund-transfers","GET")).data||[]}),k=Ae({mutationFn:async w=>(await Promise.all([c("transferReasons",w.transferReason),c("projectTransferDescriptions",w.description)]),n?me(`/api/project-fund-transfers/${n.id}`,"PATCH",w):me("/api/project-fund-transfers","POST",w)),onSuccess:async(w,v)=>{s.invalidateQueries({queryKey:["/api/autocomplete"]}),s.setQueryData(["/api/project-fund-transfers"],D=>D?n?D.map(V=>V.id===n.id?w:V):[w,...D]:[w]),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم بنجاح",description:n?"تم تحديث عملية ترحيل الأموال بنجاح":"تم إنشاء عملية ترحيل الأموال بنجاح"}),a(!1),i(null),b.reset()},onError:async(w,v)=>{await Promise.all([c("transferReasons",v.transferReason),c("projectTransferDescriptions",v.description)]),s.invalidateQueries({queryKey:["/api/autocomplete"]}),t({title:"خطأ",description:w.message||"فشل في حفظ عملية الترحيل",variant:"destructive"})}}),g=Ae({mutationFn:w=>me(`/api/project-fund-transfers/${w}`,"DELETE"),onSuccess:(w,v)=>{s.setQueryData(["/api/project-fund-transfers"],D=>D?D.filter(V=>V.id!==v):[]),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم الحذف",description:"تم حذف عملية ترحيل الأموال بنجاح"})},onError:w=>{t({title:"خطأ",description:w.message||"فشل في حذف عملية الترحيل",variant:"destructive"})}}),b=wr({resolver:kr(z5),defaultValues:{fromProjectId:"",toProjectId:"",amount:"",transferReason:"",transferDate:new Date().toISOString().split("T")[0],description:""}}),j=w=>{k.mutate(w)},y=w=>{i(w),b.reset({fromProjectId:w.fromProjectId,toProjectId:w.toProjectId,amount:w.amount,transferReason:w.transferReason||"",transferDate:w.transferDate,description:w.description||""}),a(!0)},M=()=>{i(null),a(!1),b.reset()},N=(w,v,D)=>{confirm(`هل أنت متأكد من حذف عملية الترحيل من ${v} إلى ${D}؟`)&&g.mutate(w)},T=w=>m.find(D=>D.id===w)?.name||"غير محدد",S=d!=="all"?x.filter(w=>w.fromProjectId===d||w.toProjectId===d):x,I={totalTransfers:S.length,totalAmount:S.reduce((w,v)=>w+(parseFloat(v.amount?.toString()||"0")||0),0),outgoingTransfers:d!=="all"?S.filter(w=>w.fromProjectId===d).length:0,incomingTransfers:d!=="all"?S.filter(w=>w.toProjectId===d).length:0,outgoingAmount:d!=="all"?S.filter(w=>w.fromProjectId===d).reduce((w,v)=>w+(parseFloat(v.amount?.toString()||"0")||0),0):0,incomingAmount:d!=="all"?S.filter(w=>w.toProjectId===d).reduce((w,v)=>w+(parseFloat(v.amount?.toString()||"0")||0),0):0},E=I.incomingAmount-I.outgoingAmount,z=w=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(w)+" ريال";return e.jsxs("div",{className:"container mx-auto p-4 md:p-6 space-y-6 md:space-y-8",dir:"rtl",children:[e.jsx("div",{className:"bg-card border rounded-lg p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(ba,{className:"h-6 w-6 md:h-7 md:w-7 text-primary"}),"تحويلات العهدة"]}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"إدارة وتتبع عمليات ترحيل الأموال بين المشاريع المختلفة"})]}),e.jsxs(K,{onClick:()=>{a(!0),i(null)},className:"bg-primary hover:bg-primary/90 text-primary-foreground h-11 px-6","data-testid":"button-add-transfer-header",children:[e.jsx(os,{className:"h-4 w-4 ml-2"}),"إضافة عملية ترحيل"]})]})}),e.jsxs("div",{className:"bg-card border rounded-lg p-4",children:[e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Ai,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsx(Ii,{selectedProjectId:d,onProjectChange:(w,v)=>u(w,v),showHeader:!1,variant:"compact"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:[e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"إجمالي العمليات"}),e.jsx("p",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:I.totalTransfers})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ba,{className:"h-6 w-6 text-primary"})})]})}),e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"إجمالي المبالغ"}),e.jsx("p",{className:"text-xl md:text-2xl font-semibold text-foreground",children:z(I.totalAmount)})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center",children:e.jsx(Ns,{className:"h-6 w-6 text-green-600 dark:text-green-400"})})]})}),d!=="all"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"العمليات الصادرة"}),e.jsx("p",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:I.outgoingTransfers}),e.jsx("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400",children:z(I.outgoingAmount)})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/20 flex items-center justify-center",children:e.jsx(Zn,{className:"h-6 w-6 text-red-600 dark:text-red-400"})})]})}),e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"العمليات الواردة"}),e.jsx("p",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:I.incomingTransfers}),e.jsx("p",{className:"text-xs md:text-sm text-green-600 dark:text-green-400",children:z(I.incomingAmount)})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center",children:e.jsx(bs,{className:"h-6 w-6 text-green-600 dark:text-green-400"})})]})})]})]}),d!=="all"&&e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"صافي التدفق"}),e.jsxs("p",{className:`text-2xl md:text-3xl font-semibold ${E>0?"text-green-600 dark:text-green-400":E<0?"text-red-600 dark:text-red-400":"text-foreground"}`,children:[E>0?"+":"",z(E)]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:E>0?"زيادة في الرصيد":E<0?"نقص في الرصيد":"متزن الرصيد"})]}),e.jsx("div",{className:`h-12 w-12 rounded-full flex items-center justify-center ${E>0?"bg-green-100 dark:bg-green-900/20":E<0?"bg-red-100 dark:bg-red-900/20":"bg-gray-100 dark:bg-gray-900/20"}`,children:E>0?e.jsx(bs,{className:"h-6 w-6 text-green-600 dark:text-green-400"}):E<0?e.jsx(Zn,{className:"h-6 w-6 text-red-600 dark:text-red-400"}):e.jsx(_2,{className:"h-6 w-6 text-gray-600 dark:text-gray-400"})})]})}),r&&e.jsxs("div",{className:"bg-card border rounded-lg",children:[e.jsx("div",{className:"p-4 md:p-6 border-b",children:e.jsx("h2",{className:"text-lg md:text-xl font-bold text-foreground",children:n?"تعديل عملية الترحيل":"إضافة عملية ترحيل جديدة"})}),e.jsx("div",{className:"p-4 md:p-6",children:e.jsx(Sr,{...b,children:e.jsxs("form",{onSubmit:b.handleSubmit(j),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ut,{control:b.control,name:"fromProjectId",render:({field:w})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"المشروع المرسل"}),e.jsx(lt,{children:e.jsxs(We,{value:w.value,onValueChange:w.onChange,"data-testid":"select-from-project",children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر المشروع المرسل"})}),e.jsx(Be,{children:m.map(v=>e.jsx(W,{value:v.id,children:v.name},v.id))})]})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:b.control,name:"toProjectId",render:({field:w})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"المشروع المستلم"}),e.jsx(lt,{children:e.jsxs(We,{value:w.value,onValueChange:w.onChange,"data-testid":"select-to-project",children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر المشروع المستلم"})}),e.jsx(Be,{children:m.map(v=>e.jsx(W,{value:v.id,children:v.name},v.id))})]})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:b.control,name:"amount",render:({field:w})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"المبلغ (ر.ي)"}),e.jsx(lt,{children:e.jsx(je,{type:"number",step:"0.01",placeholder:"أدخل المبلغ",...w,"data-testid":"input-amount"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:b.control,name:"transferDate",render:({field:w})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"تاريخ الترحيل"}),e.jsx(lt,{children:e.jsx(je,{type:"date",...w,"data-testid":"input-transfer-date"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:b.control,name:"transferReason",render:({field:w})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"سبب الترحيل"}),e.jsx(lt,{children:e.jsx(je,{placeholder:"أدخل سبب الترحيل",...w,value:w.value||"","data-testid":"input-transfer-reason"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:b.control,name:"description",render:({field:w})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"وصف الترحيل (اختياري)"}),e.jsx(lt,{children:e.jsx(Fa,{placeholder:"أدخل وصف للترحيل",...w,value:w.value||"","data-testid":"textarea-description"})}),e.jsx(ct,{})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(K,{type:"submit",disabled:k.isPending,className:"bg-primary hover:bg-primary/90 text-primary-foreground h-11","data-testid":"button-submit-transfer",children:k.isPending?"جاري الحفظ...":n?"تحديث عملية الترحيل":"حفظ عملية الترحيل"}),e.jsx(K,{type:"button",variant:"outline",onClick:M,className:"h-11","data-testid":"button-cancel",children:"إلغاء"})]})]})})})]}),e.jsxs("div",{className:"bg-card border rounded-lg",children:[e.jsx("div",{className:"p-4 md:p-6 border-b",children:e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Br,{className:"w-5 h-5"}),"سجل عمليات الترحيل"]})}),e.jsx("div",{className:"p-4 md:p-6",children:p?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(w=>e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Cn,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Cn,{className:"h-6 w-32"}),e.jsx(Cn,{className:"h-8 w-20"})]}),e.jsx(Cn,{className:"h-4 w-48"}),e.jsx(Cn,{className:"h-4 w-24"})]})]})},w))}):S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:e.jsx(ba,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"لا توجد عمليات ترحيل"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground mb-4",children:d!=="all"?"لم يتم إجراء عمليات ترحيل للمشروع المحدد بعد":"لم يتم إجراء عمليات ترحيل بين المشاريع بعد"}),e.jsxs(K,{onClick:()=>{a(!0),i(null)},className:"bg-primary hover:bg-primary/90 text-primary-foreground","data-testid":"button-add-first-transfer",children:[e.jsx(os,{className:"h-4 w-4 ml-2"}),"إضافة عملية ترحيل"]})]}):e.jsx("div",{className:"space-y-4",children:S.map(w=>{const v=d!=="all"&&w.fromProjectId===d,D=d!=="all"&&w.toProjectId===d;return e.jsx("div",{className:"bg-card border rounded-lg p-4 hover:shadow-md transition-all duration-200","data-testid":`card-transfer-${w.id}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-semibold text-foreground mb-1",children:parseFloat(w.amount).toLocaleString()}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground",children:"ريال"}),(v||D)&&e.jsx(Fe,{variant:v?"destructive":"default",className:"mt-2 text-xs",children:v?"صادر":"وارد"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm md:text-base font-medium text-muted-foreground",children:T(w.fromProjectId)}),e.jsx(ba,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm md:text-base font-medium text-muted-foreground",children:T(w.toProjectId)})]}),e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(yr,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground",children:new Date(w.transferDate).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"})})]}),(w.transferReason||w.description)&&e.jsxs("div",{className:"space-y-1 text-sm md:text-base",children:[w.transferReason&&e.jsxs("div",{className:"text-foreground",children:[e.jsx("span",{className:"font-medium",children:"السبب:"})," ",w.transferReason]}),w.description&&e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"ملاحظات:"})," ",w.description]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ID: ",w.id.slice(0,8)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{variant:"outline",size:"sm",onClick:()=>y(w),className:"h-11 min-w-11 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20","data-testid":`button-edit-${w.id}`,children:e.jsx(x0,{className:"w-4 h-4"})}),e.jsx(K,{variant:"outline",size:"sm",onClick:()=>N(w.id,T(w.fromProjectId),T(w.toProjectId)),className:"h-11 min-w-11 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20",disabled:g.isPending,"data-testid":`button-delete-${w.id}`,children:e.jsx(es,{className:"w-4 h-4"})})]})]})]})]})},w.id)})})})]})]})}function cr(t){const s=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&s==="[object Date]"?new t.constructor(+t):typeof t=="number"||s==="[object Number]"||typeof t=="string"||s==="[object String]"?new Date(t):new Date(NaN)}function Da(t,s){return t instanceof Date?new t.constructor(s):new Date(s)}const jN=6048e5,mE=864e5;let hE={};function pl(){return hE}function vi(t,s){const r=pl(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,n=cr(t),i=n.getDay(),o=(i<a?7:0)+i-a;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function Mo(t){return vi(t,{weekStartsOn:1})}function NN(t){const s=cr(t),r=s.getFullYear(),a=Da(t,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const n=Mo(a),i=Da(t,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);const o=Mo(i);return s.getTime()>=n.getTime()?r+1:s.getTime()>=o.getTime()?r:r-1}function Ah(t){const s=cr(t);return s.setHours(0,0,0,0),s}function _h(t){const s=cr(t),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+t-+r}function fE(t,s){const r=Ah(t),a=Ah(s),n=+r-_h(r),i=+a-_h(a);return Math.round((n-i)/mE)}function pE(t){const s=NN(t),r=Da(t,0);return r.setFullYear(s,0,4),r.setHours(0,0,0,0),Mo(r)}function xE(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function gE(t){if(!xE(t)&&typeof t!="number")return!1;const s=cr(t);return!isNaN(Number(s))}function yE(t){const s=cr(t),r=Da(t,0);return r.setFullYear(s.getFullYear(),0,1),r.setHours(0,0,0,0),r}const vE={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},bE=(t,s,r)=>{let a;const n=vE[t];return typeof n=="string"?a=n:s===1?a=n.one:a=n.other.replace("{{count}}",s.toString()),r?.addSuffix?r.comparison&&r.comparison>0?"in "+a:a+" ago":a};function sn(t){return(s={})=>{const r=s.width?String(s.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const jE={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},NE={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},wE={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},kE={date:sn({formats:jE,defaultWidth:"full"}),time:sn({formats:NE,defaultWidth:"full"}),dateTime:sn({formats:wE,defaultWidth:"full"})},TE={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},SE=(t,s,r,a)=>TE[t];function fr(t){return(s,r)=>{const a=r?.context?String(r.context):"standalone";let n;if(a==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,l=r?.width?String(r.width):o;n=t.formattingValues[l]||t.formattingValues[o]}else{const o=t.defaultWidth,l=r?.width?String(r.width):t.defaultWidth;n=t.values[l]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(s):s;return n[i]}}const AE={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},_E={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},CE={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},PE={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},EE={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},DE={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ME=(t,s)=>{const r=Number(t),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},IE={ordinalNumber:ME,era:fr({values:AE,defaultWidth:"wide"}),quarter:fr({values:_E,defaultWidth:"wide",argumentCallback:t=>t-1}),month:fr({values:CE,defaultWidth:"wide"}),day:fr({values:PE,defaultWidth:"wide"}),dayPeriod:fr({values:EE,defaultWidth:"wide",formattingValues:DE,defaultFormattingWidth:"wide"})};function pr(t){return(s,r={})=>{const a=r.width,n=a&&t.matchPatterns[a]||t.matchPatterns[t.defaultMatchWidth],i=s.match(n);if(!i)return null;const o=i[0],l=a&&t.parsePatterns[a]||t.parsePatterns[t.defaultParseWidth],u=Array.isArray(l)?FE(l,m=>m.test(o)):RE(l,m=>m.test(o));let d;d=t.valueCallback?t.valueCallback(u):u,d=r.valueCallback?r.valueCallback(d):d;const c=s.slice(o.length);return{value:d,rest:c}}}function RE(t,s){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&s(t[r]))return r}function FE(t,s){for(let r=0;r<t.length;r++)if(s(t[r]))return r}function wN(t){return(s,r={})=>{const a=s.match(t.matchPattern);if(!a)return null;const n=a[0],i=s.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;const l=s.slice(n.length);return{value:o,rest:l}}}const $E=/^(\d+)(th|st|nd|rd)?/i,VE=/\d+/i,OE={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},LE={any:[/^b/i,/^(a|c)/i]},zE={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},BE={any:[/1/i,/2/i,/3/i,/4/i]},qE={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},UE={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},WE={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},KE={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},GE={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},HE={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},QE={ordinalNumber:wN({matchPattern:$E,parsePattern:VE,valueCallback:t=>parseInt(t,10)}),era:pr({matchPatterns:OE,defaultMatchWidth:"wide",parsePatterns:LE,defaultParseWidth:"any"}),quarter:pr({matchPatterns:zE,defaultMatchWidth:"wide",parsePatterns:BE,defaultParseWidth:"any",valueCallback:t=>t+1}),month:pr({matchPatterns:qE,defaultMatchWidth:"wide",parsePatterns:UE,defaultParseWidth:"any"}),day:pr({matchPatterns:WE,defaultMatchWidth:"wide",parsePatterns:KE,defaultParseWidth:"any"}),dayPeriod:pr({matchPatterns:GE,defaultMatchWidth:"any",parsePatterns:HE,defaultParseWidth:"any"})},XE={code:"en-US",formatDistance:bE,formatLong:kE,formatRelative:SE,localize:IE,match:QE,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ZE(t){const s=cr(t);return fE(s,yE(s))+1}function YE(t){const s=cr(t),r=+Mo(s)-+pE(s);return Math.round(r/jN)+1}function kN(t,s){const r=cr(t),a=r.getFullYear(),n=pl(),i=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=Da(t,0);o.setFullYear(a+1,0,i),o.setHours(0,0,0,0);const l=vi(o,s),u=Da(t,0);u.setFullYear(a,0,i),u.setHours(0,0,0,0);const d=vi(u,s);return r.getTime()>=l.getTime()?a+1:r.getTime()>=d.getTime()?a:a-1}function JE(t,s){const r=pl(),a=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,n=kN(t,s),i=Da(t,0);return i.setFullYear(n,0,a),i.setHours(0,0,0,0),vi(i,s)}function eD(t,s){const r=cr(t),a=+vi(r,s)-+JE(r,s);return Math.round(a/jN)+1}function kt(t,s){const r=t<0?"-":"",a=Math.abs(t).toString().padStart(s,"0");return r+a}const Jr={y(t,s){const r=t.getFullYear(),a=r>0?r:1-r;return kt(s==="yy"?a%100:a,s.length)},M(t,s){const r=t.getMonth();return s==="M"?String(r+1):kt(r+1,2)},d(t,s){return kt(t.getDate(),s.length)},a(t,s){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,s){return kt(t.getHours()%12||12,s.length)},H(t,s){return kt(t.getHours(),s.length)},m(t,s){return kt(t.getMinutes(),s.length)},s(t,s){return kt(t.getSeconds(),s.length)},S(t,s){const r=s.length,a=t.getMilliseconds(),n=Math.trunc(a*Math.pow(10,r-3));return kt(n,s.length)}},La={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ch={G:function(t,s,r){const a=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(t,s,r){if(s==="yo"){const a=t.getFullYear(),n=a>0?a:1-a;return r.ordinalNumber(n,{unit:"year"})}return Jr.y(t,s)},Y:function(t,s,r,a){const n=kN(t,a),i=n>0?n:1-n;if(s==="YY"){const o=i%100;return kt(o,2)}return s==="Yo"?r.ordinalNumber(i,{unit:"year"}):kt(i,s.length)},R:function(t,s){const r=NN(t);return kt(r,s.length)},u:function(t,s){const r=t.getFullYear();return kt(r,s.length)},Q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(a);case"QQ":return kt(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(a);case"qq":return kt(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,s,r){const a=t.getMonth();switch(s){case"M":case"MM":return Jr.M(t,s);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(t,s,r){const a=t.getMonth();switch(s){case"L":return String(a+1);case"LL":return kt(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(t,s,r,a){const n=eD(t,a);return s==="wo"?r.ordinalNumber(n,{unit:"week"}):kt(n,s.length)},I:function(t,s,r){const a=YE(t);return s==="Io"?r.ordinalNumber(a,{unit:"week"}):kt(a,s.length)},d:function(t,s,r){return s==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):Jr.d(t,s)},D:function(t,s,r){const a=ZE(t);return s==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):kt(a,s.length)},E:function(t,s,r){const a=t.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return kt(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return kt(i,s.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(t,s,r){const a=t.getDay(),n=a===0?7:a;switch(s){case"i":return String(n);case"ii":return kt(n,s.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(t,s,r){const n=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(t,s,r){const a=t.getHours();let n;switch(a===12?n=La.noon:a===0?n=La.midnight:n=a/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(t,s,r){const a=t.getHours();let n;switch(a>=17?n=La.evening:a>=12?n=La.afternoon:a>=4?n=La.morning:n=La.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(t,s,r){if(s==="ho"){let a=t.getHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return Jr.h(t,s)},H:function(t,s,r){return s==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):Jr.H(t,s)},K:function(t,s,r){const a=t.getHours()%12;return s==="Ko"?r.ordinalNumber(a,{unit:"hour"}):kt(a,s.length)},k:function(t,s,r){let a=t.getHours();return a===0&&(a=24),s==="ko"?r.ordinalNumber(a,{unit:"hour"}):kt(a,s.length)},m:function(t,s,r){return s==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):Jr.m(t,s)},s:function(t,s,r){return s==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):Jr.s(t,s)},S:function(t,s){return Jr.S(t,s)},X:function(t,s,r){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(s){case"X":return Eh(a);case"XXXX":case"XX":return ga(a);case"XXXXX":case"XXX":default:return ga(a,":")}},x:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"x":return Eh(a);case"xxxx":case"xx":return ga(a);case"xxxxx":case"xxx":default:return ga(a,":")}},O:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+Ph(a,":");case"OOOO":default:return"GMT"+ga(a,":")}},z:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+Ph(a,":");case"zzzz":default:return"GMT"+ga(a,":")}},t:function(t,s,r){const a=Math.trunc(t.getTime()/1e3);return kt(a,s.length)},T:function(t,s,r){const a=t.getTime();return kt(a,s.length)}};function Ph(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=Math.trunc(a/60),i=a%60;return i===0?r+String(n):r+String(n)+s+kt(i,2)}function Eh(t,s){return t%60===0?(t>0?"-":"+")+kt(Math.abs(t)/60,2):ga(t,s)}function ga(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=kt(Math.trunc(a/60),2),i=kt(a%60,2);return r+n+s+i}const Dh=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},TN=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},tD=(t,s)=>{const r=t.match(/(P+)(p+)?/)||[],a=r[1],n=r[2];if(!n)return Dh(t,s);let i;switch(a){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",Dh(a,s)).replace("{{time}}",TN(n,s))},sD={p:TN,P:tD},rD=/^D+$/,aD=/^Y+$/,nD=["D","DD","YY","YYYY"];function iD(t){return rD.test(t)}function oD(t){return aD.test(t)}function lD(t,s,r){const a=cD(t,s,r);if(console.warn(a),nD.includes(t))throw new RangeError(a)}function cD(t,s,r){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${a} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const dD=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,uD=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,mD=/^'([^]*?)'?$/,hD=/''/g,fD=/[a-zA-Z]/;function Mh(t,s,r){const a=pl(),n=r?.locale??a.locale??XE,i=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,o=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,l=cr(t);if(!gE(l))throw new RangeError("Invalid time value");let u=s.match(uD).map(c=>{const m=c[0];if(m==="p"||m==="P"){const h=sD[m];return h(c,n.formatLong)}return c}).join("").match(dD).map(c=>{if(c==="''")return{isToken:!1,value:"'"};const m=c[0];if(m==="'")return{isToken:!1,value:pD(c)};if(Ch[m])return{isToken:!0,value:c};if(m.match(fD))throw new RangeError("Format string contains an unescaped latin alphabet character `"+m+"`");return{isToken:!1,value:c}});n.localize.preprocessor&&(u=n.localize.preprocessor(l,u));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return u.map(c=>{if(!c.isToken)return c.value;const m=c.value;(!r?.useAdditionalWeekYearTokens&&oD(m)||!r?.useAdditionalDayOfYearTokens&&iD(m))&&lD(m,s,String(t));const h=Ch[m[0]];return h(l,m,n.localize,d)}).join("")}function pD(t){const s=t.match(mD);return s?s[1].replace(hD,"'"):t}const xD={lessThanXSeconds:{one:"أقل من ثانية",two:"أقل من ثانيتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانيتان",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتان",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريبا",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتان",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومان",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريبا",two:"أسبوعين تقريبا",threeToTen:"{{count}} أسابيع تقريبا",other:"{{count}} أسبوعا تقريبا"},xWeeks:{one:"أسبوع واحد",two:"أسبوعان",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوعا"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريبا",threeToTen:"{{count}} أشهر تقريبا",other:"{{count}} شهرا تقريباً"},xMonths:{one:"شهر واحد",two:"شهران",threeToTen:"{{count}} أشهر",other:"{{count}} شهرا"},aboutXYears:{one:"سنة واحدة تقريباً",two:"سنتين تقريبا",threeToTen:"{{count}} سنوات تقريباً",other:"{{count}} سنة تقريباً"},xYears:{one:"سنة واحد",two:"سنتان",threeToTen:"{{count}} سنوات",other:"{{count}} سنة"},overXYears:{one:"أكثر من سنة",two:"أكثر من سنتين",threeToTen:"أكثر من {{count}} سنوات",other:"أكثر من {{count}} سنة"},almostXYears:{one:"ما يقارب سنة واحدة",two:"ما يقارب سنتين",threeToTen:"ما يقارب {{count}} سنوات",other:"ما يقارب {{count}} سنة"}},gD=(t,s,r)=>{const a=xD[t];let n;return typeof a=="string"?n=a:s===1?n=a.one:s===2?n=a.two:s<=10?n=a.threeToTen.replace("{{count}}",String(s)):n=a.other.replace("{{count}}",String(s)),r?.addSuffix?r.comparison&&r.comparison>0?"خلال "+n:"منذ "+n:n},yD={full:"EEEE، do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},vD={full:"HH:mm:ss",long:"HH:mm:ss",medium:"HH:mm:ss",short:"HH:mm"},bD={full:"{{date}} 'عند الساعة' {{time}}",long:"{{date}} 'عند الساعة' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},jD={date:sn({formats:yD,defaultWidth:"full"}),time:sn({formats:vD,defaultWidth:"full"}),dateTime:sn({formats:bD,defaultWidth:"full"})},ND={lastWeek:"eeee 'الماضي عند الساعة' p",yesterday:"'الأمس عند الساعة' p",today:"'اليوم عند الساعة' p",tomorrow:"'غدا عند الساعة' p",nextWeek:"eeee 'القادم عند الساعة' p",other:"P"},wD=t=>ND[t],kD={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},TD={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},SD={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},AD={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},_D={narrow:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"}},CD={narrow:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"}},PD=t=>String(t),ED={ordinalNumber:PD,era:fr({values:kD,defaultWidth:"wide"}),quarter:fr({values:TD,defaultWidth:"wide",argumentCallback:t=>t-1}),month:fr({values:SD,defaultWidth:"wide"}),day:fr({values:AD,defaultWidth:"wide"}),dayPeriod:fr({values:_D,defaultWidth:"wide",formattingValues:CD,defaultFormattingWidth:"wide"})},DD=/^(\d+)(th|st|nd|rd)?/i,MD=/\d+/i,ID={narrow:/[قب]/,abbreviated:/[قب]\.م\./,wide:/(قبل|بعد) الميلاد/},RD={any:[/قبل/,/بعد/]},FD={narrow:/^[1234]/i,abbreviated:/ر[1234]/,wide:/الربع (الأول|الثاني|الثالث|الرابع)/},$D={any:[/1/i,/2/i,/3/i,/4/i]},VD={narrow:/^[أيفمسند]/,abbreviated:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/,wide:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/},OD={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^يناير/i,/^فبراير/i,/^مارس/i,/^أبريل/i,/^مايو/i,/^يونيو/i,/^يوليو/i,/^أغسطس/i,/^سبتمبر/i,/^أكتوبر/i,/^نوفمبر/i,/^ديسمبر/i]},LD={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},zD={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},BD={narrow:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/,any:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/},qD={any:{am:/^ص/,pm:/^م/,midnight:/منتصف الليل/,noon:/الظهر/,afternoon:/بعد الظهر/,morning:/في الصباح/,evening:/في المساء/,night:/في الليل/}},UD={ordinalNumber:wN({matchPattern:DD,parsePattern:MD,valueCallback:t=>parseInt(t,10)}),era:pr({matchPatterns:ID,defaultMatchWidth:"wide",parsePatterns:RD,defaultParseWidth:"any"}),quarter:pr({matchPatterns:FD,defaultMatchWidth:"wide",parsePatterns:$D,defaultParseWidth:"any",valueCallback:t=>t+1}),month:pr({matchPatterns:VD,defaultMatchWidth:"wide",parsePatterns:OD,defaultParseWidth:"any"}),day:pr({matchPatterns:LD,defaultMatchWidth:"wide",parsePatterns:zD,defaultParseWidth:"any"}),dayPeriod:pr({matchPatterns:BD,defaultMatchWidth:"any",parsePatterns:qD,defaultParseWidth:"any"})},Ih={code:"ar",formatDistance:gD,formatLong:jD,formatRelative:wD,localize:ED,match:UD,options:{weekStartsOn:6,firstWeekContainsDate:1}},Rh=({stats:t,columns:s=4})=>{const r=`grid grid-cols-1 sm:grid-cols-2 ${s===3?"lg:grid-cols-3":s===4?"lg:grid-cols-4":"lg:grid-cols-2"} gap-3 sm:gap-4`;return e.jsx("div",{className:r,children:t.map((a,n)=>e.jsx(it,{title:a.title,value:a.value,icon:a.icon,color:a.color,formatter:a.formatter},n))})};function WD(){const[t,s]=f.useState(""),[r,a]=f.useState("all"),[n,i]=f.useState(""),{data:o=[]}=Se({queryKey:["/api/projects"]}),{data:l=[],isLoading:u,error:d}=Se({queryKey:["/api/projects",t,"fund-transfers"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب تحويلات العهدة للمشروع: ${t}`);const C=await fetch(`/api/projects/${t}/fund-transfers`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!C.ok)return C.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب تحويلات العهدة: ${C.status}`),[]);const q=await C.json();return console.log(`✅ تم جلب ${Array.isArray(q?.data)?q.data.length:0} تحويل عهدة`),Array.isArray(q?.data)?q.data:[]}catch(C){return console.error("❌ خطأ في جلب تحويلات العهدة:",C),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:c=[],isLoading:m,error:h}=Se({queryKey:["/api/projects",t,"fund-transfers","incoming"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب التحويلات الواردة للمشروع: ${t}`);const C=await fetch(`/api/projects/fund-transfers/incoming/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!C.ok)return C.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب التحويلات الواردة: ${C.status}`),[]);const q=await C.json(),ue=Array.isArray(q?.data)?q.data:Array.isArray(q)?q:[];return console.log(`✅ تم جلب ${ue.length} تحويل وارد فعلي`),ue.length>0&&console.log("🔍 التحويلات الواردة:",ue.map(R=>({من:R.fromProjectName,إلى:R.toProjectName,المبلغ:R.amount,التاريخ:R.transferDate}))),ue}catch(C){return console.error("❌ خطأ في جلب التحويلات الواردة:",C),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:x=[],isLoading:p,error:k}=Se({queryKey:["/api/projects",t,"fund-transfers","outgoing"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب التحويلات الصادرة للمشروع: ${t}`);const C=await fetch(`/api/projects/fund-transfers/outgoing/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!C.ok)return C.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب التحويلات الصادرة: ${C.status}`),[]);const q=await C.json(),ue=Array.isArray(q?.data)?q.data:Array.isArray(q)?q:[];return console.log(`✅ تم جلب ${ue.length} تحويل صادر فعلي`),ue.length>0&&console.log("🔍 التحويلات الصادرة:",ue.map(R=>({من:R.fromProjectName,إلى:R.toProjectName,المبلغ:R.amount,التاريخ:R.transferDate}))),ue}catch(C){return console.error("❌ خطأ في جلب التحويلات الصادرة:",C),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:g=[],isLoading:b,error:j}=Se({queryKey:["/api/projects",t,"attendance"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب حضور العمال للمشروع: ${t}`);const C=await fetch(`/api/projects/${t}/worker-attendance`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!C.ok)return C.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب حضور العمال: ${C.status}`),[]);const q=await C.json();return console.log(`✅ تم جلب ${Array.isArray(q?.data)?q.data.length:0} سجل حضور`),Array.isArray(q?.data)?q.data:[]}catch(C){return console.error("❌ خطأ في جلب حضور العمال:",C),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:y=[],isLoading:M,error:N}=Se({queryKey:["/api/projects",t,"material-purchases"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب مشتريات المواد للمشروع: ${t}`);const C=await fetch(`/api/projects/${t}/material-purchases`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!C.ok)return C.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب مشتريات المواد: ${C.status}`),[]);const q=await C.json();return console.log(`✅ تم جلب ${Array.isArray(q?.data)?q.data.length:0} مشترية مواد`),Array.isArray(q?.data)?q.data:[]}catch(C){return console.error("❌ خطأ في جلب مشتريات المواد:",C),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:T=[]}=Se({queryKey:["/api/projects",t,"transportation-expenses"],enabled:!!t}),{data:S=[]}=Se({queryKey:["/api/projects",t,"worker-misc-expenses"],enabled:!!t}),{data:I=[],isLoading:E,error:z}=Se({queryKey:["/api/projects",t,"worker-transfers"],queryFn:async()=>{if(!t)return[];try{console.log(`🔄 جلب حوالات العمال للمشروع: ${t}`);const C=await fetch(`/api/projects/${t}/worker-transfers`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!C.ok)return C.status===401?(console.error("❌ غير مصرح - يرجى تسجيل الدخول مرة أخرى"),[]):(console.error(`❌ خطأ في جلب حوالات العمال: ${C.status}`),[]);const q=await C.json();return console.log(`✅ تم جلب ${Array.isArray(q?.data)?q.data.length:Array.isArray(q)?q.length:0} حولة عمال`),Array.isArray(q?.data)?q.data:Array.isArray(q)?q:[]}catch(C){return console.error("❌ خطأ في جلب حوالات العمال:",C),[]}},enabled:!!t,retry:1,staleTime:3e4}),{data:w=[]}=Se({queryKey:["/api/workers"]}),v=f.useMemo(()=>{const C=[],q=Array.isArray(l)?l:[],ue=Array.isArray(c)?c:[],R=Array.isArray(x)?x:[],fe=Array.isArray(g)?g:[],ce=Array.isArray(y)?y:[],ne=Array.isArray(T)?T:[],ye=Array.isArray(S)?S:[],tt=Array.isArray(I)?I:[],at=Array.isArray(w)?w:[];console.log(`🎯 بدء معالجة البيانات للمشروع ${t}`),console.log("📊 البيانات المتاحة:",{fundTransfers:q?.length||0,incomingProjectTransfers:ue?.length||0,outgoingProjectTransfers:R?.length||0,workerAttendance:fe?.length||0,materialPurchases:ce?.length||0,transportExpenses:ne?.length||0,miscExpenses:ye?.length||0}),q.length+ue.length+R.length+fe.length+ce.length+ne.length+ye.length,q.forEach(H=>{const L=H.transferDate,Q=parseFloat(H.amount);L&&!isNaN(Q)&&Q>0&&C.push({id:`fund-${H.id}`,date:L,type:"income",category:"تحويل عهدة",amount:Q,description:`من: ${H.senderName||"غير محدد"}`})}),ue.length>0?(console.log(`📥 معالجة ${ue.length} تحويل وارد`),ue.forEach(H=>{const L=H.transferDate,Q=parseFloat(H.amount);L&&!isNaN(Q)&&Q>0&&(console.log(`💰 إضافة تحويل وارد: ${Q} من ${H.fromProjectName}`),C.push({id:`project-in-${H.id}`,date:L,type:"transfer_from_project",category:"تحويل من مشروع آخر",amount:Q,description:`من: ${H.fromProjectName||"مشروع آخر"}`}))})):console.log(`📥 لا توجد تحويلات واردة للمشروع ${t}`),R.length>0?(console.log(`📤 معالجة ${R.length} تحويل صادر`),R.forEach(H=>{const L=H.transferDate,Q=parseFloat(H.amount);L&&!isNaN(Q)&&Q>0&&(console.log(`💸 إضافة تحويل صادر: ${Q} إلى ${H.toProjectName}`),C.push({id:`project-out-${H.id}`,date:L,type:"expense",category:"تحويل إلى مشروع آخر",amount:Q,description:`إلى: ${H.toProjectName||"مشروع آخر"}`}))})):console.log(`📤 لا توجد تحويلات صادرة للمشروع ${t}`),console.log("🔍 معالجة أجور العمال - العدد:",fe.length),fe.length>0&&console.log("🔍 أول عنصر من بيانات أجور العمال:",JSON.stringify(fe[0],null,2)),fe.forEach((H,L)=>{console.log("🔍 معالجة العامل رقم ${index + 1}:",H);const Q=H.date||H.attendanceDate||H.created_at;console.log("📅 التاريخ المستخرج:",Q),console.log("🔍 جميع الحقول المتاحة:",Object.keys(H));let Ne=0;if(H.paidAmount!==void 0&&H.paidAmount!==null&&H.paidAmount!==""){const pt=parseFloat(H.paidAmount);isNaN(pt)||(Ne=Math.max(0,pt),console.log("💰 المبلغ المدفوع فعلياً:",Ne))}if(console.log("✅ النتيجة النهائية:",{date:Q,amount:Ne,hasDate:!!Q,hasAmount:Ne>=0,willAdd:!!Q}),Q){const yt=(Array.isArray(at)?at.find(G=>G.id===H.workerId):void 0)?.name||H.workerName||H.worker?.name||H.name||"غير محدد",Me=H.workDays?` (${H.workDays} يوم)`:"",bt=H.dailyWage?` - أجر يومي: ${Ge(parseFloat(H.dailyWage))}`:"",rs=Ne===0?" (لم يُدفع)":"",ds={id:`wage-${H.id}`,date:Q,type:"expense",category:"أجور العمال",amount:Ne,description:`${yt}${Me}${bt}${rs}`};console.log("✅ إضافة معاملة أجور العمال:",ds),C.push(ds)}else console.log(`❌ تم تخطي العامل ${H.workerName||H.name||"غير معروف"} - السبب: التاريخ مفقود`,{missingDate:!Q,originalData:H})}),ce.forEach(H=>{const L=H.purchaseDate||H.date;let Q=0;if(H.totalAmount&&!isNaN(parseFloat(H.totalAmount))?Q=parseFloat(H.totalAmount):H.amount&&!isNaN(parseFloat(H.amount))?Q=parseFloat(H.amount):H.cost&&!isNaN(parseFloat(H.cost))&&(Q=parseFloat(H.cost)),L&&Q>0){const Ne=H.purchaseType==="آجل"||H.paymentType==="deferred"||H.isDeferred||H.deferred;C.push({id:`material-${H.id}`,date:L,type:Ne?"deferred":"expense",category:Ne?"مشتريات آجلة":"مشتريات المواد",amount:Q,description:`مادة: ${H.materialName||H.name||"غير محدد"}${Ne?" (آجل)":""}`})}}),ne.forEach(H=>{const L=H.date,Q=parseFloat(H.amount);L&&!isNaN(Q)&&Q>0&&C.push({id:`transport-${H.id}`,date:L,type:"expense",category:"مصروفات النقل",amount:Q,description:`نقل: ${H.description||"غير محدد"}`})}),ye.forEach(H=>{const L=H.date,Q=parseFloat(H.amount);L&&!isNaN(Q)&&Q>0&&C.push({id:`misc-${H.id}`,date:L,type:"expense",category:"مصروفات متنوعة",amount:Q,description:`متنوع: ${H.description||H.workerName||"غير محدد"}`})}),tt.forEach(H=>{const L=H.date||H.transferDate,Q=parseFloat(H.amount);if(L&&!isNaN(Q)&&Q>0){const pt=(Array.isArray(at)?at.find(bt=>bt.id===H.workerId):void 0)?.name||H.workerName||"عامل غير معروف",yt=H.recipientName?` - المستلم: ${H.recipientName}`:"",Me=H.transferMethod==="hawaleh"?"حولة":H.transferMethod==="bank"?"تحويل بنكي":"نقداً";C.push({id:`worker-transfer-${H.id}`,date:L,type:"expense",category:"حوالات العمال",amount:Q,description:`${pt}${yt} - ${Me}`})}});const st=C.filter(H=>H.date&&!isNaN(new Date(H.date).getTime())).sort((H,L)=>new Date(L.date).getTime()-new Date(H.date).getTime());return console.log(`✅ معاملات نهائية: ${st.length} من أصل ${C.length}`),console.log("🔍 تفاصيل المعاملات النهائية:",{income:st.filter(H=>H.type==="income").length,transfer_from_project:st.filter(H=>H.type==="transfer_from_project").length,expense:st.filter(H=>H.type==="expense").length,deferred:st.filter(H=>H.type==="deferred").length,workerWages:st.filter(H=>H.category==="أجور العمال").length,workerTransfers:st.filter(H=>H.category==="حوالات العمال").length,outgoingTransfers:st.filter(H=>H.category==="تحويل إلى مشروع آخر").length}),st},[l,c,x,g,y,T,S,I,w]),D=f.useMemo(()=>{let C=v;return r!=="all"&&(C=C.filter(q=>q.type===r)),n&&(C=C.filter(q=>q.description.toLowerCase().includes(n.toLowerCase())||q.category.toLowerCase().includes(n.toLowerCase()))),C},[v,r,n]),V=f.useMemo(()=>{const C=D.filter(ye=>ye.type==="income").reduce((ye,tt)=>ye+(tt.amount||0),0),q=D.filter(ye=>ye.type==="transfer_from_project").reduce((ye,tt)=>ye+(tt.amount||0),0),ue=D.filter(ye=>ye.type==="expense").reduce((ye,tt)=>ye+(tt.amount||0),0),R=D.filter(ye=>ye.category==="تحويل إلى مشروع آخر").reduce((ye,tt)=>ye+(tt.amount||0),0),fe=ue-R,ce=C+q,ne=ue;return console.log("💰 تفاصيل الحسابات:",{income:C,transferFromProject:q,otherExpenses:fe,transferToProjectExpenses:R,totalIncome:ce,totalExpenses:ne,balance:ce-ne}),{income:C,transferFromProject:q,otherExpenses:fe,transferToProjectExpenses:R,totalIncome:ce,expenses:ne,totalExpenses:ne,balance:ce-ne}},[D]),X=Array.isArray(o)&&o.find(C=>C.id===t)?.name||"";return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-2 sm:p-4",dir:"rtl",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-3 sm:space-y-4",children:[e.jsx(ee,{className:"shadow-sm",children:e.jsx(oe,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600 dark:text-gray-400",children:"المشروع"}),e.jsxs(We,{value:t,onValueChange:s,children:[e.jsx(ze,{className:"h-9 text-sm",children:e.jsx(Ke,{placeholder:"اختر مشروعاً"})}),e.jsx(Be,{children:o.map(C=>e.jsx(W,{value:C.id,children:C.name},C.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600 dark:text-gray-400",children:"نوع العملية"}),e.jsxs(We,{value:r,onValueChange:a,children:[e.jsx(ze,{className:"h-9 text-sm",children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع العمليات"}),e.jsx(W,{value:"income",children:"الدخل فقط"}),e.jsx(W,{value:"transfer_from_project",children:"التحويلات من المشاريع"}),e.jsx(W,{value:"expense",children:"المصاريف فقط"}),e.jsx(W,{value:"deferred",children:"المشتريات الآجلة"})]})]})]}),e.jsxs("div",{className:"sm:col-span-2 lg:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600 dark:text-gray-400",children:"البحث"}),e.jsxs("div",{className:"relative",children:[e.jsx(Kr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-3 w-3"}),e.jsx(je,{placeholder:"ابحث في الوصف...",value:n,onChange:C=>i(C.target.value),className:"pr-8 h-9 text-sm"})]})]})]})})}),t&&e.jsxs(e.Fragment,{children:[(d||j||N||z||h||k)&&e.jsx(ee,{className:"bg-red-50 border-red-200 mb-4",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"text-red-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"⚠️ تحذيرات في جلب البيانات:"}),d&&e.jsx("p",{children:"• خطأ في جلب تحويلات العهدة"}),j&&e.jsx("p",{children:"• خطأ في جلب حضور العمال"}),N&&e.jsx("p",{children:"• خطأ في جلب مشتريات المواد"}),z&&e.jsx("p",{children:"• خطأ في جلب حوالات العمال"}),h&&e.jsx("p",{children:"• خطأ في جلب التحويلات الواردة"}),k&&e.jsx("p",{children:"• خطأ في جلب التحويلات الصادرة"}),e.jsx("p",{className:"text-sm mt-2 text-red-600",children:"يرجى التحقق من اتصالك بالإنترنت أو تسجيل الدخول مرة أخرى."})]})})}),(u||b||M||E||m||p)&&e.jsx(ee,{className:"bg-blue-50 border-blue-200 mb-4",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-blue-800",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"}),e.jsx("span",{children:"جاري تحميل البيانات المالية..."})]})})}),e.jsx(Rh,{stats:[{title:"الدخل المباشر",value:Ge(V.income||0),icon:bs,color:"green"},{title:"من مشاريع أخرى",value:Ge(V.transferFromProject||0),icon:On,color:"teal"},{title:"إجمالي المصاريف",value:Ge(V.totalExpenses||0),icon:Zn,color:"red"},{title:"الرصيد النهائي",value:Ge(V.balance||0),icon:Ns,color:V.balance>=0?"blue":"orange"}],columns:4}),e.jsx(Rh,{stats:[{title:"المشتريات الآجلة",value:`${Ge(0)} (لا تُحسب في الرصيد)`,icon:Ls,color:"amber"}],columns:2}),e.jsxs(ee,{className:"shadow-sm",children:[e.jsx(He,{className:"p-3 sm:p-4 pb-2 sm:pb-3",children:e.jsxs(et,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("span",{className:"text-base sm:text-lg font-semibold truncate",children:["سجل العمليات ",X&&`- ${X}`]}),e.jsxs(Fe,{variant:"outline",className:"text-xs px-2 py-1",children:[D.length," عملية"]})]})}),e.jsx(oe,{className:"p-0",children:D.length===0?e.jsx("div",{className:"text-center py-6 sm:py-8 px-4",children:e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 sm:p-6 border border-blue-200 dark:border-blue-800",children:[e.jsx(On,{className:"h-10 w-10 sm:h-12 sm:w-12 text-blue-400 mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-blue-800 dark:text-blue-300 mb-2",children:"لا توجد عمليات مالية"}),e.jsx("p",{className:"text-sm sm:text-base text-blue-600 dark:text-blue-400 mb-3 sm:mb-4",children:t?"هذا المشروع لا يحتوي على عمليات مالية مسجلة بعد":"يرجى اختيار مشروع لعرض العمليات المالية الخاصة به"}),e.jsxs("div",{className:"text-xs sm:text-sm text-blue-500 dark:text-blue-400",children:["💡 نصيحة: تأكد من إدخال البيانات التالية للمشروع:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"تحويلات العهدة"}),e.jsx("li",{children:"أجور العمال"}),e.jsx("li",{children:"مشتريات المواد"}),e.jsx("li",{children:"مصروفات النقل"}),e.jsx("li",{children:"المصروفات المتنوعة"})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:hidden space-y-2 p-3",children:D.map((C,q)=>e.jsx(ee,{className:"bg-white dark:bg-gray-800 shadow-sm border",children:e.jsx(oe,{className:"p-3",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Fe,{variant:C.type==="income"?"default":C.type==="transfer_from_project"?"secondary":C.type==="deferred"?"outline":"destructive",className:`text-xs px-2 py-0.5 flex-shrink-0 ${C.type==="income"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":C.type==="transfer_from_project"?"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-300":C.type==="deferred"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:C.type==="income"?"دخل":C.type==="transfer_from_project"?"تحويل":C.type==="deferred"?"آجل":"مصروف"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:Mh(new Date(C.date),"dd/MM/yyyy",{locale:Ih})})]}),e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 truncate",children:C.category}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2",children:C.description})]}),e.jsx("div",{className:"text-left flex-shrink-0 ml-2",children:e.jsx("p",{className:`text-sm font-bold ${C.type==="income"||C.type==="transfer_from_project"?"text-green-600 dark:text-green-400":C.type==="deferred"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:Ge(C.amount)})})]})})},C.id))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50 dark:bg-gray-800",children:[e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"التاريخ"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"النوع"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"الفئة"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"المبلغ"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-medium",children:"الوصف"})]})}),e.jsx("tbody",{children:D.map((C,q)=>e.jsxs("tr",{className:`border-b ${q%2===0?"bg-white dark:bg-gray-900":"bg-gray-50 dark:bg-gray-800"} hover:bg-gray-100 dark:hover:bg-gray-700`,children:[e.jsx("td",{className:"py-3 px-4 text-sm",children:Mh(new Date(C.date),"dd/MM/yyyy",{locale:Ih})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(Fe,{variant:C.type==="income"?"default":C.type==="transfer_from_project"?"secondary":C.type==="deferred"?"outline":"destructive",className:C.type==="deferred"?"border-yellow-500 text-yellow-700 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20":C.type==="transfer_from_project"?"border-cyan-500 text-cyan-700 dark:text-cyan-400 bg-cyan-50 dark:bg-cyan-900/20":"",children:C.type==="income"?"دخل":C.type==="transfer_from_project"?"تحويل مشروع":C.type==="deferred"?"آجل":"مصروف"})}),e.jsx("td",{className:"py-3 px-4 text-sm font-medium",children:C.category}),e.jsxs("td",{className:`py-3 px-4 text-sm font-bold ${C.type==="income"?"text-green-600":C.type==="transfer_from_project"?"text-cyan-600":C.type==="deferred"?"text-yellow-600":"text-red-600"}`,children:[C.type==="income"||C.type==="transfer_from_project"?"+":C.type==="deferred"?"":"-",Ge(C.amount||0).replace(" ر.ي","")," ر.ي"]}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:C.category==="أجور العمال"?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:C.description.split(" - أجر يومي:")[0]}),C.description.includes(" - أجر يومي:")&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:C.description.split(" - أجر يومي:")[1]?`أجر يومي: ${C.description.split(" - أجر يومي:")[1]}`:""})]}):C.description})]},C.id))})]})})]})})]})]})]})})}var SN="AlertDialog",[KD]=Os(SN,[Xg]),Xr=Xg(),AN=t=>{const{__scopeAlertDialog:s,...r}=t,a=Xr(s);return e.jsx(Oc,{...a,...r,modal:!0})};AN.displayName=SN;var GD="AlertDialogTrigger",_N=f.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Xr(r);return e.jsx(Lc,{...n,...a,ref:s})});_N.displayName=GD;var HD="AlertDialogPortal",CN=t=>{const{__scopeAlertDialog:s,...r}=t,a=Xr(s);return e.jsx(Vc,{...a,...r})};CN.displayName=HD;var QD="AlertDialogOverlay",PN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Xr(r);return e.jsx(Ni,{...n,...a,ref:s})});PN.displayName=QD;var rn="AlertDialogContent",[XD,ZD]=KD(rn),YD=Lg("AlertDialogContent"),EN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:r,children:a,...n}=t,i=Xr(r),o=f.useRef(null),l=Pt(s,o),u=f.useRef(null);return e.jsx(K1,{contentName:rn,titleName:DN,docsSlug:"alert-dialog",children:e.jsx(XD,{scope:r,cancelRef:u,children:e.jsxs(wi,{role:"alertdialog",...i,...n,ref:l,onOpenAutoFocus:Te(n.onOpenAutoFocus,d=>{d.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(YD,{children:a}),e.jsx(e3,{contentRef:o})]})})})});EN.displayName=rn;var DN="AlertDialogTitle",MN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Xr(r);return e.jsx(ki,{...n,...a,ref:s})});MN.displayName=DN;var IN="AlertDialogDescription",RN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Xr(r);return e.jsx(Ti,{...n,...a,ref:s})});RN.displayName=IN;var JD="AlertDialogAction",FN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Xr(r);return e.jsx(qo,{...n,...a,ref:s})});FN.displayName=JD;var $N="AlertDialogCancel",VN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,{cancelRef:n}=ZD($N,r),i=Xr(r),o=Pt(s,n);return e.jsx(qo,{...i,...a,ref:o})});VN.displayName=$N;var e3=({contentRef:t})=>{const s=`\`${rn}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${rn}\` by passing a \`${IN}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${rn}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return f.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},t3=AN,s3=_N,r3=CN,ON=PN,LN=EN,zN=FN,BN=VN,qN=MN,UN=RN;const WN=t3,KN=s3,a3=r3,GN=f.forwardRef(({className:t,...s},r)=>e.jsx(ON,{className:de("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));GN.displayName=ON.displayName;const Xd=f.forwardRef(({className:t,...s},r)=>e.jsxs(a3,{children:[e.jsx(GN,{}),e.jsx(LN,{ref:r,className:de("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));Xd.displayName=LN.displayName;const Zd=({className:t,...s})=>e.jsx("div",{className:de("flex flex-col space-y-2 text-center sm:text-left",t),...s});Zd.displayName="AlertDialogHeader";const Yd=({className:t,...s})=>e.jsx("div",{className:de("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Yd.displayName="AlertDialogFooter";const Jd=f.forwardRef(({className:t,...s},r)=>e.jsx(qN,{ref:r,className:de("text-lg font-semibold",t),...s}));Jd.displayName=qN.displayName;const eu=f.forwardRef(({className:t,...s},r)=>e.jsx(UN,{ref:r,className:de("text-sm text-muted-foreground",t),...s}));eu.displayName=UN.displayName;const tu=f.forwardRef(({className:t,...s},r)=>e.jsx(zN,{ref:r,className:de(_d(),t),...s}));tu.displayName=zN.displayName;const su=f.forwardRef(({className:t,...s},r)=>e.jsx(BN,{ref:r,className:de(_d({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));su.displayName=BN.displayName;const Pn=t=>{if(t==null||t==="")return 0;if(typeof t=="number")return isNaN(t)||!isFinite(t)?0:Math.max(0,Math.floor(t));const s=String(t).trim();if(s===""||s==="null"||s==="undefined")return 0;const r=s.replace(/[^\d.-]/g,""),a=parseInt(r,10);return isNaN(a)||!isFinite(a)?0:Math.max(0,a)};function n3(){const{toast:t}=Dt(),s=Gt(),[r,a]=f.useState(null),[n,i]=f.useState(!1),[o,l]=f.useState(!1),{setFloatingAction:u}=Ps(),d=f.useRef(null),c=f.useRef(null),[m,h]=f.useState(null),[x,p]=f.useState(null),[k,g]=f.useState(null);f.useEffect(()=>(u(()=>i(!0),"إضافة مشروع جديد"),()=>u(null)),[u]);const{data:b=[],isLoading:j,refetch:y,error:M}=Se({queryKey:["/api/projects/with-stats"],queryFn:async()=>{try{console.log("📊 [Projects] جلب المشاريع مع الإحصائيات...");const L=await me("/api/projects/with-stats","GET");console.log("📊 [Projects] استجابة المشاريع:",L);let Q=[];return L&&typeof L=="object"&&(L.success!==void 0&&L.data!==void 0?Q=Array.isArray(L.data)?L.data:[]:Array.isArray(L)?Q=L:L.id?Q=[L]:L.data&&(Q=Array.isArray(L.data)?L.data:[])),Array.isArray(Q)||(console.warn("⚠️ [Projects] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),Q=[]),console.log(`✅ [Projects] تم جلب ${Q.length} مشروع مع الإحصائيات`),Q}catch(L){return console.error("❌ [Projects] خطأ في جلب المشاريع:",L),[]}},refetchInterval:6e4,staleTime:3e4,refetchOnWindowFocus:!0,retry:(L,Q)=>Q?.status===401?!1:L<2,onError:L=>{console.error("❌ [Projects] خطأ في Query:",L),L?.status===401&&(console.log("🔄 [Projects] خطأ 401، إعادة التوجيه لتسجيل الدخول..."),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login")}}),N=Array.isArray(b)?b.filter(L=>L&&typeof L=="object"):[],T=wr({resolver:kr(Sh),defaultValues:{name:"",status:"active",imageUrl:""}}),S=wr({resolver:kr(Sh),defaultValues:{name:"",status:"active",imageUrl:""}}),I=async(L,Q)=>{if(!(!Q||typeof Q!="string"||!Q.trim()))try{await me("/api/autocomplete","POST",{category:L,value:Q.trim()})}catch(Ne){console.log(`Failed to save autocomplete value for ${L}:`,Ne)}},E=L=>{if(L&&L.type.startsWith("image/")){const Q=new FileReader;Q.onload=Ne=>{const pt=Ne.target?.result;h(pt),T.setValue("imageUrl",pt)},Q.readAsDataURL(L)}else t({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"})},z=L=>{d.current&&(d.current.accept="image/*",L?d.current.setAttribute("capture","environment"):d.current.removeAttribute("capture"),d.current.click())},w=()=>{h(null),T.setValue("imageUrl",""),d.current&&(d.current.value="")},v=L=>{if(L&&L.type.startsWith("image/")){const Q=new FileReader;Q.onload=Ne=>{const pt=Ne.target?.result;p(pt),S.setValue("imageUrl",pt)},Q.readAsDataURL(L)}else t({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"})},D=L=>{c.current&&(c.current.accept="image/*",L?c.current.setAttribute("capture","environment"):c.current.removeAttribute("capture"),c.current.click())},V=()=>{p(null),S.setValue("imageUrl",""),c.current&&(c.current.value="")},X=Ae({mutationFn:L=>me("/api/projects","POST",L),onSuccess:async(L,Q)=>{await I("projectNames",Q.name),s.invalidateQueries({queryKey:["/api/projects"]}),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم إنشاء المشروع بنجاح"}),i(!1),T.reset(),h(null),d.current&&(d.current.value="")},onError:L=>{t({title:"خطأ في إنشاء المشروع",description:L.message,variant:"destructive"})}}),C=Ae({mutationFn:({id:L,data:Q})=>me(`/api/projects/${L}`,"PATCH",Q),onSuccess:async(L,Q)=>{await I("projectNames",Q.data.name),s.invalidateQueries({queryKey:["/api/projects"]}),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم تحديث المشروع بنجاح"}),l(!1),a(null),S.reset(),p(null),c.current&&(c.current.value="")},onError:L=>{t({title:"خطأ في تحديث المشروع",description:L.message,variant:"destructive"})}}),q=Ae({mutationFn:L=>me(`/api/projects/${L}`,"DELETE"),onSuccess:()=>{s.invalidateQueries({queryKey:["/api/projects"]}),s.invalidateQueries({queryKey:["/api/projects/with-stats"]}),t({title:"تم حذف المشروع بنجاح"})},onError:L=>{t({title:"خطأ في حذف المشروع",description:L.message,variant:"destructive"})}}),ue=L=>{X.mutate(L)},R=L=>{r&&C.mutate({id:r.id,data:L})},fe=L=>{q.mutate(L)},ce=L=>{a(L),S.reset({name:L.name,status:L.status,imageUrl:L.imageUrl||""}),p(L.imageUrl||null),l(!0)},ne=L=>{switch(L){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"paused":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},ye=L=>{switch(L){case"active":return"نشط";case"completed":return"مكتمل";case"paused":return"متوقف";default:return L}};if(f.useEffect(()=>(u(()=>i(!0),"إضافة مشروع جديد"),()=>u(null)),[u]),j)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل المشاريع..."})]})});if(M)return console.error("❌ [Projects] خطأ في تحميل المشاريع:",M),e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:"خطأ في تحميل المشاريع"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"حدث خطأ أثناء جلب البيانات. يرجى المحاولة مرة أخرى."}),e.jsxs(K,{onClick:()=>y(),className:"gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),"إعادة المحاولة"]})]})});const tt=(L,Q=0)=>{if(L==null||L==="")return Q;if(typeof L=="number")return isNaN(L)||!isFinite(L)?Q:L;if(typeof L=="string"){const Ne=L.trim();if(Ne===""||Ne==="null"||Ne==="undefined"||Ne.match(/^(\d{1,3})\1{2,}$/))return Q;const pt=Ne.replace(/[^\d.-]/g,""),yt=parseFloat(pt);return isNaN(yt)||!isFinite(yt)?Q:yt}return Q},at=f.useMemo(()=>{if(console.log("🔄 [Projects] حساب الإحصائيات العامة، عدد المشاريع:",N.length),!Array.isArray(N)||N.length===0)return console.log("⚠️ [Projects] لا توجد مشاريع للحساب"),{totalProjects:0,activeProjects:0,totalIncome:0,totalExpenses:0,totalWorkers:0,materialPurchases:0};const L=N.reduce((Q,Ne,pt)=>{if(!Ne||typeof Ne!="object")return console.warn(`⚠️ [Projects] مشروع ${pt} غير صحيح تم تخطيه:`,Ne),Q;const yt=Ne.stats||{};console.log(`📊 [Projects] مشروع "${Ne.name}":`,{totalIncome:yt.totalIncome,totalExpenses:yt.totalExpenses,totalWorkers:yt.totalWorkers,materialPurchases:yt.materialPurchases,status:Ne.status});const Me=tt(yt.totalIncome,0),bt=tt(yt.totalExpenses,0),rs=Pn(yt.totalWorkers),ds=Pn(yt.materialPurchases);return console.log(`✅ [Projects] قيم منظفة للمشروع "${Ne.name}":`,{safeIncome:Me,safeExpenses:bt,safeWorkers:rs,safePurchases:ds}),{totalProjects:Q.totalProjects+1,activeProjects:Q.activeProjects+(Ne.status==="active"?1:0),totalIncome:Q.totalIncome+Me,totalExpenses:Q.totalExpenses+bt,totalWorkers:Q.totalWorkers+rs,materialPurchases:Q.materialPurchases+ds}},{totalProjects:0,activeProjects:0,totalIncome:0,totalExpenses:0,totalWorkers:0,materialPurchases:0});return console.log("✅ [Projects] إجمالي الإحصائيات المحسوبة:",L),L},[N]),st=at.totalIncome-at.totalExpenses,H=Ge;return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs(Pd,{children:[e.jsx(it,{title:"إجمالي المشاريع",value:at.totalProjects.toString(),icon:Ks,color:"blue"}),e.jsx(it,{title:"المشاريع النشطة",value:at.activeProjects.toString(),icon:bs,color:"green"}),e.jsx(it,{title:"الرصيد الإجمالي",value:H(st),icon:Ns,color:st>=0?"green":"red"}),e.jsx(it,{title:"إجمالي العمال",value:at.totalWorkers.toString(),icon:Zt,color:"purple"})]}),e.jsx(Ss,{open:n,onOpenChange:i,children:e.jsxs(js,{children:[e.jsxs(As,{children:[e.jsx(_s,{children:"إنشاء مشروع جديد"}),e.jsx(Fs,{children:"أدخل تفاصيل المشروع الجديد"})]}),e.jsx(Sr,{...T,children:e.jsxs("form",{onSubmit:T.handleSubmit(ue),className:"space-y-4",children:[e.jsx(ut,{control:T.control,name:"name",render:({field:L})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"اسم المشروع"}),e.jsx(lt,{children:e.jsx(_t,{value:L.value,onChange:L.onChange,category:"projectNames",placeholder:"اسم المشروع"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:T.control,name:"status",render:({field:L})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"حالة المشروع"}),e.jsxs(We,{onValueChange:L.onChange,defaultValue:L.value,children:[e.jsx(lt,{children:e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر حالة المشروع"})})}),e.jsxs(Be,{children:[e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"paused",children:"متوقف"}),e.jsx(W,{value:"completed",children:"مكتمل"})]})]}),e.jsx(ct,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(rt,{children:"صورة المشروع (اختيارية)"}),m?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m,alt:"صورة المشروع",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(K,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:w,children:e.jsx(vr,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(ro,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"اختر صورة للمشروع"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:()=>z(!0),children:[e.jsx(mo,{className:"h-4 w-4 mr-2"}),"كاميرا"]}),e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:()=>z(!1),children:[e.jsx(tc,{className:"h-4 w-4 mr-2"}),"رفع صورة"]})]})]}),e.jsx("input",{ref:d,type:"file",accept:"image/*",className:"hidden",onChange:L=>{const Q=L.target.files?.[0];Q&&E(Q)}})]}),e.jsx(bc,{children:e.jsx(K,{type:"submit",disabled:X.isPending,children:X.isPending?"جاري الإنشاء...":"إنشاء المشروع"})})]})})]})}),N.length===0?e.jsxs(ee,{className:"p-12 text-center",children:[e.jsx(Ks,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"لا توجد مشاريع"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"ابدأ بإنشاء مشروعك الأول"}),e.jsxs(K,{onClick:()=>i(!0),className:"gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),"إنشاء مشروع جديد"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.isArray(N)?N.map(L=>e.jsxs(ee,{className:"relative overflow-hidden hover:shadow-lg transition-shadow",children:[L.imageUrl?e.jsxs("div",{className:"relative h-48 overflow-hidden cursor-pointer group",children:[e.jsx("img",{src:L.imageUrl,alt:L.name,className:"w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",onClick:Q=>{Q.stopPropagation(),g(L.imageUrl)},onError:Q=>{const Ne=Q.target;Ne.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsxs("div",{className:"absolute bottom-3 left-3 flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500/80 rounded-full flex items-center justify-center",children:e.jsx(ro,{className:"h-2 w-2 text-white"})}),e.jsx("span",{className:"text-xs text-white font-medium",children:"صورة المشروع"})]}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx(Wr,{className:"text-white h-4 w-4"})})]}),e.jsx(Fe,{className:`absolute top-3 right-3 ${ne(L.status)}`,children:ye(L.status)})]}):null,e.jsx(He,{className:(L.imageUrl,"pb-3"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{className:"text-lg line-clamp-2",children:L.name}),e.jsxs(br,{className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-3 w-3"}),"تم الإنشاء: ",ur(L.createdAt)]})]}),!L.imageUrl&&e.jsx(Fe,{className:ne(L.status),children:ye(L.status)})]})}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(bs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700 dark:text-green-400",children:"الدخل"})]}),e.jsx("p",{className:"text-sm font-bold text-green-800 dark:text-green-300 arabic-numbers",children:Ge(tt(L.stats.totalIncome,0))})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ns,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-xs font-medium text-red-700 dark:text-red-400",children:"المصروفات"})]}),e.jsx("p",{className:"text-sm font-bold text-red-800 dark:text-red-300 arabic-numbers",children:Ge(tt(L.stats.totalExpenses,0))})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ta,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-400",children:"الرصيد الحالي"})]}),e.jsx("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-300 arabic-numbers",children:Ge(tt(L.stats.currentBalance,0))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx(Zt,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"العمال"}),e.jsx("p",{className:"text-sm font-semibold arabic-numbers",children:Pn(L.stats.totalWorkers)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx(ra,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"المشتريات"}),e.jsx("p",{className:"text-sm font-semibold arabic-numbers",children:Pn(L.stats.materialPurchases)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx(yr,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"أيام العمل"}),e.jsx("p",{className:"text-sm font-semibold arabic-numbers",children:Pn(L.stats.completedDays)})]})]}),L.stats.lastActivity&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Ls,{className:"h-3 w-3"}),"آخر نشاط: ",ur(L.stats.lastActivity)]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>ce(L),className:"flex-1 gap-1",children:[e.jsx(x0,{className:"h-3 w-3"}),"تعديل"]}),e.jsxs(WN,{children:[e.jsx(KN,{asChild:!0,children:e.jsxs(K,{variant:"outline",size:"sm",className:"gap-1 text-red-600 hover:text-red-700",children:[e.jsx(es,{className:"h-3 w-3"}),"حذف"]})}),e.jsxs(Xd,{children:[e.jsxs(Zd,{children:[e.jsx(Jd,{children:"تأكيد الحذف"}),e.jsxs(eu,{children:['هل أنت متأكد من حذف المشروع "',L.name,'"؟ سيتم حذف جميع البيانات المرتبطة بهذا المشروع ولا يمكن التراجع عن هذا الإجراء.']})]}),e.jsxs(Yd,{children:[e.jsx(su,{children:"إلغاء"}),e.jsx(tu,{onClick:()=>fe(L.id),className:"bg-red-600 hover:bg-red-700",children:"حذف المشروع"})]})]})]})]})]})]},L.id)):null}),e.jsx(Ss,{open:o,onOpenChange:l,children:e.jsxs(js,{children:[e.jsxs(As,{children:[e.jsx(_s,{children:"تعديل المشروع"}),e.jsx(Fs,{children:"تعديل تفاصيل المشروع"})]}),e.jsx(Sr,{...S,children:e.jsxs("form",{onSubmit:S.handleSubmit(R),className:"space-y-4",children:[e.jsx(ut,{control:S.control,name:"name",render:({field:L})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"اسم المشروع"}),e.jsx(lt,{children:e.jsx(_t,{value:L.value,onChange:L.onChange,category:"projectNames",placeholder:"اسم المشروع"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:S.control,name:"status",render:({field:L})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"حالة المشروع"}),e.jsxs(We,{onValueChange:L.onChange,value:L.value,children:[e.jsx(lt,{children:e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر حالة المشروع"})})}),e.jsxs(Be,{children:[e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"paused",children:"متوقف"}),e.jsx(W,{value:"completed",children:"مكتمل"})]})]}),e.jsx(ct,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(rt,{children:"صورة المشروع (اختيارية)"}),x?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:x,alt:"صورة المشروع",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(K,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:V,children:e.jsx(vr,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(ro,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"اختر صورة للمشروع"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:()=>D(!0),children:[e.jsx(mo,{className:"h-4 w-4 mr-2"}),"كاميرا"]}),e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:()=>D(!1),children:[e.jsx(tc,{className:"h-4 w-4 mr-2"}),"رفع صورة"]})]})]}),e.jsx("input",{ref:c,type:"file",accept:"image/*",className:"hidden",onChange:L=>{const Q=L.target.files?.[0];Q&&v(Q)}})]}),e.jsx(bc,{children:e.jsx(K,{type:"submit",disabled:C.isPending,children:C.isPending?"جاري التحديث...":"حفظ التغييرات"})})]})})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:()=>g(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>g(null),className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors",children:e.jsx(vr,{className:"h-8 w-8"})}),e.jsx("img",{src:k,alt:"صورة مكبرة",className:"max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl",onClick:L=>L.stopPropagation()})]})})]})}function i3({worker:t,onSuccess:s,onCancel:r,submitLabel:a="إضافة العامل"}){const[n,i]=f.useState(t?.name||""),[o,l]=f.useState(t?.type||""),[u,d]=f.useState(t?t.dailyWage:""),[c,m]=f.useState(!1),[h,x]=f.useState(""),{toast:p}=Dt(),k=Gt(),g=async(T,S)=>{if(!(!S||typeof S!="string"||!S.trim()))try{await me("/api/autocomplete","POST",{category:T,value:S.trim()})}catch{}},{data:b=[]}=Se({queryKey:["/api/worker-types"]}),j=Ae({mutationFn:async T=>(await Promise.all([g("workerNames",T.name),g("workerTypes",T.type)]),t?me(`/api/workers/${t.id}`,"PUT",T):me("/api/workers","POST",T)),onSuccess:async(T,S)=>{k.invalidateQueries({queryKey:["/api/autocomplete"]}),p({title:"تم الحفظ",description:t?"تم تعديل العامل بنجاح":"تم إضافة العامل بنجاح"}),t||(i(""),l(""),d("")),k.invalidateQueries({queryKey:["/api/workers"]}),k.invalidateQueries({queryKey:["/api/worker-types"]}),s?.()},onError:async(T,S)=>{await Promise.all([g("workerNames",S.name),g("workerTypes",S.type)]),k.invalidateQueries({queryKey:["/api/autocomplete"]});const I=T?.message||(t?"حدث خطأ أثناء تعديل العامل":"حدث خطأ أثناء إضافة العامل");p({title:t?"فشل في تعديل العامل":"فشل في إضافة العامل",description:I,variant:"destructive"})}}),y=Ae({mutationFn:async T=>(await g("workerTypes",T.name),me("/api/worker-types","POST",T)),onSuccess:async(T,S)=>{k.invalidateQueries({queryKey:["/api/autocomplete"]}),p({title:"تم الحفظ",description:"تم إضافة نوع العامل بنجاح"}),l(T.name),x(""),m(!1),k.invalidateQueries({queryKey:["/api/worker-types"]})},onError:async(T,S)=>{await g("workerTypes",S.name),k.invalidateQueries({queryKey:["/api/autocomplete"]});const I=T?.message||"حدث خطأ أثناء إضافة نوع العامل";p({title:"فشل في إضافة نوع العامل",description:I,variant:"destructive"})}}),M=T=>{if(T.preventDefault(),!n.trim()||!o||!u){p({title:"خطأ",description:"يرجى ملء جميع البيانات المطلوبة",variant:"destructive"});return}const S=parseFloat(u);if(isNaN(S)||S<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح للأجر اليومي",variant:"destructive"});return}j.mutate({name:n.trim(),type:o,dailyWage:S.toString(),isActive:!0})},N=T=>{if(T.preventDefault(),!h.trim()){p({title:"خطأ",description:"يرجى إدخال اسم نوع العامل",variant:"destructive"});return}y.mutate({name:h.trim()})};return e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(re,{htmlFor:"worker-name",className:"block text-sm font-medium text-foreground mb-2",children:"اسم العامل"}),e.jsx(je,{id:"worker-name",type:"text",value:n,onChange:T=>i(T.target.value),placeholder:"أدخل اسم العامل...",required:!0})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"worker-type",className:"block text-sm font-medium text-foreground mb-2",children:"نوع العامل"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(We,{value:o,onValueChange:l,children:[e.jsx(ze,{className:"flex-1",children:e.jsx(Ke,{placeholder:"اختر نوع العامل..."})}),e.jsxs(Be,{children:[Array.isArray(b)&&b.map(T=>e.jsx(W,{value:T.name,children:T.name},T.id)),b.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(W,{value:"معلم",children:"معلم"}),e.jsx(W,{value:"عامل",children:"عامل"}),e.jsx(W,{value:"حداد",children:"حداد"}),e.jsx(W,{value:"نجار",children:"نجار"}),e.jsx(W,{value:"سائق",children:"سائق"}),e.jsx(W,{value:"كهربائي",children:"كهربائي"}),e.jsx(W,{value:"سباك",children:"سباك"})]})]})]}),e.jsxs(Ss,{open:c,onOpenChange:m,children:[e.jsx(Cd,{asChild:!0,children:e.jsx(K,{type:"button",variant:"outline",size:"icon",className:"shrink-0",title:"إضافة نوع جديد",children:e.jsx(os,{className:"h-4 w-4"})})}),e.jsxs(js,{className:"sm:max-w-md",children:[e.jsx(As,{children:e.jsx(_s,{children:"إضافة نوع عامل جديد"})}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(re,{htmlFor:"new-type-name",className:"block text-sm font-medium text-foreground mb-2",children:"اسم نوع العامل"}),e.jsx(je,{id:"new-type-name",type:"text",value:h,onChange:T=>x(T.target.value),placeholder:"مثال: كهربائي، سباك، حداد...",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{type:"submit",disabled:y.isPending,className:"flex-1",children:y.isPending?"جاري الإضافة...":"إضافة"}),e.jsx(K,{type:"button",variant:"outline",onClick:()=>{m(!1),x("")},className:"flex-1",children:"إلغاء"})]})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"daily-wage",className:"block text-sm font-medium text-foreground mb-2",children:"الأجر اليومي (ر.ي)"}),e.jsx(je,{id:"daily-wage",type:"number",inputMode:"decimal",value:u,onChange:T=>d(T.target.value),placeholder:"0",className:"text-center arabic-numbers",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{type:"submit",className:"flex-1",disabled:j.isPending,children:j.isPending?"جاري الحفظ...":a}),r&&e.jsx(K,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:"إلغاء"})]})]})}const o3=({worker:t,onEdit:s,onDelete:r,onToggleStatus:a})=>e.jsxs(ee,{className:`transition-all duration-300 hover:shadow-lg border-r-4 ${t.isActive?"border-r-green-500 bg-gradient-to-r from-green-50 to-white dark:from-green-950 dark:to-gray-900":"border-r-red-500 bg-gradient-to-r from-red-50 to-white dark:from-red-950 dark:to-gray-900"}`,children:[e.jsx(He,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg",children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx(et,{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Fe,{variant:t.isActive?"default":"destructive",className:"text-xs",children:t.isActive?"نشط":"غير نشط"}),e.jsx(Fe,{variant:"outline",className:"text-xs",children:t.type})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>s(t),className:"h-8 w-8 p-0 hover:bg-blue-100 dark:hover:bg-blue-900",children:e.jsx(Or,{className:"h-4 w-4 text-blue-600"})}),e.jsxs(WN,{children:[e.jsx(KN,{asChild:!0,children:e.jsx(K,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-100 dark:hover:bg-red-900",children:e.jsx(es,{className:"h-4 w-4 text-red-600"})})}),e.jsxs(Xd,{className:"max-w-md",children:[e.jsxs(Zd,{children:[e.jsxs(Jd,{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5 text-red-600"}),"حذف العامل"]}),e.jsxs(eu,{className:"space-y-3",children:[e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["هل أنت متأكد من حذف العامل ",e.jsxs("span",{className:"font-semibold text-blue-600",children:['"',t.name,'"']}),"؟"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500 flex items-center justify-center mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"تنبيه مهم:"}),e.jsx("p",{children:"إذا كان لدى العامل سجلات حضور أو تحويلات مالية، فلن يتمكن من حذفه وستظهر رسالة خطأ توضح الخطوات المطلوبة."})]})]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"هأ الإجراء لا يمكن التراجع عنه."})]})]}),e.jsxs(Yd,{children:[e.jsx(su,{className:"flex items-center gap-2",children:"إلغاء"}),e.jsxs(tu,{onClick:()=>r(t.id),className:"bg-red-600 hover:bg-red-700 flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"تأكيد الحذف"]})]})]})]})]})]})}),e.jsxs(oe,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"الأجر اليومي"}),e.jsxs("p",{className:"font-bold text-green-600",children:[parseFloat(t.dailyWage).toFixed(0)," ر.ي"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"تاريخ التسجيل"}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:new Date(t.createdAt).toLocaleDateString("en-GB")})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(K,{variant:t.isActive?"destructive":"default",size:"sm",onClick:()=>a(t.id),className:"flex items-center gap-2 text-xs",children:[e.jsx(Ms,{className:"h-3 w-3"}),t.isActive?"إيقاف":"تفعيل"]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(Hs,{className:"h-3 w-3"}),"ID: ",t.id.slice(-8)]})]})]})]}),l3=({worker:t,onClose:s,isOpen:r})=>e.jsx(Ss,{open:r,onOpenChange:s,children:e.jsxs(js,{className:"sm:max-w-md",children:[e.jsxs(As,{children:[e.jsx(_s,{children:t?"تعديل العامل":"إضافة عامل جديد"}),e.jsx(Fs,{children:t?"قم بتعديل بيانات العامل المحدد":"أدخل بيانات العامل الجديد"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(i3,{worker:t,onSuccess:s,onCancel:s,submitLabel:t?"حفظ التعديلات":"إضافة العامل"})})]})});function c3(){const[t,s]=f.useState(""),[r,a]=f.useState("all"),[n,i]=f.useState("all"),[o,l]=f.useState(),[u,d]=f.useState(!1),{toast:c}=Dt(),m=Gt(),{setFloatingAction:h}=Ps();f.useEffect(()=>(h(()=>{l(void 0),d(!0)},"إضافة عامل جديد"),()=>h(null)),[h]);const x=w=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(w)+" ر.ي",{data:p=[],isLoading:k,error:g}=Se({queryKey:["/api/workers"],queryFn:async()=>{try{console.log("🔄 [Workers] جلب قائمة العمال...");const w=await me("/api/workers","GET");console.log("📊 [Workers] استجابة العمال:",w);let v=[];return w&&typeof w=="object"&&(w.success!==void 0&&w.data!==void 0?v=Array.isArray(w.data)?w.data:[]:Array.isArray(w)?v=w:w.id&&(v=[w])),Array.isArray(v)||(console.warn("⚠️ [Workers] البيانات ليست مصفوفة، تحويل إلى مصفوفة فارغة"),v=[]),console.log(`✅ [Workers] تم جلب ${v.length} عامل بنجاح`),v}catch(w){return console.error("❌ [Workers] خطأ في جلب العمال:",w),[]}},staleTime:3e5,retry:2}),{data:b=[],error:j}=Se({queryKey:["/api/worker-types"],queryFn:async()=>{try{console.log("🔄 [Workers] جلب أنواع العمال...");const w=await fetch("/api/worker-types");if(!w.ok)return console.error("❌ [Workers] خطأ في جلب أنواع العمال:",w.status),[];const v=await w.json();console.log("📊 [Workers] أنواع العمال:",v);let D=[];return v&&typeof v=="object"&&(v.success!==void 0&&v.data!==void 0?D=Array.isArray(v.data)?v.data:[]:Array.isArray(v)&&(D=v)),Array.isArray(D)||(D=[]),console.log(`✅ [Workers] تم جلب ${D.length} نوع عامل`),D}catch(w){return console.error("❌ [Workers] خطأ في جلب أنواع العمال:",w),[]}},staleTime:6e5,retry:1}),y=Ae({mutationFn:w=>me(`/api/workers/${w}`,"DELETE"),onSuccess:w=>{m.invalidateQueries({queryKey:["/api/workers"]}),c({title:"✅ تم حذف العامل بنجاح",description:w?.message||"تم حذف العامل من النظام بنجاح. يمكنك إضافة عامل جديد إذا لزم الأمر.",className:"bg-green-50 border-green-200 text-green-800 dark:bg-green-900 dark:border-green-700 dark:text-green-100"})},onError:w=>{console.log("📝 [Workers] تفاصيل خطأ حذف العامل:",w);let v="⚠️ لا يمكن حذف العامل",D=w?.message||"حدث خطأ في حذف العامل";if(w?.userAction||w?.relatedRecordsCount){const V=w.relatedRecordsCount?`(العدد: ${w.relatedRecordsCount})`:"",X=w.userAction?`

📝 ما يجب فعله: ${w.userAction}`:"",C=w.relatedRecordsType?`
📁 السجلات المرتبطة: ${w.relatedRecordsType} ${V}`:"";D=`${D}${C}${X}`}w?.relatedRecordsType?.includes("سجلات حضور")&&(v="📅 يجب حذف سجلات الحضور أولاً"),c({title:v,description:D,variant:"destructive",duration:8e3,className:"max-w-md"})}}),M=Ae({mutationFn:({id:w,data:v})=>me(`/api/workers/${w}`,"PATCH",v),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/workers"]}),c({title:"تم بنجاح",description:"تم تحديث بيانات العامل بنجاح"})},onError:w=>{c({title:"خطأ",description:w.message||"حدث خطأ في تحديث العامل",variant:"destructive"})}}),N=Array.isArray(p)?p.filter(w=>{const v=w.name.toLowerCase().includes(t.toLowerCase())||w.type.toLowerCase().includes(t.toLowerCase()),D=r==="all"||r==="active"&&w.isActive||r==="inactive"&&!w.isActive,V=n==="all"||w.type===n;return v&&D&&V}):[],T={total:Array.isArray(p)?p.length:0,active:Array.isArray(p)?p.filter(w=>w.isActive).length:0,inactive:Array.isArray(p)?p.filter(w=>!w.isActive).length:0,avgWage:Array.isArray(p)&&p.length>0?p.reduce((w,v)=>w+parseFloat(v.dailyWage),0)/p.length:0},S=w=>{l(w),d(!0)},I=w=>{y.mutate(w)},E=w=>{const v=p.find(D=>D.id===w);v&&M.mutate({id:w,data:{isActive:!v.isActive}})},z=()=>{l(void 0),d(!0)};return f.useEffect(()=>(h(z,"إضافة عامل جديد"),()=>h(null)),[h]),k?e.jsx("div",{className:"container mx-auto p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((w,v)=>e.jsxs(ee,{className:"animate-pulse",children:[e.jsx(He,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-300 dark:bg-gray-700"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-700 rounded w-16"})]})]})}),e.jsx(oe,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-700 rounded w-3/4"})]})})]},v))})}):e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsx(it,{title:"إجمالي العمال",value:T.total,icon:Zt,color:"blue"}),e.jsx(it,{title:"العمال النشطون",value:T.active,icon:Ms,color:"green"}),e.jsx(it,{title:"العمال غير النشطين",value:T.inactive,icon:Ls,color:"orange"}),e.jsx(it,{title:"متوسط الأجر",value:T.avgWage,icon:Ns,color:"purple",formatter:w=>x(w)})]}),e.jsx(ee,{children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(re,{htmlFor:"search",children:"البحث"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(Kr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(je,{id:"search",placeholder:"ابحث عن عامل...",value:t,onChange:w=>s(w.target.value),className:"pr-10"})]})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"status",children:"الحالة"}),e.jsxs(We,{value:r,onValueChange:w=>a(w),children:[e.jsx(ze,{className:"mt-1",children:e.jsx(Ke,{placeholder:"اختر الحالة"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الحالات"}),e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"inactive",children:"غير نشط"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"type",children:"نوع العامل"}),e.jsxs(We,{value:n,onValueChange:i,children:[e.jsx(ze,{className:"mt-1",children:e.jsx(Ke,{placeholder:"اختر نوع العامل"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الأنواع"}),Array.isArray(b)&&b.map(w=>e.jsx(W,{value:w.name,children:w.name},w.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(K,{variant:"outline",className:"w-full mt-1",onClick:()=>{s(""),a("all"),i("all")},children:[e.jsx(qc,{className:"h-4 w-4 mr-2"}),"إعادة تعيين"]})})]})})}),N.length===0?e.jsx(ee,{children:e.jsxs(oe,{className:"p-8 text-center",children:[e.jsx(Zt,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"لا توجد عمال"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:p.length===0?"لم يتم إضافة أي عمال بعد":"لا توجد عمال تطابق معايير البحث"}),p.length===0&&e.jsx(K,{onClick:z,children:"إضافة أول عامل"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:N.map(w=>e.jsx(o3,{worker:w,onEdit:S,onDelete:I,onToggleStatus:E},w.id))}),e.jsx(l3,{worker:o,onClose:()=>{d(!1),l(void 0)},isOpen:u})]})}function d3(){or();const[t,s]=f.useState(!1),[r,a]=f.useState(null),[n,i]=f.useState(""),{toast:o}=Dt(),l=Gt(),{setFloatingAction:u}=Ps();f.useEffect(()=>(u(()=>{a(null),s(!0)},"إضافة تحويل جديد"),()=>u(null)),[u]);const d=async(v,D)=>{if(!(!D||D.trim().length<2))try{await me("/api/autocomplete","POST",{category:v,value:D.trim(),usageCount:1}),console.log(`✅ تم حفظ قيمة الإكمال التلقائي: ${v} = ${D.trim()}`)}catch(V){console.error(`❌ خطأ في حفظ قيمة الإكمال التلقائي ${v}:`,V)}},c=async()=>{const v=[];p.recipientName&&p.recipientName.trim().length>=2&&v.push(d("recipientNames",p.recipientName)),p.recipientPhone&&p.recipientPhone.trim().length>=3&&v.push(d("recipientPhones",p.recipientPhone)),p.transferNumber&&p.transferNumber.trim().length>=1&&v.push(d("workerTransferNumbers",p.transferNumber)),p.notes&&p.notes.trim().length>=2&&v.push(d("workerTransferNotes",p.notes)),v.length>0&&await Promise.all(v)},m=new URLSearchParams(window.location.search),h=m.get("edit"),x=m.get("worker"),[p,k]=f.useState({workerId:x||"",projectId:"",amount:0,recipientName:"",recipientPhone:"",transferMethod:"hawaleh",transferNumber:"",transferDate:new Date().toISOString().split("T")[0],notes:""}),{data:g=[]}=Se({queryKey:["/api/workers"],select:v=>v.filter(D=>D.isActive)}),{data:b=[]}=Se({queryKey:["/api/projects"]}),{data:j=[]}=Se({queryKey:["/api/worker-transfers"]}),y=Ae({mutationFn:async v=>(await c(),me("/api/worker-transfers","POST",v)),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/worker-transfers"]}),l.invalidateQueries({queryKey:["/api/autocomplete"]}),s(!1),T(),o({title:"تم بنجاح",description:"تم إرسال الحولة بنجاح"})},onError:async v=>{await c(),l.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("خطأ في إرسال الحولة:",v);let D="فشل في إرسال الحولة";v?.response?.data?.message?D=v.response.data.message:v?.message&&(D=v.message),o({title:"خطأ",description:D,variant:"destructive"})}}),M=Ae({mutationFn:async v=>(await c(),me(`/api/worker-transfers/${v.id}`,"PATCH",v.updates)),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/worker-transfers"]}),l.invalidateQueries({queryKey:["/api/autocomplete"]}),s(!1),a(null),T(),o({title:"تم بنجاح",description:"تم تحديث الحولة بنجاح"})},onError:async v=>{await c(),l.invalidateQueries({queryKey:["/api/autocomplete"]}),console.error("خطأ في تحديث الحولة:",v);let D="فشل في تحديث الحولة";v?.response?.data?.message?D=v.response.data.message:v?.message&&(D=v.message),o({title:"خطأ",description:D,variant:"destructive"})}}),N=Ae({mutationFn:async v=>me(`/api/worker-transfers/${v}`,"DELETE"),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/worker-transfers"]}),o({title:"تم بنجاح",description:"تم حذف الحولة بنجاح"})},onError:v=>{console.error("خطأ في حذف الحولة:",v);let D="فشل في حذف الحولة";v?.response?.data?.message?D=v.response.data.message:v?.message&&(D=v.message),o({title:"خطأ",description:D,variant:"destructive"})}});f.useEffect(()=>{if(h&&j.length>0){const v=j.find(D=>D.id===h);v&&(a(v),k({workerId:v.workerId,projectId:v.projectId,amount:v.amount,recipientName:v.recipientName,recipientPhone:v.recipientPhone||"",transferMethod:v.transferMethod,transferNumber:v.transferNumber||"",transferDate:v.transferDate,notes:v.notes||""}),s(!0))}},[h,j]);const T=()=>{k({workerId:"",projectId:"",amount:0,recipientName:"",recipientPhone:"",transferMethod:"hawaleh",transferNumber:"",transferDate:new Date().toISOString().split("T")[0],notes:""})},S=()=>{if(!p.workerId||!p.projectId||!p.amount||!p.recipientName||!p.transferDate){o({title:"خطأ",description:"الرجاء ملء جميع الحقول المطلوبة",variant:"destructive"});return}r?M.mutate({id:r.id,updates:p}):y.mutate(p)},I=v=>{a(v),k({workerId:v.workerId,projectId:v.projectId,amount:v.amount,recipientName:v.recipientName,recipientPhone:v.recipientPhone||"",transferMethod:v.transferMethod,transferNumber:v.transferNumber||"",transferDate:v.transferDate,notes:v.notes||""}),s(!0)},E=v=>`${v.toLocaleString("en-US")} ر.ي`,z=v=>{switch(v){case"cash":return"نقداً";case"bank":return"تحويل بنكي";case"hawaleh":return"حولة";default:return v}},w=n&&n!=="all"?j.filter(v=>v.projectId===n):j;return e.jsxs("div",{className:"min-h-screen bg-background p-4 space-y-6",children:[e.jsx(ee,{className:"mb-4",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-foreground mb-3 flex items-center",children:[e.jsx(Ai,{className:"ml-2 h-5 w-5 text-primary"}),"اختر المشروع"]}),e.jsxs(We,{value:n,onValueChange:i,children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"جميع المشاريع"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع المشاريع"}),b.map(v=>e.jsx(W,{value:v.id,children:v.name},v.id))]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"الحوالات المرسلة"}),e.jsxs(Fe,{variant:"secondary",children:[w.length," حولة"]})]}),w.length===0?e.jsx(ee,{children:e.jsxs(oe,{className:"p-8 text-center",children:[e.jsx(ec,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"لا توجد حوالات"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:n&&n!=="all"?"لا توجد حوالات في هذا المشروع":"لم يتم إرسال أي حوالات بعد"}),e.jsxs(K,{onClick:()=>{a(null),T(),s(!0)},className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"إرسال حولة جديدة"]})]})}):e.jsx("div",{className:"grid gap-4",children:w.map(v=>{const D=g.find(X=>X.id===v.workerId),V=b.find(X=>X.id===v.projectId);return e.jsx(ee,{className:"hover:shadow-md transition-shadow",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Hs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:D?.name||"عامل غير معروف"}),e.jsx(Fe,{variant:"outline",className:"text-xs",children:D?.type||"غير محدد"})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:V?.name||"مشروع غير معروف"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ns,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"font-bold text-green-600",children:E(v.amount)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_a,{className:"h-3 w-3 text-purple-600"}),e.jsx("span",{children:z(v.transferMethod)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yr,{className:"h-3 w-3 text-gray-600"}),e.jsx("span",{children:new Date(v.transferDate).toLocaleDateString("en-GB")})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>I(v),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(Or,{className:"h-3 w-3"})}),e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>N.mutate(v.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(es,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"المستلم: "}),e.jsx("span",{className:"font-medium",children:v.recipientName}),v.recipientPhone&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground mx-2",children:"•"}),e.jsx(Ko,{className:"h-3 w-3 inline mr-1"}),e.jsx("span",{children:v.recipientPhone})]})]})}),v.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["ملاحظات: ",v.notes]})})]})]})},v.id)})})]}),e.jsx(Ss,{open:t,onOpenChange:s,children:e.jsxs(js,{className:"max-w-md",children:[e.jsxs(As,{children:[e.jsx(_s,{children:r?"تعديل الحولة":"حولة جديدة"}),e.jsx(Fs,{children:r?"قم بتعديل بيانات الحولة المالية":"إنشاء حولة مالية جديدة للعامل"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(re,{children:"العامل *"}),e.jsxs(We,{value:p.workerId,onValueChange:v=>k({...p,workerId:v}),children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر العامل"})}),e.jsx(Be,{children:Array.isArray(g)?g.map(v=>e.jsxs(W,{value:v.id,children:[v.name," (",v.type,")"]},v.id)):null})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"المشروع *"}),e.jsxs(We,{value:p.projectId,onValueChange:v=>k({...p,projectId:v}),children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر المشروع"})}),e.jsx(Be,{children:b.map(v=>e.jsx(W,{value:v.id,children:v.name},v.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"المبلغ (ر.ي) *"}),e.jsx(je,{type:"number",value:p.amount,onChange:v=>k({...p,amount:Number(v.target.value)}),placeholder:"0",min:"0"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"اسم المستلم *"}),e.jsx(_t,{category:"recipientNames",value:p.recipientName,onChange:v=>k({...p,recipientName:v}),placeholder:"اسم الشخص المستلم للحولة",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"رقم الهاتف"}),e.jsx(_t,{category:"recipientPhones",value:p.recipientPhone,onChange:v=>k({...p,recipientPhone:v}),placeholder:"رقم هاتف المستلم (اختياري)",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"طريقة التحويل"}),e.jsxs(We,{value:p.transferMethod,onValueChange:v=>k({...p,transferMethod:v}),children:[e.jsx(ze,{children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"hawaleh",children:"حولة"}),e.jsx(W,{value:"bank",children:"تحويل بنكي"}),e.jsx(W,{value:"cash",children:"نقداً"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{children:"تاريخ التحويل *"}),e.jsx(je,{type:"date",value:p.transferDate,onChange:v=>k({...p,transferDate:v.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"رقم الحولة"}),e.jsx(_t,{category:"workerTransferNumbers",value:p.transferNumber,onChange:v=>k({...p,transferNumber:v}),placeholder:"رقم الحولة أو المرجع",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(re,{children:"ملاحظات"}),e.jsx(_t,{category:"workerTransferNotes",value:p.notes,onChange:v=>k({...p,notes:v}),placeholder:"ملاحظات إضافية (اختياري)",className:"w-full"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(K,{onClick:S,disabled:y.isPending||M.isPending,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(ec,{className:"h-4 w-4 mr-2"}),r?"تحديث":"إرسال"]}),e.jsx(K,{variant:"outline",onClick:()=>{s(!1),a(null),T()},className:"flex-1",children:"إلغاء"})]})]})]})})]})}var xl="Switch",[u3]=Os(xl),[m3,h3]=u3(xl),HN=f.forwardRef((t,s)=>{const{__scopeSwitch:r,name:a,checked:n,defaultChecked:i,required:o,disabled:l,value:u="on",onCheckedChange:d,form:c,...m}=t,[h,x]=f.useState(null),p=Pt(s,y=>x(y)),k=f.useRef(!1),g=h?c||!!h.closest("form"):!0,[b,j]=Ma({prop:n,defaultProp:i??!1,onChange:d,caller:xl});return e.jsxs(m3,{scope:r,checked:b,disabled:l,children:[e.jsx(xt.button,{type:"button",role:"switch","aria-checked":b,"aria-required":o,"data-state":YN(b),"data-disabled":l?"":void 0,disabled:l,value:u,...m,ref:p,onClick:Te(t.onClick,y=>{j(M=>!M),g&&(k.current=y.isPropagationStopped(),k.current||y.stopPropagation())})}),g&&e.jsx(ZN,{control:h,bubbles:!k.current,name:a,value:u,checked:b,required:o,disabled:l,form:c,style:{transform:"translateX(-100%)"}})]})});HN.displayName=xl;var QN="SwitchThumb",XN=f.forwardRef((t,s)=>{const{__scopeSwitch:r,...a}=t,n=h3(QN,r);return e.jsx(xt.span,{"data-state":YN(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:s})});XN.displayName=QN;var f3="SwitchBubbleInput",ZN=f.forwardRef(({__scopeSwitch:t,control:s,checked:r,bubbles:a=!0,...n},i)=>{const o=f.useRef(null),l=Pt(o,i),u=zc(r),d=Bc(s);return f.useEffect(()=>{const c=o.current;if(!c)return;const m=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(m,"checked").set;if(u!==r&&x){const p=new Event("click",{bubbles:a});x.call(c,r),c.dispatchEvent(p)}},[u,r,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:l,style:{...n.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ZN.displayName=f3;function YN(t){return t?"checked":"unchecked"}var JN=HN,p3=XN;const $r=f.forwardRef(({className:t,...s},r)=>e.jsx(JN,{className:de("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:r,children:e.jsx(p3,{className:de("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));$r.displayName=JN.displayName;function x3({supplier:t,onSuccess:s,onCancel:r,submitLabel:a="إضافة المورد"}){const[n,i]=f.useState(t?.name||""),[o,l]=f.useState(t?.contactPerson||""),[u,d]=f.useState(t?.phone||""),[c,m]=f.useState(t?.address||""),[h,x]=f.useState(t?.paymentTerms||"نقد"),[p,k]=f.useState(t?.notes||""),[g,b]=f.useState(t?.isActive??!0),{toast:j}=Dt(),y=Gt(),M=async(I,E)=>{if(!(!E||typeof E!="string"||!E.trim()))try{await me("/api/autocomplete","POST",{category:I,value:E.trim()})}catch{}},N=Ae({mutationFn:async I=>(await Promise.all([M("supplier_name",n),M("supplier_contact_person",o),M("supplier_phone",u),M("supplier_address",c),M("supplier_payment_terms",h)]),t?me(`/api/suppliers/${t.id}`,"PUT",I):me("/api/suppliers","POST",I)),onSuccess:async I=>{y.invalidateQueries({queryKey:["/api/autocomplete"]}),j({title:"تم الحفظ",description:t?"تم تعديل المورد بنجاح":"تم إضافة المورد بنجاح"}),t||T(),y.invalidateQueries({queryKey:["/api/suppliers"]}),s?.()},onError:async I=>{await Promise.all([M("supplier_name",n),M("supplier_contact_person",o),M("supplier_phone",u),M("supplier_address",c),M("supplier_payment_terms",h)]),y.invalidateQueries({queryKey:["/api/autocomplete"]});const E=I?.message||(t?"حدث خطأ أثناء تعديل المورد":"حدث خطأ أثناء إضافة المورد");j({title:t?"فشل في تعديل المورد":"فشل في إضافة المورد",description:E,variant:"destructive"})}}),T=()=>{i(""),l(""),d(""),m(""),x("نقد"),k(""),b(!0)},S=I=>{if(I.preventDefault(),!n||typeof n!="string"||!n.trim()){j({title:"خطأ",description:"يرجى ملء اسم المورد",variant:"destructive"});return}const E={name:n&&typeof n=="string"?n.trim():"",contactPerson:o&&typeof o=="string"&&o.trim()||null,phone:u&&typeof u=="string"&&u.trim()||null,address:c&&typeof c=="string"&&c.trim()||null,paymentTerms:h&&typeof h=="string"&&h.trim()||"نقد",notes:p&&typeof p=="string"&&p.trim()||null,isActive:g,totalDebt:"0"};N.mutate(E)};return e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"supplier-name",className:"text-sm font-medium text-foreground",children:"اسم المورد *"}),e.jsx(_t,{value:n,onChange:i,placeholder:"اسم المورد أو الشركة",category:"supplier_name",className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"contact-person",className:"text-sm font-medium text-foreground",children:"الشخص المسؤول"}),e.jsx(_t,{value:o,onChange:l,placeholder:"اسم الشخص المسؤول",category:"supplier_contact_person",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"رقم الهاتف"}),e.jsx(_t,{value:u,onChange:d,placeholder:"777123456",category:"supplier_phone",type:"tel",inputMode:"numeric",className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"address",className:"text-sm font-medium text-foreground",children:"العنوان"}),e.jsx(_t,{value:c,onChange:m,placeholder:"العنوان الكامل",category:"supplier_address",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"payment-terms",className:"text-sm font-medium text-foreground",children:"شروط الدفع"}),e.jsx(_t,{value:h,onChange:x,placeholder:"نقد / 30 يوم / 60 يوم",category:"supplier_payment_terms",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{htmlFor:"notes",className:"text-sm font-medium text-foreground",children:"ملاحظات"}),e.jsx(Fa,{id:"notes",value:p,onChange:I=>k(I.target.value),placeholder:"ملاحظات إضافية...",rows:3,className:"resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-sm font-medium",children:"حالة المورد"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g?"نشط ومتاح للتعامل":"غير نشط"})]}),e.jsx($r,{checked:g,onCheckedChange:b})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r&&e.jsx(K,{type:"button",variant:"outline",onClick:r,disabled:N.isPending,children:"إلغاء"}),e.jsx(K,{type:"submit",disabled:N.isPending,className:"min-w-[100px]",children:N.isPending?"جاري الحفظ...":a})]})]})}function Fh(){const[t,s]=f.useState(!1),[r,a]=f.useState(null),[n,i]=f.useState(""),{toast:o}=Dt(),l=Gt(),{setFloatingAction:u}=Ps(),{data:d=[],isLoading:c}=Se({queryKey:["/api/suppliers"]}),m=Ae({mutationFn:async y=>await me(`/api/suppliers/${y}`,"DELETE"),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/suppliers"]}),o({title:"تم حذف المورد بنجاح"})},onError:()=>{o({title:"خطأ في حذف المورد",variant:"destructive"})}}),h=y=>{a(y),s(!0)},x=y=>{confirm(`هل أنت متأكد من حذف المورد "${y.name}"؟`)&&m.mutate(y.id)},p=()=>{a(null),s(!1)},k=()=>{a(null),s(!0)};f.useEffect(()=>(u(k,"إضافة مورد جديد"),()=>u(null)),[u]);const g=d.filter(y=>y.name.toLowerCase().includes(n.toLowerCase())||y.contactPerson&&y.contactPerson.toLowerCase().includes(n.toLowerCase())||y.phone&&y.phone.includes(n)),b={total:d.length,active:d.filter(y=>y.isActive).length,inactive:d.filter(y=>!y.isActive).length,totalDebt:d.reduce((y,M)=>y+(parseFloat(M.totalDebt?.toString()||"0")||0),0)},j=y=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(y)+" ر.ي";return c?e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted rounded w-64"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((y,M)=>e.jsx(ee,{className:"animate-pulse",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-16"}),e.jsx("div",{className:"h-6 bg-muted rounded w-12"})]}),e.jsx("div",{className:"h-8 w-8 bg-muted rounded"})]})})},M))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((y,M)=>e.jsxs(ee,{className:"animate-pulse",children:[e.jsx(He,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-muted rounded w-24"}),e.jsx("div",{className:"h-3 bg-muted rounded w-20"})]}),e.jsx("div",{className:"h-5 w-12 bg-muted rounded"})]})}),e.jsxs(oe,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-28"}),e.jsx("div",{className:"h-3 bg-muted rounded w-32"}),e.jsx("div",{className:"h-3 bg-muted rounded w-20"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("div",{className:"h-7 bg-muted rounded w-16"}),e.jsx("div",{className:"h-7 bg-muted rounded w-16"})]})]})]},M))})]}):e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsx(Ss,{open:t,onOpenChange:s,children:e.jsxs(js,{className:"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(As,{children:[e.jsx(_s,{className:"text-lg sm:text-xl",children:r?"تعديل بيانات المورد":"إضافة مورد جديد"}),e.jsx(Fs,{children:r?"قم بتعديل بيانات المورد المحدد":"أدخل بيانات المورد الجديد"})]}),e.jsx(x3,{supplier:r,onSuccess:()=>{p(),l.invalidateQueries({queryKey:["/api/suppliers"]})},onCancel:p,submitLabel:r?"تحديث المورد":"إضافة المورد"})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsx(it,{title:"إجمالي الموردين",value:b.total,icon:On,color:"blue"}),e.jsx(it,{title:"الموردين النشطين",value:b.active,icon:bs,color:"green"}),e.jsx(it,{title:"غير النشطين",value:b.inactive,icon:cs,color:"orange"}),e.jsx(it,{title:"إجمالي المديونية",value:b.totalDebt,icon:_a,color:"red",formatter:j})]}),e.jsx(ee,{children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Kr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"البحث في الموردين (الاسم، الشخص المسؤول، رقم الهاتف)...",value:n,onChange:y=>i(y.target.value),className:"pr-10"})]})})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:g.map(y=>e.jsx(ee,{className:"border border-border/40 bg-card/50 hover:shadow-md transition-all duration-200 hover:border-primary/30",children:e.jsx(oe,{className:"p-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${y.isActive?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800"}`,children:e.jsx(On,{className:`h-4 w-4 ${y.isActive?"text-green-600 dark:text-green-400":"text-gray-500"}`})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:y.name}),e.jsx("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:y.contactPerson&&e.jsxs(e.Fragment,{children:[e.jsx(Hs,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:y.contactPerson})]})})]})]})}),e.jsx(Fe,{variant:y.isActive?"default":"secondary",className:"text-xs px-1.5 py-0.5 h-auto",children:y.isActive?"نشط":"معطل"})]}),e.jsxs("div",{className:"bg-muted/30 p-2 rounded-lg space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[y.phone&&e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(Ko,{className:"h-3 w-3 flex-shrink-0 text-blue-500"}),e.jsx("span",{className:"truncate font-mono",children:y.phone})]}),y.paymentTerms&&e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(_a,{className:"h-3 w-3 flex-shrink-0 text-purple-500"}),e.jsx("span",{className:"truncate",children:y.paymentTerms})]})]}),y.address&&e.jsxs("div",{className:"flex items-start gap-1 text-xs",children:[e.jsx(xr,{className:"h-3 w-3 flex-shrink-0 text-green-500 mt-0.5"}),e.jsx("span",{className:"line-clamp-2 leading-relaxed text-muted-foreground",children:y.address})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-border/50",children:[e.jsx("div",{className:"flex items-center gap-1",children:parseFloat(y.totalDebt?.toString()||"0")>0?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"h-3 w-3 text-red-500"}),e.jsxs("span",{className:"text-xs font-medium text-red-600",children:["مديونية: ",j(parseFloat(y.totalDebt?.toString()||"0"))]})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"رصيد سليم"})]})}),y.createdAt&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(yr,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(y.createdAt).toLocaleDateString("en-GB")})]})]})]}),y.notes&&e.jsx("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded text-xs",children:e.jsx("p",{className:"line-clamp-2 text-amber-800 dark:text-amber-200",children:y.notes})}),e.jsxs("div",{className:"flex gap-1.5 pt-1",children:[e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>h(y),className:"flex-1 gap-1 text-xs h-7 hover:bg-blue-50 hover:border-blue-200 hover:text-blue-700",children:[e.jsx(Or,{className:"h-3 w-3"}),"تعديل"]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>x(y),className:"flex-1 gap-1 text-xs h-7 hover:bg-red-50 hover:border-red-200 hover:text-red-700",children:[e.jsx(es,{className:"h-3 w-3"}),"حذف"]})]})]})})},y.id))}),g.length===0&&e.jsx(ee,{children:e.jsxs(oe,{className:"py-12 text-center",children:[e.jsx(On,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:n?"لا توجد نتائج":"لا توجد موردين"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:n?"لم يتم العثور على موردين يطابقون كلمات البحث المدخلة. جرب كلمات أخرى.":"ابدأ ببناء قاعدة بيانات الموردين الخاصة بك عن طريق إضافة أول مورد."}),!n&&e.jsxs(K,{onClick:()=>{p(),s(!0)},className:"gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),"إضافة مورد جديد"]})]})})]})}const g3="modulepreload",y3=function(t){return"/"+t},$h={},ew=function(s,r,a){let n=Promise.resolve();if(r&&r.length>0){let o=function(d){return Promise.all(d.map(c=>Promise.resolve(c).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");n=o(r.map(d=>{if(d=y3(d),d in $h)return;$h[d]=!0;const c=d.endsWith(".css"),m=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":g3,c||(h.as="script"),h.crossOrigin="",h.href=d,u&&h.setAttribute("nonce",u),document.head.appendChild(h),c)return new Promise((x,p)=>{h.addEventListener("load",x),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return s().catch(i)})};function v3(){const[t,s]=f.useState("all"),[r,a]=f.useState(""),[n,i]=f.useState(""),[o,l]=f.useState(""),[u,d]=f.useState("all"),[c,m]=f.useState(""),{setFloatingAction:h}=Ps();f.useEffect(()=>(h(null),()=>h(null)),[h]);const{data:x=[]}=Se({queryKey:["/api/projects"],queryFn:async()=>{try{const R=await me("/api/projects","GET");return R&&R.data&&Array.isArray(R.data)?R.data:Array.isArray(R)?R:[]}catch(R){return console.error("Error fetching projects:",R),[]}}}),{data:p=[],isLoading:k,error:g}=Se({queryKey:["/api/suppliers"],queryFn:async()=>{try{const R=await me("/api/suppliers","GET");return R&&R.data&&Array.isArray(R.data)?R.data:Array.isArray(R)?R:[]}catch(R){return console.error("Error fetching suppliers:",R),[]}},staleTime:6e4,refetchOnWindowFocus:!1}),{data:b}=Se({queryKey:["/api/material-purchases/date-range"],staleTime:3e5}),j=Array.isArray(p)?p.filter(R=>R.name.toLowerCase().includes(c.toLowerCase())):[],{data:y=[],isLoading:M}=Se({queryKey:["/api/material-purchases",t,r,n,o,u],queryFn:async()=>{if(!r)return[];const R=new URLSearchParams;R.append("supplierId",r),t&&t!=="all"&&R.append("projectId",t),n&&R.append("dateFrom",n),o&&R.append("dateTo",o),u&&u!=="all"&&R.append("purchaseType",u),console.log("🔍 طلب مشتريات المورد:",{selectedSupplierId:r,selectedProjectId:t,dateFrom:n,dateTo:o,paymentTypeFilter:u});const fe=await fetch(`/api/material-purchases?${R.toString()}`);if(!fe.ok)return console.error("خطأ في جلب المشتريات:",fe.status,fe.statusText),[];const ce=await fe.json();return console.log("📊 تم جلب المشتريات:",ce.length),ce.map(ne=>({...ne,paidAmount:ne.paidAmount||"0",remainingAmount:ne.remainingAmount||"0"}))},enabled:!!r,refetchOnWindowFocus:!1,staleTime:3e4}),{data:N}=Se({queryKey:["/api/suppliers/statistics"],queryFn:async()=>{const R=await fetch("/api/suppliers/statistics");return R.ok?await R.json():(console.error("خطأ في جلب الإحصائيات العامة:",R.status,R.statusText),{totalSuppliers:0,totalCashPurchases:"0",totalCreditPurchases:"0",totalDebt:"0",totalPaid:"0",remainingDebt:"0",activeSuppliers:0})},refetchOnWindowFocus:!1,staleTime:6e4}),{data:T}=Se({queryKey:["/api/suppliers/statistics",t,r,n,o,u],queryFn:async()=>{const R=new URLSearchParams;r&&R.append("supplierId",r),t&&t!=="all"&&R.append("projectId",t),n&&R.append("dateFrom",n),o&&R.append("dateTo",o),u&&u!=="all"&&R.append("purchaseType",u),console.log("🔄 إرسال طلب إحصائيات مفلترة:",Object.fromEntries(R));const fe=await fetch(`/api/suppliers/statistics?${R.toString()}`);return fe.ok?await fe.json():(console.error("خطأ في جلب إحصائيات الموردين المفلترة:",fe.status,fe.statusText),{totalSuppliers:0,totalCashPurchases:"0",totalCreditPurchases:"0",totalDebt:"0",totalPaid:"0",remainingDebt:"0",activeSuppliers:0})},refetchOnWindowFocus:!1,staleTime:3e4,enabled:!!r}),S=p.find(R=>R.id===r),I=x.find(R=>R.id===t),E=Array.isArray(y)?y.reduce((R,fe)=>(R.totalAmount+=parseFloat(fe.totalAmount||"0"),R.paidAmount+=parseFloat(fe.paidAmount||"0"),R.remainingAmount+=parseFloat(fe.remainingAmount||"0"),R),{totalAmount:0,paidAmount:0,remainingAmount:0}):{totalAmount:0,paidAmount:0,remainingAmount:0},z=Array.isArray(y)?y:[],w=z.filter(R=>(R.purchaseType?.replace(/['"]/g,"")||"")==="نقد"),v=z.filter(R=>{const fe=R.purchaseType?.replace(/['"]/g,"")||"";return fe==="أجل"||fe==="آجل"||fe.includes("جل")});Array.isArray(w)&&w.reduce((R,fe)=>R+parseFloat(fe.totalAmount||"0"),0),Array.isArray(w)&&w.length,Array.isArray(v)&&v.reduce((R,fe)=>R+parseFloat(fe.totalAmount||"0"),0),Array.isArray(v)&&v.length;const D={totalSuppliers:N?.totalSuppliers||p.length,totalCashPurchases:N?.totalCashPurchases||"0",totalCreditPurchases:N?.totalCreditPurchases||"0",totalDebt:N?.totalDebt||"0",totalPaid:N?.totalPaid||"0",remainingDebt:r?T?.remainingDebt||"0":N?.remainingDebt||"0",activeSuppliers:N?.activeSuppliers||(Array.isArray(p)?p.filter(R=>parseFloat(R.totalDebt)>0).length:0),totalPurchases:Array.isArray(y)?y.length:0},V=R=>new Date(R).toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"}),X=R=>(typeof R=="string"?parseFloat(R):R).toLocaleString("en-US")+" ريال",C=(R,fe)=>parseFloat(fe)===0?e.jsx(Fe,{variant:"default",className:"bg-green-100 text-green-800 text-xs",children:"مسدد"}):R==="نقد"?e.jsx(Fe,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:"نقد"}):e.jsx(Fe,{variant:"destructive",className:"text-xs",children:"مؤجل"}),q=async()=>{if(!S||y.length===0)return;const R=(await ew(async()=>{const{default:he}=await import("./exceljs.min-CT50dpqw.js").then(_=>_.e);return{default:he}},__vite__mapDeps([0,1,2]))).default,fe=new R.Workbook,ce=fe.addWorksheet("كشف حساب المورد");ce.views=[{rightToLeft:!0}],ce.pageSetup={paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:0,margins:{left:.2,right:.2,top:.3,bottom:.3,header:.1,footer:.1},horizontalCentered:!0,verticalCentered:!1,scale:80,blackAndWhite:!1,draft:!1},ce.columns=[{width:3},{width:9},{width:12},{width:16},{width:20},{width:6},{width:9},{width:11},{width:8},{width:9},{width:9},{width:8}];let ne=1;ce.mergeCells(`A${ne}:L${ne}`);const ye=ce.getCell(`A${ne}`);ye.value="شركة الفتيني للمقاولات والاستشارات الهندسية",ye.font={name:"Arial",size:14,bold:!0,color:{argb:"FFFFFF"}},ye.alignment={horizontal:"center",vertical:"middle"},ye.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1f4e79"}},ye.border={top:{style:"thick",color:{argb:"1f4e79"}},bottom:{style:"thick",color:{argb:"1f4e79"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},ce.getRow(ne).height=25,ne++,ce.mergeCells(`A${ne}:L${ne}`);const tt=ce.getCell(`A${ne}`);tt.value="كشف حساب المورد - تقرير مفصل",tt.font={name:"Arial",size:11,bold:!0,color:{argb:"1f4e79"}},tt.alignment={horizontal:"center",vertical:"middle"},tt.fill={type:"pattern",pattern:"solid",fgColor:{argb:"f2f2f2"}},tt.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},ce.getRow(ne).height=16,ne++,ne+=1,ce.mergeCells(`A${ne}:L${ne}`);const at=ce.getCell(`A${ne}`);if(at.value="📋 بيانات المورد",at.font={name:"Arial",size:11,bold:!0,color:{argb:"FFFFFF"}},at.alignment={horizontal:"center",vertical:"middle"},at.fill={type:"pattern",pattern:"solid",fgColor:{argb:"2e75b6"}},at.border={top:{style:"medium",color:{argb:"2e75b6"}},bottom:{style:"medium",color:{argb:"2e75b6"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},ce.getRow(ne).height=22,ne++,[["اسم المورد",S.name,"رقم الهاتف",S.phone||"غير محدد"],["شخص الاتصال",S.contactPerson||"غير محدد","العنوان",S.address||"غير محدد"]].forEach((he,_)=>{const $=ce.getRow(ne),B=$.getCell(1);B.value=he[0],B.font={name:"Arial",size:9,bold:!0,color:{argb:"1f4e79"}},B.alignment={horizontal:"center",vertical:"middle"},B.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e8f4fd"}},ce.mergeCells(`A${ne}:B${ne}`);const se=$.getCell(3);se.value=he[1],se.font={name:"Arial",size:9},se.alignment={horizontal:"center",vertical:"middle"},se.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffffff"}},ce.mergeCells(`C${ne}:F${ne}`);const ae=$.getCell(7);ae.value=he[2],ae.font={name:"Arial",size:9,bold:!0,color:{argb:"1f4e79"}},ae.alignment={horizontal:"center",vertical:"middle"},ae.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e8f4fd"}},ce.mergeCells(`G${ne}:H${ne}`);const Y=$.getCell(9);Y.value=he[3],Y.font={name:"Arial",size:9},Y.alignment={horizontal:"center",vertical:"middle"},Y.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffffff"}},ce.mergeCells(`I${ne}:L${ne}`),[1,3,7,9].forEach(pe=>{const Pe=$.getCell(pe);Pe.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thin",color:{argb:"cccccc"}},right:{style:"thin",color:{argb:"cccccc"}}}}),ce.getRow(ne).height=18,ne++}),I||n||o){ne++,ce.getRow(ne);let he="";I&&(he+=`المشروع: ${I.name}`),(n||o)&&(he&&(he+=" | "),he+=`الفترة: من ${n||"البداية"} إلى ${o||"النهاية"}`),ce.mergeCells(`A${ne}:L${ne}`);const _=ce.getCell(`A${ne}`);_.value=he,_.font={name:"Arial",size:10,italic:!0,color:{argb:"666666"}},_.alignment={horizontal:"center",vertical:"middle"},_.fill={type:"pattern",pattern:"solid",fgColor:{argb:"f9f9f9"}},ne++}ne+=1;const H=["#","التاريخ","رقم الفاتورة","اسم المشروع","المادة","الكمية","سعر الوحدة","المبلغ الإجمالي","نوع الدفع","المدفوع","المتبقي","الحالة"],L=ce.getRow(ne);H.forEach((he,_)=>{const $=L.getCell(_+1);$.value=he,$.font={name:"Arial",size:9,bold:!0,color:{argb:"FFFFFF"}},$.alignment={horizontal:"center",vertical:"middle",wrapText:!0},$.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1f4e79"}},$.border={top:{style:"thin",color:{argb:"1f4e79"}},bottom:{style:"thin",color:{argb:"1f4e79"}},left:{style:"thin",color:{argb:"1f4e79"}},right:{style:"thin",color:{argb:"1f4e79"}}}}),L.height=20,ne++,y.forEach((he,_)=>{const $=ce.getRow(ne),B=x.find(Y=>Y.id===he.projectId)?.name||"غير محدد",se=he.materialName||he.material?.name||he.materialId||"غير محدد";[_+1,V(he.invoiceDate),he.invoiceNumber||"-",B,se,he.quantity,parseFloat(he.unitPrice),parseFloat(he.totalAmount),he.purchaseType,parseFloat(he.paidAmount||"0"),parseFloat(he.remainingAmount||"0"),parseFloat(he.remainingAmount||"0")===0?"مسدد":"مؤجل"].forEach((Y,pe)=>{const Pe=$.getCell(pe+1);Pe.value=Y,Pe.font={name:"Arial",size:8},pe===0?Pe.alignment={horizontal:"center",vertical:"middle",wrapText:!0}:[1,2].includes(pe)?Pe.alignment={horizontal:"center",vertical:"middle",wrapText:!0}:[3,4].includes(pe)?Pe.alignment={horizontal:"right",vertical:"middle",wrapText:!0}:[5,6,7,8,9,10,11].includes(pe)?Pe.alignment={horizontal:"center",vertical:"middle",wrapText:!0}:Pe.alignment={horizontal:"center",vertical:"middle",wrapText:!0},[5,6,7,9,10,11].includes(pe)&&(Pe.numFmt="#,##0");const nt=_%2===0?"f8f9fa":"ffffff";Pe.fill={type:"pattern",pattern:"solid",fgColor:{argb:nt}},pe===11&&(Y==="مسدد"?Pe.font={...Pe.font,color:{argb:"228b22"},bold:!0}:Pe.font={...Pe.font,color:{argb:"cc0000"},bold:!0}),Pe.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thin",color:{argb:"cccccc"}},right:{style:"thin",color:{argb:"cccccc"}}}}),$.height=25,ne++}),ne+=1,ce.mergeCells(`A${ne}:L${ne}`);const Q=ce.getCell(`A${ne}`);Q.value="💰 ملخص الحساب المالي",Q.font={name:"Arial",size:11,bold:!0,color:{argb:"FFFFFF"}},Q.alignment={horizontal:"center",vertical:"middle"},Q.fill={type:"pattern",pattern:"solid",fgColor:{argb:"70ad47"}},Q.border={top:{style:"medium",color:{argb:"70ad47"}},bottom:{style:"medium",color:{argb:"70ad47"}},left:{style:"thick",color:{argb:"1f4e79"}},right:{style:"thick",color:{argb:"1f4e79"}}},ce.getRow(ne).height=22,ne++;const Ne=[{label:"إجمالي المشتريات",value:X(E.totalAmount),color:"1f4e79"},{label:"إجمالي المدفوع",value:X(E.paidAmount),color:"228b22"},{label:"إجمالي المتبقي",value:X(E.remainingAmount),color:"cc0000"},{label:"عدد الفواتير",value:y.length.toLocaleString("ar-SA"),color:"1f4e79"}];[[Ne[0],Ne[1]],[Ne[2],Ne[3]]].forEach(he=>{const _=ce.getRow(ne);he.forEach(($,B)=>{const se=B*6+1,ae=_.getCell(se);ae.value=$.label,ae.font={name:"Arial",size:9,bold:!0,color:{argb:"1f4e79"}},ae.alignment={horizontal:"center",vertical:"middle"},ae.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e8f5e8"}},ce.mergeCells(`${String.fromCharCode(64+se)}${ne}:${String.fromCharCode(64+se+2)}${ne}`);const Y=_.getCell(se+3);Y.value=$.value,Y.font={name:"Arial",size:9,bold:!0,color:{argb:$.color}},Y.alignment={horizontal:"center",vertical:"middle"},Y.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffffff"}},ce.mergeCells(`${String.fromCharCode(64+se+3)}${ne}:${String.fromCharCode(64+se+5)}${ne}`),[ae,Y].forEach(pe=>{pe.border={top:{style:"thin",color:{argb:"cccccc"}},bottom:{style:"thin",color:{argb:"cccccc"}},left:{style:"thin",color:{argb:"cccccc"}},right:{style:"thin",color:{argb:"cccccc"}}}})}),ce.getRow(ne).height=20,ne++}),ne+=3,ce.mergeCells(`A${ne}:K${ne}`);const yt=ce.getCell(`A${ne}`);yt.border={bottom:{style:"thick",color:{argb:"1f4e79"}}},ne++,ce.mergeCells(`A${ne}:K${ne}`);const Me=ce.getCell(`A${ne}`);Me.value="شركة الفتيني للمقاولات والاستشارات الهندسية | تقرير مُنشأ تلقائياً بواسطة نظام إدارة المشاريع",Me.font={name:"Arial",size:9,italic:!0,color:{argb:"666666"}},Me.alignment={horizontal:"center",vertical:"middle"},ne++,ce.mergeCells(`A${ne}:K${ne}`);const bt=ce.getCell(`A${ne}`);bt.value=`تم إنشاء هذا التقرير في ${V(new Date().toISOString())} | إجمالي السجلات: ${y.length}`,bt.font={name:"Arial",size:8,color:{argb:"999999"}},bt.alignment={horizontal:"center",vertical:"middle"};const rs=await fe.xlsx.writeBuffer(),ds=new Blob([rs],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),G=document.createElement("a");G.href=URL.createObjectURL(ds);const qe=new Date().toISOString().split("T")[0];G.download=`كشف-حساب-${S.name}-${qe}.xlsx`,G.click()},ue=()=>{s("all"),a(""),i(""),l(""),d("all"),m("")};return f.useEffect(()=>{r&&b&&(i(b.minDate),l(b.maxDate))},[r,b]),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3",children:[e.jsx(it,{title:"إجمالي الموردين",value:D.totalSuppliers.toLocaleString("en-US"),icon:Zt,color:"blue"}),e.jsx(it,{title:"المشتريات النقدية",value:X(D.totalCashPurchases),icon:$u,color:"green"}),e.jsx(it,{title:"المشتريات الآجلة",value:X(D.totalCreditPurchases),icon:_a,color:"orange"}),e.jsx(it,{title:"الموردين النشطين",value:D.activeSuppliers.toLocaleString("en-US"),icon:Ks,color:"purple"}),r&&e.jsxs(e.Fragment,{children:[e.jsx(it,{title:"مشتريات المورد (إجمالي)",value:X(E.totalAmount),icon:p0,color:"indigo"}),e.jsx(it,{title:"المدفوع للمورد",value:X(E.paidAmount),icon:bs,color:"emerald"}),e.jsx(it,{title:"المتبقي على المورد",value:X(E.remainingAmount),icon:Zn,color:"red"}),e.jsx(it,{title:"فواتير المورد",value:y.length.toLocaleString("en-US"),icon:ao,color:"amber"})]})]}),e.jsxs(ee,{className:"shadow-sm",children:[e.jsx(He,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(et,{className:"flex items-center gap-1 text-base",children:[e.jsx(qc,{className:"w-4 h-4"}),"فلاتر البحث"]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:ue,className:"text-xs h-7 px-2",children:[e.jsx(hr,{className:"w-3 h-3 ml-1"}),"إعادة تعيين"]})]})}),e.jsxs(oe,{className:"pt-2 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs text-gray-600",children:"البحث في الموردين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Kr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(je,{placeholder:"ابحث باسم المورد...",value:c,onChange:R=>m(R.target.value),className:"pr-8 h-7 text-xs"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs text-gray-600",children:"المورد"}),e.jsxs(We,{value:r,onValueChange:a,children:[e.jsx(ze,{className:"h-7 text-xs",children:e.jsx(Ke,{placeholder:k?"جاري التحميل...":"اختر المورد"})}),e.jsx(Be,{children:k?e.jsx(W,{value:"loading",disabled:!0,children:"جاري تحميل الموردين..."}):j.length===0?e.jsx(W,{value:"empty",disabled:!0,children:"لا توجد موردين متاحين"}):j.map(R=>e.jsxs(W,{value:R.id,children:[R.name,parseFloat(R.totalDebt)>0&&` - ${X(R.totalDebt)}`]},R.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs text-gray-600",children:"المشروع"}),e.jsxs(We,{value:t,onValueChange:s,children:[e.jsx(ze,{className:"h-7 text-xs",children:e.jsx(Ke,{placeholder:"جميع المشاريع"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع المشاريع"}),x.map(R=>e.jsx(W,{value:R.id,children:R.name},R.id))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs text-gray-600",children:"نوع الدفع"}),e.jsxs(We,{value:u,onValueChange:d,children:[e.jsx(ze,{className:"h-7 text-xs",children:e.jsx(Ke,{placeholder:"نوع الدفع"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الأنواع"}),e.jsx(W,{value:"نقد",children:"نقد"}),e.jsx(W,{value:"أجل",children:"أجل"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pt-2 border-t border-gray-100"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-gray-600",children:"من تاريخ"}),e.jsxs("div",{className:"relative",children:[e.jsx(yr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(je,{type:"date",value:n,onChange:R=>i(R.target.value),className:"pr-8 h-8 text-sm"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(re,{className:"text-xs font-medium text-gray-600",children:"إلى تاريخ"}),e.jsxs("div",{className:"relative",children:[e.jsx(yr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(je,{type:"date",value:o,onChange:R=>l(R.target.value),className:"pr-8 h-8 text-sm"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{className:"text-sm font-medium invisible",children:"إجراءات"}),e.jsxs(K,{onClick:q,disabled:!r||y.length===0,className:"w-full",children:[e.jsx(y2,{className:"w-4 h-4 ml-2"}),"تصدير التقرير"]})]})]})]})]}),S&&e.jsxs(ee,{className:"shadow-sm",children:[e.jsx(He,{className:"pb-2",children:e.jsxs(et,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ks,{className:"w-4 h-4"}),"معلومات المورد"]})}),e.jsxs(oe,{className:"py-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(Ks,{className:"w-3 h-3"}),"اسم المورد"]}),e.jsx("p",{className:"font-semibold text-sm",children:S.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(Zt,{className:"w-3 h-3"}),"المسؤول"]}),e.jsx("p",{className:"font-medium text-sm",children:S.contactPerson||"غير محدد"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(Ko,{className:"w-3 h-3"}),"الهاتف"]}),e.jsx("p",{className:"font-medium text-sm",dir:"ltr",children:S.phone||"غير محدد"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx($u,{className:"w-3 h-3"}),"المديونية"]}),e.jsx("p",{className:"font-bold text-red-600 text-sm",children:X(r?D.remainingDebt:S.totalDebt)})]})]}),S.address&&e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600 mb-1",children:[e.jsx(xr,{className:"w-3 h-3"}),"العنوان"]}),e.jsx("p",{className:"text-gray-800 text-sm",children:S.address})]})]})]}),r&&e.jsxs(ee,{className:"shadow-sm",children:[e.jsx(He,{className:"pb-4",children:e.jsxs(et,{className:"flex items-center gap-2",children:[e.jsx(Br,{className:"w-5 h-5"}),"تفاصيل المشتريات",I&&e.jsx(Fe,{variant:"outline",className:"mr-2",children:I.name})]})}),e.jsx(oe,{children:M?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل البيانات..."})]}):y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Kr,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"لا توجد مشتريات للمورد المحدد"}),e.jsx("p",{className:"text-gray-400",children:"جرب تغيير فلاتر البحث أو التواريخ"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-3",children:y.map((R,fe)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",dir:"ltr",children:V(R.invoiceDate)})]}),R.invoiceNumber&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ao,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["فاتورة: ",R.invoiceNumber]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[C(R.purchaseType,R.remainingAmount||"0"),e.jsx(Fe,{variant:R.purchaseType==="نقد"?"default":"secondary",className:"text-xs",children:R.purchaseType})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded-md",children:[e.jsx(Ks,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:x.find(ce=>ce.id===R.projectId)?.name||"غير محدد"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx(ra,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:R.materialName||R.material?.name||R.materialId}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",dir:"ltr",children:["الكمية: ",R.quantity," | سعر الوحدة: ",X(R.unitPrice)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"المبلغ الإجمالي"}),e.jsx("div",{className:"text-sm font-bold text-blue-600",dir:"ltr",children:X(R.totalAmount)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"المدفوع"}),e.jsx("div",{className:"text-sm font-bold text-green-600",dir:"ltr",children:X(R.paidAmount||"0")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"المتبقي"}),e.jsx("div",{className:"text-sm font-bold text-red-600",dir:"ltr",children:X(R.remainingAmount||"0")})]})]}),R.notes&&e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ملاحظات:"}),e.jsx("div",{className:"text-xs text-gray-700 bg-yellow-50 p-2 rounded",children:R.notes})]})]},R.id))}),e.jsxs(Pd,{className:"mt-4",children:[e.jsx(it,{title:"إجمالي المشتريات",value:E.totalAmount,icon:Ns,color:"blue",format:"currency",trend:{value:0,isPositive:!0}}),e.jsx(it,{title:"عدد الفواتير",value:y.length,icon:ao,color:"gray",trend:{value:0,isPositive:!0}}),e.jsx(it,{title:"إجمالي المدفوع",value:E.paidAmount,icon:_a,color:"green",format:"currency",trend:{value:0,isPositive:!0}}),e.jsx(it,{title:"إجمالي المتبقي",value:E.remainingAmount,icon:cs,color:"red",format:"currency",trend:{value:0,isPositive:!1}})]})]})})]}),!r&&e.jsx(ee,{className:"shadow-sm",children:e.jsxs(oe,{className:"text-center py-12",children:[e.jsx(Wr,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"اختر مورداً لعرض حسابه"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"استخدم فلاتر البحث أعلاه لاختيار مورد وعرض تفاصيل حسابه ومشترياته"}),k?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"جاري تحميل الموردين..."})]}):p.length===0?e.jsxs(da,{children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx(ua,{children:"لا يوجد موردين مسجلين في النظام. يرجى إضافة الموردين أولاً من صفحة إدارة الموردين."})]}):g?e.jsxs(da,{children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx(ua,{children:"حدث خطأ في تحميل بيانات الموردين. يرجى تحديث الصفحة أو المحاولة مرة أخرى."})]}):null]})})]})}var ru="Progress",au=100,[b3]=Os(ru),[j3,N3]=b3(ru),tw=f.forwardRef((t,s)=>{const{__scopeProgress:r,value:a=null,max:n,getValueLabel:i=w3,...o}=t;(n||n===0)&&!Vh(n)&&console.error(k3(`${n}`,"Progress"));const l=Vh(n)?n:au;a!==null&&!Oh(a,l)&&console.error(T3(`${a}`,"Progress"));const u=Oh(a,l)?a:null,d=Io(u)?i(u,l):void 0;return e.jsx(j3,{scope:r,value:u,max:l,children:e.jsx(xt.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":Io(u)?u:void 0,"aria-valuetext":d,role:"progressbar","data-state":aw(u,l),"data-value":u??void 0,"data-max":l,...o,ref:s})})});tw.displayName=ru;var sw="ProgressIndicator",rw=f.forwardRef((t,s)=>{const{__scopeProgress:r,...a}=t,n=N3(sw,r);return e.jsx(xt.div,{"data-state":aw(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...a,ref:s})});rw.displayName=sw;function w3(t,s){return`${Math.round(t/s*100)}%`}function aw(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function Io(t){return typeof t=="number"}function Vh(t){return Io(t)&&!isNaN(t)&&t>0}function Oh(t,s){return Io(t)&&!isNaN(t)&&t<=s&&t>=0}function k3(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${au}\`.`}function T3(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${au} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var nw=tw,S3=rw;const Ro=f.forwardRef(({className:t,value:s,...r},a)=>e.jsx(nw,{ref:a,className:de("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:e.jsx(S3,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Ro.displayName=nw.displayName;var A3="Separator",Lh="horizontal",_3=["horizontal","vertical"],iw=f.forwardRef((t,s)=>{const{decorative:r,orientation:a=Lh,...n}=t,i=C3(a)?a:Lh,l=r?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return e.jsx(xt.div,{"data-orientation":i,...l,...n,ref:s})});iw.displayName=A3;function C3(t){return _3.includes(t)}var ow=iw;const nu=f.forwardRef(({className:t,orientation:s="horizontal",decorative:r=!0,...a},n)=>e.jsx(ow,{ref:n,decorative:r,orientation:s,className:de("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...a}));nu.displayName=ow.displayName;function P3(){const{toast:t}=Dt();Gt();const[s,r]=f.useState(!1),{setFloatingAction:a}=Ps();f.useEffect(()=>(a(()=>{s||(r(!0),d.mutate())},"تشغيل الصيانة"),()=>a(null)),[a,s]);const{data:n,isLoading:i,refetch:o}=Se({queryKey:["autocomplete-admin","stats"],queryFn:()=>me("/api/autocomplete-admin/stats","GET")}),l=Ae({mutationFn:()=>me("/api/autocomplete-admin/cleanup","POST"),onSuccess:h=>{t({title:"تم التنظيف بنجاح",description:`تم حذف ${h.deletedCount} سجل قديم من ${h.categories.length} فئة`}),o()},onError:()=>{t({title:"خطأ في التنظيف",description:"فشل في تنظيف البيانات القديمة",variant:"destructive"})}}),u=Ae({mutationFn:h=>me("/api/autocomplete-admin/enforce-limits","POST",{category:h}),onSuccess:h=>{t({title:"تم تطبيق الحدود بنجاح",description:`تم تقليم ${h.trimmedCategories.length} فئة وحذف ${h.deletedCount} سجل`}),o()},onError:()=>{t({title:"خطأ في تطبيق الحدود",description:"فشل في تطبيق حدود الفئات",variant:"destructive"})}}),d=Ae({mutationFn:()=>me("/api/autocomplete-admin/maintenance","POST"),onSuccess:h=>{t({title:"اكتملت الصيانة الشاملة",description:`معالجة ${h.totalProcessed} سجل بنجاح`}),o(),r(!1)},onError:()=>{t({title:"خطأ في الصيانة",description:"فشل في تشغيل الصيانة الشاملة",variant:"destructive"}),r(!1)}}),c=()=>{r(!0),d.mutate()},m=h=>new Intl.NumberFormat("en-US").format(h);return i?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs(ee,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-500 to-blue-600 text-white hover:shadow-xl transition-all duration-300",children:[e.jsx(He,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(et,{className:"text-xs sm:text-sm font-medium opacity-90",children:"إجمالي السجلات"}),e.jsx(Qn,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(oe,{className:"pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:m(n?.totalRecords||0)}),e.jsx("p",{className:"text-xs opacity-80",children:"سجل في النظام"})]})]}),e.jsxs(ee,{className:"border-0 shadow-lg bg-gradient-to-br from-green-500 to-green-600 text-white hover:shadow-xl transition-all duration-300",children:[e.jsx(He,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(et,{className:"text-xs sm:text-sm font-medium opacity-90",children:"عدد الفئات"}),e.jsx(ta,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(oe,{className:"pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:m(n?.categoriesCount||0)}),e.jsx("p",{className:"text-xs opacity-80",children:"فئة مختلفة"})]})]}),e.jsxs(ee,{className:"border-0 shadow-lg bg-gradient-to-br from-orange-500 to-orange-600 text-white hover:shadow-xl transition-all duration-300",children:[e.jsx(He,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(et,{className:"text-xs sm:text-sm font-medium opacity-90",children:"السجلات القديمة"}),e.jsx(Ls,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(oe,{className:"pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:m(n?.oldRecordsCount||0)}),e.jsx("p",{className:"text-xs opacity-80",children:"تحتاج تنظيف"})]})]}),e.jsxs(ee,{className:`border-0 shadow-lg text-white hover:shadow-xl transition-all duration-300 ${n?.oldRecordsCount===0?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gradient-to-br from-yellow-500 to-yellow-600"}`,children:[e.jsx(He,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(et,{className:"text-xs sm:text-sm font-medium opacity-90",children:"حالة النظام"}),n?.oldRecordsCount===0?e.jsx(fs,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"}):e.jsx(Ms,{className:"h-4 w-4 sm:h-5 sm:w-5 opacity-80"})]})}),e.jsxs(oe,{className:"pt-0",children:[e.jsx("div",{className:"text-lg sm:text-xl lg:text-2xl font-bold mb-1",children:n?.oldRecordsCount===0?"ممتاز":"يحتاج صيانة"}),e.jsx("p",{className:"text-xs opacity-80",children:n?.oldRecordsCount===0?"النظام محسّن":"يحتاج تنظيف"})]})]})]}),e.jsxs(Vi,{defaultValue:"overview",className:"w-full bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[e.jsxs(jn,{className:"grid w-full grid-cols-3 bg-gray-100 dark:bg-gray-700 p-1 rounded-lg gap-1",children:[e.jsxs(hs,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm transition-all duration-200 text-sm sm:text-base font-medium rounded-md","data-testid":"tab-overview",children:[e.jsx(Ms,{className:"w-4 h-4 sm:w-5 sm:h-5 ml-2"}),"نظرة عامة"]}),e.jsxs(hs,{value:"categories",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm transition-all duration-200 text-sm sm:text-base font-medium rounded-md","data-testid":"tab-categories",children:[e.jsx(ta,{className:"w-4 h-4 sm:w-5 sm:h-5 ml-2"}),e.jsx("span",{className:"hidden sm:inline",children:"تفصيل"})," الفئات"]}),e.jsxs(hs,{value:"maintenance",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm transition-all duration-200 text-sm sm:text-base font-medium rounded-md","data-testid":"tab-maintenance",children:[e.jsx(gr,{className:"w-4 h-4 sm:w-5 sm:h-5 ml-2"}),e.jsx("span",{className:"hidden sm:inline",children:"أدوات"})," الصيانة"]})]}),e.jsx(ls,{value:"overview",className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:e.jsxs(ee,{className:"border-0 shadow-md bg-gradient-to-r from-white to-blue-50 dark:from-gray-800 dark:to-gray-900",children:[e.jsx(He,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(bs,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsx(et,{className:"text-lg sm:text-xl text-gray-900 dark:text-white",children:"صحة النظام"})]})}),e.jsxs(oe,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"كفاءة البيانات"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[n&&n.totalRecords>0?Math.round((n.totalRecords-n.oldRecordsCount)/n.totalRecords*100):0,"%"]}),e.jsx(Fe,{variant:n&&n.totalRecords>0&&(n.totalRecords-n.oldRecordsCount)/n.totalRecords*100>80?"default":"secondary",children:n&&n.totalRecords>0&&(n.totalRecords-n.oldRecordsCount)/n.totalRecords*100>80?"ممتاز":"يحتاج تحسين"})]})]}),e.jsx(Ro,{value:n&&n.totalRecords>0?(n.totalRecords-n.oldRecordsCount)/n.totalRecords*100:0,className:"h-3 bg-gray-200 dark:bg-gray-700"})]}),n&&n.oldRecordsCount>0&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800 dark:text-orange-200 text-sm sm:text-base",children:["تحذير: يوجد ",m(n.oldRecordsCount)," سجل قديم"]})]}),e.jsxs(K,{size:"sm",variant:"outline",className:"w-fit border-orange-300 text-orange-700 hover:bg-orange-100 dark:border-orange-600 dark:text-orange-300",onClick:()=>l.mutate(),disabled:l.isPending,"data-testid":"button-quick-cleanup",children:[e.jsx(es,{className:"w-4 h-4 ml-1"}),"تنظيف سريع"]})]}),e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-300 mt-2 mr-7 sm:mr-0",children:"هذه السجلات لم تُستخدم لأكثر من 6 أشهر وتم استخدامها أقل من 3 مرات"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(fs,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800 dark:text-green-200 text-sm",children:"السجلات النشطة"})]}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:m((n?.totalRecords||0)-(n?.oldRecordsCount||0))})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Qn,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-200 text-sm",children:"متوسط الاستخدام"})]}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:n?.categoryBreakdown&&Math.round(n.categoryBreakdown.reduce((h,x)=>h+(x.avgUsage||0),0)/n.categoryBreakdown.length)||0})]})]})]})]})}),e.jsx(ls,{value:"categories",className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:e.jsxs(ee,{className:"border-0 shadow-md",children:[e.jsx(He,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg",children:e.jsx(ta,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx(et,{className:"text-lg sm:text-xl text-gray-900 dark:text-white",children:"تفصيل الفئات"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"الاستخدام والإحصائيات"})]})]}),e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>u.mutate(void 0),disabled:u.isPending,className:"w-full sm:w-auto","data-testid":"button-enforce-all-limits",children:[e.jsx(gr,{className:"w-4 h-4 ml-1"}),"تطبيق الحدود على الكل"]})]})}),e.jsx(oe,{children:e.jsxs("div",{className:"space-y-3",children:[n?.categoryBreakdown.map((h,x)=>e.jsxs("div",{className:"group bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-700 p-4 rounded-xl border border-gray-200 dark:border-gray-600 hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-blue-500 to-green-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:h.category}),e.jsx(Fe,{variant:h.count>100?"destructive":h.count>50?"default":"secondary",className:"text-xs",children:h.count>100?"مرتفع":h.count>50?"متوسط":"منخفض"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block",children:"عدد السجلات"}),e.jsx("span",{className:"font-bold text-lg text-gray-900 dark:text-white",children:m(h.count)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block",children:"متوسط الاستخدام"}),e.jsx("span",{className:"font-bold text-lg text-blue-600 dark:text-blue-400",children:isNaN(h.avgUsage)||!isFinite(h.avgUsage)?"0.0":h.avgUsage.toFixed(1)})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block",children:"الحالة"}),e.jsx("span",{className:`font-medium ${h.count>100?"text-red-600":h.count>50?"text-yellow-600":"text-green-600"}`,children:h.count>100?"يحتاج تقليم":h.count>50?"مراقبة":"صحي"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 lg:flex-col lg:gap-1",children:[e.jsxs(K,{size:"sm",variant:h.count>100?"destructive":"outline",onClick:()=>u.mutate(h.category),disabled:u.isPending,className:"flex-1 lg:flex-none lg:w-20 transition-all duration-200","data-testid":`button-trim-${x}`,children:[e.jsx(es,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"تقليم"})]}),e.jsxs("div",{className:"text-xs text-center text-gray-500 dark:text-gray-400 lg:w-20",children:[Math.round(h.count/(n?.totalRecords||1)*100),"%"]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(Ro,{value:Math.min(h.count/100*100,100),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"الحد الأقصى (100)"})]})]})]},h.category)),(!n?.categoryBreakdown||n.categoryBreakdown.length===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ta,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد فئات محفوظة بعد"})]})]})})]})}),e.jsxs(ls,{value:"maintenance",className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs(ee,{className:"border-0 shadow-md bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20",children:[e.jsx(He,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/50 rounded-lg",children:e.jsx(es,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx(et,{className:"text-lg text-gray-900 dark:text-white",children:"تنظيف البيانات القديمة"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"حذف السجلات غير المستخدمة"})]})]})}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border",children:[e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-3",children:["حذف السجلات التي لم تُستخدم لأكثر من ",e.jsx("strong",{children:"6 أشهر"})," والمستخدمة أقل من ",e.jsx("strong",{children:"3 مرات"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"السجلات المستهدفة:"}),e.jsxs(Fe,{variant:n?.oldRecordsCount===0?"secondary":"destructive",children:[m(n?.oldRecordsCount||0)," سجل"]})]})]}),e.jsx(K,{onClick:()=>l.mutate(),disabled:l.isPending,className:"w-full transition-all duration-200",variant:n?.oldRecordsCount===0?"secondary":"destructive",size:"lg","data-testid":"button-cleanup",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري التنظيف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-4 h-4 ml-2"}),"تنظيف البيانات القديمة"]})})]})]}),e.jsxs(ee,{className:"border-0 shadow-md bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20",children:[e.jsx(He,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(gr,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(et,{className:"text-lg text-gray-900 dark:text-white",children:"تطبيق حدود الفئات"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"تحسين أداء النظام"})]})]})}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border",children:[e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-3",children:["فرض حد أقصى ",e.jsx("strong",{children:"100 اقتراح"})," لكل فئة وحذف الأقل استخداماً"]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"الفئات المتأثرة:"}),e.jsxs(Fe,{variant:"secondary",children:[n?.categoryBreakdown?.filter(h=>h.count>100).length||0," فئة"]})]})]}),e.jsx(K,{onClick:()=>u.mutate(void 0),disabled:u.isPending,className:"w-full transition-all duration-200",variant:"outline",size:"lg","data-testid":"button-enforce-limits",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري التطبيق..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gr,{className:"w-4 h-4 ml-2"}),"تطبيق الحدود"]})})]})]})]}),e.jsx(nu,{className:"my-6"}),e.jsxs(ee,{className:"border-0 shadow-lg bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20",children:[e.jsx(He,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl shadow-sm",children:e.jsx(hr,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx(et,{className:"text-xl text-gray-900 dark:text-white",children:"صيانة شاملة للنظام"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"تحسين وتنظيف شامل للنظام"})]})]}),e.jsx(Fe,{variant:"outline",className:"text-xs bg-white dark:bg-gray-800",children:"موصى به شهرياً"})]})}),e.jsxs(oe,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-4 sm:p-6 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-4 flex items-center gap-2",children:[e.jsx(Ms,{className:"w-5 h-5"}),"ما تتضمنه الصيانة الشاملة:"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"حذف السجلات القديمة وغير المستخدمة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"تطبيق حدود على جميع الفئات"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"تحسين فهارس قاعدة البيانات"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:"إعادة تنظيم ترتيب الاقتراحات"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200 text-sm",children:"تحذير هام"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"قد تستغرق العملية عدة دقائق حسب حجم البيانات. لا تغلق الصفحة أثناء التشغيل."})]})]})}),e.jsx(K,{onClick:c,disabled:s||d.isPending,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transition-all duration-300",size:"lg","data-testid":"button-comprehensive-maintenance",children:s||d.isPending?e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري تشغيل الصيانة الشاملة..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"w-4 h-4 ml-2"}),"تشغيل الصيانة الشاملة"]})})]})]})]})]})]})})}const E3=Qr({name:De().min(1,"اسم المعدة مطلوب"),code:De().optional(),type:De().min(1,"فئة المعدة مطلوبة"),status:De().min(1,"حالة المعدة مطلوبة"),description:De().optional(),purchaseDate:De().optional(),purchasePrice:De().optional(),currentProjectId:De().nullable().optional(),imageUrl:De().optional()});function zh({open:t,onOpenChange:s,projects:r,equipment:a}){const{toast:n}=Dt(),i=Gt(),o=f.useRef(null),[l,u]=f.useState(null),[d,c]=f.useState(null),m=!!a,h=wr({resolver:kr(E3),defaultValues:{name:a?.name||"",code:a?.code||"",type:a?.type||"أدوات كهربائية",status:a?.status||"active",description:a?.description||"",purchaseDate:a?.purchaseDate||"",purchasePrice:a?.purchasePrice?.toString()||"",currentProjectId:a?.currentProjectId||null,imageUrl:a?.imageUrl||""}}),x=j=>{if(j&&j.type.startsWith("image/")){const y=new FileReader;y.onload=M=>{const N=M.target?.result;u(N),c(j),h.setValue("imageUrl",N)},y.readAsDataURL(j)}else n({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"})},p=j=>{o.current&&(o.current.accept="image/*",j?o.current.setAttribute("capture","environment"):o.current.removeAttribute("capture"),o.current.click())},k=()=>{u(null),c(null),h.setValue("imageUrl",""),o.current&&(o.current.value="")},g=Ae({mutationFn:j=>m&&a?.id?me(`/api/equipment/${a.id}`,"PUT",j):me("/api/equipment","POST",j),onSuccess:()=>{i.invalidateQueries({predicate:j=>Array.isArray(j.queryKey)&&j.queryKey[0]==="equipment"}),n({title:"نجح الحفظ",description:m?"تم تحديث المعدة بنجاح":"تم إضافة المعدة بنجاح",variant:"default"}),h.reset(),k(),s(!1)},onError:j=>{n({title:"خطأ",description:j.message||(m?"حدث خطأ أثناء تحديث المعدة":"حدث خطأ أثناء إضافة المعدة"),variant:"destructive"})}});f.useEffect(()=>{a&&m&&(h.reset({name:a.name||"",code:a.code||"",type:a.type||"أدوات كهربائية",status:a.status||"active",description:a.description||"",purchaseDate:a.purchaseDate||"",purchasePrice:a.purchasePrice?.toString()||"",currentProjectId:a.currentProjectId||null,imageUrl:a.imageUrl||""}),a.imageUrl&&u(a.imageUrl))},[a,m,h]);const b=j=>{const y={...j,purchasePrice:j.purchasePrice?j.purchasePrice:void 0,currentProjectId:j.currentProjectId||null};g.mutate(y)};return e.jsx(Ss,{open:t,onOpenChange:s,children:e.jsxs(js,{className:"w-[95vw] max-w-[500px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(As,{className:"pb-3",children:[e.jsx(_s,{className:"text-lg",children:m?"تعديل المعدة":"إضافة معدة جديدة"}),e.jsx(Fs,{className:"text-sm text-gray-600",children:m?"قم بتحديث بيانات المعدة":"أدخل تفاصيل المعدة الجديدة"})]}),e.jsx(Sr,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(b),className:"space-y-3",children:[e.jsx(ut,{control:h.control,name:"name",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"اسم المعدة *"}),e.jsx(lt,{children:e.jsx(je,{placeholder:"مثال: حفار صغير",className:"h-9 text-sm",...j,"data-testid":"input-equipment-name"})}),e.jsx(ct,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(ut,{control:h.control,name:"type",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"الفئة *"}),e.jsxs(We,{onValueChange:j.onChange,defaultValue:j.value,children:[e.jsx(lt,{children:e.jsx(ze,{"data-testid":"select-equipment-type",className:"h-9 text-sm",children:e.jsx(Ke,{placeholder:"اختر الفئة"})})}),e.jsxs(Be,{children:[e.jsx(W,{value:"أدوات كهربائية",children:"أدوات كهربائية"}),e.jsx(W,{value:"أدوات يدوية",children:"أدوات يدوية"}),e.jsx(W,{value:"أدوات قياس",children:"أدوات قياس"}),e.jsx(W,{value:"معدات لحام",children:"معدات لحام"}),e.jsx(W,{value:"معدات حفر",children:"معدات حفر"}),e.jsx(W,{value:"معدات قطع",children:"معدات قطع"}),e.jsx(W,{value:"أدوات ربط",children:"أدوات ربط"}),e.jsx(W,{value:"مواد كهربائية",children:"مواد كهربائية"}),e.jsx(W,{value:"معدات أمان",children:"معدات أمان"}),e.jsx(W,{value:"أدوات نقل",children:"أدوات نقل"})]})]}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"status",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"الحالة *"}),e.jsxs(We,{onValueChange:j.onChange,defaultValue:j.value,children:[e.jsx(lt,{children:e.jsx(ze,{"data-testid":"select-equipment-status",className:"h-9 text-sm",children:e.jsx(Ke,{placeholder:"اختر الحالة"})})}),e.jsxs(Be,{children:[e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"maintenance",children:"صيانة"}),e.jsx(W,{value:"out_of_service",children:"خارج الخدمة"}),e.jsx(W,{value:"inactive",children:"غير نشط"})]})]}),e.jsx(ct,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(ut,{control:h.control,name:"purchaseDate",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"تاريخ الشراء"}),e.jsx(lt,{children:e.jsx(je,{type:"date",className:"h-9 text-sm",...j,"data-testid":"input-purchase-date"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"purchasePrice",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"سعر الشراء"}),e.jsx(lt,{children:e.jsx(je,{type:"number",placeholder:"0",className:"h-9 text-sm",...j,"data-testid":"input-purchase-price"})}),e.jsx(ct,{})]})})]}),e.jsx(ut,{control:h.control,name:"currentProjectId",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"المشروع الحالي"}),e.jsxs(We,{onValueChange:y=>j.onChange(y==="warehouse"?null:y),defaultValue:j.value||"warehouse",children:[e.jsx(lt,{children:e.jsx(ze,{"data-testid":"select-current-project",className:"h-9 text-sm",children:e.jsx(Ke,{placeholder:"اختر المشروع (اختياري)"})})}),e.jsxs(Be,{children:[e.jsx(W,{value:"warehouse",children:"المستودع"}),r.map(y=>e.jsx(W,{value:y.id,children:y.name},y.id))]})]}),e.jsx(gi,{className:"text-xs text-gray-500",children:"اتركه فارغاً إذا كانت المعدة في المستودع"}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"imageUrl",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"صورة المعدة"}),e.jsx(lt,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{ref:o,type:"file",accept:"image/*",className:"hidden",onChange:y=>{const M=y.target.files?.[0];M&&x(M)},"data-testid":"input-file-image"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:()=>p(!0),className:"h-9 text-xs","data-testid":"button-camera",children:[e.jsx(mo,{className:"h-4 w-4 mr-1"}),"تصوير بالكاميرا"]}),e.jsxs(K,{type:"button",variant:"outline",size:"sm",onClick:()=>p(!1),className:"h-9 text-xs","data-testid":"button-gallery",children:[e.jsx(tc,{className:"h-4 w-4 mr-1"}),"اختيار من المعرض"]})]}),l&&e.jsxs("div",{className:"relative w-full h-32 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("img",{src:l,alt:"معاينة الصورة",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:k,className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 transition-colors","data-testid":"button-remove-image",children:e.jsx(vr,{className:"h-3 w-3"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",children:[e.jsx(ro,{className:"h-3 w-3 inline mr-1"}),d?.name||"صورة محددة"]})]})]})}),e.jsx(gi,{className:"text-xs text-gray-500",children:"يمكنك تصوير صورة جديدة أو اختيار صورة من المعرض"}),e.jsx(ct,{})]})}),e.jsx(ut,{control:h.control,name:"description",render:({field:j})=>e.jsxs(ot,{children:[e.jsx(rt,{className:"text-sm font-medium",children:"الوصف"}),e.jsx(lt,{children:e.jsx(Fa,{placeholder:"وصف إضافي للمعدة...",className:"resize-none text-sm min-h-[60px]",rows:2,...j,"data-testid":"textarea-description"})}),e.jsx(ct,{})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:justify-end pt-2",children:[e.jsx(K,{type:"button",variant:"outline",onClick:()=>s(!1),className:"order-2 sm:order-1 h-9 text-sm","data-testid":"button-cancel",children:"إلغاء"}),e.jsx(K,{type:"submit",disabled:g.isPending,className:"order-1 sm:order-2 h-9 text-sm","data-testid":"button-submit",children:g.isPending?"جاري الحفظ...":m?"تحديث المعدة":"إضافة المعدة"})]})]})})]})})}const D3=Qr({toProjectId:De().nullable(),reason:De().min(1,"سبب النقل مطلوب"),performedBy:De().min(1,"اسم من قام بالنقل مطلوب"),notes:De().optional()});function M3({equipment:t,open:s,onOpenChange:r,projects:a}){const{toast:n}=Dt(),i=Gt(),o=wr({resolver:kr(D3),defaultValues:{toProjectId:null,reason:"",performedBy:"",notes:""}}),l=Ae({mutationFn:c=>me(`/api/equipment/${t?.id}/transfer`,"POST",c),onSuccess:()=>{i.invalidateQueries({predicate:c=>Array.isArray(c.queryKey)&&c.queryKey[0]==="equipment"}),i.invalidateQueries({predicate:c=>Array.isArray(c.queryKey)&&c.queryKey[0]==="equipment-movements"}),i.invalidateQueries({queryKey:["projects"]}),n({title:"نجح النقل",description:"تم نقل المعدة بنجاح",variant:"default"}),o.reset(),r(!1)},onError:c=>{n({title:"خطأ",description:c.message||"فشل في نقل المعدة",variant:"destructive"})}}),u=c=>{l.mutate({...c,toProjectId:c.toProjectId||null})},d=()=>{if(!t)return"";if(!t.currentProjectId)return"المستودع";const c=Array.isArray(a)?a.find(m=>m.id===t.currentProjectId):void 0;return c?c.name:"مشروع غير معروف"};return t?e.jsx(Ss,{open:s,onOpenChange:r,children:e.jsxs(js,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(As,{children:[e.jsxs(_s,{className:"flex items-center gap-2",children:[e.jsx(Eu,{className:"h-5 w-5"}),"نقل المعدة"]}),e.jsxs(Fs,{children:['نقل المعدة "',t.name,'" إلى موقع جديد']})]}),e.jsx(Sr,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(u),className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"الموقع الحالي:"}),e.jsx("p",{className:"font-medium","data-testid":"text-current-location",children:d()})]}),e.jsx(Eu,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"الموقع الجديد:"}),e.jsx("p",{className:"font-medium text-blue-600","data-testid":"text-new-location",children:o.watch("toProjectId")&&o.watch("toProjectId")!=="warehouse"&&a.find(c=>c.id===o.watch("toProjectId"))?.name||"المستودع"})]})]})}),e.jsx(ut,{control:o.control,name:"toProjectId",render:({field:c})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"المشروع المقصود"}),e.jsxs(We,{onValueChange:m=>c.onChange(m==="warehouse"?null:m),defaultValue:c.value||"warehouse",children:[e.jsx(lt,{children:e.jsx(ze,{"data-testid":"select-destination-project",children:e.jsx(Ke,{placeholder:"اختر المشروع المقصود"})})}),e.jsxs(Be,{children:[e.jsx(W,{value:"warehouse",children:"المستودع"}),a.filter(m=>m.id!==t.currentProjectId).map(m=>e.jsx(W,{value:m.id,children:m.name},m.id))]})]}),e.jsx(gi,{children:"اختر المشروع الذي تريد نقل المعدة إليه، أو اتركه فارغاً للنقل إلى المستودع"}),e.jsx(ct,{})]})}),e.jsx(ut,{control:o.control,name:"reason",render:({field:c})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"سبب النقل *"}),e.jsx(lt,{children:e.jsx(je,{placeholder:"مثال: انتهاء العمل في المشروع السابق",...c,"data-testid":"input-transfer-reason"})}),e.jsx(ct,{})]})}),e.jsx(ut,{control:o.control,name:"performedBy",render:({field:c})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"تم بواسطة *"}),e.jsx(lt,{children:e.jsx(je,{placeholder:"اسم الشخص المسؤول عن النقل",...c,"data-testid":"input-performed-by"})}),e.jsx(gi,{children:"أدخل اسم الشخص المسؤول عن تنفيذ عملية النقل"}),e.jsx(ct,{})]})}),e.jsx(ut,{control:o.control,name:"notes",render:({field:c})=>e.jsxs(ot,{children:[e.jsx(rt,{children:"ملاحظات إضافية"}),e.jsx(lt,{children:e.jsx(Fa,{placeholder:"ملاحظات أو تفاصيل إضافية حول النقل...",className:"resize-none",rows:3,...c,"data-testid":"textarea-transfer-notes"})}),e.jsx(ct,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 space-x-reverse pt-4",children:[e.jsx(K,{type:"button",variant:"outline",onClick:()=>r(!1),"data-testid":"button-cancel-transfer",children:"إلغاء"}),e.jsx(K,{type:"submit",disabled:l.isPending,"data-testid":"button-confirm-transfer",children:l.isPending?"جاري النقل...":"تأكيد النقل"})]})]})})]})}):null}function I3({equipment:t,open:s,onOpenChange:r,projects:a}){const{data:n=[],isLoading:i}=Se({queryKey:["equipment-movements",t?.id],queryFn:()=>fetch(`/api/equipment/${t?.id}/movements`).then(u=>u.json()),enabled:!!t?.id&&s,staleTime:3e4}),o=u=>{if(!u)return"غير محدد";const d=Array.isArray(a)?a.find(c=>c.id===u):void 0;return d?d.name:"مشروع غير معروف"},l=u=>{try{const d=new Date(u);return d.toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",weekday:"long"})+" - "+d.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}catch{return u}};return e.jsx(Ss,{open:s,onOpenChange:r,children:e.jsxs(js,{className:"w-[95vw] max-w-[900px] h-[90vh] overflow-hidden flex flex-col",dir:"rtl",children:[e.jsxs(As,{className:"pb-4 border-b bg-gradient-to-r from-blue-50 to-indigo-50 -m-6 mb-0 p-6 rounded-t-lg",children:[e.jsxs(_s,{className:"flex items-center gap-3 text-xl font-bold",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(so,{className:"w-6 h-6 text-blue-700"})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-blue-900",children:"سجل حركة المعدة"})})]}),e.jsxs(Fs,{className:"text-sm font-normal text-blue-600 mt-1",children:[t?.name," - عرض سجل التحويلات والحركات"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 mt-4 px-1",children:[e.jsx(ee,{className:"border-0 shadow-lg bg-gradient-to-br from-white to-gray-50",children:e.jsx(oe,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Br,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"كود المعدة"}),e.jsx("div",{className:"font-bold text-gray-900",children:t?.code})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(xr,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"المشروع الحالي"}),e.jsx("div",{className:"font-bold text-gray-900 truncate",children:o(t?.currentProjectId||null)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Br,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"نوع المعدة"}),e.jsx("div",{className:"font-bold text-gray-900",children:t?.type})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${t?.status==="active"?"bg-green-500":t?.status==="maintenance"?"bg-yellow-500":t?.status==="damaged"?"bg-red-500":"bg-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"حالة المعدة"}),e.jsx(Fe,{className:`font-bold ${t?.status==="active"?"bg-green-100 text-green-800":t?.status==="maintenance"?"bg-yellow-100 text-yellow-800":t?.status==="damaged"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t?.status==="active"?"نشط":t?.status==="maintenance"?"في الصيانة":t?.status==="damaged"?"معطل":"غير نشط"})]})]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(so,{className:"w-5 h-5 text-indigo-700"})}),e.jsx("h3",{className:"font-bold text-gray-900",children:"سجل الحركات"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(Fe,{className:"bg-indigo-100 text-indigo-800 font-bold px-3 py-1",children:[n.length," حركة"]})})]}),i?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200"}),e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent absolute top-0 left-0"})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"جاري تحميل سجل الحركات..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"الرجاء الانتظار"})]})]}):n.length===0?e.jsx(ee,{className:"border-0 shadow-lg bg-gradient-to-br from-gray-50 to-slate-50",children:e.jsx(oe,{className:"py-12 text-center",children:e.jsxs("div",{className:"max-w-sm mx-auto",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(so,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"لا توجد حركات مسجلة"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"لم يتم تسجيل أي حركات نقل لهذه المعدة حتى الآن."}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-600",children:"💡 ستظهر جميع حركات النقل هنا عند تسجيلها"})})]})})}):e.jsx("div",{className:"space-y-4",children:n.map((u,d)=>e.jsx(ee,{className:"border-0 shadow-lg hover:shadow-xl transition-all duration-300 bg-gradient-to-br from-white to-gray-50/50",children:e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-bold text-blue-700",children:["#",n.length-d]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-900",children:["حركة رقم ",n.length-d]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 mt-1",children:[e.jsx(yr,{className:"w-3 h-3"}),l(u.movementDate)]})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 p-4 rounded-xl border border-blue-100",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4",children:[e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(xr,{className:"w-3 h-3 text-green-600"})}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"من"})]}),e.jsx("div",{className:"bg-white/70 p-3 rounded-lg border border-green-200",children:e.jsx("span",{className:"text-sm font-bold text-gray-900 block truncate",children:o(u.fromProjectId)})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(ba,{className:"w-4 h-4 text-blue-600"})})}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(xr,{className:"w-3 h-3 text-blue-600"})}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"إلى"})]}),e.jsx("div",{className:"bg-white/70 p-3 rounded-lg border border-blue-200",children:e.jsx("span",{className:"text-sm font-bold text-gray-900 block truncate",children:o(u.toProjectId)})})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Hs,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"قام بالنقل"}),e.jsx("div",{className:"text-sm font-bold text-gray-900",children:u.performedBy})]})]}),u.reason&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center mt-0.5",children:e.jsx(Br,{className:"w-4 h-4 text-amber-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"السبب"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 break-words",children:u.reason})]})]}),u.notes&&e.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-yellow-100 rounded-full flex items-center justify-center mt-0.5",children:e.jsx("span",{className:"text-xs",children:"💡"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-800 font-bold text-xs block mb-1",children:"ملاحظات مهمة"}),e.jsx("span",{className:"text-yellow-700 text-sm break-words",children:u.notes})]})]})})]})]})]})},u.id))})]})]})]})})}var co={exports:{}},R3=co.exports,Bh;function F3(){return Bh||(Bh=1,(function(t,s){(function(r,a){a()})(R3,function(){function r(d,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\uFEFF",d],{type:d.type}):d}function a(d,c,m){var h=new XMLHttpRequest;h.open("GET",d),h.responseType="blob",h.onload=function(){u(h.response,c,m)},h.onerror=function(){console.error("could not download file")},h.send()}function n(d){var c=new XMLHttpRequest;c.open("HEAD",d,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function i(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(c)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Ki=="object"&&Ki.global===Ki?Ki:void 0,l=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(d,c,m){var h=o.URL||o.webkitURL,x=document.createElement("a");c=c||d.name||"download",x.download=c,x.rel="noopener",typeof d=="string"?(x.href=d,x.origin===location.origin?i(x):n(x.href)?a(d,c,m):i(x,x.target="_blank")):(x.href=h.createObjectURL(d),setTimeout(function(){h.revokeObjectURL(x.href)},4e4),setTimeout(function(){i(x)},0))}:"msSaveOrOpenBlob"in navigator?function(d,c,m){if(c=c||d.name||"download",typeof d!="string")navigator.msSaveOrOpenBlob(r(d,m),c);else if(n(d))a(d,c,m);else{var h=document.createElement("a");h.href=d,h.target="_blank",setTimeout(function(){i(h)})}}:function(d,c,m,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof d=="string")return a(d,c,m);var x=d.type==="application/octet-stream",p=/constructor/i.test(o.HTMLElement)||o.safari,k=/CriOS\/[\d]+/.test(navigator.userAgent);if((k||x&&p||l)&&typeof FileReader<"u"){var g=new FileReader;g.onloadend=function(){var y=g.result;y=k?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=y:location=y,h=null},g.readAsDataURL(d)}else{var b=o.URL||o.webkitURL,j=b.createObjectURL(d);h?h.location=j:location.href=j,h=null,setTimeout(function(){b.revokeObjectURL(j)},4e4)}});o.saveAs=u.saveAs=u,t.exports=u})})(co)),co.exports}var $3=F3();const Dc={name:"شركة الإدارة الهندسية",address:"المملكة العربية السعودية",phone:"+966 XX XXXX XXX",email:"info@company.com",logo:null},Et={header:{font:{bold:!0,size:14,color:{argb:"FFFFFF"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"4F46E5"}},alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}},subHeader:{font:{bold:!0,size:12},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"F3F4F6"}},alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}},cell:{font:{size:10},alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}},currency:{font:{size:10},alignment:{horizontal:"right",vertical:"middle"},numFmt:'#,##0.00" ريال"',border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}};function V3(t,s,r){t.mergeCells("A1:F1");const a=t.getCell("A1");a.value=Dc.name,a.font={bold:!0,size:16},a.alignment={horizontal:"center",vertical:"middle"},t.mergeCells("A2:F2");const n=t.getCell("A2");if(n.value=s,n.font={bold:!0,size:14},n.alignment={horizontal:"center",vertical:"middle"},r){t.mergeCells("A3:F3");const i=t.getCell("A3");i.value=r,i.font={size:12},i.alignment={horizontal:"center",vertical:"middle"}}t.addRow([])}function qh(){const[t,s]=f.useState(""),[r,a]=f.useState("all"),[n,i]=f.useState("all"),[o,l]=f.useState("all"),[u,d]=f.useState(!1),[c,m]=f.useState(null),[h,x]=f.useState(!1),[p,k]=f.useState(!1),[g,b]=f.useState(!1),[j,y]=f.useState(null),[M,N]=f.useState(!1),[T,S]=f.useState(!1),[I,E]=f.useState("all"),[z,w]=f.useState("all"),[v,D]=f.useState("all"),[V,X]=f.useState(!1),C=Gt(),{setFloatingAction:q}=Ps(),{toast:ue}=Dt();f.useEffect(()=>(q(()=>d(!0),"إضافة معدة جديدة"),()=>q(null)),[q]);const{data:R=[],isLoading:fe,refetch:ce,isFetching:ne}=Se({queryKey:["equipment",t,r,n,o],queryFn:async()=>{const G=new URLSearchParams;t&&G.append("searchTerm",t),r!=="all"&&G.append("status",r),n!=="all"&&G.append("type",n),o!=="all"&&o!=="warehouse"?G.append("projectId",o):o==="warehouse"&&G.append("projectId","");const qe=await fetch(`/api/equipment?${G}`);if(!qe.ok)throw new Error("فشل في جلب المعدات");return qe.json()},staleTime:1800*1e3,gcTime:7200*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:0,enabled:!0}),{data:ye=[]}=Se({queryKey:["projects"],queryFn:async()=>await me("/api/projects","GET"),staleTime:900*1e3,gcTime:3600*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:1,retryDelay:1e3}),tt=G=>{m(G),N(!0)},at=(G,qe)=>{qe?.stopPropagation(),m(G),k(!0)},st=(G,qe)=>{m(G),x(!0)},H=(G,qe)=>{m(G),b(!0)},L=Ae({mutationFn:async G=>await me(`/api/equipment/${G}`,"DELETE"),onSuccess:()=>{C.invalidateQueries({predicate:G=>Array.isArray(G.queryKey)&&G.queryKey[0]==="equipment"}),ue({title:"تم حذف المعدة بنجاح",description:"تم حذف المعدة من النظام نهائياً"}),N(!1)},onError:G=>{ue({title:"خطأ في حذف المعدة",description:G.message||"حدث خطأ أثناء حذف المعدة",variant:"destructive"})}}),Q=(G,qe)=>{confirm(`هل أنت متأكد من حذف المعدة "${G.name}" نهائياً؟

لا يمكن التراجع عن هذا الإجراء.`)&&L.mutate(G.id)},Ne=G=>{const qe={active:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",maintenance:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",out_of_service:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",inactive:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"};return qe[G]||qe.active},pt=G=>({أدوات:"bg-gradient-to-br from-red-500 to-red-600",أمتار:"bg-gradient-to-br from-blue-500 to-blue-600",مطارق:"bg-gradient-to-br from-gray-700 to-gray-800","مكينة لحام":"bg-gradient-to-br from-orange-500 to-orange-600","جلخ كهربائي":"bg-gradient-to-br from-yellow-500 to-yellow-600",دريل:"bg-gradient-to-br from-green-500 to-green-600",تخزيق:"bg-gradient-to-br from-purple-500 to-purple-600",بانات:"bg-gradient-to-br from-indigo-500 to-indigo-600",مفاتيح:"bg-gradient-to-br from-pink-500 to-pink-600",أسلاك:"bg-gradient-to-br from-cyan-500 to-cyan-600",دساميس:"bg-gradient-to-br from-teal-500 to-teal-600",إنشائية:"bg-gradient-to-br from-blue-500 to-blue-600",نقل:"bg-gradient-to-br from-green-500 to-green-600",أداة:"bg-gradient-to-br from-purple-500 to-purple-600",construction:"bg-gradient-to-br from-blue-500 to-blue-600",transport:"bg-gradient-to-br from-green-500 to-green-600",tool:"bg-gradient-to-br from-purple-500 to-purple-600"})[G]||"bg-gradient-to-br from-gray-500 to-gray-600",yt=G=>({active:"نشط",maintenance:"صيانة",out_of_service:"خارج الخدمة",inactive:"غير نشط"})[G]||G,Me=G=>({أدوات:"🔧",أمتار:"📏",مطارق:"🔨","مكينة لحام":"⚡","جلخ كهربائي":"⚙️",دريل:"🔩",تخزيق:"✂️",بانات:"🔗",مفاتيح:"🔑",أسلاك:"🔌",دساميس:"📎",construction:e.jsx(tr,{className:"h-5 w-5"}),transport:e.jsx(Za,{className:"h-5 w-5"}),tool:e.jsx(Iu,{className:"h-5 w-5"}),إنشائية:e.jsx(tr,{className:"h-5 w-5"}),نقل:e.jsx(Za,{className:"h-5 w-5"}),أداة:e.jsx(Iu,{className:"h-5 w-5"})})[G]||e.jsx(tr,{className:"h-5 w-5"}),bt=()=>Array.isArray(R)?R.filter(G=>{const qe=I==="all"||I==="warehouse"&&!G.currentProjectId||G.currentProjectId===I,he=z==="all"||G.status===z,_=v==="all"||G.type===v;return qe&&he&&_}):[],rs=async()=>{const G=bt();if(G.length===0){ue({title:"لا توجد معدات للتصدير",description:"يرجى التأكد من الفلاتر المحددة",variant:"destructive"});return}try{X(!0);const qe=await ew(()=>import("./exceljs.min-CT50dpqw.js").then(F=>F.e),__vite__mapDeps([0,1,2])),he=new qe.Workbook;he.creator=Dc.name,he.lastModifiedBy="نظام إدارة المعدات",he.created=new Date,he.modified=new Date;const _=he.addWorksheet("كشف المعدات");_.views=[{rightToLeft:!0}];const $=I==="all"?"جميع المشاريع":I==="warehouse"?"المستودع":(Array.isArray(ye)?ye.find(F=>F.id===I)?.name:void 0)||"مشروع محدد";let B=V3(_,"كشف المعدات التفصيلي",`المشروع: ${$}`,[`تاريخ الإصدار: ${ur(new Date().toISOString().split("T")[0])}`,`إجمالي المعدات: ${G.length}`,`المعدات النشطة: ${G.filter(F=>F.status==="active").length}`,`في الصيانة: ${G.filter(F=>F.status==="maintenance").length}`]);const se=["الكود","اسم المعدة","الفئة","الحالة","الموقع","سعر الشراء","تاريخ الشراء","الوصف"],ae=_.addRow(se);se.forEach((F,Ce)=>{const _e=ae.getCell(Ce+1);_e.font=Et.fonts.header,_e.fill={type:"pattern",pattern:"solid",fgColor:{argb:Et.colors.headerBg}},_e.border={top:Et.borders.medium,bottom:Et.borders.medium,left:Et.borders.thin,right:Et.borders.thin},_e.alignment={horizontal:"center",vertical:"middle"}}),_.getColumn(1).width=15,_.getColumn(2).width=25,_.getColumn(3).width=15,_.getColumn(4).width=15,_.getColumn(5).width=25,_.getColumn(6).width=18,_.getColumn(7).width=15,_.getColumn(8).width=30,B++,G.forEach((F,Ce)=>{const _e=F.currentProjectId?(Array.isArray(ye)?ye.find(Ee=>Ee.id===F.currentProjectId)?.name:void 0)||"مشروع غير معروف":"المستودع";_.addRow([F.code,F.name,F.type||"غير محدد",yt(F.status),_e,F.purchasePrice?Ge(Number(F.purchasePrice)):"غير محدد",F.purchaseDate?ur(F.purchaseDate):"غير محدد",F.description||"غير محدد"]).eachCell((Ee,xs)=>{Ee.font=Et.fonts.data,Ee.border={top:Et.borders.thin,bottom:Et.borders.thin,left:Et.borders.thin,right:Et.borders.thin},Ee.alignment={horizontal:"center",vertical:"middle"},xs===6&&F.purchasePrice&&(Ee.numFmt='#,##0 "ريال"',Ee.alignment={horizontal:"left",vertical:"middle"}),xs===8&&(Ee.alignment={horizontal:"right",vertical:"middle"}),Ce%2===0&&(Ee.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}})}),B++}),B+=2,_.addRow([]),B++;const Y=_.addRow(["ملخص المعدات"]);_.mergeCells(`A${B}:H${B}`);const pe=Y.getCell(1);pe.font={...Et.fonts.title,size:14},pe.alignment={horizontal:"center",vertical:"middle"},pe.fill={type:"pattern",pattern:"solid",fgColor:{argb:Et.colors.totalsBg}},pe.border={top:Et.borders.medium,bottom:Et.borders.medium,left:Et.borders.medium,right:Et.borders.medium},B++,[["إجمالي المعدات",G.length],["المعدات النشطة",G.filter(F=>F.status==="active").length],["في الصيانة",G.filter(F=>F.status==="maintenance").length],["خارج الخدمة",G.filter(F=>F.status==="out_of_service").length],["غير نشطة",G.filter(F=>F.status==="inactive").length]].forEach(([F,Ce])=>{const _e=_.addRow([F,"","","","","","",Ce]),Mt=_e.getCell(1),Ee=_e.getCell(8);Mt.font=Et.fonts.totals,Ee.font=Et.fonts.totals,[Mt,Ee].forEach(xs=>{xs.border={top:Et.borders.thin,bottom:Et.borders.thin,left:Et.borders.thin,right:Et.borders.thin}}),Mt.alignment={horizontal:"right",vertical:"middle"},Ee.alignment={horizontal:"center",vertical:"middle"},B++}),B+=2,_.addRow([]),B++;const nt=_.addRow([`تم إنشاء هذا التقرير بواسطة ${Dc.name} - ${ur(new Date().toISOString().split("T")[0])}`]);_.mergeCells(`A${B}:H${B}`);const Ot=nt.getCell(1);Ot.font=Et.fonts.footer,Ot.alignment={horizontal:"center",vertical:"middle"};const as=`كشف_المعدات_${I==="all"?"جميع_المشاريع":I==="warehouse"?"المستودع":(Array.isArray(ye)?ye.find(F=>F.id===I)?.name:void 0)?.replace(/\s/g,"_")||"مشروع_محدد"}_${new Date().toISOString().split("T")[0]}.xlsx`,Ys=await he.xlsx.writeBuffer(),Er=new Blob([Ys],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});$3.saveAs(Er,as),ue({title:"تم تصدير كشف المعدات بنجاح",description:`تم حفظ الملف: ${as}`})}catch(qe){console.error("خطأ في تصدير Excel:",qe),ue({title:"خطأ في التصدير",description:"حدث خطأ أثناء تصدير كشف المعدات",variant:"destructive"})}finally{X(!1)}},ds=async()=>{const G=bt();if(G.length===0){ue({title:"لا توجد معدات للتصدير",description:"يرجى التأكد من الفلاتر المحددة",variant:"destructive"});return}try{X(!0);const qe=I==="all"?"جميع المشاريع":I==="warehouse"?"المستودع":(Array.isArray(ye)?ye.find(_=>_.id===I)?.name:void 0)||"مشروع محدد",he=`
        <html dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>كشف المعدات - ${qe}</title>
            <style>
              @page {
                margin: 2cm 1.5cm;
                size: A4;
              }
              body { 
                font-family: 'Arial', sans-serif; 
                margin: 0; 
                padding: 0; 
                direction: rtl; 
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                color: #1e293b;
                line-height: 1.6;
              }
              
              /* رأس احترافي */
              .company-header {
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
                color: white;
                padding: 25px;
                text-align: center;
                border-radius: 12px;
                margin-bottom: 30px;
                box-shadow: 0 8px 25px rgba(30, 64, 175, 0.3);
              }
              .company-name {
                font-size: 24px;
                font-weight: bold;
                margin: 0 0 10px 0;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
              }
              .company-subtitle {
                font-size: 14px;
                opacity: 0.9;
                margin: 0;
              }
              
              /* عنوان التقرير */
              .report-header {
                background: white;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                margin-bottom: 25px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                border-left: 6px solid #3b82f6;
              }
              .report-title {
                font-size: 22px;
                color: #1e293b;
                margin: 0 0 15px 0;
                font-weight: bold;
              }
              
              /* معلومات التقرير */
              .report-info {
                display: flex;
                justify-content: space-around;
                background: #f8fafc;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 25px;
                border: 1px solid #e2e8f0;
              }
              .info-item {
                text-align: center;
                color: #475569;
                font-weight: 600;
              }
              .info-label {
                display: block;
                font-size: 12px;
                color: #64748b;
                margin-bottom: 5px;
              }
              .info-value {
                display: block;
                font-size: 16px;
                color: #1e293b;
                font-weight: bold;
              }
              
              /* الجدول */
              table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 25px;
                background: white;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
              }
              th {
                background: linear-gradient(135deg, #334155 0%, #475569 100%);
                color: white;
                padding: 15px 10px;
                text-align: center;
                font-weight: bold;
                font-size: 13px;
                text-shadow: 0 1px 2px rgba(0,0,0,0.2);
              }
              td {
                padding: 12px 8px;
                text-align: center;
                border-bottom: 1px solid #e2e8f0;
                font-size: 12px;
                vertical-align: middle;
              }
              tr:nth-child(even) td {
                background-color: #f8fafc;
              }
              tr:hover td {
                background-color: #e0f2fe;
              }
              
              /* الملخص */
              .summary {
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                padding: 20px;
                border-radius: 12px;
                margin-top: 25px;
                border-left: 6px solid #10b981;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
              }
              .summary h3 {
                margin-top: 0;
                color: #1e293b;
                font-size: 18px;
                margin-bottom: 15px;
                text-align: center;
              }
              .summary-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin-top: 15px;
              }
              .summary-item {
                background: white;
                padding: 12px;
                border-radius: 8px;
                text-align: center;
                border: 1px solid #e2e8f0;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
              }
              .summary-value {
                display: block;
                font-size: 20px;
                font-weight: bold;
                color: #1e293b;
              }
              .summary-label {
                display: block;
                font-size: 12px;
                color: #64748b;
                margin-top: 5px;
              }
              
              /* الذيل */
              .footer {
                background: linear-gradient(135deg, #64748b 0%, #475569 100%);
                color: white;
                text-align: center;
                padding: 20px;
                border-radius: 10px;
                margin-top: 30px;
                font-size: 12px;
              }
              .footer-info {
                margin: 5px 0;
              }
            </style>
          </head>
          <body>
            <!-- رأس الشركة -->
            <div class="company-header">
              <div class="company-name">شركة الفتيني للمقاولات والاستشارات الهندسية</div>
              <div class="company-subtitle">Al-Fathi Construction & Engineering Consultancy Company</div>
            </div>
            
            <!-- عنوان التقرير -->
            <div class="report-header">
              <div class="report-title">كشف المعدات التفصيلي</div>
            </div>
            
            <!-- معلومات التقرير -->
            <div class="report-info">
              <div class="info-item">
                <span class="info-label">المشروع</span>
                <span class="info-value">${qe}</span>
              </div>
              <div class="info-item">
                <span class="info-label">تاريخ التقرير</span>
                <span class="info-value">${ur(new Date().toISOString().split("T")[0])}</span>
              </div>
              <div class="info-item">
                <span class="info-label">إجمالي المعدات</span>
                <span class="info-value">${G.length}</span>
              </div>
              <div class="info-item">
                <span class="info-label">المعدات النشطة</span>
                <span class="info-value">${G.filter(_=>_.status==="active").length}</span>
              </div>
            </div>
            
            <table>
              <thead>
                <tr>
                  <th>الكود</th>
                  <th>اسم المعدة</th>
                  <th>الفئة</th>
                  <th>الحالة</th>
                  <th>الموقع</th>
                  <th>سعر الشراء</th>
                  <th>تاريخ الشراء</th>
                </tr>
              </thead>
              <tbody>
                ${G.map(_=>{const $=_.currentProjectId?(Array.isArray(ye)?ye.find(B=>B.id===_.currentProjectId)?.name:void 0)||"مشروع غير معروف":"المستودع";return`
                    <tr>
                      <td>${_.code}</td>
                      <td>${_.name}</td>
                      <td>${_.type==="construction"?"إنشائية":_.type==="transport"?"نقل":_.type==="tool"?"أداة":_.type}</td>
                      <td>${yt(_.status)}</td>
                      <td>${$}</td>
                      <td>${_.purchasePrice?Ge(Number(_.purchasePrice)):"غير محدد"}</td>
                      <td>${_.purchaseDate?ur(_.purchaseDate):"غير محدد"}</td>
                    </tr>
                  `}).join("")}
              </tbody>
            </table>
            
            <!-- الملخص الاحترافي -->
            <div class="summary">
              <h3>ملخص المعدات</h3>
              <div class="summary-grid">
                <div class="summary-item">
                  <span class="summary-value">${G.length}</span>
                  <span class="summary-label">إجمالي المعدات</span>
                </div>
                <div class="summary-item">
                  <span class="summary-value">${G.filter(_=>_.status==="active").length}</span>
                  <span class="summary-label">المعدات النشطة</span>
                </div>
                <div class="summary-item">
                  <span class="summary-value">${G.filter(_=>_.status==="maintenance").length}</span>
                  <span class="summary-label">في الصيانة</span>
                </div>
                <div class="summary-item">
                  <span class="summary-value">${G.filter(_=>_.status==="out_of_service").length}</span>
                  <span class="summary-label">خارج الخدمة</span>
                </div>
              </div>
            </div>
            
            <!-- ذيل احترافي -->
            <div class="footer">
              <div class="footer-info">تم إنشاء هذا التقرير بواسطة نظام إدارة المشاريع الإنشائية</div>
              <div class="footer-info">شركة الفتيني للمقاولات والاستشارات الهندسية</div>
              <div class="footer-info">تاريخ الطباعة: ${ur(new Date().toISOString().split("T")[0])} - ${new Date().toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}</div>
            </div>
          </body>
        </html>
      `;try{const _=new Blob([he],{type:"text/html"}),$=URL.createObjectURL(_),B=window.open($,"_blank","width=1200,height=800,scrollbars=yes,resizable=yes");if(B)setTimeout(()=>{try{B.print(),setTimeout(()=>{URL.revokeObjectURL($),B.close()},2e3)}catch(se){console.warn("خطأ في الطباعة المباشرة، جاري فتح النافذة للمعاينة:",se),ue({title:"تم فتح المعاينة",description:"استخدم Ctrl+P أو ⌘+P للطباعة، أو اختر 'طباعة' من القائمة",duration:5e3})}},1500),ue({title:"جاري إعداد الطباعة",description:"انتظر قليلاً ليتم تحميل المحتوى وفتح نافذة الطباعة"});else{const se=document.createElement("a");se.href=$,se.download=`كشف_المعدات_${qe}_${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL($),ue({title:"تم تنزيل الملف",description:"افتح الملف الذي تم تنزيله واطبعه باستخدام متصفحك"})}}catch(_){console.error("خطأ في فتح نافذة الطباعة:",_);const $="data:text/html;charset=utf-8,"+encodeURIComponent(he),B=document.createElement("a");B.href=$,B.download=`كشف_المعدات_${qe}_${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(B),B.click(),document.body.removeChild(B),ue({title:"تم إنشاء ملف HTML",description:"افتح الملف المحفوظ واطبعه أو احفظه كـ PDF"})}}catch(qe){console.error("خطأ في تصدير PDF:",qe),ue({title:"خطأ في التصدير",description:"حدث خطأ أثناء تصدير كشف المعدات",variant:"destructive"})}finally{X(!1)}};return fe?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"جاري تحميل المعدات..."})]})})}):(console.log("🔧 بيانات المعدات في Frontend:",{equipment:R,count:R?.length,isLoading:fe}),e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",dir:"rtl",children:[e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Kr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(je,{placeholder:"البحث بالاسم أو الكود...",value:t,onChange:G=>s(G.target.value),className:"pr-10 h-10 text-sm border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500","data-testid":"input-search-equipment"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:grid-cols-3",children:[e.jsxs(We,{value:r,onValueChange:a,children:[e.jsx(ze,{"data-testid":"select-status-filter",className:"h-9 text-xs border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1 truncate",children:[e.jsx(Ms,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ke,{placeholder:"الحالة"})]})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الحالات"}),e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"maintenance",children:"صيانة"}),e.jsx(W,{value:"out_of_service",children:"خارج الخدمة"}),e.jsx(W,{value:"inactive",children:"غير نشط"})]})]}),e.jsxs(We,{value:n,onValueChange:i,children:[e.jsx(ze,{"data-testid":"select-type-filter",className:"h-9 text-xs border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1 truncate",children:[e.jsx(tr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ke,{placeholder:"الفئة"})]})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الفئات"}),e.jsx(W,{value:"أدوات كهربائية",children:"أدوات كهربائية"}),e.jsx(W,{value:"أدوات يدوية",children:"أدوات يدوية"}),e.jsx(W,{value:"أدوات قياس",children:"أدوات قياس"}),e.jsx(W,{value:"معدات لحام",children:"معدات لحام"}),e.jsx(W,{value:"معدات حفر",children:"معدات حفر"}),e.jsx(W,{value:"معدات قطع",children:"معدات قطع"}),e.jsx(W,{value:"أدوات ربط",children:"أدوات ربط"}),e.jsx(W,{value:"مواد كهربائية",children:"مواد كهربائية"}),e.jsx(W,{value:"معدات أمان",children:"معدات أمان"}),e.jsx(W,{value:"أدوات نقل",children:"أدوات نقل"})]})]}),e.jsxs(We,{value:o,onValueChange:l,children:[e.jsx(ze,{"data-testid":"select-project-filter",className:"h-9 text-xs border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1 truncate",children:[e.jsx(xr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ke,{placeholder:"المشروع"})]})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع المواقع"}),e.jsx(W,{value:"warehouse",children:"المستودع"}),Array.isArray(ye)?ye.map(G=>e.jsx(W,{value:G.id,children:G.name},G.id)):null]})]})]})]}),e.jsxs(Pd,{className:"mb-6",children:[e.jsx(it,{title:"إجمالي المعدات",value:R.length,icon:tr,className:"border-r-4 border-r-blue-500","data-testid":"stats-total-equipment"}),e.jsx(it,{title:"نشطة",value:Array.isArray(R)?R.filter(G=>G.status==="active").length:0,icon:Ms,className:"border-r-4 border-r-green-500 bg-gradient-to-r from-green-50 to-white dark:from-green-950 dark:to-gray-900","data-testid":"stats-active-equipment"}),e.jsx(it,{title:"في الصيانة",value:Array.isArray(R)?R.filter(G=>G.status==="maintenance").length:0,icon:gr,className:"border-r-4 border-r-yellow-500 bg-gradient-to-r from-yellow-50 to-white dark:from-yellow-950 dark:to-gray-900","data-testid":"stats-maintenance-equipment"}),e.jsx(it,{title:"خارج الخدمة",value:Array.isArray(R)?R.filter(G=>G.status==="out_of_service").length:0,icon:Za,className:"border-r-4 border-r-red-500 bg-gradient-to-r from-red-50 to-white dark:from-red-950 dark:to-gray-900","data-testid":"stats-out-of-service-equipment"})]}),e.jsxs(ee,{className:"mb-6",children:[e.jsx(He,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(et,{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"h-5 w-5 text-blue-600"}),"كشوفات المعدات"]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>S(!T),className:"flex items-center gap-2","data-testid":"button-toggle-reports",children:[T?"إخفاء":"عرض"," الكشوفات",e.jsx(Wr,{className:"h-4 w-4"})]})]})}),T&&e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فلترة حسب المشروع"}),e.jsxs(We,{value:I,onValueChange:E,children:[e.jsx(ze,{"data-testid":"select-report-project-filter",className:"h-9 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(xr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ke,{placeholder:"اختر المشروع"})]})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع المشاريع"}),e.jsx(W,{value:"warehouse",children:"المستودع"}),Array.isArray(ye)?ye.map(G=>e.jsx(W,{value:G.id,children:G.name},G.id)):null]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فلترة حسب الحالة"}),e.jsxs(We,{value:z,onValueChange:w,children:[e.jsx(ze,{"data-testid":"select-report-status-filter",className:"h-9 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(Ms,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ke,{placeholder:"اختر الحالة"})]})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الحالات"}),e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"maintenance",children:"صيانة"}),e.jsx(W,{value:"out_of_service",children:"خارج الخدمة"}),e.jsx(W,{value:"inactive",children:"غير نشط"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فلترة حسب الفئة"}),e.jsxs(We,{value:v,onValueChange:D,children:[e.jsx(ze,{"data-testid":"select-report-type-filter",className:"h-9 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(tr,{className:"h-3 w-3 text-gray-500 shrink-0"}),e.jsx(Ke,{placeholder:"اختر الفئة"})]})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الفئات"}),e.jsx(W,{value:"أدوات كهربائية",children:"أدوات كهربائية"}),e.jsx(W,{value:"أدوات يدوية",children:"أدوات يدوية"}),e.jsx(W,{value:"أدوات قياس",children:"أدوات قياس"}),e.jsx(W,{value:"معدات لحام",children:"معدات لحام"}),e.jsx(W,{value:"معدات حفر",children:"معدات حفر"}),e.jsx(W,{value:"معدات قطع",children:"معدات قطع"}),e.jsx(W,{value:"أدوات ربط",children:"أدوات ربط"}),e.jsx(W,{value:"مواد كهربائية",children:"مواد كهربائية"}),e.jsx(W,{value:"معدات أمان",children:"معدات أمان"}),e.jsx(W,{value:"أدوات نقل",children:"أدوات نقل"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"معاينة الكشف"}),e.jsxs(Fe,{variant:"outline",className:"text-blue-700 border-blue-300",children:[bt().length," معدة"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:bt().length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"إجمالي المعدات"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:bt().filter(G=>G.status==="active").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"نشطة"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:bt().filter(G=>G.status==="maintenance").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"صيانة"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:bt().filter(G=>G.status==="out_of_service").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"خارج الخدمة"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(K,{onClick:rs,disabled:V||bt().length===0,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white","data-testid":"button-export-excel",children:[V?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(f0,{className:"h-4 w-4"}),"تصدير Excel"]}),e.jsxs(K,{onClick:ds,disabled:V||bt().length===0,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white","data-testid":"button-export-pdf",children:[V?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Br,{className:"h-4 w-4"}),"تصدير PDF"]}),e.jsxs(K,{onClick:()=>{if(bt().length===0){ue({title:"لا توجد معدات للطباعة",description:"يرجى التأكد من الفلاتر المحددة",variant:"destructive"});return}ds()},variant:"outline",disabled:V,className:"flex items-center gap-2","data-testid":"button-print-report",children:[e.jsx(P2,{className:"h-4 w-4"}),"طباعة"]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:R.length===0?e.jsxs(ee,{className:"p-8 text-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(tr,{className:"h-16 w-16 mx-auto opacity-50"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"لا توجد معدات"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"لم يتم العثور على أي معدات تطابق الفلاتر المحددة"}),e.jsxs(K,{onClick:()=>d(!0),className:"bg-red-500 hover:bg-red-600 text-white rounded-full px-6",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"إضافة معدة جديدة"]})]}):Array.isArray(R)?R.map(G=>e.jsx(ee,{className:"bg-white dark:bg-gray-800 hover:shadow-md transition-all duration-200 cursor-pointer border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",onClick:()=>tt(G),"data-testid":`card-equipment-${G.id}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"relative w-16 h-16 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-700 shrink-0",children:G.imageUrl&&G.imageUrl.trim()!==""?e.jsx("img",{src:G.imageUrl,alt:G.name,className:"w-full h-full object-cover",onLoad:()=>console.log("تم تحميل صورة المعدة بنجاح:",G.name),onError:qe=>{console.error("فشل في تحميل صورة المعدة:",G.imageUrl);const _=qe.target.parentElement;_.innerHTML=`<div class="${pt(G.type).replace("bg-gradient-to-br","bg-gradient-to-br")} w-full h-full flex items-center justify-center text-white"><span class="text-xl">${Me(G.type)}</span></div>`}}):e.jsx("div",{className:`w-full h-full flex items-center justify-center text-white ${pt(G.type)}`,children:Me(G.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-1","data-testid":`text-equipment-name-${G.id}`,children:G.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Fe,{className:`text-xs ${Ne(G.status)}`,"data-testid":`badge-status-${G.id}`,children:yt(G.status)}),e.jsx(Fe,{variant:"outline",className:"text-xs",children:G.code})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(xr,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate","data-testid":`text-location-${G.id}`,children:G.currentProjectId?(Array.isArray(ye)?ye.find(qe=>qe.id===G.currentProjectId)?.name:void 0)||"مشروع غير معروف":"المستودع"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[G.purchasePrice&&e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"السعر"}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:Ge(Number(G.purchasePrice))})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(K,{onClick:qe=>{qe.stopPropagation(),at(G,qe)},className:"bg-red-500 hover:bg-red-600 text-white rounded-full px-4 py-2 text-sm font-medium","data-testid":`button-transfer-${G.id}`,children:"نقل المعدة"})})]})]})})},G.id)):null}),e.jsx(zh,{open:u,onOpenChange:d,projects:ye}),e.jsx(zh,{open:h,onOpenChange:x,projects:ye,equipment:c}),e.jsx(M3,{equipment:c,open:p,onOpenChange:k,projects:ye}),e.jsx(I3,{equipment:c,open:g,onOpenChange:b,projects:ye}),e.jsx(Ss,{open:M,onOpenChange:N,children:e.jsx(js,{className:"max-w-md mx-auto bg-white dark:bg-gray-800 rounded-3xl p-0 overflow-hidden border-0 shadow-2xl",children:c&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>N(!1),className:"absolute top-4 right-4 z-10 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors",children:e.jsx(vr,{className:"h-4 w-4"})}),e.jsx("div",{className:"relative h-64 bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:c.imageUrl&&c.imageUrl.trim()!==""?e.jsx("img",{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover",onLoad:()=>console.log("تم تحميل صورة المعدة في النافذة بنجاح:",c.name),onError:G=>{console.error("فشل في تحميل صورة المعدة في النافذة:",c.imageUrl);const qe=G.target;qe.style.display="none";const he=qe.parentElement;he.innerHTML=`<div class="${pt(c.type).replace("bg-gradient-to-br","bg-gradient-to-br")} w-24 h-24 rounded-full flex items-center justify-center text-white text-2xl"><span>${Me(c.type)}</span></div>`}}):e.jsx("div",{className:`w-24 h-24 rounded-full flex items-center justify-center text-white text-2xl ${pt(c.type)}`,children:Me(c.type)})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:c.name}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Fe,{className:`text-xs ${Ne(c.status)}`,children:yt(c.status)}),e.jsx(Fe,{variant:"outline",className:"text-xs",children:c.code})]})]}),c.purchasePrice&&e.jsxs("div",{className:"text-center bg-orange-100 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-orange-600 dark:text-orange-400 mb-1",children:"السعر"}),e.jsx("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:Ge(Number(c.purchasePrice))})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"الموقع الحالي"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:c.currentProjectId?ye.find(G=>G.id===c.currentProjectId)?.name||"مشروع غير معروف":"المستودع"})]})]})}),c.description&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"الوصف"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:c.description})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsx(K,{onClick:()=>{N(!1),st(c)},className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full py-3 font-medium text-sm",children:"تعديل"}),e.jsxs(K,{onClick:()=>{N(!1),H(c)},className:"bg-purple-500 hover:bg-purple-600 text-white rounded-full py-3 font-medium text-sm flex items-center gap-1 justify-center",children:[e.jsx(so,{className:"w-4 h-4"}),"السجل"]}),e.jsx(K,{onClick:()=>{N(!1),Q(c)},disabled:L.isPending,className:"bg-red-600 hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed text-white rounded-full py-3 font-medium text-sm",children:L.isPending?"جاري الحذف...":"حذف"}),e.jsx(K,{onClick:()=>{N(!1),at(c)},className:"bg-red-500 hover:bg-red-600 text-white rounded-full py-3 font-medium text-sm",children:"نقل"})]})]})]})})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:()=>y(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>y(null),className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors","data-testid":"button-close-image",children:e.jsx(vr,{size:24})}),e.jsx("img",{src:j,alt:"صورة المعدة بالحجم الكامل",className:"max-w-full max-h-full object-contain rounded-lg",onClick:G=>G.stopPropagation()})]})})]}))}const O3={info:"bg-blue-500",low:"bg-gray-500",medium:"bg-yellow-500",high:"bg-orange-500",critical:"bg-red-500"},L3={info:wa,low:wa,medium:Gs,high:cs,critical:cs},Uh={system:ts,maintenance:Gs,warranty:cs,damaged:cs,"user-welcome":ts,task:Is,"payment-reminder":Gs,"general-announcement":wa};function z3(){const{toast:t}=Dt(),{user:s}=Ra(),[r,a]=f.useState("all"),[n,i]=f.useState("all"),o=s?.id||"06b71320-c869-4636-8f9f-dbcb5b12c74d",l=s?.role==="admin"||s?.role==="مدير"||s?.email?.includes("admin"),{data:u,isLoading:d}=Se({queryKey:["/api/notifications"],queryFn:async()=>{const T=await fetch(`/api/notifications?userId=${o}&limit=50`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!T.ok)throw new Error("Failed to fetch notifications");return T.json()},refetchInterval:3e4,enabled:!!s}),c=u?.notifications||[],m=T=>typeof T=="string"?T:T<=1?"info":T<=2?"low":T<=3?"medium":T<=4?"high":"critical",h=Ae({mutationFn:async({notificationId:T,userId:S})=>{const I=await fetch(`/api/notifications/${T}/mark-read`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({userId:S})});if(!I.ok)throw new Error("Failed to mark notification as read");return I.json()},onSuccess:()=>{Yl.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"تم بنجاح",description:"تم تعليم الإشعار كمقروء"})},onError:()=>{t({title:"خطأ",description:"فشل في تعليم الإشعار كمقروء",variant:"destructive"})}}),x=Ae({mutationFn:async()=>{const T=await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({userId:o})});if(!T.ok)throw new Error("Failed to mark all notifications as read");return T.json()},onSuccess:()=>{Yl.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"تم بنجاح",description:"تم تعليم جميع الإشعارات كمقروءة"})},onError:()=>{t({title:"خطأ",description:"فشل في تعليم جميع الإشعارات كمقروءة",variant:"destructive"})}}),p=Array.isArray(c)?c.map(T=>({...T,priority:m(T.priority),status:T.status||(T.isRead?"read":"unread")})):[],k=Array.isArray(p)?p.filter(T=>!(r!=="all"&&T.status!==r||n!=="all"&&T.type!==n)):[],g=["system","maintenance","warranty","damaged"],b=["user-welcome","task","payment-reminder","general-announcement"],j=l?[...g,...b]:b,y=Array.from(new Set(Array.isArray(p)?p.map(T=>T.type).filter(T=>j.includes(T)):[])),M={total:Array.isArray(p)?p.length:0,unread:Array.isArray(p)?p.filter(T=>T.status==="unread").length:0,critical:Array.isArray(p)?p.filter(T=>m(T.priority)==="critical").length:0,high:Array.isArray(p)?p.filter(T=>m(T.priority)==="high").length:0},N=T=>{h.mutate({notificationId:T,userId:o})};return d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-slate-900 dark:to-slate-800",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto p-3 space-y-3",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg animate-pulse",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[1,2,3,4].map(T=>e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-lg h-16"},T))})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32 mb-2"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3].map(T=>e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded flex-1"},T))})]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(T=>e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"})]})]})},T))})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-slate-900 dark:to-slate-800",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto p-3 space-y-3",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg border border-blue-100 dark:border-slate-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:M.total}),e.jsx("div",{className:"text-xs opacity-90",children:"إجمالي الإشعارات"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:M.unread}),e.jsx("div",{className:"text-xs opacity-90",children:"غير مقروء"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:M.high}),e.jsx("div",{className:"text-xs opacity-90",children:"عالي الأولوية"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:M.critical}),e.jsx("div",{className:"text-xs opacity-90",children:"حرج"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg border border-blue-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qc,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:"تصفية الإشعارات"})]}),M.unread>0&&e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>x.mutate(),disabled:x.isPending,className:"text-xs gap-1 h-7 px-2",children:[e.jsx(Is,{className:"h-3 w-3"}),"تعليم الكل كمقروء"]})]}),e.jsxs("div",{className:"flex gap-1 mb-2",children:[e.jsxs(K,{variant:r==="all"?"default":"outline",onClick:()=>a("all"),size:"sm",className:de("flex-1 gap-1 text-xs h-8",r==="all"?"bg-blue-500 hover:bg-blue-600 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"),"data-testid":"filter-all",children:[e.jsx(ts,{className:"h-3 w-3"}),"الكل",e.jsx("span",{className:"bg-white/20 px-1 rounded text-xs",children:M.total})]}),e.jsxs(K,{variant:r==="unread"?"default":"outline",onClick:()=>a("unread"),size:"sm",className:de("flex-1 gap-1 text-xs h-8",r==="unread"?"bg-orange-500 hover:bg-orange-600 text-white":"border-orange-200 text-orange-700 hover:bg-orange-50"),"data-testid":"filter-unread",children:[e.jsx(d2,{className:"h-3 w-3"}),"جديد",e.jsx("span",{className:"bg-white/20 px-1 rounded text-xs",children:M.unread})]}),e.jsxs(K,{variant:r==="read"?"default":"outline",onClick:()=>a("read"),size:"sm",className:de("flex-1 gap-1 text-xs h-8",r==="read"?"bg-green-500 hover:bg-green-600 text-white":"border-green-200 text-green-700 hover:bg-green-50"),"data-testid":"filter-read",children:[e.jsx(Is,{className:"h-3 w-3"}),"مقروء",e.jsx("span",{className:"bg-white/20 px-1 rounded text-xs",children:M.total-M.unread})]})]}),y.length>0&&e.jsxs("div",{className:"flex gap-1 overflow-x-auto pb-1",children:[e.jsx(K,{variant:n==="all"?"secondary":"ghost",onClick:()=>i("all"),size:"sm",className:"text-xs h-7 px-2 flex-shrink-0",children:"جميع الأنواع"}),Array.isArray(y)&&y.map(T=>e.jsxs(K,{variant:n===T?"secondary":"ghost",onClick:()=>i(T),size:"sm",className:"text-xs gap-1 h-7 px-2 flex-shrink-0",children:[(()=>{const S=Uh[T];return S?e.jsx(S,{className:"h-3 w-3"}):null})(),T==="system"&&"نظام",T==="maintenance"&&"صيانة",T==="warranty"&&"ضمان",T==="damaged"&&"عطل",T==="user-welcome"&&"ترحيب",T==="task"&&"مهام",T==="payment-reminder"&&"تذكير دفع",T==="general-announcement"&&"إعلان عام"]},T))]})]}),e.jsx("div",{className:"space-y-2",children:k.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg border border-blue-100 dark:border-slate-700 text-center",children:[e.jsx(ts,{className:"h-12 w-12 text-blue-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"لا توجد إشعارات"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r==="all"&&"لا توجد إشعارات في النظام حالياً",r==="unread"&&"لا توجد إشعارات غير مقروءة",r==="read"&&"لا توجد إشعارات مقروءة"]})]}):Array.isArray(k)&&k.map(T=>{L3[T.priority];const S=Uh[T.type];return e.jsx("div",{className:de("bg-white dark:bg-slate-800 rounded-xl p-3 border shadow-lg transition-all duration-200 hover:shadow-xl",T.status==="unread"?"border-l-4 border-l-blue-500 bg-blue-50 dark:bg-blue-900/20 border-blue-100 dark:border-blue-800":"border-gray-100 dark:border-slate-700"),"data-testid":`notification-${T.id}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex items-center gap-1 mt-0.5",children:e.jsx("div",{className:de("p-1.5 rounded-lg",O3[T.priority]||"bg-blue-500"),children:S?e.jsx(S,{className:"h-3 w-3 text-white"}):e.jsx(ts,{className:"h-3 w-3 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 flex-1",children:T.title}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[T.status==="unread"&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsxs(Fe,{variant:"outline",className:de("text-xs h-5 px-1.5",T.priority==="critical"&&"bg-red-100 text-red-700 border-red-200",T.priority==="high"&&"bg-orange-100 text-orange-700 border-orange-200",T.priority==="medium"&&"bg-yellow-100 text-yellow-700 border-yellow-200",T.priority==="low"&&"bg-gray-100 text-gray-700 border-gray-200",T.priority==="info"&&"bg-blue-100 text-blue-700 border-blue-200"),children:[T.priority==="info"&&"معلومات",T.priority==="low"&&"منخفض",T.priority==="medium"&&"متوسط",T.priority==="high"&&"عالي",T.priority==="critical"&&"حرج"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(Ls,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(T.createdAt).toLocaleDateString("en-GB",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed mb-2",children:T.message||T.body||"لا يوجد محتوى"}),T.actionRequired&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-1 text-yellow-800 dark:text-yellow-400",children:[e.jsx(Gs,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs font-medium",children:"يتطلب إجراءً"})]})})]}),T.status==="unread"&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>N(T.id),disabled:h.isPending,className:"gap-1 h-7 px-2 flex-shrink-0 text-xs","data-testid":`mark-read-${T.id}`,children:[e.jsx(Is,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"مقروء"}),e.jsx("span",{className:"sm:hidden",children:"✓"})]})]})},T.id)})})]})})}function B3(t,s){if(Array.isArray(t))return t.find(s)}const Xl={1:{label:"معلومات",color:"bg-blue-500"},2:{label:"منخفض",color:"bg-green-500"},3:{label:"متوسط",color:"bg-yellow-500"},4:{label:"عالي",color:"bg-orange-500"},5:{label:"حرج",color:"bg-red-500"}},Zl={system:{label:"نظام",icon:"⚙️"},security:{label:"أمني",icon:"🔒"},error:{label:"خطأ",icon:"❌"},task:{label:"مهمة",icon:"📋"},payroll:{label:"راتب",icon:"💰"},announcement:{label:"إعلان",icon:"📢"},maintenance:{label:"صيانة",icon:"🔧"},warranty:{label:"ضمان",icon:"🛡️"}},q3=t=>{switch(t?.toLowerCase()){case"admin":case"مدير":case"مسؤول":return{icon:x2,label:"مدير",color:"from-red-500 to-red-600",textColor:"text-red-700",bgColor:"bg-red-50",borderColor:"border-red-200"};case"manager":case"مشرف":return{icon:fs,label:"مشرف",color:"from-orange-500 to-orange-600",textColor:"text-orange-700",bgColor:"bg-orange-50",borderColor:"border-orange-200"};case"user":case"مستخدم":case"موظف":default:return{icon:Go,label:"مستخدم",color:"from-blue-500 to-blue-600",textColor:"text-blue-700",bgColor:"bg-blue-50",borderColor:"border-blue-200"}}};function U3(){const{toast:t}=Dt();Gt();const[s,r]=f.useState("overview"),[a,n]=f.useState({type:"",priority:"",limit:50,offset:0}),[i,o]=f.useState(!1),[l,u]=f.useState({title:"",body:"",type:"announcement",priority:3,recipients:"all",specificUserId:"",projectId:""}),{data:d,isLoading:c,refetch:m}=Se({queryKey:["admin-notifications",a],queryFn:async()=>{const N=new URLSearchParams({requesterId:"admin",limit:a.limit.toString(),offset:a.offset.toString(),...a.type&&{type:a.type},...a.priority&&{priority:a.priority}}),T=await fetch(`/api/admin/notifications/all?${N}`);if(!T.ok)throw new Error("فشل في جلب الإشعارات");return T.json()}}),{data:h,isLoading:x}=Se({queryKey:["user-activity"],queryFn:async()=>{const N=await fetch("/api/admin/notifications/user-activity?requesterId=admin");if(!N.ok)throw new Error("فشل في جلب نشاط المستخدمين");return N.json()}}),{data:p=[],isLoading:k}=Se({queryKey:["/api/users","with-roles"],queryFn:async()=>{const N=await fetch("/api/users?includeRole=true");if(!N.ok)throw new Error("فشل في جلب المستخدمين");return N.json()}}),g=Ae({mutationFn:async N=>{const T={...N,requesterId:"admin",recipients:N.recipients==="specific"&&N.specificUserId?[N.specificUserId]:N.recipients},S=await fetch("/api/admin/notifications/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)});if(!S.ok)throw new Error("فشل في إرسال الإشعار");return S.json()},onSuccess:()=>{t({title:"تم إرسال الإشعار بنجاح",variant:"default"}),o(!1),u({title:"",body:"",type:"announcement",priority:3,recipients:"all",specificUserId:"",projectId:""}),m()},onError:()=>{t({title:"خطأ في إرسال الإشعار",variant:"destructive"})}}),b=Ae({mutationFn:async N=>{const T=await fetch(`/api/admin/notifications/${N}?requesterId=admin`,{method:"DELETE"});if(!T.ok)throw new Error("فشل في حذف الإشعار");return T.json()},onSuccess:()=>{t({title:"تم حذف الإشعار بنجاح",variant:"default"}),m()},onError:()=>{t({title:"خطأ في حذف الإشعار",variant:"destructive"})}});Ae({mutationFn:async({notificationId:N,userId:T,isRead:S})=>{const I=await fetch(`/api/admin/notifications/${N}/user/${T}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isRead:S,requesterId:"admin"})});if(!I.ok)throw new Error("فشل في تحديث الحالة");return I.json()},onSuccess:()=>{t({title:"تم تحديث الحالة بنجاح",variant:"default"}),m()},onError:()=>{t({title:"خطأ في تحديث الحالة",variant:"destructive"})}});const j=N=>B3(h?.userStats,S=>S.userId===N)?.userName||N.slice(0,8)+"...",y=({notification:N})=>{const T=Zl[N.type]||{label:N.type,icon:"📄"},S=Xl[N.priority]||{label:"غير محدد",color:"bg-gray-500"},I=Math.round(N.totalReads/N.totalUsers*100)||0;return e.jsx(ee,{className:"group mb-2 hover:shadow-lg transition-all duration-300 ease-in-out border border-gray-100 hover:border-blue-200 bg-gradient-to-br from-white to-gray-50/30",children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-xl flex items-center justify-center ${S.color} shadow-sm flex-shrink-0`,children:e.jsx("span",{className:"text-sm",children:T.icon})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm truncate mb-0.5",children:N.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(Fe,{variant:"outline",className:"text-xs px-1.5 py-0.5 bg-gray-50",children:T.label}),e.jsx(Fe,{className:`${S.color} text-white text-xs px-1.5 py-0.5`,children:S.label})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(K,{size:"sm",variant:"ghost",onClick:()=>b.mutate(N.id),className:"h-7 w-7 p-0 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(g2,{className:"h-3.5 w-3.5"})})})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3 leading-relaxed",children:N.body}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Ls,{className:"h-3 w-3"}),new Date(N.createdAt).toLocaleString("ar",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("span",{className:"flex items-center gap-1 text-gray-600 font-medium",children:[e.jsx(Zt,{className:"h-3 w-3"}),N.totalReads,"/",N.totalUsers," (",I,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${I>=80?"bg-green-500":I>=60?"bg-blue-500":I>=40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${I}%`}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),"حالة المستخدمين:"]}),e.jsxs("div",{className:"max-h-20 overflow-y-auto space-y-1",children:[N.readStates.slice(0,3).map(E=>e.jsxs("div",{className:"flex items-center justify-between py-1 px-2 bg-white rounded border",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs text-white ${h?.userStats?.find(z=>z.userId===E.userId)?.userRole==="admin"?"bg-gradient-to-r from-red-500 to-red-600":"bg-gradient-to-r from-blue-500 to-blue-600"}`,children:j(E.userId).charAt(0).toUpperCase()}),e.jsx("span",{className:"text-xs font-medium truncate",children:j(E.userId)})]}),e.jsx("div",{className:"flex items-center gap-1",children:E.isRead?e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}):e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full"})})]},E.userId)),N.readStates.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center py-1",children:["+",N.readStates.length-3," مستخدم آخر"]})]})]})]})})},M=({activity:N})=>{const T=S=>S>=80?"from-green-500 to-green-600":S>=60?"from-blue-500 to-blue-600":S>=40?"from-yellow-500 to-yellow-600":"from-red-500 to-red-600";return e.jsx(ee,{className:"group mb-2 hover:shadow-md transition-all duration-300 border border-gray-100 hover:border-blue-200 bg-gradient-to-r from-white to-gray-50/50",children:e.jsx(oe,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-9 h-9 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm ${N.userRole==="admin"?"bg-gradient-to-r from-red-500 to-red-600":"bg-gradient-to-r from-blue-500 to-blue-600"}`,children:N.userRole==="admin"?e.jsx(fs,{className:"h-4 w-4 text-white"}):e.jsx(Hs,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900 truncate",children:N.userName}),e.jsx(Fe,{variant:N.userRole==="admin"?"destructive":"secondary",className:"text-xs px-1.5 py-0.5",children:N.userRole==="admin"?"مسؤول":"مستخدم"})]}),e.jsx("div",{className:"text-xs text-gray-500 truncate mb-1",children:N.userEmail}),e.jsxs("div",{className:"text-xs text-gray-400",children:["آخر نشاط: ",N.lastActivity?new Date(N.lastActivity).toLocaleString("ar",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"لا يوجد"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:N.totalNotifications}),e.jsx(ts,{className:"h-3 w-3 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-xs font-medium text-green-600",children:N.readNotifications}),e.jsx("div",{className:"text-xs text-gray-400",children:"/"}),e.jsx("div",{className:"text-xs text-gray-500",children:N.unreadNotifications})]}),e.jsxs("div",{className:`text-xs font-bold bg-gradient-to-r ${T(N.readPercentage)} bg-clip-text text-transparent`,children:[N.readPercentage,"%"]})]})]})})})};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/40",dir:"rtl",children:e.jsx("div",{className:"container mx-auto p-3 sm:p-6 max-w-7xl",children:e.jsxs(Vi,{value:s,onValueChange:r,className:"w-full",children:[e.jsx("div",{className:"bg-white rounded-2xl p-2 shadow-lg border border-gray-100 mb-12",children:e.jsxs(jn,{className:"grid w-full grid-cols-2 sm:grid-cols-4 gap-2 bg-gray-50 p-1 rounded-xl",children:[e.jsxs(hs,{value:"overview",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(bs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"لوحة التحكم"}),e.jsx("span",{className:"sm:hidden font-medium",children:"عامة"})]}),e.jsxs(hs,{value:"notifications",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(ts,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"الإشعارات"}),e.jsx("span",{className:"sm:hidden font-medium",children:"إشعارات"})]}),e.jsxs(hs,{value:"users",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"المستخدمين"}),e.jsx("span",{className:"sm:hidden font-medium",children:"مستخدمين"})]}),e.jsxs(hs,{value:"create",className:"flex items-center gap-2 text-sm p-3 rounded-lg transition-all duration-200 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(Yn,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"إرسال جديد"}),e.jsx("span",{className:"sm:hidden font-medium",children:"إرسال"})]})]})}),e.jsxs(ls,{value:"overview",className:"space-y-12 mt-12",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(ee,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200 hover:shadow-lg transition-all duration-300",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-600 mb-1",children:"إجمالي الإشعارات"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:d?.total||0})]}),e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(ts,{className:"h-5 w-5 text-white"})})]})})}),e.jsx(ee,{className:"bg-gradient-to-r from-green-50 to-green-100 border-green-200 hover:shadow-lg transition-all duration-300",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600 mb-1",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:h?.userStats?.length||0})]}),e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center",children:e.jsx(Zt,{className:"h-5 w-5 text-white"})})]})})}),e.jsx(ee,{className:"bg-gradient-to-r from-amber-50 to-amber-100 border-amber-200 hover:shadow-lg transition-all duration-300",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-600 mb-1",children:"معدل القراءة"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-700",children:[h?.userStats?.length>0?Math.round(h.userStats.reduce((N,T)=>N+T.readPercentage,0)/h.userStats.length):0,"%"]})]}),e.jsx("div",{className:"w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center",children:e.jsx(g0,{className:"h-5 w-5 text-white"})})]})})}),e.jsx(ee,{className:"bg-gradient-to-r from-red-50 to-red-100 border-red-200 hover:shadow-lg transition-all duration-300",children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-red-600 mb-1",children:"الإشعارات الحرجة"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:d?.notifications?.filter(N=>N.priority===5).length||0})]}),e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-xl flex items-center justify-center",children:e.jsx(Gs,{className:"h-5 w-5 text-white"})})]})})})]}),e.jsxs(ee,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl min-h-[600px]",children:[e.jsx(He,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs(et,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ms,{className:"h-5 w-5 text-blue-600"}),"آخر النشاطات"]})}),e.jsx(oe,{className:"p-4",children:e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:h?.userStats?.slice(0,5).map(N=>e.jsx(M,{activity:N},N.userId))})})]})]}),e.jsxs(ls,{value:"notifications",className:"space-y-10 mt-12",children:[e.jsxs(ee,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl",children:[e.jsx(He,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(et,{className:"text-lg font-semibold",children:"فلترة الإشعارات"}),e.jsxs(K,{onClick:()=>m(),disabled:c,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(hr,{className:"h-4 w-4 mr-1"}),"تحديث"]})]})}),e.jsx(oe,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(We,{value:a.type||"all",onValueChange:N=>n(T=>({...T,type:N==="all"?"":N})),children:[e.jsx(ze,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ke,{placeholder:"نوع الإشعار"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الأنواع"}),Object.entries(Zl).map(([N,T])=>e.jsxs(W,{value:N,children:[T.icon," ",T.label]},N))]})]}),e.jsxs(We,{value:a.priority||"all",onValueChange:N=>n(T=>({...T,priority:N==="all"?"":N})),children:[e.jsx(ze,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ke,{placeholder:"الأولوية"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الأولويات"}),Object.entries(Xl).map(([N,T])=>e.jsx(W,{value:N,children:T.label},N))]})]}),e.jsx(je,{type:"number",placeholder:"عدد النتائج",value:a.limit,onChange:N=>n(T=>({...T,limit:parseInt(N.target.value)||50})),className:"border-gray-300 focus:border-blue-500"})]})})]}),e.jsx("div",{className:"space-y-2 min-h-[500px]",children:c?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري التحميل..."})]}):d?.notifications?.length>0?d.notifications.map(N=>e.jsx(y,{notification:N},N.id)):e.jsx(ee,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl",children:e.jsxs(oe,{className:"text-center py-12",children:[e.jsx(ts,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"لا توجد إشعارات"})]})})})]}),e.jsx(ls,{value:"users",className:"space-y-10 mt-12",children:e.jsxs(ee,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl min-h-[700px]",children:[e.jsx(He,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs(et,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Zt,{className:"h-5 w-5 text-blue-600"}),"نشاط المستخدمين مع الإشعارات"]})}),e.jsx(oe,{className:"p-4",children:x?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري التحميل..."})]}):h?.userStats?.length>0?e.jsx("div",{className:"space-y-2 max-h-[700px] min-h-[500px] overflow-y-auto",children:h.userStats.map(N=>e.jsx(M,{activity:N},N.userId))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Zt,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد نشاط للمستخدمين"})]})})]})}),e.jsx(ls,{value:"create",className:"space-y-10 mt-12",children:e.jsxs(ee,{className:"bg-white border border-gray-200 shadow-lg rounded-2xl min-h-[600px]",children:[e.jsx(He,{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs(et,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Yn,{className:"h-5 w-5 text-blue-600"}),"إنشاء إشعار جديد"]})}),e.jsxs(oe,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"نوع الإشعار"}),e.jsxs(We,{value:l.type,onValueChange:N=>u(T=>({...T,type:N})),children:[e.jsx(ze,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ke,{})}),e.jsx(Be,{children:Object.entries(Zl).map(([N,T])=>e.jsx(W,{value:N,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T.icon}),e.jsx("span",{children:T.label})]})},N))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"مستوى الأولوية"}),e.jsxs(We,{value:l.priority.toString(),onValueChange:N=>u(T=>({...T,priority:parseInt(N)})),children:[e.jsx(ze,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ke,{})}),e.jsx(Be,{children:Object.entries(Xl).map(([N,T])=>e.jsx(W,{value:N,children:e.jsx("div",{className:`flex items-center gap-2 font-medium ${N==="5"?"text-red-600":N==="4"?"text-orange-600":N==="3"?"text-yellow-600":N==="2"?"text-green-600":"text-blue-600"}`,children:T.label})},N))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx(je,{value:l.title,onChange:N=>u(T=>({...T,title:N.target.value})),placeholder:"أدخل عنوان الإشعار",className:"border-gray-300 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"المستقبلين"}),e.jsxs(We,{value:l.recipients,onValueChange:N=>u(T=>({...T,recipients:N})),children:[e.jsx(ze,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-4 w-4"}),"جميع المستخدمين"]})}),e.jsx(W,{value:"admins",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-4 w-4"}),"المسؤولين فقط"]})}),e.jsx(W,{value:"users",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),"المستخدمين العاديين فقط"]})}),e.jsx(W,{value:"specific",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4 text-purple-600"}),"مستخدم محدد"]})})]})]})]}),l.recipients==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"اختر المستخدم"}),e.jsxs(We,{value:l.specificUserId,onValueChange:N=>u(T=>({...T,specificUserId:N})),children:[e.jsx(ze,{className:"border-gray-300 focus:border-blue-500",children:e.jsx(Ke,{placeholder:"اختر المستخدم المحدد..."})}),e.jsx(Be,{className:"max-h-48",children:k?e.jsxs("div",{className:"p-3 text-center text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mx-auto"}),e.jsx("span",{className:"text-sm mt-2",children:"جاري التحميل..."})]}):p.length>0?p.map(N=>{const T=q3(N.role),S=T.icon,I=N.firstName&&N.lastName?`${N.firstName} ${N.lastName}`:N.name||"بدون اسم";return e.jsx(W,{value:N.id,className:"p-3 rounded-lg hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg bg-gradient-to-r ${T.color} flex items-center justify-center shadow-sm`,children:e.jsx(S,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 truncate text-sm",children:I}),e.jsx("div",{className:`px-2 py-0.5 rounded-full ${T.bgColor} ${T.borderColor} border`,children:e.jsx("span",{className:`text-xs font-semibold ${T.textColor}`,children:T.label})})]}),e.jsx("span",{className:"text-xs text-gray-500 truncate",children:N.email})]})]})},N.id)}):e.jsx("div",{className:"p-3 text-center text-gray-500",children:e.jsx("span",{className:"text-sm",children:"لا توجد مستخدمون متاحون"})})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"محتوى الإشعار"}),e.jsx(Fa,{value:l.body,onChange:N=>u(T=>({...T,body:N.target.value})),placeholder:"أدخل محتوى الإشعار التفصيلي...",rows:4,className:"border-gray-300 focus:border-blue-500 resize-none"})]}),e.jsx(K,{onClick:()=>g.mutate(l),disabled:!l.title||!l.body||l.recipients==="specific"&&!l.specificUserId||g.isPending,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 h-12 text-base font-semibold shadow-lg hover:shadow-xl transition-all duration-200",children:g.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"جاري الإرسال..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ec,{className:"h-5 w-5"}),"إرسال الإشعار"]})})]})]})})]})})})}const W3=()=>{const[t,s]=f.useState(null),[r,a]=f.useState(!0),[n,i]=f.useState(null),[o,l]=f.useState(!1),[u,d]=f.useState({alertsEnabled:!0,autoResolveEnabled:!1,criticalNotifications:!0,emailNotifications:!0,smsNotifications:!1,notificationCooldown:"60",errorRetention:"30",autoBackupEnabled:!0,debugMode:!1}),{toast:c}=Dt(),m=async()=>{try{const j=await(await fetch("/api/smart-errors/statistics")).json();j.success?s(j.statistics):c({title:"خطأ في جلب البيانات",description:j.message,variant:"destructive"})}catch(b){console.error("خطأ في جلب الإحصائيات:",b),c({title:"خطأ في الشبكة",description:"لا يمكن جلب إحصائيات الأخطاء حالياً",variant:"destructive"})}finally{a(!1)}},h=async()=>{l(!0);try{const j=await(await fetch("/api/smart-errors/test",{method:"POST",headers:{"Content-Type":"application/json"}})).json();j.success?(i(j.testError),c({title:"نجح الاختبار! 🎯",description:j.message,variant:"default"}),setTimeout(m,1e3)):c({title:"خطأ في الاختبار",description:j.message,variant:"destructive"})}catch(b){console.error("خطأ في اختبار النظام:",b),c({title:"خطأ في الاختبار",description:"حدث خطأ أثناء اختبار النظام الذكي",variant:"destructive"})}finally{l(!1)}};f.useEffect(()=>{m()},[]);const x=b=>{switch(b){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},p=b=>{switch(b){case"critical":return e.jsx(Gs,{className:"h-4 w-4"});case"high":return e.jsx(cs,{className:"h-4 w-4"});case"medium":return e.jsx(wa,{className:"h-4 w-4"});case"low":return e.jsx(Ln,{className:"h-4 w-4"});default:return e.jsx(wa,{className:"h-4 w-4"})}};if(r)return e.jsx("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(hr,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("span",{className:"mr-3 text-lg",children:"جاري تحميل إحصائيات الأخطاء..."})]})});const k=t?Math.max(0,100-t.totalErrors*2-t.recentErrors*5):0,g=async()=>{try{c({title:"تم حفظ الإعدادات",description:"تم تطبيق الإعدادات الجديدة بنجاح",variant:"default"})}catch{c({title:"خطأ في حفظ الإعدادات",description:"لم يتم حفظ الإعدادات، يرجى المحاولة مرة أخرى",variant:"destructive"})}};return e.jsxs("div",{className:"container mx-auto p-2 sm:p-4 space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-between items-stretch sm:items-center",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(K,{onClick:m,variant:"outline",size:"sm",disabled:r,className:"flex-1 sm:flex-none",children:[e.jsx(hr,{className:`h-4 w-4 ml-1 ${r?"animate-spin":""}`}),"تحديث"]}),e.jsxs(K,{onClick:h,variant:"outline",size:"sm",disabled:o,className:"flex-1 sm:flex-none",children:[e.jsx(M2,{className:`h-4 w-4 ml-1 ${o?"animate-pulse":""}`}),"اختبار النظام"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded-lg",children:[e.jsx(Ms,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"النظام نشط"})]})]}),n&&e.jsxs(da,{className:"border-green-200 bg-green-50",children:[e.jsx(Ln,{className:"h-4 w-4 text-green-600"}),e.jsxs(ua,{className:"text-green-800",children:[e.jsx("strong",{children:"تم اختبار النظام بنجاح!"}),e.jsx("br",{}),"نوع الخطأ: ",n.type," | الشدة: ",n.severity,e.jsx("br",{}),"الرسالة: ",n.friendlyMessage,e.jsx("br",{}),"البصمة: ",n.fingerprint,"..."]})]}),e.jsxs(Vi,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(jn,{className:"grid w-full grid-cols-3",children:[e.jsx(hs,{value:"overview",children:"نظرة عامة"}),e.jsx(hs,{value:"analysis",children:"التحليل المتقدم"}),e.jsx(hs,{value:"settings",children:"الإعدادات"})]}),e.jsxs(ls,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(ee,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold",children:t?.totalErrors||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"إجمالي الأخطاء"})]}),e.jsx(Qn,{className:"h-5 w-5 text-blue-500"})]})}),e.jsx(ee,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:t?.recentErrors||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"أخطاء حديثة"})]}),e.jsx(Ls,{className:"h-5 w-5 text-orange-500"})]})}),e.jsx(ee,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:t?.resolvedErrors||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"تم حلها"})]}),e.jsx(Ln,{className:"h-5 w-5 text-green-500"})]})}),e.jsxs(ee,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`text-lg font-bold ${k>=90?"text-green-600":k>=70?"text-yellow-600":"text-red-600"}`,children:[k.toFixed(0),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"صحة النظام"})]}),e.jsx(bs,{className:`h-5 w-5 ${k>=90?"text-green-500":k>=70?"text-yellow-500":"text-red-500"}`})]}),e.jsx(Ro,{value:k,className:"mt-2 h-1"})]})]}),e.jsxs(ee,{children:[e.jsxs(He,{children:[e.jsxs(et,{className:"flex items-center gap-2",children:[e.jsx(g0,{className:"h-5 w-5"}),"توزيع الأخطاء حسب الشدة"]}),e.jsx(br,{children:"تصنيف الأخطاء حسب مستوى الخطورة"})]}),e.jsx(oe,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(t?.errorsBySeverity||{}).map(([b,j])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(Fe,{variant:"secondary",className:`${x(b)} px-3 py-1`,children:[p(b),e.jsx("span",{className:"mr-2",children:b==="critical"?"حرج":b==="high"?"عالي":b==="medium"?"متوسط":"منخفض"})]})}),e.jsx("span",{className:"font-semibold text-lg",children:j})]},b))})})]}),e.jsxs(ee,{children:[e.jsxs(He,{children:[e.jsxs(et,{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"h-5 w-5"}),"أكثر الجداول تأثراً بالأخطاء"]}),e.jsx(br,{children:"الجداول التي تسجل أعلى نسبة أخطاء"})]}),e.jsx(oe,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(t?.errorsByTable||{}).slice(0,10).map(([b,j])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:b}),e.jsxs(Fe,{variant:"outline",children:[j," خطأ"]})]},b))})})]})]}),e.jsxs(ls,{value:"analysis",className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsx(He,{className:"pb-3",children:e.jsxs(et,{className:"flex items-center gap-2 text-base",children:[e.jsx(u2,{className:"h-5 w-5"}),"تحليل الاتجاهات الزمنية"]})}),e.jsx(oe,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(bs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"الاتجاه الحالي"})]}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:t?.recentErrors===0?"مستقر":"تحتاج متابعة"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"بناءً على البيانات الحديثة"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(fs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"مستوى الأمان"})]}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:k>=90?"ممتاز":k>=70?"جيد":"يحتاج تحسين"}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"تقييم عام للنظام"})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Wr,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"المراقبة"})]}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:"نشطة"}),e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"رصد مستمر 24/7"})]})]})})]}),e.jsxs(ee,{children:[e.jsx(He,{className:"pb-3",children:e.jsxs(et,{className:"flex items-center gap-2 text-base",children:[e.jsx(h2,{className:"h-5 w-5"}),"تفصيل أنواع الأخطاء"]})}),e.jsx(oe,{children:Object.keys(t?.errorsByType||{}).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(t?.errorsByType||{}).map(([b,j])=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium",children:b}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(100,j/Math.max(1,t?.totalErrors||1)*100)}%`}})}),e.jsx(Fe,{variant:"secondary",children:j})]})]},b))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ta,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"لا توجد أخطاء مسجلة للتحليل"}),e.jsx("p",{className:"text-xs mt-1",children:'استخدم زر "اختبار النظام" لإنشاء بيانات تجريبية'})]})})]}),e.jsxs(ee,{children:[e.jsx(He,{className:"pb-3",children:e.jsxs(et,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ms,{className:"h-5 w-5"}),"مؤشرات الأداء الرئيسية"]})}),e.jsx(oe,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"99.9%"}),e.jsx("div",{className:"text-sm text-gray-600",children:"وقت التشغيل"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"< 1s"}),e.jsx("div",{className:"text-sm text-gray-600",children:"زمن الاستجابة"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"24/7"}),e.jsx("div",{className:"text-sm text-gray-600",children:"المراقبة"})]})]})})]})]}),e.jsxs(ls,{value:"settings",className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsx(He,{className:"pb-3",children:e.jsxs(et,{className:"flex items-center gap-2 text-base",children:[e.jsx(ts,{className:"h-5 w-5"}),"إعدادات الإشعارات"]})}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"تفعيل التنبيهات"}),e.jsx("p",{className:"text-xs text-gray-500",children:"استقبال إشعارات فورية"})]}),e.jsx($r,{checked:u.alertsEnabled,onCheckedChange:b=>d(j=>({...j,alertsEnabled:b}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"إشعارات الأخطاء الحرجة"}),e.jsx("p",{className:"text-xs text-gray-500",children:"تنبيهات فورية للأخطاء الحرجة"})]}),e.jsx($r,{checked:u.criticalNotifications,onCheckedChange:b=>d(j=>({...j,criticalNotifications:b}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"إشعارات البريد الإلكتروني"}),e.jsx("p",{className:"text-xs text-gray-500",children:"إرسال تقارير عبر البريد"})]}),e.jsx($r,{checked:u.emailNotifications,onCheckedChange:b=>d(j=>({...j,emailNotifications:b}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"إشعارات الرسائل النصية"}),e.jsx("p",{className:"text-xs text-gray-500",children:"تنبيهات SMS للأخطاء الحرجة"})]}),e.jsx($r,{checked:u.smsNotifications,onCheckedChange:b=>d(j=>({...j,smsNotifications:b}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium mb-2 block",children:"فترة التهدئة للإشعارات (ثانية)"}),e.jsxs(We,{value:u.notificationCooldown,onValueChange:b=>d(j=>({...j,notificationCooldown:b})),children:[e.jsx(ze,{children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"30",children:"30 ثانية"}),e.jsx(W,{value:"60",children:"دقيقة واحدة"}),e.jsx(W,{value:"300",children:"5 دقائق"}),e.jsx(W,{value:"600",children:"10 دقائق"}),e.jsx(W,{value:"1800",children:"30 دقيقة"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium mb-2 block",children:"مدة الاحتفاظ بالأخطاء (يوم)"}),e.jsxs(We,{value:u.errorRetention,onValueChange:b=>d(j=>({...j,errorRetention:b})),children:[e.jsx(ze,{children:e.jsx(Ke,{})}),e.jsxs(Be,{children:[e.jsx(W,{value:"7",children:"7 أيام"}),e.jsx(W,{value:"30",children:"30 يوم"}),e.jsx(W,{value:"90",children:"90 يوم"}),e.jsx(W,{value:"180",children:"6 شهور"}),e.jsx(W,{value:"365",children:"سنة واحدة"})]})]})]})]})]})]}),e.jsxs(ee,{children:[e.jsx(He,{className:"pb-3",children:e.jsxs(et,{className:"flex items-center gap-2 text-base",children:[e.jsx(gr,{className:"h-5 w-5"}),"إعدادات النظام"]})}),e.jsx(oe,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"الحل التلقائي للأخطاء"}),e.jsx("p",{className:"text-xs text-gray-500",children:"حل الأخطاء البسيطة تلقائياً"})]}),e.jsx($r,{checked:u.autoResolveEnabled,onCheckedChange:b=>d(j=>({...j,autoResolveEnabled:b}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"النسخ الاحتياطي التلقائي"}),e.jsx("p",{className:"text-xs text-gray-500",children:"إنشاء نسخ احتياطية دورية"})]}),e.jsx($r,{checked:u.autoBackupEnabled,onCheckedChange:b=>d(j=>({...j,autoBackupEnabled:b}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-sm font-medium",children:"وضع التطوير"}),e.jsx("p",{className:"text-xs text-gray-500",children:"معلومات تفصيلية للمطورين"})]}),e.jsx($r,{checked:u.debugMode,onCheckedChange:b=>d(j=>({...j,debugMode:b}))})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-end",children:[e.jsxs(K,{onClick:g,className:"flex items-center gap-2",children:[e.jsx(Yn,{className:"h-4 w-4"}),"حفظ الإعدادات"]}),e.jsx(K,{onClick:()=>d({alertsEnabled:!0,autoResolveEnabled:!1,criticalNotifications:!0,emailNotifications:!0,smsNotifications:!1,notificationCooldown:"60",errorRetention:"30",autoBackupEnabled:!0,debugMode:!1}),variant:"outline",children:"إعادة تعيين"})]}),e.jsxs(ee,{children:[e.jsx(He,{className:"pb-3",children:e.jsxs(et,{className:"flex items-center gap-2 text-base",children:[e.jsx(wa,{className:"h-5 w-5"}),"معلومات النظام"]})}),e.jsx(oe,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"الإصدار"}),e.jsx("div",{className:"font-medium",children:"v2.1.0"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"آخر تحديث"}),e.jsx("div",{className:"font-medium",children:"اليوم"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"وقت التشغيل"}),e.jsx("div",{className:"font-medium",children:"24/7"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"الحالة"}),e.jsx("div",{className:"font-medium text-green-600",children:"نشط"})]})]})})]})]})]})]})};function K3(){const[t,s]=f.useState("policies"),[r,a]=f.useState(""),[n,i]=f.useState("all"),[o,l]=f.useState("all"),[u,d]=f.useState("all"),{data:c=[],isLoading:m,refetch:h}=Se({queryKey:["/api/security-policies",n,o,u],queryFn:async()=>{const E=new URLSearchParams;n!=="all"&&E.append("status",n),o!=="all"&&E.append("category",o),u!=="all"&&E.append("severity",u);const z=await fetch(`/api/security-policies?${E}`);if(!z.ok)throw new Error("فشل في جلب السياسات الأمنية");return z.json()}}),{data:x=[],isLoading:p,refetch:k}=Se({queryKey:["/api/security-policy-suggestions"],queryFn:async()=>{const E=await fetch("/api/security-policy-suggestions");if(!E.ok)throw new Error("فشل في جلب اقتراحات السياسات");return E.json()}}),{data:g=[],isLoading:b,refetch:j}=Se({queryKey:["/api/security-policy-violations"],queryFn:async()=>{const E=await fetch("/api/security-policy-violations");if(!E.ok)throw new Error("فشل في جلب انتهاكات السياسات");return E.json()}}),y=async()=>{try{const E=await fetch("/api/security-policies/generate-smart-suggestions",{method:"POST",headers:{"Content-Type":"application/json"}});if(!E.ok)throw new Error("فشل في إنشاء الاقتراحات الذكية");const z=await E.json();alert(`✅ تم إنشاء ${z.count} اقتراح ذكي للسياسات الأمنية`),k()}catch(E){console.error("خطأ في إنشاء الاقتراحات الذكية:",E),alert("❌ حدث خطأ في إنشاء الاقتراحات الذكية")}},M=async E=>{try{const z=await fetch(`/api/security-policy-suggestions/${E}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reviewerId:"current-user"})});if(!z.ok)throw new Error("فشل في الموافقة على الاقتراح");const w=await z.json();alert(`✅ تم تحويل الاقتراح إلى سياسة فعالة: ${w.policy.title}`),k(),h()}catch(z){console.error("خطأ في الموافقة على الاقتراح:",z),alert("❌ حدث خطأ في الموافقة على الاقتراح")}},N=E=>{switch(E){case"critical":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"low":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},T=E=>{switch(E){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"inactive":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200";case"draft":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"implemented":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},S=Array.isArray(c)?c.filter(E=>E.title.toLowerCase().includes(r.toLowerCase())||E.description.toLowerCase().includes(r.toLowerCase())):[],I={totalPolicies:Array.isArray(c)?c.length:0,activePolicies:Array.isArray(c)?c.filter(E=>E.status==="active").length:0,criticalViolations:Array.isArray(g)?g.filter(E=>E.violation.severity==="critical").length:0,pendingSuggestions:Array.isArray(x)?x.filter(E=>E.status==="pending").length:0};return e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"🔐 السياسات الأمنية المتقدمة"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"إدارة شاملة للسياسات الأمنية والاقتراحات والانتهاكات"})]}),e.jsxs(K,{onClick:y,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(bs,{className:"w-4 h-4 ml-2"}),"إنشاء اقتراحات ذكية"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ee,{children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"إجمالي السياسات"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:I.totalPolicies})]}),e.jsx(fs,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(ee,{children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"السياسات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:I.activePolicies})]}),e.jsx(Zt,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(ee,{children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"انتهاكات حرجة"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:I.criticalViolations})]}),e.jsx(Gs,{className:"w-8 h-8 text-red-600"})]})})}),e.jsx(ee,{children:e.jsx(oe,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"اقتراحات معلقة"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:I.pendingSuggestions})]}),e.jsx(bs,{className:"w-8 h-8 text-orange-600"})]})})})]}),e.jsxs(Vi,{value:t,onValueChange:s,className:"w-full",children:[e.jsxs(jn,{className:"grid w-full grid-cols-3",children:[e.jsx(hs,{value:"policies",children:"السياسات الأمنية"}),e.jsx(hs,{value:"suggestions",children:"الاقتراحات"}),e.jsx(hs,{value:"violations",children:"الانتهاكات"})]}),e.jsxs(ls,{value:"policies",className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsx(He,{children:e.jsxs(et,{className:"flex items-center",children:[e.jsx(Kr,{className:"w-5 h-5 ml-2"}),"البحث والفلترة"]})}),e.jsx(oe,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(re,{htmlFor:"search",children:"البحث"}),e.jsx(je,{id:"search",placeholder:"ابحث في السياسات...",value:r,onChange:E=>a(E.target.value)})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"status-filter",children:"الحالة"}),e.jsxs(We,{value:n,onValueChange:i,children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر الحالة"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الحالات"}),e.jsx(W,{value:"active",children:"نشط"}),e.jsx(W,{value:"inactive",children:"غير نشط"}),e.jsx(W,{value:"draft",children:"مسودة"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"category-filter",children:"الفئة"}),e.jsxs(We,{value:o,onValueChange:l,children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر الفئة"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع الفئات"}),e.jsx(W,{value:"authentication",children:"المصادقة"}),e.jsx(W,{value:"access_control",children:"التحكم بالوصول"}),e.jsx(W,{value:"data_protection",children:"حماية البيانات"}),e.jsx(W,{value:"network_security",children:"أمان الشبكة"})]})]})]}),e.jsxs("div",{children:[e.jsx(re,{htmlFor:"severity-filter",children:"الأهمية"}),e.jsxs(We,{value:u,onValueChange:d,children:[e.jsx(ze,{children:e.jsx(Ke,{placeholder:"اختر الأهمية"})}),e.jsxs(Be,{children:[e.jsx(W,{value:"all",children:"جميع المستويات"}),e.jsx(W,{value:"critical",children:"حرج"}),e.jsx(W,{value:"high",children:"عالي"}),e.jsx(W,{value:"medium",children:"متوسط"}),e.jsx(W,{value:"low",children:"منخفض"})]})]})]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:m?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"جاري تحميل السياسات..."})]}):Array.isArray(S)&&S.length>0?S.map(E=>e.jsxs(ee,{className:"hover:shadow-md transition-shadow",children:[e.jsx(He,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(et,{className:"text-lg",children:E.title}),e.jsx("p",{className:"text-sm text-gray-500 font-mono",children:E.policyId})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Fe,{className:N(E.severity),children:E.severity==="critical"?"حرج":E.severity==="high"?"عالي":E.severity==="medium"?"متوسط":"منخفض"}),e.jsx(Fe,{className:T(E.status),children:E.status==="active"?"نشط":E.status==="inactive"?"غير نشط":"مسودة"})]})]})}),e.jsxs(oe,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2",children:E.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-gray-500",children:["الفئة: ",e.jsx("span",{className:"font-medium",children:E.category})]}),e.jsxs("p",{className:"text-gray-500",children:["الانتهاكات: ",e.jsx("span",{className:"font-medium text-red-600",children:E.violationsCount})]})]}),e.jsxs("div",{className:"text-left space-y-1",children:[e.jsxs("p",{className:"text-gray-500",children:["تم الإنشاء: ",new Date(E.createdAt).toLocaleDateString("ar")]}),E.lastViolation&&e.jsxs("p",{className:"text-red-500 text-xs",children:["آخر انتهاك: ",new Date(E.lastViolation).toLocaleDateString("ar")]})]})]})]})]},E.id)):e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(fs,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لا توجد سياسات أمنية"})]})})]}),e.jsx(ls,{value:"suggestions",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:p?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"جاري تحميل الاقتراحات..."})]}):Array.isArray(x)&&x.length>0?x.map(E=>e.jsxs(ee,{className:"hover:shadow-md transition-shadow",children:[e.jsx(He,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(et,{className:"text-lg",children:E.title}),e.jsx("p",{className:"text-sm text-gray-500 font-mono",children:E.suggestedPolicyId})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Fe,{className:N(E.priority),children:E.priority==="critical"?"حرج":E.priority==="high"?"عالي":E.priority==="medium"?"متوسط":"منخفض"}),e.jsx(Fe,{className:T(E.status),children:E.status==="pending"?"معلق":E.status==="approved"?"موافق عليه":E.status==="rejected"?"مرفوض":"منفذ"})]})]})}),e.jsxs(oe,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2",children:E.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["الفئة: ",e.jsx("span",{className:"font-medium",children:E.category})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["الثقة: ",e.jsxs("span",{className:"font-medium text-green-600",children:[E.confidence,"%"]})]})]}),E.status==="pending"&&e.jsx(K,{size:"sm",onClick:()=>M(E.id),className:"bg-green-600 hover:bg-green-700",children:"موافقة"})]})]})]},E.id)):e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(bs,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لا توجد اقتراحات"})]})})}),e.jsx(ls,{value:"violations",className:"space-y-4",children:e.jsx("div",{className:"space-y-4",children:b?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"جاري تحميل الانتهاكات..."})]}):Array.isArray(g)&&g.length>0?g.map(E=>e.jsxs(ee,{className:"hover:shadow-md transition-shadow",children:[e.jsx(He,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(et,{className:"text-lg text-red-600 flex items-center",children:[e.jsx(Gs,{className:"w-5 h-5 ml-2"}),E.violation.violatedRule]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["السياسة: ",E.policy?.title||"غير محدد"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Fe,{className:N(E.violation.severity),children:E.violation.severity==="critical"?"حرج":E.violation.severity==="high"?"عالي":E.violation.severity==="medium"?"متوسط":"منخفض"}),e.jsx(Fe,{className:T(E.violation.status),children:E.violation.status})]})]})}),e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500",children:["معرف الانتهاك: ",e.jsx("span",{className:"font-mono",children:E.violation.violationId})]}),e.jsxs("p",{className:"text-gray-500",children:["الفئة: ",e.jsx("span",{className:"font-medium",children:E.policy?.category||"غير محدد"})]})]}),e.jsx("div",{className:"text-left",children:e.jsxs("p",{className:"text-gray-500",children:["وقت الاكتشاف: ",new Date(E.violation.detectedAt).toLocaleString("ar")]})})]})})]},E.violation.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Gs,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لا توجد انتهاكات"})]})})})]})]})}var gl="Popover",[lw]=Os(gl,[pn]),Li=pn(),[G3,ha]=lw(gl),cw=t=>{const{__scopePopover:s,children:r,open:a,defaultOpen:n,onOpenChange:i,modal:o=!1}=t,l=Li(s),u=f.useRef(null),[d,c]=f.useState(!1),[m,h]=Ma({prop:a,defaultProp:n??!1,onChange:i,caller:gl});return e.jsx(r0,{...l,children:e.jsx(G3,{scope:s,contentId:Hn(),triggerRef:u,open:m,onOpenChange:h,onOpenToggle:f.useCallback(()=>h(x=>!x),[h]),hasCustomAnchor:d,onCustomAnchorAdd:f.useCallback(()=>c(!0),[]),onCustomAnchorRemove:f.useCallback(()=>c(!1),[]),modal:o,children:r})})};cw.displayName=gl;var dw="PopoverAnchor",H3=f.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=ha(dw,r),i=Li(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=n;return f.useEffect(()=>(o(),()=>l()),[o,l]),e.jsx(Bo,{...i,...a,ref:s})});H3.displayName=dw;var uw="PopoverTrigger",mw=f.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=ha(uw,r),i=Li(r),o=Pt(s,n.triggerRef),l=e.jsx(xt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":gw(n.open),...a,ref:o,onClick:Te(t.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:e.jsx(Bo,{asChild:!0,...i,children:l})});mw.displayName=uw;var iu="PopoverPortal",[Q3,X3]=lw(iu,{forceMount:void 0}),hw=t=>{const{__scopePopover:s,forceMount:r,children:a,container:n}=t,i=ha(iu,s);return e.jsx(Q3,{scope:s,forceMount:r,children:e.jsx(Cs,{present:r||i.open,children:e.jsx(Zg,{asChild:!0,container:n,children:a})})})};hw.displayName=iu;var hn="PopoverContent",fw=f.forwardRef((t,s)=>{const r=X3(hn,t.__scopePopover),{forceMount:a=r.forceMount,...n}=t,i=ha(hn,t.__scopePopover);return e.jsx(Cs,{present:a||i.open,children:i.modal?e.jsx(Y3,{...n,ref:s}):e.jsx(J3,{...n,ref:s})})});fw.displayName=hn;var Z3=e0("PopoverContent.RemoveScroll"),Y3=f.forwardRef((t,s)=>{const r=ha(hn,t.__scopePopover),a=f.useRef(null),n=Pt(s,a),i=f.useRef(!1);return f.useEffect(()=>{const o=a.current;if(o)return Yg(o)},[]),e.jsx(Jg,{as:Z3,allowPinchZoom:!0,children:e.jsx(pw,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Te(t.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Te(t.onPointerDownOutside,o=>{const l=o.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,d=l.button===2||u;i.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:Te(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),J3=f.forwardRef((t,s)=>{const r=ha(hn,t.__scopePopover),a=f.useRef(!1),n=f.useRef(!1);return e.jsx(pw,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||r.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),pw=f.forwardRef((t,s)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:c,...m}=t,h=ha(hn,r),x=Li(r);return t0(),e.jsx(s0,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(Rc,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:e.jsx(Fc,{"data-state":gw(h.open),role:"dialog",id:h.contentId,...x,...m,ref:s,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),xw="PopoverClose",eM=f.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=ha(xw,r);return e.jsx(xt.button,{type:"button",...a,ref:s,onClick:Te(t.onClick,()=>n.onOpenChange(!1))})});eM.displayName=xw;var tM="PopoverArrow",sM=f.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Li(r);return e.jsx($c,{...n,...a,ref:s})});sM.displayName=tM;function gw(t){return t?"open":"closed"}var rM=cw,aM=mw,nM=hw,yw=fw;const iM=rM,oM=aM,vw=f.forwardRef(({className:t,align:s="center",sideOffset:r=4,...a},n)=>e.jsx(nM,{children:e.jsx(yw,{ref:n,align:s,sideOffset:r,className:de("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));vw.displayName=yw.displayName;function bw(t){const{title:s,message:r,variant:a="default",duration:n=5e3,action:i}=t,l=(d=>{switch(d){case"success":return"✅";case"destructive":return"❌";case"warning":return"⚠️";default:return"📢"}})(a),u=s?`${l} ${s}`:`${l} إشعار`;return d0({title:u,description:r,variant:a,duration:n,action:i?{altText:i.label,onClick:i.onClick,children:i.label}:void 0})}function Wh(t,s){return bw({title:"نجح",message:t,variant:"success"})}function za(t,s){return bw({title:"خطأ",message:t,variant:"destructive"})}const lM={safety:Gs,task:Is,payroll:S2,announcement:wa,system:ts},Kh={safety:"text-red-600 bg-gradient-to-r from-red-50 to-red-100",task:"text-blue-600 bg-gradient-to-r from-blue-50 to-blue-100",payroll:"text-green-600 bg-gradient-to-r from-green-50 to-green-100",announcement:"text-purple-600 bg-gradient-to-r from-purple-50 to-purple-100",system:"text-gray-600 bg-gradient-to-r from-gray-50 to-gray-100"},Gh={1:{label:"حرج",color:"bg-gradient-to-r from-red-500 to-red-600"},2:{label:"عالية",color:"bg-gradient-to-r from-orange-500 to-orange-600"},3:{label:"متوسطة",color:"bg-gradient-to-r from-yellow-500 to-yellow-600"},4:{label:"منخفضة",color:"bg-gradient-to-r from-blue-500 to-blue-600"},5:{label:"معلومة",color:"bg-gradient-to-r from-gray-500 to-gray-600"}};function cM({className:t}){const[s,r]=f.useState([]),[a,n]=f.useState(0),[i,o]=f.useState(!1),[l,u]=f.useState(!1),[,d]=or(),c=async()=>{u(!0);try{const p=localStorage.getItem("accessToken");if(!p){console.warn("لا يوجد رمز مصادقة - تخطي جلب الإشعارات"),u(!1);return}const k=await fetch("/api/notifications?limit=50",{headers:{Authorization:`Bearer ${p}`}});if(k.ok){const g=await k.json();if(console.log("🔍 [NotificationCenter] استجابة API:",g),g.success&&Array.isArray(g.data)){const b=g.data.map(j=>({id:j.id,type:j.type||"system",title:j.title,message:j.message,priority:j.priority==="critical"?1:j.priority==="high"?2:j.priority==="medium"?3:j.priority==="low"?4:5,createdAt:j.createdAt,isRead:j.status==="read",actionRequired:j.actionRequired||!1}));r(b),n(g.unreadCount||0),console.log("✅ [NotificationCenter] تم تحويل وحفظ الإشعارات:",b.length)}else Array.isArray(g)&&(r(g.map(b=>({...b,isRead:b.status==="read"}))),n(g.filter(b=>b.status!=="read").length))}else console.error("فشل في جلب الإشعارات"),r([{id:"system-welcome",type:"system",title:"مرحباً بك",message:"مرحباً بك في نظام إدارة المشاريع الإنشائية",priority:3,createdAt:new Date().toISOString(),isRead:!1}]),n(1)}catch(p){console.error("خطأ في جلب الإشعارات:",p)}finally{u(!1)}},m=async p=>{try{const k=localStorage.getItem("accessToken");if(!k){console.warn("لا يوجد رمز مصادقة - لا يمكن تحديد الإشعار كمقروء"),za("لا يمكنك تحديد الإشعارات كمقروءة بدون تسجيل الدخول.");return}(await fetch(`/api/notifications/${p}/read`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`}})).ok?(r(b=>b.map(j=>j.id===p?{...j,isRead:!0}:j)),n(b=>Math.max(0,b-1)),Wh("تم تحديد الإشعار كمقروء.")):za("فشل في تحديد الإشعار كمقروء.")}catch(k){console.error("خطأ في تعليم الإشعار كمقروء:",k),za("حدث خطأ أثناء تحديد الإشعار كمقروء.")}},h=async()=>{try{const p=localStorage.getItem("accessToken");if(!p){console.warn("لا يوجد رمز مصادقة - لا يمكن تعليم الإشعارات كمقروءة"),za("لا يمكنك تحديد جميع الإشعارات كمقروءة بدون تسجيل الدخول.");return}(await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}})).ok?(await c(),Wh("تم تحديد جميع الإشعارات كمقروءة.")):za("فشل في تحديد جميع الإشعارات كمقروءة.")}catch(p){console.error("خطأ في تعليم جميع الإشعارات كمقروءة:",p),za("حدث خطأ أثناء تحديد جميع الإشعارات كمقروءة.")}};f.useEffect(()=>{c();const p=setInterval(c,3e5);return()=>clearInterval(p)},[]);const x=p=>{const k=new Date(p),b=(new Date().getTime()-k.getTime())/(1e3*60*60);return b<1?`منذ ${Math.floor(b*60)} دقيقة`:b<24?`منذ ${Math.floor(b)} ساعة`:`منذ ${Math.floor(b/24)} يوم`};return e.jsxs(iM,{open:i,onOpenChange:o,children:[e.jsx(oM,{asChild:!0,children:e.jsxs(K,{variant:"ghost",size:"sm",className:de("relative p-2 h-10 w-10 rounded-xl transition-all duration-300 hover:bg-blue-50 hover:shadow-lg border border-transparent hover:border-blue-200",t,a>0&&"bg-blue-50 border-blue-200 shadow-md"),"data-testid":"notification-bell",children:[e.jsx(ts,{className:de("h-5 w-5 transition-all duration-300",a>0?"text-blue-600 animate-pulse":"text-gray-600")}),a>0&&e.jsx(Fe,{className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0 text-xs font-bold bg-gradient-to-r from-red-500 to-red-600 shadow-lg animate-bounce","data-testid":"notification-badge",children:a>99?"99+":a})]})}),e.jsxs(vw,{className:"w-80 sm:w-96 p-0 border-0 shadow-2xl rounded-2xl bg-white",align:"end","data-testid":"notification-popover",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-4 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(ts,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-base",children:"الإشعارات"}),e.jsx("p",{className:"text-xs text-blue-100",children:a>0?`${a} إشعار جديد`:"جميع الإشعارات مقروءة"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a>0&&e.jsxs(K,{variant:"ghost",size:"sm",className:"text-xs h-8 text-white hover:bg-white/20 rounded-lg",onClick:h,"data-testid":"mark-all-read-button",children:[e.jsx(Is,{className:"h-3 w-3 mr-1"}),"تعليم الكل"]}),e.jsx(K,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-white hover:bg-white/20 rounded-lg",onClick:()=>o(!1),"data-testid":"close-notification-button",children:e.jsx(vr,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-3"}),e.jsx("div",{className:"text-sm text-gray-500",children:"جاري التحميل..."})]}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(ts,{className:"h-8 w-8 text-gray-400"})}),e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-1",children:"لا توجد إشعارات"}),e.jsx("div",{className:"text-xs text-gray-400",children:"ستظهر إشعاراتك الجديدة هنا"})]}):e.jsx("div",{className:"p-2",children:s.map((p,k)=>{const g=lM[p.type]||ts,b=Kh[p.type]||Kh.system,j=Gh[p.priority]||Gh[3];return e.jsx("div",{className:de("group p-3 mb-2 last:mb-0 rounded-xl cursor-pointer transition-all duration-300 border",p.isRead?"bg-white border-gray-100 hover:bg-gray-50 hover:border-gray-200":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 hover:from-blue-100 hover:to-indigo-100 shadow-sm hover:shadow-md"),onClick:()=>!p.isRead&&m(p.id),"data-testid":`notification-item-${k}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:de("w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm transition-all duration-300 group-hover:scale-105",b),children:e.jsx(g,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:de("text-sm leading-tight",p.isRead?"font-medium text-gray-700":"font-bold text-gray-900"),children:p.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!p.isRead&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx(Fe,{className:de("text-xs px-2 py-0.5 text-white font-medium",j.color),children:j.label})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2 leading-relaxed",children:p.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(Ls,{className:"h-3 w-3"}),e.jsx("span",{children:x(p.createdAt)})]}),p.actionRequired&&e.jsxs(Fe,{variant:"outline",className:"text-xs bg-orange-50 text-orange-600 border-orange-200",children:[e.jsx(Yn,{className:"h-3 w-3 mr-1"}),"إجراء مطلوب"]})]})]})]})},p.id)})})}),s.length>0&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"border-t border-gray-100 p-3",children:e.jsxs(K,{variant:"ghost",className:"w-full text-sm font-medium bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-indigo-50 border border-gray-200 hover:border-blue-200 transition-all duration-300 rounded-xl h-10",onClick:()=>{o(!1),d("/notifications")},"data-testid":"view-all-notifications-button",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"عرض جميع الإشعارات"]})})})]})]})}var Mc=["Enter"," "],dM=["ArrowDown","PageUp","Home"],jw=["ArrowUp","PageDown","End"],uM=[...dM,...jw],mM={ltr:[...Mc,"ArrowRight"],rtl:[...Mc,"ArrowLeft"]},hM={ltr:["ArrowLeft"],rtl:["ArrowRight"]},zi="Menu",[bi,fM,pM]=Qg(zi),[$a,Nw]=Os(zi,[pM,pn,bn]),yl=pn(),ww=bn(),[xM,Va]=$a(zi),[gM,Bi]=$a(zi),kw=t=>{const{__scopeMenu:s,open:r=!1,children:a,dir:n,onOpenChange:i,modal:o=!0}=t,l=yl(s),[u,d]=f.useState(null),c=f.useRef(!1),m=mr(i),h=Si(n);return f.useEffect(()=>{const x=()=>{c.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>c.current=!1;return document.addEventListener("keydown",x,{capture:!0}),()=>{document.removeEventListener("keydown",x,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),e.jsx(r0,{...l,children:e.jsx(xM,{scope:s,open:r,onOpenChange:m,content:u,onContentChange:d,children:e.jsx(gM,{scope:s,onClose:f.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:c,dir:h,modal:o,children:a})})})};kw.displayName=zi;var yM="MenuAnchor",ou=f.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t,n=yl(r);return e.jsx(Bo,{...n,...a,ref:s})});ou.displayName=yM;var lu="MenuPortal",[vM,Tw]=$a(lu,{forceMount:void 0}),Sw=t=>{const{__scopeMenu:s,forceMount:r,children:a,container:n}=t,i=Va(lu,s);return e.jsx(vM,{scope:s,forceMount:r,children:e.jsx(Cs,{present:r||i.open,children:e.jsx(Zg,{asChild:!0,container:n,children:a})})})};Sw.displayName=lu;var Qs="MenuContent",[bM,cu]=$a(Qs),Aw=f.forwardRef((t,s)=>{const r=Tw(Qs,t.__scopeMenu),{forceMount:a=r.forceMount,...n}=t,i=Va(Qs,t.__scopeMenu),o=Bi(Qs,t.__scopeMenu);return e.jsx(bi.Provider,{scope:t.__scopeMenu,children:e.jsx(Cs,{present:a||i.open,children:e.jsx(bi.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx(jM,{...n,ref:s}):e.jsx(NM,{...n,ref:s})})})})}),jM=f.forwardRef((t,s)=>{const r=Va(Qs,t.__scopeMenu),a=f.useRef(null),n=Pt(s,a);return f.useEffect(()=>{const i=a.current;if(i)return Yg(i)},[]),e.jsx(du,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Te(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),NM=f.forwardRef((t,s)=>{const r=Va(Qs,t.__scopeMenu);return e.jsx(du,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),wM=e0("MenuContent.ScrollLock"),du=f.forwardRef((t,s)=>{const{__scopeMenu:r,loop:a=!1,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:u,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:m,onInteractOutside:h,onDismiss:x,disableOutsideScroll:p,...k}=t,g=Va(Qs,r),b=Bi(Qs,r),j=yl(r),y=ww(r),M=fM(r),[N,T]=f.useState(null),S=f.useRef(null),I=Pt(s,S,g.onContentChange),E=f.useRef(0),z=f.useRef(""),w=f.useRef(0),v=f.useRef(null),D=f.useRef("right"),V=f.useRef(0),X=p?Jg:f.Fragment,C=p?{as:wM,allowPinchZoom:!0}:void 0,q=R=>{const fe=z.current+R,ce=M().filter(H=>!H.disabled),ne=document.activeElement,ye=ce.find(H=>H.ref.current===ne)?.textValue,tt=ce.map(H=>H.textValue),at=RM(tt,fe,ye),st=ce.find(H=>H.textValue===at)?.ref.current;(function H(L){z.current=L,window.clearTimeout(E.current),L!==""&&(E.current=window.setTimeout(()=>H(""),1e3))})(fe),st&&setTimeout(()=>st.focus())};f.useEffect(()=>()=>window.clearTimeout(E.current),[]),t0();const ue=f.useCallback(R=>D.current===v.current?.side&&$M(R,v.current?.area),[]);return e.jsx(bM,{scope:r,searchRef:z,onItemEnter:f.useCallback(R=>{ue(R)&&R.preventDefault()},[ue]),onItemLeave:f.useCallback(R=>{ue(R)||(S.current?.focus(),T(null))},[ue]),onTriggerLeave:f.useCallback(R=>{ue(R)&&R.preventDefault()},[ue]),pointerGraceTimerRef:w,onPointerGraceIntentChange:f.useCallback(R=>{v.current=R},[]),children:e.jsx(X,{...C,children:e.jsx(s0,{asChild:!0,trapped:n,onMountAutoFocus:Te(i,R=>{R.preventDefault(),S.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(Rc,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:m,onInteractOutside:h,onDismiss:x,children:e.jsx(zd,{asChild:!0,...y,dir:b.dir,orientation:"vertical",loop:a,currentTabStopId:N,onCurrentTabStopIdChange:T,onEntryFocus:Te(u,R=>{b.isUsingKeyboardRef.current||R.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Fc,{role:"menu","aria-orientation":"vertical","data-state":qw(g.open),"data-radix-menu-content":"",dir:b.dir,...j,...k,ref:I,style:{outline:"none",...k.style},onKeyDown:Te(k.onKeyDown,R=>{const ce=R.target.closest("[data-radix-menu-content]")===R.currentTarget,ne=R.ctrlKey||R.altKey||R.metaKey,ye=R.key.length===1;ce&&(R.key==="Tab"&&R.preventDefault(),!ne&&ye&&q(R.key));const tt=S.current;if(R.target!==tt||!uM.includes(R.key))return;R.preventDefault();const st=M().filter(H=>!H.disabled).map(H=>H.ref.current);jw.includes(R.key)&&st.reverse(),MM(st)}),onBlur:Te(t.onBlur,R=>{R.currentTarget.contains(R.target)||(window.clearTimeout(E.current),z.current="")}),onPointerMove:Te(t.onPointerMove,ji(R=>{const fe=R.target,ce=V.current!==R.clientX;if(R.currentTarget.contains(fe)&&ce){const ne=R.clientX>V.current?"right":"left";D.current=ne,V.current=R.clientX}}))})})})})})})});Aw.displayName=Qs;var kM="MenuGroup",uu=f.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return e.jsx(xt.div,{role:"group",...a,ref:s})});uu.displayName=kM;var TM="MenuLabel",_w=f.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return e.jsx(xt.div,{...a,ref:s})});_w.displayName=TM;var Fo="MenuItem",Hh="menu.itemSelect",vl=f.forwardRef((t,s)=>{const{disabled:r=!1,onSelect:a,...n}=t,i=f.useRef(null),o=Bi(Fo,t.__scopeMenu),l=cu(Fo,t.__scopeMenu),u=Pt(s,i),d=f.useRef(!1),c=()=>{const m=i.current;if(!r&&m){const h=new CustomEvent(Hh,{bubbles:!0,cancelable:!0});m.addEventListener(Hh,x=>a?.(x),{once:!0}),G1(m,h),h.defaultPrevented?d.current=!1:o.onClose()}};return e.jsx(Cw,{...n,ref:u,disabled:r,onClick:Te(t.onClick,c),onPointerDown:m=>{t.onPointerDown?.(m),d.current=!0},onPointerUp:Te(t.onPointerUp,m=>{d.current||m.currentTarget?.click()}),onKeyDown:Te(t.onKeyDown,m=>{const h=l.searchRef.current!=="";r||h&&m.key===" "||Mc.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});vl.displayName=Fo;var Cw=f.forwardRef((t,s)=>{const{__scopeMenu:r,disabled:a=!1,textValue:n,...i}=t,o=cu(Fo,r),l=ww(r),u=f.useRef(null),d=Pt(s,u),[c,m]=f.useState(!1),[h,x]=f.useState("");return f.useEffect(()=>{const p=u.current;p&&x((p.textContent??"").trim())},[i.children]),e.jsx(bi.ItemSlot,{scope:r,disabled:a,textValue:n??h,children:e.jsx(Bd,{asChild:!0,...l,focusable:!a,children:e.jsx(xt.div,{role:"menuitem","data-highlighted":c?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...i,ref:d,onPointerMove:Te(t.onPointerMove,ji(p=>{a?o.onItemLeave(p):(o.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Te(t.onPointerLeave,ji(p=>o.onItemLeave(p))),onFocus:Te(t.onFocus,()=>m(!0)),onBlur:Te(t.onBlur,()=>m(!1))})})})}),SM="MenuCheckboxItem",Pw=f.forwardRef((t,s)=>{const{checked:r=!1,onCheckedChange:a,...n}=t;return e.jsx(Rw,{scope:t.__scopeMenu,checked:r,children:e.jsx(vl,{role:"menuitemcheckbox","aria-checked":$o(r)?"mixed":r,...n,ref:s,"data-state":hu(r),onSelect:Te(n.onSelect,()=>a?.($o(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Pw.displayName=SM;var Ew="MenuRadioGroup",[AM,_M]=$a(Ew,{value:void 0,onValueChange:()=>{}}),Dw=f.forwardRef((t,s)=>{const{value:r,onValueChange:a,...n}=t,i=mr(a);return e.jsx(AM,{scope:t.__scopeMenu,value:r,onValueChange:i,children:e.jsx(uu,{...n,ref:s})})});Dw.displayName=Ew;var Mw="MenuRadioItem",Iw=f.forwardRef((t,s)=>{const{value:r,...a}=t,n=_M(Mw,t.__scopeMenu),i=r===n.value;return e.jsx(Rw,{scope:t.__scopeMenu,checked:i,children:e.jsx(vl,{role:"menuitemradio","aria-checked":i,...a,ref:s,"data-state":hu(i),onSelect:Te(a.onSelect,()=>n.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Iw.displayName=Mw;var mu="MenuItemIndicator",[Rw,CM]=$a(mu,{checked:!1}),Fw=f.forwardRef((t,s)=>{const{__scopeMenu:r,forceMount:a,...n}=t,i=CM(mu,r);return e.jsx(Cs,{present:a||$o(i.checked)||i.checked===!0,children:e.jsx(xt.span,{...n,ref:s,"data-state":hu(i.checked)})})});Fw.displayName=mu;var PM="MenuSeparator",$w=f.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return e.jsx(xt.div,{role:"separator","aria-orientation":"horizontal",...a,ref:s})});$w.displayName=PM;var EM="MenuArrow",Vw=f.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t,n=yl(r);return e.jsx($c,{...n,...a,ref:s})});Vw.displayName=EM;var DM="MenuSub",[dR,Ow]=$a(DM),Fn="MenuSubTrigger",Lw=f.forwardRef((t,s)=>{const r=Va(Fn,t.__scopeMenu),a=Bi(Fn,t.__scopeMenu),n=Ow(Fn,t.__scopeMenu),i=cu(Fn,t.__scopeMenu),o=f.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:u}=i,d={__scopeMenu:t.__scopeMenu},c=f.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return f.useEffect(()=>c,[c]),f.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),u(null)}},[l,u]),e.jsx(ou,{asChild:!0,...d,children:e.jsx(Cw,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":n.contentId,"data-state":qw(r.open),...t,ref:a0(s,n.onTriggerChange),onClick:m=>{t.onClick?.(m),!(t.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Te(t.onPointerMove,ji(m=>{i.onItemEnter(m),!m.defaultPrevented&&!t.disabled&&!r.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{r.onOpenChange(!0),c()},100))})),onPointerLeave:Te(t.onPointerLeave,ji(m=>{c();const h=r.content?.getBoundingClientRect();if(h){const x=r.content?.dataset.side,p=x==="right",k=p?-5:5,g=h[p?"left":"right"],b=h[p?"right":"left"];i.onPointerGraceIntentChange({area:[{x:m.clientX+k,y:m.clientY},{x:g,y:h.top},{x:b,y:h.top},{x:b,y:h.bottom},{x:g,y:h.bottom}],side:x}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(m),m.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:Te(t.onKeyDown,m=>{const h=i.searchRef.current!=="";t.disabled||h&&m.key===" "||mM[a.dir].includes(m.key)&&(r.onOpenChange(!0),r.content?.focus(),m.preventDefault())})})})});Lw.displayName=Fn;var zw="MenuSubContent",Bw=f.forwardRef((t,s)=>{const r=Tw(Qs,t.__scopeMenu),{forceMount:a=r.forceMount,...n}=t,i=Va(Qs,t.__scopeMenu),o=Bi(Qs,t.__scopeMenu),l=Ow(zw,t.__scopeMenu),u=f.useRef(null),d=Pt(s,u);return e.jsx(bi.Provider,{scope:t.__scopeMenu,children:e.jsx(Cs,{present:a||i.open,children:e.jsx(bi.Slot,{scope:t.__scopeMenu,children:e.jsx(du,{id:l.contentId,"aria-labelledby":l.triggerId,...n,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:c=>{o.isUsingKeyboardRef.current&&u.current?.focus(),c.preventDefault()},onCloseAutoFocus:c=>c.preventDefault(),onFocusOutside:Te(t.onFocusOutside,c=>{c.target!==l.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:Te(t.onEscapeKeyDown,c=>{o.onClose(),c.preventDefault()}),onKeyDown:Te(t.onKeyDown,c=>{const m=c.currentTarget.contains(c.target),h=hM[o.dir].includes(c.key);m&&h&&(i.onOpenChange(!1),l.trigger?.focus(),c.preventDefault())})})})})})});Bw.displayName=zw;function qw(t){return t?"open":"closed"}function $o(t){return t==="indeterminate"}function hu(t){return $o(t)?"indeterminate":t?"checked":"unchecked"}function MM(t){const s=document.activeElement;for(const r of t)if(r===s||(r.focus(),document.activeElement!==s))return}function IM(t,s){return t.map((r,a)=>t[(s+a)%t.length])}function RM(t,s,r){const n=s.length>1&&Array.from(s).every(d=>d===s[0])?s[0]:s,i=r?t.indexOf(r):-1;let o=IM(t,Math.max(i,0));n.length===1&&(o=o.filter(d=>d!==r));const u=o.find(d=>d.toLowerCase().startsWith(n.toLowerCase()));return u!==r?u:void 0}function FM(t,s){const{x:r,y:a}=t;let n=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const l=s[i],u=s[o],d=l.x,c=l.y,m=u.x,h=u.y;c>a!=h>a&&r<(m-d)*(a-c)/(h-c)+d&&(n=!n)}return n}function $M(t,s){if(!s)return!1;const r={x:t.clientX,y:t.clientY};return FM(r,s)}function ji(t){return s=>s.pointerType==="mouse"?t(s):void 0}var VM=kw,OM=ou,LM=Sw,zM=Aw,BM=uu,qM=_w,UM=vl,WM=Pw,KM=Dw,GM=Iw,HM=Fw,QM=$w,XM=Vw,ZM=Lw,YM=Bw,bl="DropdownMenu",[JM]=Os(bl,[Nw]),ks=Nw(),[eI,Uw]=JM(bl),Ww=t=>{const{__scopeDropdownMenu:s,children:r,dir:a,open:n,defaultOpen:i,onOpenChange:o,modal:l=!0}=t,u=ks(s),d=f.useRef(null),[c,m]=Ma({prop:n,defaultProp:i??!1,onChange:o,caller:bl});return e.jsx(eI,{scope:s,triggerId:Hn(),triggerRef:d,contentId:Hn(),open:c,onOpenChange:m,onOpenToggle:f.useCallback(()=>m(h=>!h),[m]),modal:l,children:e.jsx(VM,{...u,open:c,onOpenChange:m,dir:a,modal:l,children:r})})};Ww.displayName=bl;var Kw="DropdownMenuTrigger",Gw=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...n}=t,i=Uw(Kw,r),o=ks(r);return e.jsx(OM,{asChild:!0,...o,children:e.jsx(xt.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...n,ref:a0(s,i.triggerRef),onPointerDown:Te(t.onPointerDown,l=>{!a&&l.button===0&&l.ctrlKey===!1&&(i.onOpenToggle(),i.open||l.preventDefault())}),onKeyDown:Te(t.onKeyDown,l=>{a||(["Enter"," "].includes(l.key)&&i.onOpenToggle(),l.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});Gw.displayName=Kw;var tI="DropdownMenuPortal",Hw=t=>{const{__scopeDropdownMenu:s,...r}=t,a=ks(s);return e.jsx(LM,{...a,...r})};Hw.displayName=tI;var Qw="DropdownMenuContent",Xw=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=Uw(Qw,r),i=ks(r),o=f.useRef(!1);return e.jsx(zM,{id:n.contentId,"aria-labelledby":n.triggerId,...i,...a,ref:s,onCloseAutoFocus:Te(t.onCloseAutoFocus,l=>{o.current||n.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:Te(t.onInteractOutside,l=>{const u=l.detail.originalEvent,d=u.button===0&&u.ctrlKey===!0,c=u.button===2||d;(!n.modal||c)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Xw.displayName=Qw;var sI="DropdownMenuGroup",rI=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(BM,{...n,...a,ref:s})});rI.displayName=sI;var aI="DropdownMenuLabel",Zw=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(qM,{...n,...a,ref:s})});Zw.displayName=aI;var nI="DropdownMenuItem",Yw=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(UM,{...n,...a,ref:s})});Yw.displayName=nI;var iI="DropdownMenuCheckboxItem",Jw=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(WM,{...n,...a,ref:s})});Jw.displayName=iI;var oI="DropdownMenuRadioGroup",lI=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(KM,{...n,...a,ref:s})});lI.displayName=oI;var cI="DropdownMenuRadioItem",e1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(GM,{...n,...a,ref:s})});e1.displayName=cI;var dI="DropdownMenuItemIndicator",t1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(HM,{...n,...a,ref:s})});t1.displayName=dI;var uI="DropdownMenuSeparator",s1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(QM,{...n,...a,ref:s})});s1.displayName=uI;var mI="DropdownMenuArrow",hI=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(XM,{...n,...a,ref:s})});hI.displayName=mI;var fI="DropdownMenuSubTrigger",r1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(ZM,{...n,...a,ref:s})});r1.displayName=fI;var pI="DropdownMenuSubContent",a1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,n=ks(r);return e.jsx(YM,{...n,...a,ref:s,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});a1.displayName=pI;var xI=Ww,gI=Gw,yI=Hw,n1=Xw,i1=Zw,o1=Yw,l1=Jw,c1=e1,d1=t1,u1=s1,m1=r1,h1=a1;const vI=xI,bI=gI,jI=f.forwardRef(({className:t,inset:s,children:r,...a},n)=>e.jsxs(m1,{ref:n,className:de("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...a,children:[r,e.jsx(f2,{className:"ml-auto"})]}));jI.displayName=m1.displayName;const NI=f.forwardRef(({className:t,...s},r)=>e.jsx(h1,{ref:r,className:de("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));NI.displayName=h1.displayName;const f1=f.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(yI,{children:e.jsx(n1,{ref:a,sideOffset:s,className:de("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...r})}));f1.displayName=n1.displayName;const uo=f.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(o1,{ref:a,className:de("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...r}));uo.displayName=o1.displayName;const wI=f.forwardRef(({className:t,children:s,checked:r,...a},n)=>e.jsxs(l1,{ref:n,className:de("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(d1,{children:e.jsx(Uo,{className:"h-4 w-4"})})}),s]}));wI.displayName=l1.displayName;const kI=f.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(c1,{ref:a,className:de("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(d1,{children:e.jsx(h0,{className:"h-2 w-2 fill-current"})})}),s]}));kI.displayName=c1.displayName;const TI=f.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(i1,{ref:a,className:de("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...r}));TI.displayName=i1.displayName;const Ic=f.forwardRef(({className:t,...s},r)=>e.jsx(u1,{ref:r,className:de("-mx-1 my-1 h-px bg-muted",t),...s}));Ic.displayName=u1.displayName;const SI={"/":{title:"لوحة التحكم",icon:Uc},"/projects":{title:"إدارة المشاريع",icon:Ks},"/workers":{title:"إدارة العمال",icon:Zt},"/suppliers-pro":{title:"إدارة الموردين",icon:Za},"/worker-attendance":{title:"حضور العمال",icon:Go},"/worker-accounts":{title:"حسابات العمال",icon:Ns},"/daily-expenses":{title:"المصاريف اليومية",icon:m0},"/material-purchase":{title:"شراء المواد",icon:ra},"/project-transfers":{title:"تحويلات العهدة",icon:Vn},"/project-transactions":{title:"سجل العمليات",icon:Br},"/project-transactions-simple":{title:"سجل العمليات المبسط",icon:Br},"/supplier-accounts":{title:"حسابات الموردين",icon:_a},"/reports":{title:"التقارير",icon:f0},"/autocomplete-admin":{title:"إعدادات الإكمال التلقائي",icon:tr},"/tools-management":{title:"إدارة الأدوات والمعدات",icon:tr},"/notifications":{title:"الإشعارات",icon:ts},"/smart-errors":{title:"كشف الأخطاء الذكي",icon:fs}};function AI(){const[t,s]=or(),{user:r,logout:a,isAuthenticated:n}=Ra(),{toast:i}=Dt(),[o,l]=f.useState(!1),u=SI[t]||{title:"إدارة المشاريع الإنشائية",icon:k2},d=u.icon;return e.jsx("header",{className:"bg-primary text-primary-foreground shadow-lg sticky top-0 z-50",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-reverse space-x-3",children:[e.jsx(d,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-lg font-bold",children:u.title})]}),e.jsxs("div",{className:"flex items-center space-x-reverse space-x-2",children:[e.jsx(K,{variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-primary/80",onClick:()=>s("/print-control"),title:"التحكم في الطباعة",children:e.jsx(gr,{className:"h-4 w-4"})}),e.jsx(cM,{}),n?e.jsxs(vI,{children:[e.jsx(bI,{asChild:!0,children:e.jsxs(K,{variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-primary/80 relative","data-testid":"user-menu-trigger",children:[e.jsx(Mu,{className:"h-5 w-5"}),r&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full w-3 h-3 border-2 border-primary"})]})}),e.jsxs(f1,{align:"end",className:"w-56",children:[e.jsxs("div",{className:"px-3 py-2 text-sm",children:[e.jsx("div",{className:"font-medium text-foreground",children:r?.name||"المستخدم"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r?.email}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(fs,{className:"h-3 w-3"}),r?.role==="admin"?"مدير النظام":"عضو مفعل"]})})]}),e.jsx(Ic,{}),e.jsxs(uo,{onClick:()=>s("/profile"),className:"cursor-pointer","data-testid":"menu-profile",children:[e.jsx(Hs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"الملف الشخصي"})]}),e.jsxs(uo,{onClick:()=>s("/settings"),className:"cursor-pointer","data-testid":"menu-settings",children:[e.jsx(gr,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"الإعدادات"})]}),e.jsx(Ic,{}),e.jsxs(uo,{onClick:async()=>{l(!0);try{await a(),i({title:"تم تسجيل الخروج بنجاح",description:"شكراً لاستخدام النظام"}),s("/login")}catch{i({title:"خطأ في تسجيل الخروج",description:"حدث خطأ أثناء تسجيل الخروج",variant:"destructive"})}finally{l(!1)}},className:"cursor-pointer text-red-600 focus:text-red-600 focus:bg-red-50 dark:focus:bg-red-900/50",disabled:o,"data-testid":"menu-logout",children:[e.jsx(T2,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:o?"جارِ تسجيل الخروج...":"تسجيل الخروج"})]})]})]}):e.jsx(K,{variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-primary/80",onClick:()=>s("/login"),"data-testid":"login-button",children:e.jsx(Mu,{className:"h-5 w-5"})})]})]})})})}const _I=Oc,CI=Lc,PI=Vc,p1=f.forwardRef(({className:t,...s},r)=>e.jsx(Ni,{className:de("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));p1.displayName=Ni.displayName;const EI=xn("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),x1=f.forwardRef(({side:t="right",className:s,children:r,...a},n)=>e.jsxs(PI,{children:[e.jsx(p1,{}),e.jsxs(wi,{ref:n,className:de(EI({side:t}),s),...a,children:[r,e.jsxs(qo,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(vr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));x1.displayName=wi.displayName;const g1=({className:t,...s})=>e.jsx("div",{className:de("flex flex-col space-y-2 text-center sm:text-left",t),...s});g1.displayName="SheetHeader";const y1=f.forwardRef(({className:t,...s},r)=>e.jsx(ki,{ref:r,className:de("text-lg font-semibold text-foreground",t),...s}));y1.displayName=ki.displayName;const DI=f.forwardRef(({className:t,...s},r)=>e.jsx(Ti,{ref:r,className:de("text-sm text-muted-foreground",t),...s}));DI.displayName=Ti.displayName;function MI(t,s){return f.useReducer((r,a)=>s[r][a]??r,t)}var fu="ScrollArea",[v1]=Os(fu),[II,Xs]=v1(fu),b1=f.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:n,scrollHideDelay:i=600,...o}=t,[l,u]=f.useState(null),[d,c]=f.useState(null),[m,h]=f.useState(null),[x,p]=f.useState(null),[k,g]=f.useState(null),[b,j]=f.useState(0),[y,M]=f.useState(0),[N,T]=f.useState(!1),[S,I]=f.useState(!1),E=Pt(s,w=>u(w)),z=Si(n);return e.jsx(II,{scope:r,type:a,dir:z,scrollHideDelay:i,scrollArea:l,viewport:d,onViewportChange:c,content:m,onContentChange:h,scrollbarX:x,onScrollbarXChange:p,scrollbarXEnabled:N,onScrollbarXEnabledChange:T,scrollbarY:k,onScrollbarYChange:g,scrollbarYEnabled:S,onScrollbarYEnabledChange:I,onCornerWidthChange:j,onCornerHeightChange:M,children:e.jsx(xt.div,{dir:z,...o,ref:E,style:{position:"relative","--radix-scroll-area-corner-width":b+"px","--radix-scroll-area-corner-height":y+"px",...t.style}})})});b1.displayName=fu;var j1="ScrollAreaViewport",N1=f.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:a,nonce:n,...i}=t,o=Xs(j1,r),l=f.useRef(null),u=Pt(s,l,o.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(xt.div,{"data-radix-scroll-area-viewport":"",...i,ref:u,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});N1.displayName=j1;var Pr="ScrollAreaScrollbar",pu=f.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=Xs(Pr,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=n,l=t.orientation==="horizontal";return f.useEffect(()=>(l?i(!0):o(!0),()=>{l?i(!1):o(!1)}),[l,i,o]),n.type==="hover"?e.jsx(RI,{...a,ref:s,forceMount:r}):n.type==="scroll"?e.jsx(FI,{...a,ref:s,forceMount:r}):n.type==="auto"?e.jsx(w1,{...a,ref:s,forceMount:r}):n.type==="always"?e.jsx(xu,{...a,ref:s}):null});pu.displayName=Pr;var RI=f.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=Xs(Pr,t.__scopeScrollArea),[i,o]=f.useState(!1);return f.useEffect(()=>{const l=n.scrollArea;let u=0;if(l){const d=()=>{window.clearTimeout(u),o(!0)},c=()=>{u=window.setTimeout(()=>o(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",c),()=>{window.clearTimeout(u),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",c)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(Cs,{present:r||i,children:e.jsx(w1,{"data-state":i?"visible":"hidden",...a,ref:s})})}),FI=f.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=Xs(Pr,t.__scopeScrollArea),i=t.orientation==="horizontal",o=Nl(()=>u("SCROLL_END"),100),[l,u]=MI("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return f.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>u("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,n.scrollHideDelay,u]),f.useEffect(()=>{const d=n.viewport,c=i?"scrollLeft":"scrollTop";if(d){let m=d[c];const h=()=>{const x=d[c];m!==x&&(u("SCROLL"),o()),m=x};return d.addEventListener("scroll",h),()=>d.removeEventListener("scroll",h)}},[n.viewport,i,u,o]),e.jsx(Cs,{present:r||l!=="hidden",children:e.jsx(xu,{"data-state":l==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:Te(t.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:Te(t.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),w1=f.forwardRef((t,s)=>{const r=Xs(Pr,t.__scopeScrollArea),{forceMount:a,...n}=t,[i,o]=f.useState(!1),l=t.orientation==="horizontal",u=Nl(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,c=r.viewport.offsetHeight<r.viewport.scrollHeight;o(l?d:c)}},10);return fn(r.viewport,u),fn(r.content,u),e.jsx(Cs,{present:a||i,children:e.jsx(xu,{"data-state":i?"visible":"hidden",...n,ref:s})})}),xu=f.forwardRef((t,s)=>{const{orientation:r="vertical",...a}=t,n=Xs(Pr,t.__scopeScrollArea),i=f.useRef(null),o=f.useRef(0),[l,u]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=_1(l.viewport,l.content),c={...a,sizes:l,onSizesChange:u,hasThumb:d>0&&d<1,onThumbChange:h=>i.current=h,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:h=>o.current=h};function m(h,x){return BI(h,o.current,l,x)}return r==="horizontal"?e.jsx($I,{...c,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const h=n.viewport.scrollLeft,x=Qh(h,l,n.dir);i.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=m(h,n.dir))}}):r==="vertical"?e.jsx(VI,{...c,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const h=n.viewport.scrollTop,x=Qh(h,l);i.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=m(h))}}):null}),$I=f.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,i=Xs(Pr,t.__scopeScrollArea),[o,l]=f.useState(),u=f.useRef(null),d=Pt(s,u,i.onScrollbarXChange);return f.useEffect(()=>{u.current&&l(getComputedStyle(u.current))},[u]),e.jsx(T1,{"data-orientation":"horizontal",...n,ref:d,sizes:r,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":jl(r)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.x),onDragScroll:c=>t.onDragScroll(c.x),onWheelScroll:(c,m)=>{if(i.viewport){const h=i.viewport.scrollLeft+c.deltaX;t.onWheelScroll(h),P1(h,m)&&c.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&a({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:Oo(o.paddingLeft),paddingEnd:Oo(o.paddingRight)}})}})}),VI=f.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,i=Xs(Pr,t.__scopeScrollArea),[o,l]=f.useState(),u=f.useRef(null),d=Pt(s,u,i.onScrollbarYChange);return f.useEffect(()=>{u.current&&l(getComputedStyle(u.current))},[u]),e.jsx(T1,{"data-orientation":"vertical",...n,ref:d,sizes:r,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":jl(r)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.y),onDragScroll:c=>t.onDragScroll(c.y),onWheelScroll:(c,m)=>{if(i.viewport){const h=i.viewport.scrollTop+c.deltaY;t.onWheelScroll(h),P1(h,m)&&c.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&a({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:Oo(o.paddingTop),paddingEnd:Oo(o.paddingBottom)}})}})}),[OI,k1]=v1(Pr),T1=f.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:n,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:l,onThumbPositionChange:u,onDragScroll:d,onWheelScroll:c,onResize:m,...h}=t,x=Xs(Pr,r),[p,k]=f.useState(null),g=Pt(s,E=>k(E)),b=f.useRef(null),j=f.useRef(""),y=x.viewport,M=a.content-a.viewport,N=mr(c),T=mr(u),S=Nl(m,10);function I(E){if(b.current){const z=E.clientX-b.current.left,w=E.clientY-b.current.top;d({x:z,y:w})}}return f.useEffect(()=>{const E=z=>{const w=z.target;p?.contains(w)&&N(z,M)};return document.addEventListener("wheel",E,{passive:!1}),()=>document.removeEventListener("wheel",E,{passive:!1})},[y,p,M,N]),f.useEffect(T,[a,T]),fn(p,S),fn(x.content,S),e.jsx(OI,{scope:r,scrollbar:p,hasThumb:n,onThumbChange:mr(i),onThumbPointerUp:mr(o),onThumbPositionChange:T,onThumbPointerDown:mr(l),children:e.jsx(xt.div,{...h,ref:g,style:{position:"absolute",...h.style},onPointerDown:Te(t.onPointerDown,E=>{E.button===0&&(E.target.setPointerCapture(E.pointerId),b.current=p.getBoundingClientRect(),j.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),I(E))}),onPointerMove:Te(t.onPointerMove,I),onPointerUp:Te(t.onPointerUp,E=>{const z=E.target;z.hasPointerCapture(E.pointerId)&&z.releasePointerCapture(E.pointerId),document.body.style.webkitUserSelect=j.current,x.viewport&&(x.viewport.style.scrollBehavior=""),b.current=null})})})}),Vo="ScrollAreaThumb",S1=f.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=k1(Vo,t.__scopeScrollArea);return e.jsx(Cs,{present:r||n.hasThumb,children:e.jsx(LI,{ref:s,...a})})}),LI=f.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:a,...n}=t,i=Xs(Vo,r),o=k1(Vo,r),{onThumbPositionChange:l}=o,u=Pt(s,m=>o.onThumbChange(m)),d=f.useRef(void 0),c=Nl(()=>{d.current&&(d.current(),d.current=void 0)},100);return f.useEffect(()=>{const m=i.viewport;if(m){const h=()=>{if(c(),!d.current){const x=qI(m,l);d.current=x,l()}};return l(),m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[i.viewport,c,l]),e.jsx(xt.div,{"data-state":o.hasThumb?"visible":"hidden",...n,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:Te(t.onPointerDownCapture,m=>{const x=m.target.getBoundingClientRect(),p=m.clientX-x.left,k=m.clientY-x.top;o.onThumbPointerDown({x:p,y:k})}),onPointerUp:Te(t.onPointerUp,o.onThumbPointerUp)})});S1.displayName=Vo;var gu="ScrollAreaCorner",A1=f.forwardRef((t,s)=>{const r=Xs(gu,t.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?e.jsx(zI,{...t,ref:s}):null});A1.displayName=gu;var zI=f.forwardRef((t,s)=>{const{__scopeScrollArea:r,...a}=t,n=Xs(gu,r),[i,o]=f.useState(0),[l,u]=f.useState(0),d=!!(i&&l);return fn(n.scrollbarX,()=>{const c=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(c),u(c)}),fn(n.scrollbarY,()=>{const c=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(c),o(c)}),d?e.jsx(xt.div,{...a,ref:s,style:{width:i,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function Oo(t){return t?parseInt(t,10):0}function _1(t,s){const r=t/s;return isNaN(r)?0:r}function jl(t){const s=_1(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-r)*s;return Math.max(a,18)}function BI(t,s,r,a="ltr"){const n=jl(r),i=n/2,o=s||i,l=n-o,u=r.scrollbar.paddingStart+o,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,c=r.content-r.viewport,m=a==="ltr"?[0,c]:[c*-1,0];return C1([u,d],m)(t)}function Qh(t,s,r="ltr"){const a=jl(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,i=s.scrollbar.size-n,o=s.content-s.viewport,l=i-a,u=r==="ltr"?[0,o]:[o*-1,0],d=Q1(t,u);return C1([0,o],[0,l])(d)}function C1(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(t[1]-t[0]);return s[0]+a*(r-t[0])}}function P1(t,s){return t>0&&t<s}var qI=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},a=0;return(function n(){const i={left:t.scrollLeft,top:t.scrollTop},o=r.left!==i.left,l=r.top!==i.top;(o||l)&&s(),r=i,a=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(a)};function Nl(t,s){const r=mr(t),a=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(a.current),[]),f.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function fn(t,s){const r=mr(s);H1(()=>{let a=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return n.observe(t),()=>{window.cancelAnimationFrame(a),n.unobserve(t)}}},[t,r])}var E1=b1,UI=N1,WI=A1;const D1=f.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(E1,{ref:a,className:de("relative overflow-hidden",t),...r,children:[e.jsx(UI,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(M1,{}),e.jsx(WI,{})]}));D1.displayName=E1.displayName;const M1=f.forwardRef(({className:t,orientation:s="vertical",...r},a)=>e.jsx(pu,{ref:a,orientation:s,className:de("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(S1,{className:"relative flex-1 rounded-full bg-border"})}));M1.displayName=pu.displayName;const KI=[{path:"/",icon:Uc,label:"الرئيسية",key:"dashboard"},{path:"/projects",icon:Ks,label:"المشاريع",key:"projects"},{path:"/workers",icon:Zt,label:"العمال",key:"workers"},{path:"/suppliers-pro",icon:Za,label:"الموردين",key:"suppliers"}],GI=[{category:"الصفحات الرئيسية",pages:[{path:"/",icon:Uc,label:"لوحة التحكم",description:"عرض شامل للمشاريع والإحصائيات",requireAdmin:!1},{path:"/projects",icon:Ks,label:"إدارة المشاريع",description:"إضافة وإدارة المشاريع",requireAdmin:!1},{path:"/workers",icon:Zt,label:"إدارة العمال",description:"إضافة وإدارة العمال والحرفيين",requireAdmin:!1},{path:"/suppliers-pro",icon:Za,label:"إدارة الموردين",description:"إدارة الموردين والموزعين",requireAdmin:!1}]},{category:"العمليات اليومية",pages:[{path:"/worker-attendance",icon:Go,label:"حضور العمال",description:"تسجيل حضور وغياب العمال",requireAdmin:!1},{path:"/daily-expenses",icon:m0,label:"المصاريف اليومية",description:"تسجيل المصاريف اليومية للمشاريع",requireAdmin:!1},{path:"/material-purchase",icon:ra,label:"شراء المواد",description:"إدارة مشتريات مواد البناء",requireAdmin:!1},{path:"/worker-accounts",icon:Ns,label:"حسابات العمال",description:"إدارة حوالات وتحويلات العمال",requireAdmin:!0},{path:"/equipment",icon:gr,label:"إدارة المعدات",description:"إدارة المعدات مع النقل والتتبع",requireAdmin:!0},{path:"/project-transfers",icon:Vn,label:"تحويلات العهدة",description:"إدارة تحويلات الأموال بين المشاريع",requireAdmin:!0},{path:"/project-transactions",icon:Br,label:"سجل العمليات",description:"عرض شامل لجميع المعاملات المالية",requireAdmin:!0}]},{category:"إدارة الموردين",pages:[{path:"/supplier-accounts",icon:_a,label:"حسابات الموردين",description:"إدارة حسابات ودفعات الموردين",requireAdmin:!0}]},{category:"الإشعارات والتنبيهات",pages:[{path:"/notifications",icon:ts,label:"الإشعارات",description:"عرض وإدارة إشعارات النظام",requireAdmin:!1}]},{category:"الأمان والمراقبة",pages:[{path:"/security-policies",icon:fs,label:"السياسات الأمنية",description:"إدارة السياسات الأمنية والامتثال",requireAdmin:!0},{path:"/smart-errors",icon:Qn,label:"كشف الأخطاء الذكي",description:"مراقبة وتحليل أخطاء قاعدة البيانات بذكاء اصطناعي",requireAdmin:!0}]},{category:"الإعدادات والإدارة",pages:[{path:"/autocomplete-admin",icon:tr,label:"إعدادات الإكمال التلقائي",description:"إدارة بيانات الإكمال التلقائي",requireAdmin:!0},{path:"/admin-notifications",icon:ts,label:"إشعارات المسؤولين",description:"إدارة وإرسال إشعارات للمستخدمين",requireAdmin:!0}]}];function HI(){const[t,s]=or(),[r,a]=f.useState(!1),{user:n}=Ra(),i=n?.role==="admin",o=GI.map(u=>({...u,pages:u.pages.filter(d=>!d.requireAdmin||i)})).filter(u=>u.pages.length>0),l=u=>{s(u),a(!1)};return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-primary/95 backdrop-blur-sm border-t border-primary-foreground/20 z-[100] shadow-lg",children:e.jsxs("div",{className:"grid grid-cols-5 h-16",children:[KI.map(u=>{const d=u.icon,c=t===u.path;return e.jsxs(K,{variant:"ghost",className:`flex flex-col items-center justify-center space-y-1 h-full rounded-none ${c?"text-primary-foreground bg-primary-foreground/10":"text-primary-foreground/70 hover:text-primary-foreground"}`,onClick:()=>s(u.path),children:[e.jsx(d,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:u.label})]},u.key)}),e.jsxs(_I,{open:r,onOpenChange:a,children:[e.jsx(CI,{asChild:!0,children:e.jsxs(K,{variant:"ghost",className:"flex flex-col items-center justify-center space-y-1 h-full rounded-none text-primary-foreground/70 hover:text-primary-foreground hover:bg-primary-foreground/10",children:[e.jsx(v2,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"المزيد"})]})}),e.jsxs(x1,{side:"bottom",className:"h-[85vh] max-w-full px-3",children:[e.jsx(g1,{className:"mb-4 px-1",children:e.jsx(y1,{className:"text-right text-lg",children:"جميع الصفحات"})}),e.jsx(D1,{className:"h-full",children:e.jsx("div",{className:"space-y-3 pb-20 px-1",children:o.map((u,d)=>e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2 text-primary text-right border-b border-border pb-1 pr-2 truncate",children:u.category}),e.jsx("div",{className:"space-y-1",children:u.pages.map((c,m)=>{const h=c.icon,x=t===c.path;return e.jsx(K,{variant:x?"default":"ghost",className:"w-full justify-start h-auto p-3 min-h-[60px] text-right",onClick:()=>l(c.path),children:e.jsxs("div",{className:"flex items-start gap-3 w-full text-right",children:[e.jsx(h,{className:`h-5 w-5 mt-0.5 flex-shrink-0 ${x?"text-primary-foreground":"text-primary"}`}),e.jsxs("div",{className:"flex-1 min-w-0 text-right overflow-hidden",children:[e.jsx("div",{className:`font-medium text-sm leading-snug text-right truncate ${x?"text-primary-foreground":""}`,children:c.label}),e.jsx("div",{className:`text-xs mt-1 leading-tight text-right break-words hyphens-auto ${x?"text-primary-foreground/80":"text-muted-foreground"}`,style:{wordWrap:"break-word",overflowWrap:"break-word"},children:c.description})]})]})},m)})}),d<o.length-1&&e.jsx(nu,{className:"my-3"})]},d))})})]})]})]})})}function QI(){const{floatingAction:t,floatingLabel:s}=Ps();if(!t)return null;const r=()=>{t&&t()};return e.jsx(K,{onClick:r,className:"fixed bottom-20 right-4 z-40 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 bg-primary hover:bg-primary/90 border-2 border-primary-foreground/20",size:"icon",title:s,"data-testid":"button-floating-add",children:e.jsx(os,{className:"h-6 w-6"})})}const Xh=({variant:t,size:s})=>{const r=s==="sm"?"h-4 w-4":s==="md"?"h-6 w-6":"h-8 w-8",a={default:e.jsx(Ar,{className:de(r,"animate-spin text-blue-500")}),database:e.jsx(Qn,{className:de(r,"animate-pulse text-green-500")}),processing:e.jsx(Yn,{className:de(r,"animate-bounce text-orange-500")})};return a[t]||a.default},XI=({step:t,index:s})=>{const r=()=>{switch(t.status){case"completed":return e.jsx(Is,{className:"h-4 w-4 text-green-500"});case"loading":return e.jsx(Ar,{className:"h-4 w-4 animate-spin text-blue-500"});case"error":return e.jsx(cs,{className:"h-4 w-4 text-red-500"});default:return e.jsx(Ls,{className:"h-4 w-4 text-gray-400"})}},a=()=>t.startTime&&t.status==="loading"?`${Math.floor((Date.now()-t.startTime)/1e3)}ث`:null;return e.jsxs(Ut.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.1},className:de("flex items-center gap-3 p-3 rounded-lg transition-all duration-300",t.status==="loading"&&"bg-blue-50 border border-blue-200",t.status==="completed"&&"bg-green-50 border border-green-200",t.status==="error"&&"bg-red-50 border border-red-200",t.status==="pending"&&"bg-gray-50 border border-gray-200"),children:[e.jsx("div",{className:"flex-shrink-0",children:r()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:de("text-sm font-medium truncate",t.status==="loading"&&"text-blue-700",t.status==="completed"&&"text-green-700",t.status==="error"&&"text-red-700",t.status==="pending"&&"text-gray-600"),children:t.label}),a()&&e.jsx("span",{className:"text-xs text-blue-600 font-mono",children:a()})]}),t.progress!==void 0&&t.status==="loading"&&e.jsx(Ut.div,{className:"mt-2 bg-gray-200 rounded-full h-1.5 overflow-hidden",initial:{scaleX:0},animate:{scaleX:1},children:e.jsx(Ut.div,{className:"bg-blue-500 h-full rounded-full",initial:{width:0},animate:{width:`${t.progress}%`},transition:{duration:.5}})})]})]})},ZI=({progress:t,size:s})=>{const r=2*Math.PI*(s/2-8),a=r,n=r-t/100*r;return e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"transform -rotate-90",width:s,height:s,children:[e.jsx("circle",{cx:s/2,cy:s/2,r:s/2-8,stroke:"currentColor",strokeWidth:"4",fill:"transparent",className:"text-gray-200"}),e.jsx(Ut.circle,{cx:s/2,cy:s/2,r:s/2-8,stroke:"currentColor",strokeWidth:"4",fill:"transparent",strokeDasharray:a,strokeDashoffset:n,strokeLinecap:"round",className:"text-blue-500",initial:{strokeDashoffset:r},animate:{strokeDashoffset:n},transition:{duration:.5,ease:"easeInOut"}})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-semibold text-blue-600",children:[Math.round(t),"%"]})})]})},Lo=({isLoading:t,steps:s=[],message:r="جاري التحميل...",progress:a,showSteps:n=!1,size:i="md",variant:o="default",onComplete:l,estimatedTime:u,className:d})=>{const[c,m]=Ye.useState(0),h=Ye.useRef(Date.now());if(Ye.useEffect(()=>{if(!t)return;h.current=Date.now();const k=setInterval(()=>{m(Math.floor((Date.now()-h.current)/1e3))},1e3);return()=>clearInterval(k)},[t]),Ye.useEffect(()=>{!t&&c>0&&(l?.(),m(0))},[t,c,l]),!t)return null;const x=()=>e.jsxs(Ut.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:de("flex items-center gap-3",d),children:[e.jsx(Xh,{variant:o,size:i}),e.jsx("span",{className:"text-sm text-gray-600",children:r})]}),p=()=>e.jsxs(Ut.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:de("bg-white rounded-xl shadow-lg border border-gray-200 p-6 max-w-md mx-auto",d),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:a!==void 0?e.jsx(ZI,{progress:a,size:80}):e.jsx(Xh,{variant:o,size:"lg"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:r}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["الوقت المنقضي: ",c,"ث"]}),u&&e.jsxs("span",{children:["المتوقع: ",u,"ث"]})]})]}),n&&s.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"التقدم التفصيلي:"}),s.map((k,g)=>e.jsx(XI,{step:k,index:g},k.id))]}),a!==void 0&&!n&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"التقدم"}),e.jsxs("span",{children:[Math.round(a),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx(Ut.div,{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full",initial:{width:0},animate:{width:`${a}%`},transition:{duration:.5}})})]})]});return o==="minimal"?x():e.jsx(Zc,{children:t&&e.jsx(Ut.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm",children:p()})})};function qs({children:t}){const{isAuthenticated:s,isLoading:r,user:a}=Ra(),[n,i]=f.useState(!1),o=typeof window<"u"&&localStorage.getItem("user")&&localStorage.getItem("accessToken");if(console.log("🛡️ [ProtectedRoute] فحص الحماية:",{isLoading:r,isAuthenticated:s,hasStoredAuth:o,userEmail:a?.email||"غير موجود",authCheckComplete:n,timestamp:new Date().toISOString()}),f.useEffect(()=>{if(!r){const l=setTimeout(()=>{i(!0)},1e3);return()=>clearTimeout(l)}},[r]),r)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx(Lo,{})});if(!a)return e.jsx(va,{to:"/login"});if(a&&!a.emailVerified)return console.log("🚫 [ProtectedRoute] مستخدم غير متحقق من البريد، توجيه للتحقق"),e.jsx(va,{to:`/verify-email?userId=${a.id}&email=${encodeURIComponent(a.email)}`});if(s&&a){console.log("✅ [ProtectedRoute] مصادق عليه، إظهار المحتوى للمستخدم:",a.email);try{return e.jsx(e.Fragment,{children:t})}catch(l){return console.error("❌ [ProtectedRoute] خطأ في تحميل المحتوى:",l),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:"خطأ في تحميل الصفحة"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"حدث خطأ أثناء تحميل المحتوى. يرجى إعادة تحميل الصفحة."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"إعادة تحميل"})]})})}}if(o&&!a&&n){console.log("⚠️ [ProtectedRoute] بيانات محفوظة موجودة لكن المستخدم غير محمل، إعادة المحاولة...");try{const l=localStorage.getItem("user");if(l){const u=JSON.parse(l);if(u&&u.email)return console.log("✅ [ProtectedRoute] تم استرجاع بيانات المستخدم من localStorage"),e.jsx(e.Fragment,{children:t})}}catch(l){console.error("❌ [ProtectedRoute] خطأ في استرجاع بيانات المستخدم من localStorage:",l)}}return!s&&!o&&n?(console.log("🚫 [ProtectedRoute] لا توجد بيانات مصادقة، إعادة توجيه إلى /login"),e.jsx(va,{to:"/login"})):o&&!s&&n?(console.log("🧹 [ProtectedRoute] تنظيف البيانات الفاسدة وإعادة التوجيه"),localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),e.jsx(va,{to:"/login"})):(console.log("⏳ [ProtectedRoute] حالة افتراضية، إظهار شاشة التحميل"),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Lo,{})}))}function Rr({children:t,requiredRole:s="admin"}){const{user:r,isAuthenticated:a,isLoading:n}=Ra();return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Lo,{})}):a?!r||r.role!==s?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs(da,{variant:"destructive",className:"text-center",children:[e.jsx(E2,{className:"h-6 w-6 mx-auto mb-2"}),e.jsxs(ua,{className:"text-lg",children:[e.jsx("strong",{children:"غير مصرح لك بالوصول"}),e.jsx("br",{}),"هذه الصفحة مخصصة للمسؤولين فقط",e.jsx("br",{}),e.jsxs("span",{className:"text-sm opacity-80",children:["دورك الحالي: ",r?.role||"غير محدد"]})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("a",{href:"/",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"العودة للصفحة الرئيسية"})})]})}):e.jsx(e.Fragment,{children:t}):e.jsx(va,{to:"/login"})}function YI({children:t}){const{user:s,isLoading:r}=Ra();return r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx(Lo,{isLoading:!0,message:"جاري التحقق من البريد الإلكتروني..."})}):s?s.emailVerified?e.jsx(e.Fragment,{children:t}):(console.log("🚫 [EmailVerificationGuard] المستخدم لم يتم التحقق من البريد، توجيه للتحقق"),e.jsx(va,{to:`/verify-email?userId=${s.id}&email=${encodeURIComponent(s.email)}`})):e.jsx(va,{to:"/login"})}function Lt({children:t}){return e.jsxs(e.Fragment,{children:[e.jsx(AI,{}),e.jsx("main",{className:"pb-20",children:t}),e.jsx(HI,{}),e.jsx(QI,{})]})}function JI(){return console.log("🧭 [App.Router] بدء تحميل Router...",new Date().toISOString()),e.jsxs(n0,{children:[e.jsx(jt,{path:"/login",component:_c}),e.jsx(jt,{path:"/register",component:_c}),e.jsx(jt,{path:"/reset-password",component:ib}),e.jsx(jt,{path:"/verify-email",component:ob}),e.jsx(jt,{path:"/",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(NC,{})})})}),e.jsx(jt,{path:"/projects",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(n3,{})})})}),e.jsx(jt,{path:"/workers",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(c3,{})})})}),e.jsx(jt,{path:"/worker-accounts",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(d3,{})})})}),e.jsx(jt,{path:"/suppliers",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(Fh,{})})})}),e.jsx(jt,{path:"/suppliers-pro",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(Fh,{})})})}),e.jsx(jt,{path:"/supplier-accounts",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(v3,{})})})}),e.jsx(jt,{path:"/worker-attendance",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(w4,{})})})}),e.jsx(jt,{path:"/daily-expenses",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(A4,{})})})}),e.jsx(jt,{path:"/material-purchase",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(yh,{})})})}),e.jsx(jt,{path:"/material-purchases",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(yh,{})})})}),e.jsx(jt,{path:"/project-transfers",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(uE,{})})})}),e.jsx(jt,{path:"/project-transactions",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(WD,{})})})}),e.jsx(jt,{path:"/autocomplete-admin",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(P3,{})})})}),e.jsx(jt,{path:"/equipment",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(qh,{})})})}),e.jsx(jt,{path:"/equipment-management",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(qh,{})})})}),e.jsx(jt,{path:"/notifications",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(z3,{})})})}),e.jsx(jt,{path:"/admin-notifications",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(U3,{})})})}),e.jsx(jt,{path:"/smart-errors",children:e.jsx(qs,{children:e.jsx(Lt,{children:e.jsx(W3,{})})})}),e.jsx(jt,{path:"/security-policies",children:e.jsx(Rr,{children:e.jsx(Lt,{children:e.jsx(K3,{})})})}),e.jsx(jt,{component:Fk})]})}function eR(){return e.jsx(Cc,{children:e.jsx(Y1,{client:Yl,children:e.jsx(KP,{children:e.jsx(Mk,{children:e.jsx(jC,{children:e.jsxs("div",{className:"min-h-screen bg-background text-foreground",dir:"rtl",children:[e.jsx(Cc,{children:e.jsxs(n0,{children:[e.jsx(jt,{path:"/login",component:_c}),e.jsx(jt,{path:"/verify-email",component:ob}),e.jsx(jt,{path:"/reset-password",component:ib}),e.jsx(jt,{path:"*",component:()=>e.jsx(qs,{children:e.jsx(YI,{children:e.jsx(Lt,{children:e.jsx(JI,{})})})})})]})}),e.jsx(pk,{})]})})})})})})}e2.createRoot(document.getElementById("root")).render(e.jsx(eR,{}));
