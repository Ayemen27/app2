
import { defineConfig } from "drizzle-kit";

// ุงูุชุญูู ูู ูุฌูุฏ DATABASE_URL
if (!process.env.DATABASE_URL) {
  console.error("โ DATABASE_URL ุบูุฑ ููุฌูุฏ ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ");
  throw new Error("DATABASE_URL is required. Please set it in your environment variables");
}

// ุงุณุชุฎุฑุงุฌ ูุนูููุงุช ุงูุงุชุตุงู ูู DATABASE_URL
const databaseUrl = process.env.DATABASE_URL;
console.log("๐ง ุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช:", databaseUrl.replace(/\/\/[^:]+:[^@]+@/, '//***:***@'));

// ุชุญุฏูุฏ ุฅุนุฏุงุฏุงุช SSL ุจูุงุกู ุนูู ููุน ุงูุงุชุตุงู
function getSSLConfig() {
  const url = databaseUrl.toLowerCase();
  
  // ุฅุฐุง ูุงู ุงูุงุชุตุงู ูุญููุ ูุง ูุญุชุงุฌ SSL
  if (url.includes('localhost') || url.includes('127.0.0.1')) {
    return false;
  }
  
  // ููุงุชุตุงูุงุช ุงูุฎุงุฑุฌูุฉุ ูุณุชุฎุฏู SSL ูุน ุชุฌุงูู ุงูุดูุงุฏุงุช ุบูุฑ ุงูููุซููุฉ
  return {
    rejectUnauthorized: false
  };
}

export default defineConfig({
  out: "./migrations",
  schema: "./shared/schema.ts", 
  dialect: "postgresql",
  dbCredentials: {
    url: databaseUrl,
    ssl: getSSLConfig()
  },
  verbose: true,
  strict: true,
  // ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ ููุฃุฏุงุก ูุงูุงุณุชูุฑุงุฑ
  schemaFilter: ["public"],
  tablesFilter: ["*"],
  // ุชูููู ุงูุชุชุจุน ุงูููุตู ููุนูููุงุช
  breakpoints: true
});
