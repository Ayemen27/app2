/**
 * ูุณุงุฑุงุช ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
 * Notification Management Routes
 */

import express from 'express';
import { Request, Response } from 'express';
import { requireAuth } from '../../middleware/auth.js';

export const notificationRouter = express.Router();

// ุชุทุจูู ุงููุตุงุฏูุฉ ุนูู ุฌููุน ูุณุงุฑุงุช ุงูุฅุดุนุงุฑุงุช
notificationRouter.use(requireAuth);

/**
 * ๐ ุฌูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช
 * GET /api/notifications
 */
notificationRouter.get('/', async (req: Request, res: Response) => {
  try {
    console.log('๐ [API] ุฌูุจ ุงูุฅุดุนุงุฑุงุช ูููุณุชุฎุฏู');
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      data: [],
      message: 'ูุงุฆูุฉ ุงูุฅุดุนุงุฑุงุช - ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู'
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ุฌูุจ ุงูุฅุดุนุงุฑุงุช:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุฌูุจ ุงูุฅุดุนุงุฑุงุช',
      message: error.message
    });
  }
});

/**
 * โ ุฅุถุงูุฉ ุฅุดุนุงุฑ ุฌุฏูุฏ
 * POST /api/notifications
 */
notificationRouter.post('/', async (req: Request, res: Response) => {
  try {
    console.log('โ [API] ุฅุถุงูุฉ ุฅุดุนุงุฑ ุฌุฏูุฏ:', req.body);
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู ูุน validation
    res.json({
      success: true,
      message: 'ุฅุถุงูุฉ ุฅุดุนุงุฑ ุฌุฏูุฏ - ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู'
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุฅุดุนุงุฑ:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุฅุถุงูุฉ ุฅุดุนุงุฑ ุฌุฏูุฏ',
      message: error.message
    });
  }
});

/**
 * ๐๏ธ ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุฅุดุนุงุฑ ูุญุฏุฏ
 * POST /api/notifications/:id/read
 */
notificationRouter.post('/:id/read', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    console.log('๐๏ธ [API] ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุงูุฅุดุนุงุฑ:', id);
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      message: `ุชู ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุงูุฅุดุนุงุฑ ${id} - ุณูุชู ููู ุงูููุทู`
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ูุถุน ุนูุงูุฉ ุงููุฑุงุกุฉ:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ูุถุน ุนูุงูุฉ ุงููุฑุงุกุฉ',
      message: error.message
    });
  }
});

/**
 * ๐๏ธโ๐จ๏ธ ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุฅุดุนุงุฑ ูุญุฏุฏ (ูุณุงุฑ ุจุฏูู)
 * POST /api/notifications/:id/mark-read
 */
notificationRouter.post('/:id/mark-read', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    console.log('๐๏ธโ๐จ๏ธ [API] ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุงูุฅุดุนุงุฑ (ุจุฏูู):', id);
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      message: `ุชู ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุงูุฅุดุนุงุฑ ${id} - ุณูุชู ููู ุงูููุทู`
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ูุถุน ุนูุงูุฉ ุงููุฑุงุกุฉ:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ูุถุน ุนูุงูุฉ ุงููุฑุงุกุฉ',
      message: error.message
    });
  }
});

/**
 * ๐ ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุฌููุน ุงูุฅุดุนุงุฑุงุช
 * POST /api/notifications/mark-all-read
 */
notificationRouter.post('/mark-all-read', async (req: Request, res: Response) => {
  try {
    console.log('๐ [API] ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุฌููุน ุงูุฅุดุนุงุฑุงุช');
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      message: 'ุชู ูุถุน ุนูุงูุฉ ูุฑุงุกุฉ ุนูู ุฌููุน ุงูุฅุดุนุงุฑุงุช - ุณูุชู ููู ุงูููุทู'
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ูุถุน ุนูุงูุฉ ุงููุฑุงุกุฉ ุนูู ุงูุฌููุน:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ูุถุน ุนูุงูุฉ ุงููุฑุงุกุฉ ุนูู ุฌููุน ุงูุฅุดุนุงุฑุงุช',
      message: error.message
    });
  }
});

/**
 * ๐ ุฌูุจ ุฅุดุนุงุฑ ูุญุฏุฏ
 * GET /api/notifications/:id
 */
notificationRouter.get('/:id', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    console.log('๐ [API] ุฌูุจ ุฅุดุนุงุฑ ูุญุฏุฏ:', id);
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      data: null,
      message: `ุฌูุจ ุงูุฅุดุนุงุฑ ${id} - ุณูุชู ููู ุงูููุทู`
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ุฌูุจ ุงูุฅุดุนุงุฑ:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุฌูุจ ุงูุฅุดุนุงุฑ',
      message: error.message
    });
  }
});

/**
 * โ๏ธ ุชุนุฏูู ุฅุดุนุงุฑ
 * PUT /api/notifications/:id
 */
notificationRouter.put('/:id', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    console.log('โ๏ธ [API] ุชุนุฏูู ุฅุดุนุงุฑ:', id);
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      message: `ุชู ุชุนุฏูู ุงูุฅุดุนุงุฑ ${id} - ุณูุชู ููู ุงูููุทู`
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ุชุนุฏูู ุงูุฅุดุนุงุฑ:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุชุนุฏูู ุงูุฅุดุนุงุฑ',
      message: error.message
    });
  }
});

/**
 * ๐๏ธ ุญุฐู ุฅุดุนุงุฑ
 * DELETE /api/notifications/:id
 */
notificationRouter.delete('/:id', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    console.log('๐๏ธ [API] ุญุฐู ุฅุดุนุงุฑ:', id);
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      message: `ุชู ุญุฐู ุงูุฅุดุนุงุฑ ${id} - ุณูุชู ููู ุงูููุทู`
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ุญุฐู ุงูุฅุดุนุงุฑ:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุญุฐู ุงูุฅุดุนุงุฑ',
      message: error.message
    });
  }
});

/**
 * ๐ ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช
 * GET /api/notifications/stats
 */
notificationRouter.get('/stats', async (req: Request, res: Response) => {
  try {
    console.log('๐ [API] ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช');
    
    // ุณูุชู ููู ุงูููุทู ูู ุงูููู ุงูุฃุตูู
    res.json({
      success: true,
      data: {
        total: 0,
        unread: 0,
        read: 0,
        byType: {}
      },
      message: 'ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช - ุณูุชู ููู ุงูููุทู'
    });
  } catch (error: any) {
    console.error('โ [Notifications] ุฎุทุฃ ูู ุฌูุจ ุงูุฅุญุตุงุฆูุงุช:', error);
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช',
      message: error.message
    });
  }
});

/**
 * ๐งช ูุณุงุฑุงุช ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช (ููุชุทููุฑ)
 * Test notification routes (for development)
 */
notificationRouter.post('/test/create', async (req: Request, res: Response) => {
  try {
    console.log('๐งช [API] ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู');
    
    res.json({
      success: true,
      message: 'ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู - ุณูุชู ููู ุงูููุทู'
    });
  } catch (error: any) {
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู'
    });
  }
});

notificationRouter.get('/test/stats', async (req: Request, res: Response) => {
  try {
    console.log('๐งช [API] ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจูุฉ');
    
    res.json({
      success: true,
      data: {
        testNotifications: 0,
        environment: 'development'
      },
      message: 'ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจูุฉ'
    });
  } catch (error: any) {
    res.status(500).json({
      success: false,
      error: 'ุฎุทุฃ ูู ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจูุฉ'
    });
  }
});

console.log('๐ [NotificationRouter] ุชู ุชููุฆุฉ ูุณุงุฑุงุช ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช');

export default notificationRouter;