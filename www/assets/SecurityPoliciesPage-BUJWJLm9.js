import{ap as E,r as F,aW as R,f as o,a$ as g,b0 as I,T as b,j as e,b9 as U,ag as V,ah as q,ai as r,ba as D,bb as K,ak as n,n as P,bc as c,o as d,b5 as j,aI as y,bd as f,b8 as Y,ad as u,ae as G,be as M,l as O,a2 as Q,aa as X,m as $,B,Q as h}from"./index-C8SUMTcO.js";import{R as W,A as z,C as H,X as Z,Y as _,T as J,a as ee}from"./AreaChart-BB-vPype.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=E("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);function oe(){const[x,w]=F.useState("policies"),{searchValue:t,filterValues:i,onSearchChange:C,onFilterChange:N,onReset:k}=R({status:"all",severity:"all"}),{data:m=[],isLoading:ae}=o({queryKey:h.securityPolicies,queryFn:async()=>{const a=await fetch("/api/security/policies");if(!a.ok)throw new Error("فشل في جلب السياسات الأمنية");const s=await a.json();return s.success?s.data:s}}),{data:p=[],isLoading:se}=o({queryKey:h.securitySuggestions,queryFn:async()=>{const a=await fetch("/api/security/suggestions");if(!a.ok)throw new Error("فشل في جلب اقتراحات السياسات");const s=await a.json();return s.success?s.data:s}}),{data:l=[],isLoading:ie}=o({queryKey:h.securityViolations,queryFn:async()=>{const a=await fetch("/api/security/violations");if(!a.ok)throw new Error("فشل في جلب انتهاكات السياسات");const s=await a.json();return s.success?s.data:s}}),L=m.filter(a=>(a.title.toLowerCase().includes(t.toLowerCase())||a.description.toLowerCase().includes(t.toLowerCase()))&&(i.status==="all"||a.status===i.status)&&(i.severity==="all"||a.severity===i.severity)),S=[{title:"مؤشر الأمان",value:"85%",icon:g,color:"orange"},{title:"السياسات النشطة",value:m.filter(a=>a.status==="active").length,icon:I,color:"green"},{title:"انتهاكات حرجة",value:l.filter(a=>a.violation.severity==="critical").length,icon:v,color:"red"},{title:"اقتراحات ذكية",value:p.filter(a=>a.status==="pending").length,icon:b,color:"blue"}],A=[{name:"الأحد",violations:4},{name:"الاثنين",violations:3},{name:"الثلاثاء",violations:7},{name:"الأربعاء",violations:5},{name:"الخميس",violations:2},{name:"الجمعة",violations:0},{name:"السبت",violations:1}],T=[{key:"status",label:"الحالة",type:"select",options:[{value:"all",label:"جميع الحالات"},{value:"active",label:"نشط"},{value:"draft",label:"مسودة"},{value:"inactive",label:"غير نشط"}]},{key:"severity",label:"المستوى",type:"select",options:[{value:"all",label:"جميع المستويات"},{value:"critical",label:"حرج"},{value:"high",label:"عالي"},{value:"medium",label:"متوسط"},{value:"low",label:"منخفض"}]}];return e.jsxs("div",{className:"container mx-auto px-2 sm:px-4 py-4 space-y-6",dir:"rtl",children:[e.jsx(U,{stats:S,columns:4}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(V,{value:x,onValueChange:w,className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mb-6",children:[e.jsxs(q,{className:"w-full sm:w-auto p-1 rounded-xl h-11",children:[e.jsx(r,{value:"policies",className:"rounded-lg px-6 h-9",children:"السياسات"}),e.jsx(r,{value:"suggestions",className:"rounded-lg px-6 h-9",children:"الاقتراحات"}),e.jsx(r,{value:"violations",className:"rounded-lg px-6 h-9",children:"الانتهاكات"})]}),e.jsx(D,{searchValue:t,onSearchChange:C,searchPlaceholder:"بحث في السياسات...",filters:x==="policies"?T:[],filterValues:i,onFilterChange:N,onReset:k,className:"w-full sm:w-80",showActiveFilters:!0})]}),e.jsxs(K,{mode:"wait",children:[e.jsx(n,{value:"policies",children:e.jsx(P,{columns:2,children:L.map(a=>e.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(d,{title:a.title,subtitle:a.policyId,titleIcon:G,headerColor:a.status==="active"?"#10b981":"#64748b",badges:[{label:a.severity==="critical"?"حرج":a.severity==="high"?"عالي":"متوسط",variant:a.severity==="critical"?"destructive":a.severity==="high"?"warning":"default"},{label:a.status==="active"?"نشط":"مسودة",variant:a.status==="active"?"success":"secondary"}],fields:[{label:"الفئة",value:a.category,icon:f},{label:"الانتهاكات",value:a.violationsCount,icon:Y,color:a.violationsCount>0?"danger":"success"},{label:"آخر تحديث",value:new Date(a.updatedAt).toLocaleDateString("ar"),icon:u,color:"muted"}],actions:[{icon:j,label:"عرض التفاصيل",onClick:()=>{}},{icon:y,label:"تفعيل",onClick:()=>{},hidden:a.status==="active"}]})},a.id))})},"policies"),e.jsx(n,{value:"suggestions",children:e.jsx("div",{className:"space-y-4",children:p.map(a=>e.jsx(c.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},children:e.jsx(d,{title:a.title,subtitle:`اقتراح ذكي - ثقة ${a.confidence}%`,titleIcon:g,fields:[{label:"الوصف",value:a.description},{label:"الفئة",value:a.category,icon:f}],actions:[{icon:y,label:"تطبيق",onClick:()=>{},color:"green"},{icon:M,label:"رفض",onClick:()=>{},color:"red"}]})},a.id))})},"suggestions"),e.jsx(n,{value:"violations",children:e.jsx("div",{className:"space-y-4",children:l.map(a=>e.jsx(c.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},children:e.jsx(d,{title:a.violation.violatedRule,subtitle:`السياسة: ${a.policy?.title||"غير محدد"}`,titleIcon:v,headerColor:"#ef4444",fields:[{label:"التوقيت",value:new Date(a.violation.detectedAt).toLocaleString("ar"),icon:u},{label:"المستوى",value:a.violation.severity,color:"danger"}],actions:[{icon:j,label:"تحليل",onClick:()=>{}}]})},a.violation.id))})},"violations")]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(O,{className:"border-0 shadow-sm overflow-hidden bg-card rounded-xl",children:[e.jsx(Q,{className:"pb-2",children:e.jsxs(X,{className:"text-base flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-primary"}),"تحليل الانتهاكات الأسبوعي"]})}),e.jsx($,{children:e.jsx("div",{className:"h-[200px] w-full mt-4",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(z,{data:A,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorViolations",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx(H,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))"}),e.jsx(Z,{dataKey:"name",hide:!0}),e.jsx(_,{hide:!0}),e.jsx(J,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"}}),e.jsx(ee,{type:"monotone",dataKey:"violations",stroke:"hsl(var(--primary))",strokeWidth:3,fillOpacity:1,fill:"url(#colorViolations)"})]})})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-destructive"}),"آخر الانتهاكات"]}),e.jsx(B,{variant:"link",className:"text-xs",children:"مشاهدة الكل"})]}),e.jsx("div",{className:"space-y-3",children:l.slice(0,4).map(a=>e.jsxs("div",{className:"p-4 bg-card rounded-xl border flex items-center gap-4 group cursor-pointer hover:border-destructive/30 transition-all",children:[e.jsx("div",{className:"p-2 bg-destructive/10 rounded-lg group-hover:scale-110 transition-transform",children:e.jsx(v,{className:"w-4 h-4 text-destructive"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:a.violation.violatedRule}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(a.violation.detectedAt).toLocaleTimeString("ar")})]})]},a.violation.id))})]})]})]})]})}export{oe as SecurityPoliciesPage};
